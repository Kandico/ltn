var Ug=Object.defineProperty;var jg=(u,n,l)=>n in u?Ug(u,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[n]=l;var gi=(u,n,l)=>(jg(u,typeof n!="symbol"?n+"":n,l),l);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))c(p);new MutationObserver(p=>{for(const v of p)if(v.type==="childList")for(const S of v.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&c(S)}).observe(document,{childList:!0,subtree:!0});function l(p){const v={};return p.integrity&&(v.integrity=p.integrity),p.referrerPolicy&&(v.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?v.credentials="include":p.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function c(p){if(p.ep)return;p.ep=!0;const v=l(p);fetch(p.href,v)}})();function Dt(){}function qg(u,n){for(const l in n)u[l]=n[l];return u}function tm(u){return u()}function lp(){return Object.create(null)}function _n(u){u.forEach(tm)}function Ou(u){return typeof u=="function"}function ti(u,n){return u!=u?n==n:u!==n||u&&typeof u=="object"||typeof u=="function"}let ku;function id(u,n){return u===n?!0:(ku||(ku=document.createElement("a")),ku.href=n,u===ku.href)}function Zg(u){return Object.keys(u).length===0}function im(u,...n){if(u==null){for(const c of n)c(void 0);return Dt}const l=u.subscribe(...n);return l.unsubscribe?()=>l.unsubscribe():l}function Gg(u){let n;return im(u,l=>n=l)(),n}function vt(u,n,l){u.$$.on_destroy.push(im(n,l))}function Yr(u,n,l,c){if(u){const p=rm(u,n,l,c);return u[0](p)}}function rm(u,n,l,c){return u[1]&&c?qg(l.ctx.slice(),u[1](c(n))):l.ctx}function Qr(u,n,l,c){if(u[2]&&c){const p=u[2](c(l));if(n.dirty===void 0)return p;if(typeof p=="object"){const v=[],S=Math.max(n.dirty.length,p.length);for(let s=0;s<S;s+=1)v[s]=n.dirty[s]|p[s];return v}return n.dirty|p}return n.dirty}function en(u,n,l,c,p,v){if(p){const S=rm(n,l,c,v);u.p(S,p)}}function tn(u){if(u.ctx.length>32){const n=[],l=u.ctx.length/32;for(let c=0;c<l;c++)n[c]=-1;return n}return-1}function Xg(u){const n={};for(const l in u)n[l]=!0;return n}function cp(u){return u??""}function ei(u,n,l){return u.set(l),n}function rd(u){return u&&Ou(u.destroy)?u.destroy:Dt}const Wg=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function fe(u,n){u.appendChild(n)}function Be(u,n,l){u.insertBefore(n,l||null)}function De(u){u.parentNode&&u.parentNode.removeChild(u)}function md(u,n){for(let l=0;l<u.length;l+=1)u[l]&&u[l].d(n)}function ye(u){return document.createElement(u)}function Gt(u){return document.createTextNode(u)}function et(){return Gt(" ")}function Bn(){return Gt("")}function Et(u,n,l,c){return u.addEventListener(n,l,c),()=>u.removeEventListener(n,l,c)}function Ot(u,n,l){l==null?u.removeAttribute(n):u.getAttribute(n)!==l&&u.setAttribute(n,l)}function Hg(u){return Array.from(u.childNodes)}function jr(u,n){n=""+n,u.data!==n&&(u.data=n)}function Ln(u,n){u.value=n??""}function La(u,n,l,c){l==null?u.style.removeProperty(n):u.style.setProperty(n,l,c?"important":"")}function up(u,n,l){for(let c=0;c<u.options.length;c+=1){const p=u.options[c];if(p.__value===n){p.selected=!0;return}}(!l||n!==void 0)&&(u.selectedIndex=-1)}function $g(u){const n=u.querySelector(":checked");return n&&n.__value}function hp(u,n,l){u.classList.toggle(n,!!l)}function Kg(u,n,{bubbles:l=!1,cancelable:c=!1}={}){return new CustomEvent(u,{detail:n,bubbles:l,cancelable:c})}let ac;function rc(u){ac=u}function hc(){if(!ac)throw new Error("Function called outside component initialization");return ac}function dc(u){hc().$$.on_mount.push(u)}function xo(u){hc().$$.on_destroy.push(u)}function fc(){const u=hc();return(n,l,{cancelable:c=!1}={})=>{const p=u.$$.callbacks[n];if(p){const v=Kg(n,l,{cancelable:c});return p.slice().forEach(S=>{S.call(u,v)}),!v.defaultPrevented}return!0}}function nm(u,n){return hc().$$.context.set(u,n),n}function Jg(u){return hc().$$.context.get(u)}function Vi(u,n){const l=u.$$.callbacks[n.type];l&&l.slice().forEach(c=>c.call(this,n))}const Pa=[],gr=[];let Da=[];const nd=[],om=Promise.resolve();let od=!1;function sm(){od||(od=!0,om.then(am))}function Yg(){return sm(),om}function zu(u){Da.push(u)}function ms(u){nd.push(u)}const Kh=new Set;let Ca=0;function am(){if(Ca!==0)return;const u=ac;do{try{for(;Ca<Pa.length;){const n=Pa[Ca];Ca++,rc(n),Qg(n.$$)}}catch(n){throw Pa.length=0,Ca=0,n}for(rc(null),Pa.length=0,Ca=0;gr.length;)gr.pop()();for(let n=0;n<Da.length;n+=1){const l=Da[n];Kh.has(l)||(Kh.add(l),l())}Da.length=0}while(Pa.length);for(;nd.length;)nd.pop()();od=!1,Kh.clear(),rc(u)}function Qg(u){if(u.fragment!==null){u.update(),_n(u.before_update);const n=u.dirty;u.dirty=[-1],u.fragment&&u.fragment.p(u.ctx,n),u.after_update.forEach(zu)}}function ey(u){const n=[],l=[];Da.forEach(c=>u.indexOf(c)===-1?n.push(c):l.push(c)),l.forEach(c=>c()),Da=n}const Cu=new Set;let Vs;function yr(){Vs={r:0,c:[],p:Vs}}function vr(){Vs.r||_n(Vs.c),Vs=Vs.p}function be(u,n){u&&u.i&&(Cu.delete(u),u.i(n))}function Ie(u,n,l,c){if(u&&u.o){if(Cu.has(u))return;Cu.add(u),Vs.c.push(()=>{Cu.delete(u),c&&(l&&u.d(1),c())}),u.o(n)}else c&&c()}function Fa(u){return(u==null?void 0:u.length)!==void 0?u:Array.from(u)}function _s(u,n,l){const c=u.$$.props[n];c!==void 0&&(u.$$.bound[c]=l,l(u.$$.ctx[c]))}function $e(u){u&&u.c()}function We(u,n,l){const{fragment:c,after_update:p}=u.$$;c&&c.m(n,l),zu(()=>{const v=u.$$.on_mount.map(tm).filter(Ou);u.$$.on_destroy?u.$$.on_destroy.push(...v):_n(v),u.$$.on_mount=[]}),p.forEach(zu)}function He(u,n){const l=u.$$;l.fragment!==null&&(ey(l.after_update),_n(l.on_destroy),l.fragment&&l.fragment.d(n),l.on_destroy=l.fragment=null,l.ctx=[])}function ty(u,n){u.$$.dirty[0]===-1&&(Pa.push(u),sm(),u.$$.dirty.fill(0)),u.$$.dirty[n/31|0]|=1<<n%31}function li(u,n,l,c,p,v,S=null,s=[-1]){const I=ac;rc(u);const M=u.$$={fragment:null,ctx:[],props:v,update:Dt,not_equal:p,bound:lp(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(I?I.$$.context:[])),callbacks:lp(),dirty:s,skip_bound:!1,root:n.target||I.$$.root};S&&S(M.root);let B=!1;if(M.ctx=l?l(u,n.props||{},(j,ie,...ae)=>{const ce=ae.length?ae[0]:ie;return M.ctx&&p(M.ctx[j],M.ctx[j]=ce)&&(!M.skip_bound&&M.bound[j]&&M.bound[j](ce),B&&ty(u,j)),ie}):[],M.update(),B=!0,_n(M.before_update),M.fragment=c?c(M.ctx):!1,n.target){if(n.hydrate){const j=Hg(n.target);M.fragment&&M.fragment.l(j),j.forEach(De)}else M.fragment&&M.fragment.c();n.intro&&be(u.$$.fragment),We(u,n.target,n.anchor),am()}rc(I)}class ci{constructor(){gi(this,"$$");gi(this,"$$set")}$destroy(){He(this,1),this.$destroy=Dt}$on(n,l){if(!Ou(l))return Dt;const c=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return c.push(l),()=>{const p=c.indexOf(l);p!==-1&&c.splice(p,1)}}$set(n){this.$$set&&!Zg(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const iy="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(iy);let st;const qo=new Array(128).fill(void 0);qo.push(void 0,null,!0,!1);function Ht(u){return qo[u]}let nc=qo.length;function ry(u){u<132||(qo[u]=nc,nc=u)}function kn(u){const n=Ht(u);return ry(u),n}const lm=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&lm.decode();let Kl=null;function Ba(){return(Kl===null||Kl.byteLength===0)&&(Kl=new Uint8Array(st.memory.buffer)),Kl}function co(u,n){return u=u>>>0,lm.decode(Ba().subarray(u,u+n))}function ir(u){nc===qo.length&&qo.push(qo.length+1);const n=nc;return nc=qo[n],qo[n]=u,n}let Dn=0;const Au=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ny=typeof Au.encodeInto=="function"?function(u,n){return Au.encodeInto(u,n)}:function(u,n){const l=Au.encode(u);return n.set(l),{read:u.length,written:l.length}};function jo(u,n,l){if(l===void 0){const s=Au.encode(u),I=n(s.length,1)>>>0;return Ba().subarray(I,I+s.length).set(s),Dn=s.length,I}let c=u.length,p=n(c,1)>>>0;const v=Ba();let S=0;for(;S<c;S++){const s=u.charCodeAt(S);if(s>127)break;v[p+S]=s}if(S!==c){S!==0&&(u=u.slice(S)),p=l(p,c,c=S+u.length*3,1)>>>0;const s=Ba().subarray(p+S,p+c),I=ny(u,s);S+=I.written}return Dn=S,p}function za(u){return u==null}let Jl=null;function Lt(){return(Jl===null||Jl.byteLength===0)&&(Jl=new Int32Array(st.memory.buffer)),Jl}let Yl=null;function cm(){return(Yl===null||Yl.byteLength===0)&&(Yl=new Float64Array(st.memory.buffer)),Yl}let Ql=null;function oy(){return(Ql===null||Ql.byteLength===0)&&(Ql=new BigInt64Array(st.memory.buffer)),Ql}function sd(u){const n=typeof u;if(n=="number"||n=="boolean"||u==null)return`${u}`;if(n=="string")return`"${u}"`;if(n=="symbol"){const p=u.description;return p==null?"Symbol":`Symbol(${p})`}if(n=="function"){const p=u.name;return typeof p=="string"&&p.length>0?`Function(${p})`:"Function"}if(Array.isArray(u)){const p=u.length;let v="[";p>0&&(v+=sd(u[0]));for(let S=1;S<p;S++)v+=", "+sd(u[S]);return v+="]",v}const l=/\[object ([^\]]+)\]/.exec(toString.call(u));let c;if(l.length>1)c=l[1];else return toString.call(u);if(c=="Object")try{return"Object("+JSON.stringify(u)+")"}catch{return"Object"}return u instanceof Error?`${u.name}: ${u.message}
${u.stack}`:c}function sy(u,n){const l=n(u.length*1,1)>>>0;return Ba().set(u,l/1),Dn=u.length,l}function ay(u,n){return u=u>>>0,cm().subarray(u/8,u/8+n)}function ly(u,n){return u=u>>>0,Ba().subarray(u/1,u/1+n)}function Jh(u,n){try{return u.apply(this,n)}catch(l){st.__wbindgen_exn_store(ir(l))}}class cy{__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,n}free(){const n=this.__destroy_into_raw();st.__wbg_ltn_free(n)}constructor(n,l){try{const I=st.__wbindgen_add_to_stack_pointer(-16),M=sy(n,st.__wbindgen_malloc),B=Dn;var c=za(l)?0:jo(l,st.__wbindgen_malloc,st.__wbindgen_realloc),p=Dn;st.ltn_new(I,M,B,c,p);var v=Lt()[I/4+0],S=Lt()[I/4+1],s=Lt()[I/4+2];if(s)throw kn(S);return this.__wbg_ptr=v>>>0,this}finally{st.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let n,l;try{const M=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_getInvertedBoundary(M,this.__wbg_ptr);var c=Lt()[M/4+0],p=Lt()[M/4+1],v=Lt()[M/4+2],S=Lt()[M/4+3],s=c,I=p;if(S)throw s=0,I=0,kn(v);return n=s,l=I,co(s,I)}finally{st.__wbindgen_add_to_stack_pointer(16),st.__wbindgen_free(n,l,1)}}getBounds(){try{const p=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_getBounds(p,this.__wbg_ptr);var n=Lt()[p/4+0],l=Lt()[p/4+1],c=ay(n,l).slice();return st.__wbindgen_free(n,l*8,8),c}finally{st.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const p=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_toRouteSnapper(p,this.__wbg_ptr);var n=Lt()[p/4+0],l=Lt()[p/4+1],c=ly(n,l).slice();return st.__wbindgen_free(n,l*1,1),c}finally{st.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let n,l;try{const M=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_toRouteSnapperGj(M,this.__wbg_ptr);var c=Lt()[M/4+0],p=Lt()[M/4+1],v=Lt()[M/4+2],S=Lt()[M/4+3],s=c,I=p;if(S)throw s=0,I=0,kn(v);return n=s,l=I,co(s,I)}finally{st.__wbindgen_add_to_stack_pointer(16),st.__wbindgen_free(n,l,1)}}renderModalFilters(){let n,l;try{const M=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_renderModalFilters(M,this.__wbg_ptr);var c=Lt()[M/4+0],p=Lt()[M/4+1],v=Lt()[M/4+2],S=Lt()[M/4+3],s=c,I=p;if(S)throw s=0,I=0,kn(v);return n=s,l=I,co(s,I)}finally{st.__wbindgen_add_to_stack_pointer(16),st.__wbindgen_free(n,l,1)}}renderNeighbourhood(){let n,l;try{const M=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_renderNeighbourhood(M,this.__wbg_ptr);var c=Lt()[M/4+0],p=Lt()[M/4+1],v=Lt()[M/4+2],S=Lt()[M/4+3],s=c,I=p;if(S)throw s=0,I=0,kn(v);return n=s,l=I,co(s,I)}finally{st.__wbindgen_add_to_stack_pointer(16),st.__wbindgen_free(n,l,1)}}setNeighbourhoodBoundary(n,l){try{const v=st.__wbindgen_add_to_stack_pointer(-16),S=jo(n,st.__wbindgen_malloc,st.__wbindgen_realloc),s=Dn;st.ltn_setNeighbourhoodBoundary(v,this.__wbg_ptr,S,s,ir(l));var c=Lt()[v/4+0],p=Lt()[v/4+1];if(p)throw kn(c)}finally{st.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(n){const l=jo(n,st.__wbindgen_malloc,st.__wbindgen_realloc),c=Dn;st.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,l,c)}setCurrentNeighbourhood(n){try{const p=st.__wbindgen_add_to_stack_pointer(-16),v=jo(n,st.__wbindgen_malloc,st.__wbindgen_realloc),S=Dn;st.ltn_setCurrentNeighbourhood(p,this.__wbg_ptr,v,S);var l=Lt()[p/4+0],c=Lt()[p/4+1];if(c)throw kn(l)}finally{st.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(n,l){try{const v=st.__wbindgen_add_to_stack_pointer(-16),S=jo(l,st.__wbindgen_malloc,st.__wbindgen_realloc),s=Dn;st.ltn_addModalFilter(v,this.__wbg_ptr,ir(n),S,s);var c=Lt()[v/4+0],p=Lt()[v/4+1];if(p)throw kn(c)}finally{st.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(n,l){try{const v=st.__wbindgen_add_to_stack_pointer(-16),S=jo(l,st.__wbindgen_malloc,st.__wbindgen_realloc),s=Dn;st.ltn_addManyModalFilters(v,this.__wbg_ptr,ir(n),S,s);var c=Lt()[v/4+0],p=Lt()[v/4+1];if(p)throw kn(c)}finally{st.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(n){st.ltn_deleteModalFilter(this.__wbg_ptr,n)}undo(){st.ltn_undo(this.__wbg_ptr)}redo(){st.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(n){let l,c;try{const B=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_getShortcutsCrossingRoad(B,this.__wbg_ptr,n);var p=Lt()[B/4+0],v=Lt()[B/4+1],S=Lt()[B/4+2],s=Lt()[B/4+3],I=p,M=v;if(s)throw I=0,M=0,kn(S);return l=I,c=M,co(I,M)}finally{st.__wbindgen_add_to_stack_pointer(16),st.__wbindgen_free(l,c,1)}}toSavefile(){let n,l;try{const M=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_toSavefile(M,this.__wbg_ptr);var c=Lt()[M/4+0],p=Lt()[M/4+1],v=Lt()[M/4+2],S=Lt()[M/4+3],s=c,I=p;if(S)throw s=0,I=0,kn(v);return n=s,l=I,co(s,I)}finally{st.__wbindgen_add_to_stack_pointer(16),st.__wbindgen_free(n,l,1)}}loadSavefile(n){try{const p=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_loadSavefile(p,this.__wbg_ptr,ir(n));var l=Lt()[p/4+0],c=Lt()[p/4+1];if(c)throw kn(l)}finally{st.__wbindgen_add_to_stack_pointer(16)}}compareRoute(n,l,c,p){let v,S;try{const ae=st.__wbindgen_add_to_stack_pointer(-16);st.ltn_compareRoute(ae,this.__wbg_ptr,n,l,c,p);var s=Lt()[ae/4+0],I=Lt()[ae/4+1],M=Lt()[ae/4+2],B=Lt()[ae/4+3],j=s,ie=I;if(B)throw j=0,ie=0,kn(M);return v=j,S=ie,co(j,ie)}finally{st.__wbindgen_add_to_stack_pointer(16),st.__wbindgen_free(v,S,1)}}}async function uy(u,n){if(typeof Response=="function"&&u instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(u,n)}catch(c){if(u.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const l=await u.arrayBuffer();return await WebAssembly.instantiate(l,n)}else{const l=await WebAssembly.instantiate(u,n);return l instanceof WebAssembly.Instance?{instance:l,module:u}:l}}function hy(){const u={};return u.wbg={},u.wbg.__wbindgen_object_drop_ref=function(n){kn(n)},u.wbg.__wbindgen_error_new=function(n,l){const c=new Error(co(n,l));return ir(c)},u.wbg.__wbindgen_string_get=function(n,l){const c=Ht(l),p=typeof c=="string"?c:void 0;var v=za(p)?0:jo(p,st.__wbindgen_malloc,st.__wbindgen_realloc),S=Dn;Lt()[n/4+1]=S,Lt()[n/4+0]=v},u.wbg.__wbindgen_string_new=function(n,l){const c=co(n,l);return ir(c)},u.wbg.__wbindgen_boolean_get=function(n){const l=Ht(n);return typeof l=="boolean"?l?1:0:2},u.wbg.__wbindgen_is_bigint=function(n){return typeof Ht(n)=="bigint"},u.wbg.__wbindgen_bigint_from_i64=function(n){return ir(n)},u.wbg.__wbindgen_jsval_eq=function(n,l){return Ht(n)===Ht(l)},u.wbg.__wbindgen_bigint_from_u64=function(n){const l=BigInt.asUintN(64,n);return ir(l)},u.wbg.__wbindgen_number_get=function(n,l){const c=Ht(l),p=typeof c=="number"?c:void 0;cm()[n/8+1]=za(p)?0:p,Lt()[n/4+0]=!za(p)},u.wbg.__wbindgen_is_object=function(n){const l=Ht(n);return typeof l=="object"&&l!==null},u.wbg.__wbindgen_in=function(n,l){return Ht(n)in Ht(l)},u.wbg.__wbindgen_is_undefined=function(n){return Ht(n)===void 0},u.wbg.__wbindgen_object_clone_ref=function(n){const l=Ht(n);return ir(l)},u.wbg.__wbindgen_jsval_loose_eq=function(n,l){return Ht(n)==Ht(l)},u.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(n,l){const c=Ht(n)[Ht(l)];return ir(c)},u.wbg.__wbg_debug_34c9290896ec9856=function(n){console.debug(Ht(n))},u.wbg.__wbg_error_e60eff06f24ab7a4=function(n){console.error(Ht(n))},u.wbg.__wbg_info_d7d58472d0bab115=function(n){console.info(Ht(n))},u.wbg.__wbg_log_a4530b4fe289336f=function(n){console.log(Ht(n))},u.wbg.__wbg_warn_f260f49434e45e62=function(n){console.warn(Ht(n))},u.wbg.__wbg_get_f01601b5a68d10e3=function(n,l){const c=Ht(n)[l>>>0];return ir(c)},u.wbg.__wbg_length_1009b1af0c481d7b=function(n){return Ht(n).length},u.wbg.__wbindgen_is_function=function(n){return typeof Ht(n)=="function"},u.wbg.__wbg_next_9b877f231f476d01=function(n){const l=Ht(n).next;return ir(l)},u.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Jh(function(n){const l=Ht(n).next();return ir(l)},arguments)},u.wbg.__wbg_done_5fe336b092d60cf2=function(n){return Ht(n).done},u.wbg.__wbg_value_0c248a78fdc8e19f=function(n){const l=Ht(n).value;return ir(l)},u.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ir(Symbol.iterator)},u.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Jh(function(n,l){const c=Reflect.get(Ht(n),Ht(l));return ir(c)},arguments)},u.wbg.__wbg_call_90c26b09837aba1c=function(){return Jh(function(n,l){const c=Ht(n).call(Ht(l));return ir(c)},arguments)},u.wbg.__wbg_isArray_74fb723e24f76012=function(n){return Array.isArray(Ht(n))},u.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(n){let l;try{l=Ht(n)instanceof ArrayBuffer}catch{l=!1}return l},u.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(n){return Number.isSafeInteger(Ht(n))},u.wbg.__wbg_entries_9e2e2aa45aa5094a=function(n){const l=Object.entries(Ht(n));return ir(l)},u.wbg.__wbg_buffer_a448f833075b71ba=function(n){const l=Ht(n).buffer;return ir(l)},u.wbg.__wbg_new_8f67e318f15d7254=function(n){const l=new Uint8Array(Ht(n));return ir(l)},u.wbg.__wbg_set_2357bf09366ee480=function(n,l,c){Ht(n).set(Ht(l),c>>>0)},u.wbg.__wbg_length_1d25fa9e4ac21ce7=function(n){return Ht(n).length},u.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(n){let l;try{l=Ht(n)instanceof Uint8Array}catch{l=!1}return l},u.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return ir(n)},u.wbg.__wbg_stack_658279fe44541cf6=function(n,l){const c=Ht(l).stack,p=jo(c,st.__wbindgen_malloc,st.__wbindgen_realloc),v=Dn;Lt()[n/4+1]=v,Lt()[n/4+0]=p},u.wbg.__wbg_error_f851667af71bcfc6=function(n,l){let c,p;try{c=n,p=l,console.error(co(n,l))}finally{st.__wbindgen_free(c,p,1)}},u.wbg.__wbindgen_bigint_get_as_i64=function(n,l){const c=Ht(l),p=typeof c=="bigint"?c:void 0;oy()[n/8+1]=za(p)?BigInt(0):p,Lt()[n/4+0]=!za(p)},u.wbg.__wbindgen_debug_string=function(n,l){const c=sd(Ht(l)),p=jo(c,st.__wbindgen_malloc,st.__wbindgen_realloc),v=Dn;Lt()[n/4+1]=v,Lt()[n/4+0]=p},u.wbg.__wbindgen_throw=function(n,l){throw new Error(co(n,l))},u.wbg.__wbindgen_memory=function(){const n=st.memory;return ir(n)},u}function dy(u,n){return st=u.exports,um.__wbindgen_wasm_module=n,Ql=null,Yl=null,Jl=null,Kl=null,st}async function um(u){if(st!==void 0)return st;typeof u>"u"&&(u="/ltn/assets/backend_bg.wasm");const n=hy();(typeof u=="string"||typeof Request=="function"&&u instanceof Request||typeof URL=="function"&&u instanceof URL)&&(u=fetch(u));const{instance:l,module:c}=await uy(await u,n);return dy(l,c)}let At;const hm=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&hm.decode();let ec=null;function oc(){return(ec===null||ec.byteLength===0)&&(ec=new Uint8Array(At.memory.buffer)),ec}function Zo(u,n){return u=u>>>0,hm.decode(oc().subarray(u,u+n))}const Go=new Array(128).fill(void 0);Go.push(void 0,null,!0,!1);let sc=Go.length;function Ir(u){sc===Go.length&&Go.push(Go.length+1);const n=sc;return sc=Go[n],Go[n]=u,n}function oi(u){return Go[u]}function fy(u){u<132||(Go[u]=sc,sc=u)}function Eu(u){const n=oi(u);return fy(u),n}function Yh(u){return u==null}let tc=null;function py(){return(tc===null||tc.byteLength===0)&&(tc=new Float64Array(At.memory.buffer)),tc}let ic=null;function Ni(){return(ic===null||ic.byteLength===0)&&(ic=new Int32Array(At.memory.buffer)),ic}let fs=0;const Pu=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},my=typeof Pu.encodeInto=="function"?function(u,n){return Pu.encodeInto(u,n)}:function(u,n){const l=Pu.encode(u);return n.set(l),{read:u.length,written:l.length}};function Iu(u,n,l){if(l===void 0){const s=Pu.encode(u),I=n(s.length,1)>>>0;return oc().subarray(I,I+s.length).set(s),fs=s.length,I}let c=u.length,p=n(c,1)>>>0;const v=oc();let S=0;for(;S<c;S++){const s=u.charCodeAt(S);if(s>127)break;v[p+S]=s}if(S!==c){S!==0&&(u=u.slice(S)),p=l(p,c,c=S+u.length*3,1)>>>0;const s=oc().subarray(p+S,p+c),I=my(u,s);S+=I.written}return fs=S,p}function ad(u){const n=typeof u;if(n=="number"||n=="boolean"||u==null)return`${u}`;if(n=="string")return`"${u}"`;if(n=="symbol"){const p=u.description;return p==null?"Symbol":`Symbol(${p})`}if(n=="function"){const p=u.name;return typeof p=="string"&&p.length>0?`Function(${p})`:"Function"}if(Array.isArray(u)){const p=u.length;let v="[";p>0&&(v+=ad(u[0]));for(let S=1;S<p;S++)v+=", "+ad(u[S]);return v+="]",v}const l=/\[object ([^\]]+)\]/.exec(toString.call(u));let c;if(l.length>1)c=l[1];else return toString.call(u);if(c=="Object")try{return"Object("+JSON.stringify(u)+")"}catch{return"Object"}return u instanceof Error?`${u.name}: ${u.message}
${u.stack}`:c}function _y(u,n){const l=n(u.length*1,1)>>>0;return oc().set(u,l/1),fs=u.length,l}function Qh(u,n){try{return u.apply(this,n)}catch(l){At.__wbindgen_exn_store(Ir(l))}}class Lu{static __wrap(n){n=n>>>0;const l=Object.create(Lu.prototype);return l.__wbg_ptr=n,l}__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,n}free(){const n=this.__destroy_into_raw();At.__wbg_jsroutesnapper_free(n)}constructor(n){try{const v=At.__wbindgen_add_to_stack_pointer(-16),S=_y(n,At.__wbindgen_malloc),s=fs;At.jsroutesnapper_new(v,S,s);var l=Ni()[v/4+0],c=Ni()[v/4+1],p=Ni()[v/4+2];if(p)throw Eu(c);return Lu.__wrap(l)}finally{At.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(n){At.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Ir(n))}setAreaMode(){At.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let n,l;try{const v=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_getConfig(v,this.__wbg_ptr);var c=Ni()[v/4+0],p=Ni()[v/4+1];return n=c,l=p,Zo(c,p)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(n,l,1)}}toFinalFeature(){try{const c=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_toFinalFeature(c,this.__wbg_ptr);var n=Ni()[c/4+0],l=Ni()[c/4+1];let p;return n!==0&&(p=Zo(n,l).slice(),At.__wbindgen_free(n,l*1)),p}finally{At.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let n,l;try{const v=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_renderGeojson(v,this.__wbg_ptr);var c=Ni()[v/4+0],p=Ni()[v/4+1];return n=c,l=p,Zo(c,p)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(n,l,1)}}toggleSnapMode(){At.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(n,l,c){return At.jsroutesnapper_onMouseMove(this.__wbg_ptr,n,l,c)!==0}onClick(){At.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return At.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return At.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){At.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(n){try{const p=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_editExisting(p,this.__wbg_ptr,Ir(n));var l=Ni()[p/4+0],c=Ni()[p/4+1];if(c)throw Eu(l)}finally{At.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let n,l;try{const v=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_debugRenderGraph(v,this.__wbg_ptr);var c=Ni()[v/4+0],p=Ni()[v/4+1];return n=c,l=p,Zo(c,p)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(n,l,1)}}routeNameForWaypoints(n){let l,c;try{const B=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_routeNameForWaypoints(B,this.__wbg_ptr,Ir(n));var p=Ni()[B/4+0],v=Ni()[B/4+1],S=Ni()[B/4+2],s=Ni()[B/4+3],I=p,M=v;if(s)throw I=0,M=0,Eu(S);return l=I,c=M,Zo(I,M)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(l,c,1)}}addSnappedWaypoint(n,l){At.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,n,l)}undo(){At.jsroutesnapper_undo(this.__wbg_ptr)}}async function gy(u,n){if(typeof Response=="function"&&u instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(u,n)}catch(c){if(u.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const l=await u.arrayBuffer();return await WebAssembly.instantiate(l,n)}else{const l=await WebAssembly.instantiate(u,n);return l instanceof WebAssembly.Instance?{instance:l,module:u}:l}}function yy(){const u={};return u.wbg={},u.wbg.__wbindgen_string_new=function(n,l){const c=Zo(n,l);return Ir(c)},u.wbg.__wbindgen_object_drop_ref=function(n){Eu(n)},u.wbg.__wbindgen_error_new=function(n,l){const c=new Error(Zo(n,l));return Ir(c)},u.wbg.__wbindgen_is_object=function(n){const l=oi(n);return typeof l=="object"&&l!==null},u.wbg.__wbindgen_is_undefined=function(n){return oi(n)===void 0},u.wbg.__wbindgen_in=function(n,l){return oi(n)in oi(l)},u.wbg.__wbindgen_number_get=function(n,l){const c=oi(l),p=typeof c=="number"?c:void 0;py()[n/8+1]=Yh(p)?0:p,Ni()[n/4+0]=!Yh(p)},u.wbg.__wbindgen_boolean_get=function(n){const l=oi(n);return typeof l=="boolean"?l?1:0:2},u.wbg.__wbindgen_object_clone_ref=function(n){const l=oi(n);return Ir(l)},u.wbg.__wbindgen_jsval_loose_eq=function(n,l){return oi(n)==oi(l)},u.wbg.__wbindgen_string_get=function(n,l){const c=oi(l),p=typeof c=="string"?c:void 0;var v=Yh(p)?0:Iu(p,At.__wbindgen_malloc,At.__wbindgen_realloc),S=fs;Ni()[n/4+1]=S,Ni()[n/4+0]=v},u.wbg.__wbg_String_4370c5505c674d30=function(n,l){const c=String(oi(l)),p=Iu(c,At.__wbindgen_malloc,At.__wbindgen_realloc),v=fs;Ni()[n/4+1]=v,Ni()[n/4+0]=p},u.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(n,l){const c=oi(n)[oi(l)];return Ir(c)},u.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return Ir(n)},u.wbg.__wbg_stack_658279fe44541cf6=function(n,l){const c=oi(l).stack,p=Iu(c,At.__wbindgen_malloc,At.__wbindgen_realloc),v=fs;Ni()[n/4+1]=v,Ni()[n/4+0]=p},u.wbg.__wbg_error_f851667af71bcfc6=function(n,l){let c,p;try{c=n,p=l,console.error(Zo(n,l))}finally{At.__wbindgen_free(c,p,1)}},u.wbg.__wbg_debug_9a6b3243fbbebb61=function(n){console.debug(oi(n))},u.wbg.__wbg_error_788ae33f81d3b84b=function(n){console.error(oi(n))},u.wbg.__wbg_info_2e30e8204b29d91d=function(n){console.info(oi(n))},u.wbg.__wbg_log_1d3ae0273d8f4f8a=function(n){console.log(oi(n))},u.wbg.__wbg_warn_d60e832f9882c1b2=function(n){console.warn(oi(n))},u.wbg.__wbg_get_44be0491f933a435=function(n,l){const c=oi(n)[l>>>0];return Ir(c)},u.wbg.__wbg_length_fff51ee6522a1a18=function(n){return oi(n).length},u.wbg.__wbindgen_is_function=function(n){return typeof oi(n)=="function"},u.wbg.__wbg_next_526fc47e980da008=function(n){const l=oi(n).next;return Ir(l)},u.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Qh(function(n){const l=oi(n).next();return Ir(l)},arguments)},u.wbg.__wbg_done_5c1f01fb660d73b5=function(n){return oi(n).done},u.wbg.__wbg_value_1695675138684bd5=function(n){const l=oi(n).value;return Ir(l)},u.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Ir(Symbol.iterator)},u.wbg.__wbg_get_97b561fb56f034b5=function(){return Qh(function(n,l){const c=Reflect.get(oi(n),oi(l));return Ir(c)},arguments)},u.wbg.__wbg_call_cb65541d95d71282=function(){return Qh(function(n,l){const c=oi(n).call(oi(l));return Ir(c)},arguments)},u.wbg.__wbg_isArray_4c24b343cb13cfb1=function(n){return Array.isArray(oi(n))},u.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(n){let l;try{l=oi(n)instanceof ArrayBuffer}catch{l=!1}return l},u.wbg.__wbg_buffer_085ec1f694018c4f=function(n){const l=oi(n).buffer;return Ir(l)},u.wbg.__wbg_new_8125e318e6245eed=function(n){const l=new Uint8Array(oi(n));return Ir(l)},u.wbg.__wbg_set_5cf90238115182c3=function(n,l,c){oi(n).set(oi(l),c>>>0)},u.wbg.__wbg_length_72e2208bbc0efc61=function(n){return oi(n).length},u.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(n){let l;try{l=oi(n)instanceof Uint8Array}catch{l=!1}return l},u.wbg.__wbindgen_debug_string=function(n,l){const c=ad(oi(l)),p=Iu(c,At.__wbindgen_malloc,At.__wbindgen_realloc),v=fs;Ni()[n/4+1]=v,Ni()[n/4+0]=p},u.wbg.__wbindgen_throw=function(n,l){throw new Error(Zo(n,l))},u.wbg.__wbindgen_memory=function(){const n=At.memory;return Ir(n)},u}function vy(u,n){return At=u.exports,dm.__wbindgen_wasm_module=n,tc=null,ic=null,ec=null,At}async function dm(u){if(At!==void 0)return At;typeof u>"u"&&(u="/ltn/assets/route_snapper_bg.wasm");const n=yy();(typeof u=="string"||typeof Request=="function"&&u instanceof Request||typeof URL=="function"&&u instanceof URL)&&(u=fetch(u));const{instance:l,module:c}=await gy(await u,n);return vy(l,c)}const Aa=[];function ed(u,n){return{subscribe:Wi(u,n).subscribe}}function Wi(u,n=Dt){let l;const c=new Set;function p(s){if(ti(u,s)&&(u=s,l)){const I=!Aa.length;for(const M of c)M[1](),Aa.push(M,u);if(I){for(let M=0;M<Aa.length;M+=2)Aa[M][0](Aa[M+1]);Aa.length=0}}}function v(s){p(s(u))}function S(s,I=Dt){const M=[s,I];return c.add(M),c.size===1&&(l=n(p,v)||Dt),s(u),()=>{c.delete(M),c.size===0&&l&&(l(),l=null)}}return{set:p,update:v,subscribe:S}}let by=Date.now();function Oa(u){return`${u}-${by++}`}const _d=Symbol.for("svelte-maplibre");function Na(){return Jg(_d)}function xy(u){let n=new WeakMap;return l=>{var S;let c=n.get(l.originalEvent);if(c!==void 0)return c;let v=(S=l.target.queryRenderedFeatures(l.point).find(s=>{var I;return(I=u.get(s.layer.id))==null?void 0:I.interactive}))==null?void 0:S.layer.id;return n.set(l.originalEvent,v),v}}function wy(){let u=new Map;return nm(_d,{map:Wi(null),source:ed(null),layer:ed(null),popupTarget:ed(null),cluster:Wi(),loadedImages:Wi(new Set),minzoom:Wi(0),maxzoom:Wi(24),layerEvent:Wi(null),layerInfo:u,eventTopMost:xy(u)})}function dp(u){return{subscribe:u.subscribe}}function gd({key:u,setPopupTarget:n=!1,setCluster:l=!1,setMouseEvent:c=!1}){let p=Na(),v=Wi(null),S=dp(v),s={...p,[u]:dp(v)};if(n&&(s.popupTarget=S),c){let I=Wi(null);s.layerEvent=I,p.layerEvent=I}return l&&(s.cluster=Wi()),nm(_d,s),{...p,self:v}}function Sy(){return gd({key:"source",setCluster:!0})}function Ty(u=!0){return gd({key:"layer",setPopupTarget:u,setMouseEvent:u})}function ky(){return gd({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function Iy(u){return"layerType"in u&&u.layerType==="deckgl"}var fm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pm(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}function mm(u){if(u.__esModule)return u;var n=u.default;if(typeof n=="function"){var l=function c(){return this instanceof c?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};l.prototype=n.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(u).forEach(function(c){var p=Object.getOwnPropertyDescriptor(u,c);Object.defineProperty(l,c,p.get?p:{enumerable:!0,get:function(){return u[c]}})}),l}var _m={exports:{}};(function(u,n){(function(l,c){u.exports=c()})(fm,function(){var l,c,p;function v(s,I){if(!l)l=I;else if(!c)c=I;else{var M="var sharedChunk = {}; ("+l+")(sharedChunk); ("+c+")(sharedChunk);",B={};l(B),p=I(B),typeof window<"u"&&(p.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}v(["exports"],function(s){function I(i,e,r,a){return new(r||(r=Promise))(function(d,_){function y(C){try{T(a.next(C))}catch(E){_(E)}}function b(C){try{T(a.throw(C))}catch(E){_(E)}}function T(C){var E;C.done?d(C.value):(E=C.value,E instanceof r?E:new r(function(L){L(E)})).then(y,b)}T((a=a.apply(i,e||[])).next())})}function M(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var B=j;function j(i,e){this.x=i,this.y=e}j.prototype={clone:function(){return new j(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),d=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},j.convert=function(i){return i instanceof j?i:Array.isArray(i)?new j(i[0],i[1]):i};var ie=M(B),ae=ce;function ce(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}ce.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var d=this.sampleCurveX(r)-i;if(Math.abs(d)<e)return r;var _=this.sampleCurveDerivativeX(r);if(Math.abs(_)<1e-6)break;r-=d/_}var y=0,b=1;for(r=i,a=0;a<20&&(d=this.sampleCurveX(r),!(Math.abs(d-i)<e));a++)i>d?y=r:b=r,r=.5*(b-y)+y;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var ge=M(ae);let ve,Ee;function W(){return ve==null&&(ve=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ve}function ne(){if(Ee==null&&(Ee=!1,W())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const d=4*a;e.fillStyle=`rgb(${d},${d+1},${d+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){Ee=!0;break}}}return Ee||!1}function re(i,e,r,a){const d=new ge(i,e,r,a);return function(_){return d.solve(_)}}const _e=re(.25,.1,.25,1);function ze(i,e,r){return Math.min(r,Math.max(e,i))}function Ce(i,e,r){const a=r-e,d=((i-e)%a+a)%a+e;return d===e?r:d}function Ae(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let Ue=1;function je(i,e,r){const a={};for(const d in i)a[d]=e.call(r||this,i[d],d,i);return a}function we(i,e,r){const a={};for(const d in i)e.call(r||this,i[d],d,i)&&(a[d]=i[d]);return a}function Te(i){return Array.isArray(i)?i.map(Te):typeof i=="object"&&i?je(i,Te):i}const xt={};function bt(i){xt[i]||(typeof console<"u"&&console.warn(i),xt[i]=!0)}function it(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function dt(i){let e=0;for(let r,a,d=0,_=i.length,y=_-1;d<_;y=d++)r=i[d],a=i[y],e+=(a.x-r.x)*(r.y+a.y);return e}function Pt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ut=null;function kt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const yi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function $t(i,e,r,a,d){return I(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const y=_==null?void 0:_.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const b=y.startsWith("BGR"),T=new Uint8ClampedArray(a*d*4);if(yield _.copyTo(T,function(C,E,L,F,N){const V=4*Math.max(-E,0),Z=(Math.max(0,L)-L)*F*4+V,J=4*F,ee=Math.max(0,E),de=Math.max(0,L);return{rect:{x:ee,y:de,width:Math.min(C.width,E+F)-ee,height:Math.min(C.height,L+N)-de},layout:[{offset:Z,stride:J}]}}(i,e,r,a,d)),b)for(let C=0;C<T.length;C+=4){const E=T[C];T[C]=T[C+2],T[C+2]=E}return T}finally{_.close()}})}let Vt,Xt,hi,ar;const Ti={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(hi||(hi=document.createElement("a")),hi.href=i,hi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ar==null&&(ar=matchMedia("(prefers-reduced-motion: reduce)")),ar.matches)}},Je={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class qe extends Error{constructor(e,r,a,d){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=d}}const Ut=Pt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,jt=i=>Je.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function ki(i,e){const r=new AbortController,a=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Ut(),signal:r.signal});let d=!1,_=!1;return i.type==="json"&&a.headers.set("Accept","application/json"),_||fetch(a).then(y=>y.ok?(b=>{(i.type==="arrayBuffer"||i.type==="image"?b.arrayBuffer():i.type==="json"?b.json():b.text()).then(T=>{_||(d=!0,e(null,T,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(T=>{_||e(new Error(T.message))})})(y):y.blob().then(b=>e(new qe(y.status,y.statusText,i.url,b)))).catch(y=>{y.code!==20&&e(new Error(y.message))}),{cancel:()=>{_=!0,d||r.abort()}}}const Hi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Pt())return(jt(i.url)||ki)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Ut())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ki(i,e);if(Pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,d){const _=new XMLHttpRequest;_.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(_.responseType="arraybuffer");for(const y in a.headers)_.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=a.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let y=_.response;if(a.type==="json")try{y=JSON.parse(_.response)}catch(b){return d(b)}d(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const y=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});d(new qe(_.status,_.statusText,a.url,y))}},_.send(a.body),{cancel:()=>_.abort()}}(i,e)},Xe=function(i,e){return Hi(Ae(i,{type:"arrayBuffer"}),e)};function Ii(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function $i(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function rn(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class Mn{constructor(e,r={}){Ae(this,r),this.type=e}}class Lr extends Mn{constructor(e,r={}){super("error",Ae({error:e},r))}}class _r{on(e,r){return this._listeners=this._listeners||{},$i(e,r,this._listeners),this}off(e,r){return rn(e,r,this._listeners),rn(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},$i(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Mn(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const d=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const b of d)b.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const b of _)rn(a,b,this._oneTimeListeners),b.call(this,e);const y=this._eventedParent;y&&(Ae(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Lr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const br=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Dr(i,e){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return br.forEach(a=>{a in e&&(r[a]=e[a])}),r}function di(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!di(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!di(i[r],e[r]))return!1;return!0}return i===e}const qt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function nn(i,e,r){r.push({command:qt.addSource,args:[i,e[i]]})}function Cn(i,e,r){e.push({command:qt.removeSource,args:[i]}),r[i]=!0}function rr(i,e,r,a){Cn(i,r,a),nn(i,e,r)}function Ui(i,e,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!di(i[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!di(i[r][a],e[r][a]))return!1;return!0}function si(i,e,r,a,d,_){let y;for(y in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,y)&&(di(i[y],e[y])||r.push({command:_,args:[a,y,e[y],d]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(di(i[y],e[y])||r.push({command:_,args:[a,y,e[y],d]}))}function ji(i){return i.id}function So(i,e){return i[e.id]=e,i}class Qe{constructor(e,r,a,d){this.message=(e?`${e}: `:"")+a,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function Rn(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}class qi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class To{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,d]of r)this.bindings[a]=d}concat(e){return new To(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Jn={kind:"null"},rt={kind:"number"},Wt={kind:"string"},Bt={kind:"boolean"},Br={kind:"color"},On={kind:"object"},Nt={kind:"value"},Yn={kind:"collator"},H={kind:"formatted"},D={kind:"padding"},R={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function K(i,e){return{kind:"array",itemType:i,N:e}}function Y(i){if(i.kind==="array"){const e=Y(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const pe=[Jn,rt,Wt,Bt,Br,H,On,K(Nt),D,R,U];function se(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!se(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of pe)if(!se(r,e))return null}}return`Expected ${Y(i)} but found ${Y(e)} instead.`}function te(i,e){return e.some(r=>r.kind===i.kind)}function he(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Le(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Fe=.96422,Ne=.82521,St=4/29,zt=6/29,pt=3*zt*zt,It=zt*zt*zt,Ft=Math.PI/180,_i=180/Math.PI;function xi(i){return(i%=360)<0&&(i+=360),i}function ui([i,e,r,a]){let d,_;const y=Mr((.2225045*(i=ai(i))+.7168786*(e=ai(e))+.0606169*(r=ai(r)))/1);i===e&&e===r?d=_=y:(d=Mr((.4360747*i+.3850649*e+.1430804*r)/Fe),_=Mr((.0139322*i+.0971045*e+.7141733*r)/Ne));const b=116*y-16;return[b<0?0:b,500*(d-y),200*(y-_),a]}function ai(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Mr(i){return i>It?Math.pow(i,1/3):i/pt+St}function Mi([i,e,r,a]){let d=(i+16)/116,_=isNaN(e)?d:d+e/500,y=isNaN(r)?d:d-r/200;return d=1*xr(d),_=Fe*xr(_),y=Ne*xr(y),[nr(3.1338561*_-1.6168667*d-.4906146*y),nr(-.9787684*_+1.9161415*d+.033454*y),nr(.0719453*_-.2289914*d+1.4052427*y),a]}function nr(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function xr(i){return i>zt?i*i*i:pt*(i-St)}function gn(i){return parseInt(i.padEnd(2,i),16)/255}function yc(i,e){return Wo(e?i/100:i,0,1)}function Wo(i,e,r){return Math.min(Math.max(e,i),r)}function Ho(i){return!i.some(Number.isNaN)}const qu={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class vi{constructor(e,r,a,d=1,_=!0){this.r=e,this.g=r,this.b=a,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,r,a,d]))}static parse(e){if(e instanceof vi)return e;if(typeof e!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=qu[a];if(d){const[y,b,T]=d;return[y/255,b/255,T/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let b=1;return[gn(a.slice(b,b+=y)),gn(a.slice(b,b+=y)),gn(a.slice(b,b+=y)),gn(a.slice(b,b+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[b,T,C,E,L,F,N,V,Z,J,ee,de]=y,oe=[E||" ",N||" ",J].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const me=[C,F,Z].join(""),Se=me==="%%%"?100:me===""?255:0;if(Se){const Oe=[Wo(+T/Se,0,1),Wo(+L/Se,0,1),Wo(+V/Se,0,1),ee?yc(+ee,de):1];if(Ho(Oe))return Oe}}return}}const _=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[y,b,T,C,E,L,F,N,V]=_,Z=[T||" ",E||" ",F].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const J=[+b,Wo(+C,0,100),Wo(+L,0,100),N?yc(+N,V):1];if(Ho(J))return function([ee,de,oe,me]){function Se(Oe){const ct=(Oe+ee/30)%12,_t=de*Math.min(oe,1-oe);return oe-_t*Math.max(-1,Math.min(ct-3,9-ct,1))}return ee=xi(ee),de/=100,oe/=100,[Se(0),Se(8),Se(4),me]}(J)}}}(e);return r?new vi(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[e/_,r/_,a/_,d])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,a,d,_]=ui(e),y=Math.sqrt(a*a+d*d);return[Math.round(1e4*y)?xi(Math.atan2(d,a)*_i):NaN,y,r,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ui(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,d]=this.rgb;return`rgba(${[e,r,a].map(_=>Math.round(255*_)).join(",")},${d})`}}vi.black=new vi(0,0,0,1),vi.white=new vi(1,1,1,1),vi.transparent=new vi(0,0,0,0),vi.red=new vi(1,0,0,1);class ja{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qs{constructor(e,r,a,d,_){this.text=e,this.image=r,this.scale=a,this.fontStack=d,this.textColor=_}}class Cr{constructor(e){this.sections=e}static fromString(e){return new Cr([new qs(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Cr?e:Cr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class on{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof on)return e;if(typeof e=="number")return new on([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new on(e)}}toString(){return JSON.stringify(this.values)}}const Zu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class yn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof yn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],d=e[r+1];if(typeof a!="string"||!Zu.has(a)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new yn(e)}}toString(){return JSON.stringify(this.values)}}class wr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new wr({name:e,available:!1}):null}}function Zs(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $o(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof vi||i instanceof ja||i instanceof Cr||i instanceof on||i instanceof yn||i instanceof wr)return!0;if(Array.isArray(i)){for(const e of i)if(!$o(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!$o(i[e]))return!1;return!0}return!1}function Bi(i){if(i===null)return Jn;if(typeof i=="string")return Wt;if(typeof i=="boolean")return Bt;if(typeof i=="number")return rt;if(i instanceof vi)return Br;if(i instanceof ja)return Yn;if(i instanceof Cr)return H;if(i instanceof on)return D;if(i instanceof yn)return U;if(i instanceof wr)return R;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const d=Bi(a);if(r){if(r===d)continue;r=Nt;break}r=d}return K(r||Nt,e)}return On}function fi(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof vi||i instanceof Cr||i instanceof on||i instanceof yn||i instanceof wr?i.toString():JSON.stringify(i)}class ko{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!$o(e[1]))return r.error("invalid value");const a=e[1];let d=Bi(a);const _=r.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new ko(d,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Zi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Gs={string:Wt,number:rt,boolean:Bt,object:On};class vn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,d=1;const _=e[0];if(_==="array"){let b,T;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Gs)||C==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);b=Gs[C],d++}else b=Nt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=e[2],d++}a=K(b,T)}else{if(!Gs[_])throw new Error(`Types doesn't contain name = ${_}`);a=Gs[_]}const y=[];for(;d<e.length;d++){const b=r.parse(e[d],d,Nt);if(!b)return null;y.push(b)}return new vn(a,y)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!se(this.type,Bi(a)))return a;if(r===this.args.length-1)throw new Zi(`Expected value to be of type ${Y(this.type)}, but found ${Y(Bi(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const qa={"to-boolean":Bt,"to-color":Br,"to-number":rt,"to-string":Wt};class uo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!qa[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const d=qa[a],_=[];for(let y=1;y<e.length;y++){const b=r.parse(e[y],y,Nt);if(!b)return null;_.push(b)}return new uo(d,_)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const d of this.args){if(r=d.evaluate(e),a=null,r instanceof vi)return r;if(typeof r=="string"){const _=e.parseColor(r);if(_)return _}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Zs(r[0],r[1],r[2],r[3]),!a))return new vi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Zi(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const d=on.parse(r);if(d)return d}throw new Zi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const d=yn.parse(r);if(d)return d}throw new Zi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new Zi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Cr.fromString(fi(this.args[0].evaluate(e)));case"resolvedImage":return wr.fromString(fi(this.args[0].evaluate(e)));default:return fi(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const vc=["Unknown","Point","LineString","Polygon"];class Za{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=vi.parse(e)),r}}class Xs{constructor(e,r,a=[],d,_=new To,y=[]){this.registry=e,this.path=a,this.key=a.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=y,this.expectedType=d,this._isConstant=r}parse(e,r,a,d,_={}){return r?this.concat(r,a,d)._parse(e,_):this._parse(e,_)}_parse(e,r){function a(d,_,y){return y==="assert"?new vn(_,[d]):y==="coerce"?new uo(_,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let y=_.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,T=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(b.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(b,T))return null}else y=a(y,b,r.typeAnnotation||"coerce");else y=a(y,b,r.typeAnnotation||"coerce");else y=a(y,b,r.typeAnnotation||"coerce");else y=a(y,b,r.typeAnnotation||"assert")}if(!(y instanceof ko)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const b=new Za;try{y=new ko(y.type,y.evaluate(b))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const d=typeof e=="number"?this.path.concat(e):this.path,_=a?this.scope.concat(a):this.scope;return new Xs(this.registry,this._isConstant,d,r||null,_,this.errors)}error(e,...r){const a=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new qi(a,e))}checkSubtype(e,r){const a=se(e,r);return a&&this.error(a),a}}class Ws{constructor(e,r,a){this.type=Yn,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const d=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Bt);if(!d)return null;const _=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Bt);if(!_)return null;let y=null;return a.locale&&(y=r.parse(a.locale,1,Wt),!y)?null:new Ws(d,_,y)}evaluate(e){return new ja(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const ho=8192;function Ga(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ys(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function bc(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(r*d*ho),Math.round(a*d*ho)]}function Gu(i,e,r){const a=i[0]-e[0],d=i[1]-e[1],_=i[0]-r[0],y=i[1]-r[1];return a*y-_*d==0&&a*_<=0&&d*y<=0}function Xa(i,e){let r=!1;for(let y=0,b=e.length;y<b;y++){const T=e[y];for(let C=0,E=T.length;C<E-1;C++){if(Gu(i,T[C],T[C+1]))return!1;(d=T[C])[1]>(a=i)[1]!=(_=T[C+1])[1]>a[1]&&a[0]<(_[0]-d[0])*(a[1]-d[1])/(_[1]-d[1])+d[0]&&(r=!r)}}var a,d,_;return r}function Wa(i,e){for(let r=0;r<e.length;r++)if(Xa(i,e[r]))return!0;return!1}function xc(i,e,r,a){const d=a[0]-r[0],_=a[1]-r[1],y=(i[0]-r[0])*_-d*(i[1]-r[1]),b=(e[0]-r[0])*_-d*(e[1]-r[1]);return y>0&&b<0||y<0&&b>0}function Xu(i,e,r){for(const C of r)for(let E=0;E<C.length-1;++E)if((b=[(y=C[E+1])[0]-(_=C[E])[0],y[1]-_[1]])[0]*(T=[(d=e)[0]-(a=i)[0],d[1]-a[1]])[1]-b[1]*T[0]!=0&&xc(a,d,_,y)&&xc(_,y,a,d))return!0;var a,d,_,y,b,T;return!1}function wc(i,e){for(let r=0;r<i.length;++r)if(!Xa(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Xu(i[r],i[r+1],e))return!1;return!0}function Sc(i,e){for(let r=0;r<e.length;r++)if(wc(i,e[r]))return!0;return!1}function Hs(i,e,r){const a=[];for(let d=0;d<i.length;d++){const _=[];for(let y=0;y<i[d].length;y++){const b=bc(i[d][y],r);Ga(e,b),_.push(b)}a.push(_)}return a}function Tc(i,e,r){const a=[];for(let d=0;d<i.length;d++){const _=Hs(i[d],e,r);a.push(_)}return a}function kc(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const d=.5*a;let _=i[0]-r[0]>d?-a:r[0]-i[0]>d?a:0;_===0&&(_=i[0]-r[2]>d?-a:r[2]-i[0]>d?a:0),i[0]+=_}Ga(e,i)}function Ha(i,e,r,a){const d=Math.pow(2,a.z)*ho,_=[a.x*ho,a.y*ho],y=[];for(const b of i)for(const T of b){const C=[T.x+_[0],T.y+_[1]];kc(C,e,r,d),y.push(C)}return y}function $a(i,e,r,a){const d=Math.pow(2,a.z)*ho,_=[a.x*ho,a.y*ho],y=[];for(const T of i){const C=[];for(const E of T){const L=[E.x+_[0],E.y+_[1]];Ga(e,L),C.push(L)}y.push(C)}if(e[2]-e[0]<=d/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of y)for(const C of T)kc(C,e,r,d)}var b;return y}class Io{constructor(e,r){this.type=Bt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if($o(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let d=0;d<a.features.length;++d){const _=a.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Io(a,a.features[d].geometry)}else if(a.type==="Feature"){const d=a.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Io(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Io(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const b=Hs(a.coordinates,_,y),T=Ha(r.geometry(),d,_,y);if(!ys(d,_))return!1;for(const C of T)if(!Xa(C,b))return!1}if(a.type==="MultiPolygon"){const b=Tc(a.coordinates,_,y),T=Ha(r.geometry(),d,_,y);if(!ys(d,_))return!1;for(const C of T)if(!Wa(C,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const b=Hs(a.coordinates,_,y),T=$a(r.geometry(),d,_,y);if(!ys(d,_))return!1;for(const C of T)if(!wc(C,b))return!1}if(a.type==="MultiPolygon"){const b=Tc(a.coordinates,_,y),T=$a(r.geometry(),d,_,y);if(!ys(d,_))return!1;for(const C of T)if(!Sc(C,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $s{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new $s(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class bn{constructor(e,r,a,d){this.name=e,this.type=r,this._evaluate=a,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],d=bn.definitions[a];if(!d)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=y.filter(([C])=>!Array.isArray(C)||C.length===e.length-1);let T=null;for(const[C,E]of b){T=new Xs(r.registry,Ks,r.path,null,r.scope);const L=[];let F=!1;for(let N=1;N<e.length;N++){const V=e[N],Z=Array.isArray(C)?C[N-1]:C.type,J=T.parse(V,1+L.length,Z);if(!J){F=!0;break}L.push(J)}if(!F)if(Array.isArray(C)&&C.length!==L.length)T.error(`Expected ${C.length} arguments, but found ${L.length} instead.`);else{for(let N=0;N<L.length;N++){const V=Array.isArray(C)?C[N]:C.type,Z=L[N];T.concat(N+1).checkSubtype(V,Z.type)}if(T.errors.length===0)return new bn(a,_,E,L)}}if(b.length===1)r.errors.push(...T.errors);else{const C=(b.length?b:y).map(([L])=>{return F=L,Array.isArray(F)?`(${F.map(Y).join(", ")})`:`(${Y(F.type)}...)`;var F}).join(" | "),E=[];for(let L=1;L<e.length;L++){const F=r.parse(e[L],1+E.length);if(!F)return null;E.push(Y(F.type))}r.error(`Expected arguments of type ${C}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){bn.definitions=r;for(const a in r)e[a]=bn}}function Ks(i){if(i instanceof $s)return Ks(i.boundExpression);if(i instanceof bn&&i.name==="error"||i instanceof Ws||i instanceof Io)return!1;const e=i instanceof uo||i instanceof vn;let r=!0;return i.eachChild(a=>{r=e?r&&Ks(a):r&&a instanceof ko}),!!r&&Js(i)&&Ys(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Js(i){if(i instanceof bn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Io)return!1;let e=!0;return i.eachChild(r=>{e&&!Js(r)&&(e=!1)}),e}function vs(i){if(i instanceof bn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!vs(r)&&(e=!1)}),e}function Ys(i,e){if(i instanceof bn&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Ys(a,e)&&(r=!1)}),r}function Ko(i,e){const r=i.length-1;let a,d,_=0,y=r,b=0;for(;_<=y;)if(b=Math.floor((_+y)/2),a=i[b],d=i[b+1],a<=e){if(b===r||e<d)return b;_=b+1}else{if(!(a>e))throw new Zi("Input is not a number.");y=b-1}return 0}class fo{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[d,_]of a)this.labels.push(d),this.outputs.push(_)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,rt);if(!a)return null;const d=[];let _=null;r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let y=1;y<e.length;y+=2){const b=y===1?-1/0:e[y],T=e[y+1],C=y,E=y+1;if(typeof b!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(d.length&&d[d.length-1][0]>=b)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const L=r.parse(T,E,_);if(!L)return null;_=_||L.type,d.push([b,L])}return new fo(_,a,d)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);const _=r.length;return d>=r[_-1]?a[_-1].evaluate(e):a[Ko(r,d)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ri(i,e,r){return i+r*(e-i)}function Qs(i,e,r){return i.map((a,d)=>ri(a,e[d],r))}const sn={number:ri,color:function(i,e,r,a="rgb"){switch(a){case"rgb":{const[d,_,y,b]=Qs(i.rgb,e.rgb,r);return new vi(d,_,y,b,!1)}case"hcl":{const[d,_,y,b]=i.hcl,[T,C,E,L]=e.hcl;let F,N;if(isNaN(d)||isNaN(T))isNaN(d)?isNaN(T)?F=NaN:(F=T,y!==1&&y!==0||(N=C)):(F=d,E!==1&&E!==0||(N=_));else{let de=T-d;T>d&&de>180?de-=360:T<d&&d-T>180&&(de+=360),F=d+r*de}const[V,Z,J,ee]=function([de,oe,me,Se]){return de=isNaN(de)?0:de*Ft,Mi([me,Math.cos(de)*oe,Math.sin(de)*oe,Se])}([F,N??ri(_,C,r),ri(y,E,r),ri(b,L,r)]);return new vi(V,Z,J,ee,!1)}case"lab":{const[d,_,y,b]=Mi(Qs(i.lab,e.lab,r));return new vi(d,_,y,b,!1)}}},array:Qs,padding:function(i,e,r){return new on(Qs(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const a=i.values,d=e.values;if(a.length!==d.length)throw new Zi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const _=[];for(let y=0;y<a.length;y+=2){if(a[y]!==d[y])throw new Zi(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${d[y]}`);_.push(a[y]);const[b,T]=a[y+1],[C,E]=d[y+1];_.push([ri(b,C,r),ri(T,E,r)])}return new yn(_)}};class an{constructor(e,r,a,d,_){this.type=e,this.operator=r,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(const[y,b]of _)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(e,r,a,d){let _=0;if(e.name==="exponential")_=Ka(r,e.base,a,d);else if(e.name==="linear")_=Ka(r,1,a,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;_=new ge(y[0],y[1],y[2],y[3]).solve(Ka(r,1,a,d))}return _}static parse(e,r){let[a,d,_,...y]=e;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const C=d[1];if(typeof C!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:C}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const C=d.slice(1);if(C.length!==4||C.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(_=r.parse(_,2,rt),!_)return null;const b=[];let T=null;a==="interpolate-hcl"||a==="interpolate-lab"?T=Br:r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType);for(let C=0;C<y.length;C+=2){const E=y[C],L=y[C+1],F=C+3,N=C+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(b.length&&b[b.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const V=r.parse(L,N,T);if(!V)return null;T=T||V.type,b.push([E,V])}return Le(T,rt)||Le(T,Br)||Le(T,D)||Le(T,U)||Le(T,K(rt))?new an(T,a,d,_,b):r.error(`Type ${Y(T)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);const _=r.length;if(d>=r[_-1])return a[_-1].evaluate(e);const y=Ko(r,d),b=an.interpolationFactor(this.interpolation,d,r[y],r[y+1]),T=a[y].evaluate(e),C=a[y+1].evaluate(e);switch(this.operator){case"interpolate":return sn[this.type.kind](T,C,b);case"interpolate-hcl":return sn.color(T,C,b,"hcl");case"interpolate-lab":return sn.color(T,C,b,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ka(i,e,r,a){const d=a-r,_=i-r;return d===0?0:e===1?_/d:(Math.pow(e,_)-1)/(Math.pow(e,d)-1)}class ea{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const d=r.expectedType;d&&d.kind!=="value"&&(a=d);const _=[];for(const b of e.slice(1)){const T=r.parse(b,1+_.length,a,void 0,{typeAnnotation:"omit"});if(!T)return null;a=a||T.type,_.push(T)}if(!a)throw new Error("No output type");const y=d&&_.some(b=>se(d,b.type));return new ea(y?Nt:a,_)}evaluate(e){let r,a=null,d=0;for(const _ of this.args)if(d++,a=_.evaluate(e),a&&a instanceof wr&&!a.available&&(r||(r=a.name),a=null,d===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class ta{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let _=1;_<e.length-1;_+=2){const y=e[_];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",_);const b=r.parse(e[_+1],_+1);if(!b)return null;a.push([y,b])}const d=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return d?new ta(a,d):null}outputDefined(){return this.result.outputDefined()}}class Ja{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,rt),d=r.parse(e[2],2,K(r.expectedType||Nt));return a&&d?new Ja(d.type.itemType,a,d):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Zi(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Zi(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Zi(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Ya{constructor(e,r){this.type=Bt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Nt),d=r.parse(e[2],2,Nt);return a&&d?te(a.type,[Bt,Wt,rt,Jn,Nt])?new Ya(a,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!he(r,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Bi(r))} instead.`);if(!he(a,["string","array"]))throw new Zi(`Expected second argument to be of type array or string, but found ${Y(Bi(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ia{constructor(e,r,a){this.type=rt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Nt),d=r.parse(e[2],2,Nt);if(!a||!d)return null;if(!te(a.type,[Bt,Wt,rt,Jn,Nt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(a.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,rt);return _?new ia(a,d,_):null}return new ia(a,d)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!he(r,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Bi(r))} instead.`);if(!he(a,["string","array"]))throw new Zi(`Expected second argument to be of type array or string, but found ${Y(Bi(a))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return a.indexOf(r,d)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Qa{constructor(e,r,a,d,_,y){this.inputType=e,this.type=r,this.input=a,this.cases=d,this.outputs=_,this.otherwise=y}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const _={},y=[];for(let C=2;C<e.length-1;C+=2){let E=e[C];const L=e[C+1];Array.isArray(E)||(E=[E]);const F=r.concat(C);if(E.length===0)return F.error("Expected at least one branch label.");for(const V of E){if(typeof V!="number"&&typeof V!="string")return F.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return F.error("Numeric branch labels must be integer values.");if(a){if(F.checkSubtype(a,Bi(V)))return null}else a=Bi(V);if(_[String(V)]!==void 0)return F.error("Branch labels must be unique.");_[String(V)]=y.length}const N=r.parse(L,C,d);if(!N)return null;d=d||N.type,y.push(N)}const b=r.parse(e[1],1,Nt);if(!b)return null;const T=r.parse(e[e.length-1],e.length-1,d);return T?b.type.kind!=="value"&&r.concat(1).checkSubtype(a,b.type)?null:new Qa(a,d,b,_,y,T):null}evaluate(e){const r=this.input.evaluate(e);return(Bi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class el{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const b=r.parse(e[y],y,Bt);if(!b)return null;const T=r.parse(e[y+1],y+1,a);if(!T)return null;d.push([b,T]),a=a||T.type}const _=r.parse(e[e.length-1],e.length-1,a);if(!_)return null;if(!a)throw new Error("Can't infer output type");return new el(a,d,_)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ra{constructor(e,r,a,d){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=d}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Nt),d=r.parse(e[2],2,rt);if(!a||!d)return null;if(!te(a.type,[K(Nt),Wt,Nt]))return r.error(`Expected first argument to be of type array or string, but found ${Y(a.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,rt);return _?new ra(a.type,a,d,_):null}return new ra(a.type,a,d)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!he(r,["string","array"]))throw new Zi(`Expected first argument to be of type array or string, but found ${Y(Bi(r))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return r.slice(a,d)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Ic(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Mc(i,e,r,a){return a.compare(e,r)===0}function Jo(i,e,r){const a=i!=="=="&&i!=="!=";return class gm{constructor(_,y,b){this.type=Bt,this.lhs=_,this.rhs=y,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");const b=_[0];let T=y.parse(_[1],1,Nt);if(!T)return null;if(!Ic(b,T.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Y(T.type)}'.`);let C=y.parse(_[2],2,Nt);if(!C)return null;if(!Ic(b,C.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Y(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return y.error(`Cannot compare types '${Y(T.type)}' and '${Y(C.type)}'.`);a&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new vn(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new vn(T.type,[C])));let E=null;if(_.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(E=y.parse(_[3],3,Yn),!E)return null}return new gm(T,C,E)}evaluate(_){const y=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(a&&this.hasUntypedArgument){const T=Bi(y),C=Bi(b);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new Zi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const T=Bi(y),C=Bi(b);if(T.kind!=="string"||C.kind!=="string")return e(_,y,b)}return this.collator?r(_,y,b,this.collator.evaluate(_)):e(_,y,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Wu=Jo("==",function(i,e,r){return e===r},Mc),Hu=Jo("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!Mc(0,e,r,a)}),$u=Jo("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),Ku=Jo(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),Ju=Jo("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),Yu=Jo(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class tl{constructor(e,r,a,d,_){this.type=Wt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,rt);if(!a)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=r.parse(d.locale,1,Wt),!_))return null;let y=null;if(d.currency&&(y=r.parse(d.currency,1,Wt),!y))return null;let b=null;if(d["min-fraction-digits"]&&(b=r.parse(d["min-fraction-digits"],1,rt),!b))return null;let T=null;return d["max-fraction-digits"]&&(T=r.parse(d["max-fraction-digits"],1,rt),!T)?null:new tl(a,_,y,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class na{constructor(e){this.type=H,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const d=[];let _=!1;for(let y=1;y<=e.length-1;++y){const b=e[y];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let T=null;if(b["font-scale"]&&(T=r.parse(b["font-scale"],1,rt),!T))return null;let C=null;if(b["text-font"]&&(C=r.parse(b["text-font"],1,K(Wt)),!C))return null;let E=null;if(b["text-color"]&&(E=r.parse(b["text-color"],1,Br),!E))return null;const L=d[d.length-1];L.scale=T,L.font=C,L.textColor=E}else{const T=r.parse(e[y],1,Nt);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new na(d)}evaluate(e){return new Cr(this.sections.map(r=>{const a=r.content.evaluate(e);return Bi(a)===R?new qs("",a,null,null,null):new qs(fi(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class il{constructor(e){this.type=R,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Wt);return a?new il(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=wr.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class rl{constructor(e){this.type=rt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Y(a.type)} instead.`):new rl(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Zi(`Expected value to be of type string or array, but found ${Y(Bi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Yo={"==":Wu,"!=":Hu,">":Ku,"<":$u,">=":Yu,"<=":Ju,array:vn,at:Ja,boolean:vn,case:el,coalesce:ea,collator:Ws,format:na,image:il,in:Ya,"index-of":ia,interpolate:an,"interpolate-hcl":an,"interpolate-lab":an,length:rl,let:ta,literal:ko,match:Qa,number:vn,"number-format":tl,object:vn,slice:ra,step:fo,string:vn,"to-boolean":uo,"to-color":uo,"to-number":uo,"to-string":uo,var:$s,within:Io};function Cc(i,[e,r,a,d]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const _=d?d.evaluate(i):1,y=Zs(e,r,a,_);if(y)throw new Zi(y);return new vi(e/255,r/255,a/255,_,!1)}function Ac(i,e){return i in e}function nl(i,e){const r=e[i];return r===void 0?null:r}function Mo(i){return{type:i}}function Ec(i){return{result:"success",value:i}}function po(i){return{result:"error",value:i}}function Qo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Pc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ol(i){return!!i.expression&&i.expression.interpolated}function pi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Fi(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Qu(i){return i}function ni(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",d=a||!(a||i.property!==void 0),_=i.type||(ol(e)?"exponential":"interval");if(r||e.type==="padding"){const E=r?vi.parse:on.parse;(i=Rn({},i)).stops&&(i.stops=i.stops.map(L=>[L[0],E(L[1])])),i.default=E(i.default?i.default:e.default)}if(i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;let b,T,C;if(_==="exponential")b=bs;else if(_==="interval")b=Li;else if(_==="categorical"){b=Ri,T=Object.create(null);for(const E of i.stops)T[E[0]]=E[1];C=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);b=zc}if(a){const E={},L=[];for(let V=0;V<i.stops.length;V++){const Z=i.stops[V],J=Z[0].zoom;E[J]===void 0&&(E[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},L.push(J)),E[J].stops.push([Z[0].value,Z[1]])}const F=[];for(const V of L)F.push([E[V].zoom,ni(E[V],e)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:an.interpolationFactor.bind(void 0,N),zoomStops:F.map(V=>V[0]),evaluate:({zoom:V},Z)=>bs({stops:F,base:i.base},e,V).evaluate(V,Z)}}if(d){const E=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:an.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(L=>L[0]),evaluate:({zoom:L})=>b(i,e,L,T,C)}}return{kind:"source",evaluate(E,L){const F=L&&L.properties?L.properties[i.property]:void 0;return F===void 0?Co(i.default,e.default):b(i,e,F,T,C)}}}function Co(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Ri(i,e,r,a,d){return Co(typeof r===d?a[r]:void 0,i.default,e.default)}function Li(i,e,r){if(pi(r)!=="number")return Co(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const d=Ko(i.stops.map(_=>_[0]),r);return i.stops[d][1]}function bs(i,e,r){const a=i.base!==void 0?i.base:1;if(pi(r)!=="number")return Co(i.default,e.default);const d=i.stops.length;if(d===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[d-1][0])return i.stops[d-1][1];const _=Ko(i.stops.map(E=>E[0]),r),y=function(E,L,F,N){const V=N-F,Z=E-F;return V===0?0:L===1?Z/V:(Math.pow(L,Z)-1)/(Math.pow(L,V)-1)}(r,a,i.stops[_][0],i.stops[_+1][0]),b=i.stops[_][1],T=i.stops[_+1][1],C=sn[e.type]||Qu;return typeof b.evaluate=="function"?{evaluate(...E){const L=b.evaluate.apply(void 0,E),F=T.evaluate.apply(void 0,E);if(L!==void 0&&F!==void 0)return C(L,F,y,i.colorSpace)}}:C(b,T,y,i.colorSpace)}function zc(i,e,r){switch(e.type){case"color":r=vi.parse(r);break;case"formatted":r=Cr.fromString(r.toString());break;case"resolvedImage":r=wr.fromString(r.toString());break;case"padding":r=on.parse(r);break;default:pi(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Co(r,i.default,e.default)}bn.register(Yo,{error:[{kind:"error"},[Wt],(i,[e])=>{throw new Zi(e.evaluate(i))}],typeof:[Wt,[Nt],(i,[e])=>Y(Bi(e.evaluate(i)))],"to-rgba":[K(rt,4),[Br],(i,[e])=>{const[r,a,d,_]=e.evaluate(i).rgb;return[255*r,255*a,255*d,_]}],rgb:[Br,[rt,rt,rt],Cc],rgba:[Br,[rt,rt,rt,rt],Cc],has:{type:Bt,overloads:[[[Wt],(i,[e])=>Ac(e.evaluate(i),i.properties())],[[Wt,On],(i,[e,r])=>Ac(e.evaluate(i),r.evaluate(i))]]},get:{type:Nt,overloads:[[[Wt],(i,[e])=>nl(e.evaluate(i),i.properties())],[[Wt,On],(i,[e,r])=>nl(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Nt,[Wt],(i,[e])=>nl(e.evaluate(i),i.featureState||{})],properties:[On,[],i=>i.properties()],"geometry-type":[Wt,[],i=>i.geometryType()],id:[Nt,[],i=>i.id()],zoom:[rt,[],i=>i.globals.zoom],"heatmap-density":[rt,[],i=>i.globals.heatmapDensity||0],"line-progress":[rt,[],i=>i.globals.lineProgress||0],accumulated:[Nt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[rt,Mo(rt),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[rt,Mo(rt),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:rt,overloads:[[[rt,rt],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[rt],(i,[e])=>-e.evaluate(i)]]},"/":[rt,[rt,rt],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[rt,[rt,rt],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[rt,[rt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[rt,[rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[rt,[rt],(i,[e])=>Math.log(e.evaluate(i))],log2:[rt,[rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[rt,[rt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[rt,[rt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[rt,[rt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[rt,[rt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[rt,[rt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[rt,[rt],(i,[e])=>Math.atan(e.evaluate(i))],min:[rt,Mo(rt),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[rt,Mo(rt),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[rt,[rt],(i,[e])=>Math.abs(e.evaluate(i))],round:[rt,[rt],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[rt,[rt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[rt,[rt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Bt,[Wt,Nt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Bt,[Nt],(i,[e])=>i.id()===e.value],"filter-type-==":[Bt,[Wt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Bt,[Wt,Nt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a<d}],"filter-id-<":[Bt,[Nt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[Bt,[Wt,Nt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a>d}],"filter-id->":[Bt,[Nt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[Bt,[Wt,Nt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a<=d}],"filter-id-<=":[Bt,[Nt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[Bt,[Wt,Nt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a>=d}],"filter-id->=":[Bt,[Nt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[Bt,[Nt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Bt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Bt,[K(Wt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Bt,[K(Nt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Bt,[Wt,K(Nt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Bt,[Wt,K(Nt)],(i,[e,r])=>function(a,d,_,y){for(;_<=y;){const b=_+y>>1;if(d[b]===a)return!0;d[b]>a?y=b-1:_=b+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Bt,overloads:[[[Bt,Bt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Mo(Bt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Bt,overloads:[[[Bt,Bt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Mo(Bt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Bt,[Bt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Bt,[Wt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Wt,[Wt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Wt,[Wt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Wt,Mo(Nt),(i,e)=>e.map(r=>fi(r.evaluate(i))).join("")],"resolved-locale":[Wt,[Yn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class sl{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new Za,this._defaultValue=r?(a=r).type==="color"&&Fi(a.default)?new vi(0,0,0,0):a.type==="color"?vi.parse(a.default)||null:a.type==="padding"?on.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?yn.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,d,_,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,d,_,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Zi(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function oa(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Yo}function sa(i,e){const r=new Xs(Yo,Ks,[],e?function(d){const _={color:Br,string:Wt,number:rt,enum:Wt,boolean:Bt,formatted:H,padding:D,resolvedImage:R,variableAnchorOffsetCollection:U};return d.type==="array"?K(_[d.value]||Nt,d.length):_[d.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Ec(new sl(a,e)):po(r.errors)}class al{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!vs(r.expression)}evaluateWithoutErrorHandling(e,r,a,d,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,_,y)}evaluate(e,r,a,d,_,y){return this._styleExpression.evaluate(e,r,a,d,_,y)}}class aa{constructor(e,r,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!vs(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,r,a,d,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,_,y)}evaluate(e,r,a,d,_,y){return this._styleExpression.evaluate(e,r,a,d,_,y)}interpolationFactor(e,r,a){return this.interpolationType?an.interpolationFactor(this.interpolationType,e,r,a):0}}function ll(i,e){const r=sa(i,e);if(r.result==="error")return r;const a=r.value.expression,d=Js(a);if(!d&&!Qo(e))return po([new qi("","data expressions not supported")]);const _=Ys(a,["zoom"]);if(!_&&!Pc(e))return po([new qi("","zoom expressions not supported")]);const y=ws(a);return y||_?y instanceof qi?po([y]):y instanceof an&&!ol(e)?po([new qi("",'"interpolate" expressions cannot be used with this property')]):Ec(y?new aa(d?"camera":"composite",r.value,y.labels,y instanceof an?y.interpolation:void 0):new al(d?"constant":"source",r.value)):po([new qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xs{constructor(e,r){this._parameters=e,this._specification=r,Rn(this,ni(this._parameters,this._specification))}static deserialize(e){return new xs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ws(i){let e=null;if(i instanceof ta)e=ws(i.result);else if(i instanceof ea){for(const r of i.args)if(e=ws(r),e)break}else(i instanceof fo||i instanceof an)&&i.input instanceof bn&&i.input.name==="zoom"&&(e=i);return e instanceof qi||i.eachChild(r=>{const a=ws(r);a instanceof qi?e=a:!e&&a?e=new qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new qi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ss(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ss(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const eh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function cl(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ss(i)||(i=la(i));const e=sa(i,eh);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,d)=>e.value.evaluate(r,a,{},d),needGeometry:Lc(i)}}function th(i,e){return i<e?-1:i>e?1:0}function Lc(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Lc(i[e]))return!0;return!1}function la(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ul(i[1],i[2],"=="):e==="!="?Ts(ul(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ul(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(la))):e==="all"?["all"].concat(i.slice(1).map(la)):e==="none"?["all"].concat(i.slice(1).map(la).map(Ts)):e==="in"?Dc(i[1],i.slice(2)):e==="!in"?Ts(Dc(i[1],i.slice(2))):e==="has"?Bc(i[1]):e==="!has"?Ts(Bc(i[1])):e!=="within"||i;var r}function ul(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Dc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(th)]]:["filter-in-small",i,["literal",e]]}}function Bc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ts(i){return["!",i]}function ca(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(const _ of i)d+=`${ca(_)},`;return`${d}]`}const r=Object.keys(i).sort();let a="{";for(let d=0;d<r.length;d++)a+=`${JSON.stringify(r[d])}:${ca(i[r[d]])},`;return`${a}}`}function ua(i){let e="";for(const r of br)e+=`/${ca(i[r])}`;return e}function Fc(i){const e=i.value;return e?[new Qe(i.key,e,"constants have been deprecated as of v8")]:[]}function Gi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ao(i){if(Array.isArray(i))return i.map(Ao);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ao(i[r]);return e}return Gi(i)}function qr(i){const e=i.key,r=i.value,a=i.valueSpec||{},d=i.objectElementValidators||{},_=i.style,y=i.styleSpec,b=i.validateSpec;let T=[];const C=pi(r);if(C!=="object")return[new Qe(e,r,`object expected, ${C} found`)];for(const E in r){const L=E.split(".")[0],F=a[L]||a["*"];let N;if(d[L])N=d[L];else if(a[L])N=b;else if(d["*"])N=d["*"];else{if(!a["*"]){T.push(new Qe(e,r[E],`unknown property "${E}"`));continue}N=b}T=T.concat(N({key:(e&&`${e}.`)+E,value:r[E],valueSpec:F,style:_,styleSpec:y,object:r,objectKey:E,validateSpec:b},r))}for(const E in a)d[E]||a[E].required&&a[E].default===void 0&&r[E]===void 0&&T.push(new Qe(e,r,`missing required property "${E}"`));return T}function es(i){const e=i.value,r=i.valueSpec,a=i.style,d=i.styleSpec,_=i.key,y=i.arrayElementValidator||i.validateSpec;if(pi(e)!=="array")return[new Qe(_,e,`array expected, ${pi(e)} found`)];if(r.length&&e.length!==r.length)return[new Qe(_,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Qe(_,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let b={type:r.value,values:r.values};d.$version<7&&(b.function=r.function),pi(r.value)==="object"&&(b=r.value);let T=[];for(let C=0;C<e.length;C++)T=T.concat(y({array:e,arrayIndex:C,value:e[C],valueSpec:b,validateSpec:i.validateSpec,style:a,styleSpec:d,key:`${_}[${C}]`}));return T}function ks(i){const e=i.key,r=i.value,a=i.valueSpec;let d=pi(r);return d==="number"&&r!=r&&(d="NaN"),d!=="number"?[new Qe(e,r,`number expected, ${d} found`)]:"minimum"in a&&r<a.minimum?[new Qe(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Qe(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function ha(i){const e=i.valueSpec,r=Gi(i.value.type);let a,d,_,y={};const b=r!=="categorical"&&i.value.property===void 0,T=!b,C=pi(i.value.stops)==="array"&&pi(i.value.stops[0])==="array"&&pi(i.value.stops[0][0])==="object",E=qr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(N){if(r==="identity")return[new Qe(N.key,N.value,'identity function may not have a "stops" property')];let V=[];const Z=N.value;return V=V.concat(es({key:N.key,value:Z,valueSpec:N.valueSpec,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:L})),pi(Z)==="array"&&Z.length===0&&V.push(new Qe(N.key,Z,"array must have at least one stop")),V},default:function(N){return N.validateSpec({key:N.key,value:N.value,valueSpec:e,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec})}}});return r==="identity"&&b&&E.push(new Qe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||E.push(new Qe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!ol(i.valueSpec)&&E.push(new Qe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Qo(i.valueSpec)?E.push(new Qe(i.key,i.value,"property functions not supported")):b&&!Pc(i.valueSpec)&&E.push(new Qe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!C||i.value.property!==void 0||E.push(new Qe(i.key,i.value,'"property" property is required')),E;function L(N){let V=[];const Z=N.value,J=N.key;if(pi(Z)!=="array")return[new Qe(J,Z,`array expected, ${pi(Z)} found`)];if(Z.length!==2)return[new Qe(J,Z,`array length 2 expected, length ${Z.length} found`)];if(C){if(pi(Z[0])!=="object")return[new Qe(J,Z,`object expected, ${pi(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Qe(J,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Qe(J,Z,"object stop key must have value")];if(_&&_>Gi(Z[0].zoom))return[new Qe(J,Z[0].zoom,"stop zoom values must appear in ascending order")];Gi(Z[0].zoom)!==_&&(_=Gi(Z[0].zoom),d=void 0,y={}),V=V.concat(qr({key:`${J}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:ks,value:F}}))}else V=V.concat(F({key:`${J}[0]`,value:Z[0],valueSpec:{},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec},Z));return oa(Ao(Z[1]))?V.concat([new Qe(`${J}[1]`,Z[1],"expressions are not allowed in function stops.")]):V.concat(N.validateSpec({key:`${J}[1]`,value:Z[1],valueSpec:e,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec}))}function F(N,V){const Z=pi(N.value),J=Gi(N.value),ee=N.value!==null?N.value:V;if(a){if(Z!==a)return[new Qe(N.key,ee,`${Z} stop domain type must match previous stop domain type ${a}`)]}else a=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Qe(N.key,ee,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&r!=="categorical"){let de=`number expected, ${Z} found`;return Qo(e)&&r===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(N.key,ee,de)]}return r!=="categorical"||Z!=="number"||isFinite(J)&&Math.floor(J)===J?r!=="categorical"&&Z==="number"&&d!==void 0&&J<d?[new Qe(N.key,ee,"stop domain values must appear in ascending order")]:(d=J,r==="categorical"&&J in y?[new Qe(N.key,ee,"stop domain values must be unique")]:(y[J]=!0,[])):[new Qe(N.key,ee,`integer expected, found ${J}`)]}}function Eo(i){const e=(i.expressionContext==="property"?ll:sa)(Ao(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new Qe(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Qe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!vs(r))return[new Qe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!vs(r))return[new Qe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ys(r,["zoom","feature-state"]))return[new Qe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Js(r))return[new Qe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Is(i){const e=i.key,r=i.value,a=i.valueSpec,d=[];return Array.isArray(a.values)?a.values.indexOf(Gi(r))===-1&&d.push(new Qe(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Gi(r))===-1&&d.push(new Qe(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function ts(i){return Ss(Ao(i.value))?Eo(Rn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rc(i)}function Rc(i){const e=i.value,r=i.key;if(pi(e)!=="array")return[new Qe(r,e,`array expected, ${pi(e)} found`)];const a=i.styleSpec;let d,_=[];if(e.length<1)return[new Qe(r,e,"filter array must have at least 1 element")];switch(_=_.concat(Is({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Gi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Gi(e[1])==="$type"&&_.push(new Qe(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new Qe(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=pi(e[1]),d!=="string"&&_.push(new Qe(`${r}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=pi(e[y]),Gi(e[1])==="$type"?_=_.concat(Is({key:`${r}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new Qe(`${r}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)_=_.concat(Rc({key:`${r}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=pi(e[1]),e.length!==2?_.push(new Qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new Qe(`${r}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=pi(e[1]),e.length!==2?_.push(new Qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&_.push(new Qe(`${r}[1]`,e[1],`object expected, ${d} found`))}return _}function Oc(i,e){const r=i.key,a=i.validateSpec,d=i.style,_=i.styleSpec,y=i.value,b=i.objectKey,T=_[`${e}_${i.layerType}`];if(!T)return[];const C=b.match(/^(.*)-transition$/);if(e==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return a({key:r,value:y,valueSpec:_.transition,style:d,styleSpec:_});const E=i.valueSpec||T[b];if(!E)return[new Qe(r,y,`unknown property "${b}"`)];let L;if(pi(y)==="string"&&Qo(E)&&!E.tokens&&(L=/^{([^}]+)}$/.exec(y)))return[new Qe(r,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&F.push(new Qe(r,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Fi(Ao(y))&&Gi(y.type)==="identity"&&F.push(new Qe(r,y,'"text-font" does not support identity functions'))),F.concat(a({key:i.key,value:y,valueSpec:E,style:d,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:b}))}function Nc(i){return Oc(i,"paint")}function Vc(i){return Oc(i,"layout")}function Uc(i){let e=[];const r=i.value,a=i.key,d=i.style,_=i.styleSpec;r.type||r.ref||e.push(new Qe(a,r,'either "type" or "ref" is required'));let y=Gi(r.type);const b=Gi(r.ref);if(r.id){const T=Gi(r.id);for(let C=0;C<i.arrayIndex;C++){const E=d.layers[C];Gi(E.id)===T&&e.push(new Qe(a,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach(C=>{C in r&&e.push(new Qe(a,r[C],`"${C}" is prohibited for ref layers`))}),d.layers.forEach(C=>{Gi(C.id)===b&&(T=C)}),T?T.ref?e.push(new Qe(a,r.ref,"ref cannot reference another ref layer")):y=Gi(T.type):e.push(new Qe(a,r.ref,`ref layer "${b}" not found`))}else if(y!=="background")if(r.source){const T=d.sources&&d.sources[r.source],C=T&&Gi(T.type);T?C==="vector"&&y==="raster"?e.push(new Qe(a,r.source,`layer "${r.id}" requires a raster source`)):C!=="raster-dem"&&y==="hillshade"?e.push(new Qe(a,r.source,`layer "${r.id}" requires a raster-dem source`)):C==="raster"&&y!=="raster"?e.push(new Qe(a,r.source,`layer "${r.id}" requires a vector source`)):C!=="vector"||r["source-layer"]?C==="raster-dem"&&y!=="hillshade"?e.push(new Qe(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||e.push(new Qe(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Qe(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Qe(a,r.source,`source "${r.source}" not found`))}else e.push(new Qe(a,r,'missing required property "source"'));return e=e.concat(qr({key:a,value:r,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:ts,layout:T=>qr({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Vc(Rn({layerType:y},C))}}),paint:T=>qr({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Nc(Rn({layerType:y},C))}})}})),e}function Nn(i){const e=i.value,r=i.key,a=pi(e);return a!=="string"?[new Qe(r,e,`string expected, ${a} found`)]:[]}const Ms={promoteId:function({key:i,value:e}){if(pi(e)==="string")return Nn({key:i,value:e});{const r=[];for(const a in e)r.push(...Nn({key:`${i}.${a}`,value:e[a]}));return r}}};function ln(i){const e=i.value,r=i.key,a=i.styleSpec,d=i.style,_=i.validateSpec;if(!e.type)return[new Qe(r,e,'"type" is required')];const y=Gi(e.type);let b;switch(y){case"vector":case"raster":return b=qr({key:r,value:e,valueSpec:a[`source_${y.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Ms,validateSpec:_}),b;case"raster-dem":return b=function(T){var C;const E=(C=T.sourceName)!==null&&C!==void 0?C:"",L=T.value,F=T.styleSpec,N=F.source_raster_dem,V=T.style;let Z=[];const J=pi(L);if(L===void 0)return Z;if(J!=="object")return Z.push(new Qe("source_raster_dem",L,`object expected, ${J} found`)),Z;const ee=Gi(L.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],oe=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const me in L)!ee&&de.includes(me)?Z.push(new Qe(me,L[me],`In "${E}": "${me}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):N[me]?Z=Z.concat(T.validateSpec({key:me,value:L[me],valueSpec:N[me],validateSpec:T.validateSpec,style:V,styleSpec:F})):Z.push(new Qe(me,L[me],`unknown property "${me}"`));return Z}({sourceName:r,value:e,style:i.style,styleSpec:a,validateSpec:_}),b;case"geojson":if(b=qr({key:r,value:e,valueSpec:a.source_geojson,style:d,styleSpec:a,validateSpec:_,objectElementValidators:Ms}),e.cluster)for(const T in e.clusterProperties){const[C,E]=e.clusterProperties[T],L=typeof C=="string"?[C,["accumulated"],["get",T]]:C;b.push(...Eo({key:`${r}.${T}.map`,value:E,validateSpec:_,expressionContext:"cluster-map"})),b.push(...Eo({key:`${r}.${T}.reduce`,value:L,validateSpec:_,expressionContext:"cluster-reduce"}))}return b;case"video":return qr({key:r,value:e,valueSpec:a.source_video,style:d,validateSpec:_,styleSpec:a});case"image":return qr({key:r,value:e,valueSpec:a.source_image,style:d,validateSpec:_,styleSpec:a});case"canvas":return[new Qe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Is({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,validateSpec:_,styleSpec:a})}}function Cs(i){const e=i.value,r=i.styleSpec,a=r.light,d=i.style;let _=[];const y=pi(e);if(e===void 0)return _;if(y!=="object")return _=_.concat([new Qe("light",e,`object expected, ${y} found`)]),_;for(const b in e){const T=b.match(/^(.*)-transition$/);_=_.concat(T&&a[T[1]]&&a[T[1]].transition?i.validateSpec({key:b,value:e[b],valueSpec:r.transition,validateSpec:i.validateSpec,style:d,styleSpec:r}):a[b]?i.validateSpec({key:b,value:e[b],valueSpec:a[b],validateSpec:i.validateSpec,style:d,styleSpec:r}):[new Qe(b,e[b],`unknown property "${b}"`)])}return _}function jc(i){const e=i.value,r=i.styleSpec,a=r.terrain,d=i.style;let _=[];const y=pi(e);if(e===void 0)return _;if(y!=="object")return _=_.concat([new Qe("terrain",e,`object expected, ${y} found`)]),_;for(const b in e)_=_.concat(a[b]?i.validateSpec({key:b,value:e[b],valueSpec:a[b],validateSpec:i.validateSpec,style:d,styleSpec:r}):[new Qe(b,e[b],`unknown property "${b}"`)]);return _}function qc(i){let e=[];const r=i.value,a=i.key;if(Array.isArray(r)){const d=[],_=[];for(const y in r)r[y].id&&d.includes(r[y].id)&&e.push(new Qe(a,r,`all the sprites' ids must be unique, but ${r[y].id} is duplicated`)),d.push(r[y].id),r[y].url&&_.includes(r[y].url)&&e.push(new Qe(a,r,`all the sprites' URLs must be unique, but ${r[y].url} is duplicated`)),_.push(r[y].url),e=e.concat(qr({key:`${a}[${y}]`,value:r[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Nn({key:a,value:r})}const Zc={"*":()=>[],array:es,boolean:function(i){const e=i.value,r=i.key,a=pi(e);return a!=="boolean"?[new Qe(r,e,`boolean expected, ${a} found`)]:[]},number:ks,color:function(i){const e=i.key,r=i.value,a=pi(r);return a!=="string"?[new Qe(e,r,`color expected, ${a} found`)]:vi.parse(String(r))?[]:[new Qe(e,r,`color expected, "${r}" found`)]},constants:Fc,enum:Is,filter:ts,function:ha,layer:Uc,object:qr,source:ln,light:Cs,terrain:jc,string:Nn,formatted:function(i){return Nn(i).length===0?[]:Eo(i)},resolvedImage:function(i){return Nn(i).length===0?[]:Eo(i)},padding:function(i){const e=i.key,r=i.value;if(pi(r)==="array"){if(r.length<1||r.length>4)return[new Qe(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let d=[];for(let _=0;_<r.length;_++)d=d.concat(i.validateSpec({key:`${e}[${_}]`,value:r[_],validateSpec:i.validateSpec,valueSpec:a}));return d}return ks({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,a=pi(r),d=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new Qe(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let y=0;y<r.length;y+=2)_=_.concat(Is({key:`${e}[${y}]`,value:r[y],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(es({key:`${e}[${y+1}]`,value:r[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return _},sprite:qc};function Qn(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=Qn,r.expression&&Fi(Gi(e))?ha(i):r.expression&&oa(Ao(e))?Eo(i):r.type&&Zc[r.type]?Zc[r.type](i):qr(Rn({},i,{valueSpec:r.type?a[r.type]:r}))}function Gc(i){const e=i.value,r=i.key,a=Nn(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Qe(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Qe(r,e,'"glyphs" url must include a "{range}" token'))),a}function xn(i,e=Pe){let r=[];return r=r.concat(Qn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Qn,objectElementValidators:{glyphs:Gc,"*":()=>[]}})),i.constants&&(r=r.concat(Fc({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Qn}))),da(r)}function eo(i){return function(e){return i({...e,validateSpec:Qn})}}function da(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function to(i){return function(...e){return da(i.apply(this,e))}}xn.source=to(eo(ln)),xn.sprite=to(eo(qc)),xn.glyphs=to(eo(Gc)),xn.light=to(eo(Cs)),xn.terrain=to(eo(jc)),xn.layer=to(eo(Uc)),xn.filter=to(eo(ts)),xn.paintProperty=to(eo(Nc)),xn.layoutProperty=to(eo(Vc));const io=xn,ih=io.light,hl=io.paintProperty,Xc=io.layoutProperty;function fa(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new Lr(new Error(a.message))),r=!0;return r}class is{constructor(e,r,a){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(r=y[1])+2*(a=y[2]);for(let T=0;T<this.d*this.d;T++){const C=y[3+T],E=y[3+T+1];d.push(C===E?null:y.subarray(C,E))}const b=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],b),this.bboxes=y.subarray(b),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const _=a/r*e;this.min=-_,this.max=e+_}insert(e,r,a,d,_){this._forEachCell(r,a,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,d,_,y){this.cells[_].push(y)}query(e,r,a,d,_){const y=this.min,b=this.max;if(e<=y&&r<=y&&b<=a&&b<=d&&!_)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,r,a,d,this._queryCell,T,{},_),T}}_queryCell(e,r,a,d,_,y,b,T){const C=this.cells[_];if(C!==null){const E=this.keys,L=this.bboxes;for(let F=0;F<C.length;F++){const N=C[F];if(b[N]===void 0){const V=4*N;(T?T(L[V+0],L[V+1],L[V+2],L[V+3]):e<=L[V+2]&&r<=L[V+3]&&a>=L[V+0]&&d>=L[V+1])?(b[N]=!0,y.push(E[N])):b[N]=!1}}}}_forEachCell(e,r,a,d,_,y,b,T){const C=this._convertToCellCoord(e),E=this._convertToCellCoord(r),L=this._convertToCellCoord(a),F=this._convertToCellCoord(d);for(let N=C;N<=L;N++)for(let V=E;V<=F;V++){const Z=this.d*V+N;if((!T||T(this._convertFromCellCoord(N),this._convertFromCellCoord(V),this._convertFromCellCoord(N+1),this._convertFromCellCoord(V+1)))&&_.call(this,e,r,a,d,Z,y,b,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const d=new Int32Array(r+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=r;for(let y=0;y<e.length;y++){const b=e[y];d[3+y]=_,d.set(b,_),_+=b.length}return d[3+e.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+e.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new is(e.buffer)}}const ro={};function ht(i,e,r={}){if(ro[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),ro[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}ht("Object",Object),ht("TransferableGridIndex",is),ht("Color",vi),ht("Error",Error),ht("AJAXError",qe),ht("ResolvedImage",wr),ht("StylePropertyFunction",xs),ht("StyleExpression",sl,{omit:["_evaluator"]}),ht("ZoomDependentExpression",aa),ht("ZoomConstantExpression",al),ht("CompoundExpression",bn,{omit:["_evaluate"]});for(const i in Yo)Yo[i]._classRegistryKey||ht(`Expression_${i}`,Yo[i]);function pa(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function mo(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(pa(i)||kt(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(mo(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!ro[a])throw new Error(`${a} is not registered.`);const d=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||ro[a].omit.indexOf(_)>=0)continue;const y=i[_];d[_]=ro[a].shallow.indexOf(_)>=0?y:mo(y,e)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(d.$name=a),d}throw new Error("can't serialize object of type "+typeof i)}function rs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||pa(i)||kt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(rs);if(typeof i=="object"){const e=i.$name||"Object";if(!ro[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=ro[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const _=i[d];a[d]=ro[e].shallow.indexOf(d)>=0?_:rs(_)}return a}throw new Error("can't deserialize object of type "+typeof i)}class Wc{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const lt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function dl(i){for(const e of i)if(pl(e.charCodeAt(0)))return!0;return!1}function fl(i){for(const e of i)if(!rh(e.charCodeAt(0)))return!1;return!0}function rh(i){return!(lt.Arabic(i)||lt["Arabic Supplement"](i)||lt["Arabic Extended-A"](i)||lt["Arabic Presentation Forms-A"](i)||lt["Arabic Presentation Forms-B"](i))}function pl(i){return!(i!==746&&i!==747&&(i<4352||!(lt["Bopomofo Extended"](i)||lt.Bopomofo(i)||lt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||lt["CJK Compatibility Ideographs"](i)||lt["CJK Compatibility"](i)||lt["CJK Radicals Supplement"](i)||lt["CJK Strokes"](i)||!(!lt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||lt["CJK Unified Ideographs Extension A"](i)||lt["CJK Unified Ideographs"](i)||lt["Enclosed CJK Letters and Months"](i)||lt["Hangul Compatibility Jamo"](i)||lt["Hangul Jamo Extended-A"](i)||lt["Hangul Jamo Extended-B"](i)||lt["Hangul Jamo"](i)||lt["Hangul Syllables"](i)||lt.Hiragana(i)||lt["Ideographic Description Characters"](i)||lt.Kanbun(i)||lt["Kangxi Radicals"](i)||lt["Katakana Phonetic Extensions"](i)||lt.Katakana(i)&&i!==12540||!(!lt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!lt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||lt["Unified Canadian Aboriginal Syllabics"](i)||lt["Unified Canadian Aboriginal Syllabics Extended"](i)||lt["Vertical Forms"](i)||lt["Yijing Hexagram Symbols"](i)||lt["Yi Syllables"](i)||lt["Yi Radicals"](i))))}function Hc(i){return!(pl(i)||function(e){return!!(lt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||lt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||lt["Letterlike Symbols"](e)||lt["Number Forms"](e)||lt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||lt["Control Pictures"](e)&&e!==9251||lt["Optical Character Recognition"](e)||lt["Enclosed Alphanumerics"](e)||lt["Geometric Shapes"](e)||lt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||lt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||lt["CJK Symbols and Punctuation"](e)||lt.Katakana(e)||lt["Private Use Area"](e)||lt["CJK Compatibility Forms"](e)||lt["Small Form Variants"](e)||lt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function $c(i){return i>=1424&&i<=2303||lt["Arabic Presentation Forms-A"](i)||lt["Arabic Presentation Forms-B"](i)}function Kc(i,e){return!(!e&&$c(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||lt.Khmer(i))}function nh(i){for(const e of i)if($c(e.charCodeAt(0)))return!0;return!1}const ml="deferred",_l="loading",gl="loaded";let yl=null,Zr="unavailable",_o=null;const As=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Zr="error"),yl&&yl(i)};function vl(){Es.fire(new Mn("pluginStateChange",{pluginStatus:Zr,pluginURL:_o}))}const Es=new _r,bl=function(){return Zr},Jc=function(){if(Zr!==ml||!_o)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Zr=_l,vl(),_o&&Xe({url:_o},i=>{i?As(i):(Zr=gl,vl())})},cn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Zr===gl||cn.applyArabicShaping!=null,isLoading:()=>Zr===_l,setState(i){if(!Pt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Zr=i.pluginStatus,_o=i.pluginURL},isParsed(){if(!Pt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return cn.applyArabicShaping!=null&&cn.processBidirectionalText!=null&&cn.processStyledBidirectionalText!=null},getPluginURL(){if(!Pt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return _o}};class Ai{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wc,this.transition={})}isSupportedScript(e){return function(r,a){for(const d of r)if(!Kc(d.charCodeAt(0),a))return!1;return!0}(e,cn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class ma{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,d){if(Fi(a))return new xs(a,d);if(oa(a)){const _=ll(a,d);if(_.result==="error")throw new Error(_.value.map(y=>`${y.key}: ${y.message}`).join(", "));return _.value}{let _=a;return d.type==="color"&&typeof a=="string"?_=vi.parse(a):d.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(_=yn.parse(a)):_=on.parse(a),{kind:"constant",evaluate:()=>_}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class xl{constructor(e){this.property=e,this.value=new ma(e,void 0)}transitioned(e,r){return new Qc(this.property,this.value,r,Ae({},e.transition,this.transition),e.now)}untransitioned(){return new Qc(this.property,this.value,null,{},0)}}class Yc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Te(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new xl(this._values[e].property)),this._values[e].value=new ma(this._values[e].property,r===null?void 0:Te(r))}getTransition(e){return Te(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new xl(this._values[e].property)),this._values[e].transition=Te(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const d=this.getTransition(r);d!==void 0&&(e[`${r}-transition`]=d)}return e}transitioned(e,r){const a=new eu(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].transitioned(e,r._values[d]);return a}untransitioned(){const e=new eu(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Qc{constructor(e,r,a,d,_){this.property=e,this.value=r,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const d=e.now||0,_=this.value.possiblyEvaluate(e,r,a),y=this.prior;if(y){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return y.possiblyEvaluate(e,r,a);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,r,a),_,function(T){if(T<=0)return 0;if(T>=1)return 1;const C=T*T,E=C*T;return 4*(T<.5?E:3*(T-C)+E-.75)}(b))}}return _}}class eu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const d=new _a(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(e,r,a);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class oh{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Te(this._values[e].value)}setValue(e,r){this._values[e]=new ma(this._values[e].property,r===null?void 0:Te(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const d=new _a(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(e,r,a);return d}}class Fr{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,d){return this.property.evaluate(this.value,this.parameters,e,r,a,d)}}class _a{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class wt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const d=sn[this.specification.type];return d?d(e,r,a):e}}class Mt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,d){return new Fr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,d)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Fr(this,{kind:"constant",value:void 0},e.parameters);const d=sn[this.specification.type];if(d){const _=d(e.value.value,r.value.value,a);return new Fr(this,{kind:"constant",value:_},e.parameters)}return e}evaluate(e,r,a,d,_,y){return e.kind==="constant"?e.value:e.evaluate(r,a,d,_,y)}}class Ps extends Mt{possiblyEvaluate(e,r,a,d){if(e.value===void 0)return new Fr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const _=e.expression.evaluate(r,null,{},a,d),y=e.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(y,y,y,r);return new Fr(this,{kind:"constant",value:b},r)}if(e.expression.kind==="camera"){const _=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Fr(this,{kind:"constant",value:_},r)}return new Fr(this,e.expression,r)}evaluate(e,r,a,d,_,y){if(e.kind==="source"){const b=e.evaluate(r,a,d,_,y);return this._calculate(b,b,b,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,d),e.evaluate({zoom:Math.floor(r.zoom)},a,d),e.evaluate({zoom:Math.floor(r.zoom)+1},a,d),r):e.value}_calculate(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class wl{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const _=e.expression.evaluate(r,null,{},a,d);return this._calculate(_,_,_,r)}return this._calculate(e.expression.evaluate(new Ai(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Ai(Math.floor(r.zoom),r)),e.expression.evaluate(new Ai(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Sl{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,d){return!!e.expression.evaluate(r,null,{},a,d)}interpolate(){return!1}}class Qi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const d=this.defaultPropertyValues[r]=new ma(a,void 0),_=this.defaultTransitionablePropertyValues[r]=new xl(a);this.defaultTransitioningPropertyValues[r]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}}}ht("DataDrivenProperty",Mt),ht("DataConstantProperty",wt),ht("CrossFadedDataDrivenProperty",Ps),ht("CrossFadedProperty",wl),ht("ColorRampProperty",Sl);const Tl="-transition";class wn extends _r{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new oh(r.layout)),r.paint)){this._transitionablePaint=new Yc(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _a(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Xc,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Tl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(hl,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(Tl))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const d=this._transitionablePaint._values[e],_=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(e,b,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),we(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,d,_={}){return(!_||_.validate!==!1)&&fa(this,e.call(io,{key:r,layerType:this.type,objectKey:a,value:d,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Fr&&Qo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const tu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Po{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Oi(i,e=1){let r=0,a=0;return{members:i.map(d=>{const _=tu[d.type].BYTES_PER_ELEMENT,y=r=ns(r,Math.max(e,_)),b=d.components||1;return a=Math.max(a,_),r+=_*b,{name:d.name,type:d.type,components:b,offset:y}}),size:ns(r,Math.max(a,e)),alignment:e}}function ns(i,e){return Math.ceil(i/e)*e}class zs extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.int16[d+0]=r,this.int16[d+1]=a,e}}zs.prototype.bytesPerElement=4,ht("StructArrayLayout2i4",zs);class Ls extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=d,e}}Ls.prototype.bytesPerElement=6,ht("StructArrayLayout3i6",Ls);class zo extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,d)}emplace(e,r,a,d,_){const y=4*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=d,this.int16[y+3]=_,e}}zo.prototype.bytesPerElement=8,ht("StructArrayLayout4i8",zo);class kl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,d,_,y)}emplace(e,r,a,d,_,y,b){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=a,this.int16[T+2]=d,this.int16[T+3]=_,this.int16[T+4]=y,this.int16[T+5]=b,e}}kl.prototype.bytesPerElement=12,ht("StructArrayLayout2i4i12",kl);class Il extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,d,_,y)}emplace(e,r,a,d,_,y,b){const T=4*e,C=8*e;return this.int16[T+0]=r,this.int16[T+1]=a,this.uint8[C+4]=d,this.uint8[C+5]=_,this.uint8[C+6]=y,this.uint8[C+7]=b,e}}Il.prototype.bytesPerElement=8,ht("StructArrayLayout2i4ub8",Il);class os extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.float32[d+0]=r,this.float32[d+1]=a,e}}os.prototype.bytesPerElement=8,ht("StructArrayLayout2f8",os);class Ml extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,T,C,E){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,d,_,y,b,T,C,E)}emplace(e,r,a,d,_,y,b,T,C,E,L){const F=10*e;return this.uint16[F+0]=r,this.uint16[F+1]=a,this.uint16[F+2]=d,this.uint16[F+3]=_,this.uint16[F+4]=y,this.uint16[F+5]=b,this.uint16[F+6]=T,this.uint16[F+7]=C,this.uint16[F+8]=E,this.uint16[F+9]=L,e}}Ml.prototype.bytesPerElement=20,ht("StructArrayLayout10ui20",Ml);class Cl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,T,C,E,L,F){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,a,d,_,y,b,T,C,E,L,F)}emplace(e,r,a,d,_,y,b,T,C,E,L,F,N){const V=12*e;return this.int16[V+0]=r,this.int16[V+1]=a,this.int16[V+2]=d,this.int16[V+3]=_,this.uint16[V+4]=y,this.uint16[V+5]=b,this.uint16[V+6]=T,this.uint16[V+7]=C,this.int16[V+8]=E,this.int16[V+9]=L,this.int16[V+10]=F,this.int16[V+11]=N,e}}Cl.prototype.bytesPerElement=24,ht("StructArrayLayout4i4ui4i24",Cl);class mi extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=d,e}}mi.prototype.bytesPerElement=12,ht("StructArrayLayout3f12",mi);class m extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}m.prototype.bytesPerElement=4,ht("StructArrayLayout1ul4",m);class t extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,T,C){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,a,d,_,y,b,T,C)}emplace(e,r,a,d,_,y,b,T,C,E){const L=10*e,F=5*e;return this.int16[L+0]=r,this.int16[L+1]=a,this.int16[L+2]=d,this.int16[L+3]=_,this.int16[L+4]=y,this.int16[L+5]=b,this.uint32[F+3]=T,this.uint16[L+8]=C,this.uint16[L+9]=E,e}}t.prototype.bytesPerElement=20,ht("StructArrayLayout6i1ul2ui20",t);class o extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,d,_,y)}emplace(e,r,a,d,_,y,b){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=a,this.int16[T+2]=d,this.int16[T+3]=_,this.int16[T+4]=y,this.int16[T+5]=b,e}}o.prototype.bytesPerElement=12,ht("StructArrayLayout2i2i2i12",o);class h extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,d,_)}emplace(e,r,a,d,_,y){const b=4*e,T=8*e;return this.float32[b+0]=r,this.float32[b+1]=a,this.float32[b+2]=d,this.int16[T+6]=_,this.int16[T+7]=y,e}}h.prototype.bytesPerElement=16,ht("StructArrayLayout2f1f2i16",h);class f extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,d)}emplace(e,r,a,d,_){const y=12*e,b=3*e;return this.uint8[y+0]=r,this.uint8[y+1]=a,this.float32[b+1]=d,this.float32[b+2]=_,e}}f.prototype.bytesPerElement=12,ht("StructArrayLayout2ub2f12",f);class g extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=a,this.uint16[_+2]=d,e}}g.prototype.bytesPerElement=6,ht("StructArrayLayout3ui6",g);class x extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,T,C,E,L,F,N,V,Z,J,ee){const de=this.length;return this.resize(de+1),this.emplace(de,e,r,a,d,_,y,b,T,C,E,L,F,N,V,Z,J,ee)}emplace(e,r,a,d,_,y,b,T,C,E,L,F,N,V,Z,J,ee,de){const oe=24*e,me=12*e,Se=48*e;return this.int16[oe+0]=r,this.int16[oe+1]=a,this.uint16[oe+2]=d,this.uint16[oe+3]=_,this.uint32[me+2]=y,this.uint32[me+3]=b,this.uint32[me+4]=T,this.uint16[oe+10]=C,this.uint16[oe+11]=E,this.uint16[oe+12]=L,this.float32[me+7]=F,this.float32[me+8]=N,this.uint8[Se+36]=V,this.uint8[Se+37]=Z,this.uint8[Se+38]=J,this.uint32[me+10]=ee,this.int16[oe+22]=de,e}}x.prototype.bytesPerElement=48,ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class w extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,T,C,E,L,F,N,V,Z,J,ee,de,oe,me,Se,Oe,ct,_t,at,ot,Ye,ft){const tt=this.length;return this.resize(tt+1),this.emplace(tt,e,r,a,d,_,y,b,T,C,E,L,F,N,V,Z,J,ee,de,oe,me,Se,Oe,ct,_t,at,ot,Ye,ft)}emplace(e,r,a,d,_,y,b,T,C,E,L,F,N,V,Z,J,ee,de,oe,me,Se,Oe,ct,_t,at,ot,Ye,ft,tt){const Ge=32*e,Tt=16*e;return this.int16[Ge+0]=r,this.int16[Ge+1]=a,this.int16[Ge+2]=d,this.int16[Ge+3]=_,this.int16[Ge+4]=y,this.int16[Ge+5]=b,this.int16[Ge+6]=T,this.int16[Ge+7]=C,this.uint16[Ge+8]=E,this.uint16[Ge+9]=L,this.uint16[Ge+10]=F,this.uint16[Ge+11]=N,this.uint16[Ge+12]=V,this.uint16[Ge+13]=Z,this.uint16[Ge+14]=J,this.uint16[Ge+15]=ee,this.uint16[Ge+16]=de,this.uint16[Ge+17]=oe,this.uint16[Ge+18]=me,this.uint16[Ge+19]=Se,this.uint16[Ge+20]=Oe,this.uint16[Ge+21]=ct,this.uint16[Ge+22]=_t,this.uint32[Tt+12]=at,this.float32[Tt+13]=ot,this.float32[Tt+14]=Ye,this.uint16[Ge+30]=ft,this.uint16[Ge+31]=tt,e}}w.prototype.bytesPerElement=64,ht("StructArrayLayout8i15ui1ul2f2ui64",w);class k extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}k.prototype.bytesPerElement=4,ht("StructArrayLayout1f4",k);class A extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.uint16[6*e+0]=r,this.float32[_+1]=a,this.float32[_+2]=d,e}}A.prototype.bytesPerElement=12,ht("StructArrayLayout1ui2f12",A);class P extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=4*e;return this.uint32[2*e+0]=r,this.uint16[_+2]=a,this.uint16[_+3]=d,e}}P.prototype.bytesPerElement=8,ht("StructArrayLayout1ul2ui8",P);class z extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,e}}z.prototype.bytesPerElement=4,ht("StructArrayLayout2ui4",z);class O extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}O.prototype.bytesPerElement=2,ht("StructArrayLayout1ui2",O);class X extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,d)}emplace(e,r,a,d,_){const y=4*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=d,this.float32[y+3]=_,e}}X.prototype.bytesPerElement=16,ht("StructArrayLayout4f16",X);class G extends Po{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ie(this.anchorPointX,this.anchorPointY)}}G.prototype.size=20;class $ extends t{get(e){return new G(this,e)}}ht("CollisionBoxArray",$);class q extends Po{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}q.prototype.size=48;class le extends x{get(e){return new q(this,e)}}ht("PlacedSymbolArray",le);class xe extends Po{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}xe.prototype.size=64;class Q extends w{get(e){return new xe(this,e)}}ht("SymbolInstanceArray",Q);class ue extends k{getoffsetX(e){return this.float32[1*e+0]}}ht("GlyphOffsetArray",ue);class ke extends Ls{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ht("SymbolLineVertexArray",ke);class Me extends Po{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Me.prototype.size=12;class Re extends A{get(e){return new Me(this,e)}}ht("TextAnchorOffsetArray",Re);class Ze extends Po{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ze.prototype.size=8;class Ve extends P{get(e){return new Ze(this,e)}}ht("FeatureIndexArray",Ve);class Ke extends zs{}class mt extends zs{}class Yt extends zs{}class nt extends kl{}class Ct extends Il{}class gt extends os{}class bi extends Ml{}class Jt extends Cl{}class Zt extends mi{}class Qt extends m{}class Ki extends o{}class Ci extends f{}class Sr extends g{}class lr extends z{}const er=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:un}=er;class Ei{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,d){let _=this.segments[this.segments.length-1];return e>Ei.MAX_VERTEX_ARRAY_LENGTH&&bt(`Max vertices per segment is ${Ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!_||_.vertexLength+e>Ei.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,d){return new Ei([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])}}function Vn(i,e){return 256*(i=ze(Math.floor(i),0,255))+ze(Math.floor(e),0,255)}Ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ht("SegmentVector",Ei);const Un=Oi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var go={exports:{}},Lo={exports:{}};Lo.exports=function(i,e){var r,a,d,_,y,b,T,C;for(a=i.length-(r=3&i.length),d=e,y=3432918353,b=461845907,C=0;C<a;)T=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,d=27492+(65535&(_=5*(65535&(d=(d^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(T=0,r){case 3:T^=(255&i.charCodeAt(C+2))<<16;case 2:T^=(255&i.charCodeAt(C+1))<<8;case 1:d^=T=(65535&(T=(T=(65535&(T^=255&i.charCodeAt(C)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var ss=Lo.exports,Ar={exports:{}};Ar.exports=function(i,e){for(var r,a=i.length,d=e^a,_=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(r>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++_;switch(a){case 3:d^=(255&i.charCodeAt(_+2))<<16;case 2:d^=(255&i.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Tr=ss,Rr=Ar.exports;go.exports=Tr,go.exports.murmur3=Tr,go.exports.murmur2=Rr;var Do=M(go.exports);class Ji{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,d){this.ids.push(cr(e)),this.positions.push(r,a,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=cr(e);let a=0,d=this.ids.length-1;for(;a<d;){const y=a+d>>1;this.ids[y]>=r?d=y:a=y+1}const _=[];for(;this.ids[a]===r;)_.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return _}static serialize(e,r){const a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Gr(a,d,0,a.length-1),r&&r.push(a.buffer,d.buffer),{ids:a,positions:d}}static deserialize(e){const r=new Ji;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function cr(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Do(String(i))}function Gr(i,e,r,a){for(;r<a;){const d=i[r+a>>1];let _=r-1,y=a+1;for(;;){do _++;while(i[_]<d);do y--;while(i[y]>d);if(_>=y)break;Yi(i,_,y),Yi(e,3*_,3*y),Yi(e,3*_+1,3*y+1),Yi(e,3*_+2,3*y+2)}y-r<a-y?(Gr(i,e,r,y),r=y+1):(Gr(i,e,y+1,a),a=y)}}function Yi(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}ht("FeaturePositionMap",Ji);class Bo{constructor(e,r){this.gl=e.gl,this.location=r}}class ga extends Bo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class iu extends Bo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ru extends Bo{constructor(e,r){super(e,r),this.current=vi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const sh=new Float32Array(16);function Al(i){return[Vn(255*i.r,255*i.g),Vn(255*i.b,255*i.a)]}class jn{constructor(e,r,a){this.value=e,this.uniformNames=r.map(d=>`u_${d}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new ru(e,r):new ga(e,r)}}class Fo{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,d){const _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&e.set(_)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new iu(e,r):new ga(e,r)}}class qn{constructor(e,r,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,a,d,_){const y=this.paintVertexArray.length,b=this.expression.evaluate(new Ai(0),r,{},d,[],_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,a,d){const _=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(e,r,_)}_setPaintValue(e,r,a){if(this.type==="color"){const d=Al(a);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sn{constructor(e,r,a,d,_,y){this.expression=e,this.uniformNames=r.map(b=>`u_${b}_t`),this.type=a,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=r.map(b=>({name:`a_${b}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,r,a,d,_){const y=this.expression.evaluate(new Ai(this.zoom),r,{},d,[],_),b=this.expression.evaluate(new Ai(this.zoom+1),r,{},d,[],_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,b)}updatePaintArray(e,r,a,d){const _=this.expression.evaluate({zoom:this.zoom},a,d),y=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(e,r,_,y)}_setPaintValue(e,r,a,d){if(this.type==="color"){const _=Al(a),y=Al(d);for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,_[0],_[1],y[0],y[1])}else{for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=ze(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,r,a){return new ga(e,r)}}class Zn{constructor(e,r,a,d,_,y){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,a){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,d,_){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(e,r,a,d){if(!d||!a)return;const{min:_,mid:y,max:b}=a,T=d[_],C=d[y],E=d[b];if(T&&C&&E)for(let L=e;L<r;L++)this.zoomInPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],C.pixelRatio,E.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Un.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Un.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class El{constructor(e,r,a){this.binders={},this._buffers=[];const d=[];for(const _ in e.paint._values){if(!a(_))continue;const y=e.paint.get(_);if(!(y instanceof Fr&&Qo(y.property.specification)))continue;const b=Wm(_,e.type),T=y.value,C=y.property.specification.type,E=y.property.useIntegerZoom,L=y.property.specification["property-type"],F=L==="cross-faded"||L==="cross-faded-data-driven";if(T.kind==="constant")this.binders[_]=F?new Fo(T.value,b):new jn(T.value,b,C),d.push(`/u_${_}`);else if(T.kind==="source"||F){const N=Md(_,C,"source");this.binders[_]=F?new Zn(T,C,E,r,N,e.id):new qn(T,b,C,N),d.push(`/a_${_}`)}else{const N=Md(_,C,"composite");this.binders[_]=new Sn(T,b,C,E,r,N),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof qn||r instanceof Sn?r.maxValue:0}populatePaintArrays(e,r,a,d,_){for(const y in this.binders){const b=this.binders[y];(b instanceof qn||b instanceof Sn||b instanceof Zn)&&b.populatePaintArray(e,r,a,d,_)}}setConstantPatternPositions(e,r){for(const a in this.binders){const d=this.binders[a];d instanceof Fo&&d.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,d,_){let y=!1;for(const b in e){const T=r.getPositions(b);for(const C of T){const E=a.feature(C.index);for(const L in this.binders){const F=this.binders[L];if((F instanceof qn||F instanceof Sn||F instanceof Zn)&&F.expression.isStateDependent===!0){const N=d.paint.get(L);F.expression=N.value,F.updatePaintArray(C.start,C.end,E,e[b],_),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof jn||a instanceof Fo)&&e.push(...a.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof qn||a instanceof Sn)for(let d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name);else if(a instanceof Zn)for(let d=0;d<Un.members.length;d++)e.push(Un.members[d].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof jn||a instanceof Fo||a instanceof Sn)for(const d of a.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof jn||_ instanceof Fo||_ instanceof Sn){for(const y of _.uniformNames)if(r[y]){const b=_.getBinding(e,r[y],y);a.push({name:y,property:d,binding:b})}}}return a}setUniforms(e,r,a,d){for(const{name:_,property:y,binding:b}of r)this.binders[y].setUniform(b,d,a.get(y),_)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof Zn){const d=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof qn||a instanceof Sn)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof qn||a instanceof Sn||a instanceof Zn)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof qn||r instanceof Sn||r instanceof Zn)&&r.destroy()}}}class no{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new El(d,r,a);this.needsUpload=!1,this._featureMap=new Ji,this._bufferOffset=0}populatePaintArrays(e,r,a,d,_,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,d,_,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,d){for(const _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Wm(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Md(i,e,r){const a={color:{source:os,composite:X},number:{source:k,composite:os}},d=function(_){return{"line-pattern":{source:bi,composite:bi},"fill-pattern":{source:bi,composite:bi},"fill-extrusion-pattern":{source:bi,composite:bi}}[_]}(i);return d&&d[r]||a[e][r]}ht("ConstantBinder",jn),ht("CrossFadedConstantBinder",Fo),ht("SourceExpressionBinder",qn),ht("CrossFadedCompositeBinder",Zn),ht("CompositeExpressionBinder",Sn),ht("ProgramConfiguration",El,{omit:["_buffers"]}),ht("ProgramConfigurationSet",no);const or=8192,ah=Math.pow(2,14)-1,Cd=-ah-1;function Ds(i){const e=or/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const d=r[a];for(let _=0;_<d.length;_++){const y=d[_],b=Math.round(y.x*e),T=Math.round(y.y*e);y.x=ze(b,Cd,ah),y.y=ze(T,Cd,ah),(b<y.x||b>y.x+1||T<y.y||T>y.y+1)&&bt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Bs(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ds(i):[]}}function nu(i,e,r,a,d){i.emplaceBack(2*e+(a+1)/2,2*r+(d+1)/2)}class lh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new mt,this.indexArray=new Sr,this.segments=new Ei,this.programConfigurations=new no(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const d=this.layers[0],_=[];let y=null,b=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),b=!y.isConstant());for(const{feature:T,id:C,index:E,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,N=Bs(T,F);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),N,a))continue;const V=b?y.evaluate(N,{},a):void 0,Z={id:C,properties:T.properties,type:T.type,sourceLayerIndex:L,index:E,geometry:F?N.geometry:Ds(T),patterns:{},sortKey:V};_.push(Z)}b&&_.sort((T,C)=>T.sortKey-C.sortKey);for(const T of _){const{geometry:C,index:E,sourceLayerIndex:L}=T,F=e[E].feature;this.addFeature(T,C,E,a),r.featureIndex.insert(F,C,E,L,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,un),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,d){for(const _ of r)for(const y of _){const b=y.x,T=y.y;if(b<0||b>=or||T<0||T>=or)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=C.vertexLength;nu(this.layoutVertexArray,b,T,-1,-1),nu(this.layoutVertexArray,b,T,1,-1),nu(this.layoutVertexArray,b,T,1,1),nu(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d)}}function Ad(i,e){for(let r=0;r<i.length;r++)if(ya(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ya(i,e[r]))return!0;return!!ch(i,e)}function Hm(i,e,r){return!!ya(i,e)||!!uh(e,i,r)}function Ed(i,e){if(i.length===1)return zd(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let d=0;d<a.length;d++)if(ya(i,a[d]))return!0}for(let r=0;r<i.length;r++)if(zd(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ch(i,e[r]))return!0;return!1}function $m(i,e,r){if(i.length>1){if(ch(i,e))return!0;for(let a=0;a<e.length;a++)if(uh(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(uh(i[a],e,r))return!0;return!1}function ch(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],d=i[r+1];for(let _=0;_<e.length-1;_++)if(Km(a,d,e[_],e[_+1]))return!0}return!1}function Km(i,e,r,a){return it(i,r,a)!==it(e,r,a)&&it(i,e,r)!==it(i,e,a)}function uh(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let d=1;d<e.length;d++)if(Pd(i,e[d-1],e[d])<a)return!0;return!1}function Pd(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const d=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(d<0?e:d>1?r:r.sub(e)._mult(d)._add(e))}function zd(i,e){let r,a,d,_=!1;for(let y=0;y<i.length;y++){r=i[y];for(let b=0,T=r.length-1;b<r.length;T=b++)a=r[b],d=r[T],a.y>e.y!=d.y>e.y&&e.x<(d.x-a.x)*(e.y-a.y)/(d.y-a.y)+a.x&&(_=!_)}return _}function ya(i,e){let r=!1;for(let a=0,d=i.length-1;a<i.length;d=a++){const _=i[a],y=i[d];_.y>e.y!=y.y>e.y&&e.x<(y.x-_.x)*(e.y-_.y)/(y.y-_.y)+_.x&&(r=!r)}return r}function Jm(i,e,r){const a=r[0],d=r[2];if(i.x<a.x&&e.x<a.x||i.x>d.x&&e.x>d.x||i.y<a.y&&e.y<a.y||i.y>d.y&&e.y>d.y)return!1;const _=it(i,e,r[0]);return _!==it(i,e,r[1])||_!==it(i,e,r[2])||_!==it(i,e,r[3])}function Pl(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function ou(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function su(i,e,r,a,d){if(!e[0]&&!e[1])return i;const _=ie.convert(e)._mult(d);r==="viewport"&&_._rotate(-a);const y=[];for(let b=0;b<i.length;b++)y.push(i[b].sub(_));return y}let Ld,Dd;ht("CircleBucket",lh,{omit:["layers"]});var Ym={get paint(){return Dd=Dd||new Qi({"circle-radius":new Mt(Pe.paint_circle["circle-radius"]),"circle-color":new Mt(Pe.paint_circle["circle-color"]),"circle-blur":new Mt(Pe.paint_circle["circle-blur"]),"circle-opacity":new Mt(Pe.paint_circle["circle-opacity"]),"circle-translate":new wt(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mt(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return Ld=Ld||new Qi({"circle-sort-key":new Mt(Pe.layout_circle["circle-sort-key"])})}},Xr=1e-6,va=typeof Float32Array<"u"?Float32Array:Array;function hh(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Bd(i,e,r){var a=e[0],d=e[1],_=e[2],y=e[3],b=e[4],T=e[5],C=e[6],E=e[7],L=e[8],F=e[9],N=e[10],V=e[11],Z=e[12],J=e[13],ee=e[14],de=e[15],oe=r[0],me=r[1],Se=r[2],Oe=r[3];return i[0]=oe*a+me*b+Se*L+Oe*Z,i[1]=oe*d+me*T+Se*F+Oe*J,i[2]=oe*_+me*C+Se*N+Oe*ee,i[3]=oe*y+me*E+Se*V+Oe*de,i[4]=(oe=r[4])*a+(me=r[5])*b+(Se=r[6])*L+(Oe=r[7])*Z,i[5]=oe*d+me*T+Se*F+Oe*J,i[6]=oe*_+me*C+Se*N+Oe*ee,i[7]=oe*y+me*E+Se*V+Oe*de,i[8]=(oe=r[8])*a+(me=r[9])*b+(Se=r[10])*L+(Oe=r[11])*Z,i[9]=oe*d+me*T+Se*F+Oe*J,i[10]=oe*_+me*C+Se*N+Oe*ee,i[11]=oe*y+me*E+Se*V+Oe*de,i[12]=(oe=r[12])*a+(me=r[13])*b+(Se=r[14])*L+(Oe=r[15])*Z,i[13]=oe*d+me*T+Se*F+Oe*J,i[14]=oe*_+me*C+Se*N+Oe*ee,i[15]=oe*y+me*E+Se*V+Oe*de,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var zl,Qm=Bd;function au(i,e,r){var a=e[0],d=e[1],_=e[2],y=e[3];return i[0]=r[0]*a+r[4]*d+r[8]*_+r[12]*y,i[1]=r[1]*a+r[5]*d+r[9]*_+r[13]*y,i[2]=r[2]*a+r[6]*d+r[10]*_+r[14]*y,i[3]=r[3]*a+r[7]*d+r[11]*_+r[15]*y,i}zl=new va(4),va!=Float32Array&&(zl[0]=0,zl[1]=0,zl[2]=0,zl[3]=0);class e_ extends wn{constructor(e){super(e,Ym)}createBucket(e){return new lh(e)}queryRadius(e){const r=e;return Pl("circle-radius",this,r)+Pl("circle-stroke-width",this,r)+ou(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,a,d,_,y,b,T){const C=su(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,b),E=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),L=this.paint.get("circle-pitch-alignment")==="map",F=L?C:function(V,Z){return V.map(J=>Fd(J,Z))}(C,T),N=L?E*b:E;for(const V of d)for(const Z of V){const J=L?Z:Fd(Z,T);let ee=N;const de=au([],[Z.x,Z.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=de[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=y.cameraToCenterDistance/de[3]),Hm(F,J,ee))return!0}return!1}}function Fd(i,e){const r=au([],[i.x,i.y,0,1],e);return new ie(r[0]/r[3],r[1]/r[3])}class Rd extends lh{}let Od;ht("HeatmapBucket",Rd,{omit:["layers"]});var t_={get paint(){return Od=Od||new Qi({"heatmap-radius":new Mt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sl(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Pe.paint_heatmap["heatmap-opacity"])})}};function dh(i,{width:e,height:r},a,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*r*a}`)}else d=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=d,i}function Nd(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const d=dh({},{width:e,height:r},a);fh(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=d.data}function fh(i,e,r,a,d,_){if(d.width===0||d.height===0)return e;if(d.width>i.width||d.height>i.height||r.x>i.width-d.width||r.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||a.x>e.width-d.width||a.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,b=e.data;if(y===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<d.height;T++){const C=((r.y+T)*i.width+r.x)*_,E=((a.y+T)*e.width+a.x)*_;for(let L=0;L<d.width*_;L++)b[E+L]=y[C+L]}return e}class Ll{constructor(e,r){dh(this,e,1,r)}resize(e){Nd(this,e,1)}clone(){return new Ll({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,d,_){fh(e,r,a,d,_,1)}}class An{constructor(e,r){dh(this,e,4,r)}resize(e){Nd(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new An({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,d,_){fh(e,r,a,d,_,4)}}function Vd(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,d=i.image||new An({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const _=(y,b,T)=>{e[i.evaluationKey]=T;const C=i.expression.evaluate(e);d.data[y+b+0]=Math.floor(255*C.r/C.a),d.data[y+b+1]=Math.floor(255*C.g/C.a),d.data[y+b+2]=Math.floor(255*C.b/C.a),d.data[y+b+3]=Math.floor(255*C.a)};if(i.clips)for(let y=0,b=0;y<a;++y,b+=4*r)for(let T=0,C=0;T<r;T++,C+=4){const E=T/(r-1),{start:L,end:F}=i.clips[y];_(b,C,L*(1-E)+F*E)}else for(let y=0,b=0;y<r;y++,b+=4)_(0,b,y/(r-1));return d}ht("AlphaImage",Ll),ht("RGBAImage",An);class i_ extends wn{createBucket(e){return new Rd(e)}constructor(e){super(e,t_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Ud;var r_={get paint(){return Ud=Ud||new Qi({"hillshade-illumination-direction":new wt(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Pe.paint_hillshade["hillshade-accent-color"])})}};class n_ extends wn{constructor(e){super(e,r_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const o_=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:s_}=o_;var ph={exports:{}};function lu(i,e,r){r=r||2;var a,d,_,y,b,T,C,E=e&&e.length,L=E?e[0]*r:i.length,F=jd(i,0,L,r,!0),N=[];if(!F||F.next===F.prev)return N;if(E&&(F=function(Z,J,ee,de){var oe,me,Se,Oe=[];for(oe=0,me=J.length;oe<me;oe++)(Se=jd(Z,J[oe]*de,oe<me-1?J[oe+1]*de:Z.length,de,!1))===Se.next&&(Se.steiner=!0),Oe.push(p_(Se));for(Oe.sort(h_),oe=0;oe<Oe.length;oe++)ee=d_(Oe[oe],ee);return ee}(i,e,F,r)),i.length>80*r){a=_=i[0],d=y=i[1];for(var V=r;V<L;V+=r)(b=i[V])<a&&(a=b),(T=i[V+1])<d&&(d=T),b>_&&(_=b),T>y&&(y=T);C=(C=Math.max(_-a,y-d))!==0?32767/C:0}return Dl(F,N,r,a,d,C,0),N}function jd(i,e,r,a,d){var _,y;if(d===gh(i,e,r,a)>0)for(_=e;_<r;_+=a)y=Gd(_,i[_],i[_+1],y);else for(_=r-a;_>=e;_-=a)y=Gd(_,i[_],i[_+1],y);return y&&cu(y,y.next)&&(Fl(y),y=y.next),y}function Fs(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!cu(a,a.next)&&tr(a.prev,a,a.next)!==0)a=a.next;else{if(Fl(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Dl(i,e,r,a,d,_,y){if(i){!y&&_&&function(E,L,F,N){var V=E;do V.z===0&&(V.z=mh(V.x,V.y,L,F,N)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==E);V.prevZ.nextZ=null,V.prevZ=null,function(Z){var J,ee,de,oe,me,Se,Oe,ct,_t=1;do{for(ee=Z,Z=null,me=null,Se=0;ee;){for(Se++,de=ee,Oe=0,J=0;J<_t&&(Oe++,de=de.nextZ);J++);for(ct=_t;Oe>0||ct>0&&de;)Oe!==0&&(ct===0||!de||ee.z<=de.z)?(oe=ee,ee=ee.nextZ,Oe--):(oe=de,de=de.nextZ,ct--),me?me.nextZ=oe:Z=oe,oe.prevZ=me,me=oe;ee=de}me.nextZ=null,_t*=2}while(Se>1)}(V)}(i,a,d,_);for(var b,T,C=i;i.prev!==i.next;)if(b=i.prev,T=i.next,_?l_(i,a,d,_):a_(i))e.push(b.i/r|0),e.push(i.i/r|0),e.push(T.i/r|0),Fl(i),i=T.next,C=T.next;else if((i=T)===C){y?y===1?Dl(i=c_(Fs(i),e,r),e,r,a,d,_,2):y===2&&u_(i,e,r,a,d,_):Dl(Fs(i),e,r,a,d,_,1);break}}}function a_(i){var e=i.prev,r=i,a=i.next;if(tr(e,r,a)>=0)return!1;for(var d=e.x,_=r.x,y=a.x,b=e.y,T=r.y,C=a.y,E=d<_?d<y?d:y:_<y?_:y,L=b<T?b<C?b:C:T<C?T:C,F=d>_?d>y?d:y:_>y?_:y,N=b>T?b>C?b:C:T>C?T:C,V=a.next;V!==e;){if(V.x>=E&&V.x<=F&&V.y>=L&&V.y<=N&&ba(d,b,_,T,y,C,V.x,V.y)&&tr(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function l_(i,e,r,a){var d=i.prev,_=i,y=i.next;if(tr(d,_,y)>=0)return!1;for(var b=d.x,T=_.x,C=y.x,E=d.y,L=_.y,F=y.y,N=b<T?b<C?b:C:T<C?T:C,V=E<L?E<F?E:F:L<F?L:F,Z=b>T?b>C?b:C:T>C?T:C,J=E>L?E>F?E:F:L>F?L:F,ee=mh(N,V,e,r,a),de=mh(Z,J,e,r,a),oe=i.prevZ,me=i.nextZ;oe&&oe.z>=ee&&me&&me.z<=de;){if(oe.x>=N&&oe.x<=Z&&oe.y>=V&&oe.y<=J&&oe!==d&&oe!==y&&ba(b,E,T,L,C,F,oe.x,oe.y)&&tr(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,me.x>=N&&me.x<=Z&&me.y>=V&&me.y<=J&&me!==d&&me!==y&&ba(b,E,T,L,C,F,me.x,me.y)&&tr(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;oe&&oe.z>=ee;){if(oe.x>=N&&oe.x<=Z&&oe.y>=V&&oe.y<=J&&oe!==d&&oe!==y&&ba(b,E,T,L,C,F,oe.x,oe.y)&&tr(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;me&&me.z<=de;){if(me.x>=N&&me.x<=Z&&me.y>=V&&me.y<=J&&me!==d&&me!==y&&ba(b,E,T,L,C,F,me.x,me.y)&&tr(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function c_(i,e,r){var a=i;do{var d=a.prev,_=a.next.next;!cu(d,_)&&qd(d,a,a.next,_)&&Bl(d,_)&&Bl(_,d)&&(e.push(d.i/r|0),e.push(a.i/r|0),e.push(_.i/r|0),Fl(a),Fl(a.next),a=i=_),a=a.next}while(a!==i);return Fs(a)}function u_(i,e,r,a,d,_){var y=i;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&m_(y,b)){var T=Zd(y,b);return y=Fs(y,y.next),T=Fs(T,T.next),Dl(y,e,r,a,d,_,0),void Dl(T,e,r,a,d,_,0)}b=b.next}y=y.next}while(y!==i)}function h_(i,e){return i.x-e.x}function d_(i,e){var r=function(d,_){var y,b=_,T=d.x,C=d.y,E=-1/0;do{if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){var L=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(L<=T&&L>E&&(E=L,y=b.x<b.next.x?b:b.next,L===T))return y}b=b.next}while(b!==_);if(!y)return null;var F,N=y,V=y.x,Z=y.y,J=1/0;b=y;do T>=b.x&&b.x>=V&&T!==b.x&&ba(C<Z?T:E,C,V,Z,C<Z?E:T,C,b.x,b.y)&&(F=Math.abs(C-b.y)/(T-b.x),Bl(b,d)&&(F<J||F===J&&(b.x>y.x||b.x===y.x&&f_(y,b)))&&(y=b,J=F)),b=b.next;while(b!==N);return y}(i,e);if(!r)return e;var a=Zd(r,i);return Fs(a,a.next),Fs(r,r.next)}function f_(i,e){return tr(i.prev,i,e.prev)<0&&tr(e.next,i,i.next)<0}function mh(i,e,r,a,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p_(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ba(i,e,r,a,d,_,y,b){return(d-y)*(e-b)>=(i-y)*(_-b)&&(i-y)*(a-b)>=(r-y)*(e-b)&&(r-y)*(_-b)>=(d-y)*(a-b)}function m_(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==a.i&&d.next.i!==a.i&&qd(d,d.next,r,a))return!0;d=d.next}while(d!==r);return!1}(i,e)&&(Bl(i,e)&&Bl(e,i)&&function(r,a){var d=r,_=!1,y=(r.x+a.x)/2,b=(r.y+a.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==r);return _}(i,e)&&(tr(i.prev,i,e.prev)||tr(i,e.prev,e))||cu(i,e)&&tr(i.prev,i,i.next)>0&&tr(e.prev,e,e.next)>0)}function tr(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function cu(i,e){return i.x===e.x&&i.y===e.y}function qd(i,e,r,a){var d=hu(tr(i,e,r)),_=hu(tr(i,e,a)),y=hu(tr(r,a,i)),b=hu(tr(r,a,e));return d!==_&&y!==b||!(d!==0||!uu(i,r,e))||!(_!==0||!uu(i,a,e))||!(y!==0||!uu(r,i,a))||!(b!==0||!uu(r,e,a))}function uu(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function hu(i){return i>0?1:i<0?-1:0}function Bl(i,e){return tr(i.prev,i,i.next)<0?tr(i,e,i.next)>=0&&tr(i,i.prev,e)>=0:tr(i,e,i.prev)<0||tr(i,i.next,e)<0}function Zd(i,e){var r=new _h(i.i,i.x,i.y),a=new _h(e.i,e.x,e.y),d=i.next,_=e.prev;return i.next=e,e.prev=i,r.next=d,d.prev=r,a.next=r,r.prev=a,_.next=a,a.prev=_,a}function Gd(i,e,r,a){var d=new _h(i,e,r);return a?(d.next=a.next,d.prev=a,a.next.prev=d,a.next=d):(d.prev=d,d.next=d),d}function Fl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function _h(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gh(i,e,r,a){for(var d=0,_=e,y=r-a;_<r;_+=a)d+=(i[y]-i[_])*(i[_+1]+i[y+1]),y=_;return d}ph.exports=lu,ph.exports.default=lu,lu.deviation=function(i,e,r,a){var d=e&&e.length,_=Math.abs(gh(i,0,d?e[0]*r:i.length,r));if(d)for(var y=0,b=e.length;y<b;y++)_-=Math.abs(gh(i,e[y]*r,y<b-1?e[y+1]*r:i.length,r));var T=0;for(y=0;y<a.length;y+=3){var C=a[y]*r,E=a[y+1]*r,L=a[y+2]*r;T+=Math.abs((i[C]-i[L])*(i[E+1]-i[C+1])-(i[C]-i[E])*(i[L+1]-i[C+1]))}return _===0&&T===0?0:Math.abs((T-_)/_)},lu.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,d=0;d<i.length;d++){for(var _=0;_<i[d].length;_++)for(var y=0;y<e;y++)r.vertices.push(i[d][_][y]);d>0&&r.holes.push(a+=i[d-1].length)}return r};var Xd=M(ph.exports);function __(i,e,r,a,d){Wd(i,e,r||0,a||i.length-1,d||g_)}function Wd(i,e,r,a,d){for(;a>r;){if(a-r>600){var _=a-r+1,y=e-r+1,b=Math.log(_),T=.5*Math.exp(2*b/3),C=.5*Math.sqrt(b*T*(_-T)/_)*(y-_/2<0?-1:1);Wd(i,e,Math.max(r,Math.floor(e-y*T/_+C)),Math.min(a,Math.floor(e+(_-y)*T/_+C)),d)}var E=i[e],L=r,F=a;for(Rl(i,r,e),d(i[a],E)>0&&Rl(i,r,a);L<F;){for(Rl(i,L,F),L++,F--;d(i[L],E)<0;)L++;for(;d(i[F],E)>0;)F--}d(i[r],E)===0?Rl(i,r,F):Rl(i,++F,a),F<=e&&(r=F+1),e<=F&&(a=F-1)}}function Rl(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function g_(i,e){return i<e?-1:i>e?1:0}function yh(i,e){const r=i.length;if(r<=1)return[i];const a=[];let d,_;for(let y=0;y<r;y++){const b=dt(i[y]);b!==0&&(i[y].area=Math.abs(b),_===void 0&&(_=b<0),_===b<0?(d&&a.push(d),d=[i[y]]):d.push(i[y]))}if(d&&a.push(d),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(__(a[y],e,1,a[y].length-1,y_),a[y]=a[y].slice(0,e));return a}function y_(i,e){return e.area-i.area}function vh(i,e,r){const a=r.patternDependencies;let d=!1;for(const _ of e){const y=_.paint.get(`${i}-pattern`);y.isConstant()||(d=!0);const b=y.constantOr(null);b&&(d=!0,a[b.to]=!0,a[b.from]=!0)}return d}function bh(i,e,r,a,d){const _=d.patternDependencies;for(const y of e){const b=y.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:a-1},r,{},d.availableImages),C=b.evaluate({zoom:a},r,{},d.availableImages),E=b.evaluate({zoom:a+1},r,{},d.availableImages);T=T&&T.name?T.name:T,C=C&&C.name?C.name:C,E=E&&E.name?E.name:E,_[T]=!0,_[C]=!0,_[E]=!0,r.patterns[y.id]={min:T,mid:C,max:E}}}return r}class xh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yt,this.indexArray=new Sr,this.indexArray2=new lr,this.programConfigurations=new no(e.layers,e.zoom),this.segments=new Ei,this.segments2=new Ei,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=vh("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),y=[];for(const{feature:b,id:T,index:C,sourceLayerIndex:E}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Bs(b,L);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),F,a))continue;const N=_?d.evaluate(F,{},a,r.availableImages):void 0,V={id:T,properties:b.properties,type:b.type,sourceLayerIndex:E,index:C,geometry:L?F.geometry:Ds(b),patterns:{},sortKey:N};y.push(V)}_&&y.sort((b,T)=>b.sortKey-T.sortKey);for(const b of y){const{geometry:T,index:C,sourceLayerIndex:E}=b;if(this.hasPattern){const L=bh("fill",this.layers,b,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(b,T,C,a,{});r.featureIndex.insert(e[C].feature,T,C,E,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,s_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,d,_){for(const y of yh(r,500)){let b=0;for(const N of y)b+=N.length;const T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),C=T.vertexLength,E=[],L=[];for(const N of y){if(N.length===0)continue;N!==y[0]&&L.push(E.length/2);const V=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),Z=V.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(Z+N.length-1,Z),E.push(N[0].x),E.push(N[0].y);for(let J=1;J<N.length;J++)this.layoutVertexArray.emplaceBack(N[J].x,N[J].y),this.indexArray2.emplaceBack(Z+J-1,Z+J),E.push(N[J].x),E.push(N[J].y);V.vertexLength+=N.length,V.primitiveLength+=N.length}const F=Xd(E,L);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(C+F[N],C+F[N+1],C+F[N+2]);T.vertexLength+=b,T.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)}}let Hd,$d;ht("FillBucket",xh,{omit:["layers","patternFeatures"]});var v_={get paint(){return $d=$d||new Qi({"fill-antialias":new wt(Pe.paint_fill["fill-antialias"]),"fill-opacity":new Mt(Pe.paint_fill["fill-opacity"]),"fill-color":new Mt(Pe.paint_fill["fill-color"]),"fill-outline-color":new Mt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new wt(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ps(Pe.paint_fill["fill-pattern"])})},get layout(){return Hd=Hd||new Qi({"fill-sort-key":new Mt(Pe.layout_fill["fill-sort-key"])})}};class b_ extends wn{constructor(e){super(e,v_)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new xh(e)}queryRadius(){return ou(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,a,d,_,y,b){return Ed(su(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,b),d)}isTileClipped(){return!0}}const x_=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),w_=Oi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:S_}=x_;var as={},T_=B,Kd=xa;function xa(i,e,r,a,d){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=d,i.readFields(k_,this,e)}function k_(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,d){for(var _=a.readVarint()+a.pos;a.pos<_;){var y=d._keys[a.readVarint()],b=d._values[a.readVarint()];d.properties[y]=b}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function I_(i){for(var e,r,a=0,d=0,_=i.length,y=_-1;d<_;y=d++)a+=((r=i[y]).x-(e=i[d]).x)*(e.y+r.y);return a}xa.types=["Unknown","Point","LineString","Polygon"],xa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,d=0,_=0,y=0,b=[];i.pos<r;){if(d<=0){var T=i.readVarint();a=7&T,d=T>>3}if(d--,a===1||a===2)_+=i.readSVarint(),y+=i.readSVarint(),a===1&&(e&&b.push(e),e=[]),e.push(new T_(_,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&b.push(e),b},xa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,d=0,_=0,y=1/0,b=-1/0,T=1/0,C=-1/0;i.pos<e;){if(a<=0){var E=i.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(d+=i.readSVarint())<y&&(y=d),d>b&&(b=d),(_+=i.readSVarint())<T&&(T=_),_>C&&(C=_);else if(r!==7)throw new Error("unknown command "+r)}return[y,T,b,C]},xa.prototype.toGeoJSON=function(i,e,r){var a,d,_=this.extent*Math.pow(2,r),y=this.extent*i,b=this.extent*e,T=this.loadGeometry(),C=xa.types[this.type];function E(N){for(var V=0;V<N.length;V++){var Z=N[V];N[V]=[360*(Z.x+y)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+b)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(a=0;a<T.length;a++)L[a]=T[a][0];E(T=L);break;case 2:for(a=0;a<T.length;a++)E(T[a]);break;case 3:for(T=function(N){var V=N.length;if(V<=1)return[N];for(var Z,J,ee=[],de=0;de<V;de++){var oe=I_(N[de]);oe!==0&&(J===void 0&&(J=oe<0),J===oe<0?(Z&&ee.push(Z),Z=[N[de]]):Z.push(N[de]))}return Z&&ee.push(Z),ee}(T),a=0;a<T.length;a++)for(d=0;d<T[a].length;d++)E(T[a][d])}T.length===1?T=T[0]:C="Multi"+C;var F={type:"Feature",geometry:{type:C,coordinates:T},properties:this.properties};return"id"in this&&(F.id=this.id),F};var M_=Kd,Jd=Yd;function Yd(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(C_,this,e),this.length=this._features.length}function C_(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var d=null,_=a.readVarint()+a.pos;a.pos<_;){var y=a.readVarint()>>3;d=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return d}(r))}Yd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new M_(this._pbf,e,this.extent,this._keys,this._values)};var A_=Jd;function E_(i,e,r){if(i===3){var a=new A_(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}as.VectorTile=function(i,e){this.layers=i.readFields(E_,{},e)},as.VectorTileFeature=Kd,as.VectorTileLayer=Jd;const P_=as.VectorTileFeature.types,wh=Math.pow(2,13);function Ol(i,e,r,a,d,_,y,b){i.emplaceBack(e,r,2*Math.floor(a*wh)+y,d*wh*2,_*wh*2,Math.round(b))}class Sh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new nt,this.centroidVertexArray=new Ke,this.indexArray=new Sr,this.programConfigurations=new no(e.layers,e.zoom),this.segments=new Ei,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=vh("fill-extrusion",this.layers,r);for(const{feature:d,id:_,index:y,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,C=Bs(d,T);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),C,a))continue;const E={id:_,sourceLayerIndex:b,index:y,geometry:T?C.geometry:Ds(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(bh("fill-extrusion",this.layers,E,this.zoom,r)):this.addFeature(E,E.geometry,y,a,{}),r.featureIndex.insert(d,E.geometry,y,b,this.index,!0)}}addFeatures(e,r,a){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S_),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,w_.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,d,_){const y={x:0,y:0,vertexCount:0};for(const b of yh(r,500)){let T=0;for(const V of b)T+=V.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const V of b){if(V.length===0||L_(V))continue;let Z=0;for(let J=0;J<V.length;J++){const ee=V[J];if(J>=1){const de=V[J-1];if(!z_(ee,de)){C.vertexLength+4>Ei.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const oe=ee.sub(de)._perp()._unit(),me=de.dist(ee);Z+me>32768&&(Z=0),Ol(this.layoutVertexArray,ee.x,ee.y,oe.x,oe.y,0,0,Z),Ol(this.layoutVertexArray,ee.x,ee.y,oe.x,oe.y,0,1,Z),y.x+=2*ee.x,y.y+=2*ee.y,y.vertexCount+=2,Z+=me,Ol(this.layoutVertexArray,de.x,de.y,oe.x,oe.y,0,0,Z),Ol(this.layoutVertexArray,de.x,de.y,oe.x,oe.y,0,1,Z),y.x+=2*de.x,y.y+=2*de.y,y.vertexCount+=2;const Se=C.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+T>Ei.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),P_[e.type]!=="Polygon")continue;const E=[],L=[],F=C.vertexLength;for(const V of b)if(V.length!==0){V!==b[0]&&L.push(E.length/2);for(let Z=0;Z<V.length;Z++){const J=V[Z];Ol(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),y.x+=J.x,y.y+=J.y,y.vertexCount+=1,E.push(J.x),E.push(J.y)}}const N=Xd(E,L);for(let V=0;V<N.length;V+=3)this.indexArray.emplaceBack(F+N[V],F+N[V+2],F+N[V+1]);C.primitiveLength+=N.length/3,C.vertexLength+=T}for(let b=0;b<y.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)}}function z_(i,e){return i.x===e.x&&(i.x<0||i.x>or)||i.y===e.y&&(i.y<0||i.y>or)}function L_(i){return i.every(e=>e.x<0)||i.every(e=>e.x>or)||i.every(e=>e.y<0)||i.every(e=>e.y>or)}let Qd;ht("FillExtrusionBucket",Sh,{omit:["layers","features"]});var D_={get paint(){return Qd=Qd||new Qi({"fill-extrusion-opacity":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ps(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class B_ extends wn{constructor(e){super(e,D_)}createBucket(e){return new Sh(e)}queryRadius(){return ou(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,a,d,_,y,b,T){const C=su(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,b),E=this.paint.get("fill-extrusion-height").evaluate(r,a),L=this.paint.get("fill-extrusion-base").evaluate(r,a),F=function(V,Z,J,ee){const de=[];for(const oe of V){const me=[oe.x,oe.y,0,1];au(me,me,Z),de.push(new ie(me[0]/me[3],me[1]/me[3]))}return de}(C,T),N=function(V,Z,J,ee){const de=[],oe=[],me=ee[8]*Z,Se=ee[9]*Z,Oe=ee[10]*Z,ct=ee[11]*Z,_t=ee[8]*J,at=ee[9]*J,ot=ee[10]*J,Ye=ee[11]*J;for(const ft of V){const tt=[],Ge=[];for(const Tt of ft){const yt=Tt.x,Kt=Tt.y,Pi=ee[0]*yt+ee[4]*Kt+ee[12],Di=ee[1]*yt+ee[5]*Kt+ee[13],hr=ee[2]*yt+ee[6]*Kt+ee[14],Tn=ee[3]*yt+ee[7]*Kt+ee[15],Wr=hr+Oe,sr=Tn+ct,kr=Pi+_t,Pr=Di+at,Hr=hr+ot,$r=Tn+Ye,dr=new ie((Pi+me)/sr,(Di+Se)/sr);dr.z=Wr/sr,tt.push(dr);const fr=new ie(kr/$r,Pr/$r);fr.z=Hr/$r,Ge.push(fr)}de.push(tt),oe.push(Ge)}return[de,oe]}(d,L,E,T);return function(V,Z,J){let ee=1/0;Ed(J,Z)&&(ee=ef(J,Z[0]));for(let de=0;de<Z.length;de++){const oe=Z[de],me=V[de];for(let Se=0;Se<oe.length-1;Se++){const Oe=oe[Se],ct=[Oe,oe[Se+1],me[Se+1],me[Se],Oe];Ad(J,ct)&&(ee=Math.min(ee,ef(J,ct)))}}return ee!==1/0&&ee}(N[0],N[1],F)}}function Nl(i,e){return i.x*e.x+i.y*e.y}function ef(i,e){if(i.length===1){let r=0;const a=e[r++];let d;for(;!d||a.equals(d);)if(d=e[r++],!d)return 1/0;for(;r<e.length;r++){const _=e[r],y=i[0],b=d.sub(a),T=_.sub(a),C=y.sub(a),E=Nl(b,b),L=Nl(b,T),F=Nl(T,T),N=Nl(C,b),V=Nl(C,T),Z=E*F-L*L,J=(F*N-L*V)/Z,ee=(E*V-L*N)/Z,de=a.z*(1-J-ee)+d.z*J+_.z*ee;if(isFinite(de))return de}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const F_=Oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:R_}=F_,O_=Oi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:N_}=O_,V_=as.VectorTileFeature.types,U_=Math.cos(Math.PI/180*37.5),tf=Math.pow(2,14)/.5;class Th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ct,this.layoutVertexArray2=new gt,this.indexArray=new Sr,this.programConfigurations=new no(e.layers,e.zoom),this.segments=new Ei,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=vh("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),y=[];for(const{feature:b,id:T,index:C,sourceLayerIndex:E}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Bs(b,L);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),F,a))continue;const N=_?d.evaluate(F,{},a):void 0,V={id:T,properties:b.properties,type:b.type,sourceLayerIndex:E,index:C,geometry:L?F.geometry:Ds(b),patterns:{},sortKey:N};y.push(V)}_&&y.sort((b,T)=>b.sortKey-T.sortKey);for(const b of y){const{geometry:T,index:C,sourceLayerIndex:E}=b;if(this.hasPattern){const L=bh("line",this.layers,b,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(b,T,C,a,{});r.featureIndex.insert(e[C].feature,T,C,E,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,N_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,d,_){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),T=y.get("line-cap"),C=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of r)this.addLine(L,e,b,T,C,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)}addLine(e,r,a,d,_,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=V_[r.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let C=0;for(;C<T-1&&e[C].equals(e[C+1]);)C++;if(T<(b?3:2))return;a==="bevel"&&(_=1.05);const E=this.overscaling<=16?15*or/(512*this.overscaling):0,L=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let F,N,V,Z,J;this.e1=this.e2=-1,b&&(F=e[T-2],J=e[C].sub(F)._unit()._perp());for(let ee=C;ee<T;ee++){if(V=ee===T-1?b?e[C+1]:void 0:e[ee+1],V&&e[ee].equals(V))continue;J&&(Z=J),F&&(N=F),F=e[ee],J=V?V.sub(F)._unit()._perp():Z,Z=Z||J;let de=Z.add(J);de.x===0&&de.y===0||de._unit();const oe=Z.x*J.x+Z.y*J.y,me=de.x*J.x+de.y*J.y,Se=me!==0?1/me:1/0,Oe=2*Math.sqrt(2-2*me),ct=me<U_&&N&&V,_t=Z.x*J.y-Z.y*J.x>0;if(ct&&ee>C){const Ye=F.dist(N);if(Ye>2*E){const ft=F.sub(F.sub(N)._mult(E/Ye)._round());this.updateDistance(N,ft),this.addCurrentVertex(ft,Z,0,0,L),N=ft}}const at=N&&V;let ot=at?a:b?"butt":d;if(at&&ot==="round"&&(Se<y?ot="miter":Se<=2&&(ot="fakeround")),ot==="miter"&&Se>_&&(ot="bevel"),ot==="bevel"&&(Se>2&&(ot="flipbevel"),Se<_&&(ot="miter")),N&&this.updateDistance(N,F),ot==="miter")de._mult(Se),this.addCurrentVertex(F,de,0,0,L);else if(ot==="flipbevel"){if(Se>100)de=J.mult(-1);else{const Ye=Se*Z.add(J).mag()/Z.sub(J).mag();de._perp()._mult(Ye*(_t?-1:1))}this.addCurrentVertex(F,de,0,0,L),this.addCurrentVertex(F,de.mult(-1),0,0,L)}else if(ot==="bevel"||ot==="fakeround"){const Ye=-Math.sqrt(Se*Se-1),ft=_t?Ye:0,tt=_t?0:Ye;if(N&&this.addCurrentVertex(F,Z,ft,tt,L),ot==="fakeround"){const Ge=Math.round(180*Oe/Math.PI/20);for(let Tt=1;Tt<Ge;Tt++){let yt=Tt/Ge;if(yt!==.5){const Pi=yt-.5;yt+=yt*Pi*(yt-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*Pi*Pi+(.848013+oe*(.215638*oe-1.06021)))}const Kt=J.sub(Z)._mult(yt)._add(Z)._unit()._mult(_t?-1:1);this.addHalfVertex(F,Kt.x,Kt.y,!1,_t,0,L)}}V&&this.addCurrentVertex(F,J,-ft,-tt,L)}else if(ot==="butt")this.addCurrentVertex(F,de,0,0,L);else if(ot==="square"){const Ye=N?1:-1;this.addCurrentVertex(F,de,Ye,Ye,L)}else ot==="round"&&(N&&(this.addCurrentVertex(F,Z,0,0,L),this.addCurrentVertex(F,Z,1,1,L,!0)),V&&(this.addCurrentVertex(F,J,-1,-1,L,!0),this.addCurrentVertex(F,J,0,0,L)));if(ct&&ee<T-1){const Ye=F.dist(V);if(Ye>2*E){const ft=F.add(V.sub(F)._mult(E/Ye)._round());this.updateDistance(F,ft),this.addCurrentVertex(ft,J,0,0,L),F=ft}}}}addCurrentVertex(e,r,a,d,_,y=!1){const b=r.y*d-r.x,T=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,y,!1,a,_),this.addHalfVertex(e,b,T,y,!0,-d,_),this.distance>tf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,d,_,y))}addHalfVertex({x:e,y:r},a,d,_,y,b,T){const C=.5*(this.lineClips?this.scaledDistance*(tf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(r<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),T.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let rf,nf;ht("LineBucket",Th,{omit:["layers","patternFeatures"]});var of={get paint(){return nf=nf||new Qi({"line-opacity":new Mt(Pe.paint_line["line-opacity"]),"line-color":new Mt(Pe.paint_line["line-color"]),"line-translate":new wt(Pe.paint_line["line-translate"]),"line-translate-anchor":new wt(Pe.paint_line["line-translate-anchor"]),"line-width":new Mt(Pe.paint_line["line-width"]),"line-gap-width":new Mt(Pe.paint_line["line-gap-width"]),"line-offset":new Mt(Pe.paint_line["line-offset"]),"line-blur":new Mt(Pe.paint_line["line-blur"]),"line-dasharray":new wl(Pe.paint_line["line-dasharray"]),"line-pattern":new Ps(Pe.paint_line["line-pattern"]),"line-gradient":new Sl(Pe.paint_line["line-gradient"])})},get layout(){return rf=rf||new Qi({"line-cap":new wt(Pe.layout_line["line-cap"]),"line-join":new Mt(Pe.layout_line["line-join"]),"line-miter-limit":new wt(Pe.layout_line["line-miter-limit"]),"line-round-limit":new wt(Pe.layout_line["line-round-limit"]),"line-sort-key":new Mt(Pe.layout_line["line-sort-key"])})}};class j_ extends Mt{possiblyEvaluate(e,r){return r=new Ai(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,d){return r=Ae({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,d)}}let du;class q_ extends wn{constructor(e){super(e,of),this.gradientVersion=0,du||(du=new j_(of.paint.properties["line-width"].specification),du.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof fo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=du.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Th(e)}queryRadius(e){const r=e,a=sf(Pl("line-width",this,r),Pl("line-gap-width",this,r)),d=Pl("line-offset",this,r);return a/2+Math.abs(d)+ou(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,a,d,_,y,b){const T=su(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,b),C=b/2*sf(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(d=function(L,F){const N=[];for(let V=0;V<L.length;V++){const Z=L[V],J=[];for(let ee=0;ee<Z.length;ee++){const de=Z[ee-1],oe=Z[ee],me=Z[ee+1],Se=ee===0?new ie(0,0):oe.sub(de)._unit()._perp(),Oe=ee===Z.length-1?new ie(0,0):me.sub(oe)._unit()._perp(),ct=Se._add(Oe)._unit(),_t=ct.x*Oe.x+ct.y*Oe.y;_t!==0&&ct._mult(1/_t),J.push(ct._mult(F)._add(oe))}N.push(J)}return N}(d,E*b)),function(L,F,N){for(let V=0;V<F.length;V++){const Z=F[V];if(L.length>=3){for(let J=0;J<Z.length;J++)if(ya(L,Z[J]))return!0}if($m(L,Z,N))return!0}return!1}(T,d,C)}isTileClipped(){return!0}}function sf(i,e){return e>0?e+2*i:i}const Z_=Oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),G_=Oi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const X_=Oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Oi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const af=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),W_=Oi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function H_(i,e,r){return i.sections.forEach(a=>{a.text=function(d,_,y){const b=_.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),cn.applyArabicShaping&&(d=cn.applyArabicShaping(d)),d}(a.text,e,r)}),i}Oi([{name:"triangle",components:3,type:"Uint16"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Oi([{type:"Float32",name:"offsetX"}]),Oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Oi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Vl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ur=24,lf=wi,cf=function(i,e,r,a,d){var _,y,b=8*d-a-1,T=(1<<b)-1,C=T>>1,E=-7,L=r?d-1:0,F=r?-1:1,N=i[e+L];for(L+=F,_=N&(1<<-E)-1,N>>=-E,E+=b;E>0;_=256*_+i[e+L],L+=F,E-=8);for(y=_&(1<<-E)-1,_>>=-E,E+=a;E>0;y=256*y+i[e+L],L+=F,E-=8);if(_===0)_=1-C;else{if(_===T)return y?NaN:1/0*(N?-1:1);y+=Math.pow(2,a),_-=C}return(N?-1:1)*y*Math.pow(2,_-a)},uf=function(i,e,r,a,d,_){var y,b,T,C=8*_-d-1,E=(1<<C)-1,L=E>>1,F=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=a?0:_-1,V=a?1:-1,Z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,y=E):(y=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-y))<1&&(y--,T*=2),(e+=y+L>=1?F/T:F*Math.pow(2,1-L))*T>=2&&(y++,T/=2),y+L>=E?(b=0,y=E):y+L>=1?(b=(e*T-1)*Math.pow(2,d),y+=L):(b=e*Math.pow(2,L-1)*Math.pow(2,d),y=0));d>=8;i[r+N]=255&b,N+=V,b/=256,d-=8);for(y=y<<d|b,C+=d;C>0;i[r+N]=255&y,N+=V,y/=256,C-=8);i[r+N-V]|=128*Z};function wi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}wi.Varint=0,wi.Fixed64=1,wi.Bytes=2,wi.Fixed32=5;var kh=4294967296,hf=1/kh,df=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ro(i){return i.type===wi.Bytes?i.readVarint()+i.pos:i.pos+1}function wa(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function ff(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var d=r.pos-1;d>=i;d--)r.buf[d+a]=r.buf[d]}function $_(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function K_(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function J_(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Y_(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Q_(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function eg(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function tg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function ig(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function rg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function fu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Sa(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function pf(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}wi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),d=a>>3,_=this.pos;this.type=7&a,i(d,e,this),this.pos===_&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=fu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=pf(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=fu(this.buf,this.pos)+fu(this.buf,this.pos+4)*kh;return this.pos+=8,i},readSFixed64:function(){var i=fu(this.buf,this.pos)+pf(this.buf,this.pos+4)*kh;return this.pos+=8,i},readFloat:function(){var i=cf(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=cf(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(d,_,y){var b,T,C=y.buf;if(b=(112&(T=C[y.pos++]))>>4,T<128||(b|=(127&(T=C[y.pos++]))<<3,T<128)||(b|=(127&(T=C[y.pos++]))<<10,T<128)||(b|=(127&(T=C[y.pos++]))<<17,T<128)||(b|=(127&(T=C[y.pos++]))<<24,T<128)||(b|=(1&(T=C[y.pos++]))<<31,T<128))return wa(d,b,_);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&df?function(r,a,d){return df.decode(r.subarray(a,d))}(this.buf,e,i):function(r,a,d){for(var _="",y=a;y<d;){var b,T,C,E=r[y],L=null,F=E>239?4:E>223?3:E>191?2:1;if(y+F>d)break;F===1?E<128&&(L=E):F===2?(192&(b=r[y+1]))==128&&(L=(31&E)<<6|63&b)<=127&&(L=null):F===3?(T=r[y+2],(192&(b=r[y+1]))==128&&(192&T)==128&&((L=(15&E)<<12|(63&b)<<6|63&T)<=2047||L>=55296&&L<=57343)&&(L=null)):F===4&&(T=r[y+2],C=r[y+3],(192&(b=r[y+1]))==128&&(192&T)==128&&(192&C)==128&&((L=(15&E)<<18|(63&b)<<12|(63&T)<<6|63&C)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,F=1):L>65535&&(L-=65536,_+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),_+=String.fromCharCode(L),y+=F}return _}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==wi.Bytes)return i.push(this.readVarint(e));var r=Ro(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==wi.Bytes)return i.push(this.readSVarint());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==wi.Bytes)return i.push(this.readBoolean());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==wi.Bytes)return i.push(this.readFloat());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==wi.Bytes)return i.push(this.readDouble());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==wi.Bytes)return i.push(this.readFixed32());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==wi.Bytes)return i.push(this.readSFixed32());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==wi.Bytes)return i.push(this.readFixed64());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==wi.Bytes)return i.push(this.readSFixed64());var e=Ro(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===wi.Varint)for(;this.buf[this.pos++]>127;);else if(e===wi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===wi.Fixed32)this.pos+=4;else{if(e!==wi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Sa(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Sa(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Sa(this.buf,-1&i,this.pos),Sa(this.buf,Math.floor(i*hf),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Sa(this.buf,-1&i,this.pos),Sa(this.buf,Math.floor(i*hf),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,d;if(e>=0?(a=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(_,y,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)}(a,0,r),function(_,y){var b=(7&_)<<4;y.buf[y.pos++]|=b|((_>>>=3)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_)))))}(d,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,d,_){for(var y,b,T=0;T<d.length;T++){if((y=d.charCodeAt(T))>55295&&y<57344){if(!b){y>56319||T+1===d.length?(a[_++]=239,a[_++]=191,a[_++]=189):b=y;continue}if(y<56320){a[_++]=239,a[_++]=191,a[_++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(a[_++]=239,a[_++]=191,a[_++]=189,b=null);y<128?a[_++]=y:(y<2048?a[_++]=y>>6|192:(y<65536?a[_++]=y>>12|224:(a[_++]=y>>18|240,a[_++]=y>>12&63|128),a[_++]=y>>6&63|128),a[_++]=63&y|128)}return _}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&ff(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),uf(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),uf(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&ff(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,wi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,$_,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,K_,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Q_,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,J_,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Y_,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,eg,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,tg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,ig,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,rg,e)},writeBytesField:function(i,e){this.writeTag(i,wi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,wi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,wi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,wi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,wi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,wi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,wi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,wi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,wi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,wi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Ih=M(lf);const Mh=3;function ng(i,e,r){i===1&&r.readMessage(og,e)}function og(i,e,r){if(i===3){const{id:a,bitmap:d,width:_,height:y,left:b,top:T,advance:C}=r.readMessage(sg,{});e.push({id:a,bitmap:new Ll({width:_+2*Mh,height:y+2*Mh},d),metrics:{width:_,height:y,left:b,top:T,advance:C}})}}function sg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const mf=Mh;function _f(i){let e=0,r=0;for(const y of i)e+=y.w*y.h,r=Math.max(r,y.w);i.sort((y,b)=>b.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let d=0,_=0;for(const y of i)for(let b=a.length-1;b>=0;b--){const T=a[b];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,_=Math.max(_,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===T.w&&y.h===T.h){const C=a.pop();b<a.length&&(a[b]=C)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(a.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:d,h:_,fill:e/(d*_)||0}}const hn=1;class Ch{constructor(e,{pixelRatio:r,version:a,stretchX:d,stretchY:_,content:y}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=d,this.stretchY=_,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+hn,this.paddedRect.y+hn]}get br(){return[this.paddedRect.x+this.paddedRect.w-hn,this.paddedRect.y+this.paddedRect.h-hn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*hn)/this.pixelRatio,(this.paddedRect.h-2*hn)/this.pixelRatio]}}class gf{constructor(e,r){const a={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,a,_),this.addImages(r,d,_);const{w:y,h:b}=_f(_),T=new An({width:y||1,height:b||1});for(const C in e){const E=e[C],L=a[C].paddedRect;An.copy(E.data,T,{x:0,y:0},{x:L.x+hn,y:L.y+hn},E.data)}for(const C in r){const E=r[C],L=d[C].paddedRect,F=L.x+hn,N=L.y+hn,V=E.data.width,Z=E.data.height;An.copy(E.data,T,{x:0,y:0},{x:F,y:N},E.data),An.copy(E.data,T,{x:0,y:Z-1},{x:F,y:N-1},{width:V,height:1}),An.copy(E.data,T,{x:0,y:0},{x:F,y:N+Z},{width:V,height:1}),An.copy(E.data,T,{x:V-1,y:0},{x:F-1,y:N},{width:1,height:Z}),An.copy(E.data,T,{x:0,y:0},{x:F+V,y:N},{width:1,height:Z})}this.image=T,this.iconPositions=a,this.patternPositions=d}addImages(e,r,a){for(const d in e){const _=e[d],y={x:0,y:0,w:_.data.width+2*hn,h:_.data.height+2*hn};a.push(y),r[d]=new Ch(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[d,_]=e.tl;a.update(r.data,void 0,{x:d,y:_})}}var ls;ht("ImagePosition",Ch),ht("ImageAtlas",gf),s.ai=void 0,(ls=s.ai||(s.ai={}))[ls.none=0]="none",ls[ls.horizontal=1]="horizontal",ls[ls.vertical=2]="vertical",ls[ls.horizontalOnly=3]="horizontalOnly";const Ul=-17;class jl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new jl;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new jl;return r.imageName=e,r}}class Ta{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Ta;for(let d=0;d<e.sections.length;d++){const _=e.sections[d];_.image?a.addImageSection(_):a.addTextSection(_,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const d=e.charCodeAt(a+1)||null,_=e.charCodeAt(a-1)||null;r+=d&&Hc(d)&&!Vl[e[a+1]]||_&&Hc(_)&&!Vl[e[a-1]]||!Vl[e[a]]?e[a]:Vl[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&mu[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&mu[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Ta;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(jl.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void bt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(jl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):bt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pu(i,e,r,a,d,_,y,b,T,C,E,L,F,N,V,Z){const J=Ta.fromFeature(i,d);let ee;L===s.ai.vertical&&J.verticalizePunctuation();const{processBidirectionalText:de,processStyledBidirectionalText:oe}=cn;if(de&&J.sections.length===1){ee=[];const Oe=de(J.toString(),Ah(J,C,_,e,a,N,V));for(const ct of Oe){const _t=new Ta;_t.text=ct,_t.sections=J.sections;for(let at=0;at<ct.length;at++)_t.sectionIndex.push(0);ee.push(_t)}}else if(oe){ee=[];const Oe=oe(J.text,J.sectionIndex,Ah(J,C,_,e,a,N,V));for(const ct of Oe){const _t=new Ta;_t.text=ct[0],_t.sectionIndex=ct[1],_t.sections=J.sections,ee.push(_t)}}else ee=function(Oe,ct){const _t=[],at=Oe.text;let ot=0;for(const Ye of ct)_t.push(Oe.substring(ot,Ye)),ot=Ye;return ot<at.length&&_t.push(Oe.substring(ot,at.length)),_t}(J,Ah(J,C,_,e,a,N,V));const me=[],Se={positionedLines:me,text:J.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(Oe,ct,_t,at,ot,Ye,ft,tt,Ge,Tt,yt,Kt){let Pi=0,Di=Ul,hr=0,Tn=0;const Wr=tt==="right"?1:tt==="left"?0:.5;let sr=0;for(const dr of ot){dr.trim();const fr=dr.getMaxScale(),Or=(fr-1)*ur,Kr={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[sr]=Kr;const Nr=Kr.positionedGlyphs;let dn=0;if(!dr.length()){Di+=Ye,++sr;continue}for(let pr=0;pr<dr.length();pr++){const ii=dr.getSection(pr),Vr=dr.getSectionIndex(pr),zr=dr.getCharCode(pr);let mr=0,Gn=null,oo=null,so=null,Oo=ur;const Xn=!(Ge===s.ai.horizontal||!yt&&!pl(zr)||yt&&(mu[zr]||(kr=zr,lt.Arabic(kr)||lt["Arabic Supplement"](kr)||lt["Arabic Extended-A"](kr)||lt["Arabic Presentation Forms-A"](kr)||lt["Arabic Presentation Forms-B"](kr))));if(ii.imageName){const Pn=at[ii.imageName];if(!Pn)continue;so=ii.imageName,Oe.iconsInText=Oe.iconsInText||!0,oo=Pn.paddedRect;const pn=Pn.displaySize;ii.scale=ii.scale*ur/Kt,Gn={width:pn[0],height:pn[1],left:hn,top:-mf,advance:Xn?pn[1]:pn[0]},mr=Or+(ur-pn[1]*ii.scale),Oo=Gn.advance;const No=Xn?pn[0]*ii.scale-ur*fr:pn[1]*ii.scale-ur*fr;No>0&&No>dn&&(dn=No)}else{const Pn=_t[ii.fontStack],pn=Pn&&Pn[zr];if(pn&&pn.rect)oo=pn.rect,Gn=pn.metrics;else{const No=ct[ii.fontStack],Wl=No&&No[zr];if(!Wl)continue;Gn=Wl.metrics}mr=(fr-ii.scale)*ur}Xn?(Oe.verticalizable=!0,Nr.push({glyph:zr,imageName:so,x:Pi,y:Di+mr,vertical:Xn,scale:ii.scale,fontStack:ii.fontStack,sectionIndex:Vr,metrics:Gn,rect:oo}),Pi+=Oo*ii.scale+Tt):(Nr.push({glyph:zr,imageName:so,x:Pi,y:Di+mr,vertical:Xn,scale:ii.scale,fontStack:ii.fontStack,sectionIndex:Vr,metrics:Gn,rect:oo}),Pi+=Gn.advance*ii.scale+Tt)}Nr.length!==0&&(hr=Math.max(Pi-Tt,hr),cg(Nr,0,Nr.length-1,Wr,dn)),Pi=0;const fn=Ye*fr+dn;Kr.lineOffset=Math.max(dn,Or),Di+=fn,Tn=Math.max(fn,Tn),++sr}var kr;const Pr=Di-Ul,{horizontalAlign:Hr,verticalAlign:$r}=Eh(ft);(function(dr,fr,Or,Kr,Nr,dn,fn,pr,ii){const Vr=(fr-Or)*Nr;let zr=0;zr=dn!==fn?-pr*Kr-Ul:(-Kr*ii+.5)*fn;for(const mr of dr)for(const Gn of mr.positionedGlyphs)Gn.x+=Vr,Gn.y+=zr})(Oe.positionedLines,Wr,Hr,$r,hr,Tn,Ye,Pr,ot.length),Oe.top+=-$r*Pr,Oe.bottom=Oe.top+Pr,Oe.left+=-Hr*hr,Oe.right=Oe.left+hr}(Se,e,r,a,ee,y,b,T,L,C,F,Z),!function(Oe){for(const ct of Oe)if(ct.positionedGlyphs.length!==0)return!1;return!0}(me)&&Se}const mu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ag={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yf(i,e,r,a,d,_){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*ur/_+d:0}{const y=r[e.fontStack],b=y&&y[i];return b?b.metrics.advance*e.scale+d:0}}function vf(i,e,r,a){const d=Math.pow(i-e,2);return a?i<e?d/2:2*d:d+Math.abs(r)*r}function lg(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function bf(i,e,r,a,d,_){let y=null,b=vf(e,r,d,_);for(const T of a){const C=vf(e-T.x,r,d,_)+T.badness;C<=b&&(y=T,b=C)}return{index:i,x:e,priorBreak:y,badness:b}}function xf(i){return i?xf(i.priorBreak).concat(i.index):[]}function Ah(i,e,r,a,d,_,y){if(_!=="point")return[];if(!i)return[];const b=[],T=function(F,N,V,Z,J,ee){let de=0;for(let oe=0;oe<F.length();oe++){const me=F.getSection(oe);de+=yf(F.getCharCode(oe),me,Z,J,N,ee)}return de/Math.max(1,Math.ceil(de/V))}(i,e,r,a,d,y),C=i.text.indexOf("​")>=0;let E=0;for(let F=0;F<i.length();F++){const N=i.getSection(F),V=i.getCharCode(F);if(mu[V]||(E+=yf(V,N,a,d,e,y)),F<i.length()-1){const Z=!((L=V)<11904||!(lt["Bopomofo Extended"](L)||lt.Bopomofo(L)||lt["CJK Compatibility Forms"](L)||lt["CJK Compatibility Ideographs"](L)||lt["CJK Compatibility"](L)||lt["CJK Radicals Supplement"](L)||lt["CJK Strokes"](L)||lt["CJK Symbols and Punctuation"](L)||lt["CJK Unified Ideographs Extension A"](L)||lt["CJK Unified Ideographs"](L)||lt["Enclosed CJK Letters and Months"](L)||lt["Halfwidth and Fullwidth Forms"](L)||lt.Hiragana(L)||lt["Ideographic Description Characters"](L)||lt["Kangxi Radicals"](L)||lt["Katakana Phonetic Extensions"](L)||lt.Katakana(L)||lt["Vertical Forms"](L)||lt["Yi Radicals"](L)||lt["Yi Syllables"](L)));(ag[V]||Z||N.imageName)&&b.push(bf(F+1,E,T,b,lg(V,i.getCharCode(F+1),Z&&C),!1))}}var L;return xf(bf(i.length(),E,T,b,0,!0))}function Eh(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function cg(i,e,r,a,d){if(!a&&!d)return;const _=i[r],y=(i[r].x+_.metrics.advance*_.scale)*a;for(let b=e;b<=r;b++)i[b].x-=y,i[b].y+=d}function ug(i,e,r){const{horizontalAlign:a,verticalAlign:d}=Eh(r),_=e[0]-i.displaySize[0]*a,y=e[1]-i.displaySize[1]*d;return{image:i,top:y,bottom:y+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function wf(i,e,r,a,d,_){const y=i.image;let b;if(y.content){const J=y.content,ee=y.pixelRatio||1;b=[J[0]/ee,J[1]/ee,y.displaySize[0]-J[2]/ee,y.displaySize[1]-J[3]/ee]}const T=e.left*_,C=e.right*_;let E,L,F,N;r==="width"||r==="both"?(N=d[0]+T-a[3],L=d[0]+C+a[1]):(N=d[0]+(T+C-y.displaySize[0])/2,L=N+y.displaySize[0]);const V=e.top*_,Z=e.bottom*_;return r==="height"||r==="both"?(E=d[1]+V-a[0],F=d[1]+Z+a[2]):(E=d[1]+(V+Z-y.displaySize[1])/2,F=E+y.displaySize[1]),{image:y,top:E,right:L,bottom:F,left:N,collisionPadding:b}}const ql=255,yo=128,cs=ql*yo;function Sf(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ai(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:d}=r;let _=0;for(;_<a.length&&a[_]<=i;)_++;_=Math.max(0,_-1);let y=_;for(;y<a.length&&a[y]<i+1;)y++;y=Math.min(a.length-1,y);const b=a[_],T=a[y];return r.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:T,minSize:r.evaluate(new Ai(b)),maxSize:r.evaluate(new Ai(T)),interpolationType:d}}}function Ph(i,e,r){let a="never";const d=i.get(e);return d?a=d:i.get(r)&&(a="always"),a}const hg=as.VectorTileFeature.types,dg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _u(i,e,r,a,d,_,y,b,T,C,E,L,F){const N=b?Math.min(cs,Math.round(b[0])):0,V=b?Math.min(cs,Math.round(b[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*d),_,y,(N<<1)+(T?1:0),V,16*C,16*E,256*L,256*F)}function zh(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function fg(i){for(const e of i.sections)if(nh(e.text))return!0;return!1}class Lh{constructor(e){this.layoutVertexArray=new Jt,this.indexArray=new Sr,this.programConfigurations=e,this.segments=new Ei,this.dynamicLayoutVertexArray=new Zt,this.opacityVertexArray=new Qt,this.hasVisibleVertices=!1,this.placedSymbolArray=new le}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Z_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,G_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,dg,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ht("SymbolBuffers",Lh);class Dh{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Ei,this.collisionVertexArray=new Ci}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,X_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ht("CollisionBuffers",Dh);class ka{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=hh([]),this.placementViewportMatrix=hh([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Sf(this.zoom,r["text-size"]),this.iconSizeData=Sf(this.zoom,r["icon-size"]);const a=this.layers[0].layout,d=a.get("symbol-sort-key"),_=a.get("symbol-z-order");this.canOverlap=Ph(a,"text-overlap","text-allow-overlap")!=="never"||Ph(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>s.ai[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Lh(new no(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Lh(new no(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ue,this.lineVertexArray=new ke,this.symbolInstances=new Q,this.textAnchorOffsets=new Re}calculateGlyphDependencies(e,r,a,d,_){for(let y=0;y<e.length;y++)if(r[e.charCodeAt(y)]=!0,(a||d)&&_){const b=Vl[e.charAt(y)];b&&(r[b.charCodeAt(0)]=!0)}}populate(e,r,a){const d=this.layers[0],_=d.layout,y=_.get("text-font"),b=_.get("text-field"),T=_.get("icon-image"),C=(b.value.kind!=="constant"||b.value.value instanceof Cr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),E=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!C&&!E)return;const F=r.iconDependencies,N=r.glyphDependencies,V=r.availableImages,Z=new Ai(this.zoom);for(const{feature:J,id:ee,index:de,sourceLayerIndex:oe}of e){const me=d._featureFilter.needGeometry,Se=Bs(J,me);if(!d._featureFilter.filter(Z,Se,a))continue;let Oe,ct;if(me||(Se.geometry=Ds(J)),C){const at=d.getValueAndResolveTokens("text-field",Se,a,V),ot=Cr.factory(at);fg(ot)&&(this.hasRTLText=!0),(!this.hasRTLText||bl()==="unavailable"||this.hasRTLText&&cn.isParsed())&&(Oe=H_(ot,d,Se))}if(E){const at=d.getValueAndResolveTokens("icon-image",Se,a,V);ct=at instanceof wr?at:wr.fromString(at)}if(!Oe&&!ct)continue;const _t=this.sortFeaturesByKey?L.evaluate(Se,{},a):void 0;if(this.features.push({id:ee,text:Oe,icon:ct,index:de,sourceLayerIndex:oe,geometry:Se.geometry,properties:J.properties,type:hg[J.type],sortKey:_t}),ct&&(F[ct.name]=!0),Oe){const at=y.evaluate(Se,{},a).join(","),ot=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const Ye of Oe.sections)if(Ye.image)F[Ye.image.name]=!0;else{const ft=dl(Oe.toString()),tt=Ye.fontStack||at,Ge=N[tt]=N[tt]||{};this.calculateGlyphDependencies(Ye.text,Ge,ot,this.allowVerticalPlacement,ft)}}}_.get("symbol-placement")==="line"&&(this.features=function(J){const ee={},de={},oe=[];let me=0;function Se(at){oe.push(J[at]),me++}function Oe(at,ot,Ye){const ft=de[at];return delete de[at],de[ot]=ft,oe[ft].geometry[0].pop(),oe[ft].geometry[0]=oe[ft].geometry[0].concat(Ye[0]),ft}function ct(at,ot,Ye){const ft=ee[ot];return delete ee[ot],ee[at]=ft,oe[ft].geometry[0].shift(),oe[ft].geometry[0]=Ye[0].concat(oe[ft].geometry[0]),ft}function _t(at,ot,Ye){const ft=Ye?ot[0][ot[0].length-1]:ot[0][0];return`${at}:${ft.x}:${ft.y}`}for(let at=0;at<J.length;at++){const ot=J[at],Ye=ot.geometry,ft=ot.text?ot.text.toString():null;if(!ft){Se(at);continue}const tt=_t(ft,Ye),Ge=_t(ft,Ye,!0);if(tt in de&&Ge in ee&&de[tt]!==ee[Ge]){const Tt=ct(tt,Ge,Ye),yt=Oe(tt,Ge,oe[Tt].geometry);delete ee[tt],delete de[Ge],de[_t(ft,oe[yt].geometry,!0)]=yt,oe[Tt].geometry=null}else tt in de?Oe(tt,Ge,Ye):Ge in ee?ct(tt,Ge,Ye):(Se(at),ee[tt]=me-1,de[Ge]=me-1)}return oe.filter(at=>at.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ee)=>J.sortKey-ee.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(r[e.segment+1]),_=e.dist(r[e.segment]);const y={};for(let b=e.segment+1;b<r.length;b++)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:d},b<r.length-1&&(d+=r[b+1].dist(r[b]));for(let b=e.segment||0;b>=0;b--)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){const T=y[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,d,_,y,b,T,C,E,L,F){const N=e.indexArray,V=e.layoutVertexArray,Z=e.segments.prepareSegment(4*r.length,V,N,this.canOverlap?y.sortKey:void 0),J=this.glyphOffsetArray.length,ee=Z.vertexLength,de=this.allowVerticalPlacement&&b===s.ai.vertical?Math.PI/2:0,oe=y.text&&y.text.sections;for(let me=0;me<r.length;me++){const{tl:Se,tr:Oe,bl:ct,br:_t,tex:at,pixelOffsetTL:ot,pixelOffsetBR:Ye,minFontScaleX:ft,minFontScaleY:tt,glyphOffset:Ge,isSDF:Tt,sectionIndex:yt}=r[me],Kt=Z.vertexLength,Pi=Ge[1];_u(V,T.x,T.y,Se.x,Pi+Se.y,at.x,at.y,a,Tt,ot.x,ot.y,ft,tt),_u(V,T.x,T.y,Oe.x,Pi+Oe.y,at.x+at.w,at.y,a,Tt,Ye.x,ot.y,ft,tt),_u(V,T.x,T.y,ct.x,Pi+ct.y,at.x,at.y+at.h,a,Tt,ot.x,Ye.y,ft,tt),_u(V,T.x,T.y,_t.x,Pi+_t.y,at.x+at.w,at.y+at.h,a,Tt,Ye.x,Ye.y,ft,tt),zh(e.dynamicLayoutVertexArray,T,de),N.emplaceBack(Kt,Kt+1,Kt+2),N.emplaceBack(Kt+1,Kt+2,Kt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ge[0]),me!==r.length-1&&yt===r[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,y,y.index,{},F,oe&&oe[yt])}e.placedSymbolArray.emplaceBack(T.x,T.y,J,this.glyphOffsetArray.length-J,ee,C,E,T.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],b,0,!1,0,L)}_addCollisionDebugVertex(e,r,a,d,_,y){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,d,_,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,r,a,d,_,y,b){const T=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),C=T.vertexLength,E=_.layoutVertexArray,L=_.collisionVertexArray,F=b.anchorX,N=b.anchorY;this._addCollisionDebugVertex(E,L,y,F,N,new ie(e,r)),this._addCollisionDebugVertex(E,L,y,F,N,new ie(a,r)),this._addCollisionDebugVertex(E,L,y,F,N,new ie(a,d)),this._addCollisionDebugVertex(E,L,y,F,N,new ie(e,d)),T.vertexLength+=4;const V=_.indexArray;V.emplaceBack(C,C+1),V.emplaceBack(C+1,C+2),V.emplaceBack(C+2,C+3),V.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,d){for(let _=e;_<r;_++){const y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dh(Ki,af.members,lr),this.iconCollisionBox=new Dh(Ki,af.members,lr);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,d,_,y,b,T,C){const E={};for(let L=r;L<a;L++){const F=e.get(L);E.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.textFeatureIndex=F.featureIndex;break}for(let L=d;L<_;L++){const F=e.get(L);E.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalTextFeatureIndex=F.featureIndex;break}for(let L=y;L<b;L++){const F=e.get(L);E.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.iconFeatureIndex=F.featureIndex;break}for(let L=T;L<C;L++){const F=e.get(L);E.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalIconFeatureIndex=F.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),d=a.vertexStartIndex+4*a.numGlyphs;for(let _=a.vertexStartIndex;_<d;_+=4)e.indexArray.emplaceBack(_,_+1,_+2),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),d=[],_=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const T=this.symbolInstances.get(b);d.push(0|Math.round(r*T.anchorX+a*T.anchorY)),_.push(T.featureIndex)}return y.sort((b,T)=>d[b]-d[T]||_[T]-_[b]),y}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((d,_,y)=>{d>=0&&y.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Tf,kf;ht("SymbolBucket",ka,{omit:["layers","collisionBoxArray","features","compareText"]}),ka.MAX_GLYPHS=65535,ka.addDynamicAttributes=zh;var Bh={get paint(){return kf=kf||new Qi({"icon-opacity":new Mt(Pe.paint_symbol["icon-opacity"]),"icon-color":new Mt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new Mt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mt(Pe.paint_symbol["text-opacity"]),"text-color":new Mt(Pe.paint_symbol["text-color"],{runtimeType:Br,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Mt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new Mt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Mt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new wt(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return Tf=Tf||new Qi({"symbol-placement":new wt(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wt(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new wt(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new wt(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new wt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mt(Pe.layout_symbol["icon-image"]),"icon-rotate":new Mt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Mt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Mt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new Mt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new Mt(Pe.layout_symbol["text-field"]),"text-font":new Mt(Pe.layout_symbol["text-font"]),"text-size":new Mt(Pe.layout_symbol["text-size"]),"text-max-width":new Mt(Pe.layout_symbol["text-max-width"]),"text-line-height":new wt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Mt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new Mt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new Mt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Mt(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Mt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new wt(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new Mt(Pe.layout_symbol["text-rotate"]),"text-padding":new wt(Pe.layout_symbol["text-padding"]),"text-keep-upright":new wt(Pe.layout_symbol["text-keep-upright"]),"text-transform":new Mt(Pe.layout_symbol["text-transform"]),"text-offset":new Mt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new wt(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new wt(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Pe.layout_symbol["text-optional"])})}};class If{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Jn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ht("FormatSectionOverride",If,{omit:["defaultValue"]});class gu extends wn{constructor(e){super(e,Bh)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const d=[];for(const _ of a)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,d){const _=this.layout.get(e).evaluate(r,{},a,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||oa(y.value)||!_?_:function(b,T){return T.replace(/{([^{}]+)}/g,(C,E)=>b&&E in b?String(b[E]):"")}(r.properties,_)}createBucket(e){return new ka(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Bh.paint.overridableProperties){if(!gu.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new If(r),d=new sl(a,r.property.specification);let _=null;_=r.value.kind==="constant"||r.value.kind==="source"?new al("source",d):new aa("composite",d,r.value.zoomStops),this.paint._values[e]=new Fr(r.property,_,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&gu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),d=Bh.paint.properties[r];let _=!1;const y=b=>{for(const T of b)if(d.overrides&&d.overrides.hasOverride(T))return void(_=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Cr)y(a.value.value.sections);else if(a.value.kind==="source"){const b=C=>{_||(C instanceof ko&&Bi(C.value)===H?y(C.value.sections):C instanceof na?y(C.sections):C.eachChild(b))},T=a.value;T._styleExpression&&b(T._styleExpression.expression)}return _}}let Mf;var pg={get paint(){return Mf=Mf||new Qi({"background-color":new wt(Pe.paint_background["background-color"]),"background-pattern":new wl(Pe.paint_background["background-pattern"]),"background-opacity":new wt(Pe.paint_background["background-opacity"])})}};class mg extends wn{constructor(e){super(e,pg)}}let Cf;var _g={get paint(){return Cf=Cf||new Qi({"raster-opacity":new wt(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new wt(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Pe.paint_raster["raster-saturation"]),"raster-contrast":new wt(Pe.paint_raster["raster-contrast"]),"raster-resampling":new wt(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Pe.paint_raster["raster-fade-duration"])})}};class gg extends wn{constructor(e){super(e,_g)}}class yg extends wn{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class vg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Fh=63710088e-1;class us{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new us(Ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,d=e.lat*r,_=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return Fh*Math.acos(Math.min(_,1))}static convert(e){if(e instanceof us)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new us(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new us(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Af=2*Math.PI*Fh;function Ef(i){return Af*Math.cos(i*Math.PI/180)}function Pf(i){return(180+i)/360}function zf(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Lf(i,e){return i/Ef(e)}function Df(i){return 360*i-180}function Rh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class yu{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=us.convert(e);return new yu(Pf(a.lng),zf(a.lat),Lf(r,a.lat))}toLngLat(){return new us(Df(this.x),Rh(this.y))}toAltitude(){return this.z*Ef(Rh(this.y))}meterInMercatorCoordinateUnits(){return 1/Af*(e=Rh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Bf(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Oh{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=Zl(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const d=(y=this.y,b=this.z,T=Bf(256*(_=this.x),256*(y=Math.pow(2,b)-y-1),b),C=Bf(256*(_+1),256*(y+1),b),T[0]+","+T[1]+","+C[0]+","+C[1]);var _,y,b,T,C;const E=function(L,F,N){let V,Z="";for(let J=L;J>0;J--)V=1<<J-1,Z+=(F&V?1:0)+(N&V?2:0);return Z}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new ie((e.x*r-this.x)*or,(e.y*r-this.y)*or)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ff{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Zl(e,r.z,r.z,r.x,r.y)}}class En{constructor(e,r,a,d,_){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Oh(a,+d,+_),this.key=Zl(r,e,a,d,_)}clone(){return new En(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new En(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new En(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Zl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Zl(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new En(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new En(r,this.wrap,r,a,d),new En(r,this.wrap,r,a+1,d),new En(r,this.wrap,r,a,d+1),new En(r,this.wrap,r,a+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new En(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new En(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ff(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new yu(e.x-this.wrap,e.y))}}function Zl(i,e,r,a,d){(i*=2)<0&&(i=-1*i-1);const _=1<<r;return(_*_*i+_*d+a).toString(36)+r.toString(36)+e.toString(36)}ht("CanonicalTileID",Oh),ht("OverscaledTileID",En,{omit:["posMatrix"]});class Rf{constructor(e,r,a,d=1,_=1,y=1,b=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void bt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const T=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=y,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let E=0;E<T;E++){const L=this.get(C,E);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(e,r){const a=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return this.unpack(a[d],a[d+1],a[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new An({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,_=r*this.dim+this.dim,y=a*this.dim,b=a*this.dim+this.dim;switch(r){case-1:d=_-1;break;case 1:_=d+1}switch(a){case-1:y=b-1;break;case 1:b=y+1}const T=-r*this.dim,C=-a*this.dim;for(let E=y;E<b;E++)for(let L=d;L<_;L++)this.data[this._idx(L,E)]=e.data[this._idx(L+T,E+C)]}}ht("DEMData",Rf);class Of{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Nf{constructor(e,r,a,d,_){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=d,this.properties=e.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Vf{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new is(or,16,0),this.grid3D=new is(or,16,0),this.featureIndexArray=new Ve,this.promoteId=r}insert(e,r,a,d,_,y){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,_);const T=y?this.grid3D:this.grid;for(let C=0;C<r.length;C++){const E=r[C],L=[1/0,1/0,-1/0,-1/0];for(let F=0;F<E.length;F++){const N=E[F];L[0]=Math.min(L[0],N.x),L[1]=Math.min(L[1],N.y),L[2]=Math.max(L[2],N.x),L[3]=Math.max(L[3],N.y)}L[0]<or&&L[1]<or&&L[2]>=0&&L[3]>=0&&T.insert(b,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new as.VectorTile(new Ih(this.rawTileData)).layers,this.sourceLayerCoder=new Of(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,d){this.loadVTLayers();const _=e.params||{},y=or/e.tileSize/e.scale,b=cl(_.filter),T=e.queryGeometry,C=e.queryPadding*y,E=jf(T),L=this.grid.query(E.minX-C,E.minY-C,E.maxX+C,E.maxY+C),F=jf(e.cameraQueryGeometry),N=this.grid3D.query(F.minX-C,F.minY-C,F.maxX+C,F.maxY+C,(J,ee,de,oe)=>function(me,Se,Oe,ct,_t){for(const ot of me)if(Se<=ot.x&&Oe<=ot.y&&ct>=ot.x&&_t>=ot.y)return!0;const at=[new ie(Se,Oe),new ie(Se,_t),new ie(ct,_t),new ie(ct,Oe)];if(me.length>2){for(const ot of at)if(ya(me,ot))return!0}for(let ot=0;ot<me.length-1;ot++)if(Jm(me[ot],me[ot+1],at))return!0;return!1}(e.cameraQueryGeometry,J-C,ee-C,de+C,oe+C));for(const J of N)L.push(J);L.sort(bg);const V={};let Z;for(let J=0;J<L.length;J++){const ee=L[J];if(ee===Z)continue;Z=ee;const de=this.featureIndexArray.get(ee);let oe=null;this.loadMatchingFeature(V,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,b,_.layers,_.availableImages,r,a,d,(me,Se,Oe)=>(oe||(oe=Ds(me)),Se.queryIntersectsFeature(T,me,Oe,oe,this.z,e.transform,y,e.pixelPosMatrix)))}return V}loadMatchingFeature(e,r,a,d,_,y,b,T,C,E,L){const F=this.bucketLayerIDs[r];if(y&&!function(J,ee){for(let de=0;de<J.length;de++)if(ee.indexOf(J[de])>=0)return!0;return!1}(y,F))return;const N=this.sourceLayerCoder.decode(a),V=this.vtLayers[N].feature(d);if(_.needGeometry){const J=Bs(V,!0);if(!_.filter(new Ai(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!_.filter(new Ai(this.tileID.overscaledZ),V))return;const Z=this.getId(V,N);for(let J=0;J<F.length;J++){const ee=F[J];if(y&&y.indexOf(ee)<0)continue;const de=T[ee];if(!de)continue;let oe={};Z&&E&&(oe=E.getState(de.sourceLayer||"_geojsonTileLayer",Z));const me=Ae({},C[ee]);me.paint=Uf(me.paint,de.paint,V,oe,b),me.layout=Uf(me.layout,de.layout,V,oe,b);const Se=!L||L(V,de,oe);if(!Se)continue;const Oe=new Nf(V,this.z,this.x,this.y,Z);Oe.layer=me;let ct=e[ee];ct===void 0&&(ct=e[ee]=[]),ct.push({featureIndex:d,feature:Oe,intersectionZ:Se})}}lookupSymbolFeatures(e,r,a,d,_,y,b,T){const C={};this.loadVTLayers();const E=cl(_);for(const L of e)this.loadMatchingFeature(C,a,d,L,E,y,b,T,r);return C}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Uf(i,e,r,a,d){return je(i,(_,y)=>{const b=e instanceof _a?e.get(y):null;return b&&b.evaluate?b.evaluate(r,a,d):b})}function jf(i){let e=1/0,r=1/0,a=-1/0,d=-1/0;for(const _ of i)e=Math.min(e,_.x),r=Math.min(r,_.y),a=Math.max(a,_.x),d=Math.max(d,_.y);return{minX:e,minY:r,maxX:a,maxY:d}}function bg(i,e){return e-i}function qf(i,e,r,a,d){const _=[];for(let y=0;y<i.length;y++){const b=i[y];let T;for(let C=0;C<b.length-1;C++){let E=b[C],L=b[C+1];E.x<e&&L.x<e||(E.x<e?E=new ie(e,E.y+(e-E.x)/(L.x-E.x)*(L.y-E.y))._round():L.x<e&&(L=new ie(e,E.y+(e-E.x)/(L.x-E.x)*(L.y-E.y))._round()),E.y<r&&L.y<r||(E.y<r?E=new ie(E.x+(r-E.y)/(L.y-E.y)*(L.x-E.x),r)._round():L.y<r&&(L=new ie(E.x+(r-E.y)/(L.y-E.y)*(L.x-E.x),r)._round()),E.x>=a&&L.x>=a||(E.x>=a?E=new ie(a,E.y+(a-E.x)/(L.x-E.x)*(L.y-E.y))._round():L.x>=a&&(L=new ie(a,E.y+(a-E.x)/(L.x-E.x)*(L.y-E.y))._round()),E.y>=d&&L.y>=d||(E.y>=d?E=new ie(E.x+(d-E.y)/(L.y-E.y)*(L.x-E.x),d)._round():L.y>=d&&(L=new ie(E.x+(d-E.y)/(L.y-E.y)*(L.x-E.x),d)._round()),T&&E.equals(T[T.length-1])||(T=[E],_.push(T)),T.push(L)))))}}return _}ht("FeatureIndex",Vf,{omit:["rawTileData","sourceLayerCoder"]});class hs extends ie{constructor(e,r,a,d){super(e,r),this.angle=a,d!==void 0&&(this.segment=d)}clone(){return new hs(this.x,this.y,this.angle,this.segment)}}function Zf(i,e,r,a,d){if(e.segment===void 0||r===0)return!0;let _=e,y=e.segment+1,b=0;for(;b>-r/2;){if(y--,y<0)return!1;b-=i[y].dist(_),_=i[y]}b+=i[y].dist(i[y+1]),y++;const T=[];let C=0;for(;b<r/2;){const E=i[y],L=i[y+1];if(!L)return!1;let F=i[y-1].angleTo(E)-E.angleTo(L);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:F}),C+=F;b-T[0].distance>a;)C-=T.shift().angleDelta;if(C>d)return!1;y++,b+=E.dist(L)}return!0}function Gf(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Xf(i,e,r){return i?.6*e*r:0}function Wf(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function xg(i,e,r,a,d,_){const y=Xf(r,d,_),b=Wf(r,a)*_;let T=0;const C=Gf(i)/2;for(let E=0;E<i.length-1;E++){const L=i[E],F=i[E+1],N=L.dist(F);if(T+N>C){const V=(C-T)/N,Z=sn.number(L.x,F.x,V),J=sn.number(L.y,F.y,V),ee=new hs(Z,J,F.angleTo(L),E);return ee._round(),!y||Zf(i,ee,b,y,e)?ee:void 0}T+=N}}function wg(i,e,r,a,d,_,y,b,T){const C=Xf(a,_,y),E=Wf(a,d),L=E*y,F=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-L<e/4&&(e=L+e/4),Hf(i,F?e/2*b%e:(E/2+2*_)*y*b%e,e,C,r,L,F,!1,T)}function Hf(i,e,r,a,d,_,y,b,T){const C=_/2,E=Gf(i);let L=0,F=e-r,N=[];for(let V=0;V<i.length-1;V++){const Z=i[V],J=i[V+1],ee=Z.dist(J),de=J.angleTo(Z);for(;F+r<L+ee;){F+=r;const oe=(F-L)/ee,me=sn.number(Z.x,J.x,oe),Se=sn.number(Z.y,J.y,oe);if(me>=0&&me<T&&Se>=0&&Se<T&&F-C>=0&&F+C<=E){const Oe=new hs(me,Se,de,V);Oe._round(),a&&!Zf(i,Oe,_,a,d)||N.push(Oe)}}L+=ee}return b||N.length||y||(N=Hf(i,L/2,r,a,d,_,y,!0,T)),N}ht("Anchor",hs);const Ia=hn;function $f(i,e,r,a){const d=[],_=i.image,y=_.pixelRatio,b=_.paddedRect.w-2*Ia,T=_.paddedRect.h-2*Ia,C=i.right-i.left,E=i.bottom-i.top,L=_.stretchX||[[0,b]],F=_.stretchY||[[0,T]],N=(Ye,ft)=>Ye+ft[1]-ft[0],V=L.reduce(N,0),Z=F.reduce(N,0),J=b-V,ee=T-Z;let de=0,oe=V,me=0,Se=Z,Oe=0,ct=J,_t=0,at=ee;if(_.content&&a){const Ye=_.content;de=vu(L,0,Ye[0]),me=vu(F,0,Ye[1]),oe=vu(L,Ye[0],Ye[2]),Se=vu(F,Ye[1],Ye[3]),Oe=Ye[0]-de,_t=Ye[1]-me,ct=Ye[2]-Ye[0]-oe,at=Ye[3]-Ye[1]-Se}const ot=(Ye,ft,tt,Ge)=>{const Tt=bu(Ye.stretch-de,oe,C,i.left),yt=xu(Ye.fixed-Oe,ct,Ye.stretch,V),Kt=bu(ft.stretch-me,Se,E,i.top),Pi=xu(ft.fixed-_t,at,ft.stretch,Z),Di=bu(tt.stretch-de,oe,C,i.left),hr=xu(tt.fixed-Oe,ct,tt.stretch,V),Tn=bu(Ge.stretch-me,Se,E,i.top),Wr=xu(Ge.fixed-_t,at,Ge.stretch,Z),sr=new ie(Tt,Kt),kr=new ie(Di,Kt),Pr=new ie(Di,Tn),Hr=new ie(Tt,Tn),$r=new ie(yt/y,Pi/y),dr=new ie(hr/y,Wr/y),fr=e*Math.PI/180;if(fr){const Nr=Math.sin(fr),dn=Math.cos(fr),fn=[dn,-Nr,Nr,dn];sr._matMult(fn),kr._matMult(fn),Hr._matMult(fn),Pr._matMult(fn)}const Or=Ye.stretch+Ye.fixed,Kr=ft.stretch+ft.fixed;return{tl:sr,tr:kr,bl:Hr,br:Pr,tex:{x:_.paddedRect.x+Ia+Or,y:_.paddedRect.y+Ia+Kr,w:tt.stretch+tt.fixed-Or,h:Ge.stretch+Ge.fixed-Kr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$r,pixelOffsetBR:dr,minFontScaleX:ct/y/C,minFontScaleY:at/y/E,isSDF:r}};if(a&&(_.stretchX||_.stretchY)){const Ye=Kf(L,J,V),ft=Kf(F,ee,Z);for(let tt=0;tt<Ye.length-1;tt++){const Ge=Ye[tt],Tt=Ye[tt+1];for(let yt=0;yt<ft.length-1;yt++)d.push(ot(Ge,ft[yt],Tt,ft[yt+1]))}}else d.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return d}function vu(i,e,r){let a=0;for(const d of i)a+=Math.max(e,Math.min(r,d[1]))-Math.max(e,Math.min(r,d[0]));return a}function Kf(i,e,r){const a=[{fixed:-Ia,stretch:0}];for(const[d,_]of i){const y=a[a.length-1];a.push({fixed:d-y.stretch,stretch:y.stretch}),a.push({fixed:d-y.stretch,stretch:y.stretch+(_-d)})}return a.push({fixed:e+Ia,stretch:r}),a}function bu(i,e,r,a){return i/e*r+a}function xu(i,e,r,a){return i-e*r/a}class wu{constructor(e,r,a,d,_,y,b,T,C,E){if(this.boxStartIndex=e.length,C){let L=y.top,F=y.bottom;const N=y.collisionPadding;N&&(L-=N[1],F+=N[3]);let V=F-L;V>0&&(V=Math.max(10,V),this.circleDiameter=V)}else{let L=y.top*b-T[0],F=y.bottom*b+T[2],N=y.left*b-T[3],V=y.right*b+T[1];const Z=y.collisionPadding;if(Z&&(N-=Z[0]*b,L-=Z[1]*b,V+=Z[2]*b,F+=Z[3]*b),E){const J=new ie(N,L),ee=new ie(V,L),de=new ie(N,F),oe=new ie(V,F),me=E*Math.PI/180;J._rotate(me),ee._rotate(me),de._rotate(me),oe._rotate(me),N=Math.min(J.x,ee.x,de.x,oe.x),V=Math.max(J.x,ee.x,de.x,oe.x),L=Math.min(J.y,ee.y,de.y,oe.y),F=Math.max(J.y,ee.y,de.y,oe.y)}e.emplaceBack(r.x,r.y,N,L,V,F,a,d,_)}this.boxEndIndex=e.length}}class Sg{constructor(e=[],r=Tg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,d=r[e];for(;e>0;){const _=e-1>>1,y=r[_];if(a(d,y)>=0)break;r[e]=y,e=_}r[e]=d}_down(e){const{data:r,compare:a}=this,d=this.length>>1,_=r[e];for(;e<d;){let y=1+(e<<1),b=r[y];const T=y+1;if(T<this.length&&a(r[T],b)<0&&(y=T,b=r[T]),a(b,_)>=0)break;r[e]=b,e=y}r[e]=_}}function Tg(i,e){return i<e?-1:i>e?1:0}function kg(i,e=1,r=!1){let a=1/0,d=1/0,_=-1/0,y=-1/0;const b=i[0];for(let N=0;N<b.length;N++){const V=b[N];(!N||V.x<a)&&(a=V.x),(!N||V.y<d)&&(d=V.y),(!N||V.x>_)&&(_=V.x),(!N||V.y>y)&&(y=V.y)}const T=Math.min(_-a,y-d);let C=T/2;const E=new Sg([],Ig);if(T===0)return new ie(a,d);for(let N=a;N<_;N+=T)for(let V=d;V<y;V+=T)E.push(new Ma(N+C,V+C,C,i));let L=function(N){let V=0,Z=0,J=0;const ee=N[0];for(let de=0,oe=ee.length,me=oe-1;de<oe;me=de++){const Se=ee[de],Oe=ee[me],ct=Se.x*Oe.y-Oe.x*Se.y;Z+=(Se.x+Oe.x)*ct,J+=(Se.y+Oe.y)*ct,V+=3*ct}return new Ma(Z/V,J/V,0,N)}(i),F=E.length;for(;E.length;){const N=E.pop();(N.d>L.d||!L.d)&&(L=N,r&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,F)),N.max-L.d<=e||(C=N.h/2,E.push(new Ma(N.p.x-C,N.p.y-C,C,i)),E.push(new Ma(N.p.x+C,N.p.y-C,C,i)),E.push(new Ma(N.p.x-C,N.p.y+C,C,i)),E.push(new Ma(N.p.x+C,N.p.y+C,C,i)),F+=4)}return r&&(console.log(`num probes: ${F}`),console.log(`best distance: ${L.d}`)),L.p}function Ig(i,e){return e.max-i.max}function Ma(i,e,r,a){this.p=new ie(i,e),this.h=r,this.d=function(d,_){let y=!1,b=1/0;for(let T=0;T<_.length;T++){const C=_[T];for(let E=0,L=C.length,F=L-1;E<L;F=E++){const N=C[E],V=C[F];N.y>d.y!=V.y>d.y&&d.x<(V.x-N.x)*(d.y-N.y)/(V.y-N.y)+N.x&&(y=!y),b=Math.min(b,Pd(d,N,V))}}return(y?1:-1)*Math.sqrt(b)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Er;s.aq=void 0,(Er=s.aq||(s.aq={}))[Er.center=1]="center",Er[Er.left=2]="left",Er[Er.right=3]="right",Er[Er.top=4]="top",Er[Er.bottom=5]="bottom",Er[Er["top-left"]=6]="top-left",Er[Er["top-right"]=7]="top-right",Er[Er["bottom-left"]=8]="bottom-left",Er[Er["bottom-right"]=9]="bottom-right";const ds=7,Nh=Number.POSITIVE_INFINITY;function Jf(i,e){return e[1]!==Nh?function(r,a,d){let _=0,y=0;switch(a=Math.abs(a),d=Math.abs(d),r){case"top-right":case"top-left":case"top":y=d-ds;break;case"bottom-right":case"bottom-left":case"bottom":y=-d+ds}switch(r){case"top-right":case"bottom-right":case"right":_=-a;break;case"top-left":case"bottom-left":case"left":_=a}return[_,y]}(i,e[0],e[1]):function(r,a){let d=0,_=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(r){case"top-right":case"top-left":_=y-ds;break;case"bottom-right":case"bottom-left":_=-y+ds;break;case"bottom":_=-a+ds;break;case"top":_=a-ds}switch(r){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=a;break;case"right":d=-a}return[d,_]}(i,e[0])}function Yf(i,e,r){var a;const d=i.layout,_=(a=d.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(_){const b=_.values,T=[];for(let C=0;C<b.length;C+=2){const E=T[C]=b[C],L=b[C+1].map(F=>F*ur);E.startsWith("top")?L[1]-=ds:E.startsWith("bottom")&&(L[1]+=ds),T[C+1]=L}return new yn(T)}const y=d.get("text-variable-anchor");if(y){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(e,{},r)*ur,Nh]:d.get("text-offset").evaluate(e,{},r).map(C=>C*ur);const T=[];for(const C of y)T.push(C,Jf(C,b));return new yn(T)}return null}function Vh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mg(i,e,r,a,d,_,y,b,T,C,E){let L=_.textMaxSize.evaluate(e,{});L===void 0&&(L=y);const F=i.layers[0].layout,N=F.get("icon-offset").evaluate(e,{},E),V=ep(r.horizontal),Z=y/24,J=i.tilePixelRatio*Z,ee=i.tilePixelRatio*L/24,de=i.tilePixelRatio*b,oe=i.tilePixelRatio*F.get("symbol-spacing"),me=F.get("text-padding")*i.tilePixelRatio,Se=function(Ge,Tt,yt,Kt=1){const Pi=Ge.get("icon-padding").evaluate(Tt,{},yt),Di=Pi&&Pi.values;return[Di[0]*Kt,Di[1]*Kt,Di[2]*Kt,Di[3]*Kt]}(F,e,E,i.tilePixelRatio),Oe=F.get("text-max-angle")/180*Math.PI,ct=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",_t=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",at=F.get("symbol-placement"),ot=oe/2,Ye=F.get("icon-text-fit");let ft;a&&Ye!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ft=wf(a,r.vertical,Ye,F.get("icon-text-fit-padding"),N,Z)),V&&(a=wf(a,V,Ye,F.get("icon-text-fit-padding"),N,Z)));const tt=(Ge,Tt)=>{Tt.x<0||Tt.x>=or||Tt.y<0||Tt.y>=or||function(yt,Kt,Pi,Di,hr,Tn,Wr,sr,kr,Pr,Hr,$r,dr,fr,Or,Kr,Nr,dn,fn,pr,ii,Vr,zr,mr,Gn){const oo=yt.addToLineVertexArray(Kt,Pi);let so,Oo,Xn,Pn,pn=0,No=0,Wl=0,np=0,Hh=-1,$h=-1;const Vo={};let op=Do("");if(yt.allowVerticalPlacement&&Di.vertical){const Ur=sr.layout.get("text-rotate").evaluate(ii,{},mr)+90;Xn=new wu(kr,Kt,Pr,Hr,$r,Di.vertical,dr,fr,Or,Ur),Wr&&(Pn=new wu(kr,Kt,Pr,Hr,$r,Wr,Nr,dn,Or,Ur))}if(hr){const Ur=sr.layout.get("icon-rotate").evaluate(ii,{}),zn=sr.layout.get("icon-text-fit")!=="none",Rs=$f(hr,Ur,zr,zn),lo=Wr?$f(Wr,Ur,zr,zn):void 0;Oo=new wu(kr,Kt,Pr,Hr,$r,hr,Nr,dn,!1,Ur),pn=4*Rs.length;const Os=yt.iconSizeData;let vo=null;Os.kind==="source"?(vo=[yo*sr.layout.get("icon-size").evaluate(ii,{})],vo[0]>cs&&bt(`${yt.layerIds[0]}: Value for "icon-size" is >= ${ql}. Reduce your "icon-size".`)):Os.kind==="composite"&&(vo=[yo*Vr.compositeIconSizes[0].evaluate(ii,{},mr),yo*Vr.compositeIconSizes[1].evaluate(ii,{},mr)],(vo[0]>cs||vo[1]>cs)&&bt(`${yt.layerIds[0]}: Value for "icon-size" is >= ${ql}. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,Rs,vo,pr,fn,ii,s.ai.none,Kt,oo.lineStartIndex,oo.lineLength,-1,mr),Hh=yt.icon.placedSymbolArray.length-1,lo&&(No=4*lo.length,yt.addSymbols(yt.icon,lo,vo,pr,fn,ii,s.ai.vertical,Kt,oo.lineStartIndex,oo.lineLength,-1,mr),$h=yt.icon.placedSymbolArray.length-1)}const sp=Object.keys(Di.horizontal);for(const Ur of sp){const zn=Di.horizontal[Ur];if(!so){op=Do(zn.text);const lo=sr.layout.get("text-rotate").evaluate(ii,{},mr);so=new wu(kr,Kt,Pr,Hr,$r,zn,dr,fr,Or,lo)}const Rs=zn.positionedLines.length===1;if(Wl+=Qf(yt,Kt,zn,Tn,sr,Or,ii,Kr,oo,Di.vertical?s.ai.horizontal:s.ai.horizontalOnly,Rs?sp:[Ur],Vo,Hh,Vr,mr),Rs)break}Di.vertical&&(np+=Qf(yt,Kt,Di.vertical,Tn,sr,Or,ii,Kr,oo,s.ai.vertical,["vertical"],Vo,$h,Vr,mr));const Eg=so?so.boxStartIndex:yt.collisionBoxArray.length,Pg=so?so.boxEndIndex:yt.collisionBoxArray.length,zg=Xn?Xn.boxStartIndex:yt.collisionBoxArray.length,Lg=Xn?Xn.boxEndIndex:yt.collisionBoxArray.length,Dg=Oo?Oo.boxStartIndex:yt.collisionBoxArray.length,Bg=Oo?Oo.boxEndIndex:yt.collisionBoxArray.length,Fg=Pn?Pn.boxStartIndex:yt.collisionBoxArray.length,Rg=Pn?Pn.boxEndIndex:yt.collisionBoxArray.length;let ao=-1;const Tu=(Ur,zn)=>Ur&&Ur.circleDiameter?Math.max(Ur.circleDiameter,zn):zn;ao=Tu(so,ao),ao=Tu(Xn,ao),ao=Tu(Oo,ao),ao=Tu(Pn,ao);const ap=ao>-1?1:0;ap&&(ao*=Gn/ur),yt.glyphOffsetArray.length>=ka.MAX_GLYPHS&&bt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ii.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,ii.sortKey);const Og=Yf(sr,ii,mr),[Ng,Vg]=function(Ur,zn){const Rs=Ur.length,lo=zn==null?void 0:zn.values;if((lo==null?void 0:lo.length)>0)for(let Os=0;Os<lo.length;Os+=2){const vo=lo[Os+1];Ur.emplaceBack(s.aq[lo[Os]],vo[0],vo[1])}return[Rs,Ur.length]}(yt.textAnchorOffsets,Og);yt.symbolInstances.emplaceBack(Kt.x,Kt.y,Vo.right>=0?Vo.right:-1,Vo.center>=0?Vo.center:-1,Vo.left>=0?Vo.left:-1,Vo.vertical||-1,Hh,$h,op,Eg,Pg,zg,Lg,Dg,Bg,Fg,Rg,Pr,Wl,np,pn,No,ap,0,dr,ao,Ng,Vg)}(i,Tt,Ge,r,a,d,ft,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,J,[me,me,me,me],ct,T,de,Se,_t,N,e,_,C,E,y)};if(at==="line")for(const Ge of qf(e.geometry,0,0,or,or)){const Tt=wg(Ge,oe,Oe,r.vertical||V,a,24,ee,i.overscaling,or);for(const yt of Tt)V&&Cg(i,V.text,ot,yt)||tt(Ge,yt)}else if(at==="line-center"){for(const Ge of e.geometry)if(Ge.length>1){const Tt=xg(Ge,Oe,r.vertical||V,a,24,ee);Tt&&tt(Ge,Tt)}}else if(e.type==="Polygon")for(const Ge of yh(e.geometry,0)){const Tt=kg(Ge,16);tt(Ge[0],new hs(Tt.x,Tt.y,0))}else if(e.type==="LineString")for(const Ge of e.geometry)tt(Ge,new hs(Ge[0].x,Ge[0].y,0));else if(e.type==="Point")for(const Ge of e.geometry)for(const Tt of Ge)tt([Tt],new hs(Tt.x,Tt.y,0))}function Qf(i,e,r,a,d,_,y,b,T,C,E,L,F,N,V){const Z=function(de,oe,me,Se,Oe,ct,_t,at){const ot=Se.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,Ye=[];for(const ft of oe.positionedLines)for(const tt of ft.positionedGlyphs){if(!tt.rect)continue;const Ge=tt.rect||{};let Tt=mf+1,yt=!0,Kt=1,Pi=0;const Di=(Oe||at)&&tt.vertical,hr=tt.metrics.advance*tt.scale/2;if(at&&oe.verticalizable&&(Pi=ft.lineOffset/2-(tt.imageName?-(ur-tt.metrics.width*tt.scale)/2:(tt.scale-1)*ur)),tt.imageName){const pr=_t[tt.imageName];yt=pr.sdf,Kt=pr.pixelRatio,Tt=hn/Kt}const Tn=Oe?[tt.x+hr,tt.y]:[0,0];let Wr=Oe?[0,0]:[tt.x+hr+me[0],tt.y+me[1]-Pi],sr=[0,0];Di&&(sr=Wr,Wr=[0,0]);const kr=tt.metrics.isDoubleResolution?2:1,Pr=(tt.metrics.left-Tt)*tt.scale-hr+Wr[0],Hr=(-tt.metrics.top-Tt)*tt.scale+Wr[1],$r=Pr+Ge.w/kr*tt.scale/Kt,dr=Hr+Ge.h/kr*tt.scale/Kt,fr=new ie(Pr,Hr),Or=new ie($r,Hr),Kr=new ie(Pr,dr),Nr=new ie($r,dr);if(Di){const pr=new ie(-hr,hr-Ul),ii=-Math.PI/2,Vr=ur/2-hr,zr=new ie(5-Ul-Vr,-(tt.imageName?Vr:0)),mr=new ie(...sr);fr._rotateAround(ii,pr)._add(zr)._add(mr),Or._rotateAround(ii,pr)._add(zr)._add(mr),Kr._rotateAround(ii,pr)._add(zr)._add(mr),Nr._rotateAround(ii,pr)._add(zr)._add(mr)}if(ot){const pr=Math.sin(ot),ii=Math.cos(ot),Vr=[ii,-pr,pr,ii];fr._matMult(Vr),Or._matMult(Vr),Kr._matMult(Vr),Nr._matMult(Vr)}const dn=new ie(0,0),fn=new ie(0,0);Ye.push({tl:fr,tr:Or,bl:Kr,br:Nr,tex:Ge,writingMode:oe.writingMode,glyphOffset:Tn,sectionIndex:tt.sectionIndex,isSDF:yt,pixelOffsetTL:dn,pixelOffsetBR:fn,minFontScaleX:0,minFontScaleY:0})}return Ye}(0,r,b,d,_,y,a,i.allowVerticalPlacement),J=i.textSizeData;let ee=null;J.kind==="source"?(ee=[yo*d.layout.get("text-size").evaluate(y,{})],ee[0]>cs&&bt(`${i.layerIds[0]}: Value for "text-size" is >= ${ql}. Reduce your "text-size".`)):J.kind==="composite"&&(ee=[yo*N.compositeTextSizes[0].evaluate(y,{},V),yo*N.compositeTextSizes[1].evaluate(y,{},V)],(ee[0]>cs||ee[1]>cs)&&bt(`${i.layerIds[0]}: Value for "text-size" is >= ${ql}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,ee,b,_,y,C,e,T.lineStartIndex,T.lineLength,F,V);for(const de of E)L[de]=i.text.placedSymbolArray.length-1;return 4*Z.length}function ep(i){for(const e in i)return i[e];return null}function Cg(i,e,r,a){const d=i.compareText;if(e in d){const _=d[e];for(let y=_.length-1;y>=0;y--)if(a.dist(_[y])<r)return!0}else d[e]=[];return d[e].push(a),!1}const tp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Uh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=a>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=tp[15&a];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new Uh(b,y,_,e)}constructor(e,r=64,a=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=tp.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${a}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return jh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:b}=this,T=[0,_.length-1,0],C=[];for(;T.length;){const E=T.pop()||0,L=T.pop()||0,F=T.pop()||0;if(L-F<=b){for(let J=F;J<=L;J++){const ee=y[2*J],de=y[2*J+1];ee>=e&&ee<=a&&de>=r&&de<=d&&C.push(_[J])}continue}const N=F+L>>1,V=y[2*N],Z=y[2*N+1];V>=e&&V<=a&&Z>=r&&Z<=d&&C.push(_[N]),(E===0?e<=V:r<=Z)&&(T.push(F),T.push(N-1),T.push(1-E)),(E===0?a>=V:d>=Z)&&(T.push(N+1),T.push(L),T.push(1-E))}return C}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:y}=this,b=[0,d.length-1,0],T=[],C=a*a;for(;b.length;){const E=b.pop()||0,L=b.pop()||0,F=b.pop()||0;if(L-F<=y){for(let J=F;J<=L;J++)rp(_[2*J],_[2*J+1],e,r)<=C&&T.push(d[J]);continue}const N=F+L>>1,V=_[2*N],Z=_[2*N+1];rp(V,Z,e,r)<=C&&T.push(d[N]),(E===0?e-a<=V:r-a<=Z)&&(b.push(F),b.push(N-1),b.push(1-E)),(E===0?e+a>=V:r+a>=Z)&&(b.push(N+1),b.push(L),b.push(1-E))}return T}}function jh(i,e,r,a,d,_){if(d-a<=r)return;const y=a+d>>1;ip(i,e,y,a,d,_),jh(i,e,r,a,y-1,1-_),jh(i,e,r,y+1,d,1-_)}function ip(i,e,r,a,d,_){for(;d>a;){if(d-a>600){const C=d-a+1,E=r-a+1,L=Math.log(C),F=.5*Math.exp(2*L/3),N=.5*Math.sqrt(L*F*(C-F)/C)*(E-C/2<0?-1:1);ip(i,e,r,Math.max(a,Math.floor(r-E*F/C+N)),Math.min(d,Math.floor(r+(C-E)*F/C+N)),_)}const y=e[2*r+_];let b=a,T=d;for(Gl(i,e,a,r),e[2*d+_]>y&&Gl(i,e,a,d);b<T;){for(Gl(i,e,b,T),b++,T--;e[2*b+_]<y;)b++;for(;e[2*T+_]>y;)T--}e[2*a+_]===y?Gl(i,e,a,T):(T++,Gl(i,e,T,d)),T<=r&&(a=T+1),r<=T&&(d=T-1)}}function Gl(i,e,r,a){qh(i,r,a),qh(e,2*r,2*a),qh(e,2*r+1,2*a+1)}function qh(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function rp(i,e,r,a){const d=i-r,_=e-a;return d*d+_*_}var Zh;s.bh=void 0,(Zh=s.bh||(s.bh={})).create="create",Zh.load="load",Zh.fullLoad="fullLoad";let Su=null,Xl=[];const Gh=1e3/60,Xh="loadTime",Wh="fullLoadTime",Ag={mark(i){performance.mark(i)},frame(i){const e=i;Su!=null&&Xl.push(e-Su),Su=e},clearMetrics(){Su=null,Xl=[],performance.clearMeasures(Xh),performance.clearMeasures(Wh);for(const i in s.bh)performance.clearMarks(s.bh[i])},getPerformanceMetrics(){performance.measure(Xh,s.bh.create,s.bh.load),performance.measure(Wh,s.bh.create,s.bh.fullLoad);const i=performance.getEntriesByName(Xh)[0].duration,e=performance.getEntriesByName(Wh)[0].duration,r=Xl.length,a=1/(Xl.reduce((_,y)=>_+y,0)/r/1e3),d=Xl.filter(_=>_>Gh).reduce((_,y)=>_+(y-Gh)/Gh,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:d/(r+d)*100,totalFrames:r}}};s.$=function(i,e,r){var a,d,_,y,b,T,C,E,L,F,N,V,Z=r[0],J=r[1],ee=r[2];return e===i?(i[12]=e[0]*Z+e[4]*J+e[8]*ee+e[12],i[13]=e[1]*Z+e[5]*J+e[9]*ee+e[13],i[14]=e[2]*Z+e[6]*J+e[10]*ee+e[14],i[15]=e[3]*Z+e[7]*J+e[11]*ee+e[15]):(d=e[1],_=e[2],y=e[3],b=e[4],T=e[5],C=e[6],E=e[7],L=e[8],F=e[9],N=e[10],V=e[11],i[0]=a=e[0],i[1]=d,i[2]=_,i[3]=y,i[4]=b,i[5]=T,i[6]=C,i[7]=E,i[8]=L,i[9]=F,i[10]=N,i[11]=V,i[12]=a*Z+b*J+L*ee+e[12],i[13]=d*Z+T*J+F*ee+e[13],i[14]=_*Z+C*J+N*ee+e[14],i[15]=y*Z+E*J+V*ee+e[15]),i},s.A=va,s.B=sn,s.C=class{constructor(i,e,r){this.receive=a=>{const d=a.data,_=d.id;if(_&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){delete this.tasks[_];const y=this.cancelCallbacks[_];delete this.cancelCallbacks[_],y&&y()}else Pt()||d.mustQueue?(this.tasks[_]=d,this.taskQueue.push(_),this.invoker.trigger()):this.processTask(_,d)},this.process=()=>{if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),d=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),d&&this.processTask(a,d)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new vg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pt()?i:window}send(i,e,r,a,d=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[_]=r);const y=[],b={id:_,type:i,hasCallback:!!r,targetMapId:a,mustQueue:d,sourceMapId:this.mapId,data:mo(e,y)};return this.target.postMessage(b,{transfer:y}),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(rs(e.error)):r(null,rs(e.data)))}else{let r=!1;const a=[],d=e.hasCallback?(b,T)=>{r=!0,delete this.cancelCallbacks[i];const C={id:i,type:"<response>",sourceMapId:this.mapId,error:b?mo(b):null,data:mo(T,a)};this.target.postMessage(C,{transfer:a})}:b=>{r=!0};let _=null;const y=rs(e.data);if(this.parent[e.type])_=this.parent[e.type](e.sourceMapId,y,d);else if("getWorkerSource"in this.parent){const b=e.type.split(".");_=this.parent.getWorkerSource(e.sourceMapId,b[0],y.source)[b[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!r&&_&&_.cancel&&(this.cancelCallbacks[i]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=wt,s.E=_r,s.F=function(i,e){const r={};for(let a=0;a<e.length;a++){const d=e[a];d in i&&(r[d]=i[d])}return r},s.G=Pf,s.H=zf,s.I=Ch,s.J=W,s.K=ne,s.L=us,s.M=$t,s.N=or,s.O=En,s.P=ie,s.Q=Oi,s.R=An,s.S=Ei,s.T=Yc,s.U=yu,s.V=class extends zo{},s.W=Oh,s.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const d=window.document.createElement("source");Ii(i[a])||(r.crossOrigin="Anonymous"),d.src=i[a],r.appendChild(d)}return{cancel:()=>{}}},s.Y=Qe,s.Z=function(){var i=new va(16);return va!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s._=I,s.a=kt,s.a$=class extends O{},s.a0=function(i,e,r){var a=r[0],d=r[1],_=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*d,i[5]=e[5]*d,i[6]=e[6]*d,i[7]=e[7]*d,i[8]=e[8]*_,i[9]=e[9]*_,i[10]=e[10]*_,i[11]=e[11]*_,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.a1=Bd,s.a2=function(){return Ue++},s.a3=$,s.a4=ka,s.a5=function(){cn.isLoading()||cn.isLoaded()||bl()!=="deferred"||Jc()},s.a6=cl,s.a7=Bs,s.a8=Ai,s.a9=Nf,s.aA=As,s.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Dr(i[r],e[i[r].ref]));return i},s.aC=function(i){if(i.type==="custom")return new yg(i);switch(i.type){case"background":return new mg(i);case"circle":return new e_(i);case"fill":return new b_(i);case"fill-extrusion":return new B_(i);case"heatmap":return new i_(i);case"hillshade":return new n_(i);case"line":return new q_(i);case"raster":return new gg(i);case"symbol":return new gu(i)}},s.aD=Te,s.aE=function(i,e){if(!i)return[{command:qt.setStyle,args:[e]}];let r=[];try{if(!di(i.version,e.version))return[{command:qt.setStyle,args:[e]}];di(i.center,e.center)||r.push({command:qt.setCenter,args:[e.center]}),di(i.zoom,e.zoom)||r.push({command:qt.setZoom,args:[e.zoom]}),di(i.bearing,e.bearing)||r.push({command:qt.setBearing,args:[e.bearing]}),di(i.pitch,e.pitch)||r.push({command:qt.setPitch,args:[e.pitch]}),di(i.sprite,e.sprite)||r.push({command:qt.setSprite,args:[e.sprite]}),di(i.glyphs,e.glyphs)||r.push({command:qt.setGlyphs,args:[e.glyphs]}),di(i.transition,e.transition)||r.push({command:qt.setTransition,args:[e.transition]}),di(i.light,e.light)||r.push({command:qt.setLight,args:[e.light]});const a={},d=[];(function(y,b,T,C){let E;for(E in b=b||{},y=y||{})Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(b,E)||Cn(E,T,C));for(E in b)Object.prototype.hasOwnProperty.call(b,E)&&(Object.prototype.hasOwnProperty.call(y,E)?di(y[E],b[E])||(y[E].type==="geojson"&&b[E].type==="geojson"&&Ui(y,b,E)?T.push({command:qt.setGeoJSONSourceData,args:[E,b[E].data]}):rr(E,b,T,C)):nn(E,b,T))})(i.sources,e.sources,d,a);const _=[];i.layers&&i.layers.forEach(y=>{a[y.source]?r.push({command:qt.removeLayer,args:[y.id]}):_.push(y)}),r=r.concat(d),function(y,b,T){b=b||[];const C=(y=y||[]).map(ji),E=b.map(ji),L=y.reduce(So,{}),F=b.reduce(So,{}),N=C.slice(),V=Object.create(null);let Z,J,ee,de,oe,me,Se;for(Z=0,J=0;Z<C.length;Z++)ee=C[Z],Object.prototype.hasOwnProperty.call(F,ee)?J++:(T.push({command:qt.removeLayer,args:[ee]}),N.splice(N.indexOf(ee,J),1));for(Z=0,J=0;Z<E.length;Z++)ee=E[E.length-1-Z],N[N.length-1-Z]!==ee&&(Object.prototype.hasOwnProperty.call(L,ee)?(T.push({command:qt.removeLayer,args:[ee]}),N.splice(N.lastIndexOf(ee,N.length-J),1)):J++,me=N[N.length-Z],T.push({command:qt.addLayer,args:[F[ee],me]}),N.splice(N.length-Z,0,ee),V[ee]=!0);for(Z=0;Z<E.length;Z++)if(ee=E[Z],de=L[ee],oe=F[ee],!V[ee]&&!di(de,oe))if(di(de.source,oe.source)&&di(de["source-layer"],oe["source-layer"])&&di(de.type,oe.type)){for(Se in si(de.layout,oe.layout,T,ee,null,qt.setLayoutProperty),si(de.paint,oe.paint,T,ee,null,qt.setPaintProperty),di(de.filter,oe.filter)||T.push({command:qt.setFilter,args:[ee,oe.filter]}),di(de.minzoom,oe.minzoom)&&di(de.maxzoom,oe.maxzoom)||T.push({command:qt.setLayerZoomRange,args:[ee,oe.minzoom,oe.maxzoom]}),de)Object.prototype.hasOwnProperty.call(de,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?si(de[Se],oe[Se],T,ee,Se.slice(6),qt.setPaintProperty):di(de[Se],oe[Se])||T.push({command:qt.setLayerProperty,args:[ee,Se,oe[Se]]}));for(Se in oe)Object.prototype.hasOwnProperty.call(oe,Se)&&!Object.prototype.hasOwnProperty.call(de,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?si(de[Se],oe[Se],T,ee,Se.slice(6),qt.setPaintProperty):di(de[Se],oe[Se])||T.push({command:qt.setLayerProperty,args:[ee,Se,oe[Se]]}))}else T.push({command:qt.removeLayer,args:[ee]}),me=N[N.lastIndexOf(ee)+1],T.push({command:qt.addLayer,args:[oe,me]})}(_,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:qt.setStyle,args:[e]}]}return r},s.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!i(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!i(e[a],r[a]))return!1;return!0}return e===r},s.aH=je,s.aI=we,s.aJ=Es,s.aK=function(i){return i({pluginStatus:Zr,pluginURL:_o}),Es.on("pluginStateChange",i),i},s.aL=class extends Bo{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.aM=ga,s.aN=class extends Bo{constructor(i,e){super(i,e),this.current=sh}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.aO=iu,s.aP=class extends Bo{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.aQ=class extends Bo{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.aR=ru,s.aS=function(i,e,r,a,d,_,y){var b=1/(e-r),T=1/(a-d),C=1/(_-y);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+r)*b,i[13]=(d+a)*T,i[14]=(y+_)*C,i[15]=1,i},s.aT=vi,s.aU=Qm,s.aV=class extends h{},s.aW=W_,s.aX=class extends g{},s.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.aZ=Vd,s.a_=Ke,s.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,d,_)=>{const y=d||_;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},s.ab=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},s.ac=function(i){if(ut==null){const e=i.navigator?i.navigator.userAgent:null;ut=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ut},s.ad=ze,s.ae=function(i,e,r){var a=Math.sin(r),d=Math.cos(r),_=e[0],y=e[1],b=e[2],T=e[3],C=e[4],E=e[5],L=e[6],F=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*d+C*a,i[1]=y*d+E*a,i[2]=b*d+L*a,i[3]=T*d+F*a,i[4]=C*d-_*a,i[5]=E*d-y*a,i[6]=L*d-b*a,i[7]=F*d-T*a,i},s.af=function(i){var e=new va(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.ag=au,s.ah=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:y}=i,b=d?ze(an.interpolationFactor(d,e,_,y),0,1):0;i.kind==="camera"?a=sn.number(i.minSize,i.maxSize,b):r=b}return{uSizeT:r,uSize:a}},s.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:d}){return i.kind==="source"?a/yo:i.kind==="composite"?sn.number(a/yo,d/yo,r):e},s.ak=zh,s.al=function(i,e,r,a){const d=e.y-i.y,_=e.x-i.x,y=a.y-r.y,b=a.x-r.x,T=y*_-b*d;if(T===0)return null;const C=(b*(i.y-r.y)-y*(i.x-r.x))/T;return new ie(i.x+C*_,i.y+C*d)},s.am=qf,s.an=Ad,s.ao=hh,s.ap=ur,s.ar=Ph,s.as=function(i,e){var r=e[0],a=e[1],d=e[2],_=e[3],y=e[4],b=e[5],T=e[6],C=e[7],E=e[8],L=e[9],F=e[10],N=e[11],V=e[12],Z=e[13],J=e[14],ee=e[15],de=r*b-a*y,oe=r*T-d*y,me=r*C-_*y,Se=a*T-d*b,Oe=a*C-_*b,ct=d*C-_*T,_t=E*Z-L*V,at=E*J-F*V,ot=E*ee-N*V,Ye=L*J-F*Z,ft=L*ee-N*Z,tt=F*ee-N*J,Ge=de*tt-oe*ft+me*Ye+Se*ot-Oe*at+ct*_t;return Ge?(i[0]=(b*tt-T*ft+C*Ye)*(Ge=1/Ge),i[1]=(d*ft-a*tt-_*Ye)*Ge,i[2]=(Z*ct-J*Oe+ee*Se)*Ge,i[3]=(F*Oe-L*ct-N*Se)*Ge,i[4]=(T*ot-y*tt-C*at)*Ge,i[5]=(r*tt-d*ot+_*at)*Ge,i[6]=(J*me-V*ct-ee*oe)*Ge,i[7]=(E*ct-F*me+N*oe)*Ge,i[8]=(y*ft-b*ot+C*_t)*Ge,i[9]=(a*ot-r*ft-_*_t)*Ge,i[10]=(V*Oe-Z*me+ee*de)*Ge,i[11]=(L*me-E*Oe-N*de)*Ge,i[12]=(b*at-y*Ye-T*_t)*Ge,i[13]=(r*Ye-a*at+d*_t)*Ge,i[14]=(Z*oe-V*Se-J*de)*Ge,i[15]=(E*Se-L*oe+F*de)*Ge,i):null},s.at=Vh,s.au=Eh,s.av=Uh,s.aw=function(){const i={},e=Pe.$version;for(const r in Pe.$root){const a=Pe.$root[r];if(a.required){let d=null;d=r==="version"?e:a.type==="array"?[]:{},d!=null&&(i[r]=d)}}return i},s.ax=qt,s.ay=Wc,s.az=Ut,s.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(a=>{e(null,a)}).catch(a=>{e(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=Sr,s.b1=function(i,e){var r=i[0],a=i[1],d=i[2],_=i[3],y=i[4],b=i[5],T=i[6],C=i[7],E=i[8],L=i[9],F=i[10],N=i[11],V=i[12],Z=i[13],J=i[14],ee=i[15],de=e[0],oe=e[1],me=e[2],Se=e[3],Oe=e[4],ct=e[5],_t=e[6],at=e[7],ot=e[8],Ye=e[9],ft=e[10],tt=e[11],Ge=e[12],Tt=e[13],yt=e[14],Kt=e[15];return Math.abs(r-de)<=Xr*Math.max(1,Math.abs(r),Math.abs(de))&&Math.abs(a-oe)<=Xr*Math.max(1,Math.abs(a),Math.abs(oe))&&Math.abs(d-me)<=Xr*Math.max(1,Math.abs(d),Math.abs(me))&&Math.abs(_-Se)<=Xr*Math.max(1,Math.abs(_),Math.abs(Se))&&Math.abs(y-Oe)<=Xr*Math.max(1,Math.abs(y),Math.abs(Oe))&&Math.abs(b-ct)<=Xr*Math.max(1,Math.abs(b),Math.abs(ct))&&Math.abs(T-_t)<=Xr*Math.max(1,Math.abs(T),Math.abs(_t))&&Math.abs(C-at)<=Xr*Math.max(1,Math.abs(C),Math.abs(at))&&Math.abs(E-ot)<=Xr*Math.max(1,Math.abs(E),Math.abs(ot))&&Math.abs(L-Ye)<=Xr*Math.max(1,Math.abs(L),Math.abs(Ye))&&Math.abs(F-ft)<=Xr*Math.max(1,Math.abs(F),Math.abs(ft))&&Math.abs(N-tt)<=Xr*Math.max(1,Math.abs(N),Math.abs(tt))&&Math.abs(V-Ge)<=Xr*Math.max(1,Math.abs(V),Math.abs(Ge))&&Math.abs(Z-Tt)<=Xr*Math.max(1,Math.abs(Z),Math.abs(Tt))&&Math.abs(J-yt)<=Xr*Math.max(1,Math.abs(J),Math.abs(yt))&&Math.abs(ee-Kt)<=Xr*Math.max(1,Math.abs(ee),Math.abs(Kt))},s.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},s.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.b5=Ce,s.b6=Ff,s.b7=Lf,s.b8=function(i,e,r,a,d){var _,y=1/Math.tan(e/2);return i[0]=y/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+a)*(_=1/(a-d)),i[14]=2*d*a*_):(i[10]=-1,i[14]=-2*a),i},s.b9=function(i,e,r){var a=Math.sin(r),d=Math.cos(r),_=e[4],y=e[5],b=e[6],T=e[7],C=e[8],E=e[9],L=e[10],F=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=_*d+C*a,i[5]=y*d+E*a,i[6]=b*d+L*a,i[7]=T*d+F*a,i[8]=C*d-_*a,i[9]=E*d-y*a,i[10]=L*d-b*a,i[11]=F*d-T*a,i},s.bA=B,s.bB=lf,s.bC=sa,s.bD=cn,s.ba=re,s.bb=_e,s.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.bd=class extends Ls{},s.be=Fh,s.bf=Df,s.bg=Ag,s.bi=qe,s.bj=function(i,e,r=!1){if(Zr===ml||Zr===_l||Zr===gl)throw new Error("setRTLTextPlugin cannot be called multiple times.");_o=Ti.resolveURL(i),Zr=ml,yl=e,vl(),r||Jc()},s.bk=bl,s.bl=function(i,e){const r={};for(let d=0;d<i.length;d++){const _=e&&e[i[d].id]||ua(i[d]);e&&(e[i[d].id]=_);let y=r[_];y||(y=r[_]=[]),y.push(i[d])}const a=[];for(const d in r)a.push(r[d]);return a},s.bm=ht,s.bn=Of,s.bo=Vf,s.bp=gf,s.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=or/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,a=e._unevaluatedLayout._values,d={layoutIconSize:a["icon-size"].possiblyEvaluate(new Ai(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Ai(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Ai(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:E}=i.bucket.textSizeData;d.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Ai(C),i.canonical),a["text-size"].possiblyEvaluate(new Ai(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:E}=i.bucket.iconSizeData;d.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Ai(C),i.canonical),a["icon-size"].possiblyEvaluate(new Ai(E),i.canonical)]}const _=r.get("text-line-height")*ur,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",b=r.get("text-keep-upright"),T=r.get("text-size");for(const C of i.bucket.features){const E=r.get("text-font").evaluate(C,{},i.canonical).join(","),L=T.evaluate(C,{},i.canonical),F=d.layoutTextSize.evaluate(C,{},i.canonical),N=d.layoutIconSize.evaluate(C,{},i.canonical),V={horizontal:{},vertical:void 0},Z=C.text;let J,ee=[0,0];if(Z){const me=Z.toString(),Se=r.get("text-letter-spacing").evaluate(C,{},i.canonical)*ur,Oe=fl(me)?Se:0,ct=r.get("text-anchor").evaluate(C,{},i.canonical),_t=Yf(e,C,i.canonical);if(!_t){const tt=r.get("text-radial-offset").evaluate(C,{},i.canonical);ee=tt?Jf(ct,[tt*ur,Nh]):r.get("text-offset").evaluate(C,{},i.canonical).map(Ge=>Ge*ur)}let at=y?"center":r.get("text-justify").evaluate(C,{},i.canonical);const ot=r.get("symbol-placement"),Ye=ot==="point"?r.get("text-max-width").evaluate(C,{},i.canonical)*ur:0,ft=()=>{i.bucket.allowVerticalPlacement&&dl(me)&&(V.vertical=pu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ye,_,ct,"left",Oe,ee,s.ai.vertical,!0,ot,F,L))};if(!y&&_t){const tt=new Set;if(at==="auto")for(let Tt=0;Tt<_t.values.length;Tt+=2)tt.add(Vh(_t.values[Tt]));else tt.add(at);let Ge=!1;for(const Tt of tt)if(!V.horizontal[Tt])if(Ge)V.horizontal[Tt]=V.horizontal[0];else{const yt=pu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ye,_,"center",Tt,Oe,ee,s.ai.horizontal,!1,ot,F,L);yt&&(V.horizontal[Tt]=yt,Ge=yt.positionedLines.length===1)}ft()}else{at==="auto"&&(at=Vh(ct));const tt=pu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ye,_,ct,at,Oe,ee,s.ai.horizontal,!1,ot,F,L);tt&&(V.horizontal[at]=tt),ft(),dl(me)&&y&&b&&(V.vertical=pu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ye,_,ct,at,Oe,ee,s.ai.vertical,!1,ot,F,L))}}let de=!1;if(C.icon&&C.icon.name){const me=i.imageMap[C.icon.name];me&&(J=ug(i.imagePositions[C.icon.name],r.get("icon-offset").evaluate(C,{},i.canonical),r.get("icon-anchor").evaluate(C,{},i.canonical)),de=!!me.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=de:i.bucket.sdfIcons!==de&&bt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(me.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const oe=ep(V.horizontal)||V.vertical;i.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||J)&&Mg(i.bucket,C,V,J,i.imageMap,d,F,N,ee,de,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},s.br=Th,s.bs=xh,s.bt=Sh,s.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},s.bv=Ih,s.bw=as,s.bx=function(i,e,r,a,d){return I(this,void 0,void 0,function*(){if(ne())try{return yield $t(i,e,r,a,d)}catch{}return function(_,y,b,T,C){const E=_.width,L=_.height;Vt&&Xt||(Vt=new OffscreenCanvas(E,L),Xt=Vt.getContext("2d",{willReadFrequently:!0})),Vt.width=E,Vt.height=L,Xt.drawImage(_,0,0,E,L);const F=Xt.getImageData(y,b,T,C);return Xt.clearRect(0,0,E,L),F.data}(i,e,r,a,d)})},s.by=Rf,s.bz=M,s.c=Je,s.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=yi})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(a):yi},s.e=Ae,s.f=function(i,e){return Hi(Ae(i,{type:"json"}),e)},s.g=jt,s.h=Ti,s.i=Pt,s.j=Lr,s.k=Mn,s.l=Xe,s.m=Hi,s.n=function(i){return new Ih(i).readFields(ng,[])},s.o=function(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const d=new Array(i.length);let _=null;i.forEach((y,b)=>{e(y,(T,C)=>{T&&(_=T),d[b]=C,--a==0&&r(_,d)})})},s.p=_f,s.q=Ll,s.r=Qi,s.s=Ii,s.t=ih,s.u=lt,s.v=Pe,s.w=bt,s.x=fa,s.y=io,s.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),v(["./shared"],function(s){class I{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,R){for(const K of D){this._layerConfigs[K.id]=K;const Y=this._layers[K.id]=s.aC(K);Y._featureFilter=s.a6(Y.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of R)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const U=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const K of U){const Y=K.map(Fe=>this._layers[Fe.id]),pe=Y[0];if(pe.visibility==="none")continue;const se=pe.source||"";let te=this.familiesBySource[se];te||(te=this.familiesBySource[se]={});const he=pe.sourceLayer||"_geojsonTileLayer";let Le=te[he];Le||(Le=te[he]=[]),Le.push(Y)}}}class M{constructor(D){const R={},U=[];for(const se in D){const te=D[se],he=R[se]={};for(const Le in te){const Fe=te[+Le];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Ne={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};U.push(Ne),he[Le]={rect:Ne,metrics:Fe.metrics}}}const{w:K,h:Y}=s.p(U),pe=new s.q({width:K||1,height:Y||1});for(const se in D){const te=D[se];for(const he in te){const Le=te[+he];if(!Le||Le.bitmap.width===0||Le.bitmap.height===0)continue;const Fe=R[se][he].rect;s.q.copy(Le.bitmap,pe,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},Le.bitmap)}}this.image=pe,this.positions=R}}s.bm("GlyphAtlas",M);class B{constructor(D){this.tileID=new s.O(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(D,R,U,K,Y){this.status="parsing",this.data=D,this.collisionBoxArray=new s.a3;const pe=new s.bn(Object.keys(D.layers).sort()),se=new s.bo(this.tileID,this.promoteId);se.bucketLayerIDs=[];const te={},he={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U},Le=R.familiesBySource[this.source];for(const ui in Le){const ai=D.layers[ui];if(!ai)continue;ai.version===1&&s.w(`Vector tile source "${this.source}" layer "${ui}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mr=pe.encode(ui),Mi=[];for(let nr=0;nr<ai.length;nr++){const xr=ai.feature(nr),gn=se.getId(xr,ui);Mi.push({feature:xr,id:gn,index:nr,sourceLayerIndex:Mr})}for(const nr of Le[ui]){const xr=nr[0];xr.source!==this.source&&s.w(`layer.source = ${xr.source} does not equal this.source = ${this.source}`),xr.minzoom&&this.zoom<Math.floor(xr.minzoom)||xr.maxzoom&&this.zoom>=xr.maxzoom||xr.visibility!=="none"&&(j(nr,this.zoom,U),(te[xr.id]=xr.createBucket({index:se.bucketLayerIDs.length,layers:nr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mr,sourceID:this.source})).populate(Mi,he,this.tileID.canonical),se.bucketLayerIDs.push(nr.map(gn=>gn.id)))}}let Fe,Ne,St,zt;const pt=s.aH(he.glyphDependencies,ui=>Object.keys(ui).map(Number));this.inFlightDependencies.forEach(ui=>ui==null?void 0:ui.cancel()),this.inFlightDependencies=[];const It=++this.dependencySentinel;Object.keys(pt).length?this.inFlightDependencies.push(K.send("getGlyphs",{uid:this.uid,stacks:pt,source:this.source,tileID:this.tileID,type:"glyphs"},(ui,ai)=>{It===this.dependencySentinel&&(Fe||(Fe=ui,Ne=ai,xi.call(this)))})):Ne={};const Ft=Object.keys(he.iconDependencies);Ft.length?this.inFlightDependencies.push(K.send("getImages",{icons:Ft,source:this.source,tileID:this.tileID,type:"icons"},(ui,ai)=>{It===this.dependencySentinel&&(Fe||(Fe=ui,St=ai,xi.call(this)))})):St={};const _i=Object.keys(he.patternDependencies);function xi(){if(Fe)return Y(Fe);if(Ne&&St&&zt){const ui=new M(Ne),ai=new s.bp(St,zt);for(const Mr in te){const Mi=te[Mr];Mi instanceof s.a4?(j(Mi.layers,this.zoom,U),s.bq({bucket:Mi,glyphMap:Ne,glyphPositions:ui.positions,imageMap:St,imagePositions:ai.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Mi.hasPattern&&(Mi instanceof s.br||Mi instanceof s.bs||Mi instanceof s.bt)&&(j(Mi.layers,this.zoom,U),Mi.addFeatures(he,this.tileID.canonical,ai.patternPositions))}this.status="done",Y(null,{buckets:Object.values(te).filter(Mr=>!Mr.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ui.image,imageAtlas:ai,glyphMap:this.returnDependencies?Ne:null,iconMap:this.returnDependencies?St:null,glyphPositions:this.returnDependencies?ui.positions:null})}}_i.length?this.inFlightDependencies.push(K.send("getImages",{icons:_i,source:this.source,tileID:this.tileID,type:"patterns"},(ui,ai)=>{It===this.dependencySentinel&&(Fe||(Fe=ui,zt=ai,xi.call(this)))})):zt={},xi.call(this)}}function j(H,D,R){const U=new s.a8(D);for(const K of H)K.recalculate(U,R)}function ie(H,D){const R=s.l(H.request,(U,K,Y,pe)=>{if(U)D(U);else if(K)try{const se=new s.bw.VectorTile(new s.bv(K));D(null,{vectorTile:se,rawData:K,cacheControl:Y,expires:pe})}catch(se){const te=new Uint8Array(K);let he=`Unable to parse the tile at ${H.request.url}, `;he+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${se.messge}`,D(new Error(he))}});return()=>{R.cancel(),D()}}class ae{constructor(D,R,U,K){this.actor=D,this.layerIndex=R,this.availableImages=U,this.loadVectorData=K||ie,this.fetching={},this.loading={},this.loaded={}}loadTile(D,R){const U=D.uid;this.loading||(this.loading={});const K=!!(D&&D.request&&D.request.collectResourceTiming)&&new s.bu(D.request),Y=this.loading[U]=new B(D);Y.abort=this.loadVectorData(D,(pe,se)=>{if(delete this.loading[U],pe||!se)return Y.status="done",this.loaded[U]=Y,R(pe);const te=se.rawData,he={};se.expires&&(he.expires=se.expires),se.cacheControl&&(he.cacheControl=se.cacheControl);const Le={};if(K){const Fe=K.finish();Fe&&(Le.resourceTiming=JSON.parse(JSON.stringify(Fe)))}Y.vectorTile=se.vectorTile,Y.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,(Fe,Ne)=>{if(delete this.fetching[U],Fe||!Ne)return R(Fe);R(null,s.e({rawTileData:te.slice(0)},Ne,he,Le))}),this.loaded=this.loaded||{},this.loaded[U]=Y,this.fetching[U]={rawTileData:te,cacheControl:he,resourceTiming:Le}})}reloadTile(D,R){const U=this.loaded,K=D.uid;if(U&&U[K]){const Y=U[K];Y.showCollisionBoxes=D.showCollisionBoxes,Y.status==="parsing"?Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,(pe,se)=>{if(pe||!se)return R(pe,se);let te;if(this.fetching[K]){const{rawTileData:he,cacheControl:Le,resourceTiming:Fe}=this.fetching[K];delete this.fetching[K],te=s.e({rawTileData:he.slice(0)},se,Le,Fe)}else te=se;R(null,te)}):Y.status==="done"&&(Y.vectorTile?Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,R):R())}}abortTile(D,R){const U=this.loading,K=D.uid;U&&U[K]&&U[K].abort&&(U[K].abort(),delete U[K]),R()}removeTile(D,R){const U=this.loaded,K=D.uid;U&&U[K]&&delete U[K],R()}}class ce{constructor(){this.loaded={}}loadTile(D,R){return s._(this,void 0,void 0,function*(){const{uid:U,encoding:K,rawImageData:Y,redFactor:pe,greenFactor:se,blueFactor:te,baseShift:he}=D,Le=Y.width+2,Fe=Y.height+2,Ne=s.a(Y)?new s.R({width:Le,height:Fe},yield s.bx(Y,-1,-1,Le,Fe)):Y,St=new s.by(U,Ne,K,pe,se,te,he);this.loaded=this.loaded||{},this.loaded[U]=St,R(null,St)})}removeTile(D){const R=this.loaded,U=D.uid;R&&R[U]&&delete R[U]}}function ge(H,D){if(H.length!==0){ve(H[0],D);for(var R=1;R<H.length;R++)ve(H[R],!D)}}function ve(H,D){for(var R=0,U=0,K=0,Y=H.length,pe=Y-1;K<Y;pe=K++){var se=(H[K][0]-H[pe][0])*(H[pe][1]+H[K][1]),te=R+se;U+=Math.abs(R)>=Math.abs(se)?R-te+se:se-te+R,R=te}R+U>=0!=!!D&&H.reverse()}var Ee=s.bz(function H(D,R){var U,K=D&&D.type;if(K==="FeatureCollection")for(U=0;U<D.features.length;U++)H(D.features[U],R);else if(K==="GeometryCollection")for(U=0;U<D.geometries.length;U++)H(D.geometries[U],R);else if(K==="Feature")H(D.geometry,R);else if(K==="Polygon")ge(D.coordinates,R);else if(K==="MultiPolygon")for(U=0;U<D.coordinates.length;U++)ge(D.coordinates[U],R);return D});const W=s.bw.VectorTileFeature.prototype.toGeoJSON;var ne={exports:{}},re=s.bA,_e=s.bw.VectorTileFeature,ze=Ce;function Ce(H,D){this.options=D||{},this.features=H,this.length=H.length}function Ae(H,D){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=D||4096}Ce.prototype.feature=function(H){return new Ae(this.features[H],this.options.extent)},Ae.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var D=0;D<H.length;D++){for(var R=H[D],U=[],K=0;K<R.length;K++)U.push(new re(R[K][0],R[K][1]));this.geometry.push(U)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,D=1/0,R=-1/0,U=1/0,K=-1/0,Y=0;Y<H.length;Y++)for(var pe=H[Y],se=0;se<pe.length;se++){var te=pe[se];D=Math.min(D,te.x),R=Math.max(R,te.x),U=Math.min(U,te.y),K=Math.max(K,te.y)}return[D,U,R,K]},Ae.prototype.toGeoJSON=_e.prototype.toGeoJSON;var Ue=s.bB,je=ze;function we(H){var D=new Ue;return function(R,U){for(var K in R.layers)U.writeMessage(3,Te,R.layers[K])}(H,D),D.finish()}function Te(H,D){var R;D.writeVarintField(15,H.version||1),D.writeStringField(1,H.name||""),D.writeVarintField(5,H.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<H.length;R++)U.feature=H.feature(R),D.writeMessage(2,xt,U);var K=U.keys;for(R=0;R<K.length;R++)D.writeStringField(3,K[R]);var Y=U.values;for(R=0;R<Y.length;R++)D.writeMessage(4,ut,Y[R])}function xt(H,D){var R=H.feature;R.id!==void 0&&D.writeVarintField(1,R.id),D.writeMessage(2,bt,H),D.writeVarintField(3,R.type),D.writeMessage(4,Pt,R)}function bt(H,D){var R=H.feature,U=H.keys,K=H.values,Y=H.keycache,pe=H.valuecache;for(var se in R.properties){var te=R.properties[se],he=Y[se];if(te!==null){he===void 0&&(U.push(se),Y[se]=he=U.length-1),D.writeVarint(he);var Le=typeof te;Le!=="string"&&Le!=="boolean"&&Le!=="number"&&(te=JSON.stringify(te));var Fe=Le+":"+te,Ne=pe[Fe];Ne===void 0&&(K.push(te),pe[Fe]=Ne=K.length-1),D.writeVarint(Ne)}}}function it(H,D){return(D<<3)+(7&H)}function dt(H){return H<<1^H>>31}function Pt(H,D){for(var R=H.loadGeometry(),U=H.type,K=0,Y=0,pe=R.length,se=0;se<pe;se++){var te=R[se],he=1;U===1&&(he=te.length),D.writeVarint(it(1,he));for(var Le=U===3?te.length-1:te.length,Fe=0;Fe<Le;Fe++){Fe===1&&U!==1&&D.writeVarint(it(2,Le-1));var Ne=te[Fe].x-K,St=te[Fe].y-Y;D.writeVarint(dt(Ne)),D.writeVarint(dt(St)),K+=Ne,Y+=St}U===3&&D.writeVarint(it(7,1))}}function ut(H,D){var R=typeof H;R==="string"?D.writeStringField(1,H):R==="boolean"?D.writeBooleanField(7,H):R==="number"&&(H%1!=0?D.writeDoubleField(3,H):H<0?D.writeSVarintField(6,H):D.writeVarintField(5,H))}ne.exports=we,ne.exports.fromVectorTileJs=we,ne.exports.fromGeojsonVt=function(H,D){D=D||{};var R={};for(var U in H)R[U]=new je(H[U].features,D),R[U].name=U,R[U].version=D.version,R[U].extent=D.extent;return we({layers:R})},ne.exports.GeoJSONWrapper=je;var kt=s.bz(ne.exports);const yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},$t=Math.fround||(Vt=new Float32Array(1),H=>(Vt[0]=+H,Vt[0]));var Vt;const Xt=3,hi=5,ar=6;class Ti{constructor(D){this.options=Object.assign(Object.create(yi),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:R,minZoom:U,maxZoom:K}=this.options;R&&console.time("total time");const Y=`prepare ${D.length} points`;R&&console.time(Y),this.points=D;const pe=[];for(let te=0;te<D.length;te++){const he=D[te];if(!he.geometry)continue;const[Le,Fe]=he.geometry.coordinates,Ne=$t(Ut(Le)),St=$t(jt(Fe));pe.push(Ne,St,1/0,te,-1,1),this.options.reduce&&pe.push(0)}let se=this.trees[K+1]=this._createTree(pe);R&&console.timeEnd(Y);for(let te=K;te>=U;te--){const he=+Date.now();se=this.trees[te]=this._createTree(this._cluster(se,te)),R&&console.log("z%d: %d clusters in %dms",te,se.numItems,+Date.now()-he)}return R&&console.timeEnd("total time"),this}getClusters(D,R){let U=((D[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,D[1]));let Y=D[2]===180?180:((D[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)U=-180,Y=180;else if(U>Y){const Fe=this.getClusters([U,K,180,pe],R),Ne=this.getClusters([-180,K,Y,pe],R);return Fe.concat(Ne)}const se=this.trees[this._limitZoom(R)],te=se.range(Ut(U),jt(pe),Ut(Y),jt(K)),he=se.data,Le=[];for(const Fe of te){const Ne=this.stride*Fe;Le.push(he[Ne+hi]>1?Je(he,Ne,this.clusterProps):this.points[he[Ne+Xt]])}return Le}getChildren(D){const R=this._getOriginId(D),U=this._getOriginZoom(D),K="No cluster with the specified id.",Y=this.trees[U];if(!Y)throw new Error(K);const pe=Y.data;if(R*this.stride>=pe.length)throw new Error(K);const se=this.options.radius/(this.options.extent*Math.pow(2,U-1)),te=Y.within(pe[R*this.stride],pe[R*this.stride+1],se),he=[];for(const Le of te){const Fe=Le*this.stride;pe[Fe+4]===D&&he.push(pe[Fe+hi]>1?Je(pe,Fe,this.clusterProps):this.points[pe[Fe+Xt]])}if(he.length===0)throw new Error(K);return he}getLeaves(D,R,U){const K=[];return this._appendLeaves(K,D,R=R||10,U=U||0,0),K}getTile(D,R,U){const K=this.trees[this._limitZoom(D)],Y=Math.pow(2,D),{extent:pe,radius:se}=this.options,te=se/pe,he=(U-te)/Y,Le=(U+1+te)/Y,Fe={features:[]};return this._addTileFeatures(K.range((R-te)/Y,he,(R+1+te)/Y,Le),K.data,R,U,Y,Fe),R===0&&this._addTileFeatures(K.range(1-te/Y,he,1,Le),K.data,Y,U,Y,Fe),R===Y-1&&this._addTileFeatures(K.range(0,he,te/Y,Le),K.data,-1,U,Y,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(D){let R=this._getOriginZoom(D)-1;for(;R<=this.options.maxZoom;){const U=this.getChildren(D);if(R++,U.length!==1)break;D=U[0].properties.cluster_id}return R}_appendLeaves(D,R,U,K,Y){const pe=this.getChildren(R);for(const se of pe){const te=se.properties;if(te&&te.cluster?Y+te.point_count<=K?Y+=te.point_count:Y=this._appendLeaves(D,te.cluster_id,U,K,Y):Y<K?Y++:D.push(se),D.length===U)break}return Y}_createTree(D){const R=new s.av(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<D.length;U+=this.stride)R.add(D[U],D[U+1]);return R.finish(),R.data=D,R}_addTileFeatures(D,R,U,K,Y,pe){for(const se of D){const te=se*this.stride,he=R[te+hi]>1;let Le,Fe,Ne;if(he)Le=qe(R,te,this.clusterProps),Fe=R[te],Ne=R[te+1];else{const pt=this.points[R[te+Xt]];Le=pt.properties;const[It,Ft]=pt.geometry.coordinates;Fe=Ut(It),Ne=jt(Ft)}const St={type:1,geometry:[[Math.round(this.options.extent*(Fe*Y-U)),Math.round(this.options.extent*(Ne*Y-K))]],tags:Le};let zt;zt=he||this.options.generateId?R[te+Xt]:this.points[R[te+Xt]].id,zt!==void 0&&(St.id=zt),pe.features.push(St)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,R){const{radius:U,extent:K,reduce:Y,minPoints:pe}=this.options,se=U/(K*Math.pow(2,R)),te=D.data,he=[],Le=this.stride;for(let Fe=0;Fe<te.length;Fe+=Le){if(te[Fe+2]<=R)continue;te[Fe+2]=R;const Ne=te[Fe],St=te[Fe+1],zt=D.within(te[Fe],te[Fe+1],se),pt=te[Fe+hi];let It=pt;for(const Ft of zt){const _i=Ft*Le;te[_i+2]>R&&(It+=te[_i+hi])}if(It>pt&&It>=pe){let Ft,_i=Ne*pt,xi=St*pt,ui=-1;const ai=((Fe/Le|0)<<5)+(R+1)+this.points.length;for(const Mr of zt){const Mi=Mr*Le;if(te[Mi+2]<=R)continue;te[Mi+2]=R;const nr=te[Mi+hi];_i+=te[Mi]*nr,xi+=te[Mi+1]*nr,te[Mi+4]=ai,Y&&(Ft||(Ft=this._map(te,Fe,!0),ui=this.clusterProps.length,this.clusterProps.push(Ft)),Y(Ft,this._map(te,Mi)))}te[Fe+4]=ai,he.push(_i/It,xi/It,1/0,ai,-1,It),Y&&he.push(ui)}else{for(let Ft=0;Ft<Le;Ft++)he.push(te[Fe+Ft]);if(It>1)for(const Ft of zt){const _i=Ft*Le;if(!(te[_i+2]<=R)){te[_i+2]=R;for(let xi=0;xi<Le;xi++)he.push(te[_i+xi])}}}}return he}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,R,U){if(D[R+hi]>1){const pe=this.clusterProps[D[R+ar]];return U?Object.assign({},pe):pe}const K=this.points[D[R+Xt]].properties,Y=this.options.map(K);return U&&Y===K?Object.assign({},Y):Y}}function Je(H,D,R){return{type:"Feature",id:H[D+Xt],properties:qe(H,D,R),geometry:{type:"Point",coordinates:[(U=H[D],360*(U-.5)),ki(H[D+1])]}};var U}function qe(H,D,R){const U=H[D+hi],K=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,Y=H[D+ar],pe=Y===-1?{}:Object.assign({},R[Y]);return Object.assign(pe,{cluster:!0,cluster_id:H[D+Xt],point_count:U,point_count_abbreviated:K})}function Ut(H){return H/360+.5}function jt(H){const D=Math.sin(H*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function ki(H){const D=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Hi(H,D,R,U){for(var K,Y=U,pe=R-D>>1,se=R-D,te=H[D],he=H[D+1],Le=H[R],Fe=H[R+1],Ne=D+3;Ne<R;Ne+=3){var St=Xe(H[Ne],H[Ne+1],te,he,Le,Fe);if(St>Y)K=Ne,Y=St;else if(St===Y){var zt=Math.abs(Ne-pe);zt<se&&(K=Ne,se=zt)}}Y>U&&(K-D>3&&Hi(H,D,K,U),H[K+2]=Y,R-K>3&&Hi(H,K,R,U))}function Xe(H,D,R,U,K,Y){var pe=K-R,se=Y-U;if(pe!==0||se!==0){var te=((H-R)*pe+(D-U)*se)/(pe*pe+se*se);te>1?(R=K,U=Y):te>0&&(R+=pe*te,U+=se*te)}return(pe=H-R)*pe+(se=D-U)*se}function Ii(H,D,R,U){var K={id:H===void 0?null:H,type:D,geometry:R,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Y){var pe=Y.geometry,se=Y.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")$i(Y,pe);else if(se==="Polygon"||se==="MultiLineString")for(var te=0;te<pe.length;te++)$i(Y,pe[te]);else if(se==="MultiPolygon")for(te=0;te<pe.length;te++)for(var he=0;he<pe[te].length;he++)$i(Y,pe[te][he])}(K),K}function $i(H,D){for(var R=0;R<D.length;R+=3)H.minX=Math.min(H.minX,D[R]),H.minY=Math.min(H.minY,D[R+1]),H.maxX=Math.max(H.maxX,D[R]),H.maxY=Math.max(H.maxY,D[R+1])}function rn(H,D,R,U){if(D.geometry){var K=D.geometry.coordinates,Y=D.geometry.type,pe=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),se=[],te=D.id;if(R.promoteId?te=D.properties[R.promoteId]:R.generateId&&(te=U||0),Y==="Point")Mn(K,se);else if(Y==="MultiPoint")for(var he=0;he<K.length;he++)Mn(K[he],se);else if(Y==="LineString")Lr(K,se,pe,!1);else if(Y==="MultiLineString"){if(R.lineMetrics){for(he=0;he<K.length;he++)Lr(K[he],se=[],pe,!1),H.push(Ii(te,"LineString",se,D.properties));return}_r(K,se,pe,!1)}else if(Y==="Polygon")_r(K,se,pe,!0);else{if(Y!=="MultiPolygon"){if(Y==="GeometryCollection"){for(he=0;he<D.geometry.geometries.length;he++)rn(H,{id:te,geometry:D.geometry.geometries[he],properties:D.properties},R,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(he=0;he<K.length;he++){var Le=[];_r(K[he],Le,pe,!0),se.push(Le)}}H.push(Ii(te,Y,se,D.properties))}}function Mn(H,D){D.push(Pe(H[0])),D.push(br(H[1])),D.push(0)}function Lr(H,D,R,U){for(var K,Y,pe=0,se=0;se<H.length;se++){var te=Pe(H[se][0]),he=br(H[se][1]);D.push(te),D.push(he),D.push(0),se>0&&(pe+=U?(K*he-te*Y)/2:Math.sqrt(Math.pow(te-K,2)+Math.pow(he-Y,2))),K=te,Y=he}var Le=D.length-3;D[2]=1,Hi(D,0,Le,R),D[Le+2]=1,D.size=Math.abs(pe),D.start=0,D.end=D.size}function _r(H,D,R,U){for(var K=0;K<H.length;K++){var Y=[];Lr(H[K],Y,R,U),D.push(Y)}}function Pe(H){return H/360+.5}function br(H){var D=Math.sin(H*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function Dr(H,D,R,U,K,Y,pe,se){if(U/=D,Y>=(R/=D)&&pe<U)return H;if(pe<R||Y>=U)return null;for(var te=[],he=0;he<H.length;he++){var Le=H[he],Fe=Le.geometry,Ne=Le.type,St=K===0?Le.minX:Le.minY,zt=K===0?Le.maxX:Le.maxY;if(St>=R&&zt<U)te.push(Le);else if(!(zt<R||St>=U)){var pt=[];if(Ne==="Point"||Ne==="MultiPoint")di(Fe,pt,R,U,K);else if(Ne==="LineString")qt(Fe,pt,R,U,K,!1,se.lineMetrics);else if(Ne==="MultiLineString")Cn(Fe,pt,R,U,K,!1);else if(Ne==="Polygon")Cn(Fe,pt,R,U,K,!0);else if(Ne==="MultiPolygon")for(var It=0;It<Fe.length;It++){var Ft=[];Cn(Fe[It],Ft,R,U,K,!0),Ft.length&&pt.push(Ft)}if(pt.length){if(se.lineMetrics&&Ne==="LineString"){for(It=0;It<pt.length;It++)te.push(Ii(Le.id,Ne,pt[It],Le.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(pt.length===1?(Ne="LineString",pt=pt[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=pt.length===3?"Point":"MultiPoint"),te.push(Ii(Le.id,Ne,pt,Le.tags))}}}return te.length?te:null}function di(H,D,R,U,K){for(var Y=0;Y<H.length;Y+=3){var pe=H[Y+K];pe>=R&&pe<=U&&(D.push(H[Y]),D.push(H[Y+1]),D.push(H[Y+2]))}}function qt(H,D,R,U,K,Y,pe){for(var se,te,he=nn(H),Le=K===0?Ui:si,Fe=H.start,Ne=0;Ne<H.length-3;Ne+=3){var St=H[Ne],zt=H[Ne+1],pt=H[Ne+2],It=H[Ne+3],Ft=H[Ne+4],_i=K===0?St:zt,xi=K===0?It:Ft,ui=!1;pe&&(se=Math.sqrt(Math.pow(St-It,2)+Math.pow(zt-Ft,2))),_i<R?xi>R&&(te=Le(he,St,zt,It,Ft,R),pe&&(he.start=Fe+se*te)):_i>U?xi<U&&(te=Le(he,St,zt,It,Ft,U),pe&&(he.start=Fe+se*te)):rr(he,St,zt,pt),xi<R&&_i>=R&&(te=Le(he,St,zt,It,Ft,R),ui=!0),xi>U&&_i<=U&&(te=Le(he,St,zt,It,Ft,U),ui=!0),!Y&&ui&&(pe&&(he.end=Fe+se*te),D.push(he),he=nn(H)),pe&&(Fe+=se)}var ai=H.length-3;St=H[ai],zt=H[ai+1],pt=H[ai+2],(_i=K===0?St:zt)>=R&&_i<=U&&rr(he,St,zt,pt),ai=he.length-3,Y&&ai>=3&&(he[ai]!==he[0]||he[ai+1]!==he[1])&&rr(he,he[0],he[1],he[2]),he.length&&D.push(he)}function nn(H){var D=[];return D.size=H.size,D.start=H.start,D.end=H.end,D}function Cn(H,D,R,U,K,Y){for(var pe=0;pe<H.length;pe++)qt(H[pe],D,R,U,K,Y,!1)}function rr(H,D,R,U){H.push(D),H.push(R),H.push(U)}function Ui(H,D,R,U,K,Y){var pe=(Y-D)/(U-D);return H.push(Y),H.push(R+(K-R)*pe),H.push(1),pe}function si(H,D,R,U,K,Y){var pe=(Y-R)/(K-R);return H.push(D+(U-D)*pe),H.push(Y),H.push(1),pe}function ji(H,D){for(var R=[],U=0;U<H.length;U++){var K,Y=H[U],pe=Y.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")K=So(Y.geometry,D);else if(pe==="MultiLineString"||pe==="Polygon"){K=[];for(var se=0;se<Y.geometry.length;se++)K.push(So(Y.geometry[se],D))}else if(pe==="MultiPolygon")for(K=[],se=0;se<Y.geometry.length;se++){for(var te=[],he=0;he<Y.geometry[se].length;he++)te.push(So(Y.geometry[se][he],D));K.push(te)}R.push(Ii(Y.id,pe,K,Y.tags))}return R}function So(H,D){var R=[];R.size=H.size,H.start!==void 0&&(R.start=H.start,R.end=H.end);for(var U=0;U<H.length;U+=3)R.push(H[U]+D,H[U+1],H[U+2]);return R}function Qe(H,D){if(H.transformed)return H;var R,U,K,Y=1<<H.z,pe=H.x,se=H.y;for(R=0;R<H.features.length;R++){var te=H.features[R],he=te.geometry,Le=te.type;if(te.geometry=[],Le===1)for(U=0;U<he.length;U+=2)te.geometry.push(Rn(he[U],he[U+1],D,Y,pe,se));else for(U=0;U<he.length;U++){var Fe=[];for(K=0;K<he[U].length;K+=2)Fe.push(Rn(he[U][K],he[U][K+1],D,Y,pe,se));te.geometry.push(Fe)}}return H.transformed=!0,H}function Rn(H,D,R,U,K,Y){return[Math.round(R*(H*U-K)),Math.round(R*(D*U-Y))]}function qi(H,D,R,U,K){for(var Y=D===K.maxZoom?0:K.tolerance/((1<<D)*K.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:U,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<H.length;se++){pe.numFeatures++,To(pe,H[se],Y,K);var te=H[se].minX,he=H[se].minY,Le=H[se].maxX,Fe=H[se].maxY;te<pe.minX&&(pe.minX=te),he<pe.minY&&(pe.minY=he),Le>pe.maxX&&(pe.maxX=Le),Fe>pe.maxY&&(pe.maxY=Fe)}return pe}function To(H,D,R,U){var K=D.geometry,Y=D.type,pe=[];if(Y==="Point"||Y==="MultiPoint")for(var se=0;se<K.length;se+=3)pe.push(K[se]),pe.push(K[se+1]),H.numPoints++,H.numSimplified++;else if(Y==="LineString")Jn(pe,K,H,R,!1,!1);else if(Y==="MultiLineString"||Y==="Polygon")for(se=0;se<K.length;se++)Jn(pe,K[se],H,R,Y==="Polygon",se===0);else if(Y==="MultiPolygon")for(var te=0;te<K.length;te++){var he=K[te];for(se=0;se<he.length;se++)Jn(pe,he[se],H,R,!0,se===0)}if(pe.length){var Le=D.tags||null;if(Y==="LineString"&&U.lineMetrics){for(var Fe in Le={},D.tags)Le[Fe]=D.tags[Fe];Le.mapbox_clip_start=K.start/K.size,Le.mapbox_clip_end=K.end/K.size}var Ne={geometry:pe,type:Y==="Polygon"||Y==="MultiPolygon"?3:Y==="LineString"||Y==="MultiLineString"?2:1,tags:Le};D.id!==null&&(Ne.id=D.id),H.features.push(Ne)}}function Jn(H,D,R,U,K,Y){var pe=U*U;if(U>0&&D.size<(K?pe:U))R.numPoints+=D.length/3;else{for(var se=[],te=0;te<D.length;te+=3)(U===0||D[te+2]>pe)&&(R.numSimplified++,se.push(D[te]),se.push(D[te+1])),R.numPoints++;K&&function(he,Le){for(var Fe=0,Ne=0,St=he.length,zt=St-2;Ne<St;zt=Ne,Ne+=2)Fe+=(he[Ne]-he[zt])*(he[Ne+1]+he[zt+1]);if(Fe>0===Le)for(Ne=0,St=he.length;Ne<St/2;Ne+=2){var pt=he[Ne],It=he[Ne+1];he[Ne]=he[St-2-Ne],he[Ne+1]=he[St-1-Ne],he[St-2-Ne]=pt,he[St-1-Ne]=It}}(se,Y),H.push(se)}}function rt(H,D){var R=(D=this.options=function(K,Y){for(var pe in Y)K[pe]=Y[pe];return K}(Object.create(this.options),D)).debug;if(R&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var U=function(K,Y){var pe=[];if(K.type==="FeatureCollection")for(var se=0;se<K.features.length;se++)rn(pe,K.features[se],Y,se);else rn(pe,K.type==="Feature"?K:{geometry:K},Y);return pe}(H,D);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),U=function(K,Y){var pe=Y.buffer/Y.extent,se=K,te=Dr(K,1,-1-pe,pe,0,-1,2,Y),he=Dr(K,1,1-pe,2+pe,0,-1,2,Y);return(te||he)&&(se=Dr(K,1,-pe,1+pe,0,-1,2,Y)||[],te&&(se=ji(te,1).concat(se)),he&&(se=se.concat(ji(he,-1)))),se}(U,D),U.length&&this.splitTile(U,0,0,0),R&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wt(H,D,R){return 32*((1<<H)*R+D)+H}function Bt(H,D){return D?H.properties[D]:H.id}function Br(H,D){if(H==null)return!0;if(H.type==="Feature")return Bt(H,D)!=null;if(H.type==="FeatureCollection"){const R=new Set;for(const U of H.features){const K=Bt(U,D);if(K==null||R.has(K))return!1;R.add(K)}return!0}return!1}function On(H,D){const R=new Map;if(H!=null)if(H.type==="Feature")R.set(Bt(H,D),H);else for(const U of H.features)R.set(Bt(U,D),U);return R}rt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rt.prototype.splitTile=function(H,D,R,U,K,Y,pe){for(var se=[H,D,R,U],te=this.options,he=te.debug;se.length;){U=se.pop(),R=se.pop(),D=se.pop(),H=se.pop();var Le=1<<D,Fe=Wt(D,R,U),Ne=this.tiles[Fe];if(!Ne&&(he>1&&console.time("creation"),Ne=this.tiles[Fe]=qi(H,D,R,U,te),this.tileCoords.push({z:D,x:R,y:U}),he)){he>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,R,U,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var St="z"+D;this.stats[St]=(this.stats[St]||0)+1,this.total++}if(Ne.source=H,K){if(D===te.maxZoom||D===K)continue;var zt=1<<K-D;if(R!==Math.floor(Y/zt)||U!==Math.floor(pe/zt))continue}else if(D===te.indexMaxZoom||Ne.numPoints<=te.indexMaxPoints)continue;if(Ne.source=null,H.length!==0){he>1&&console.time("clipping");var pt,It,Ft,_i,xi,ui,ai=.5*te.buffer/te.extent,Mr=.5-ai,Mi=.5+ai,nr=1+ai;pt=It=Ft=_i=null,xi=Dr(H,Le,R-ai,R+Mi,0,Ne.minX,Ne.maxX,te),ui=Dr(H,Le,R+Mr,R+nr,0,Ne.minX,Ne.maxX,te),H=null,xi&&(pt=Dr(xi,Le,U-ai,U+Mi,1,Ne.minY,Ne.maxY,te),It=Dr(xi,Le,U+Mr,U+nr,1,Ne.minY,Ne.maxY,te),xi=null),ui&&(Ft=Dr(ui,Le,U-ai,U+Mi,1,Ne.minY,Ne.maxY,te),_i=Dr(ui,Le,U+Mr,U+nr,1,Ne.minY,Ne.maxY,te),ui=null),he>1&&console.timeEnd("clipping"),se.push(pt||[],D+1,2*R,2*U),se.push(It||[],D+1,2*R,2*U+1),se.push(Ft||[],D+1,2*R+1,2*U),se.push(_i||[],D+1,2*R+1,2*U+1)}}},rt.prototype.getTile=function(H,D,R){var U=this.options,K=U.extent,Y=U.debug;if(H<0||H>24)return null;var pe=1<<H,se=Wt(H,D=(D%pe+pe)%pe,R);if(this.tiles[se])return Qe(this.tiles[se],K);Y>1&&console.log("drilling down to z%d-%d-%d",H,D,R);for(var te,he=H,Le=D,Fe=R;!te&&he>0;)he--,Le=Math.floor(Le/2),Fe=Math.floor(Fe/2),te=this.tiles[Wt(he,Le,Fe)];return te&&te.source?(Y>1&&console.log("found parent tile z%d-%d-%d",he,Le,Fe),Y>1&&console.time("drilling down"),this.splitTile(te.source,he,Le,Fe,H,D,R),Y>1&&console.timeEnd("drilling down"),this.tiles[se]?Qe(this.tiles[se],K):null):null};class Nt extends ae{constructor(D,R,U,K){super(D,R,U),this._dataUpdateable=new Map,this.loadGeoJSON=(Y,pe)=>{const{promoteId:se}=Y;if(Y.request)return s.f(Y.request,(te,he,Le,Fe)=>{this._dataUpdateable=Br(he,se)?On(he,se):void 0,pe(te,he,Le,Fe)});if(typeof Y.data=="string")try{const te=JSON.parse(Y.data);this._dataUpdateable=Br(te,se)?On(te,se):void 0,pe(null,te)}catch{pe(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}else Y.dataDiff?this._dataUpdateable?(function(te,he,Le){var Fe,Ne,St,zt;if(he.removeAll&&te.clear(),he.remove)for(const pt of he.remove)te.delete(pt);if(he.add)for(const pt of he.add){const It=Bt(pt,Le);It!=null&&te.set(It,pt)}if(he.update)for(const pt of he.update){let It=te.get(pt.id);if(It==null)continue;const Ft=!pt.removeAllProperties&&(((Fe=pt.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0||((Ne=pt.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0);if((pt.newGeometry||pt.removeAllProperties||Ft)&&(It=Object.assign({},It),te.set(pt.id,It),Ft&&(It.properties=Object.assign({},It.properties))),pt.newGeometry&&(It.geometry=pt.newGeometry),pt.removeAllProperties)It.properties={};else if(((St=pt.removeProperties)===null||St===void 0?void 0:St.length)>0)for(const _i of pt.removeProperties)Object.prototype.hasOwnProperty.call(It.properties,_i)&&delete It.properties[_i];if(((zt=pt.addOrUpdateProperties)===null||zt===void 0?void 0:zt.length)>0)for(const{key:_i,value:xi}of pt.addOrUpdateProperties)It.properties[_i]=xi}}(this._dataUpdateable,Y.dataDiff,se),pe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):pe(new Error(`Cannot update existing geojson data in ${Y.source}`)):pe(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,K&&(this.loadGeoJSON=K)}loadGeoJSONTile(D,R){const U=D.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const K=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!K)return R(null,null);const Y=new class{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=se.length,this._features=se}feature(se){return new class{constructor(te){this._feature=te,this.extent=s.N,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const he of this._feature.geometry)te.push([new s.P(he[0],he[1])]);return te}{const te=[];for(const he of this._feature.geometry){const Le=[];for(const Fe of he)Le.push(new s.P(Fe[0],Fe[1]));te.push(Le)}return te}}toGeoJSON(te,he,Le){return W.call(this,te,he,Le)}}(this._features[se])}}(K.features);let pe=kt(Y);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),R(null,{vectorTile:Y,rawData:pe.buffer})}loadData(D,R){var U;(U=this._pendingRequest)===null||U===void 0||U.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(D&&D.request&&D.request.collectResourceTiming)&&new s.bu(D.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(D,(Y,pe)=>{if(delete this._pendingCallback,delete this._pendingRequest,Y||!pe)return R(Y);if(typeof pe!="object")return R(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{Ee(pe,!0);try{if(D.filter){const te=s.bC(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));pe={type:"FeatureCollection",features:pe.features.filter(Le=>te.value.evaluate({zoom:0},Le))}}this._geoJSONIndex=D.cluster?new Ti(function({superclusterOptions:te,clusterProperties:he}){if(!he||!te)return te;const Le={},Fe={},Ne={accumulated:null,zoom:0},St={properties:null},zt=Object.keys(he);for(const pt of zt){const[It,Ft]=he[pt],_i=s.bC(Ft),xi=s.bC(typeof It=="string"?[It,["accumulated"],["get",pt]]:It);Le[pt]=_i.value,Fe[pt]=xi.value}return te.map=pt=>{St.properties=pt;const It={};for(const Ft of zt)It[Ft]=Le[Ft].evaluate(Ne,St);return It},te.reduce=(pt,It)=>{St.properties=It;for(const Ft of zt)Ne.accumulated=pt[Ft],pt[Ft]=Fe[Ft].evaluate(Ne,St)},te}(D)).load(pe.features):function(te,he){return new rt(te,he)}(pe,D.geojsonVtOptions)}catch(te){return R(te)}this.loaded={};const se={};if(K){const te=K.finish();te&&(se.resourceTiming={},se.resourceTiming[D.source]=JSON.parse(JSON.stringify(te)))}R(null,se)}})}reloadTile(D,R){const U=this.loaded;return U&&U[D.uid]?super.reloadTile(D,R):this.loadTile(D,R)}removeSource(D,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(D,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(U){R(U)}}getClusterChildren(D,R){try{R(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(U){R(U)}}getClusterLeaves(D,R){try{R(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(U){R(U)}}}class Yn{constructor(D){this.self=D,this.actor=new s.C(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ae,geojson:Nt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,U)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=U},this.self.registerRTLTextPlugin=R=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=R.applyArabicShaping,s.bD.processBidirectionalText=R.processBidirectionalText,s.bD.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(D,R){this.referrer=R}setImages(D,R,U){this.availableImages[D]=R;for(const K in this.workerSources[D]){const Y=this.workerSources[D][K];for(const pe in Y)Y[pe].availableImages=R}U()}setLayers(D,R,U){this.getLayerIndex(D).replace(R),U()}updateLayers(D,R,U){this.getLayerIndex(D).update(R.layers,R.removedIds),U()}loadTile(D,R,U){this.getWorkerSource(D,R.type,R.source).loadTile(R,U)}loadDEMTile(D,R,U){this.getDEMWorkerSource(D,R.source).loadTile(R,U)}reloadTile(D,R,U){this.getWorkerSource(D,R.type,R.source).reloadTile(R,U)}abortTile(D,R,U){this.getWorkerSource(D,R.type,R.source).abortTile(R,U)}removeTile(D,R,U){this.getWorkerSource(D,R.type,R.source).removeTile(R,U)}removeDEMTile(D,R){this.getDEMWorkerSource(D,R.source).removeTile(R)}removeSource(D,R,U){if(!this.workerSources[D]||!this.workerSources[D][R.type]||!this.workerSources[D][R.type][R.source])return;const K=this.workerSources[D][R.type][R.source];delete this.workerSources[D][R.type][R.source],K.removeSource!==void 0?K.removeSource(R,U):U()}loadWorkerSource(D,R,U){try{this.self.importScripts(R.url),U()}catch(K){U(K.toString())}}syncRTLPluginState(D,R,U){try{s.bD.setState(R);const K=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&K!=null){this.self.importScripts(K);const Y=s.bD.isParsed();U(Y?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),Y)}}catch(K){U(K.toString())}}getAvailableImages(D){let R=this.availableImages[D];return R||(R=[]),R}getLayerIndex(D){let R=this.layerIndexes[D];return R||(R=this.layerIndexes[D]=new I),R}getWorkerSource(D,R,U){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][R]||(this.workerSources[D][R]={}),this.workerSources[D][R][U]||(this.workerSources[D][R][U]=new this.workerSourceTypes[R]({send:(K,Y,pe)=>{this.actor.send(K,Y,pe,D)}},this.getLayerIndex(D),this.getAvailableImages(D))),this.workerSources[D][R][U]}getDEMWorkerSource(D,R){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][R]||(this.demWorkerSources[D][R]=new ce),this.demWorkerSources[D][R]}}return s.i()&&(self.worker=new Yn(self)),Yn}),v(["./shared"],function(s){var I="3.6.2";class M{static testProp(t){if(!M.docStyle)return t[0];for(let o=0;o<t.length;o++)if(t[o]in M.docStyle)return t[o];return t[0]}static create(t,o,h){const f=window.document.createElement(t);return o!==void 0&&(f.className=o),h&&h.appendChild(f),f}static createNS(t,o){return window.document.createElementNS(t,o)}static disableDrag(){M.docStyle&&M.selectProp&&(M.userSelect=M.docStyle[M.selectProp],M.docStyle[M.selectProp]="none")}static enableDrag(){M.docStyle&&M.selectProp&&(M.docStyle[M.selectProp]=M.userSelect)}static setTransform(t,o){t.style[M.transformProp]=o}static addEventListener(t,o,h,f={}){t.addEventListener(o,h,"passive"in f?f:f.capture)}static removeEventListener(t,o,h,f={}){t.removeEventListener(o,h,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",M.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",M.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",M.suppressClickInternal,!0)},0)}static mousePos(t,o){const h=t.getBoundingClientRect();return new s.P(o.clientX-h.left-t.clientLeft,o.clientY-h.top-t.clientTop)}static touchPos(t,o){const h=t.getBoundingClientRect(),f=[];for(let g=0;g<o.length;g++)f.push(new s.P(o[g].clientX-h.left-t.clientLeft,o[g].clientY-h.top-t.clientTop));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}M.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,M.selectProp=M.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),M.transformProp=M.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(m){!ae&&ie&&(ce?ge(m):j=m)}};let j,ie,ae=!1,ce=!1;function ge(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,ie),m.isContextLost())return;B.supported=!0}catch{}m.deleteTexture(t),ae=!0}var ve,Ee;typeof document<"u"&&(ie=document.createElement("img"),ie.onload=function(){j&&ge(j),j=null,ce=!0},ie.onerror=function(){ae=!0,j=null},ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let t,o,h,f;m.resetRequestQueue=()=>{t=[],o=0,h=0,f={}},m.addThrottleControl=A=>{const P=h++;return f[P]=A,P},m.removeThrottleControl=A=>{delete f[A],w()},m.getImage=(A,P,z=!0)=>{B.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const O={requestParameters:A,supportImageRefresh:z,callback:P,cancelled:!1,completed:!1,cancel:()=>{O.completed||O.cancelled||(O.cancelled=!0,O.innerRequest&&(O.innerRequest.cancel(),o--),w())}};return t.push(O),w(),O};const g=A=>{const{requestParameters:P,supportImageRefresh:z,callback:O}=A;return s.e(P,{type:"image"}),(z!==!1||s.i()||s.g(P.url)||P.headers&&!Object.keys(P.headers).reduce((X,G)=>X&&G==="accept",!0)?s.m:k)(P,(X,G,$,q)=>{x(A,O,X,G,$,q)})},x=(A,P,z,O,X,G)=>{z?P(z):O instanceof HTMLImageElement||s.a(O)?P(null,O):O&&(($,q)=>{typeof createImageBitmap=="function"?s.b($,q):s.d($,q)})(O,($,q)=>{$!=null?P($):q!=null&&P(null,q,{cacheControl:X,expires:G})}),A.cancelled||(A.completed=!0,o--,w())},w=()=>{const A=(()=>{const P=Object.keys(f);let z=!1;if(P.length>0){for(const O of P)if(z=f[O](),z)break}return z})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=o;P<A&&t.length>0;P++){const z=t.shift();if(z.cancelled){P--;continue}const O=g(z);o++,z.innerRequest=O}},k=(A,P)=>{const z=new Image,O=A.url;let X=!1;const G=A.credentials;return G&&G==="include"?z.crossOrigin="use-credentials":(G&&G==="same-origin"||!s.s(O))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{P(null,z),z.onerror=z.onload=null},z.onerror=()=>{X||P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=O,{cancel:()=>{X=!0,z.src=""}}}}(ve||(ve={})),ve.resetRequestQueue(),function(m){m.Glyphs="Glyphs",m.Image="Image",m.Source="Source",m.SpriteImage="SpriteImage",m.SpriteJSON="SpriteJSON",m.Style="Style",m.Tile="Tile",m.Unknown="Unknown"}(Ee||(Ee={}));class W{constructor(t){this._transformRequestFn=t}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeSpriteURL(t,o,h){const f=function(g){const x=g.match(ne);if(!x)throw new Error(`Unable to parse URL "${g}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return f.path+=`${o}${h}`,function(g){const x=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${x}`}(f)}setTransformRequest(t){this._transformRequestFn=t}}const ne=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function re(m){var t=new s.A(3);return t[0]=m[0],t[1]=m[1],t[2]=m[2],t}var _e,ze=function(m,t,o){return m[0]=t[0]-o[0],m[1]=t[1]-o[1],m[2]=t[2]-o[2],m};_e=new s.A(3),s.A!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0);var Ce=function(m){var t=m[0],o=m[1];return t*t+o*o};function Ae(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const o=[];for(const{id:h,url:f}of m){const g=`${h}${f}`;o.indexOf(g)===-1&&(o.push(g),t.push({id:h,url:f}))}}return t}function Ue(m,t,o,h,f){if(h)return void m(h);if(f!==Object.values(t).length||f!==Object.values(o).length)return;const g={};for(const x in t){g[x]={};const w=s.h.getImageCanvasContext(o[x]),k=t[x];for(const A in k){const{width:P,height:z,x:O,y:X,sdf:G,pixelRatio:$,stretchX:q,stretchY:le,content:xe}=k[A];g[x][A]={data:null,pixelRatio:$,sdf:G,stretchX:q,stretchY:le,content:xe,spriteData:{width:P,height:z,x:O,y:X,context:w}}}}m(null,g)}(function(){var m=new s.A(2);s.A!=Float32Array&&(m[0]=0,m[1]=0)})();class je{constructor(t,o,h,f){this.context=t,this.format=h,this.texture=t.gl.createTexture(),this.update(o,f)}update(t,o,h){const{width:f,height:g}=t,x=!(this.size&&this.size[0]===f&&this.size[1]===g||h),{context:w}=this,{gl:k}=w;if(this.useMipmap=!!(o&&o.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[f,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,t):k.texImage2D(k.TEXTURE_2D,0,this.format,f,g,0,this.format,k.UNSIGNED_BYTE,t.data);else{const{x:A,y:P}=h||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?k.texSubImage2D(k.TEXTURE_2D,0,A,P,k.RGBA,k.UNSIGNED_BYTE,t):k.texSubImage2D(k.TEXTURE_2D,0,A,P,f,g,k.RGBA,k.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(t,o,h){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),h!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,h||t),this.filter=t),o!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function we(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Te extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,callback:h}of this.requestors)this._notify(o,h);this.requestors=[]}}getImage(t){const o=this.images[t];if(o&&!o.data&&o.spriteData){const h=o.spriteData;o.data=new s.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(t,o){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let h=!0;const f=o.data||o.spriteData;return this._validateStretch(o.stretchX,f&&f.width)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,f&&f.height)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,o){if(!t)return!0;let h=0;for(const f of t){if(f[0]<h||f[1]<f[0]||o<f[1])return!1;h=f[1]}return!0}_validateContent(t,o){if(!t)return!0;if(t.length!==4)return!1;const h=o.spriteData,f=h&&h.width||o.data.width,g=h&&h.height||o.data.height;return!(t[0]<0||f<t[0]||t[1]<0||g<t[1]||t[2]<0||f<t[2]||t[3]<0||g<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,o,h=!0){const f=this.getImage(t);if(h&&(f.data.width!==o.data.width||f.data.height!==o.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=f.version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,o){let h=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(h=!1);this.isLoaded()||h?this._notify(t,o):this.requestors.push({ids:t,callback:o})}_notify(t,o){const h={};for(const f of t){let g=this.getImage(f);g||(this.fire(new s.k("styleimagemissing",{id:f})),g=this.getImage(f)),g?h[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:s.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,h)}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],h=this.getImage(t);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const f={w:h.data.width+2,h:h.data.height+2,x:0,y:0},g=new s.I(f,h);this.patterns[t]={bin:f,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new je(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:o,h}=s.p(t),f=this.atlasImage;f.resize({width:o||1,height:h||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],w=x.x+1,k=x.y+1,A=this.getImage(g).data,P=A.width,z=A.height;s.R.copy(A,f,{x:0,y:0},{x:w,y:k},{width:P,height:z}),s.R.copy(A,f,{x:0,y:z-1},{x:w,y:k-1},{width:P,height:1}),s.R.copy(A,f,{x:0,y:0},{x:w,y:k+z},{width:P,height:1}),s.R.copy(A,f,{x:P-1,y:0},{x:w-1,y:k},{width:1,height:z}),s.R.copy(A,f,{x:0,y:0},{x:w+P,y:k},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.getImage(o);h||s.w(`Image with ID: "${o}" was not found`),we(h)&&this.updateImage(o,h)}}}const xt=1e20;function bt(m,t,o,h,f,g,x,w,k){for(let A=t;A<t+h;A++)it(m,o*g+A,g,f,x,w,k);for(let A=o;A<o+f;A++)it(m,A*g+t,1,h,x,w,k)}function it(m,t,o,h,f,g,x){g[0]=0,x[0]=-xt,x[1]=xt,f[0]=m[t];for(let w=1,k=0,A=0;w<h;w++){f[w]=m[t+w*o];const P=w*w;do{const z=g[k];A=(f[w]-f[z]+P-z*z)/(w-z)/2}while(A<=x[k]&&--k>-1);k++,g[k]=w,x[k]=A,x[k+1]=xt}for(let w=0,k=0;w<h;w++){for(;x[k+1]<w;)k++;const A=g[k],P=w-A;m[t+w*o]=f[A]+P*P}}class dt{constructor(t,o){this.requestManager=t,this.localIdeographFontFamily=o,this.entries={}}setURL(t){this.url=t}getGlyphs(t,o){const h=[];for(const f in t)for(const g of t[f])h.push({stack:f,id:g});s.o(h,({stack:f,id:g},x)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{}});let k=w.glyphs[g];if(k!==void 0)return void x(null,{stack:f,id:g,glyph:k});if(k=this._tinySDF(w,f,g),k)return w.glyphs[g]=k,void x(null,{stack:f,id:g,glyph:k});const A=Math.floor(g/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void x(null,{stack:f,id:g,glyph:k});if(!this.url)return void x(new Error("glyphsUrl is not set"));let P=w.requests[A];P||(P=w.requests[A]=[],dt.loadGlyphRange(f,A,this.url,this.requestManager,(z,O)=>{if(O){for(const X in O)this._doesCharSupportLocalGlyph(+X)||(w.glyphs[+X]=O[+X]);w.ranges[A]=!0}for(const X of P)X(z,O);delete w.requests[A]})),P.push((z,O)=>{z?x(z):O&&x(null,{stack:f,id:g,glyph:O[g]||null})})},(f,g)=>{if(f)o(f);else if(g){const x={};for(const{stack:w,id:k,glyph:A}of g)(x[w]||(x[w]={}))[k]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};o(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](t)||s.u["Hangul Syllables"](t)||s.u.Hiragana(t)||s.u.Katakana(t))}_tinySDF(t,o,h){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let g=t.tinySDF;if(!g){let w="400";/bold/i.test(o)?w="900":/medium/i.test(o)?w="500":/light/i.test(o)&&(w="200"),g=t.tinySDF=new dt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:w})}const x=g.draw(String.fromCharCode(h));return{id:h,bitmap:new s.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}dt.loadGlyphRange=function(m,t,o,h,f){const g=256*t,x=g+255,w=h.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${g}-${x}`),Ee.Glyphs);s.l(w,(k,A)=>{if(k)f(k);else if(A){const P={};for(const z of s.n(A))P[z.id]=z;f(null,P)}})},dt.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:o=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=h,this.radius=o;const w=this.size=m+4*t,k=this._createCanvas(w),A=this.ctx=k.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${g} ${m}px ${f}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(m),x=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),k=Math.min(this.size-this.buffer,x+Math.ceil(h)),A=w+2*this.buffer,P=k+2*this.buffer,z=Math.max(A*P,0),O=new Uint8ClampedArray(z),X={data:O,width:A,height:P,glyphWidth:w,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(w===0||k===0)return X;const{ctx:G,buffer:$,gridInner:q,gridOuter:le}=this;G.clearRect($,$,w,k),G.fillText(m,$,$+x);const xe=G.getImageData($,$,w,k);le.fill(xt,0,z),q.fill(0,0,z);for(let Q=0;Q<k;Q++)for(let ue=0;ue<w;ue++){const ke=xe.data[4*(Q*w+ue)+3]/255;if(ke===0)continue;const Me=(Q+$)*A+ue+$;if(ke===1)le[Me]=0,q[Me]=xt;else{const Re=.5-ke;le[Me]=Re>0?Re*Re:0,q[Me]=Re<0?Re*Re:0}}bt(le,0,0,A,P,A,this.f,this.v,this.z),bt(q,$,$,w,k,A,this.f,this.v,this.z);for(let Q=0;Q<z;Q++){const ue=Math.sqrt(le[Q])-Math.sqrt(q[Q]);O[Q]=Math.round(255-255*(ue/this.radius+this.cutoff))}return X}};class Pt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(t,o){return s.z(t.expression.evaluate(o))}interpolate(t,o,h){return{x:s.B.number(t.x,o.x,h),y:s.B.number(t.y,o.y,h),z:s.B.number(t.z,o.z,h)}}}let ut;class kt extends s.E{constructor(t){super(),ut=ut||new s.r({anchor:new s.D(s.v.light.anchor),position:new Pt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(ut),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(s.t,t,o))for(const h in t){const f=t[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),f):this._transitionable.setValue(h,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,h){return(!h||h.validate!==!1)&&s.x(this,t.call(s.y,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class yi{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,o){const h=t.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(t,o)),this.dashEntry[h]}getDashRanges(t,o,h){const f=[];let g=t.length%2==1?-t[t.length-1]*h:0,x=t[0]*h,w=!0;f.push({left:g,right:x,isDash:w,zeroLength:t[0]===0});let k=t[0];for(let A=1;A<t.length;A++){w=!w;const P=t[A];g=k*h,k+=P,x=k*h,f.push({left:g,right:x,isDash:w,zeroLength:P===0})}return f}addRoundDash(t,o,h){const f=o/2;for(let g=-h;g<=h;g++){const x=this.width*(this.nextRow+h+g);let w=0,k=t[w];for(let A=0;A<this.width;A++){A/k.right>1&&(k=t[++w]);const P=Math.abs(A-k.left),z=Math.abs(A-k.right),O=Math.min(P,z);let X;const G=g/h*(f+1);if(k.isDash){const $=f-Math.abs(G);X=Math.sqrt(O*O+$*$)}else X=f-Math.sqrt(O*O+G*G);this.data[x+A]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const k=t[w],A=t[w+1];k.zeroLength?t.splice(w,1):A&&A.isDash===k.isDash&&(A.left=k.left,t.splice(w,1))}const o=t[0],h=t[t.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const f=this.width*this.nextRow;let g=0,x=t[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++g]);const k=Math.abs(w-x.left),A=Math.abs(w-x.right),P=Math.min(k,A);this.data[f+w]=Math.max(0,Math.min(255,(x.isDash?P:-P)+128))}}addDash(t,o){const h=o?7:0,f=2*h+1;if(this.nextRow+f>this.height)return s.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<t.length;w++)g+=t[w];if(g!==0){const w=this.width/g,k=this.getDashRanges(t,this.width,w);o?this.addRoundDash(k,w,h):this.addRegularDash(k)}const x={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:g};return this.nextRow+=f,this.dirty=!0,x}bind(t){const o=t.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}class $t{constructor(t,o,h){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=h;const f=this.workerPool.acquire(h);for(let g=0;g<f.length;g++){const x=new s.C(f[g],o,h);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,o,h){s.o(this.actors,(f,g)=>{f.send(t,o,g)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Vt(m,t,o){const h=function(f,g){if(f)return o(f);if(g){const x=s.F(s.e(g,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),o(null,x)}};return m.url?s.f(t.transformRequest(m.url,Ee.Source),h):s.h.frame(()=>h(null,m))}class Xt{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}extend(t){const o=this._sw,h=this._ne;let f,g;if(t instanceof s.L)f=t,g=t;else{if(!(t instanceof Xt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Xt.convert(t)):this.extend(s.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.L.convert(t)):this;if(f=t._sw,g=t._ne,!f||!g)return this}return o||h?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),h.lng=Math.max(g.lng,h.lng),h.lat=Math.max(g.lat,h.lat)):(this._sw=new s.L(f.lng,f.lat),this._ne=new s.L(g.lng,g.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:h}=s.L.convert(t);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(t){return t instanceof Xt?t:t&&new Xt(t)}static fromLngLat(t,o=0){const h=360*o/40075017,f=h/Math.cos(Math.PI/180*t.lat);return new Xt(new s.L(t.lng-f,t.lat-h),new s.L(t.lng+f,t.lat+h))}}class hi{constructor(t,o,h){this.bounds=Xt.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),h=Math.floor(s.G(this.bounds.getWest())*o),f=Math.floor(s.H(this.bounds.getNorth())*o),g=Math.ceil(s.G(this.bounds.getEast())*o),x=Math.ceil(s.H(this.bounds.getSouth())*o);return t.x>=h&&t.x<g&&t.y>=f&&t.y<x}}class ar extends s.E{constructor(t,o,h,f){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Vt(this._options,this.map._requestManager,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new s.j(g)):x&&(s.e(this,x),x.bounds&&(this.tileBounds=new hi(x.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(o,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,o){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(h,Ee.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(x,w){return delete t.request,t.aborted?o(null):x&&x.status!==404?o(x):(w&&w.resourceTiming&&(t.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&t.setExpiryData(w),t.loadVectorData(w,this.map.painter),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",f,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",f,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ti extends s.E{constructor(t,o,h,f){super(),this.id=t,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},o),s.e(this,s.F(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Vt(this._options,this.map._requestManager,(t,o)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.j(t)):o&&(s.e(this,o),o.bounds&&(this.tileBounds=new hi(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=ve.getImage(this.map._requestManager.transformRequest(h,Ee.Tile),(f,g,x)=>{if(delete t.request,t.aborted)t.state="unloaded",o(null);else if(f)t.state="errored",o(f);else if(g){this.map._refreshExpiredTiles&&x&&t.setExpiryData(x);const w=this.map.painter.context,k=w.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new je(w,g,k.RGBA,{useMipmap:!0}),t.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),t.state="loaded",o(null)}},this.map._refreshExpiredTiles)}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o()}unloadTile(t,o){t.texture&&this.map.painter.saveTileTexture(t.texture),o()}hasTransition(){return!1}}class Je extends Ti{constructor(t,o,h,f){super(t,o,h,f),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(t,o){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(h,Ee.Tile);function g(x,w){x&&(t.state="errored",o(x)),w&&(t.dem=w,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",o(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=ve.getImage(f,(x,w,k)=>s._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",o(null);else if(x)t.state="errored",o(x);else if(w){this.map._refreshExpiredTiles&&t.setExpiryData(k);const A=s.a(w)&&s.J()?w:yield function(z){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const O=z.width+2,X=z.height+2;try{return new s.R({width:O,height:X},yield s.M(z,-1,-1,O,X))}catch{}}return s.h.getImageData(z,1)})}(w),P={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",P,g))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const o=t.canonical,h=Math.pow(2,o.z),f=(o.x-1+h)%h,g=o.x===0?t.wrap-1:t.wrap,x=(o.x+1+h)%h,w=o.x+1===h?t.wrap+1:t.wrap,k={};return k[new s.O(t.overscaledZ,g,o.z,f,o.y).key]={backfilled:!1},k[new s.O(t.overscaledZ,w,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(k[new s.O(t.overscaledZ,g,o.z,f,o.y-1).key]={backfilled:!1},k[new s.O(t.overscaledZ,t.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new s.O(t.overscaledZ,w,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<h&&(k[new s.O(t.overscaledZ,g,o.z,f,o.y+1).key]={backfilled:!1},k[new s.O(t.overscaledZ,t.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new s.O(t.overscaledZ,w,o.z,x,o.y+1).key]={backfilled:!1}),k}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class qe extends s.E{constructor(t,o,h,f){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(f),this._data=o.data,this._options=s.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const g=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*g,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*g,extent:s.N,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.N,radius:(o.clusterRadius||50)*g,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},o),this}getClusterChildren(t,o){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},o),this}getClusterLeaves(t,o,h,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:o,offset:h},f),this}_updateWorkerData(t){const o=s.e({},this.workerOptions);t?o.dataDiff=t:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),Ee.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,o,(h,f)=>{if(this._pendingLoads--,this._removed||f&&f.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let g=null;if(f&&f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0)),h)return void this.fire(new s.j(h));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&s.e(x,{resourceTiming:g}),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,o){const h=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(h,f,(g,x)=>(delete t.request,t.unloadVectorData(),t.aborted?o(null):g?o(g):(t.loadVectorData(x,this.map.painter,h==="reloadTile"),o(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ut=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jt extends s.E{constructor(t,o,h,f){super(),this.load=(g,x)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ve.getImage(this.map._requestManager.transformRequest(this.url,Ee.Image),(w,k)=>{this._request=null,this._loaded=!0,w?this.fire(new s.j(w)):k&&(this.image=k,g&&(this.coordinates=g),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,x=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Ut.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new je(g,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const k in this.tiles){const A=this.tiles[k];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=o}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const o=t.map(s.U.fromLngLat);this.tileID=function(f){let g=1/0,x=1/0,w=-1/0,k=-1/0;for(const O of f)g=Math.min(g,O.x),x=Math.min(x,O.y),w=Math.max(w,O.x),k=Math.max(k,O.y);const A=Math.max(w-g,k-x),P=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,P);return new s.W(P,Math.floor((g+w)/2*z),Math.floor((x+k)/2*z))}(o),this.minzoom=this.maxzoom=this.tileID.z;const h=o.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,s.N,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,s.N),this._boundsArray.emplaceBack(h[2].x,h[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}hasTransition(){return!1}}class ki extends jt{constructor(t,o,h,f){super(t,o,h,f),this.load=()=>{this._loaded=!1;const g=this.options;this.urls=[];for(const x of g.urls)this.urls.push(this.map._requestManager.transformRequest(x,Ee.Source).url);s.X(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new s.j(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,x=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Ut.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new je(g,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const k in this.tiles){const A=this.tiles[k];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=o}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const o=this.video.seekable;t<o.start(0)||t>o.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Hi extends jt{constructor(t,o,h,f){super(t,o,h,f),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,Ut.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new je(x,this.canvas,w.RGBA,{premultiply:!0});let k=!1;for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,k=!0)}k&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Xe={},Ii=m=>{switch(m){case"geojson":return qe;case"image":return jt;case"raster":return Ti;case"raster-dem":return Je;case"vector":return ar;case"video":return ki;case"canvas":return Hi}return Xe[m]};function $i(m,t){const o=s.Z();return s.$(o,o,[1,1,0]),s.a0(o,o,[.5*m.width,.5*m.height,1]),s.a1(o,o,m.calculatePosMatrix(t.toUnwrapped()))}function rn(m,t,o,h,f,g){const x=function(z,O,X){if(z)for(const G of z){const $=O[G];if($&&$.source===X&&$.type==="fill-extrusion")return!0}else for(const G in O){const $=O[G];if($.source===X&&$.type==="fill-extrusion")return!0}return!1}(f&&f.layers,t,m.id),w=g.maxPitchScaleFactor(),k=m.tilesIn(h,w,x);k.sort(Mn);const A=[];for(const z of k)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,o,m._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,f,g,w,$i(m.transform,z.tileID))});const P=function(z){const O={},X={};for(const G of z){const $=G.queryResults,q=G.wrappedTileID,le=X[q]=X[q]||{};for(const xe in $){const Q=$[xe],ue=le[xe]=le[xe]||{},ke=O[xe]=O[xe]||[];for(const Me of Q)ue[Me.featureIndex]||(ue[Me.featureIndex]=!0,ke.push(Me))}}return O}(A);for(const z in P)P[z].forEach(O=>{const X=O.feature,G=m.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=G});return P}function Mn(m,t){const o=m.tileID,h=t.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}class Lr{constructor(t,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=s.a2(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const o=t+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(f,g){const x={};if(!g)return x;for(const w of f){const k=w.layerIds.map(A=>g.getLayer(A)).filter(Boolean);if(k.length!==0){w.layers=k,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>k.filter(P=>P.id===A)[0]));for(const A of k)x[A.id]=w}}return x}(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof s.a4){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof s.a4&&g.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(t)}const o=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new je(t,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new je(t,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,o,h,f,g,x,w,k,A,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:P,transform:k,params:w,queryPadding:this.queryPadding*A},t,o,h):{}}querySourceFeatures(t,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),g=o&&o.sourceLayer?o.sourceLayer:"",x=f._geojsonTileLayer||f[g];if(!x)return;const w=s.a6(o&&o.filter),{z:k,x:A,y:P}=this.tileID.canonical,z={z:k,x:A,y:P};for(let O=0;O<x.length;O++){const X=x.feature(O);if(w.needGeometry){const q=s.a7(X,!0);if(!w.filter(new s.a8(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!w.filter(new s.a8(this.tileID.overscaledZ),X))continue;const G=h.getId(X,g),$=new s.a9(X,k,A,P,G);$.tile=z,t.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const h=s.aa(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{const g=this.expirationTime-o;g?this.expirationTime=h+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!o.style.hasLayer(f))continue;const g=this.buckets[f],x=g.layers[0].sourceLayer||"_geojsonTileLayer",w=h[x],k=t[x];if(!w||!k||Object.keys(k).length===0)continue;g.update(k,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=o&&o.style&&o.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.h.now()+t}setDependencies(t,o){const h={};for(const f of o)h[f]=!0;this.dependencies[t]=h}hasDependency(t,o){for(const h of t){const f=this.dependencies[h];if(f){for(const g of o)if(f[g])return!0}}return!1}}class _r{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,h){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const g={value:o,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},h)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const h=t.wrapped().key,f=o===void 0?0:this.data[h].indexOf(o),g=this.data[h][f];return this.data[h].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const h in this.data)for(const f of this.data[h])t(f.value)||o.push(f);for(const h of o)this.remove(h.value.tileID,h)}}class Pe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,h){const f=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},s.e(this.stateChanges[t][f],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==f&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const g in this.state[t][f])h[g]||(this.deletedStates[t][f][g]=null)}else for(const g in h)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][g]===null&&delete this.deletedStates[t][f][g]}removeFeatureState(t,o,h){if(this.deletedStates[t]===null)return;const f=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&o!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][h]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(h in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][h]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,o){const h=String(o),f=s.e({},(this.state[t]||{})[h],(this.stateChanges[t]||{})[h]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][o];if(g===null)return{};for(const x in g)delete f[x]}return f}initializeTileState(t,o){t.setFeatureState(this.state,o)}coalesceChanges(t,o){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),s.e(this.state[f][x],this.stateChanges[f][x]),g[x]=this.state[f][x];h[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const x in this.state[f])g[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else for(const w of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][w];g[x]=this.state[f][x]}h[f]=h[f]||{},s.e(h[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const f in t)t[f].setFeatureState(h,o)}}class br extends s.E{constructor(t,o,h){super(),this.id=t,this.dispatcher=h,this.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,g,x,w)=>{const k=new(Ii(g.type))(f,g,x,w);if(k.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${k.id}`);return k})(t,o,h,this),this._tiles={},this._cache=new _r(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Pe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,o){return this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new s.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(t),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Dr).map(t=>t.key)}getRenderableIds(t){const o=[];for(const h in this._tiles)this._isIdRenderable(h,t)&&o.push(this._tiles[h]);return t?o.sort((h,f)=>{const g=h.tileID,x=f.tileID,w=new s.P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),k=new s.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||k.y-w.y||k.x-w.x}).map(h=>h.tileID.key):o.map(h=>h.tileID).sort(Dr).map(h=>h.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,o){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=o),this._loadTile(h,this._tileLoaded.bind(this,h,t,o)))}_tileLoaded(t,o,h,f){if(f)return t.state="errored",void(f.status!==404?this._source.fire(new s.j(f,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=s.h.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const o=this.getRenderableIds();for(let f=0;f<o.length;f++){const g=o[f];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);h(t,x),h(x,t)}}function h(f,g){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-f.tileID.canonical.x;const w=g.tileID.canonical.y-f.tileID.canonical.y,k=Math.pow(2,f.tileID.canonical.z),A=g.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+k)===1?x+=k:Math.abs(x-k)===1&&(x-=k)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,x,w),f.neighboringTiles&&f.neighboringTiles[A]&&(f.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,h,f){for(const g in this._tiles){let x=this._tiles[g];if(f[g]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>h)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(w=A)}let k=w;for(;k.overscaledZ>o;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]){f[w.key]=w;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=t.overscaledZ-1;h>=o;h--){const f=t.scaledTo(h),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const o=Math.ceil(t.width/this._source.tileSize)+1,h=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const h={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+o),h[g.tileID.key]=g}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(t,o){if(this.transform=t,this.terrain=o,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new s.O(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(h=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(h=h.filter(P=>this._source.hasTile(P)))):h=[];const f=t.coveringZoomLevel(this._source),g=Math.max(f-br.maxOverzooming,this._source.minzoom),x=Math.max(f+br.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const z of h)if(z.canonical.z>this._source.minzoom){const O=z.scaledTo(z.canonical.z-1);P[O.key]=O;const X=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));P[X.key]=X}h=h.concat(Object.values(P))}const w=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(h,f);if(di(this._source.type)){const P={},z={},O=Object.keys(k),X=s.h.now();for(const G of O){const $=k[G],q=this._tiles[G];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=X)continue;const le=this.findLoadedParent($,g);le&&(this._addTile(le.tileID),P[le.tileID.key]=le.tileID),z[G]=$}this._retainLoadedChildren(z,f,x,k);for(const G in P)k[G]||(this._coveredTiles[G]=!0,k[G]=P[G]);if(o){const G={},$={};for(const q of h)this._tiles[q.key].hasData()?G[q.key]=q:$[q.key]=q;for(const q in $){const le=$[q].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&(G[le[0].key]=k[le[0].key]=le[0],G[le[1].key]=k[le[1].key]=le[1],G[le[2].key]=k[le[2].key]=le[2],G[le[3].key]=k[le[3].key]=le[3],delete $[q])}for(const q in $){const le=this.findLoadedParent($[q],this._source.minzoom);if(le){G[le.tileID.key]=k[le.tileID.key]=le.tileID;for(const xe in G)G[xe].isChildOf(le.tileID)&&delete G[xe]}}for(const q in this._tiles)G[q]||(this._coveredTiles[q]=!0)}}for(const P in k)this._tiles[P].clearFadeHold();const A=s.ab(this._tiles,k);for(const P of A){const z=this._tiles[P];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,o){const h={},f={},g=Math.max(o-br.maxOverzooming,this._source.minzoom),x=Math.max(o+br.maxUnderzooming,this._source.minzoom),w={};for(const k of t){const A=this._addTile(k);h[k.key]=k,A.hasData()||o<this._source.maxzoom&&(w[k.key]=k)}this._retainLoadedChildren(w,o,x,h);for(const k of t){let A=this._tiles[k.key];if(A.hasData())continue;if(o+1>this._source.maxzoom){const z=k.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){h[z.key]=z;continue}}else{const z=k.children(this._source.maxzoom);if(h[z[0].key]&&h[z[1].key]&&h[z[2].key]&&h[z[3].key])continue}let P=A.wasRequested();for(let z=k.overscaledZ-1;z>=g;--z){const O=k.scaledTo(z);if(f[O.key])break;if(f[O.key]=!0,A=this.getTile(O),!A&&P&&(A=this._addTile(O)),A){const X=A.hasData();if((P||X)&&(h[O.key]=O),P=A.wasRequested(),X)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let h,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}o.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;f=g}for(const g of o)this._loadedParentTiles[g]=h}}_addTile(t){let o=this._tiles[t.key];if(o)return o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const h=o;return o||(o=new Lr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))),o.uses++,this._tiles[t.key]=o,h||this._source.fire(new s.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=o.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,o,h){const f=[],g=this.transform;if(!g)return f;const x=h?g.getCameraQueryGeometry(t):t,w=t.map(G=>g.pointCoordinate(G,this.terrain)),k=x.map(G=>g.pointCoordinate(G,this.terrain)),A=this.getIds();let P=1/0,z=1/0,O=-1/0,X=-1/0;for(const G of k)P=Math.min(P,G.x),z=Math.min(z,G.y),O=Math.max(O,G.x),X=Math.max(X,G.y);for(let G=0;G<A.length;G++){const $=this._tiles[A[G]];if($.holdingForFade())continue;const q=$.tileID,le=Math.pow(2,g.zoom-$.tileID.overscaledZ),xe=o*$.queryPadding*s.N/$.tileSize/le,Q=[q.getTilePoint(new s.U(P,z)),q.getTilePoint(new s.U(O,X))];if(Q[0].x-xe<s.N&&Q[0].y-xe<s.N&&Q[1].x+xe>=0&&Q[1].y+xe>=0){const ue=w.map(Me=>q.getTilePoint(Me)),ke=k.map(Me=>q.getTilePoint(Me));f.push({tile:$,tileID:q,queryGeometry:ue,cameraQueryGeometry:ke,scale:le})}}return f}getVisibleCoordinates(t){const o=this.getRenderableIds(t).map(h=>this._tiles[h].tileID);for(const h of o)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(di(this._source.type)){const t=s.h.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=t)return!0}return!1}setFeatureState(t,o,h){this._state.updateState(t=t||"_geojsonTileLayer",o,h)}removeFeatureState(t,o,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,h)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,h){const f=this._tiles[t];f&&f.setDependencies(o,h)}reloadTilesForDependencies(t,o){for(const h in this._tiles)this._tiles[h].hasDependency(t,o)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(t,o))}}function Dr(m,t){const o=Math.abs(2*m.wrap)-+(m.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return m.overscaledZ-t.overscaledZ||h-o||t.canonical.y-m.canonical.y||t.canonical.x-m.canonical.x}function di(m){return m==="raster"||m==="image"||m==="video"}br.maxOverzooming=10,br.maxUnderzooming=3;const qt="mapboxgl_preloaded_worker_pool";class nn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<nn.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qt]}numActive(){return Object.keys(this.active).length}}const Cn=Math.floor(s.h.hardwareConcurrency/2);let rr;function Ui(){return rr||(rr=new nn),rr}nn.workerCount=s.ac(globalThis)?Math.max(Math.min(Cn,3),1):1;class si{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ad(t,0,1);let o=1,h=this._distances[o];const f=t*this.paddedLength+this.padding;for(;h<f&&o<this._distances.length;)h=this._distances[++o];const g=o-1,x=this._distances[g],w=h-x,k=w>0?(f-x)/w:0;return this.points[g].mult(1-k).add(this.points[o].mult(k))}}function ji(m,t){let o=!0;return m==="always"||m!=="never"&&t!=="never"||(o=!1),o}class So{constructor(t,o,h){const f=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(o/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)f.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,h,f,g){this._forEachCell(o,h,f,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(g)}insertCircle(t,o,h,f){this._forEachCell(o-f,h-f,o+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(h),this.circles.push(f)}_insertBoxCell(t,o,h,f,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,o,h,f,g,x){this.circleCells[g].push(x)}_query(t,o,h,f,g,x,w){if(h<0||t>this.width||f<0||o>this.height)return[];const k=[];if(t<=0&&o<=0&&this.width<=h&&this.height<=f){if(g)return[{key:null,x1:t,y1:o,x2:h,y2:f}];for(let A=0;A<this.boxKeys.length;A++)k.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],z=this.circles[3*A+1],O=this.circles[3*A+2];k.push({key:this.circleKeys[A],x1:P-O,y1:z-O,x2:P+O,y2:z+O})}}else this._forEachCell(t,o,h,f,this._queryCell,k,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},w);return k}query(t,o,h,f){return this._query(t,o,h,f,!1,null)}hitTest(t,o,h,f,g,x){return this._query(t,o,h,f,!0,g,x).length>0}hitTestCircle(t,o,h,f,g){const x=t-h,w=t+h,k=o-h,A=o+h;if(w<0||x>this.width||A<0||k>this.height)return!1;const P=[];return this._forEachCell(x,k,w,A,this._queryCellCircle,P,{hitTest:!0,overlapMode:f,circle:{x:t,y:o,radius:h},seenUids:{box:{},circle:{}}},g),P.length>0}_queryCell(t,o,h,f,g,x,w,k){const{seenUids:A,hitTest:P,overlapMode:z}=w,O=this.boxCells[g];if(O!==null){const G=this.bboxes;for(const $ of O)if(!A.box[$]){A.box[$]=!0;const q=4*$,le=this.boxKeys[$];if(t<=G[q+2]&&o<=G[q+3]&&h>=G[q+0]&&f>=G[q+1]&&(!k||k(le))&&(!P||!ji(z,le.overlapMode))&&(x.push({key:le,x1:G[q],y1:G[q+1],x2:G[q+2],y2:G[q+3]}),P))return!0}}const X=this.circleCells[g];if(X!==null){const G=this.circles;for(const $ of X)if(!A.circle[$]){A.circle[$]=!0;const q=3*$,le=this.circleKeys[$];if(this._circleAndRectCollide(G[q],G[q+1],G[q+2],t,o,h,f)&&(!k||k(le))&&(!P||!ji(z,le.overlapMode))){const xe=G[q],Q=G[q+1],ue=G[q+2];if(x.push({key:le,x1:xe-ue,y1:Q-ue,x2:xe+ue,y2:Q+ue}),P)return!0}}}return!1}_queryCellCircle(t,o,h,f,g,x,w,k){const{circle:A,seenUids:P,overlapMode:z}=w,O=this.boxCells[g];if(O!==null){const G=this.bboxes;for(const $ of O)if(!P.box[$]){P.box[$]=!0;const q=4*$,le=this.boxKeys[$];if(this._circleAndRectCollide(A.x,A.y,A.radius,G[q+0],G[q+1],G[q+2],G[q+3])&&(!k||k(le))&&!ji(z,le.overlapMode))return x.push(!0),!0}}const X=this.circleCells[g];if(X!==null){const G=this.circles;for(const $ of X)if(!P.circle[$]){P.circle[$]=!0;const q=3*$,le=this.circleKeys[$];if(this._circlesCollide(G[q],G[q+1],G[q+2],A.x,A.y,A.radius)&&(!k||k(le))&&!ji(z,le.overlapMode))return x.push(!0),!0}}}_forEachCell(t,o,h,f,g,x,w,k){const A=this._convertToXCellCoord(t),P=this._convertToYCellCoord(o),z=this._convertToXCellCoord(h),O=this._convertToYCellCoord(f);for(let X=A;X<=z;X++)for(let G=P;G<=O;G++)if(g.call(this,t,o,h,f,this.xCellCount*G+X,x,w,k))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,h,f,g,x){const w=f-t,k=g-o,A=h+x;return A*A>w*w+k*k}_circleAndRectCollide(t,o,h,f,g,x,w){const k=(x-f)/2,A=Math.abs(t-(f+k));if(A>k+h)return!1;const P=(w-g)/2,z=Math.abs(o-(g+P));if(z>P+h)return!1;if(A<=k||z<=P)return!0;const O=A-k,X=z-P;return O*O+X*X<=h*h}}function Qe(m,t,o,h,f){const g=s.Z();return t?(s.a0(g,g,[1/f,1/f,1]),o||s.ae(g,g,h.angle)):s.a1(g,h.labelPlaneMatrix,m),g}function Rn(m,t,o,h,f){if(t){const g=s.af(m);return s.a0(g,g,[f,f,1]),o||s.ae(g,g,-h.angle),g}return h.glCoordMatrix}function qi(m,t,o){let h;o?(h=[m.x,m.y,o(m.x,m.y),1],s.ag(h,h,t)):(h=[m.x,m.y,0,1],K(h,h,t));const f=h[3];return{point:new s.P(h[0]/f,h[1]/f),signedDistanceFromCamera:f}}function To(m,t){return .5+m/t*.5}function Jn(m,t){const o=m[0]/m[3],h=m[1]/m[3];return o>=-t[0]&&o<=t[0]&&h>=-t[1]&&h<=t[1]}function rt(m,t,o,h,f,g,x,w,k,A){const P=h?m.textSizeData:m.iconSizeData,z=s.ah(P,o.transform.zoom),O=[256/o.width*2+1,256/o.height*2+1],X=h?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;X.clear();const G=m.lineVertexArray,$=h?m.text.placedSymbolArray:m.icon.placedSymbolArray,q=o.transform.width/o.transform.height;let le=!1;for(let xe=0;xe<$.length;xe++){const Q=$.get(xe);if(Q.hidden||Q.writingMode===s.ai.vertical&&!le){U(Q.numGlyphs,X);continue}let ue;if(le=!1,A?(ue=[Q.anchorX,Q.anchorY,A(Q.anchorX,Q.anchorY),1],s.ag(ue,ue,t)):(ue=[Q.anchorX,Q.anchorY,0,1],K(ue,ue,t)),!Jn(ue,O)){U(Q.numGlyphs,X);continue}const ke=To(o.transform.cameraToCenterDistance,ue[3]),Me=s.aj(P,z,Q),Re=x?Me/ke:Me*ke,Ze=new s.P(Q.anchorX,Q.anchorY),Ve=qi(Ze,f,A).point,Ke={projections:{},offsets:{}},mt=Br(Q,Re,!1,w,t,f,g,m.glyphOffsetArray,G,X,Ve,Ze,Ke,q,k,A);le=mt.useVertical,(mt.notEnoughRoom||le||mt.needsFlipping&&Br(Q,Re,!0,w,t,f,g,m.glyphOffsetArray,G,X,Ve,Ze,Ke,q,k,A).notEnoughRoom)&&U(Q.numGlyphs,X)}h?m.text.dynamicLayoutVertexBuffer.updateData(X):m.icon.dynamicLayoutVertexBuffer.updateData(X)}function Wt(m,t,o,h,f,g,x,w,k,A,P,z,O){const X=w.glyphStartIndex+w.numGlyphs,G=w.lineStartIndex,$=w.lineStartIndex+w.lineLength,q=t.getoffsetX(w.glyphStartIndex),le=t.getoffsetX(X-1),xe=D(m*q,o,h,f,g,x,w.segment,G,$,k,A,P,z,O);if(!xe)return null;const Q=D(m*le,o,h,f,g,x,w.segment,G,$,k,A,P,z,O);return Q?{first:xe,last:Q}:null}function Bt(m,t,o,h){return m===s.ai.horizontal&&Math.abs(o.y-t.y)>Math.abs(o.x-t.x)*h?{useVertical:!0}:(m===s.ai.vertical?t.y<o.y:t.x>o.x)?{needsFlipping:!0}:null}function Br(m,t,o,h,f,g,x,w,k,A,P,z,O,X,G,$){const q=t/24,le=m.lineOffsetX*q,xe=m.lineOffsetY*q;let Q;if(m.numGlyphs>1){const ue=m.glyphStartIndex+m.numGlyphs,ke=m.lineStartIndex,Me=m.lineStartIndex+m.lineLength,Re=Wt(q,w,le,xe,o,P,z,m,k,g,O,G,$);if(!Re)return{notEnoughRoom:!0};const Ze=qi(Re.first.point,x,$).point,Ve=qi(Re.last.point,x,$).point;if(h&&!o){const Ke=Bt(m.writingMode,Ze,Ve,X);if(Ke)return Ke}Q=[Re.first];for(let Ke=m.glyphStartIndex+1;Ke<ue-1;Ke++)Q.push(D(q*w.getoffsetX(Ke),le,xe,o,P,z,m.segment,ke,Me,k,g,O,G,$));Q.push(Re.last)}else{if(h&&!o){const ke=qi(z,f,$).point,Me=m.lineStartIndex+m.segment+1,Re=new s.P(k.getx(Me),k.gety(Me)),Ze=qi(Re,f,$),Ve=Ze.signedDistanceFromCamera>0?Ze.point:On(z,Re,ke,1,f,$),Ke=Bt(m.writingMode,ke,Ve,X);if(Ke)return Ke}const ue=D(q*w.getoffsetX(m.glyphStartIndex),le,xe,o,P,z,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,k,g,O,G,$);if(!ue)return{notEnoughRoom:!0};Q=[ue]}for(const ue of Q)s.ak(A,ue.point,ue.angle);return{}}function On(m,t,o,h,f,g){const x=qi(m.add(m.sub(t)._unit()),f,g).point,w=o.sub(x);return o.add(w._mult(h/w.mag()))}function Nt(m,t){const{projectionCache:o,lineVertexArray:h,labelPlaneMatrix:f,tileAnchorPoint:g,distanceFromAnchor:x,getElevation:w,previousVertex:k,direction:A,absOffsetX:P}=t;if(o.projections[m])return o.projections[m];const z=new s.P(h.getx(m),h.gety(m)),O=qi(z,f,w);if(O.signedDistanceFromCamera>0)return o.projections[m]=O.point,O.point;const X=m-A;return On(x===0?g:new s.P(h.getx(X),h.gety(X)),z,k,P-x+1,f,w)}function Yn(m,t,o){return m._unit()._perp()._mult(t*o)}function H(m,t,o,h,f,g,x,w){const{projectionCache:k,direction:A}=w;if(k.offsets[m])return k.offsets[m];const P=o.add(t);if(m+A<h||m+A>=f)return k.offsets[m]=P,P;const z=Nt(m+A,w),O=Yn(z.sub(o),x,A),X=o.add(O),G=z.add(O);return k.offsets[m]=s.al(g,P,X,G)||P,k.offsets[m]}function D(m,t,o,h,f,g,x,w,k,A,P,z,O,X){const G=h?m-t:m+t;let $=G>0?1:-1,q=0;h&&($*=-1,q=Math.PI),$<0&&(q+=Math.PI);let le,xe,Q=$>0?w+x:w+x+1,ue=f,ke=f,Me=0,Re=0;const Ze=Math.abs(G),Ve=[];let Ke;for(;Me+Re<=Ze;){if(Q+=$,Q<w||Q>=k)return null;Me+=Re,ke=ue,xe=le;const nt={projectionCache:z,lineVertexArray:A,labelPlaneMatrix:P,tileAnchorPoint:g,distanceFromAnchor:Me,getElevation:X,previousVertex:ke,direction:$,absOffsetX:Ze};if(ue=Nt(Q,nt),o===0)Ve.push(ke),Ke=ue.sub(ke);else{let Ct;const gt=ue.sub(ke);Ct=gt.mag()===0?Yn(Nt(Q+$,nt).sub(ue),o,$):Yn(gt,o,$),xe||(xe=ke.add(Ct)),le=H(Q,Ct,ue,w,k,xe,o,nt),Ve.push(xe),Ke=le.sub(xe)}Re=Ke.mag()}const mt=Ke._mult((Ze-Me)/Re)._add(xe||ke),Yt=q+Math.atan2(ue.y-ke.y,ue.x-ke.x);return Ve.push(mt),{point:mt,angle:O?Yt:0,path:Ve}}const R=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function U(m,t){for(let o=0;o<m;o++){const h=t.length;t.resize(h+4),t.float32.set(R,3*h)}}function K(m,t,o){const h=t[0],f=t[1];return m[0]=o[0]*h+o[4]*f+o[12],m[1]=o[1]*h+o[5]*f+o[13],m[3]=o[3]*h+o[7]*f+o[15],m}const Y=100;class pe{constructor(t,o=new So(t.width+200,t.height+200,25),h=new So(t.width+200,t.height+200,25)){this.transform=t,this.grid=o,this.ignoredGrid=h,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Y,this.screenBottomBoundary=t.height+Y,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,o,h,f,g,x){const w=this.projectAndGetPerspectiveRatio(f,t.anchorPointX,t.anchorPointY,x),k=h*w.perspectiveRatio,A=t.x1*k+w.point.x,P=t.y1*k+w.point.y,z=t.x2*k+w.point.x,O=t.y2*k+w.point.y;return!this.isInsideGrid(A,P,z,O)||o!=="always"&&this.grid.hitTest(A,P,z,O,o,g)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,P,z,O],offscreen:this.isOffscreen(A,P,z,O)}}placeCollisionCircles(t,o,h,f,g,x,w,k,A,P,z,O,X,G){const $=[],q=new s.P(o.anchorX,o.anchorY),le=qi(q,x,G),xe=To(this.transform.cameraToCenterDistance,le.signedDistanceFromCamera),Q=(P?g/xe:g*xe)/s.ap,ue=qi(q,w,G).point,ke=Wt(Q,f,o.lineOffsetX*Q,o.lineOffsetY*Q,!1,ue,q,o,h,w,{projections:{},offsets:{}},!1,G);let Me=!1,Re=!1,Ze=!0;if(ke){const Ve=.5*O*xe+X,Ke=new s.P(-100,-100),mt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Yt=new si,nt=ke.first,Ct=ke.last;let gt=[];for(let Zt=nt.path.length-1;Zt>=1;Zt--)gt.push(nt.path[Zt]);for(let Zt=1;Zt<Ct.path.length;Zt++)gt.push(Ct.path[Zt]);const bi=2.5*Ve;if(k){const Zt=gt.map(Qt=>qi(Qt,k,G));gt=Zt.some(Qt=>Qt.signedDistanceFromCamera<=0)?[]:Zt.map(Qt=>Qt.point)}let Jt=[];if(gt.length>0){const Zt=gt[0].clone(),Qt=gt[0].clone();for(let Ki=1;Ki<gt.length;Ki++)Zt.x=Math.min(Zt.x,gt[Ki].x),Zt.y=Math.min(Zt.y,gt[Ki].y),Qt.x=Math.max(Qt.x,gt[Ki].x),Qt.y=Math.max(Qt.y,gt[Ki].y);Jt=Zt.x>=Ke.x&&Qt.x<=mt.x&&Zt.y>=Ke.y&&Qt.y<=mt.y?[gt]:Qt.x<Ke.x||Zt.x>mt.x||Qt.y<Ke.y||Zt.y>mt.y?[]:s.am([gt],Ke.x,Ke.y,mt.x,mt.y)}for(const Zt of Jt){Yt.reset(Zt,.25*Ve);let Qt=0;Qt=Yt.length<=.5*Ve?1:Math.ceil(Yt.paddedLength/bi)+1;for(let Ki=0;Ki<Qt;Ki++){const Ci=Ki/Math.max(Qt-1,1),Sr=Yt.lerp(Ci),lr=Sr.x+Y,er=Sr.y+Y;$.push(lr,er,Ve,0);const un=lr-Ve,Ei=er-Ve,Vn=lr+Ve,Un=er+Ve;if(Ze=Ze&&this.isOffscreen(un,Ei,Vn,Un),Re=Re||this.isInsideGrid(un,Ei,Vn,Un),t!=="always"&&this.grid.hitTestCircle(lr,er,Ve,t,z)&&(Me=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!A&&Me||!Re||xe<this.perspectiveRatioCutoff?[]:$,offscreen:Ze,collisionDetected:Me}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,f=1/0,g=-1/0,x=-1/0;for(const P of t){const z=new s.P(P.x+Y,P.y+Y);h=Math.min(h,z.x),f=Math.min(f,z.y),g=Math.max(g,z.x),x=Math.max(x,z.y),o.push(z)}const w=this.grid.query(h,f,g,x).concat(this.ignoredGrid.query(h,f,g,x)),k={},A={};for(const P of w){const z=P.key;if(k[z.bucketInstanceId]===void 0&&(k[z.bucketInstanceId]={}),k[z.bucketInstanceId][z.featureIndex])continue;const O=[new s.P(P.x1,P.y1),new s.P(P.x2,P.y1),new s.P(P.x2,P.y2),new s.P(P.x1,P.y2)];s.an(o,O)&&(k[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(t,o,h,f,g,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:x,overlapMode:o},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,h,f,g,x){const w=h?this.ignoredGrid:this.grid,k={bucketInstanceId:f,featureIndex:g,collisionGroupID:x,overlapMode:o};for(let A=0;A<t.length;A+=4)w.insertCircle(k,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,o,h,f){let g;return f?(g=[o,h,f(o,h),1],s.ag(g,g,t)):(g=[o,h,0,1],K(g,g,t)),{point:new s.P((g[0]/g[3]+1)/2*this.transform.width+Y,(-g[1]/g[3]+1)/2*this.transform.height+Y),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,o,h,f){return h<Y||t>=this.screenRightBoundary||f<Y||o>this.screenBottomBoundary}isInsideGrid(t,o,h,f){return h>=0&&t<this.gridRightBoundary&&f>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=s.ao([]);return s.$(t,t,[-100,-100,0]),t}}function se(m,t,o){return t*(s.N/(m.tileSize*Math.pow(2,o-m.tileID.overscaledZ)))}class te{constructor(t,o,h,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class he{constructor(t,o,h,f,g){this.text=new te(t?t.text:null,o,h,g),this.icon=new te(t?t.icon:null,o,f,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Le{constructor(t,o,h){this.text=t,this.icon=o,this.skipFade=h}}class Fe{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Ne{constructor(t,o,h,f,g){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=g}}class St{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[t]}}function zt(m,t,o,h,f){const{horizontalAlign:g,verticalAlign:x}=s.au(m);return new s.P(-(g-.5)*t+h[0]*f,-(x-.5)*o+h[1]*f)}function pt(m,t,o,h,f,g){const{x1:x,x2:w,y1:k,y2:A,anchorPointX:P,anchorPointY:z}=m,O=new s.P(t,o);return h&&O._rotate(f?g:-g),{x1:x+O.x,y1:k+O.y,x2:w+O.x,y2:A+O.y,anchorPointX:P,anchorPointY:z}}class It{constructor(t,o,h,f,g){this.transform=t.clone(),this.terrain=o,this.collisionIndex=new pe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new St(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,h,f){const g=h.getBucket(o),x=h.latestFeatureIndex;if(!g||!x||o.id!==g.layerIds[0])return;const w=h.collisionBoxArray,k=g.layers[0].layout,A=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),P=h.tileSize/s.N,z=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),O=k.get("text-pitch-alignment")==="map",X=k.get("text-rotation-alignment")==="map",G=se(h,1,this.transform.zoom),$=Qe(z,O,X,this.transform,G);let q=null;if(O){const xe=Rn(z,O,X,this.transform,G);q=s.a1([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[g.bucketInstanceId]=new Ne(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,h.tileID);const le={bucket:g,layout:k,posMatrix:z,textLabelPlaneMatrix:$,labelToScreenMatrix:q,scale:A,textPixelRatio:P,holdingForFade:h.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.ah(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(f)for(const xe of g.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ue,symbolInstanceEnd:ke}=xe;t.push({sortKey:Q,symbolInstanceStart:ue,symbolInstanceEnd:ke,parameters:le})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:le})}attemptAnchorPlacement(t,o,h,f,g,x,w,k,A,P,z,O,X,G,$,q){const le=s.aq[t.textAnchor],xe=[t.textOffset0,t.textOffset1],Q=zt(le,h,f,xe,g),ue=this.collisionIndex.placeCollisionBox(pt(o,Q.x,Q.y,x,w,this.transform.angle),z,k,A,P.predicate,q);if((!$||this.collisionIndex.placeCollisionBox(pt($,Q.x,Q.y,x,w,this.transform.angle),z,k,A,P.predicate,q).box.length!==0)&&ue.box.length>0){let ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:xe,width:h,height:f,anchor:le,textBoxScale:g,prevAnchor:ke},this.markUsedJustification(X,le,O,G),X.allowVerticalPlacement&&(this.markUsedOrientation(X,G,O),this.placedOrientations[O.crossTileID]=G),{shift:Q,placedGlyphBoxes:ue}}}placeLayerBucketPart(t,o,h){const{bucket:f,layout:g,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:k,textPixelRatio:A,holdingForFade:P,collisionBoxArray:z,partiallyEvaluatedTextSize:O,collisionGroup:X}=t.parameters,G=g.get("text-optional"),$=g.get("icon-optional"),q=s.ar(g,"text-overlap","text-allow-overlap"),le=q==="always",xe=s.ar(g,"icon-overlap","icon-allow-overlap"),Q=xe==="always",ue=g.get("text-rotation-alignment")==="map",ke=g.get("text-pitch-alignment")==="map",Me=g.get("icon-text-fit")!=="none",Re=g.get("symbol-z-order")==="viewport-y",Ze=le&&(Q||!f.hasIconData()||$),Ve=Q&&(le||!f.hasTextData()||G);!f.collisionArrays&&z&&f.deserializeCollisionBoxes(z);const Ke=this.retainedQueryData[f.bucketInstanceId].tileID,mt=this.terrain?(nt,Ct)=>this.terrain.getElevation(Ke,nt,Ct):null,Yt=(nt,Ct)=>{var gt,bi;if(o[nt.crossTileID])return;if(P)return void(this.placements[nt.crossTileID]=new Le(!1,!1,!1));let Jt=!1,Zt=!1,Qt=!0,Ki=null,Ci={box:null,offscreen:null},Sr={box:null,offscreen:null},lr=null,er=null,un=null,Ei=0,Vn=0,Un=0;Ct.textFeatureIndex?Ei=Ct.textFeatureIndex:nt.useRuntimeCollisionCircles&&(Ei=nt.featureIndex),Ct.verticalTextFeatureIndex&&(Vn=Ct.verticalTextFeatureIndex);const go=Ct.textBox;if(go){const Ar=Ji=>{let cr=s.ai.horizontal;if(f.allowVerticalPlacement&&!Ji&&this.prevPlacement){const Gr=this.prevPlacement.placedOrientations[nt.crossTileID];Gr&&(this.placedOrientations[nt.crossTileID]=Gr,cr=Gr,this.markUsedOrientation(f,cr,nt))}return cr},Tr=(Ji,cr)=>{if(f.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&Ct.verticalTextBox){for(const Gr of f.writingModes)if(Gr===s.ai.vertical?(Ci=cr(),Sr=Ci):Ci=Ji(),Ci&&Ci.box&&Ci.box.length)break}else Ci=Ji()},Rr=nt.textAnchorOffsetStartIndex,Do=nt.textAnchorOffsetEndIndex;if(Do===Rr){const Ji=(cr,Gr)=>{const Yi=this.collisionIndex.placeCollisionBox(cr,q,A,x,X.predicate,mt);return Yi&&Yi.box&&Yi.box.length&&(this.markUsedOrientation(f,Gr,nt),this.placedOrientations[nt.crossTileID]=Gr),Yi};Tr(()=>Ji(go,s.ai.horizontal),()=>{const cr=Ct.verticalTextBox;return f.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&cr?Ji(cr,s.ai.vertical):{box:null,offscreen:null}}),Ar(Ci&&Ci.box&&Ci.box.length)}else{let Ji=s.aq[(bi=(gt=this.prevPlacement)===null||gt===void 0?void 0:gt.variableOffsets[nt.crossTileID])===null||bi===void 0?void 0:bi.anchor];const cr=(Yi,Bo,ga)=>{const iu=Yi.x2-Yi.x1,ru=Yi.y2-Yi.y1,sh=nt.textBoxScale,Al=Me&&xe==="never"?Bo:null;let jn={box:[],offscreen:!1},Fo=q==="never"?1:2,qn="never";Ji&&Fo++;for(let Sn=0;Sn<Fo;Sn++){for(let Zn=Rr;Zn<Do;Zn++){const El=f.textAnchorOffsets.get(Zn);if(Ji&&El.textAnchor!==Ji)continue;const no=this.attemptAnchorPlacement(El,Yi,iu,ru,sh,ue,ke,A,x,X,qn,nt,f,ga,Al,mt);if(no&&(jn=no.placedGlyphBoxes,jn&&jn.box&&jn.box.length))return Jt=!0,Ki=no.shift,jn}Ji?Ji=null:qn=q}return jn};Tr(()=>cr(go,Ct.iconBox,s.ai.horizontal),()=>{const Yi=Ct.verticalTextBox;return f.allowVerticalPlacement&&!(Ci&&Ci.box&&Ci.box.length)&&nt.numVerticalGlyphVertices>0&&Yi?cr(Yi,Ct.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),Ci&&(Jt=Ci.box,Qt=Ci.offscreen);const Gr=Ar(Ci&&Ci.box);if(!Jt&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[nt.crossTileID];Yi&&(this.variableOffsets[nt.crossTileID]=Yi,this.markUsedJustification(f,Yi.anchor,nt,Gr))}}}if(lr=Ci,Jt=lr&&lr.box&&lr.box.length>0,Qt=lr&&lr.offscreen,nt.useRuntimeCollisionCircles){const Ar=f.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),Tr=s.aj(f.textSizeData,O,Ar),Rr=g.get("text-padding");er=this.collisionIndex.placeCollisionCircles(q,Ar,f.lineVertexArray,f.glyphOffsetArray,Tr,x,w,k,h,ke,X.predicate,nt.collisionCircleDiameter,Rr,mt),er.circles.length&&er.collisionDetected&&!h&&s.w("Collisions detected, but collision boxes are not shown"),Jt=le||er.circles.length>0&&!er.collisionDetected,Qt=Qt&&er.offscreen}if(Ct.iconFeatureIndex&&(Un=Ct.iconFeatureIndex),Ct.iconBox){const Ar=Tr=>{const Rr=Me&&Ki?pt(Tr,Ki.x,Ki.y,ue,ke,this.transform.angle):Tr;return this.collisionIndex.placeCollisionBox(Rr,xe,A,x,X.predicate,mt)};Sr&&Sr.box&&Sr.box.length&&Ct.verticalIconBox?(un=Ar(Ct.verticalIconBox),Zt=un.box.length>0):(un=Ar(Ct.iconBox),Zt=un.box.length>0),Qt=Qt&&un.offscreen}const Lo=G||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,ss=$||nt.numIconVertices===0;if(Lo||ss?ss?Lo||(Zt=Zt&&Jt):Jt=Zt&&Jt:Zt=Jt=Zt&&Jt,Jt&&lr&&lr.box&&this.collisionIndex.insertCollisionBox(lr.box,q,g.get("text-ignore-placement"),f.bucketInstanceId,Sr&&Sr.box&&Vn?Vn:Ei,X.ID),Zt&&un&&this.collisionIndex.insertCollisionBox(un.box,xe,g.get("icon-ignore-placement"),f.bucketInstanceId,Un,X.ID),er&&(Jt&&this.collisionIndex.insertCollisionCircles(er.circles,q,g.get("text-ignore-placement"),f.bucketInstanceId,Ei,X.ID),h)){const Ar=f.bucketInstanceId;let Tr=this.collisionCircleArrays[Ar];Tr===void 0&&(Tr=this.collisionCircleArrays[Ar]=new Fe);for(let Rr=0;Rr<er.circles.length;Rr+=4)Tr.circles.push(er.circles[Rr+0]),Tr.circles.push(er.circles[Rr+1]),Tr.circles.push(er.circles[Rr+2]),Tr.circles.push(er.collisionDetected?1:0)}if(nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nt.crossTileID]=new Le(Jt||Ze,Zt||Ve,Qt||f.justReloaded),o[nt.crossTileID]=!0};if(Re){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nt=f.getSortedSymbolIndexes(this.transform.angle);for(let Ct=nt.length-1;Ct>=0;--Ct){const gt=nt[Ct];Yt(f.symbolInstances.get(gt),f.collisionArrays[gt])}}else for(let nt=t.symbolInstanceStart;nt<t.symbolInstanceEnd;nt++)Yt(f.symbolInstances.get(nt),f.collisionArrays[nt]);if(h&&f.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[f.bucketInstanceId];s.as(nt.invProjMatrix,x),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(t,o,h,f){let g;g=f===s.ai.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[s.at(o)];const x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:h.crossTileID)}markUsedOrientation(t,o,h){const f=o===s.ai.horizontal||o===s.ai.horizontalOnly?o:0,g=o===s.ai.vertical?o:0,x=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const w of x)t.text.placedSymbolArray.get(w).placedOrientation=f;h.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const f=o?o.symbolFadeChange(t):1,g=o?o.opacities:{},x=o?o.variableOffsets:{},w=o?o.placedOrientations:{};for(const k in this.placements){const A=this.placements[k],P=g[k];P?(this.opacities[k]=new he(P,f,A.text,A.icon),h=h||A.text!==P.text.placed||A.icon!==P.icon.placed):(this.opacities[k]=new he(null,f,A.text,A.icon,A.skipFade),h=h||A.text||A.icon)}for(const k in g){const A=g[k];if(!this.opacities[k]){const P=new he(A,f,!1,!1);P.isHidden()||(this.opacities[k]=P,h=h||A.text.placed||A.icon.placed)}}for(const k in x)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=x[k]);for(const k in w)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=w[k]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const h={};for(const f of o){const g=f.getBucket(t);g&&f.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,h,f.collisionBoxArray)}}updateBucketOpacities(t,o,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const f=t.layers[0],g=f.layout,x=new he(null,0,!1,!1,!0),w=g.get("text-allow-overlap"),k=g.get("icon-allow-overlap"),A=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),P=g.get("text-rotation-alignment")==="map",z=g.get("text-pitch-alignment")==="map",O=g.get("icon-text-fit")!=="none",X=new he(null,0,w&&(k||!t.hasIconData()||g.get("icon-optional")),k&&(w||!t.hasTextData()||g.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const G=($,q,le)=>{for(let xe=0;xe<q/4;xe++)$.opacityVertexArray.emplaceBack(le);$.hasVisibleVertices=$.hasVisibleVertices||le!==gn};for(let $=0;$<t.symbolInstances.length;$++){const q=t.symbolInstances.get($),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:xe,crossTileID:Q}=q;let ue=this.opacities[Q];o[Q]?ue=x:ue||(ue=X,this.opacities[Q]=ue),o[Q]=!0;const ke=q.numIconVertices>0,Me=this.placedOrientations[q.crossTileID],Re=Me===s.ai.vertical,Ze=Me===s.ai.horizontal||Me===s.ai.horizontalOnly;if(le>0||xe>0){const Ve=xr(ue.text);G(t.text,le,Re?gn:Ve),G(t.text,xe,Ze?gn:Ve);const Ke=ue.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(nt=>{nt>=0&&(t.text.placedSymbolArray.get(nt).hidden=Ke||Re?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=Ke||Ze?1:0);const mt=this.variableOffsets[q.crossTileID];mt&&this.markUsedJustification(t,mt.anchor,q,Me);const Yt=this.placedOrientations[q.crossTileID];Yt&&(this.markUsedJustification(t,"left",q,Yt),this.markUsedOrientation(t,Yt,q))}if(ke){const Ve=xr(ue.icon),Ke=!(O&&q.verticalPlacedIconSymbolIndex&&Re);q.placedIconSymbolIndex>=0&&(G(t.icon,q.numIconVertices,Ke?Ve:gn),t.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=ue.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(G(t.icon,q.numVerticalIconVertices,Ke?gn:Ve),t.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=ue.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ve=t.collisionArrays[$];if(Ve){let Ke=new s.P(0,0);if(Ve.textBox||Ve.verticalTextBox){let Yt=!0;if(A){const nt=this.variableOffsets[Q];nt?(Ke=zt(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),P&&Ke._rotate(z?this.transform.angle:-this.transform.angle)):Yt=!1}Ve.textBox&&Ft(t.textCollisionBox.collisionVertexArray,ue.text.placed,!Yt||Re,Ke.x,Ke.y),Ve.verticalTextBox&&Ft(t.textCollisionBox.collisionVertexArray,ue.text.placed,!Yt||Ze,Ke.x,Ke.y)}const mt=!!(!Ze&&Ve.verticalIconBox);Ve.iconBox&&Ft(t.iconCollisionBox.collisionVertexArray,ue.icon.placed,mt,O?Ke.x:0,O?Ke.y:0),Ve.verticalIconBox&&Ft(t.iconCollisionBox.collisionVertexArray,ue.icon.placed,!mt,O?Ke.x:0,O?Ke.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=$.invProjMatrix,t.placementViewportMatrix=$.viewportMatrix,t.collisionCircleArray=$.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function Ft(m,t,o,h,f){m.emplaceBack(t?1:0,o?1:0,h||0,f||0),m.emplaceBack(t?1:0,o?1:0,h||0,f||0),m.emplaceBack(t?1:0,o?1:0,h||0,f||0),m.emplaceBack(t?1:0,o?1:0,h||0,f||0)}const _i=Math.pow(2,25),xi=Math.pow(2,24),ui=Math.pow(2,17),ai=Math.pow(2,16),Mr=Math.pow(2,9),Mi=Math.pow(2,8),nr=Math.pow(2,1);function xr(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,o=Math.floor(127*m.opacity);return o*_i+t*xi+o*ui+t*ai+o*Mr+t*Mi+o*nr+t}const gn=0;class yc{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,h,f,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(x,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,k)=>w.sortKey-k.sortKey));this._currentPartIndex<x.length;)if(o.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,g())return!0;return!1}}class Wo{constructor(t,o,h,f,g,x,w,k){this.placement=new It(t,o,x,w,k),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,o,h){const f=s.h.now(),g=()=>!this._forceFullPlacement&&s.h.now()-f>2;for(;this._currentPlacementIndex>=0;){const x=o[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new yc(x)),this._inProgressLayer.continuePlacement(h[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ho=512/s.N/2;class qu{constructor(t,o,h){this.tileID=t,this.bucketInstanceId=h,this._symbolsByKey={};const f=new Map;for(let g=0;g<o.length;g++){const x=o.get(g),w=x.key,k=f.get(w);k?k.push(x):f.set(w,[x])}for(const[g,x]of f){const w={positions:x.map(k=>({x:Math.floor(k.anchorX*Ho),y:Math.floor(k.anchorY*Ho)})),crossTileIDs:x.map(k=>k.crossTileID)};if(w.positions.length>128){const k=new s.av(w.positions.length,16,Uint16Array);for(const{x:A,y:P}of w.positions)k.add(A,P);k.finish(),delete w.positions,w.index=k}this._symbolsByKey[g]=w}}getScaledCoordinates(t,o){const{x:h,y:f,z:g}=this.tileID.canonical,{x,y:w,z:k}=o.canonical,A=Ho/Math.pow(2,k-g),P=(w*s.N+t.anchorY)*A,z=f*s.N*Ho;return{x:Math.floor((x*s.N+t.anchorX)*A-h*s.N*Ho),y:Math.floor(P-z)}}findMatches(t,o,h){const f=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const w=this._symbolsByKey[x.key];if(!w)continue;const k=this.getScaledCoordinates(x,o);if(w.index){const A=w.index.range(k.x-f,k.y-f,k.x+f,k.y+f).sort();for(const P of A){const z=w.crossTileIDs[P];if(!h[z]){h[z]=!0,x.crossTileID=z;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const P=w.positions[A],z=w.crossTileIDs[A];if(Math.abs(P.x-k.x)<=f&&Math.abs(P.y-k.y)<=f&&!h[z]){h[z]=!0,x.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class vi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ja{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const h in this.indexes){const f=this.indexes[h],g={};for(const x in f){const w=f[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+o),g[w.tileID.key]=w}this.indexes[h]=g}this.lng=t}addBucket(t,o,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<o.symbolInstances.length;g++)o.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const w in x){const k=x[w];k.tileID.isChildOf(t)&&k.findMatches(o.symbolInstances,t,f)}else{const w=x[t.scaledTo(Number(g)).key];w&&w.findMatches(o.symbolInstances,t,f)}}for(let g=0;g<o.symbolInstances.length;g++){const x=o.symbolInstances.get(g);x.crossTileID||(x.crossTileID=h.generate(),f[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new qu(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const h of o.getCrossTileIDsLists())for(const f of h)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let o=!1;for(const h in this.indexes){const f=this.indexes[h];for(const g in f)t[f[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[g]),delete f[g],o=!0)}return o}}class qs{constructor(){this.layerIndexes={},this.crossTileIDs=new vi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,h){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new ja);let g=!1;const x={};f.handleWrapJump(h);for(const w of o){const k=w.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(w.tileID,k,this.crossTileIDs)&&(g=!0),x[k.bucketInstanceId]=!0)}return f.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const o={};t.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const Cr=(m,t)=>s.x(m,t&&t.filter(o=>o.identifier!=="source.canvas")),on=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Zu=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),yn=s.aw();class wr extends s.E{constructor(t,o={}){super(),this.map=t,this.dispatcher=new $t(Ui(),this,t._getMapId()),this.imageManager=new Te,this.imageManager.setEventedParent(this),this.glyphManager=new dt(t._requestManager,o.localIdeographFontFamily),this.lineAtlas=new yi(256,512),this.crossTileSymbolIndex=new qs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const h=this;this._rtlTextPluginCallback=wr.registerForPluginStateChange(f=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(g,x)=>{if(s.aA(g),x&&x.every(w=>w))for(const w in h.sourceCaches){const k=h.sourceCaches[w].getSource().type;k!=="vector"&&k!=="geojson"||h.sourceCaches[w].reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.sourceCaches[f.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const k=this._layers[w];k.source===x.id&&this._validateLayer(k)}})}loadURL(t,o={},h){this.fire(new s.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const f=this.map._requestManager.transformRequest(t,Ee.Style);this._request=s.f(f,(g,x)=>{this._request=null,g?this.fire(new s.j(g)):x&&this._load(x,o,h)})}loadJSON(t,o={},h){this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,o.validate=o.validate!==!1,this._load(t,o,h)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(yn,{validate:!1})}_load(t,o,h){var f;const g=o.transformStyle?o.transformStyle(h,t):t;if(!o.validate||!Cr(this,s.y(g))){this._loaded=!0,this.stylesheet=g;for(const x in g.sources)this.addSource(x,g.sources[x],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs),this._createLayers(),this.light=new kt(this.stylesheet.light),this.map.setTerrain((f=this.stylesheet.terrain)!==null&&f!==void 0?f:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const t=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of t){const h=s.aC(o);h.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=h}}_loadSprite(t,o=!1,h=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(f,g,x,w){const k=Ae(f),A=k.length,P=x>1?"@2x":"",z={},O={},X={};for(const{id:G,url:$}of k){const q=g.transformRequest(g.normalizeSpriteURL($,P,".json"),Ee.SpriteJSON),le=`${G}_${q.url}`;z[le]=s.f(q,(ue,ke)=>{delete z[le],O[G]=ke,Ue(w,O,X,ue,A)});const xe=g.transformRequest(g.normalizeSpriteURL($,P,".png"),Ee.SpriteImage),Q=`${G}_${xe.url}`;z[Q]=ve.getImage(xe,(ue,ke)=>{delete z[Q],X[G]=ke,Ue(w,O,X,ue,A)})}return{cancel(){for(const G of Object.values(z))G.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(f,g)=>{if(this._spriteRequest=null,f)this.fire(new s.j(f));else if(g)for(const x in g){this._spritesImagesIds[x]=[];const w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(k=>!(k in g)):[];for(const k of w)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in g[x]){const A=x==="default"?k:`${x}:${k}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,g[x][k],!1):this.imageManager.addImage(A,g[x][k]),o&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),h&&h(f)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(t){const o=this.sourceCaches[t.source];if(!o)return;const h=t.sourceLayer;if(!h)return;const f=o.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(h)===-1)&&this.fire(new s.j(new Error(`Source layer "${h}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const o=this._serializedAllLayers();if(!t||t.length===0)return Object.values(o);const h=[];for(const f of t)o[f]&&h.push(o[f]);return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const o=Object.keys(this._layers);for(const h of o){const f=this._layers[h];f.type!=="custom"&&(t[h]=f.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const o=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(f.length||g.length)&&this._updateWorkerLayers(f,g);for(const x in this._updatedSources){const w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const h={};for(const f in this.sourceCaches){const g=this.sourceCaches[f];h[f]=g.used,g.used=!1}for(const f of this._order){const g=this._layers[f];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const f in h){const g=this.sourceCaches[f];h[f]!==g.used&&g.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.z=t.zoom,o&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,o={}){this._checkLoaded();const h=this.serialize();if(t=o.transformStyle?o.transformStyle(h,t):t,Cr(this,s.y(t)))return!1;(t=s.aD(t)).layers=s.aB(t.layers);const f=s.aE(h,t).filter(x=>!(x.command in Zu));if(f.length===0)return!1;const g=f.filter(x=>!(x.command in on));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);for(const x of f)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,o){if(this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,o),this._afterImageUpdated(t)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,o,h={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(s.y.source,`sources.${t}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const f=this.sourceCaches[t]=new br(t,o,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t})),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===t)return this.fire(new s.j(new Error(`Source "${t}" cannot be removed while layer "${h}" is using it.`)));const o=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],o.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,o){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const h=this.sourceCaches[t].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,o,h={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new s.j(new Error(`Layer "${f}" already exists on this map.`)));let g;if(t.type==="custom"){if(Cr(this,s.aF(t)))return;g=s.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(f,t.source),t=s.aD(t),t=s.e(t,{source:f})),this._validate(s.y.layer,`layers.${f}`,t,{arrayIndex:-1},h))return;g=s.aC(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:f}})}const x=o?this._order.indexOf(o):this._order.length;if(o&&x===-1)this.fire(new s.j(new Error(`Cannot add layer "${f}" before non-existing layer "${o}".`)));else{if(this._order.splice(x,0,f),this._layerOrderChanged=!0,this._layers[f]=g,this._removedLayers[f]&&g.source&&g.type!=="custom"){const w=this._removedLayers[f];delete this._removedLayers[f],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===o)return;const h=this._order.indexOf(t);this._order.splice(h,1);const f=o?this._order.indexOf(o):this._order.length;o&&f===-1?this.fire(new s.j(new Error(`Cannot move layer "${t}" before non-existing layer "${o}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${t}".`)));o.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,o,h){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===o&&f.maxzoom===h||(o!=null&&(f.minzoom=o),h!=null&&(f.maxzoom=h),this._updateLayer(f)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,o,h={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!s.aG(f.filter,o))return o==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(s.y.filter,`layers.${f.id}.filter`,o,null,h)||(f.filter=s.aD(o),this._updateLayer(f)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.aD(this.getLayer(t).filter)}setLayoutProperty(t,o,h,f={}){this._checkLoaded();const g=this.getLayer(t);g?s.aG(g.getLayoutProperty(o),h)||(g.setLayoutProperty(o,h,f),this._updateLayer(g)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,o){const h=this.getLayer(t);if(h)return h.getLayoutProperty(o);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,o,h,f={}){this._checkLoaded();const g=this.getLayer(t);g?s.aG(g.getPaintProperty(o),h)||(g.setPaintProperty(o,h,f)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,o){return this.getLayer(t).getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const h=t.source,f=t.sourceLayer,g=this.sourceCaches[h];if(g===void 0)return void this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&f?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||f?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),g.setFeatureState(f,t.id,o)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,o){this._checkLoaded();const h=t.source,f=this.sourceCaches[h];if(f===void 0)return void this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)));const g=f.getSource().type,x=g==="vector"?t.sourceLayer:void 0;g!=="vector"||x?o&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(x,t.id,o):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const o=t.source,h=t.sourceLayer,f=this.sourceCaches[o];if(f!==void 0)return f.getSource().type!=="vector"||h?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),f.getFeatureState(h,t.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.aH(this.sourceCaches,g=>g.serialize()),o=this._serializeByIds(this._order),h=this.map.getTerrain()||void 0,f=this.stylesheet;return s.aI({version:f.version,name:f.name,metadata:f.metadata,light:f.light,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,sources:t,layers:o,terrain:h},g=>g!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const o=x=>this._layers[x].type==="fill-extrusion",h={},f=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(o(w)){h[w]=x;for(const k of t){const A=k[w];if(A)for(const P of A)f.push(P)}}}f.sort((x,w)=>w.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(o(w))for(let k=f.length-1;k>=0;k--){const A=f[k].feature;if(h[A.layer.id]<x)break;g.push(A),f.pop()}else for(const k of t){const A=k[w];if(A)for(const P of A)g.push(P.feature)}}return g}queryRenderedFeatures(t,o,h){o&&o.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",o.filter,null,o);const f={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const w of o.layers){const k=this._layers[w];if(!k)return this.fire(new s.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];f[k.source]=!0}}const g=[];o.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const w in this.sourceCaches)o.layers&&!f[w]||g.push(rn(this.sourceCaches[w],this._layers,x,t,o,h));return this.placement&&g.push(function(w,k,A,P,z,O,X){const G={},$=O.queryRenderedSymbols(P),q=[];for(const le of Object.keys($).map(Number))q.push(X[le]);q.sort(Mn);for(const le of q){const xe=le.featureIndex.lookupSymbolFeatures($[le.bucketInstanceId],k,le.bucketIndex,le.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const Q in xe){const ue=G[Q]=G[Q]||[],ke=xe[Q];ke.sort((Me,Re)=>{const Ze=le.featureSortOrder;if(Ze){const Ve=Ze.indexOf(Me.featureIndex);return Ze.indexOf(Re.featureIndex)-Ve}return Re.featureIndex-Me.featureIndex});for(const Me of ke)ue.push(Me)}}for(const le in G)G[le].forEach(xe=>{const Q=xe.feature,ue=A[w[le].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ue});return G}(this._layers,x,this.sourceCaches,t,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,o){o&&o.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",o.filter,null,o);const h=this.sourceCaches[t];return h?function(f,g){const x=f.getRenderableIds().map(A=>f.getTileByID(A)),w=[],k={};for(let A=0;A<x.length;A++){const P=x[A],z=P.tileID.canonical.key;k[z]||(k[z]=!0,P.querySourceFeatures(w,g))}return w}(h,o):[]}addSourceType(t,o,h){return Ii(t)?h(new Error(`A source type called "${t}" already exists.`)):(((f,g)=>{Xe[f]=g})(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const h=this.light.getLight();let f=!1;for(const x in t)if(!s.aG(t[x],h[x])){f=!0;break}if(!f)return;const g={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,o),this.light.updateTransitions(g)}_validate(t,o,h,f,g={}){return(!g||g.validate!==!1)&&Cr(this,t.call(s.y,s.e({key:o,style:this.serialize(),value:h,styleSpec:s.v},f)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const o in this.sourceCaches)this.sourceCaches[o].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,o,h,f,g=!1){let x=!1,w=!1;const k={};for(const A of this._order){const P=this._layers[A];if(P.type!=="symbol")continue;if(!k[P.source]){const O=this.sourceCaches[P.source];k[P.source]=O.getRenderableIds(!0).map(X=>O.getTileByID(X)).sort((X,G)=>G.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(G.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(P,k[P.source],t.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),t.zoom))&&(this.pauseablePlacement=new Wo(t,this.map.terrain,this._order,g,o,h,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const A of this._order){const P=this._layers[A];P.type==="symbol"&&this.placement.updateLayerOpacities(P,k[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o,h){this.imageManager.getImages(o.icons,h),this._updateTilesForChangedImages();const f=this.sourceCaches[o.source];f&&f.setDependencies(o.tileID.key,o.type,o.icons)}getGlyphs(t,o,h){this.glyphManager.getGlyphs(o.stacks,h);const f=this.sourceCaches[o.source];f&&f.setDependencies(o.tileID.key,o.type,[""])}getResource(t,o,h){return s.m(o,h)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,o={}){this._checkLoaded(),t&&this._validate(s.y.glyphs,"glyphs",t,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,o,h={},f){this._checkLoaded();const g=[{id:t,url:o}],x=[...Ae(this.stylesheet.sprite),...g];this._validate(s.y.sprite,"sprite",x,null,h)||(this.stylesheet.sprite=x,this._loadSprite(g,!0,f))}removeSprite(t){this._checkLoaded();const o=Ae(this.stylesheet.sprite);if(o.find(h=>h.id===t)){if(this._spritesImagesIds[t])for(const h of this._spritesImagesIds[t])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex(h=>h.id===t),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ae(this.stylesheet.sprite)}setSprite(t,o={},h){this._checkLoaded(),t&&this._validate(s.y.sprite,"sprite",t,null,o)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,h):(this._unloadSprite(),h&&h(null)))}}wr.registerForPluginStateChange=s.aK;var Zs=s.Q([{name:"a_pos",type:"Int16",components:2}]),$o="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Bi={prelude:fi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:fi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:fi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:fi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:fi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:fi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:fi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:fi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:fi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:fi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:fi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:fi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:fi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:fi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:fi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:fi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:fi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:fi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:fi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:fi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",$o),terrainDepth:fi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",$o),terrainCoords:fi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",$o)};function fi(m,t){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=t.match(/attribute ([\w]+) ([\w]+)/g),f=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(f):f,w={};return{fragmentSource:m=m.replace(o,(k,A,P,z,O)=>(w[O]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(o,(k,A,P,z,O)=>{const X=z==="float"?"vec2":"vec4",G=O.match(/color/)?"color":X;return w[O]?A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${P} ${X} a_${O};
varying ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${P} ${X} a_${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`}),staticAttributes:h,staticUniforms:x}}class ko{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,o,h,f,g,x,w,k,A){this.context=t;let P=this.boundPaintVertexBuffers.length!==f.length;for(let z=0;!P&&z<f.length;z++)this.boundPaintVertexBuffers[z]!==f[z]&&(P=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||P||this.boundIndexBuffer!==g||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==A?this.freshBind(o,h,f,g,x,w,k,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),k&&k.bind(),A&&A.bind())}freshBind(t,o,h,f,g,x,w,k){const A=t.numAttributes,P=this.context,z=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=k,o.enableAttributes(z,t);for(const O of h)O.enableAttributes(z,t);x&&x.enableAttributes(z,t),w&&w.enableAttributes(z,t),k&&k.enableAttributes(z,t),o.bind(),o.setVertexAttribPointers(z,t,g);for(const O of h)O.bind(),O.setVertexAttribPointers(z,t,g);x&&(x.bind(),x.setVertexAttribPointers(z,t,g)),f&&f.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,t,g)),k&&(k.bind(),k.setVertexAttribPointers(z,t,g)),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Zi(m){const t=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;const h=m[o].split(" ");t.push(h.pop())}return t}class Gs{constructor(t,o,h,f,g,x){const w=t.gl;this.program=w.createProgram();const k=Zi(o.staticAttributes),A=h?h.getBinderAttributes():[],P=k.concat(A),z=Bi.prelude.staticUniforms?Zi(Bi.prelude.staticUniforms):[],O=o.staticUniforms?Zi(o.staticUniforms):[],X=h?h.getBinderUniforms():[],G=z.concat(O).concat(X),$=[];for(const Me of G)$.indexOf(Me)<0&&$.push(Me);const q=h?h.defines():[];g&&q.push("#define OVERDRAW_INSPECTOR;"),x&&q.push("#define TERRAIN3D;");const le=q.concat(Bi.prelude.fragmentSource,o.fragmentSource).join(`
`),xe=q.concat(Bi.prelude.vertexSource,o.vertexSource).join(`
`),Q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Q,le),w.compileShader(Q),!w.getShaderParameter(Q,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(Q)}`);w.attachShader(this.program,Q);const ue=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ue,xe),w.compileShader(ue),!w.getShaderParameter(ue,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ue)}`);w.attachShader(this.program,ue),this.attributes={};const ke={};this.numAttributes=P.length;for(let Me=0;Me<this.numAttributes;Me++)P[Me]&&(w.bindAttribLocation(this.program,Me,P[Me]),this.attributes[P[Me]]=Me);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ue),w.deleteShader(Q);for(let Me=0;Me<$.length;Me++){const Re=$[Me];if(Re&&!ke[Re]){const Ze=w.getUniformLocation(this.program,Re);Ze&&(ke[Re]=Ze)}}this.fixedUniforms=f(t,ke),this.terrainUniforms=((Me,Re)=>({u_depth:new s.aL(Me,Re.u_depth),u_terrain:new s.aL(Me,Re.u_terrain),u_terrain_dim:new s.aM(Me,Re.u_terrain_dim),u_terrain_matrix:new s.aN(Me,Re.u_terrain_matrix),u_terrain_unpack:new s.aO(Me,Re.u_terrain_unpack),u_terrain_exaggeration:new s.aM(Me,Re.u_terrain_exaggeration)}))(t,ke),this.binderUniforms=h?h.getUniforms(t,ke):[]}draw(t,o,h,f,g,x,w,k,A,P,z,O,X,G,$,q,le,xe){const Q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(h),t.setStencilMode(f),t.setColorMode(g),t.setCullFace(x),k){t.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,k.depthTexture),t.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,k.texture);for(const ke in this.terrainUniforms)this.terrainUniforms[ke].set(k[ke])}for(const ke in this.fixedUniforms)this.fixedUniforms[ke].set(w[ke]);$&&$.setUniforms(t,this.binderUniforms,X,{zoom:G});let ue=0;switch(o){case Q.LINES:ue=2;break;case Q.TRIANGLES:ue=3;break;case Q.LINE_STRIP:ue=1}for(const ke of O.get()){const Me=ke.vaos||(ke.vaos={});(Me[A]||(Me[A]=new ko)).bind(t,this,P,$?$.getPaintVertexBuffers():[],z,ke.vertexOffset,q,le,xe),Q.drawElements(o,ke.primitiveLength*ue,Q.UNSIGNED_SHORT,ke.primitiveOffset*ue*2)}}}function vn(m,t,o){const h=1/se(o,1,t.transform.tileZoom),f=Math.pow(2,o.tileID.overscaledZ),g=o.tileSize*Math.pow(2,t.transform.tileZoom)/f,x=g*(o.tileID.canonical.x+o.tileID.wrap*f),w=g*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const qa=(m,t,o,h)=>{const f=t.style.light,g=f.properties.get("position"),x=[g.x,g.y,g.z],w=function(){var A=new s.A(9);return s.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();f.properties.get("anchor")==="viewport"&&function(A,P){var z=Math.sin(P),O=Math.cos(P);A[0]=O,A[1]=z,A[2]=0,A[3]=-z,A[4]=O,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-t.transform.angle),function(A,P,z){var O=P[0],X=P[1],G=P[2];A[0]=O*z[0]+X*z[3]+G*z[6],A[1]=O*z[1]+X*z[4]+G*z[7],A[2]=O*z[2]+X*z[5]+G*z[8]}(x,x,w);const k=f.properties.get("color");return{u_matrix:m,u_lightpos:x,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+o,u_opacity:h}},uo=(m,t,o,h,f,g,x)=>s.e(qa(m,t,o,h),vn(g,t,x),{u_height_factor:-Math.pow(2,f.overscaledZ)/x.tileSize/8}),vc=m=>({u_matrix:m}),Za=(m,t,o,h)=>s.e(vc(m),vn(o,t,h)),Xs=(m,t)=>({u_matrix:m,u_world:t}),Ws=(m,t,o,h,f)=>s.e(Za(m,t,o,h),{u_world:f}),ho=(m,t,o,h)=>{const f=m.transform;let g,x;if(h.paint.get("circle-pitch-alignment")==="map"){const w=se(o,1,f.zoom);g=!0,x=[w,w]}else g=!1,x=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(t.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:x}},Ga=(m,t,o)=>{const h=se(o,1,t.zoom),f=Math.pow(2,t.zoom-o.tileID.overscaledZ),g=o.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[t.pixelsToGLUnits[0]/(h*f),t.pixelsToGLUnits[1]/(h*f)],u_overscale_factor:g}},ys=(m,t,o=1)=>({u_matrix:m,u_color:t,u_overlay:0,u_overlay_scale:o}),bc=m=>({u_matrix:m}),Gu=(m,t,o,h)=>({u_matrix:m,u_extrude_scale:se(t,1,o),u_intensity:h});function Xa(m,t){const o=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new s.U(0,h/o).toLngLat().lat,new s.U(0,(h+1)/o).toLngLat().lat]}const Wa=(m,t,o,h)=>{const f=m.transform;return{u_matrix:Hs(m,t,o,h),u_ratio:1/se(t,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},xc=(m,t,o,h,f)=>s.e(Wa(m,t,o,f),{u_image:0,u_image_height:h}),Xu=(m,t,o,h,f)=>{const g=m.transform,x=Sc(t,g);return{u_matrix:Hs(m,t,o,f),u_texsize:t.imageAtlasTexture.size,u_ratio:1/se(t,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},wc=(m,t,o,h,f,g)=>{const x=m.lineAtlas,w=Sc(t,m.transform),k=o.layout.get("line-cap")==="round",A=x.getDash(h.from,k),P=x.getDash(h.to,k),z=A.width*f.fromScale,O=P.width*f.toScale;return s.e(Wa(m,t,o,g),{u_patternscale_a:[w/z,-A.height/2],u_patternscale_b:[w/O,-P.height/2],u_sdfgamma:x.width/(256*Math.min(z,O)*m.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:P.y,u_mix:f.t})};function Sc(m,t){return 1/se(m,1,t.tileZoom)}function Hs(m,t,o,h){return m.translatePosMatrix(h?h.posMatrix:t.tileID.posMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Tc=(m,t,o,h,f)=>{return{u_matrix:m,u_tl_parent:t,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(x=f.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=f.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:kc(f.paint.get("raster-hue-rotate"))};var g,x};function kc(m){m*=Math.PI/180;const t=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Ha=(m,t,o,h,f,g,x,w,k,A)=>{const P=f.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:P.width/P.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+k,u_pitch_with_map:+h,u_texsize:A,u_texture:0}},$a=(m,t,o,h,f,g,x,w,k,A,P)=>{const z=f.transform;return s.e(Ha(m,t,o,h,f,g,x,w,k,A),{u_gamma_scale:h?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+P})},Io=(m,t,o,h,f,g,x,w,k,A)=>s.e($a(m,t,o,h,f,g,x,w,!0,k,!0),{u_texsize_icon:A,u_texture_icon:1}),$s=(m,t,o)=>({u_matrix:m,u_opacity:t,u_color:o}),bn=(m,t,o,h,f,g)=>s.e(function(x,w,k,A){const P=k.imageManager.getPattern(x.from.toString()),z=k.imageManager.getPattern(x.to.toString()),{width:O,height:X}=k.imageManager.getPixelSize(),G=Math.pow(2,A.tileID.overscaledZ),$=A.tileSize*Math.pow(2,k.transform.tileZoom)/G,q=$*(A.tileID.canonical.x+A.tileID.wrap*G),le=$*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[O,X],u_mix:w.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/se(A,1,k.transform.tileZoom),u_pixel_coord_upper:[q>>16,le>>16],u_pixel_coord_lower:[65535&q,65535&le]}}(h,g,o,f),{u_matrix:m,u_opacity:t}),Ks={fillExtrusion:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_lightpos:new s.aP(m,t.u_lightpos),u_lightintensity:new s.aM(m,t.u_lightintensity),u_lightcolor:new s.aP(m,t.u_lightcolor),u_vertical_gradient:new s.aM(m,t.u_vertical_gradient),u_opacity:new s.aM(m,t.u_opacity)}),fillExtrusionPattern:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_lightpos:new s.aP(m,t.u_lightpos),u_lightintensity:new s.aM(m,t.u_lightintensity),u_lightcolor:new s.aP(m,t.u_lightcolor),u_vertical_gradient:new s.aM(m,t.u_vertical_gradient),u_height_factor:new s.aM(m,t.u_height_factor),u_image:new s.aL(m,t.u_image),u_texsize:new s.aQ(m,t.u_texsize),u_pixel_coord_upper:new s.aQ(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(m,t.u_pixel_coord_lower),u_scale:new s.aP(m,t.u_scale),u_fade:new s.aM(m,t.u_fade),u_opacity:new s.aM(m,t.u_opacity)}),fill:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix)}),fillPattern:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_image:new s.aL(m,t.u_image),u_texsize:new s.aQ(m,t.u_texsize),u_pixel_coord_upper:new s.aQ(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(m,t.u_pixel_coord_lower),u_scale:new s.aP(m,t.u_scale),u_fade:new s.aM(m,t.u_fade)}),fillOutline:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_world:new s.aQ(m,t.u_world)}),fillOutlinePattern:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_world:new s.aQ(m,t.u_world),u_image:new s.aL(m,t.u_image),u_texsize:new s.aQ(m,t.u_texsize),u_pixel_coord_upper:new s.aQ(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(m,t.u_pixel_coord_lower),u_scale:new s.aP(m,t.u_scale),u_fade:new s.aM(m,t.u_fade)}),circle:(m,t)=>({u_camera_to_center_distance:new s.aM(m,t.u_camera_to_center_distance),u_scale_with_map:new s.aL(m,t.u_scale_with_map),u_pitch_with_map:new s.aL(m,t.u_pitch_with_map),u_extrude_scale:new s.aQ(m,t.u_extrude_scale),u_device_pixel_ratio:new s.aM(m,t.u_device_pixel_ratio),u_matrix:new s.aN(m,t.u_matrix)}),collisionBox:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_camera_to_center_distance:new s.aM(m,t.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(m,t.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(m,t.u_extrude_scale),u_overscale_factor:new s.aM(m,t.u_overscale_factor)}),collisionCircle:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_inv_matrix:new s.aN(m,t.u_inv_matrix),u_camera_to_center_distance:new s.aM(m,t.u_camera_to_center_distance),u_viewport_size:new s.aQ(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new s.aR(m,t.u_color),u_matrix:new s.aN(m,t.u_matrix),u_overlay:new s.aL(m,t.u_overlay),u_overlay_scale:new s.aM(m,t.u_overlay_scale)}),clippingMask:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix)}),heatmap:(m,t)=>({u_extrude_scale:new s.aM(m,t.u_extrude_scale),u_intensity:new s.aM(m,t.u_intensity),u_matrix:new s.aN(m,t.u_matrix)}),heatmapTexture:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_world:new s.aQ(m,t.u_world),u_image:new s.aL(m,t.u_image),u_color_ramp:new s.aL(m,t.u_color_ramp),u_opacity:new s.aM(m,t.u_opacity)}),hillshade:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_image:new s.aL(m,t.u_image),u_latrange:new s.aQ(m,t.u_latrange),u_light:new s.aQ(m,t.u_light),u_shadow:new s.aR(m,t.u_shadow),u_highlight:new s.aR(m,t.u_highlight),u_accent:new s.aR(m,t.u_accent)}),hillshadePrepare:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_image:new s.aL(m,t.u_image),u_dimension:new s.aQ(m,t.u_dimension),u_zoom:new s.aM(m,t.u_zoom),u_unpack:new s.aO(m,t.u_unpack)}),line:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_ratio:new s.aM(m,t.u_ratio),u_device_pixel_ratio:new s.aM(m,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_ratio:new s.aM(m,t.u_ratio),u_device_pixel_ratio:new s.aM(m,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(m,t.u_units_to_pixels),u_image:new s.aL(m,t.u_image),u_image_height:new s.aM(m,t.u_image_height)}),linePattern:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_texsize:new s.aQ(m,t.u_texsize),u_ratio:new s.aM(m,t.u_ratio),u_device_pixel_ratio:new s.aM(m,t.u_device_pixel_ratio),u_image:new s.aL(m,t.u_image),u_units_to_pixels:new s.aQ(m,t.u_units_to_pixels),u_scale:new s.aP(m,t.u_scale),u_fade:new s.aM(m,t.u_fade)}),lineSDF:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_ratio:new s.aM(m,t.u_ratio),u_device_pixel_ratio:new s.aM(m,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(m,t.u_units_to_pixels),u_patternscale_a:new s.aQ(m,t.u_patternscale_a),u_patternscale_b:new s.aQ(m,t.u_patternscale_b),u_sdfgamma:new s.aM(m,t.u_sdfgamma),u_image:new s.aL(m,t.u_image),u_tex_y_a:new s.aM(m,t.u_tex_y_a),u_tex_y_b:new s.aM(m,t.u_tex_y_b),u_mix:new s.aM(m,t.u_mix)}),raster:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_tl_parent:new s.aQ(m,t.u_tl_parent),u_scale_parent:new s.aM(m,t.u_scale_parent),u_buffer_scale:new s.aM(m,t.u_buffer_scale),u_fade_t:new s.aM(m,t.u_fade_t),u_opacity:new s.aM(m,t.u_opacity),u_image0:new s.aL(m,t.u_image0),u_image1:new s.aL(m,t.u_image1),u_brightness_low:new s.aM(m,t.u_brightness_low),u_brightness_high:new s.aM(m,t.u_brightness_high),u_saturation_factor:new s.aM(m,t.u_saturation_factor),u_contrast_factor:new s.aM(m,t.u_contrast_factor),u_spin_weights:new s.aP(m,t.u_spin_weights)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new s.aL(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(m,t.u_is_size_feature_constant),u_size_t:new s.aM(m,t.u_size_t),u_size:new s.aM(m,t.u_size),u_camera_to_center_distance:new s.aM(m,t.u_camera_to_center_distance),u_pitch:new s.aM(m,t.u_pitch),u_rotate_symbol:new s.aL(m,t.u_rotate_symbol),u_aspect_ratio:new s.aM(m,t.u_aspect_ratio),u_fade_change:new s.aM(m,t.u_fade_change),u_matrix:new s.aN(m,t.u_matrix),u_label_plane_matrix:new s.aN(m,t.u_label_plane_matrix),u_coord_matrix:new s.aN(m,t.u_coord_matrix),u_is_text:new s.aL(m,t.u_is_text),u_pitch_with_map:new s.aL(m,t.u_pitch_with_map),u_texsize:new s.aQ(m,t.u_texsize),u_texture:new s.aL(m,t.u_texture)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new s.aL(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(m,t.u_is_size_feature_constant),u_size_t:new s.aM(m,t.u_size_t),u_size:new s.aM(m,t.u_size),u_camera_to_center_distance:new s.aM(m,t.u_camera_to_center_distance),u_pitch:new s.aM(m,t.u_pitch),u_rotate_symbol:new s.aL(m,t.u_rotate_symbol),u_aspect_ratio:new s.aM(m,t.u_aspect_ratio),u_fade_change:new s.aM(m,t.u_fade_change),u_matrix:new s.aN(m,t.u_matrix),u_label_plane_matrix:new s.aN(m,t.u_label_plane_matrix),u_coord_matrix:new s.aN(m,t.u_coord_matrix),u_is_text:new s.aL(m,t.u_is_text),u_pitch_with_map:new s.aL(m,t.u_pitch_with_map),u_texsize:new s.aQ(m,t.u_texsize),u_texture:new s.aL(m,t.u_texture),u_gamma_scale:new s.aM(m,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(m,t.u_device_pixel_ratio),u_is_halo:new s.aL(m,t.u_is_halo)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new s.aL(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(m,t.u_is_size_feature_constant),u_size_t:new s.aM(m,t.u_size_t),u_size:new s.aM(m,t.u_size),u_camera_to_center_distance:new s.aM(m,t.u_camera_to_center_distance),u_pitch:new s.aM(m,t.u_pitch),u_rotate_symbol:new s.aL(m,t.u_rotate_symbol),u_aspect_ratio:new s.aM(m,t.u_aspect_ratio),u_fade_change:new s.aM(m,t.u_fade_change),u_matrix:new s.aN(m,t.u_matrix),u_label_plane_matrix:new s.aN(m,t.u_label_plane_matrix),u_coord_matrix:new s.aN(m,t.u_coord_matrix),u_is_text:new s.aL(m,t.u_is_text),u_pitch_with_map:new s.aL(m,t.u_pitch_with_map),u_texsize:new s.aQ(m,t.u_texsize),u_texsize_icon:new s.aQ(m,t.u_texsize_icon),u_texture:new s.aL(m,t.u_texture),u_texture_icon:new s.aL(m,t.u_texture_icon),u_gamma_scale:new s.aM(m,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(m,t.u_device_pixel_ratio),u_is_halo:new s.aL(m,t.u_is_halo)}),background:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_opacity:new s.aM(m,t.u_opacity),u_color:new s.aR(m,t.u_color)}),backgroundPattern:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_opacity:new s.aM(m,t.u_opacity),u_image:new s.aL(m,t.u_image),u_pattern_tl_a:new s.aQ(m,t.u_pattern_tl_a),u_pattern_br_a:new s.aQ(m,t.u_pattern_br_a),u_pattern_tl_b:new s.aQ(m,t.u_pattern_tl_b),u_pattern_br_b:new s.aQ(m,t.u_pattern_br_b),u_texsize:new s.aQ(m,t.u_texsize),u_mix:new s.aM(m,t.u_mix),u_pattern_size_a:new s.aQ(m,t.u_pattern_size_a),u_pattern_size_b:new s.aQ(m,t.u_pattern_size_b),u_scale_a:new s.aM(m,t.u_scale_a),u_scale_b:new s.aM(m,t.u_scale_b),u_pixel_coord_upper:new s.aQ(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_texture:new s.aL(m,t.u_texture),u_ele_delta:new s.aM(m,t.u_ele_delta)}),terrainDepth:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_ele_delta:new s.aM(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_matrix:new s.aN(m,t.u_matrix),u_texture:new s.aL(m,t.u_texture),u_terrain_coords_id:new s.aM(m,t.u_terrain_coords_id),u_ele_delta:new s.aM(m,t.u_ele_delta)})};class Js{constructor(t,o,h){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ys{constructor(t,o,h,f){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=f,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let h=0;h<this.attributes.length;h++){const f=o.attributes[this.attributes[h].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,o,h){for(let f=0;f<this.attributes.length;f++){const g=this.attributes[f],x=o.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[vs[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ko=new WeakMap;function fo(m){var t;if(Ko.has(m))return Ko.get(m);{const o=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ko.set(m,o),o}}class ri{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qs extends ri{getDefault(){return s.aT.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sn extends ri{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class an extends ri{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ka extends ri{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ea extends ri{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ta extends ri{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ja extends ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ya extends ri{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ia extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Qa extends ri{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class el extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class ra extends ri{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ic extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Mc extends ri{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Jo extends ri{getDefault(){return s.aT.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wu extends ri{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Hu extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class $u extends ri{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ku extends ri{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ju extends ri{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Yu extends ri{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class tl extends ri{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class na extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class il extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class rl extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Yo extends ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Cc extends ri{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ac extends ri{getDefault(){return null}set(t){var o;if(t===this.current&&!this.dirty)return;const h=this.gl;fo(h)?h.bindVertexArray(t):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class nl extends ri{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Mo extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ec extends ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class po extends ri{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Qo extends po{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pc extends po{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ol extends po{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class pi{constructor(t,o,h,f,g){this.context=t,this.width=o,this.height=h;const x=t.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Qo(t,w),f)this.depthAttachment=g?new ol(t,w):new Pc(t,w);else if(g)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&t.deleteRenderbuffer(h)}t.deleteFramebuffer(this.framebuffer)}}class Fi{constructor(t,o,h){this.blendFunction=t,this.blendColor=o,this.mask=h}}Fi.Replace=[1,0],Fi.disabled=new Fi(Fi.Replace,s.aT.transparent,[!1,!1,!1,!1]),Fi.unblended=new Fi(Fi.Replace,s.aT.transparent,[!0,!0,!0,!0]),Fi.alphaBlended=new Fi([1,771],s.aT.transparent,[!0,!0,!0,!0]);class Qu{constructor(t){var o,h;if(this.gl=t,this.clearColor=new Qs(this),this.clearDepth=new sn(this),this.clearStencil=new an(this),this.colorMask=new Ka(this),this.depthMask=new ea(this),this.stencilMask=new ta(this),this.stencilFunc=new Ja(this),this.stencilOp=new Ya(this),this.stencilTest=new ia(this),this.depthRange=new Qa(this),this.depthTest=new el(this),this.depthFunc=new ra(this),this.blend=new Ic(this),this.blendFunc=new Mc(this),this.blendColor=new Jo(this),this.blendEquation=new Wu(this),this.cullFace=new Hu(this),this.cullFaceSide=new $u(this),this.frontFace=new Ku(this),this.program=new Ju(this),this.activeTexture=new Yu(this),this.viewport=new tl(this),this.bindFramebuffer=new na(this),this.bindRenderbuffer=new il(this),this.bindTexture=new rl(this),this.bindVertexBuffer=new Yo(this),this.bindElementBuffer=new Cc(this),this.bindVertexArray=new Ac(this),this.pixelStoreUnpack=new nl(this),this.pixelStoreUnpackPremultiplyAlpha=new Mo(this),this.pixelStoreUnpackFlipY=new Ec(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),fo(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=t.RGBA16F)!==null&&o!==void 0?o:f==null?void 0:f.RGBA16F_EXT,this.RGB16F=(h=t.RGB16F)!==null&&h!==void 0?h:f==null?void 0:f.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f==null?void 0:f.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new Js(this,t,o)}createVertexBuffer(t,o,h){return new Ys(this,t,o,h)}createRenderbuffer(t,o,h){const f=this.gl,g=f.createRenderbuffer();return this.bindRenderbuffer.set(g),f.renderbufferStorage(f.RENDERBUFFER,t,o,h),this.bindRenderbuffer.set(null),g}createFramebuffer(t,o,h,f){return new pi(this,t,o,h,f)}clear({color:t,depth:o,stencil:h}){const f=this.gl;let g=0;t&&(g|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(g|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(g|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),f.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.aG(t.blendFunction,Fi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return fo(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var o;return fo(this.gl)?this.gl.deleteVertexArray(t):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class ni{constructor(t,o,h){this.func=t,this.mask=o,this.range=h}}ni.ReadOnly=!1,ni.ReadWrite=!0,ni.disabled=new ni(519,ni.ReadOnly,[0,1]);const Co=7680;class Ri{constructor(t,o,h,f,g,x){this.test=t,this.ref=o,this.mask=h,this.fail=f,this.depthFail=g,this.pass=x}}Ri.disabled=new Ri({func:519,mask:0},0,0,Co,Co,Co);class Li{constructor(t,o,h){this.enable=t,this.mode=o,this.frontFace=h}}let bs;function zc(m,t,o,h,f,g,x){const w=m.context,k=w.gl,A=m.useProgram("collisionBox"),P=[];let z=0,O=0;for(let Q=0;Q<h.length;Q++){const ue=h[Q],ke=t.getTile(ue),Me=ke.getBucket(o);if(!Me)continue;let Re=ue.posMatrix;f[0]===0&&f[1]===0||(Re=m.translatePosMatrix(ue.posMatrix,ke,f,g));const Ze=x?Me.textCollisionBox:Me.iconCollisionBox,Ve=Me.collisionCircleArray;if(Ve.length>0){const Ke=s.Z(),mt=Re;s.aU(Ke,Me.placementInvProjMatrix,m.transform.glCoordMatrix),s.aU(Ke,Ke,Me.placementViewportMatrix),P.push({circleArray:Ve,circleOffset:O,transform:mt,invTransform:Ke,coord:ue}),z+=Ve.length/4,O=z}Ze&&A.draw(w,k.LINES,ni.disabled,Ri.disabled,m.colorModeForRenderPass(),Li.disabled,Ga(Re,m.transform,ke),m.style.map.terrain&&m.style.map.terrain.getTerrainData(ue),o.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,m.transform.zoom,null,null,Ze.collisionVertexBuffer)}if(!x||!P.length)return;const X=m.useProgram("collisionCircle"),G=new s.aV;G.resize(4*z),G._trim();let $=0;for(const Q of P)for(let ue=0;ue<Q.circleArray.length/4;ue++){const ke=4*ue,Me=Q.circleArray[ke+0],Re=Q.circleArray[ke+1],Ze=Q.circleArray[ke+2],Ve=Q.circleArray[ke+3];G.emplace($++,Me,Re,Ze,Ve,0),G.emplace($++,Me,Re,Ze,Ve,1),G.emplace($++,Me,Re,Ze,Ve,2),G.emplace($++,Me,Re,Ze,Ve,3)}(!bs||bs.length<2*z)&&(bs=function(Q){const ue=2*Q,ke=new s.aX;ke.resize(ue),ke._trim();for(let Me=0;Me<ue;Me++){const Re=6*Me;ke.uint16[Re+0]=4*Me+0,ke.uint16[Re+1]=4*Me+1,ke.uint16[Re+2]=4*Me+2,ke.uint16[Re+3]=4*Me+2,ke.uint16[Re+4]=4*Me+3,ke.uint16[Re+5]=4*Me+0}return ke}(z));const q=w.createIndexBuffer(bs,!0),le=w.createVertexBuffer(G,s.aW.members,!0);for(const Q of P){const ue={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};X.draw(w,k.TRIANGLES,ni.disabled,Ri.disabled,m.colorModeForRenderPass(),Li.disabled,ue,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q.coord),o.id,le,q,s.S.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;le.destroy(),q.destroy()}Li.disabled=new Li(!1,1029,2305),Li.backCCW=new Li(!0,1029,2305);const sl=s.ao(new Float32Array(16));function oa(m,t,o,h,f,g){const{horizontalAlign:x,verticalAlign:w}=s.au(m);return new s.P((-(x-.5)*t/f+h[0])*g,(-(w-.5)*o/f+h[1])*g)}function sa(m,t,o,h,f,g,x,w,k,A,P){const z=m.text.placedSymbolArray,O=m.text.dynamicLayoutVertexArray,X=m.icon.dynamicLayoutVertexArray,G={};O.clear();for(let $=0;$<z.length;$++){const q=z.get($),le=q.hidden||!q.crossTileID||m.allowVerticalPlacement&&!q.placedOrientation?null:h[q.crossTileID];if(le){const xe=new s.P(q.anchorX,q.anchorY),Q=qi(xe,o?x:g,P),ue=To(f.cameraToCenterDistance,Q.signedDistanceFromCamera);let ke=s.aj(m.textSizeData,k,q)*ue/s.ap;o&&(ke*=m.tilePixelRatio/w);const{width:Me,height:Re,anchor:Ze,textOffset:Ve,textBoxScale:Ke}=le,mt=oa(Ze,Me,Re,Ve,Ke,ke),Yt=o?qi(xe.add(mt),g,P).point:Q.point.add(t?mt.rotate(-f.angle):mt),nt=m.allowVerticalPlacement&&q.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Ct=0;Ct<q.numGlyphs;Ct++)s.ak(O,Yt,nt);A&&q.associatedIconIndex>=0&&(G[q.associatedIconIndex]={shiftedAnchor:Yt,angle:nt})}else U(q.numGlyphs,O)}if(A){X.clear();const $=m.icon.placedSymbolArray;for(let q=0;q<$.length;q++){const le=$.get(q);if(le.hidden)U(le.numGlyphs,X);else{const xe=G[q];if(xe)for(let Q=0;Q<le.numGlyphs;Q++)s.ak(X,xe.shiftedAnchor,xe.angle);else U(le.numGlyphs,X)}}m.icon.dynamicLayoutVertexBuffer.updateData(X)}m.text.dynamicLayoutVertexBuffer.updateData(O)}function al(m,t,o){return o.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function aa(m,t,o,h,f,g,x,w,k,A,P,z){const O=m.context,X=O.gl,G=m.transform,$=w==="map",q=k==="map",le=w!=="viewport"&&o.layout.get("symbol-placement")!=="point",xe=$&&!q&&!le,Q=!o.layout.get("symbol-sort-key").isConstant();let ue=!1;const ke=m.depthModeForSublayer(0,ni.ReadOnly),Me=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[];for(const Ze of h){const Ve=t.getTile(Ze),Ke=Ve.getBucket(o);if(!Ke)continue;const mt=f?Ke.text:Ke.icon;if(!mt||!mt.segments.get().length||!mt.hasVisibleVertices)continue;const Yt=mt.programConfigurations.get(o.id),nt=f||Ke.sdfIcons,Ct=f?Ke.textSizeData:Ke.iconSizeData,gt=q||G.pitch!==0,bi=m.useProgram(al(nt,f,Ke),Yt),Jt=s.ah(Ct,G.zoom),Zt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ze);let Qt,Ki,Ci,Sr,lr=[0,0],er=null;if(f)Ki=Ve.glyphAtlasTexture,Ci=X.LINEAR,Qt=Ve.glyphAtlasTexture.size,Ke.iconsInText&&(lr=Ve.imageAtlasTexture.size,er=Ve.imageAtlasTexture,Sr=gt||m.options.rotating||m.options.zooming||Ct.kind==="composite"||Ct.kind==="camera"?X.LINEAR:X.NEAREST);else{const Ji=o.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;Ki=Ve.imageAtlasTexture,Ci=nt||m.options.rotating||m.options.zooming||Ji||gt?X.LINEAR:X.NEAREST,Qt=Ve.imageAtlasTexture.size}const un=se(Ve,1,m.transform.zoom),Ei=Qe(Ze.posMatrix,q,$,m.transform,un),Vn=Rn(Ze.posMatrix,q,$,m.transform,un),Un=Me&&Ke.hasTextData(),go=o.layout.get("icon-text-fit")!=="none"&&Un&&Ke.hasIconData();if(le){const Ji=m.style.map.terrain?(Gr,Yi)=>m.style.map.terrain.getElevation(Ze,Gr,Yi):null,cr=o.layout.get("text-rotation-alignment")==="map";rt(Ke,Ze.posMatrix,m,f,Ei,Vn,q,A,cr,Ji)}const Lo=m.translatePosMatrix(Ze.posMatrix,Ve,g,x),ss=le||f&&Me||go?sl:Ei,Ar=m.translatePosMatrix(Vn,Ve,g,x,!0),Tr=nt&&o.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Rr;Rr=nt?Ke.iconsInText?Io(Ct.kind,Jt,xe,q,m,Lo,ss,Ar,Qt,lr):$a(Ct.kind,Jt,xe,q,m,Lo,ss,Ar,f,Qt,!0):Ha(Ct.kind,Jt,xe,q,m,Lo,ss,Ar,f,Qt);const Do={program:bi,buffers:mt,uniformValues:Rr,atlasTexture:Ki,atlasTextureIcon:er,atlasInterpolation:Ci,atlasInterpolationIcon:Sr,isSDF:nt,hasHalo:Tr};if(Q&&Ke.canOverlap){ue=!0;const Ji=mt.segments.get();for(const cr of Ji)Re.push({segments:new s.S([cr]),sortKey:cr.sortKey,state:Do,terrainData:Zt})}else Re.push({segments:mt.segments,sortKey:0,state:Do,terrainData:Zt})}ue&&Re.sort((Ze,Ve)=>Ze.sortKey-Ve.sortKey);for(const Ze of Re){const Ve=Ze.state;if(O.activeTexture.set(X.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,X.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(O.activeTexture.set(X.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Ve.isSDF){const Ke=Ve.uniformValues;Ve.hasHalo&&(Ke.u_is_halo=1,ll(Ve.buffers,Ze.segments,o,m,Ve.program,ke,P,z,Ke,Ze.terrainData)),Ke.u_is_halo=0}ll(Ve.buffers,Ze.segments,o,m,Ve.program,ke,P,z,Ve.uniformValues,Ze.terrainData)}}function ll(m,t,o,h,f,g,x,w,k,A){const P=h.context;f.draw(P,P.gl.TRIANGLES,g,x,w,Li.disabled,k,A,o.id,m.layoutVertexBuffer,m.indexBuffer,t,o.paint,h.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function xs(m,t,o,h,f){if(!o||!h||!h.imageAtlas)return;const g=h.imageAtlas.patternPositions;let x=g[o.to.toString()],w=g[o.from.toString()];if(!x&&w&&(x=w),!w&&x&&(w=x),!x||!w){const k=f.getPaintProperty(t);x=g[k],w=g[k]}x&&w&&m.setConstantPatternPositions(x,w)}function ws(m,t,o,h,f,g,x){const w=m.context.gl,k="fill-pattern",A=o.paint.get(k),P=A&&A.constantOr(1),z=o.getCrossfadeParameters();let O,X,G,$,q;x?(X=P&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=w.LINES):(X=P?"fillPattern":"fill",O=w.TRIANGLES);const le=A.constantOr(null);for(const xe of h){const Q=t.getTile(xe);if(P&&!Q.patternsLoaded())continue;const ue=Q.getBucket(o);if(!ue)continue;const ke=ue.programConfigurations.get(o.id),Me=m.useProgram(X,ke),Re=m.style.map.terrain&&m.style.map.terrain.getTerrainData(xe);P&&(m.context.activeTexture.set(w.TEXTURE0),Q.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ke.updatePaintBuffers(z)),xs(ke,k,le,Q,o);const Ze=Re?xe:null,Ve=m.translatePosMatrix(Ze?Ze.posMatrix:xe.posMatrix,Q,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(x){$=ue.indexBuffer2,q=ue.segments2;const Ke=[w.drawingBufferWidth,w.drawingBufferHeight];G=X==="fillOutlinePattern"&&P?Ws(Ve,m,z,Q,Ke):Xs(Ve,Ke)}else $=ue.indexBuffer,q=ue.segments,G=P?Za(Ve,m,z,Q):vc(Ve);Me.draw(m.context,O,f,m.stencilModeForClipping(xe),g,Li.disabled,G,Re,o.id,ue.layoutVertexBuffer,$,q,o.paint,m.transform.zoom,ke)}}function Ss(m,t,o,h,f,g,x){const w=m.context,k=w.gl,A="fill-extrusion-pattern",P=o.paint.get(A),z=P.constantOr(1),O=o.getCrossfadeParameters(),X=o.paint.get("fill-extrusion-opacity"),G=P.constantOr(null);for(const $ of h){const q=t.getTile($),le=q.getBucket(o);if(!le)continue;const xe=m.style.map.terrain&&m.style.map.terrain.getTerrainData($),Q=le.programConfigurations.get(o.id),ue=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",Q);z&&(m.context.activeTexture.set(k.TEXTURE0),q.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Q.updatePaintBuffers(O)),xs(Q,A,G,q,o);const ke=m.translatePosMatrix($.posMatrix,q,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Me=o.paint.get("fill-extrusion-vertical-gradient"),Re=z?uo(ke,m,Me,X,$,O,q):qa(ke,m,Me,X);ue.draw(w,w.gl.TRIANGLES,f,g,x,Li.backCCW,Re,xe,o.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,o.paint,m.transform.zoom,Q,m.style.map.terrain&&le.centroidVertexBuffer)}}function eh(m,t,o,h,f,g,x){const w=m.context,k=w.gl,A=o.fbo;if(!A)return;const P=m.useProgram("hillshade"),z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(t);w.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,A.colorAttachment.get()),P.draw(w,k.TRIANGLES,f,g,x,Li.disabled,((O,X,G,$)=>{const q=G.paint.get("hillshade-shadow-color"),le=G.paint.get("hillshade-highlight-color"),xe=G.paint.get("hillshade-accent-color");let Q=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=O.transform.angle);const ue=!O.options.moving;return{u_matrix:$?$.posMatrix:O.transform.calculatePosMatrix(X.tileID.toUnwrapped(),ue),u_image:0,u_latrange:Xa(0,X.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Q],u_shadow:q,u_highlight:le,u_accent:xe}})(m,o,h,z?t:null),z,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function cl(m,t,o,h,f,g){const x=m.context,w=x.gl,k=t.dem;if(k&&k.data){const A=k.dim,P=k.stride,z=k.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||m.getTileTexture(P),t.demTexture){const X=t.demTexture;X.update(z,{premultiply:!1}),X.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new je(x,z,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let O=t.fbo;if(!O){const X=new je(x,{width:A,height:A,data:null},w.RGBA);X.bind(w.LINEAR,w.CLAMP_TO_EDGE),O=t.fbo=x.createFramebuffer(A,A,!0,!1),O.colorAttachment.set(X.texture)}x.bindFramebuffer.set(O.framebuffer),x.viewport.set([0,0,A,A]),m.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,h,f,g,Li.disabled,((X,G)=>{const $=G.stride,q=s.Z();return s.aS(q,0,s.N,-s.N,0,0,1),s.$(q,q,[0,-s.N,0]),{u_matrix:q,u_image:1,u_dimension:[$,$],u_zoom:X.overscaledZ,u_unpack:G.getUnpackVector()}})(t.tileID,k),null,o.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function th(m,t,o,h,f,g){const x=h.paint.get("raster-fade-duration");if(!g&&x>0){const w=s.h.now(),k=(w-m.timeAdded)/x,A=t?(w-t.timeAdded)/x:-1,P=o.getSource(),z=f.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),X=O&&m.refreshedUponExpiration?1:s.ad(O?k:1-A,0,1);return m.refreshedUponExpiration&&k>=1&&(m.refreshedUponExpiration=!1),t?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const Lc=new s.aT(1,0,0,1),la=new s.aT(0,1,0,1),ul=new s.aT(0,0,1,1),Dc=new s.aT(1,0,1,1),Bc=new s.aT(0,1,1,1);function Ts(m,t,o,h){ua(m,0,t+o/2,m.transform.width,o,h)}function ca(m,t,o,h){ua(m,t-o/2,0,o,m.transform.height,h)}function ua(m,t,o,h,f,g){const x=m.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*m.pixelRatio,o*m.pixelRatio,h*m.pixelRatio,f*m.pixelRatio),x.clear({color:g}),w.disable(w.SCISSOR_TEST)}function Fc(m,t,o){const h=m.context,f=h.gl,g=o.posMatrix,x=m.useProgram("debug"),w=ni.disabled,k=Ri.disabled,A=m.colorModeForRenderPass(),P="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);h.activeTexture.set(f.TEXTURE0);const O=t.getTileByID(o.key).latestRawTileData,X=Math.floor((O&&O.byteLength||0)/1024),G=t.getTile(o).tileSize,$=512/Math.min(G,512)*(o.overscaledZ/m.transform.zoom)*.5;let q=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(q+=` => ${o.overscaledZ}`),function(le,xe){le.initDebugOverlayCanvas();const Q=le.debugOverlayCanvas,ue=le.context.gl,ke=le.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,Q.width,Q.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(xe,5,5),ke.strokeText(xe,5,5),le.debugOverlayTexture.update(Q),le.debugOverlayTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}(m,`${q} ${X}kB`),x.draw(h,f.TRIANGLES,w,k,Fi.alphaBlended,Li.disabled,ys(g,s.aT.transparent,$),null,P,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),x.draw(h,f.LINE_STRIP,w,k,A,Li.disabled,ys(g,s.aT.red),z,P,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Gi(m,t,o){const h=m.context,f=h.gl,g=m.colorModeForRenderPass(),x=new ni(f.LEQUAL,ni.ReadWrite,m.depthRangeFor3D),w=m.useProgram("terrain"),k=t.getTerrainMesh();h.bindFramebuffer.set(null),h.viewport.set([0,0,m.width,m.height]);for(const A of o){const P=m.renderToTexture.getTexture(A),z=t.getTerrainData(A.tileID);h.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,P.texture);const O={u_matrix:m.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(m.transform.zoom)};w.draw(h,f.TRIANGLES,x,Ri.disabled,g,Li.backCCW,O,z,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class Ao{constructor(t,o){this.context=new Qu(t),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=br.maxUnderzooming+br.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qs}resize(t,o,h){if(this.width=Math.floor(t*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,o=new s.a_;o.emplaceBack(0,0),o.emplaceBack(s.N,0),o.emplaceBack(0,s.N),o.emplaceBack(s.N,s.N),this.tileExtentBuffer=t.createVertexBuffer(o,Zs.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const h=new s.a_;h.emplaceBack(0,0),h.emplaceBack(s.N,0),h.emplaceBack(0,s.N),h.emplaceBack(s.N,s.N),this.debugBuffer=t.createVertexBuffer(h,Zs.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const f=new s.V;f.emplaceBack(0,0,0,0),f.emplaceBack(s.N,0,s.N,0),f.emplaceBack(0,s.N,0,s.N),f.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=t.createVertexBuffer(f,Ut.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const g=new s.a_;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,Zs.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const x=new s.a$;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const k=this.context.gl;this.stencilClearMode=new Ri({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=s.Z();s.aS(h,0,this.width,this.height,0,0,1),s.a0(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,o.TRIANGLES,ni.disabled,this.stencilClearMode,Fi.disabled,Li.disabled,bc(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,o){if(this.currentStencilSource===t.source||!t.isTileClipped()||!o||!o.length)return;this.currentStencilSource=t.source;const h=this.context,f=h.gl;this.nextStencilID+o.length>256&&this.clearStencil(),h.setColorMode(Fi.disabled),h.setDepthMode(ni.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of o){const w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);g.draw(h,f.TRIANGLES,ni.disabled,new Ri({func:f.ALWAYS,mask:0},w,255,f.KEEP,f.KEEP,f.REPLACE),Fi.disabled,Li.disabled,bc(x.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new Ri({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){const o=this.context.gl;return new Ri({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,h=t.sort((x,w)=>w.overscaledZ-x.overscaledZ),f=h[h.length-1].overscaledZ,g=h[0].overscaledZ-f+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let w=0;w<g;w++)x[w+f]=new Ri({func:o.GEQUAL,mask:255},w+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=g,[x,h]}return[{[f]:Ri.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Fi([t.CONSTANT_COLOR,t.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fi.unblended:Fi.alphaBlended}depthModeForSublayer(t,o,h){if(!this.opaquePassEnabledForLayer())return ni.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ni(h||this.context.gl.LEQUAL,o,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){this.style=t,this.options=o,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const h=this.style._order,f=this.style.sourceCaches,g={},x={},w={};for(const k in f){const A=f[k];A.used&&A.prepare(this.context),g[k]=A.getVisibleCoordinates(),x[k]=g[k].slice().reverse(),w[k]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<h.length;k++)if(this.style._layers[h[k]].is3D()){this.opaquePassCutoff=k;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const k=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,P){const z=A.context,O=z.gl,X=Fi.unblended,G=new ni(O.LEQUAL,ni.ReadWrite,[0,1]),$=P.getTerrainMesh(),q=P.sourceCache.getRenderableTiles(),le=A.useProgram("terrainDepth");z.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1});for(const xe of q){const Q=P.getTerrainData(xe.tileID),ue={u_matrix:A.transform.calculatePosMatrix(xe.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};le.draw(z,O.TRIANGLES,G,Ri.disabled,X,Li.backCCW,ue,Q,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,P){const z=A.context,O=z.gl,X=Fi.unblended,G=new ni(O.LEQUAL,ni.ReadWrite,[0,1]),$=P.getTerrainMesh(),q=P.getCoordsTexture(),le=P.sourceCache.getRenderableTiles(),xe=A.useProgram("terrainCoords");z.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1}),P.coordsIndex=[];for(const Q of le){const ue=P.getTerrainData(Q.tileID);z.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,q.texture);const ke={u_matrix:A.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};xe.draw(z,O.TRIANGLES,G,Ri.disabled,X,Li.backCCW,ke,ue,"terrain",$.vertexBuffer,$.indexBuffer,$.segments),P.coordsIndex.push(Q.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const k of h){const A=this.style._layers[k];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const P=x[A.source];(A.type==="custom"||P.length)&&this.renderLayer(this,f[A.source],A,P)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[h[this.currentLayer]],A=f[k.source],P=g[k.source];this._renderTileClippingMasks(k,P),this.renderLayer(this,A,k,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const k=this.style._layers[h[this.currentLayer]],A=f[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const P=(k.type==="symbol"?w:x)[k.source];this._renderTileClippingMasks(k,g[k.source]),this.renderLayer(this,A,k,P)}if(this.options.showTileBoundaries){const k=function(A,P){let z=null;const O=Object.values(A._layers).flatMap(q=>q.source&&!q.isHidden(P)?[A.sourceCaches[q.source]]:[]),X=O.filter(q=>q.getSource().type==="vector"),G=O.filter(q=>q.getSource().type!=="vector"),$=q=>{(!z||z.getSource().maxzoom<q.getSource().maxzoom)&&(z=q)};return X.forEach(q=>$(q)),z||G.forEach(q=>$(q)),z}(this.style,this.transform.zoom);k&&function(A,P,z){for(let O=0;O<z.length;O++)Fc(A,P,z[O])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const A=k.transform.padding;Ts(k,k.transform.height-(A.top||0),3,Lc),Ts(k,A.bottom||0,3,la),ca(k,A.left||0,3,ul),ca(k,k.transform.width-(A.right||0),3,Dc);const P=k.transform.centerPoint;(function(z,O,X,G){ua(z,O-1,X-10,2,20,G),ua(z,O-10,X-1,20,2,G)})(k,P.x,k.transform.height-P.y,Bc)}(this),this.context.setDefault()}renderLayer(t,o,h,f){if(!h.isHidden(this.transform.zoom)&&(h.type==="background"||h.type==="custom"||(f||[]).length))switch(this.id=h.id,h.type){case"symbol":(function(g,x,w,k,A){if(g.renderPass!=="translucent")return;const P=Ri.disabled,z=g.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,X,G,$,q,le,xe){const Q=X.transform,ue=q==="map",ke=le==="map";for(const Me of O){const Re=$.getTile(Me),Ze=Re.getBucket(G);if(!Ze||!Ze.text||!Ze.text.segments.get().length)continue;const Ve=s.ah(Ze.textSizeData,Q.zoom),Ke=se(Re,1,X.transform.zoom),mt=Qe(Me.posMatrix,ke,ue,X.transform,Ke),Yt=G.layout.get("icon-text-fit")!=="none"&&Ze.hasIconData();if(Ve){const nt=Math.pow(2,Q.zoom-Re.tileID.overscaledZ);sa(Ze,ue,ke,xe,Q,mt,Me.posMatrix,nt,Ve,Yt,X.style.map.terrain?(Ct,gt)=>X.style.map.terrain.getElevation(Me,Ct,gt):null)}}}(k,g,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&aa(g,x,w,k,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),P,z),w.paint.get("text-opacity").constantOr(1)!==0&&aa(g,x,w,k,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),P,z),x.map.showCollisionBoxes&&(zc(g,x,w,k,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),zc(g,x,w,k,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,o,h,f,this.style.placement.variableOffsets);break;case"circle":(function(g,x,w,k){if(g.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),P=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),O=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(P.constantOr(1)===0||z.constantOr(1)===0))return;const X=g.context,G=X.gl,$=g.depthModeForSublayer(0,ni.ReadOnly),q=Ri.disabled,le=g.colorModeForRenderPass(),xe=[];for(let Q=0;Q<k.length;Q++){const ue=k[Q],ke=x.getTile(ue),Me=ke.getBucket(w);if(!Me)continue;const Re=Me.programConfigurations.get(w.id),Ze=g.useProgram("circle",Re),Ve=Me.layoutVertexBuffer,Ke=Me.indexBuffer,mt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ue),Yt={programConfiguration:Re,program:Ze,layoutVertexBuffer:Ve,indexBuffer:Ke,uniformValues:ho(g,ue,ke,w),terrainData:mt};if(O){const nt=Me.segments.get();for(const Ct of nt)xe.push({segments:new s.S([Ct]),sortKey:Ct.sortKey,state:Yt})}else xe.push({segments:Me.segments,sortKey:0,state:Yt})}O&&xe.sort((Q,ue)=>Q.sortKey-ue.sortKey);for(const Q of xe){const{programConfiguration:ue,program:ke,layoutVertexBuffer:Me,indexBuffer:Re,uniformValues:Ze,terrainData:Ve}=Q.state;ke.draw(X,G.TRIANGLES,$,q,le,Li.disabled,Ze,Ve,w.id,Me,Re,Q.segments,w.paint,g.transform.zoom,ue)}})(t,o,h,f);break;case"heatmap":(function(g,x,w,k){if(w.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const A=g.context,P=A.gl,z=Ri.disabled,O=new Fi([P.ONE,P.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(X,G,$){const q=X.gl;X.activeTexture.set(q.TEXTURE1),X.viewport.set([0,0,G.width/4,G.height/4]);let le=$.heatmapFbo;if(le)q.bindTexture(q.TEXTURE_2D,le.colorAttachment.get()),X.bindFramebuffer.set(le.framebuffer);else{const xe=q.createTexture();q.bindTexture(q.TEXTURE_2D,xe),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),le=$.heatmapFbo=X.createFramebuffer(G.width/4,G.height/4,!1,!1),function(Q,ue,ke,Me){var Re,Ze;const Ve=Q.gl,Ke=(Re=Q.HALF_FLOAT)!==null&&Re!==void 0?Re:Ve.UNSIGNED_BYTE,mt=(Ze=Q.RGBA16F)!==null&&Ze!==void 0?Ze:Ve.RGBA;Ve.texImage2D(Ve.TEXTURE_2D,0,mt,ue.width/4,ue.height/4,0,Ve.RGBA,Ke,null),Me.colorAttachment.set(ke)}(X,G,xe,le)}})(A,g,w),A.clear({color:s.aT.transparent});for(let X=0;X<k.length;X++){const G=k[X];if(x.hasRenderableParent(G))continue;const $=x.getTile(G),q=$.getBucket(w);if(!q)continue;const le=q.programConfigurations.get(w.id),xe=g.useProgram("heatmap",le),{zoom:Q}=g.transform;xe.draw(A,P.TRIANGLES,ni.disabled,z,O,Li.disabled,Gu(G.posMatrix,$,Q,w.paint.get("heatmap-intensity")),null,w.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,w.paint,g.transform.zoom,le)}A.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(A,P){const z=A.context,O=z.gl,X=P.heatmapFbo;if(!X)return;z.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,X.colorAttachment.get()),z.activeTexture.set(O.TEXTURE1);let G=P.colorRampTexture;G||(G=P.colorRampTexture=new je(z,P.colorRamp,O.RGBA)),G.bind(O.LINEAR,O.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(z,O.TRIANGLES,ni.disabled,Ri.disabled,A.colorModeForRenderPass(),Li.disabled,(($,q,le,xe)=>{const Q=s.Z();s.aS(Q,0,$.width,$.height,0,0,1);const ue=$.context.gl;return{u_matrix:Q,u_world:[ue.drawingBufferWidth,ue.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(A,P),null,P.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,P.paint,A.transform.zoom)}(g,w))})(t,o,h,f);break;case"line":(function(g,x,w,k){if(g.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),P=w.paint.get("line-width");if(A.constantOr(1)===0||P.constantOr(1)===0)return;const z=g.depthModeForSublayer(0,ni.ReadOnly),O=g.colorModeForRenderPass(),X=w.paint.get("line-dasharray"),G=w.paint.get("line-pattern"),$=G.constantOr(1),q=w.paint.get("line-gradient"),le=w.getCrossfadeParameters(),xe=$?"linePattern":X?"lineSDF":q?"lineGradient":"line",Q=g.context,ue=Q.gl;let ke=!0;for(const Me of k){const Re=x.getTile(Me);if($&&!Re.patternsLoaded())continue;const Ze=Re.getBucket(w);if(!Ze)continue;const Ve=Ze.programConfigurations.get(w.id),Ke=g.context.program.get(),mt=g.useProgram(xe,Ve),Yt=ke||mt.program!==Ke,nt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Me),Ct=G.constantOr(null);if(Ct&&Re.imageAtlas){const Jt=Re.imageAtlas,Zt=Jt.patternPositions[Ct.to.toString()],Qt=Jt.patternPositions[Ct.from.toString()];Zt&&Qt&&Ve.setConstantPatternPositions(Zt,Qt)}const gt=nt?Me:null,bi=$?Xu(g,Re,w,le,gt):X?wc(g,Re,w,X,le,gt):q?xc(g,Re,w,Ze.lineClipsArray.length,gt):Wa(g,Re,w,gt);if($)Q.activeTexture.set(ue.TEXTURE0),Re.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),Ve.updatePaintBuffers(le);else if(X&&(Yt||g.lineAtlas.dirty))Q.activeTexture.set(ue.TEXTURE0),g.lineAtlas.bind(Q);else if(q){const Jt=Ze.gradients[w.id];let Zt=Jt.texture;if(w.gradientVersion!==Jt.version){let Qt=256;if(w.stepInterpolant){const Ki=x.getSource().maxzoom,Ci=Me.canonical.z===Ki?Math.ceil(1<<g.transform.maxZoom-Me.canonical.z):1;Qt=s.ad(s.aY(Ze.maxLineLength/s.N*1024*Ci),256,Q.maxTextureSize)}Jt.gradient=s.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Qt,image:Jt.gradient||void 0,clips:Ze.lineClipsArray}),Jt.texture?Jt.texture.update(Jt.gradient):Jt.texture=new je(Q,Jt.gradient,ue.RGBA),Jt.version=w.gradientVersion,Zt=Jt.texture}Q.activeTexture.set(ue.TEXTURE0),Zt.bind(w.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}mt.draw(Q,ue.TRIANGLES,z,g.stencilModeForClipping(Me),O,Li.disabled,bi,nt,w.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,w.paint,g.transform.zoom,Ve,Ze.layoutVertexBuffer2),ke=!1}})(t,o,h,f);break;case"fill":(function(g,x,w,k){const A=w.paint.get("fill-color"),P=w.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const z=g.colorModeForRenderPass(),O=w.paint.get("fill-pattern"),X=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&A.constantOr(s.aT.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===X){const G=g.depthModeForSublayer(1,g.renderPass==="opaque"?ni.ReadWrite:ni.ReadOnly);ws(g,x,w,k,G,z,!1)}if(g.renderPass==="translucent"&&w.paint.get("fill-antialias")){const G=g.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ni.ReadOnly);ws(g,x,w,k,G,z,!0)}})(t,o,h,f);break;case"fill-extrusion":(function(g,x,w,k){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&g.renderPass==="translucent"){const P=new ni(g.context.gl.LEQUAL,ni.ReadWrite,g.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Ss(g,x,w,k,P,Ri.disabled,Fi.disabled),Ss(g,x,w,k,P,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const z=g.colorModeForRenderPass();Ss(g,x,w,k,P,Ri.disabled,z)}}})(t,o,h,f);break;case"hillshade":(function(g,x,w,k){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const A=g.context,P=g.depthModeForSublayer(0,ni.ReadOnly),z=g.colorModeForRenderPass(),[O,X]=g.renderPass==="translucent"?g.stencilConfigForOverlap(k):[{},k];for(const G of X){const $=x.getTile(G);$.needsHillshadePrepare!==void 0&&$.needsHillshadePrepare&&g.renderPass==="offscreen"?cl(g,$,w,P,Ri.disabled,z):g.renderPass==="translucent"&&eh(g,G,$,w,P,O[G.overscaledZ],z)}A.viewport.set([0,0,g.width,g.height])})(t,o,h,f);break;case"raster":(function(g,x,w,k){if(g.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!k.length)return;const A=g.context,P=A.gl,z=x.getSource(),O=g.useProgram("raster"),X=g.colorModeForRenderPass(),[G,$]=z instanceof jt?[{},k]:g.stencilConfigForOverlap(k),q=$[$.length-1].overscaledZ,le=!g.options.moving;for(const xe of $){const Q=g.depthModeForSublayer(xe.overscaledZ-q,w.paint.get("raster-opacity")===1?ni.ReadWrite:ni.ReadOnly,P.LESS),ue=x.getTile(xe);ue.registerFadeDuration(w.paint.get("raster-fade-duration"));const ke=x.findLoadedParent(xe,0),Me=th(ue,ke,x,w,g.transform,g.style.map.terrain);let Re,Ze;const Ve=w.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;A.activeTexture.set(P.TEXTURE0),ue.texture.bind(Ve,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(P.TEXTURE1),ke?(ke.texture.bind(Ve,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,ke.tileID.overscaledZ-ue.tileID.overscaledZ),Ze=[ue.tileID.canonical.x*Re%1,ue.tileID.canonical.y*Re%1]):ue.texture.bind(Ve,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const Ke=g.style.map.terrain&&g.style.map.terrain.getTerrainData(xe),mt=Ke?xe:null,Yt=mt?mt.posMatrix:g.transform.calculatePosMatrix(xe.toUnwrapped(),le),nt=Tc(Yt,Ze||[0,0],Re||1,Me,w);z instanceof jt?O.draw(A,P.TRIANGLES,Q,Ri.disabled,X,Li.disabled,nt,Ke,w.id,z.boundsBuffer,g.quadTriangleIndexBuffer,z.boundsSegments):O.draw(A,P.TRIANGLES,Q,G[xe.overscaledZ],X,Li.disabled,nt,Ke,w.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}})(t,o,h,f);break;case"background":(function(g,x,w,k){const A=w.paint.get("background-color"),P=w.paint.get("background-opacity");if(P===0)return;const z=g.context,O=z.gl,X=g.transform,G=X.tileSize,$=w.paint.get("background-pattern");if(g.isPatternMissing($))return;const q=!$&&A.a===1&&P===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==q)return;const le=Ri.disabled,xe=g.depthModeForSublayer(0,q==="opaque"?ni.ReadWrite:ni.ReadOnly),Q=g.colorModeForRenderPass(),ue=g.useProgram($?"backgroundPattern":"background"),ke=k||X.coveringTiles({tileSize:G,terrain:g.style.map.terrain});$&&(z.activeTexture.set(O.TEXTURE0),g.imageManager.bind(g.context));const Me=w.getCrossfadeParameters();for(const Re of ke){const Ze=k?Re.posMatrix:g.transform.calculatePosMatrix(Re.toUnwrapped()),Ve=$?bn(Ze,P,g,$,{tileID:Re,tileSize:G},Me):$s(Ze,P,A),Ke=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Re);ue.draw(z,O.TRIANGLES,xe,le,Q,Li.disabled,Ve,Ke,w.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}})(t,0,h,f);break;case"custom":(function(g,x,w){const k=g.context,A=w.implementation;if(g.renderPass==="offscreen"){const P=A.prerender;P&&(g.setCustomLayerDefaults(),k.setColorMode(g.colorModeForRenderPass()),P.call(A,k.gl,g.transform.customLayerMatrix()),k.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),k.setColorMode(g.colorModeForRenderPass()),k.setStencilMode(Ri.disabled);const P=A.renderingMode==="3d"?new ni(g.context.gl.LEQUAL,ni.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,ni.ReadOnly);k.setDepthMode(P),A.render(k.gl,g.transform.customLayerMatrix()),k.setDirty(),g.setBaseState(),k.bindFramebuffer.set(null)}})(t,0,h)}}translatePosMatrix(t,o,h,f,g){if(!h[0]&&!h[1])return t;const x=g?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(x){const A=Math.sin(x),P=Math.cos(x);h=[h[0]*P-h[1]*A,h[0]*A+h[1]*P]}const w=[g?h[0]:se(o,h[0],this.transform.zoom),g?h[1]:se(o,h[1],this.transform.zoom),0],k=new Float32Array(16);return s.$(k,t,w),k}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),h=this.imageManager.getPattern(t.to.toString());return!o||!h}useProgram(t,o){this.cache=this.cache||{};const h=t+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new Gs(this.context,Bi[t],o,Ks[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new je(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:o}=this.context.gl;return this.width!==t||this.height!==o}}class qr{constructor(t,o){this.points=t,this.planes=o}static fromInvProjectionMatrix(t,o,h){const f=Math.pow(2,h),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const k=1/(w=s.ag([],w,t))[3]/o*f;return s.b3(w,w,[k,k,1/w[3],k])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const k=function(O,X){var G=X[0],$=X[1],q=X[2],le=G*G+$*$+q*q;return le>0&&(le=1/Math.sqrt(le)),O[0]=X[0]*le,O[1]=X[1]*le,O[2]=X[2]*le,O}([],function(O,X,G){var $=X[0],q=X[1],le=X[2],xe=G[0],Q=G[1],ue=G[2];return O[0]=q*ue-le*Q,O[1]=le*xe-$*ue,O[2]=$*Q-q*xe,O}([],ze([],g[w[0]],g[w[1]]),ze([],g[w[2]],g[w[1]]))),A=-((P=k)[0]*(z=g[w[1]])[0]+P[1]*z[1]+P[2]*z[2]);var P,z;return k.concat(A)});return new qr(g,x)}}class es{constructor(t,o){this.min=t,this.max=o,this.center=function(h,f,g){return h[0]=.5*f[0],h[1]=.5*f[1],h[2]=.5*f[2],h}([],function(h,f,g){return h[0]=f[0]+g[0],h[1]=f[1]+g[1],h[2]=f[2]+g[2],h}([],this.min,this.max))}quadrant(t){const o=[t%2==0,t<2],h=re(this.min),f=re(this.max);for(let g=0;g<o.length;g++)h[g]=o[g]?this.min[g]:this.center[g],f[g]=o[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new es(h,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let f=0;f<t.planes.length;f++){const g=t.planes[f];let x=0;for(let w=0;w<o.length;w++)s.b4(g,o[w])>=0&&x++;if(x===0)return 0;x!==o.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const k=t.points[w][f]-this.min[f];g=Math.min(g,k),x=Math.max(x,k)}if(x<0||g>this.max[f]-this.min[f])return 0}return 1}}class ks{constructor(t=0,o=0,h=0,f=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=h,this.right=f}interpolate(t,o,h){return o.top!=null&&t.top!=null&&(this.top=s.B.number(t.top,o.top,h)),o.bottom!=null&&t.bottom!=null&&(this.bottom=s.B.number(t.bottom,o.bottom,h)),o.left!=null&&t.left!=null&&(this.left=s.B.number(t.left,o.left,h)),o.right!=null&&t.right!=null&&(this.right=s.B.number(t.right,o.right,h)),this}getCenter(t,o){const h=s.ad((this.left+t-this.right)/2,0,t),f=s.ad((this.top+o-this.bottom)/2,0,o);return new s.P(h,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ks(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ha{constructor(t,o,h,f,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ks,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new ha(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const o=-s.b5(t,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var h=new s.A(4);return s.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}(),function(h,f,g){var x=f[0],w=f[1],k=f[2],A=f[3],P=Math.sin(g),z=Math.cos(g);h[0]=x*z+k*P,h[1]=w*z+A*P,h[2]=x*-P+k*z,h[3]=w*-P+A*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=s.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,h){this._unmodified=!1,this._edgeInsets.interpolate(t,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new s.b6(0,t)];if(this._renderWorldCopies){const h=this.pointCoordinate(new s.P(0,0)),f=this.pointCoordinate(new s.P(this.width,0)),g=this.pointCoordinate(new s.P(this.width,this.height)),x=this.pointCoordinate(new s.P(0,this.height)),w=Math.floor(Math.min(h.x,f.x,g.x,x.x)),k=Math.floor(Math.max(h.x,f.x,g.x,x.x)),A=1;for(let P=w-A;P<=k+A;P++)P!==0&&o.push(new s.b6(P,t))}return o}coveringTiles(t){var o,h;let f=this.coveringZoomLevel(t);const g=f;if(t.minzoom!==void 0&&f<t.minzoom)return[];t.maxzoom!==void 0&&f>t.maxzoom&&(f=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),w=s.U.fromLngLat(this.center),k=Math.pow(2,f),A=[k*x.x,k*x.y,0],P=[k*w.x,k*w.y,0],z=qr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let O=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=f);const X=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,G=Q=>({aabb:new es([Q*k,0,0],[(Q+1)*k,k,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),$=[],q=[],le=f,xe=t.reparseOverscaled?g:f;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)$.push(G(-Q)),$.push(G(Q));for($.push(G(0));$.length>0;){const Q=$.pop(),ue=Q.x,ke=Q.y;let Me=Q.fullyVisible;if(!Me){const mt=Q.aabb.intersects(z);if(mt===0)continue;Me=mt===2}const Re=t.terrain?A:P,Ze=Q.aabb.distanceX(Re),Ve=Q.aabb.distanceY(Re),Ke=Math.max(Math.abs(Ze),Math.abs(Ve));if(Q.zoom===le||Ke>X+(1<<le-Q.zoom)-2&&Q.zoom>=O){const mt=le-Q.zoom,Yt=A[0]-.5-(ue<<mt),nt=A[1]-.5-(ke<<mt);q.push({tileID:new s.O(Q.zoom===le?xe:Q.zoom,Q.wrap,Q.zoom,ue,ke),distanceSq:Ce([P[0]-.5-ue,P[1]-.5-ke]),tileDistanceToCamera:Math.sqrt(Yt*Yt+nt*nt)})}else for(let mt=0;mt<4;mt++){const Yt=(ue<<1)+mt%2,nt=(ke<<1)+(mt>>1),Ct=Q.zoom+1;let gt=Q.aabb.quadrant(mt);if(t.terrain){const bi=new s.O(Ct,Q.wrap,Ct,Yt,nt),Jt=t.terrain.getMinMaxElevation(bi),Zt=(o=Jt.minElevation)!==null&&o!==void 0?o:this.elevation,Qt=(h=Jt.maxElevation)!==null&&h!==void 0?h:this.elevation;gt=new es([gt.min[0],gt.min[1],Zt],[gt.max[0],gt.max[1],Qt])}$.push({aabb:gt,zoom:Ct,x:Yt,y:nt,wrap:Q.wrap,fullyVisible:Me})}}return q.sort((Q,ue)=>Q.distanceSq-ue.distanceSq).map(Q=>Q.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=s.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(t.lng)*this.worldSize,s.H(o)*this.worldSize)}unproject(t){return new s.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const o=this.pointLocation(this.centerPoint,t),h=t.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-h))return;const f=this.getCameraPosition(),g=s.U.fromLngLat(f.lngLat,f.altitude),x=s.U.fromLngLat(o,h),w=g.x-x.x,k=g.y-x.y,A=g.z-x.z,P=Math.sqrt(w*w+k*k+A*A),z=this.scaleZoom(this.cameraToCenterDistance/P/this.tileSize);this._elevation=h,this._center=o,this.zoom=z}setLocationAtPoint(t,o){const h=this.pointCoordinate(o),f=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),x=new s.U(g.x-(h.x-f.x),g.y-(h.y-f.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,o){return o?this.coordinatePoint(this.locationCoordinate(t),o.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,o){return this.coordinateLocation(this.pointCoordinate(t,o))}locationCoordinate(t){return s.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,o){if(o){const O=o.pointCoordinate(t);if(O!=null)return O}const h=[t.x,t.y,0,1],f=[t.x,t.y,1,1];s.ag(h,h,this.pixelMatrixInverse),s.ag(f,f,this.pixelMatrixInverse);const g=h[3],x=f[3],w=h[1]/g,k=f[1]/x,A=h[2]/g,P=f[2]/x,z=A===P?0:(0-A)/(P-A);return new s.U(s.B.number(h[0]/g,f[0]/x,z)/this.worldSize,s.B.number(w,k,z)/this.worldSize)}coordinatePoint(t,o=0,h=this.pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,o,1];return s.ag(f,f,h),new s.P(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Xt().extend(this.pointLocation(new s.P(0,t))).extend(this.pointLocation(new s.P(this.width,t))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Xt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,o=!1){const h=t.key,f=o?this._alignedPosMatrixCache:this._posMatrixCache;if(f[h])return f[h];const g=t.canonical,x=this.worldSize/this.zoomScale(g.z),w=g.x+Math.pow(2,g.z)*t.wrap,k=s.ao(new Float64Array(16));return s.$(k,k,[w*x,g.y*x,0]),s.a0(k,k,[x/s.N,x/s.N,1]),s.a1(k,o?this.alignedProjMatrix:this.projMatrix,k),f[h]=new Float32Array(k),f[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,o,h,f,g=-90,x=90,w=-180,k=180;const A=this.size,P=this._unmodified;if(this.latRange){const X=this.latRange;g=s.H(X[1])*this.worldSize,x=s.H(X[0])*this.worldSize,t=x-g<A.y?A.y/(x-g):0}if(this.lngRange){const X=this.lngRange;w=s.b5(s.G(X[0])*this.worldSize,0,this.worldSize),k=s.b5(s.G(X[1])*this.worldSize,0,this.worldSize),k<w&&(k+=this.worldSize),o=k-w<A.x?A.x/(k-w):0}const z=this.point,O=Math.max(o||0,t||0);if(O)return this.center=this.unproject(new s.P(o?(k+w)/2:z.x,t?(x+g)/2:z.y)),this.zoom+=this.scaleZoom(O),this._unmodified=P,void(this._constraining=!1);if(this.latRange){const X=z.y,G=A.y/2;X-G<g&&(f=g+G),X+G>x&&(f=x-G)}if(this.lngRange){const X=(w+k)/2,G=s.b5(z.x,X-this.worldSize/2,X+this.worldSize/2),$=A.x/2;G-$<w&&(h=w+$),G+$>k&&(h=k-$)}h===void 0&&f===void 0||(this.center=this.unproject(new s.P(h!==void 0?h:z.x,f!==void 0?f:z.y)).wrap()),this._unmodified=P,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let f=s.ao(new Float64Array(16));s.a0(f,f,[this.width/2,-this.height/2,1]),s.$(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=s.ao(new Float64Array(16)),s.a0(f,f,[1,-1,1]),s.$(f,f,[-1,-1,0]),s.a0(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f;const g=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=g-x*this._pixelPerMeter/Math.cos(this._pitch),k=x<0?w:g,A=Math.PI/2+this._pitch,P=this._fov*(.5+t.y/this.height),z=Math.sin(P)*k/Math.sin(s.ad(Math.PI-A-P,.01,Math.PI-.01)),O=this.getHorizon(),X=2*Math.atan(O/this.cameraToCenterDistance)*(.5+t.y/(2*O)),G=Math.sin(X)*k/Math.sin(s.ad(Math.PI-A-X,.01,Math.PI-.01)),$=Math.min(z,G),q=1.01*(Math.cos(Math.PI/2-this._pitch)*$+k),le=this.height/50;f=new Float64Array(16),s.b8(f,this._fov,this.width/this.height,le,q),f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,s.a0(f,f,[1,-1,1]),s.$(f,f,[0,0,-this.cameraToCenterDistance]),s.b9(f,f,this._pitch),s.ae(f,f,this.angle),s.$(f,f,[-o,-h,0]),this.mercatorMatrix=s.a0([],f,[this.worldSize,this.worldSize,this.worldSize]),s.a0(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,f),s.$(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=s.as([],f),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,f);const xe=this.width%2/2,Q=this.height%2/2,ue=Math.cos(this.angle),ke=Math.sin(this.angle),Me=o-Math.round(o)+ue*xe+ke*Q,Re=h-Math.round(h)+ue*Q+ke*xe,Ze=new Float64Array(f);if(s.$(Ze,Ze,[Me>.5?Me-1:Me,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ze,f=s.as(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new s.P(0,0)),o=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.ag(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}getCameraQueryGeometry(t){const o=this.getCameraPoint();if(t.length===1)return[t[0],o];{let h=o.x,f=o.y,g=o.x,x=o.y;for(const w of t)h=Math.min(h,w.x),f=Math.min(f,w.y),g=Math.max(g,w.x),x=Math.max(x,w.y);return[new s.P(h,f),new s.P(g,f),new s.P(g,x),new s.P(h,x),new s.P(h,f)]}}}function Eo(m,t){let o,h=!1,f=null,g=null;const x=()=>{f=null,h&&(m.apply(g,o),f=setTimeout(x,t),h=!1)};return(...w)=>(h=!0,g=this,o=w,f||x(),f)}class Is{constructor(t){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(h=f)}),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=Eo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,f),x=Math.round(o.lng*g)/g,w=Math.round(o.lat*g)/g,k=this._map.getBearing(),A=this._map.getPitch();let P="";if(P+=t?`/${x}/${w}/${h}`:`${h}/${w}/${x}`,(k||A)&&(P+="/"+Math.round(10*k)/10),A&&(P+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let O=!1;const X=window.location.hash.slice(1).split("&").map(G=>{const $=G.split("=")[0];return $===z?(O=!0,`${$}=${P}`):G}).filter(G=>G);return O||X.push(`${z}=${P}`),`#${X.join("&")}`}return`#${P}`}}const ts={linearity:.3,easing:s.ba(0,0,.3,1)},Rc=s.e({deceleration:2500,maxSpeed:1400},ts),Oc=s.e({deceleration:20,maxSpeed:1400},ts),Nc=s.e({deceleration:1e3,maxSpeed:360},ts),Vc=s.e({deceleration:1e3,maxSpeed:90},ts);class Uc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=s.h.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)o.zoom+=g.zoomDelta||0,o.bearing+=g.bearingDelta||0,o.pitch+=g.pitchDelta||0,g.panDelta&&o.pan._add(g.panDelta),g.around&&(o.around=g.around),g.pinchAround&&(o.pinchAround=g.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(o.pan.mag()){const g=Ms(o.pan.mag(),h,s.e({},Rc,t||{}));f.offset=o.pan.mult(g.amount/o.pan.mag()),f.center=this._map.transform.center,Nn(f,g)}if(o.zoom){const g=Ms(o.zoom,h,Oc);f.zoom=this._map.transform.zoom+g.amount,Nn(f,g)}if(o.bearing){const g=Ms(o.bearing,h,Nc);f.bearing=this._map.transform.bearing+s.ad(g.amount,-179,179),Nn(f,g)}if(o.pitch){const g=Ms(o.pitch,h,Vc);f.pitch=this._map.transform.pitch+g.amount,Nn(f,g)}if(f.zoom||f.bearing){const g=o.pinchAround===void 0?o.around:o.pinchAround;f.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),s.e(f,{noMoveStart:!0})}}function Nn(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Ms(m,t,o){const{maxSpeed:h,linearity:f,deceleration:g}=o,x=s.ad(m*f/(t/1e3),-h,h),w=Math.abs(x)/(g*f);return{easing:o.easing,duration:1e3*w,amount:x*(w/2)}}class ln extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,h,f={}){const g=M.mousePos(o.getCanvasContainer(),h),x=o.unproject(g);super(t,s.e({point:g,lngLat:x,originalEvent:h},f)),this._defaultPrevented=!1,this.target=o}}class Cs extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,h){const f=t==="touchend"?h.changedTouches:h.touches,g=M.touchPos(o.getCanvasContainer(),f),x=g.map(k=>o.unproject(k)),w=g.reduce((k,A,P,z)=>k.add(A.div(z.length)),new s.P(0,0));super(t,{points:g,point:w,lngLats:x,lngLat:o.unproject(w),originalEvent:h}),this._defaultPrevented=!1}}class jc extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,h){super(t,{originalEvent:h}),this._defaultPrevented=!1}}class qc{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new jc(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new ln(t.type,this._map,t))}mouseup(t){this._map.fire(new ln(t.type,this._map,t))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new ln(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ln(t.type,this._map,t))}mouseover(t){this._map.fire(new ln(t.type,this._map,t))}mouseout(t){this._map.fire(new ln(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Cs(t.type,this._map,t))}touchmove(t){this._map.fire(new Cs(t.type,this._map,t))}touchend(t){this._map.fire(new Cs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Cs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ln(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ln(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(s.P.convert(t),this._map.terrain)}}class Gc{constructor(t,o){this._map=t,this._tr=new Qn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(M.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=h,this._box||(this._box=M.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(f.x,h.x),x=Math.max(f.x,h.x),w=Math.min(f.y,h.y),k=Math.max(f.y,h.y);M.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=x-g+"px",this._box.style.height=k-w+"px"}mouseupWindow(t,o){if(!this._active||t.button!==0)return;const h=this._startPos,f=o;if(this.reset(),M.suppressClick(),h.x!==f.x||h.y!==f.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(h,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(M.remove(this._box),this._box=null),M.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new s.k(t,{originalEvent:o}))}}function xn(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const o={};for(let h=0;h<m.length;h++)o[m[h].identifier]=t[h];return o}class eo{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){const g=new s.P(0,0);for(const x of f)g._add(x);return g.div(f.length)}(o),this.touches=xn(h,o)))}touchmove(t,o,h){if(this.aborted||!this.centroid)return;const f=xn(h,o);for(const g in this.touches){const x=f[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,o,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class da{constructor(t){this.singleTap=new eo(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,o,h){this.singleTap.touchstart(t,o,h)}touchmove(t,o,h){this.singleTap.touchmove(t,o,h)}touchend(t,o,h){const f=this.singleTap.touchend(t,o,h);if(f){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(f)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class to{constructor(t){this._tr=new Qn(t),this._zoomIn=new da({numTouches:1,numTaps:2}),this._zoomOut=new da({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,h){this._zoomIn.touchstart(t,o,h),this._zoomOut.touchstart(t,o,h)}touchmove(t,o,h){this._zoomIn.touchmove(t,o,h),this._zoomOut.touchmove(t,o,h)}touchend(t,o,h){const f=this._zoomIn.touchend(t,o,h),g=this._zoomOut.touchend(t,o,h),x=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(f)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class io{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const o=this._moveFunction(...t);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(t,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,o){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=o.length?o[0]:o;return!this._moved&&f.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(h,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&M.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ih={0:1,2:2};class hl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const o=M.mouseButton(t);this._eventButton=o}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(o,h){const f=ih[h];return o.buttons===void 0||(o.buttons&f)!==f}(t,this._eventButton)}isValidEndEvent(t){return M.mouseButton(t)===this._eventButton}}class Xc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const fa=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=function(t){t.preventDefault()}},is=({enable:m,clickTolerance:t,bearingDegreesPerPixelMoved:o=.8})=>{const h=new hl({checkCorrectEvent:f=>M.mouseButton(f)===0&&f.ctrlKey||M.mouseButton(f)===2});return new io({clickTolerance:t,move:(f,g)=>({bearingDelta:(g.x-f.x)*o}),moveStateManager:h,enable:m,assignEvents:fa})},ro=({enable:m,clickTolerance:t,pitchDegreesPerPixelMoved:o=-.5})=>{const h=new hl({checkCorrectEvent:f=>M.mouseButton(f)===0&&f.ctrlKey||M.mouseButton(f)===2});return new io({clickTolerance:t,move:(f,g)=>({pitchDelta:(g.y-f.y)*o}),moveStateManager:h,enable:m,assignEvents:fa})};class ht{constructor(t,o){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,o,h){return this._calculateTransform(t,o,h)}touchmove(t,o,h){if(this._map._cooperativeGestures&&(this._minTouches===2&&h.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,h.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(h.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,o,h)}touchend(t,o,h){this._calculateTransform(t,o,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,h){h.length>0&&(this._active=!0);const f=xn(h,o),g=new s.P(0,0),x=new s.P(0,0);let w=0;for(const A in f){const P=f[A],z=this._touches[A];z&&(g._add(P),x._add(P.sub(z)),w++,f[A]=P)}if(this._touches=f,w<this._minTouches||!x.mag())return;const k=x.div(w);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,h){if(!this._firstTwoTouches)return;t.preventDefault();const[f,g]=this._firstTwoTouches,x=mo(h,o,f),w=mo(h,o,g);if(!x||!w)return;const k=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],k,t)}touchend(t,o,h){if(!this._firstTwoTouches)return;const[f,g]=this._firstTwoTouches,x=mo(h,o,f),w=mo(h,o,g);x&&w||(this._active&&M.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mo(m,t,o){for(let h=0;h<m.length;h++)if(m[h].identifier===o)return t[h]}function rs(m,t){return Math.log(m/t)/Math.LN2}class Wc extends pa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(rs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rs(this._distance,h),pinchAround:o}}}function lt(m,t){return 180*m.angleWith(t)/Math.PI}class dl extends pa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:lt(this._vector,h),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,h=lt(t,this._startVector);return Math.abs(h)<o}}function fl(m){return Math.abs(m.y)>Math.abs(m.x)}class rh extends pa{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,o,h){super.touchstart(t,o,h),this._currentTouchCount=h.length}_start(t){this._lastPoints=t,fl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,h){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,g,h.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,o,h){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,g=o.mag()>=2;if(!f&&!g)return;if(!f||!g)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=t.y>0==o.y>0;return fl(t)&&fl(o)&&x}}const pl={panStep:100,bearingStep:15,pitchStep:10};class Hc{constructor(t){this._tr=new Qn(t);const o=pl;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,h=0,f=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:w=>{const k=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:$c,zoom:o?Math.round(k.zoom)+o*(t.shiftKey?2:1):k.zoom,bearing:k.bearing+h*this._bearingStep,pitch:k.pitch+f*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:k.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $c(m){return m*(2-m)}const Kc=4.000244140625;class nh{constructor(t,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=t,this._tr=new Qn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=s.h.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Kc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=M.mousePos(this._el,t),h=this._tr;this._around=s.L.convert(this._aroundCenter?h.center:h.unproject(o)),this._aroundPoint=h.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Kc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&k!==0&&(k=1/k);const A=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(A*k))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,h=this._startZoom,f=this._easing;let g,x=!1;if(this._type==="wheel"&&h&&f){const w=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),k=f(w);g=s.B.number(h,o,k),w<1?this._frameId||(this._frameId=!0):x=!0}else g=o,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=s.bb;if(this._prevEase){const h=this._prevEase,f=(s.h.now()-h.start)/h.duration,g=h.easing(f+.01)-h.easing(f),x=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-x*x);o=s.ba(x,w,.25,1)}return this._prevEase={start:s.h.now(),duration:t,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ml{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _l{constructor(t){this._tr=new Qn(t),this.reset()}reset(){this._active=!1}dblclick(t,o){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gl{constructor(){this._tap=new da({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,o,h){if(!this._swipePoint)if(this._tapTime){const f=o[0],g=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(f)<30;g&&x?h.length>0&&(this._swipePoint=f,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(t,o,h)}touchmove(t,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const f=o[0],g=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,o,h)}touchend(t,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const f=this._tap.touchend(t,o,h);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yl{constructor(t,o,h){this._el=t,this._mousePan=o,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zr{constructor(t,o,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _o{constructor(t,o,h,f){this._el=t,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const As=m=>m.zoom||m.drag||m.pitch||m.rotate;class vl extends s.k{}function Es(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class bl{constructor(t,o){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,g)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=f.type==="renderFrame"?void 0:f,w={needsRenderFrame:!1},k={},A={},P=f.touches,z=P?this._getMapTouches(P):void 0,O=z?M.touchPos(this._el,z):M.mousePos(this._el,f);for(const{handlerName:$,handler:q,allowed:le}of this._handlers){if(!q.isEnabled())continue;let xe;this._blockedByActive(A,le,$)?q.reset():q[g||f.type]&&(xe=q[g||f.type](f,O,z),this.mergeHandlerResult(w,k,xe,$,x),xe&&xe.needsRenderFrame&&this._triggerRenderFrame()),(xe||q.isActive())&&(A[$]=q)}const X={};for(const $ in this._previousActiveHandlers)A[$]||(X[$]=x);this._previousActiveHandlers=A,(Object.keys(X).length||Es(w))&&(this._changes.push([w,k,X]),this._triggerRenderFrame()),(Object.keys(A).length||Es(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=w;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Uc(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,g,x]of this._listeners)M.addEventListener(f,g,f===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,o,h]of this._listeners)M.removeEventListener(t,o,t===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(t){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new qc(o,t));const f=o.boxZoom=new Gc(o,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const g=new to(o),x=new _l(o);o.doubleClickZoom=new ml(x,g),this._add("tapZoom",g),this._add("clickZoom",x),t.interactive&&t.doubleClickZoom&&o.doubleClickZoom.enable();const w=new gl;this._add("tapDragZoom",w);const k=o.touchPitch=new rh(o);this._add("touchPitch",k),t.interactive&&t.touchPitch&&o.touchPitch.enable(t.touchPitch);const A=is(t),P=ro(t);o.dragRotate=new Zr(t,A,P),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]),t.interactive&&t.dragRotate&&o.dragRotate.enable();const z=(({enable:le,clickTolerance:xe})=>{const Q=new hl({checkCorrectEvent:ue=>M.mouseButton(ue)===0&&!ue.ctrlKey});return new io({clickTolerance:xe,move:(ue,ke)=>({around:ke,panDelta:ke.sub(ue)}),activateOnStart:!0,moveStateManager:Q,enable:le,assignEvents:fa})})(t),O=new ht(t,o);o.dragPan=new yl(h,z,O),this._add("mousePan",z),this._add("touchPan",O,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&o.dragPan.enable(t.dragPan);const X=new dl,G=new Wc;o.touchZoomRotate=new _o(h,G,X,w),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&o.touchZoomRotate.enable(t.touchZoomRotate);const $=o.scrollZoom=new nh(o,()=>this._triggerRenderFrame());this._add("scrollZoom",$,["mousePan"]),t.interactive&&t.scrollZoom&&o.scrollZoom.enable(t.scrollZoom);const q=o.keyboard=new Hc(o);this._add("keyboard",q),t.interactive&&t.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Zc(o))}_add(t,o,h){this._handlers.push({handlerName:t,handler:o,allowed:h}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!As(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,o,h){for(const f in t)if(f!==h&&(!o||o.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const o=[];for(const h of t)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(t,o,h,f,g){if(!h)return;s.e(t,h);const x={handlerName:f,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(o.zoom=x),h.panDelta!==void 0&&(o.drag=x),h.pitchDelta!==void 0&&(o.pitch=x),h.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){const t={},o={},h={};for(const[f,g,x]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),s.e(o,g),s.e(h,x);this._updateMapTransform(t,o,h),this._changes=[]}_updateMapTransform(t,o,h){const f=this._map,g=f._getTransformForUpdate(),x=f.terrain;if(!(Es(t)||x&&this._terrainMovement))return this._fireEvents(o,h,!0);let{panDelta:w,zoomDelta:k,bearingDelta:A,pitchDelta:P,around:z,pinchAround:O}=t;O!==void 0&&(z=O),f._stop(!0),z=z||f.transform.centerPoint;const X=g.pointLocation(w?z.sub(w):z);A&&(g.bearing+=A),P&&(g.pitch+=P),k&&(g.zoom+=k),x?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?g.center=g.pointLocation(g.centerPoint.sub(w)):g.setLocationAtPoint(X,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,g.setLocationAtPoint(X,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,g.recalculateZoom(f.terrain)})):g.setLocationAtPoint(X,z),f._applyUpdatedTransform(g),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,h,!0)}_fireEvents(t,o,h){const f=As(this._eventsInProgress),g=As(t),x={};for(const P in t){const{originalEvent:z}=t[P];this._eventsInProgress[P]||(x[`${P}start`]=z),this._eventsInProgress[P]=t[P]}!f&&g&&this._fireEvent("movestart",g.originalEvent);for(const P in x)this._fireEvent(P,x[P]);g&&this._fireEvent("move",g.originalEvent);for(const P in t){const{originalEvent:z}=t[P];this._fireEvent(P,z)}const w={};let k;for(const P in this._eventsInProgress){const{handlerName:z,originalEvent:O}=this._eventsInProgress[P];this._handlersById[z].isActive()||(delete this._eventsInProgress[P],k=o[z]||O,w[`${P}end`]=k)}for(const P in w)this._fireEvent(P,w[P]);const A=As(this._eventsInProgress);if(h&&(f||g)&&!A){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!P||!P.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:k})),z(this._map.getBearing())&&this._map.resetNorth()):(z(P.bearing||this._map.getBearing())&&(P.bearing=0),P.freezeElevation=!0,this._map.easeTo(P,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new s.k(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new vl("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Jc extends s.E{constructor(t,o){super(),this._renderFrameCallback=()=>{const h=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,h){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},o),h)}panTo(t,o,h){return this.easeTo(s.e({center:t},o),h)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,h){return this.easeTo(s.e({zoom:t},o),h)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,h){return this.easeTo(s.e({bearing:t},o),h)}resetNorth(t,o){return this.rotateTo(0,s.e({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=Xt.convert(t);const h=o&&o.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),h,o)}_cameraForBoxAndBearing(t,o,h,f){const g={top:0,bottom:0,right:0,left:0};if(typeof(f=s.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const ke=f.padding;f.padding={top:ke,bottom:ke,right:ke,left:ke}}f.padding=s.e(g,f.padding);const x=this.transform,w=x.padding,k=x.project(s.L.convert(t)),A=x.project(s.L.convert(o)),P=k.rotate(-h*Math.PI/180),z=A.rotate(-h*Math.PI/180),O=new s.P(Math.max(P.x,z.x),Math.max(P.y,z.y)),X=new s.P(Math.min(P.x,z.x),Math.min(P.y,z.y)),G=O.sub(X),$=(x.width-(w.left+w.right+f.padding.left+f.padding.right))/G.x,q=(x.height-(w.top+w.bottom+f.padding.top+f.padding.bottom))/G.y;if(q<0||$<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const le=Math.min(x.scaleZoom(x.scale*Math.min($,q)),f.maxZoom),xe=s.P.convert(f.offset),Q=new s.P((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(h*Math.PI/180),ue=xe.add(Q).mult(x.scale/x.zoomScale(le));return{center:x.unproject(k.add(A).div(2).sub(ue)),zoom:le,bearing:h}}fitBounds(t,o,h){return this._fitInternal(this.cameraForBounds(t,o),o,h)}fitScreenCoordinates(t,o,h,f,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(t)),this.transform.pointLocation(s.P.convert(o)),h,f),f,g)}_fitInternal(t,o,h){return t?(delete(o=s.e(t,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(t,o){this.stop();const h=this._getTransformForUpdate();let f=!1,g=!1,x=!1;return"zoom"in t&&h.zoom!==+t.zoom&&(f=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=s.L.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(g=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(x=!0,h.pitch=+t.pitch),t.padding==null||h.isPaddingEqual(t.padding)||(h.padding=t.padding),this._applyUpdatedTransform(h),this.fire(new s.k("movestart",o)).fire(new s.k("move",o)),f&&this.fire(new s.k("zoomstart",o)).fire(new s.k("zoom",o)).fire(new s.k("zoomend",o)),g&&this.fire(new s.k("rotatestart",o)).fire(new s.k("rotate",o)).fire(new s.k("rotateend",o)),x&&this.fire(new s.k("pitchstart",o)).fire(new s.k("pitch",o)).fire(new s.k("pitchend",o)),this.fire(new s.k("moveend",o))}calculateCameraOptionsFromTo(t,o,h,f=0){const g=s.U.fromLngLat(t,o),x=s.U.fromLngLat(h,f),w=x.x-g.x,k=x.y-g.y,A=x.z-g.z,P=Math.hypot(w,k,A);if(P===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,k),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),X=180*Math.atan2(w,-k)/Math.PI;let G=180*Math.acos(z/P)/Math.PI;return G=A<0?90-G:90+G,{center:x.toLngLat(),zoom:O,pitch:G,bearing:X}}easeTo(t,o){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.bb},t)).animate===!1||!t.essential&&s.h.prefersReducedMotion)&&(t.duration=0);const h=this._getTransformForUpdate(),f=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),k="zoom"in t?+t.zoom:f,A="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:h.padding,O=s.P.convert(t.offset);let X=h.centerPoint.add(O);const G=h.pointLocation(X),$=s.L.convert(t.center||G);this._normalizeCenter($);const q=h.project(G),le=h.project($).sub(q),xe=h.zoomScale(k-f);let Q,ue;t.around&&(Q=s.L.convert(t.around),ue=h.locationPoint(Q));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==f,this._rotating=this._rotating||g!==A,this._pitching=this._pitching||P!==x,this._padding=!h.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,ke),this.terrain&&this._prepareElevation($),this._ease(Me=>{if(this._zooming&&(h.zoom=s.B.number(f,k,Me)),this._rotating&&(h.bearing=s.B.number(g,A,Me)),this._pitching&&(h.pitch=s.B.number(x,P,Me)),this._padding&&(h.interpolatePadding(w,z,Me),X=h.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(Me),Q)h.setLocationAtPoint(Q,ue);else{const Re=h.zoomScale(h.zoom-f),Ze=k>f?Math.min(2,xe):Math.max(.5,xe),Ve=Math.pow(Ze,1-Me),Ke=h.unproject(q.add(le.mult(Me*Ve)).mult(Re));h.setLocationAtPoint(h.renderWorldCopies?Ke.wrap():Ke,X)}this._applyUpdatedTransform(h),this._fireMoveEvents(o)},Me=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,Me)},t),this}_prepareEase(t,o,h={}){this._moving=!0,o||h.moving||this.fire(new s.k("movestart",t)),this._zooming&&!h.zooming&&this.fire(new s.k("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new s.k("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new s.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&o!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(h-(o-(h*t+this._elevationStart))/(1-t)),this._elevationTarget=o}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const o=t.clone(),{center:h,zoom:f,pitch:g,bearing:x,elevation:w}=this.transformCameraUpdate(o);h&&(o.center=h),f!==void 0&&(o.zoom=f),g!==void 0&&(o.pitch=g),x!==void 0&&(o.bearing=x),w!==void 0&&(o.elevation=w),this.transform.apply(o)}_fireMoveEvents(t){this.fire(new s.k("move",t)),this._zooming&&this.fire(new s.k("zoom",t)),this._rotating&&this.fire(new s.k("rotate",t)),this._pitching&&this.fire(new s.k("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const h=this._zooming,f=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new s.k("zoomend",t)),f&&this.fire(new s.k("rotateend",t)),g&&this.fire(new s.k("pitchend",t)),this.fire(new s.k("moveend",t))}flyTo(t,o){if(!t.essential&&s.h.prefersReducedMotion){const gt=s.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(gt,o)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},t);const h=this._getTransformForUpdate(),f=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),k="zoom"in t?s.ad(+t.zoom,h.minZoom,h.maxZoom):f,A="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:h.padding,O=h.zoomScale(k-f),X=s.P.convert(t.offset);let G=h.centerPoint.add(X);const $=h.pointLocation(G),q=s.L.convert(t.center||$);this._normalizeCenter(q);const le=h.project($),xe=h.project(q).sub(le);let Q=t.curve;const ue=Math.max(h.width,h.height),ke=ue/O,Me=xe.mag();if("minZoom"in t){const gt=s.ad(Math.min(t.minZoom,f,k),h.minZoom,h.maxZoom),bi=ue/h.zoomScale(gt-f);Q=Math.sqrt(bi/Me*2)}const Re=Q*Q;function Ze(gt){const bi=(ke*ke-ue*ue+(gt?-1:1)*Re*Re*Me*Me)/(2*(gt?ke:ue)*Re*Me);return Math.log(Math.sqrt(bi*bi+1)-bi)}function Ve(gt){return(Math.exp(gt)-Math.exp(-gt))/2}function Ke(gt){return(Math.exp(gt)+Math.exp(-gt))/2}const mt=Ze(!1);let Yt=function(gt){return Ke(mt)/Ke(mt+Q*gt)},nt=function(gt){return ue*((Ke(mt)*(Ve(bi=mt+Q*gt)/Ke(bi))-Ve(mt))/Re)/Me;var bi},Ct=(Ze(!0)-mt)/Q;if(Math.abs(Me)<1e-6||!isFinite(Ct)){if(Math.abs(ue-ke)<1e-6)return this.easeTo(t,o);const gt=ke<ue?-1:1;Ct=Math.abs(Math.log(ke/ue))/Q,nt=function(){return 0},Yt=function(bi){return Math.exp(gt*Q*bi)}}return t.duration="duration"in t?+t.duration:1e3*Ct/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==A,this._pitching=P!==x,this._padding=!h.isPaddingEqual(z),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(q),this._ease(gt=>{const bi=gt*Ct,Jt=1/Yt(bi);h.zoom=gt===1?k:f+h.scaleZoom(Jt),this._rotating&&(h.bearing=s.B.number(g,A,gt)),this._pitching&&(h.pitch=s.B.number(x,P,gt)),this._padding&&(h.interpolatePadding(w,z,gt),G=h.centerPoint.add(X)),this.terrain&&!t.freezeElevation&&this._updateElevation(gt);const Zt=gt===1?q:h.unproject(le.add(xe.mult(nt(bi))).mult(Jt));h.setLocationAtPoint(h.renderWorldCopies?Zt.wrap():Zt,G),this._applyUpdatedTransform(h),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,o)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,o,h){h.animate===!1||h.duration===0?(t(1),o()):(this._easeStart=s.h.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,o){t=s.b5(t,-180,180);const h=Math.abs(t-o);return Math.abs(t-360-o)<h&&(t-=360),Math.abs(t+360-o)<h&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const h=t.lng-o.center.lng;t.lng+=h>180?-360:h<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class cn{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=M.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=M.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){M.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const h=this._map._getUIString(`AttributionControl.${o}`);t.title=h,t.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const o=this._map.style.sourceCaches;for(const f in o){const g=o[f];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(f=>String(f).trim()),t.sort((f,g)=>f.length-g.length),t=t.filter((f,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(f)>=0)return!1;return!0});const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ai{constructor(t={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=M.create("div","maplibregl-ctrl");const o=M.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){M.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ma{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const f of h)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const xl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Yc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Qc extends s.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,o){this.sourceCache.update(t,o),this._renderableTilesKeys=[];const h={};for(const f of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))h[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),s.aS(f.posMatrix,0,s.N,0,s.N,0,1),this._tiles[f.key]=new Lr(f,this.tileSize));for(const f in this._tiles)h[f]||delete this._tiles[f]}freeRtt(t){for(const o in this._tiles){const h=this._tiles[o];(!t||h.tileID.equals(t)||h.tileID.isChildOf(t)||t.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const o={};for(const h of this._renderableTilesKeys){const f=this._tiles[h].tileID;if(f.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),s.aS(g.posMatrix,0,s.N,0,s.N,0,1),o[h]=g}else if(f.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=f.canonical.z-t.canonical.z,w=f.canonical.x-(f.canonical.x>>x<<x),k=f.canonical.y-(f.canonical.y>>x<<x),A=s.N>>x;s.aS(g.posMatrix,0,A,0,A,0,1),s.$(g.posMatrix,g.posMatrix,[-w*A,-k*A,0]),o[h]=g}else if(t.canonical.isChildOf(f.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=t.canonical.z-f.canonical.z,w=t.canonical.x-(t.canonical.x>>x<<x),k=t.canonical.y-(t.canonical.y>>x<<x),A=s.N>>x;s.aS(g.posMatrix,0,s.N,0,s.N,0,1),s.$(g.posMatrix,g.posMatrix,[w*A,k*A,0]),s.a0(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),o[h]=g}}return o}getSourceTile(t,o){const h=this.sourceCache._source;let f=t.overscaledZ-this.deltaZoom;if(f>h.maxzoom&&(f=h.maxzoom),f<h.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&o)for(;f>=h.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(f--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=t)}}class eu{constructor(t,o,h){this.painter=t,this.sourceCache=new Qc(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,o,h,f=s.N){var g;if(!(o>=0&&o<f&&h>=0&&h<f))return 0;const x=this.getTerrainData(t),w=(g=x.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const k=function(G,$,q){var le=$[0],xe=$[1];return G[0]=q[0]*le+q[4]*xe+q[12],G[1]=q[1]*le+q[5]*xe+q[13],G}([],[o/f*s.N,h/f*s.N],x.u_terrain_matrix),A=[k[0]*w.dim,k[1]*w.dim],P=Math.floor(A[0]),z=Math.floor(A[1]),O=A[0]-P,X=A[1]-z;return w.get(P,z)*(1-O)*(1-X)+w.get(P+1,z)*O*(1-X)+w.get(P,z+1)*(1-O)*X+w.get(P+1,z+1)*O*X}getElevationForLngLatZoom(t,o){const{tileID:h,mercatorX:f,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(t,o);return this.getElevation(h,f%s.N,g%s.N,s.N)}getElevation(t,o,h,f=s.N){return this.getDEMElevation(t,o,h,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,g=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new je(f,g,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new je(f,new s.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const o=this.sourceCache.getSourceTile(t,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const f=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new je(f,o.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),o.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const h=o&&o+o.tileID.key+t.key;if(h&&!this._demMatrixCache[h]){const f=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-o.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?g=t.canonical.z-f:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>g<<g),w=t.canonical.y-(t.canonical.y>>g<<g),k=s.bc(new Float64Array(16),[1/(s.N<<g),1/(s.N<<g),0]);s.$(k,k,[x*s.N,w*s.N,0]),this._demMatrixCache[t.key]={matrix:k,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(t){const o=this.painter,h=o.width/devicePixelRatio,f=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new je(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new je(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,f,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)o[x+0]=255&w,o[x+1]=255&g,o[x+2]=w>>8<<4|g>>8,o[x+3]=0;const h=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),f=new je(t,h,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){const o=new Uint8Array(4),h=this.painter.context,f=h.gl;h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);const g=o[0]+(o[2]>>4<<8),x=o[1]+((15&o[2])<<8),w=this.coordsIndex[255-o[3]],k=w&&this.sourceCache.getTileByID(w);if(!k)return null;const A=this._coordsTextureSize,P=(1<<k.tileID.canonical.z)*A;return new s.U(this._allowMercatorOverflow(t,(k.tileID.canonical.x*A+g)/P),(k.tileID.canonical.y*A+x)/P,this.getElevation(k.tileID,g,x,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,o=new s.bd,h=new s.b0,f=this.meshSize,g=s.N/f,x=f*f;for(let z=0;z<=f;z++)for(let O=0;O<=f;O++)o.emplaceBack(O*g,z*g,0);for(let z=0;z<x;z+=f+1)for(let O=0;O<f;O++)h.emplaceBack(O+z,f+O+z+1,f+O+z+2),h.emplaceBack(O+z,f+O+z+2,O+z+1);const w=o.length,k=w+2*(f+1);for(const z of[0,1])for(let O=0;O<=f;O++)for(const X of[0,1])o.emplaceBack(O*g,z*s.N,X);for(let z=0;z<2*f;z+=2)h.emplaceBack(k+z,k+z+1,k+z+3),h.emplaceBack(k+z,k+z+3,k+z+2),h.emplaceBack(w+z,w+z+3,w+z+1),h.emplaceBack(w+z,w+z+2,w+z+3);const A=o.length,P=A+2*(f+1);for(const z of[0,1])for(let O=0;O<=f;O++)for(const X of[0,1])o.emplaceBack(z*s.N,O*g,X);for(let z=0;z<2*f;z+=2)h.emplaceBack(A+z,A+z+1,A+z+3),h.emplaceBack(A+z,A+z+3,A+z+2),h.emplaceBack(P+z,P+z+3,P+z+1),h.emplaceBack(P+z,P+z+2,P+z+3);return this._mesh={indexBuffer:t.createIndexBuffer(h),vertexBuffer:t.createVertexBuffer(o,Yc.members),segments:s.S.simpleSegment(0,0,o.length,h.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*s.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,o){var h;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,o);return(h=this.getMinMaxElevation(f).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(t){const o=this.getTerrainData(t).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(t,o){const h=s.U.fromLngLat(t.wrap()),f=(1<<o)*s.N,g=h.x*f,x=h.y*f,w=Math.floor(g/s.N),k=Math.floor(x/s.N);return{tileID:new s.O(o,0,o,w,k),mercatorX:g,mercatorY:x}}_allowMercatorOverflow(t,o){const h=t.x<this.painter.width/2;let f=s.bf(o);const g=this.painter.transform.center.lng;return h&&Math.sign(f)>0&&Math.sign(g)<0||!h&&Math.sign(f)<0&&Math.sign(g)>0?(f=360*Math.sign(g)+f,s.G(f)):o}}class oh{constructor(t,o,h){this._context=t,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new je(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:t,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>t.id!==o),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Fr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class _a{constructor(t,o){this.painter=t,this.terrain=o,this.pool=new oh(t.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(h=>!t._layers[h].isHidden(o)),this._coordsDescendingInv={};for(const h in t.sourceCaches){this._coordsDescendingInv[h]={};const f=t.sourceCaches[h].getVisibleCoordinates();for(const g of f){const x=this.terrain.sourceCache.getTerrainCoords(g);for(const w in x)this._coordsDescendingInv[h][w]||(this._coordsDescendingInv[h][w]=[]),this._coordsDescendingInv[h][w].push(x[w])}}this._coordsDescendingInvStr={};for(const h of t._order){const f=t._layers[h],g=f.source;if(Fr[f.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(w=>w.key).sort().join()}}for(const h of this._renderableTiles)for(const f in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[f][h.tileID.key];g&&g!==h.rttCoords[f]&&(h.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const o=t.type,h=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Fr[o]&&(this._prevType&&Fr[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(t.id),!f))return!0;if(Fr[this._prevType]||Fr[o]&&f){this._prevType=o;const g=this._stacks.length-1,x=this._stacks[g]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Gi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[g]){const A=this.pool.getObjectForId(w.rtt[g].id);if(A.stamp===w.rtt[g].stamp){this.pool.useObject(A);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),w.rtt[g]={id:k.id,stamp:k.stamp},h.context.bindFramebuffer.set(k.fbo.framebuffer),h.context.clear({color:s.aT.transparent,stencil:0}),h.currentStencilSource=void 0;for(let A=0;A<x.length;A++){const P=h.style._layers[x[A]],z=P.source?this._coordsDescendingInv[P.source][w.tileID.key]:[w.tileID];h.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),h._renderTileClippingMasks(P,z),h.renderLayer(h,h.style.sourceCaches[P.source],P,z),P.source&&(w.rttCoords[P.source]=this._coordsDescendingInvStr[P.source][w.tileID.key])}}return Gi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Fr[o]}return!1}}const wt=I,Mt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ps=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},wl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sl{constructor(t,o,h=!1){this.mousedown=x=>{this.startMouse(s.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),M.mousePos(this.element,x)),M.addEventListener(window,"mousemove",this.mousemove),M.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,M.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=M.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),M.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=M.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const f=t.dragRotate._mouseRotate.getClickTolerance(),g=t.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=is({clickTolerance:f,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:k=.8})=>{const A=new Xc;return new io({clickTolerance:w,move:(P,z)=>({bearingDelta:(z.x-P.x)*k}),moveStateManager:A,enable:x,assignEvents:Ps})})({clickTolerance:f,enable:!0}),this.map=t,h&&(this.mousePitch=ro({clickTolerance:g,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:k=-.5})=>{const A=new Xc;return new io({clickTolerance:w,move:(P,z)=>({pitchDelta:(z.y-P.y)*k}),moveStateManager:A,enable:x,assignEvents:Ps})})({clickTolerance:g,enable:!0})),M.addEventListener(o,"mousedown",this.mousedown),M.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),M.addEventListener(o,"touchcancel",this.reset)}startMouse(t,o){this.mouseRotate.dragStart(t,o),this.mousePitch&&this.mousePitch.dragStart(t,o),M.disableDrag()}startTouch(t,o){this.touchRotate.dragStart(t,o),this.touchPitch&&this.touchPitch.dragStart(t,o),M.disableDrag()}moveMouse(t,o){const h=this.map,{bearingDelta:f}=this.mouseRotate.dragMove(t,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.mousePitch){const{pitchDelta:g}=this.mousePitch.dragMove(t,o)||{};g&&h.setPitch(h.getPitch()+g)}}moveTouch(t,o){const h=this.map,{bearingDelta:f}=this.touchRotate.dragMove(t,o)||{};if(f&&h.setBearing(h.getBearing()+f),this.touchPitch){const{pitchDelta:g}=this.touchPitch.dragMove(t,o)||{};g&&h.setPitch(h.getPitch()+g)}}off(){const t=this.element;M.removeEventListener(t,"mousedown",this.mousedown),M.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend),M.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){M.enableDrag(),M.removeEventListener(window,"mousemove",this.mousemove),M.removeEventListener(window,"mouseup",this.mouseup),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend)}}let Qi;function Tl(m,t,o){if(m=new s.L(m.lng,m.lat),t){const h=new s.L(m.lng-360,m.lat),f=new s.L(m.lng+360,m.lat),g=o.locationPoint(m).distSqr(t);o.locationPoint(h).distSqr(t)<g?m=h:o.locationPoint(f).distSqr(t)<g&&(m=f)}for(;Math.abs(m.lng-o.center.lng)>180;){const h=o.locationPoint(m);if(h.x>=0&&h.y>=0&&h.x<=o.width&&h.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m}const wn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function tu(m,t,o){const h=m.classList;for(const f in wn)h.remove(`maplibregl-${o}-anchor-${f}`);h.add(`maplibregl-${o}-anchor-${t}`)}class Po extends s.E{constructor(t){if(super(),this._onKeyPress=o=>{const h=o.code,f=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=o=>{const h=o.originalEvent.target,f=this._element;this._popup&&(h===f||f.contains(h))&&this.togglePopup()},this._update=o=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!h)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Tl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),M.setTransform(this._element,`${wn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${f}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const x=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=o=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=M.create("div"),this._element.setAttribute("aria-label","Map marker");const o=M.createNS("http://www.w3.org/2000/svg","svg"),h=41,f=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${f}px`),o.setAttributeNS(null,"viewBox",`0 0 ${f} ${h}`);const g=M.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=M.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const w=M.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of k){const xe=M.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",le.rx),xe.setAttributeNS(null,"ry",le.ry),w.appendChild(xe)}const A=M.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const P=M.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(P);const z=M.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const O=M.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(O);const X=M.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const G=M.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const $=M.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#000000"),$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962");const q=M.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#FFFFFF"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962"),G.appendChild($),G.appendChild(q),x.appendChild(w),x.appendChild(A),x.appendChild(z),x.appendChild(X),x.appendChild(G),o.appendChild(x),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(o),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),tu(this._element,this._anchor,"marker"),t&&t.className)for(const o of t.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),M.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Xi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Oi=0,ns=!1;const zs={maxWidth:100,unit:"metric"};function Ls(m,t,o){const h=o&&o.maxWidth||100,f=m._container.clientHeight/2,g=m.unproject([0,f]),x=m.unproject([h,f]),w=g.distanceTo(x);if(o&&o.unit==="imperial"){const k=3.2808*w;k>5280?zo(t,h,k/5280,m._getUIString("ScaleControl.Miles")):zo(t,h,k,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?zo(t,h,w/1852,m._getUIString("ScaleControl.NauticalMiles")):w>=1e3?zo(t,h,w/1e3,m._getUIString("ScaleControl.Kilometers")):zo(t,h,w,m._getUIString("ScaleControl.Meters"))}function zo(m,t,o,h){const f=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(k){const A=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*A)/A}(w),x*w}(o);m.style.width=t*(f/o)+"px",m.innerHTML=`${f}&nbsp;${h}`}const kl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Il=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function os(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,m),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-m),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(m,0),right:new s.P(-m,0)}}if(m instanceof s.P||Array.isArray(m)){const t=s.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(m.center||[0,0]),top:s.P.convert(m.top||[0,0]),"top-left":s.P.convert(m["top-left"]||[0,0]),"top-right":s.P.convert(m["top-right"]||[0,0]),bottom:s.P.convert(m.bottom||[0,0]),"bottom-left":s.P.convert(m["bottom-left"]||[0,0]),"bottom-right":s.P.convert(m["bottom-right"]||[0,0]),left:s.P.convert(m.left||[0,0]),right:s.P.convert(m.right||[0,0])}}return os(new s.P(0,0))}const Ml={extend:(m,...t)=>s.e(m,...t),run(m){m()},logToElement(m,t=!1,o="log"){const h=window.document.getElementById(o);h&&(t&&(h.innerHTML=""),h.innerHTML+=`<br>${m}`)}},Cl=I;class mi{static get version(){return Cl}static get workerCount(){return nn.workerCount}static set workerCount(t){nn.workerCount=t}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){s.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(t){s.c.WORKER_URL=t}static addProtocol(t,o){s.c.REGISTERED_PROTOCOLS[t]=o}static removeProtocol(t){delete s.c.REGISTERED_PROTOCOLS[t]}}return mi.Map=class extends Jc{constructor(m){if(s.bg.mark(s.bh.create),(m=s.e({},Mt,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ha(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new ma,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},xl,m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this._imageQueueHandle=ve.addThrottleControl(()=>this.isMoving()),this._requestManager=new W(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const o=Eo(h=>{this._trackResize&&!this._removed&&this.resize(h)._update()},50);this._resizeObserver=new ResizeObserver(h=>{t?o(h):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bl(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new Is(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,s.e({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new cn({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new Ai,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new s.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new s.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new s.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=m.onAdd(this);this._controls.push(m);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,t,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,t,o,h)}resize(m){var t;const o=this._containerDimensions(),h=o[0],f=o[1],g=this._getClampedPixelRatio(h,f);if(this._resizeCanvas(h,f,g),this.painter.resize(h,f,g),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const k=this._getClampedPixelRatio(h,f);this._resizeCanvas(h,f,k),this.painter.resize(h,f,k)}this.transform.resize(h,f),(t=this._requestedCameraState)===null||t===void 0||t.resize(h,f);const x=!this._moving;return x&&(this.stop(),this.fire(new s.k("movestart",m)).fire(new s.k("move",m))),this.fire(new s.k("resize",m)),x&&this.fire(new s.k("moveend",m)),this}_getClampedPixelRatio(m,t){const{0:o,1:h}=this._maxCanvasSize,f=this.getPixelRatio(),g=m*f,x=t*f;return Math.min(g>o?o/g:1,x>h?h/x:1)*f}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Xt.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(m){return this.transform.locationPoint(s.L.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(s.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,o){if(m==="mouseenter"||m==="mouseover"){let h=!1;return{layer:t,listener:o,delegates:{mousemove:g=>{const x=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];x.length?h||(h=!0,o.call(this,new ln(m,this,g.originalEvent,{features:x}))):h=!1},mouseout:()=>{h=!1}}}}if(m==="mouseleave"||m==="mouseout"){let h=!1;return{layer:t,listener:o,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?h=!0:h&&(h=!1,o.call(this,new ln(m,this,x.originalEvent)))},mouseout:x=>{h&&(h=!1,o.call(this,new ln(m,this,x.originalEvent)))}}}}{const h=f=>{const g=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];g.length&&(f.features=g,o.call(this,f),delete f.features)};return{layer:t,listener:o,delegates:{[m]:h}}}}on(m,t,o){if(o===void 0)return super.on(m,t);const h=this._createDelegatedListener(m,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(h);for(const f in h.delegates)this.on(f,h.delegates[f]);return this}once(m,t,o){if(o===void 0)return super.once(m,t);const h=this._createDelegatedListener(m,t,o);for(const f in h.delegates)this.once(f,h.delegates[f]);return this}off(m,t,o){return o===void 0?super.off(m,t):(this._delegatedListeners&&this._delegatedListeners[m]&&(h=>{const f=this._delegatedListeners[m];for(let g=0;g<f.length;g++){const x=f[g];if(x.layer===t&&x.listener===o){for(const w in x.delegates)this.off(w,x.delegates[w]);return f.splice(g,1),this}}})(),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let o;const h=m instanceof s.P||Array.isArray(m),f=h?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(h?{}:m)||{},f instanceof s.P||typeof f[0]=="number")o=[s.P.convert(f)];else{const g=s.P.convert(f[0]),x=s.P.convert(f[1]);o=[g,new s.P(x.x,g.y),x,new s.P(g.x,x.y),g]}return this.style.queryRenderedFeatures(o,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,t));const o=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new wr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,o):this.style.loadJSON(m,t,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const o=this._requestManager.transformRequest(m,Ee.Style);s.f(o,(h,f)=>{h?this.fire(new s.j(h)):f&&this._updateDiff(f,t)})}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(o){s.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.sourceCaches[m];if(t!==void 0)return t.loaded();this.fire(new s.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.sourceCaches[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);for(const o in this.style._layers){const h=this.style._layers[o];h.type==="hillshade"&&h.source===m.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new eu(this.painter,t,m),this.painter.renderToTexture=new _a(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const t in m){const o=m[t]._tiles;for(const h in o){const f=o[h];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(m,t,o){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,t,o)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,t,o={}){const{pixelRatio:h=1,sdf:f=!1,stretchX:g,stretchY:x,content:w}=o;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:A,data:P}=t,z=t;return this.style.addImage(m,{data:new s.R({width:k,height:A},new Uint8Array(P)),pixelRatio:h,stretchX:g,stretchY:x,content:w,sdf:f,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m),this}}{const{width:k,height:A,data:P}=s.h.getImageData(t);this.style.addImage(m,{data:new s.R({width:k,height:A},P),pixelRatio:h,stretchX:g,stretchY:x,content:w,sdf:f,version:0})}}updateImage(m,t){const o=this.style.getImage(m);if(!o)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof HTMLImageElement||s.a(t)?s.h.getImageData(t):t,{width:f,height:g,data:x}=h;if(f===void 0||g===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==o.data.width||g!==o.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||s.a(t));return o.data.replace(x,w),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,t){ve.getImage(this._requestManager.transformRequest(m,Ee.Image),t)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,o){return this.style.setLayerZoomRange(m,t,o),this._update(!0)}setFilter(m,t,o={}){return this.style.setFilter(m,t,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,o,h={}){return this.style.setPaintProperty(m,t,o,h),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,o,h={}){return this.style.setLayoutProperty(m,t,o,h),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,o,h=>{h||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,o=>{o||this._update(!0)}),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=M.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=M.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);const f=this._controlContainer=M.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=M.create("div",`maplibregl-ctrl-${x} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=M.create("div","maplibregl-cooperative-gesture-screen",this._container);let m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(m=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${m}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){M.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(m,t,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{t={requestedAttributes:m},h&&(t.statusMessage=h.statusMessage,t.type=h.type)},{once:!0});const o=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!o){const h="Failed to initialize WebGL";throw t?(t.message=h,new Error(JSON.stringify(t))):new Error(h)}this.painter=new Ao(o,this.transform),B.testSupport(o)}_onCooperativeGesture(m,t,o){return!t&&o<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,g=s.h.now();this.style.zoomHistory.update(f,g);const x=new s.a8(f,{now:g,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(o=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const h=this._sourcesDirty||this._styleDirty||this._placementDirty;return h||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ve.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),M.remove(this._canvasContainer),M.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(m=>{s.bg.frame(m),this._frame=null,this._render(m)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return wt}getCameraTargetElevation(){return this.transform.elevation}},mi.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),o=t===this._map.getMaxZoom(),h=t===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,o)=>{const h=this._map._getUIString(`NavigationControl.${o}`);t.title=h,t.setAttribute("aria-label",h)},this.options=s.e({},wl,m),this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),M.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),M.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=M.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){M.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const o=M.create("button",m,this._container);return o.type="button",o.addEventListener("click",t),o}},mi.GeolocateControl=class extends s.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const o=new s.L(t.coords.longitude,t.coords.latitude),h=t.coords.accuracy,f=this._map.getBearing(),g=s.e({bearing:f},this.options.fitBoundsOptions),x=Xt.fromLngLat(o,h);this._map.fitBounds(x,g,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const o=new s.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ns)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=M.create("button","maplibregl-ctrl-geolocate",this._container),M.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Po({element:this._dotElement}),this._circleElement=M.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Po({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},Xi,m)}onAdd(m){return this._map=m,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,o=!1){Qi===void 0||o?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Qi=h.state!=="denied",t(Qi)}).catch(()=>{Qi=!!window.navigator.geolocation,t(Qi)}):(Qi=!!window.navigator.geolocation,t(Qi)):t(Qi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),M.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Oi=0,ns=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),o=m.coords;return t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),t=m.getSouthEast(),o=m.getNorthEast(),h=t.distanceTo(o),f=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Oi--,ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Oi++,Oi>1?(m={maximumAge:6e5,timeout:0},ns=!0):(m=this.options.positionOptions,ns=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},mi.AttributionControl=cn,mi.LogoControl=Ai,mi.ScaleControl=class{constructor(m){this._onMove=()=>{Ls(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ls(this._map,this._container,this.options)},this.options=s.e({},zs,m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){M.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},mi.FullscreenControl=class extends s.E{constructor(m={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){M.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=M.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);M.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},mi.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=m}onAdd(m){return this._map=m,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=M.create("button","maplibregl-ctrl-terrain",this._container),M.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){M.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},mi.Popup=class extends s.E{constructor(m){super(),this.remove=()=>(this._content&&M.remove(this._content),this._container&&(M.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=M.create("div","maplibregl-popup",this._map.getContainer()),this._tip=M.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const o=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let h=this.options.anchor;const f=os(this.options.offset);if(!h){const x=this._container.offsetWidth,w=this._container.offsetHeight;let k;k=o.y+f.bottom.y<w?["top"]:o.y>this._map.transform.height-w?["bottom"]:[],o.x<x/2?k.push("left"):o.x>this._map.transform.width-x/2&&k.push("right"),h=k.length===0?"bottom":k.join("-")}const g=o.add(f[h]).round();M.setTransform(this._container,`${wn[h]} translate(${g.x}px,${g.y}px)`),tu(this._container,h,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(kl),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=s.L.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=m;h=o.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=M.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=M.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Il);m&&m.focus()}},mi.Marker=Po,mi.Style=wr,mi.LngLat=s.L,mi.LngLatBounds=Xt,mi.Point=s.P,mi.MercatorCoordinate=s.U,mi.Evented=s.E,mi.AJAXError=s.bi,mi.config=s.c,mi.CanvasSource=Hi,mi.GeoJSONSource=qe,mi.ImageSource=jt,mi.RasterDEMTileSource=Je,mi.RasterTileSource=Ti,mi.VectorTileSource=ar,mi.VideoSource=ki,mi.setRTLTextPlugin=s.bj,mi.getRTLTextPluginStatus=s.bk,mi.prewarm=function(){Ui().acquire(qt)},mi.clearPrewarmedResources=function(){const m=rr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(qt),rr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Ml.extend(mi,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),mi});var S=p;return S})})(_m);var ym=_m.exports;const Wn=pm(ym);function fp(u){let n;return l=>{if(l)for(let c in l){let p=n==null?void 0:n[c],v=l[c];p!==v&&u(c,v,p)}else if(n)for(let c in n)u(c,void 0,n[c]);n=l}}function My(u,...n){let l=[u];for(let c of n)if(c)Array.isArray(c)&&c[0]===u?l.push(...c.slice(1)):l.push(c);else continue;if(l.length!==1)return l.length===2?l[1]:l}function Cy(u){return u===!0?["has","point_count"]:u===!1?["!",["has","point_count"]]:void 0}function ld(u,n){return["case",["boolean",["feature-state","hover"],!1],n,u]}var Du=Ay;function Ay(u){var n,l,c;if(u){if(Array.isArray(u)){for(n=[],l=u.length,c=0;c<l;c++){var p=u[c];p!=null&&n.push(p)}return n}if(typeof u=="object"){n={};var v=Object.keys(u);for(l=v.length,c=0;c<l;c++){var S=v[c],s=u[S];s!=null&&(n[S]=s)}return n}}}function pp(u){let n=u[0],l,c,p=mp(u);return{c(){p.c(),l=Bn()},m(v,S){p.m(v,S),Be(v,l,S),c=!0},p(v,S){S[0]&1&&ti(n,n=v[0])?(yr(),Ie(p,1,1,Dt),vr(),p=mp(v),p.c(),be(p,1),p.m(l.parentNode,l)):p.p(v,S)},i(v){c||(be(p),c=!0)},o(v){Ie(p),c=!1},d(v){v&&De(l),p.d(v)}}}function mp(u){let n;const l=u[37].default,c=Yr(l,u,u[36],null);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v[1]&32)&&en(c,l,p,p[36],n?Qr(l,p[36],v,null):tn(p[36]),null)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function Ey(u){let n,l,c=u[0]&&pp(u);return{c(){c&&c.c(),n=Bn()},m(p,v){c&&c.m(p,v),Be(p,n,v),l=!0},p(p,v){p[0]?c?(c.p(p,v),v[0]&1&&be(c,1)):(c=pp(p),c.c(),be(c,1),c.m(n.parentNode,n)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr())},i(p){l||(be(c),l=!0)},o(p){Ie(c),l=!1},d(p){p&&De(n),c&&c.d(p)}}}function Py(u,n,l){let c,p,v,S,s,I,M,B,j,ie,ae,ce,{$$slots:ge={},$$scope:ve}=n,{id:Ee=Oa("layer")}=n,{source:W=void 0}=n,{sourceLayer:ne=void 0}=n,{beforeId:re=void 0}=n,{beforeLayerType:_e=void 0}=n,{type:ze}=n,{paint:Ce=void 0}=n,{layout:Ae=void 0}=n,{filter:Ue=void 0}=n,{applyToClusters:je=void 0}=n,{minzoom:we=void 0}=n,{maxzoom:Te=void 0}=n,{manageHoverState:xt=!1}=n,{hovered:bt=null}=n,{interactive:it=!0}=n,{hoverCursor:dt=void 0}=n,{eventsIfTopMost:Pt=!1}=n;const ut=fc(),{map:kt,source:yi,self:$t,minzoom:Vt,maxzoom:Xt,eventTopMost:hi,layerInfo:ar}=Ty();vt(u,kt,qe=>l(32,j=qe)),vt(u,yi,qe=>l(33,ie=qe)),vt(u,$t,qe=>l(0,B=qe)),vt(u,Vt,qe=>l(35,ce=qe)),vt(u,Xt,qe=>l(34,ae=qe)),xo(()=>{B&&j&&(ar.delete(B),j==null||j.removeLayer(B))});let Ti,Je=!0;return u.$$set=qe=>{"id"in qe&&l(7,Ee=qe.id),"source"in qe&&l(8,W=qe.source),"sourceLayer"in qe&&l(9,ne=qe.sourceLayer),"beforeId"in qe&&l(10,re=qe.beforeId),"beforeLayerType"in qe&&l(11,_e=qe.beforeLayerType),"type"in qe&&l(12,ze=qe.type),"paint"in qe&&l(13,Ce=qe.paint),"layout"in qe&&l(14,Ae=qe.layout),"filter"in qe&&l(15,Ue=qe.filter),"applyToClusters"in qe&&l(16,je=qe.applyToClusters),"minzoom"in qe&&l(17,we=qe.minzoom),"maxzoom"in qe&&l(18,Te=qe.maxzoom),"manageHoverState"in qe&&l(19,xt=qe.manageHoverState),"hovered"in qe&&l(6,bt=qe.hovered),"interactive"in qe&&l(20,it=qe.interactive),"hoverCursor"in qe&&l(21,dt=qe.hoverCursor),"eventsIfTopMost"in qe&&l(22,Pt=qe.eventsIfTopMost),"$$scope"in qe&&l(36,ve=qe.$$scope)},u.$$.update=()=>{if(u.$$.dirty[0]&65536&&l(31,c=Cy(je)),u.$$.dirty[0]&32768|u.$$.dirty[1]&1&&l(25,p=My("all",c,Ue)),u.$$.dirty[0]&131072|u.$$.dirty[1]&16&&l(27,v=we??ce),u.$$.dirty[0]&262144|u.$$.dirty[1]&8&&l(26,S=Te??ae),u.$$.dirty[0]&256|u.$$.dirty[1]&4&&l(30,s=W||ie),u.$$.dirty[0]&1324908161|u.$$.dirty[1]&2&&j&&B!==Ee&&s){let qe=function(jt){var Ii,$i;if(!it||!B||!j||Pt&&hi(jt)!==B)return;let ki=jt.features??[],Hi=($i=(Ii=ki[0])==null?void 0:Ii.properties)==null?void 0:$i.cluster_id,Xe={event:jt,map:j,clusterId:Hi,layer:B,source:s,features:ki};ut(jt.type,Xe)};B&&ar.delete(B);let Ut=re;if(!re&&_e){let jt=j.getStyle().layers,ki=typeof _e=="function"?_e:Xe=>Xe.type===_e,Hi=jt==null?void 0:jt.find(ki);Hi&&(Ut=Hi.id)}ei($t,B=Ee,B),j.addLayer(Du({id:B,type:ze,source:s,"source-layer":ne,filter:p,paint:Ce,layout:Ae,minzoom:v,maxzoom:S}),Ut),l(24,Je=!0),j.on("click",B,qe),j.on("dblclick",B,qe),j.on("contextmenu",B,qe),j.on("mouseenter",B,jt=>{var Ii,$i;if(!it||!B||!j||Pt&&hi(jt)!==B)return;dt&&(j.getCanvas().style.cursor=dt);let ki=jt.features??[];l(6,bt=ki[0]??null);let Hi=($i=(Ii=ki[0])==null?void 0:Ii.properties)==null?void 0:$i.cluster_id;ut("mouseenter",{event:jt,map:j,clusterId:Hi,layer:B,source:s,features:ki})}),j.on("mousemove",B,jt=>{var Ii,$i,rn;if(!it)return;if(Pt&&hi(jt)!==B){l(6,bt=null),xt&&Ti!==void 0&&(j==null||j.setFeatureState({source:s,sourceLayer:ne,id:Ti},{hover:!1}),l(23,Ti=void 0));return}j.getCanvas().style.cursor=dt;let ki=jt.features??[],Hi=($i=(Ii=ki[0])==null?void 0:Ii.properties)==null?void 0:$i.cluster_id,Xe=(rn=ki[0])==null?void 0:rn.id;Xe!==Ti&&(xt&&(Ti!==void 0&&(j==null||j.setFeatureState({source:s,id:Ti,sourceLayer:ne},{hover:!1})),j==null||j.setFeatureState({source:s,id:Xe,sourceLayer:ne},{hover:!0})),l(23,Ti=Xe),l(6,bt=ki[0]??null)),ut("mousemove",{event:jt,map:j,clusterId:Hi,layer:B,source:s,features:ki})}),j.on("mouseleave",B,jt=>{if(!(!it||!B||!j)){if(dt&&(j.getCanvas().style.cursor=""),l(6,bt=null),xt&&Ti!==void 0){const ki={source:s,id:Ti,sourceLayer:ne};j==null||j.setFeatureState(ki,{hover:!1}),l(23,Ti=void 0)}ut("mouseleave",{map:j,layer:B,source:s})}})}u.$$.dirty[0]&1048577&&B&&ar.set(B,{interactive:it}),u.$$.dirty[0]&1|u.$$.dirty[1]&2&&l(29,I=B?fp((qe,Ut)=>j==null?void 0:j.setPaintProperty(B,qe,Ut)):void 0),u.$$.dirty[0]&1|u.$$.dirty[1]&2&&l(28,M=B?fp((qe,Ut)=>j==null?void 0:j.setLayoutProperty(B,qe,Ut)):void 0),u.$$.dirty[0]&536879104&&(I==null||I(Ce)),u.$$.dirty[0]&268451840&&(M==null||M(Ae)),u.$$.dirty[0]&201326593|u.$$.dirty[1]&2&&B&&(j==null||j.setLayerZoomRange(B,v,S)),u.$$.dirty[0]&50331649|u.$$.dirty[1]&2&&B&&(Je?l(24,Je=!1):j==null||j.setFilter(B,p))},[B,kt,yi,$t,Vt,Xt,bt,Ee,W,ne,re,_e,ze,Ce,Ae,Ue,je,we,Te,xt,it,dt,Pt,Ti,Je,p,S,v,M,I,s,c,j,ie,ae,ce,ve,ge]}class Nu extends ci{constructor(n){super(),li(this,n,Py,Ey,ti,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function zy(u){let n;const l=u[16].default,c=Yr(l,u,u[24],null);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v&16777216)&&en(c,l,p,p[24],n?Qr(l,p[24],v,null):tn(p[24]),null)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function Ly(u){let n,l,c;function p(S){u[17](S)}let v={id:u[1],type:"circle",source:u[2],sourceLayer:u[3],beforeId:u[4],beforeLayerType:u[5],paint:u[6],layout:u[7],filter:u[8],applyToClusters:u[9],minzoom:u[10],maxzoom:u[11],hoverCursor:u[12],manageHoverState:u[13],eventsIfTopMost:u[14],interactive:u[15],$$slots:{default:[zy]},$$scope:{ctx:u}};return u[0]!==void 0&&(v.hovered=u[0]),n=new Nu({props:v}),gr.push(()=>_s(n,"hovered",p)),n.$on("click",u[18]),n.$on("dblclick",u[19]),n.$on("contextmenu",u[20]),n.$on("mouseenter",u[21]),n.$on("mousemove",u[22]),n.$on("mouseleave",u[23]),{c(){$e(n.$$.fragment)},m(S,s){We(n,S,s),c=!0},p(S,[s]){const I={};s&2&&(I.id=S[1]),s&4&&(I.source=S[2]),s&8&&(I.sourceLayer=S[3]),s&16&&(I.beforeId=S[4]),s&32&&(I.beforeLayerType=S[5]),s&64&&(I.paint=S[6]),s&128&&(I.layout=S[7]),s&256&&(I.filter=S[8]),s&512&&(I.applyToClusters=S[9]),s&1024&&(I.minzoom=S[10]),s&2048&&(I.maxzoom=S[11]),s&4096&&(I.hoverCursor=S[12]),s&8192&&(I.manageHoverState=S[13]),s&16384&&(I.eventsIfTopMost=S[14]),s&32768&&(I.interactive=S[15]),s&16777216&&(I.$$scope={dirty:s,ctx:S}),!l&&s&1&&(l=!0,I.hovered=S[0],ms(()=>l=!1)),n.$set(I)},i(S){c||(be(n.$$.fragment,S),c=!0)},o(S){Ie(n.$$.fragment,S),c=!1},d(S){He(n,S)}}}function Dy(u,n,l){let{$$slots:c={},$$scope:p}=n,{id:v=Oa("circle")}=n,{source:S=void 0}=n,{sourceLayer:s=void 0}=n,{beforeId:I=void 0}=n,{beforeLayerType:M=void 0}=n,{paint:B}=n,{layout:j=void 0}=n,{filter:ie=void 0}=n,{applyToClusters:ae=void 0}=n,{minzoom:ce=void 0}=n,{maxzoom:ge=void 0}=n,{hoverCursor:ve=void 0}=n,{manageHoverState:Ee=!1}=n,{hovered:W=null}=n,{eventsIfTopMost:ne=!1}=n,{interactive:re=!0}=n;function _e(Te){W=Te,l(0,W)}function ze(Te){Vi.call(this,u,Te)}function Ce(Te){Vi.call(this,u,Te)}function Ae(Te){Vi.call(this,u,Te)}function Ue(Te){Vi.call(this,u,Te)}function je(Te){Vi.call(this,u,Te)}function we(Te){Vi.call(this,u,Te)}return u.$$set=Te=>{"id"in Te&&l(1,v=Te.id),"source"in Te&&l(2,S=Te.source),"sourceLayer"in Te&&l(3,s=Te.sourceLayer),"beforeId"in Te&&l(4,I=Te.beforeId),"beforeLayerType"in Te&&l(5,M=Te.beforeLayerType),"paint"in Te&&l(6,B=Te.paint),"layout"in Te&&l(7,j=Te.layout),"filter"in Te&&l(8,ie=Te.filter),"applyToClusters"in Te&&l(9,ae=Te.applyToClusters),"minzoom"in Te&&l(10,ce=Te.minzoom),"maxzoom"in Te&&l(11,ge=Te.maxzoom),"hoverCursor"in Te&&l(12,ve=Te.hoverCursor),"manageHoverState"in Te&&l(13,Ee=Te.manageHoverState),"hovered"in Te&&l(0,W=Te.hovered),"eventsIfTopMost"in Te&&l(14,ne=Te.eventsIfTopMost),"interactive"in Te&&l(15,re=Te.interactive),"$$scope"in Te&&l(24,p=Te.$$scope)},[W,v,S,s,I,M,B,j,ie,ae,ce,ge,ve,Ee,ne,re,c,_e,ze,Ce,Ae,Ue,je,we,p]}class pc extends ci{constructor(n){super(),li(this,n,Dy,Ly,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function By(u){let n;const l=u[15].default,c=Yr(l,u,u[23],null);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v&8388608)&&en(c,l,p,p[23],n?Qr(l,p[23],v,null):tn(p[23]),null)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function Fy(u){let n,l,c;function p(S){u[16](S)}let v={id:u[1],type:"fill",source:u[2],sourceLayer:u[3],beforeId:u[4],beforeLayerType:u[5],paint:u[6],layout:u[7],filter:u[8],minzoom:u[9],maxzoom:u[10],hoverCursor:u[11],manageHoverState:u[12],eventsIfTopMost:u[13],interactive:u[14],$$slots:{default:[By]},$$scope:{ctx:u}};return u[0]!==void 0&&(v.hovered=u[0]),n=new Nu({props:v}),gr.push(()=>_s(n,"hovered",p)),n.$on("click",u[17]),n.$on("dblclick",u[18]),n.$on("contextmenu",u[19]),n.$on("mouseenter",u[20]),n.$on("mousemove",u[21]),n.$on("mouseleave",u[22]),{c(){$e(n.$$.fragment)},m(S,s){We(n,S,s),c=!0},p(S,[s]){const I={};s&2&&(I.id=S[1]),s&4&&(I.source=S[2]),s&8&&(I.sourceLayer=S[3]),s&16&&(I.beforeId=S[4]),s&32&&(I.beforeLayerType=S[5]),s&64&&(I.paint=S[6]),s&128&&(I.layout=S[7]),s&256&&(I.filter=S[8]),s&512&&(I.minzoom=S[9]),s&1024&&(I.maxzoom=S[10]),s&2048&&(I.hoverCursor=S[11]),s&4096&&(I.manageHoverState=S[12]),s&8192&&(I.eventsIfTopMost=S[13]),s&16384&&(I.interactive=S[14]),s&8388608&&(I.$$scope={dirty:s,ctx:S}),!l&&s&1&&(l=!0,I.hovered=S[0],ms(()=>l=!1)),n.$set(I)},i(S){c||(be(n.$$.fragment,S),c=!0)},o(S){Ie(n.$$.fragment,S),c=!1},d(S){He(n,S)}}}function Ry(u,n,l){let{$$slots:c={},$$scope:p}=n,{id:v=Oa("fill")}=n,{source:S=void 0}=n,{sourceLayer:s=void 0}=n,{beforeId:I=void 0}=n,{beforeLayerType:M=void 0}=n,{paint:B}=n,{layout:j=void 0}=n,{filter:ie=void 0}=n,{minzoom:ae=void 0}=n,{maxzoom:ce=void 0}=n,{hoverCursor:ge=void 0}=n,{manageHoverState:ve=!1}=n,{hovered:Ee=null}=n,{eventsIfTopMost:W=!1}=n,{interactive:ne=!0}=n;function re(we){Ee=we,l(0,Ee)}function _e(we){Vi.call(this,u,we)}function ze(we){Vi.call(this,u,we)}function Ce(we){Vi.call(this,u,we)}function Ae(we){Vi.call(this,u,we)}function Ue(we){Vi.call(this,u,we)}function je(we){Vi.call(this,u,we)}return u.$$set=we=>{"id"in we&&l(1,v=we.id),"source"in we&&l(2,S=we.source),"sourceLayer"in we&&l(3,s=we.sourceLayer),"beforeId"in we&&l(4,I=we.beforeId),"beforeLayerType"in we&&l(5,M=we.beforeLayerType),"paint"in we&&l(6,B=we.paint),"layout"in we&&l(7,j=we.layout),"filter"in we&&l(8,ie=we.filter),"minzoom"in we&&l(9,ae=we.minzoom),"maxzoom"in we&&l(10,ce=we.maxzoom),"hoverCursor"in we&&l(11,ge=we.hoverCursor),"manageHoverState"in we&&l(12,ve=we.manageHoverState),"hovered"in we&&l(0,Ee=we.hovered),"eventsIfTopMost"in we&&l(13,W=we.eventsIfTopMost),"interactive"in we&&l(14,ne=we.interactive),"$$scope"in we&&l(23,p=we.$$scope)},[Ee,v,S,s,I,M,B,j,ie,ae,ce,ge,ve,W,ne,c,re,_e,ze,Ce,Ae,Ue,je,p]}class mc extends ci{constructor(n){super(),li(this,n,Ry,Fy,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Oy(u,n,l){let c;const{map:p}=Na();vt(u,p,I=>l(4,c=I));let{position:v="top-left"}=n,{container:S=void 0}=n,s=null;return xo(()=>{c!=null&&c.loaded()&&s&&c.removeControl(s)}),u.$$set=I=>{"position"in I&&l(1,v=I.position),"container"in I&&l(2,S=I.container)},u.$$.update=()=>{if(u.$$.dirty&30&&c&&!s){let I;typeof S=="string"?I=document.querySelector(S)??void 0:I=S,l(3,s=new Wn.FullscreenControl({container:I})),c.addControl(s,v)}},[p,v,S,s,c]}class Ny extends ci{constructor(n){super(),li(this,n,Oy,null,ti,{position:1,container:2})}}function Vy(u,n,l,c,p){let v=!1;u.getSource(n)&&(v=!0,u.removeSource(n));const S=()=>{c(n)&&(u.addSource(n,l),p())};if(v){const s=()=>{n&&(u.getSource(n)?setTimeout(s,1):S())};s()}else S()}function Uy(u,n,l){Yg().then(()=>{let c=Gg(u);if(!c)return;c.getSource(n)===l&&c.removeSource(n)})}function _p(u){let n=u[0],l,c,p=gp(u);return{c(){p.c(),l=Bn()},m(v,S){p.m(v,S),Be(v,l,S),c=!0},p(v,S){S&1&&ti(n,n=v[0])?(yr(),Ie(p,1,1,Dt),vr(),p=gp(v),p.c(),be(p,1),p.m(l.parentNode,l)):p.p(v,S)},i(v){c||(be(p),c=!0)},o(v){Ie(p),c=!1},d(v){v&&De(l),p.d(v)}}}function gp(u){let n;const l=u[15].default,c=Yr(l,u,u[14],null);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v&16384)&&en(c,l,p,p[14],n?Qr(l,p[14],v,null):tn(p[14]),null)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function jy(u){let n,l,c=u[0]&&_p(u);return{c(){c&&c.c(),n=Bn()},m(p,v){c&&c.m(p,v),Be(p,n,v),l=!0},p(p,[v]){p[0]?c?(c.p(p,v),v&1&&be(c,1)):(c=_p(p),c.c(),be(c,1),c.m(n.parentNode,n)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr())},i(p){l||(be(c),l=!0)},o(p){Ie(c),l=!1},d(p){p&&De(n),c&&c.d(p)}}}function qy(u,n,l){let c,p,v,{$$slots:S={},$$scope:s}=n,{id:I=Oa("geojson")}=n,{data:M}=n,{generateId:B=!1}=n,{promoteId:j=void 0}=n,{filter:ie=void 0}=n,{lineMetrics:ae=void 0}=n,{cluster:ce=void 0}=n;const{map:ge,cluster:ve,self:Ee}=Sy();vt(u,ge,re=>l(13,p=re)),vt(u,ve,re=>l(16,v=re)),vt(u,Ee,re=>l(0,c=re));let W,ne=!0;return xo(()=>{c&&W&&p&&(Uy(ge,c,W),ei(Ee,c=null,c),l(11,W=void 0))}),u.$$set=re=>{"id"in re&&l(4,I=re.id),"data"in re&&l(5,M=re.data),"generateId"in re&&l(6,B=re.generateId),"promoteId"in re&&l(7,j=re.promoteId),"filter"in re&&l(8,ie=re.filter),"lineMetrics"in re&&l(9,ae=re.lineMetrics),"cluster"in re&&l(10,ce=re.cluster),"$$scope"in re&&l(14,s=re.$$scope)},u.$$.update=()=>{u.$$.dirty&1024&&ei(ve,v=ce,v),u.$$.dirty&12273&&p&&c!==I&&(ei(Ee,c=I,c),Vy(p,c,Du({type:"geojson",data:M,filter:ie,lineMetrics:ae,generateId:B,promoteId:j,cluster:!!ce,clusterMinPoints:ce==null?void 0:ce.minPoints,clusterMaxZoom:ce==null?void 0:ce.maxZoom,clusterRadius:ce==null?void 0:ce.radius,clusterProperties:ce==null?void 0:ce.properties}),re=>p&&re===c,()=>{c&&(l(11,W=p==null?void 0:p.getSource(c)),l(12,ne=!0))})),u.$$.dirty&8208&&(p==null||p.on("style.load",()=>{l(11,W=p==null?void 0:p.getSource(I))})),u.$$.dirty&6176&&W&&(ne?l(12,ne=!1):W.setData(M)),u.$$.dirty&3072&&(W==null||W.setClusterOptions(Du({cluster:!!ce,clusterMaxZoom:ce==null?void 0:ce.maxZoom,clusterRadius:ce==null?void 0:ce.radius})))},[c,ge,ve,Ee,I,M,B,j,ie,ae,ce,W,ne,p,s,S]}class Fn extends ci{constructor(n){super(),li(this,n,qy,jy,ti,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function Zy(u,n,l){let c;const{map:p}=Na();vt(u,p,ie=>l(8,c=ie));let{position:v="top-left"}=n,{positionOptions:S=void 0}=n,{fitBoundsOptions:s=void 0}=n,{trackUserLocation:I=!1}=n,{showAccuracyCircle:M=!0}=n,{showUserLocation:B=!0}=n,j=null;return xo(()=>{c!=null&&c.loaded()&&j&&c.removeControl(j)}),u.$$set=ie=>{"position"in ie&&l(1,v=ie.position),"positionOptions"in ie&&l(2,S=ie.positionOptions),"fitBoundsOptions"in ie&&l(3,s=ie.fitBoundsOptions),"trackUserLocation"in ie&&l(4,I=ie.trackUserLocation),"showAccuracyCircle"in ie&&l(5,M=ie.showAccuracyCircle),"showUserLocation"in ie&&l(6,B=ie.showUserLocation)},u.$$.update=()=>{u.$$.dirty&510&&c&&!j&&(l(7,j=new Wn.GeolocateControl({positionOptions:S,fitBoundsOptions:s,trackUserLocation:I,showAccuracyCircle:M,showUserLocation:B})),c.addControl(j,v))},[p,v,S,s,I,M,B,j,c]}class Gy extends ci{constructor(n){super(),li(this,n,Zy,null,ti,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function Xy(u){let n;const l=u[15].default,c=Yr(l,u,u[23],null);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v&8388608)&&en(c,l,p,p[23],n?Qr(l,p[23],v,null):tn(p[23]),null)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function Wy(u){let n,l,c;function p(S){u[16](S)}let v={id:u[1],type:"line",source:u[2],sourceLayer:u[3],beforeId:u[4],beforeLayerType:u[5],paint:u[6],layout:u[7],filter:u[8],minzoom:u[9],maxzoom:u[10],hoverCursor:u[11],manageHoverState:u[12],eventsIfTopMost:u[13],interactive:u[14],$$slots:{default:[Xy]},$$scope:{ctx:u}};return u[0]!==void 0&&(v.hovered=u[0]),n=new Nu({props:v}),gr.push(()=>_s(n,"hovered",p)),n.$on("click",u[17]),n.$on("dblclick",u[18]),n.$on("contextmenu",u[19]),n.$on("mouseenter",u[20]),n.$on("mousemove",u[21]),n.$on("mouseleave",u[22]),{c(){$e(n.$$.fragment)},m(S,s){We(n,S,s),c=!0},p(S,[s]){const I={};s&2&&(I.id=S[1]),s&4&&(I.source=S[2]),s&8&&(I.sourceLayer=S[3]),s&16&&(I.beforeId=S[4]),s&32&&(I.beforeLayerType=S[5]),s&64&&(I.paint=S[6]),s&128&&(I.layout=S[7]),s&256&&(I.filter=S[8]),s&512&&(I.minzoom=S[9]),s&1024&&(I.maxzoom=S[10]),s&2048&&(I.hoverCursor=S[11]),s&4096&&(I.manageHoverState=S[12]),s&8192&&(I.eventsIfTopMost=S[13]),s&16384&&(I.interactive=S[14]),s&8388608&&(I.$$scope={dirty:s,ctx:S}),!l&&s&1&&(l=!0,I.hovered=S[0],ms(()=>l=!1)),n.$set(I)},i(S){c||(be(n.$$.fragment,S),c=!0)},o(S){Ie(n.$$.fragment,S),c=!1},d(S){He(n,S)}}}function Hy(u,n,l){let{$$slots:c={},$$scope:p}=n,{id:v=Oa("line")}=n,{source:S=void 0}=n,{sourceLayer:s=void 0}=n,{beforeId:I=void 0}=n,{beforeLayerType:M=void 0}=n,{paint:B}=n,{layout:j=void 0}=n,{filter:ie=void 0}=n,{minzoom:ae=void 0}=n,{maxzoom:ce=void 0}=n,{hoverCursor:ge=void 0}=n,{manageHoverState:ve=!1}=n,{hovered:Ee=null}=n,{eventsIfTopMost:W=!1}=n,{interactive:ne=!0}=n;function re(we){Ee=we,l(0,Ee)}function _e(we){Vi.call(this,u,we)}function ze(we){Vi.call(this,u,we)}function Ce(we){Vi.call(this,u,we)}function Ae(we){Vi.call(this,u,we)}function Ue(we){Vi.call(this,u,we)}function je(we){Vi.call(this,u,we)}return u.$$set=we=>{"id"in we&&l(1,v=we.id),"source"in we&&l(2,S=we.source),"sourceLayer"in we&&l(3,s=we.sourceLayer),"beforeId"in we&&l(4,I=we.beforeId),"beforeLayerType"in we&&l(5,M=we.beforeLayerType),"paint"in we&&l(6,B=we.paint),"layout"in we&&l(7,j=we.layout),"filter"in we&&l(8,ie=we.filter),"minzoom"in we&&l(9,ae=we.minzoom),"maxzoom"in we&&l(10,ce=we.maxzoom),"hoverCursor"in we&&l(11,ge=we.hoverCursor),"manageHoverState"in we&&l(12,ve=we.manageHoverState),"hovered"in we&&l(0,Ee=we.hovered),"eventsIfTopMost"in we&&l(13,W=we.eventsIfTopMost),"interactive"in we&&l(14,ne=we.interactive),"$$scope"in we&&l(23,p=we.$$scope)},[Ee,v,S,s,I,M,B,j,ie,ae,ce,ge,ve,W,ne,c,re,_e,ze,Ce,Ae,Ue,je,p]}class Xo extends ci{constructor(n){super(),li(this,n,Hy,Wy,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function $y(u){let n=u.getCenter(),l=Math.round(u.getZoom()*100)/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),v=Math.round(n.lat*p)/p,S=Math.round(n.lng*p)/p,s=`${l}/${v}/${S}`,I=u.getBearing(),M=u.getPitch();return(I||M)&&(s+=`/${Math.round(I*10)/10}`),M&&(s+=`/${Math.round(M)}`),`#${s}`}function Ky(u){return u.replace("#","").split("/").map(parseFloat)}var Mu=yd;function yd(u,n){return u===n||u!==u&&n!==n?!0:typeof u!=typeof n||{}.toString.call(u)!={}.toString.call(n)||u!==Object(u)||!u?!1:Array.isArray(u)?yp(u,n):{}.toString.call(u)=="[object Set]"?yp(Array.from(u),Array.from(n)):{}.toString.call(u)=="[object Object]"?Yy(u,n):Jy(u,n)}function Jy(u,n){return u.toString()===n.toString()}function yp(u,n){var l=u.length;if(l!=n.length)return!1;for(var c=0;c<l;c++)if(!yd(u[c],n[c]))return!1;return!0}function Yy(u,n){var l=Object.keys(u),c=l.length;if(c!=Object.keys(n).length)return!1;for(var p=0;p<c;p++){var v=l[p];if(!(n.hasOwnProperty(v)&&yd(u[v],n[v])))return!1}return!0}function Qy(u,n,l){let c;const{map:p}=Na();vt(u,p,B=>l(6,c=B));let{position:v="top-left"}=n,{showCompass:S=!0}=n,{showZoom:s=!0}=n,{visualizePitch:I=!1}=n,M=null;return xo(()=>{c!=null&&c.loaded()&&M&&c.removeControl(M)}),u.$$set=B=>{"position"in B&&l(1,v=B.position),"showCompass"in B&&l(2,S=B.showCompass),"showZoom"in B&&l(3,s=B.showZoom),"visualizePitch"in B&&l(4,I=B.visualizePitch)},u.$$.update=()=>{u.$$.dirty&126&&c&&!M&&(l(5,M=new Wn.NavigationControl({showCompass:S,showZoom:s,visualizePitch:I})),c.addControl(M,v))},[p,v,S,s,I,M,c]}class e0 extends ci{constructor(n){super(),li(this,n,Qy,null,ti,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function t0(u,n,l){let c;const{map:p}=Na();vt(u,p,M=>l(5,c=M));let{position:v="bottom-left"}=n,{maxWidth:S=void 0}=n,{unit:s="metric"}=n,I=null;return xo(()=>{c!=null&&c.loaded()&&I&&c.removeControl(I)}),u.$$set=M=>{"position"in M&&l(1,v=M.position),"maxWidth"in M&&l(2,S=M.maxWidth),"unit"in M&&l(3,s=M.unit)},u.$$.update=()=>{u.$$.dirty&62&&c&&!I&&(l(4,I=new Wn.ScaleControl({maxWidth:S,unit:s})),c.addControl(I,v))},[p,v,S,s,I,c]}class i0 extends ci{constructor(n){super(),li(this,n,t0,null,ti,{position:1,maxWidth:2,unit:3})}}const r0=u=>({map:u[0]&8,loadedImages:u[0]&16,allImagesLoaded:u[0]&32}),vp=u=>({map:u[3],loadedImages:u[4],allImagesLoaded:u[5]});function bp(u){let n,l,c=u[2]&&xp(u);const p=u[34].default,v=Yr(p,u,u[33],vp);return{c(){c&&c.c(),n=et(),v&&v.c()},m(S,s){c&&c.m(S,s),Be(S,n,s),v&&v.m(S,s),l=!0},p(S,s){S[2]?c?(c.p(S,s),s[0]&4&&be(c,1)):(c=xp(S),c.c(),be(c,1),c.m(n.parentNode,n)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr()),v&&v.p&&(!l||s[0]&56|s[1]&4)&&en(v,p,S,S[33],l?Qr(p,S[33],s,r0):tn(S[33]),vp)},i(S){l||(be(c),be(v,S),l=!0)},o(S){Ie(c),Ie(v,S),l=!1},d(S){S&&De(n),c&&c.d(S),v&&v.d(S)}}}function xp(u){let n,l,c,p,v,S,s,I;return n=new e0({props:{position:u[6]}}),c=new Gy({props:{position:u[6],fitBoundsOptions:{maxZoom:12}}}),v=new Ny({props:{position:u[6]}}),s=new i0({props:{position:u[6]}}),{c(){$e(n.$$.fragment),l=et(),$e(c.$$.fragment),p=et(),$e(v.$$.fragment),S=et(),$e(s.$$.fragment)},m(M,B){We(n,M,B),Be(M,l,B),We(c,M,B),Be(M,p,B),We(v,M,B),Be(M,S,B),We(s,M,B),I=!0},p(M,B){const j={};B[0]&64&&(j.position=M[6]),n.$set(j);const ie={};B[0]&64&&(ie.position=M[6]),c.$set(ie);const ae={};B[0]&64&&(ae.position=M[6]),v.$set(ae);const ce={};B[0]&64&&(ce.position=M[6]),s.$set(ce)},i(M){I||(be(n.$$.fragment,M),be(c.$$.fragment,M),be(v.$$.fragment,M),be(s.$$.fragment,M),I=!0)},o(M){Ie(n.$$.fragment,M),Ie(c.$$.fragment,M),Ie(v.$$.fragment,M),Ie(s.$$.fragment,M),I=!1},d(M){M&&(De(l),De(p),De(S)),He(n,M),He(c,M),He(v,M),He(s,M)}}}function n0(u){let n,l,c,p,v,S=u[3]&&u[0]&&bp(u);return{c(){n=ye("div"),S&&S.c(),Ot(n,"class",l=cp(u[1])+" svelte-p00lfq"),hp(n,"expand-map",!u[1])},m(s,I){Be(s,n,I),S&&S.m(n,null),c=!0,p||(v=rd(u[9].call(null,n)),p=!0)},p(s,I){s[3]&&s[0]?S?(S.p(s,I),I[0]&9&&be(S,1)):(S=bp(s),S.c(),be(S,1),S.m(n,null)):S&&(yr(),Ie(S,1,1,()=>{S=null}),vr()),(!c||I[0]&2&&l!==(l=cp(s[1])+" svelte-p00lfq"))&&Ot(n,"class",l),(!c||I[0]&2)&&hp(n,"expand-map",!s[1])},i(s){c||(be(S),c=!0)},o(s){Ie(S),c=!1},d(s){s&&De(n),S&&S.d(),p=!1,v()}}}function o0(u,n,l){let c,p,v,S,{$$slots:s={},$$scope:I}=n,{map:M=null}=n,{class:B=void 0}=n,{style:j}=n,{diffStyleUpdates:ie=!1}=n,{center:ae=void 0}=n,{zoom:ce=void 0}=n,{pitch:ge=0}=n,{bearing:ve=0}=n,{bounds:Ee=void 0}=n,{hash:W=!1}=n,{loaded:ne=!1}=n,{minZoom:re=0}=n,{maxZoom:_e=22}=n,{zoomOnDoubleClick:ze=!0}=n,{interactive:Ce=!0}=n,{attributionControl:Ae=!0}=n,{cooperativeGestures:Ue=!1}=n,{preserveDrawingBuffer:je=!1}=n,{maxBounds:we=void 0}=n,{images:Te=[]}=n,{standardControls:xt=!1}=n,{filterLayers:bt=void 0}=n,{transformRequest:it=void 0}=n;const dt=fc(),{map:Pt,loadedImages:ut}=wy();vt(u,Pt,Je=>l(3,v=Je)),vt(u,ut,Je=>l(4,S=Je));let kt=new Set;function yi(Je){v!=null&&v.loaded()&&("url"in Je?(kt.add(Je.id),v.loadImage(Je.url,(qe,Ut)=>{kt.delete(Je.id),qe?dt("error",qe):Ut&&(v==null||v.addImage(Je.id,Ut,Je.options),S.add(Je.id),ut.set(S))})):(v.addImage(Je.id,Je.data,Je.options),S.add(Je.id),ut.set(S)))}let $t,Vt,Xt,hi;function ar(Je){if(W){let qe=Ky(window.location.hash);qe.length>=3&&(l(11,ce=qe[0]),l(10,ae=[qe[2],qe[1]])),qe.length==5&&(l(15,ve=qe[3]),l(14,ge=qe[4]))}return ei(Pt,v=new Wn.Map(Du({container:Je,style:j,center:ae,zoom:ce,pitch:ge,bearing:ve,minZoom:re,maxZoom:_e,interactive:Ce,preserveDrawingBuffer:je,maxBounds:we,bounds:Ee,attributionControl:Ae,transformRequest:it,cooperativeGestures:Ue})),v),v.on("load",qe=>{l(0,ne=!0),dt("load",v)}),v.on("error",qe=>dt("error",{...qe,map:v})),v.on("movestart",qe=>dt("movestart",{...qe,map:v})),v.on("moveend",qe=>{if(l(10,ae=qe.target.getCenter()),l(11,ce=qe.target.getZoom()),l(12,Ee=qe.target.getBounds()),dt("moveend",{...qe,map:v}),W){let Ut=window.location.href.replace(/(#.+)?$/,$y(v));window.history.replaceState(window.history.state,"",Ut)}}),v.on("zoomstart",qe=>dt("zoomstart",{...qe,map:v})),v.on("zoom",qe=>{l(11,ce=qe.target.getZoom()),dt("zoom",{...qe,map:v})}),v.on("zoomend",qe=>{l(11,ce=qe.target.getZoom()),dt("zoomend",{...qe,map:v})}),v.on("style.load",()=>{if(v){const qe=v.getStyle();if(l(30,$t=qe.layers.map(Ut=>Ut.id)),l(31,Vt=Object.keys(qe.sources)),hi)for(const[Ut,jt]of Object.entries(hi))v.addSource(Ut,jt);if(Xt)for(const Ut of Xt)v.addLayer(Ut)}}),v.on("styledata",qe=>{if(v&&bt){const Ut=v.getStyle().layers;if(Ut)for(let jt of Ut)bt(jt)||v.setLayoutProperty(jt.id,"visibility","none")}dt("styledata",{...qe,map:v})}),{destroy(){l(0,ne=!1),v==null||v.remove(),ei(Pt,v=null,v)}}}let Ti=j;return u.$$set=Je=>{"map"in Je&&l(13,M=Je.map),"class"in Je&&l(1,B=Je.class),"style"in Je&&l(16,j=Je.style),"diffStyleUpdates"in Je&&l(17,ie=Je.diffStyleUpdates),"center"in Je&&l(10,ae=Je.center),"zoom"in Je&&l(11,ce=Je.zoom),"pitch"in Je&&l(14,ge=Je.pitch),"bearing"in Je&&l(15,ve=Je.bearing),"bounds"in Je&&l(12,Ee=Je.bounds),"hash"in Je&&l(18,W=Je.hash),"loaded"in Je&&l(0,ne=Je.loaded),"minZoom"in Je&&l(19,re=Je.minZoom),"maxZoom"in Je&&l(20,_e=Je.maxZoom),"zoomOnDoubleClick"in Je&&l(21,ze=Je.zoomOnDoubleClick),"interactive"in Je&&l(22,Ce=Je.interactive),"attributionControl"in Je&&l(23,Ae=Je.attributionControl),"cooperativeGestures"in Je&&l(24,Ue=Je.cooperativeGestures),"preserveDrawingBuffer"in Je&&l(25,je=Je.preserveDrawingBuffer),"maxBounds"in Je&&l(26,we=Je.maxBounds),"images"in Je&&l(27,Te=Je.images),"standardControls"in Je&&l(2,xt=Je.standardControls),"filterLayers"in Je&&l(28,bt=Je.filterLayers),"transformRequest"in Je&&l(29,it=Je.transformRequest),"$$scope"in Je&&l(33,I=Je.$$scope)},u.$$.update=()=>{if(u.$$.dirty[0]&4&&l(6,c=typeof xt=="boolean"?void 0:xt),u.$$.dirty[0]&8&&l(13,M=v),u.$$.dirty[0]&134217737&&ne&&v!=null&&v.loaded())for(let Je of Te)!kt.has(Je.id)&&!v.hasImage(Je.id)&&yi(Je);if(u.$$.dirty[0]&134217744&&l(5,p=Te.every(Je=>S.has(Je.id))),u.$$.dirty[0]&1073938440|u.$$.dirty[1]&3&&v&&!Mu(j,Ti)){const Je=v.getStyle();if($t&&(Xt=Je.layers.filter(qe=>!$t.includes(qe.id))),Vt){const qe=Object.keys(Je.sources).filter(Ut=>!Vt.includes(Ut));hi={};for(const Ut of qe)hi[Ut]=Je.sources[Ut]}l(32,Ti=j),v.setStyle(j,{diff:ie})}u.$$.dirty[0]&1032&&ae&&!Mu(ae,v==null?void 0:v.getCenter())&&(v==null||v.panTo(ae)),u.$$.dirty[0]&2056&&ce&&!Mu(ce,v==null?void 0:v.getZoom())&&(v==null||v.zoomTo(ce)),u.$$.dirty[0]&4104&&Ee&&!Mu(Ee,v==null?void 0:v.getBounds())&&(v==null||v.fitBounds(Ee)),u.$$.dirty[0]&2097160&&(ze?v==null||v.doubleClickZoom.enable():v==null||v.doubleClickZoom.disable())},[ne,B,xt,v,S,p,c,Pt,ut,ar,ae,ce,Ee,M,ge,ve,j,ie,W,re,_e,ze,Ce,Ae,Ue,je,we,Te,bt,it,$t,Vt,Ti,I,s]}class s0 extends ci{constructor(n){super(),li(this,n,o0,n0,ti,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,cooperativeGestures:24,preserveDrawingBuffer:25,maxBounds:26,images:27,standardControls:2,filterLayers:28,transformRequest:29},null,[-1,-1])}}function a0(u){let n,l,c,p,v,S,s;const I=u[17].default,M=Yr(I,u,u[16],null);return{c(){n=ye("div"),M&&M.c(),Ot(n,"tabindex",l=u[1]?0:void 0),Ot(n,"role",c=u[1]?"button":void 0),La(n,"z-index",u[2])},m(B,j){Be(B,n,j),M&&M.m(n,null),v=!0,S||(s=[rd(u[6].call(null,n)),rd(p=l0.call(null,n,u[0])),Et(n,"click",u[18]),Et(n,"dblclick",u[19]),Et(n,"contextmenu",u[20]),Et(n,"mouseenter",u[21]),Et(n,"mouseleave",u[22]),Et(n,"mousemove",u[23]),Et(n,"keydown",u[7])],S=!0)},p(B,[j]){M&&M.p&&(!v||j&65536)&&en(M,I,B,B[16],v?Qr(I,B[16],j,null):tn(B[16]),null),(!v||j&2&&l!==(l=B[1]?0:void 0))&&Ot(n,"tabindex",l),(!v||j&2&&c!==(c=B[1]?"button":void 0))&&Ot(n,"role",c),p&&Ou(p.update)&&j&1&&p.update.call(null,B[0]),j&4&&La(n,"z-index",B[2])},i(B){v||(be(M,B),v=!0)},o(B){Ie(M,B),v=!1},d(B){B&&De(n),M&&M.d(B),S=!1,_n(s)}}}function l0(u,n){const l=u.className;function c(p){p?u.className=`${l} ${p}`:u.className=l}return c(n),{update:c}}function c0(u,n,l){let c,p,v,{$$slots:S={},$$scope:s}=n,{lngLat:I}=n,{class:M=void 0}=n,{interactive:B=!0}=n,{asButton:j=!1}=n,{draggable:ie=!1}=n,{feature:ae=null}=n,{offset:ce=void 0}=n,{zIndex:ge=void 0}=n,{rotation:ve=0}=n;const Ee=fc(),{map:W,layerEvent:ne,self:re}=ky();vt(u,W,it=>l(25,v=it)),vt(u,ne,it=>l(24,c=it)),vt(u,re,it=>l(15,p=it));function _e(it){ei(re,p=new Wn.Marker({element:it,rotation:ve,draggable:ie,offset:ce}).setLngLat(I).addTo(v),p);const dt=()=>Ae("dragstart"),Pt=()=>{ze(),Ae("drag")},ut=()=>{ze(),Ae("dragend")};return ie&&(p.on("dragstart",dt),p.on("drag",Pt),p.on("dragend",ut)),{destroy(){ie&&(p==null||p.off("dragstart",dt),p==null||p.off("drag",Pt),p==null||p.off("dragend",ut)),p==null||p.remove()}}}function ze(){let it=p==null?void 0:p.getLngLat();it&&(Array.isArray(I)?l(9,I=[it.lng,it.lat]):I&&"lon"in I?l(9,I={lon:it.lng,lat:it.lat}):l(9,I=it))}function Ce(it){it.key===" "&&(it.preventDefault(),it.stopPropagation(),Ae("click"))}function Ae(it){if(!B)return;let dt=p==null?void 0:p.getLngLat();if(!dt)return;const Pt=[dt.lng,dt.lat];let ut={map:v,marker:p,lngLat:Pt,features:[{type:"Feature",properties:(ae==null?void 0:ae.properties)??{},geometry:{type:"Point",coordinates:Pt}}]};ei(ne,c={...ut,layerType:"marker",type:it},c),Ee(it,ut)}const Ue=()=>Ae("click"),je=()=>Ae("dblclick"),we=()=>Ae("contextmenu"),Te=it=>{Ae("mouseenter")},xt=()=>{Ae("mouseleave")},bt=()=>Ae("mousemove");return u.$$set=it=>{"lngLat"in it&&l(9,I=it.lngLat),"class"in it&&l(0,M=it.class),"interactive"in it&&l(10,B=it.interactive),"asButton"in it&&l(1,j=it.asButton),"draggable"in it&&l(11,ie=it.draggable),"feature"in it&&l(12,ae=it.feature),"offset"in it&&l(13,ce=it.offset),"zIndex"in it&&l(2,ge=it.zIndex),"rotation"in it&&l(14,ve=it.rotation),"$$scope"in it&&l(16,s=it.$$scope)},u.$$.update=()=>{u.$$.dirty&33280&&(p==null||p.setLngLat(I)),u.$$.dirty&40960&&(p==null||p.setOffset(ce??[0,0])),u.$$.dirty&49152&&(p==null||p.setRotation(ve))},[M,j,ge,W,ne,re,_e,Ce,Ae,I,B,ie,ae,ce,ve,p,s,S,Ue,je,we,Te,xt,bt]}class wp extends ci{constructor(n){super(),li(this,n,c0,a0,ti,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2,rotation:14})}}const u0=u=>({features:u[0]&16,data:u[0]&16,map:u[0]&4,close:u[0]&1}),Sp=u=>{var n;return{features:u[4],data:(n=u[4])==null?void 0:n[0],map:u[2],close:u[31]}};function Tp(u){let n,l,c=(u[4]||u[3]instanceof Wn.Marker)&&kp(u);return{c(){n=ye("div"),c&&c.c()},m(p,v){Be(p,n,v),c&&c.m(n,null),u[32](n),l=!0},p(p,v){p[4]||p[3]instanceof Wn.Marker?c?(c.p(p,v),v[0]&24&&be(c,1)):(c=kp(p),c.c(),be(c,1),c.m(n,null)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr())},i(p){l||(be(c),l=!0)},o(p){Ie(c),l=!1},d(p){p&&De(n),c&&c.d(),u[32](null)}}}function kp(u){let n;const l=u[30].default,c=Yr(l,u,u[29],Sp);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v[0]&536870933)&&en(c,l,p,p[29],n?Qr(l,p[29],v,u0):tn(p[29]),Sp)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function h0(u){let n,l,c=u[9].default&&Tp(u);return{c(){c&&c.c(),n=Bn()},m(p,v){c&&c.m(p,v),Be(p,n,v),l=!0},p(p,v){p[9].default?c?(c.p(p,v),v[0]&512&&be(c,1)):(c=Tp(p),c.c(),be(c,1),c.m(n.parentNode,n)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr())},i(p){l||(be(c),l=!0)},o(p){Ie(c),l=!1},d(p){p&&De(n),c&&c.d(p)}}}function d0(u,n,l){let c,p,v,S,s,I,{$$slots:M={},$$scope:B}=n;const j=Xg(M);let{closeButton:ie=void 0}=n,{closeOnClickOutside:ae=!0}=n,{closeOnClickInside:ce=!1}=n,{closeOnMove:ge=!1}=n,{openOn:ve="click"}=n,{openIfTopMost:Ee=!0}=n,{focusAfterOpen:W=!0}=n,{anchor:ne=void 0}=n,{offset:re=void 0}=n,{popupClass:_e=void 0}=n,{maxWidth:ze=void 0}=n,{lngLat:Ce=void 0}=n,{html:Ae=void 0}=n,{open:Ue=!1}=n;const{map:je,popupTarget:we,layerEvent:Te,layer:xt,eventTopMost:bt}=Na();vt(u,je,Xe=>l(2,v=Xe)),vt(u,we,Xe=>l(3,s=Xe)),vt(u,Te,Xe=>l(28,S=Xe)),vt(u,xt,Xe=>l(35,I=Xe));const it=["click","dblclick","contextmenu"];let dt,Pt=!1,ut;function kt(){if(!dt)return;let Xe=dt.getElement();!Xe||Xe===ut||(ut=Xe,ve==="hover"&&(ut.style.pointerEvents="none"),ut.addEventListener("mouseenter",()=>{l(24,Pt=!0)},{passive:!0}),ut.addEventListener("mouseleave",()=>{l(24,Pt=!1)},{passive:!0}),ut.addEventListener("click",()=>{ce&&l(0,Ue=!1)},{passive:!0}))}dc(()=>{if(v)return v.on("click",Ut),v.on("contextmenu",Ut),typeof s=="string"&&(v.on("click",s,Xt),v.on("dblclick",s,Xt),v.on("contextmenu",s,Xt),v.on("mousemove",s,qe),v.on("mouseleave",s,Je),v.on("touchstart",s,ar),v.on("touchend",s,Ti)),()=>{v!=null&&v.loaded()&&(dt==null||dt.remove(),v.off("click",Ut),v.off("contextmenu",Ut),s instanceof Wn.Marker?s.getPopup()===dt&&s.setPopup(void 0):typeof s=="string"&&(v.off("click",s,Xt),v.off("dblclick",s,Xt),v.off("contextmenu",s,Xt),v.off("mousemove",s,qe),v.off("mouseleave",s,Je),v.off("touchstart",s,ar),v.off("touchend",s,Ti)))}});function yi(Xe){return Ee?!("marker"in Xe)&&!Iy(Xe)&&bt(Xe)!==I:!1}let $t=null,Vt="normal";function Xt(Xe){Xe.type===ve&&(yi(Xe)||("layerType"in Xe?Xe.layerType==="deckgl"?(l(10,Ce=Xe.coordinate),l(4,$t=Xe.object?[Xe.object]:null)):(l(10,Ce=Xe.lngLat),l(4,$t=Xe.features??[])):(l(10,Ce=Xe.lngLat),l(4,$t=Xe.features??[])),setTimeout(()=>l(0,Ue=!0))))}let hi=null;function ar(Xe){hi=Xe.point}function Ti(Xe){if(!hi||ve!=="hover")return;let Ii=hi.dist(Xe.point);hi=null,Ii<3&&(l(10,Ce=Xe.lngLat),l(4,$t=Xe.features??[]),dt.isOpen()?l(25,Vt="justOpened"):(l(25,Vt="opening"),l(0,Ue=!0)))}function Je(Xe){ve!=="hover"||hi||Vt!=="normal"||(l(0,Ue=!1),l(4,$t=null))}function qe(Xe){if(!(ve!=="hover"||hi||Vt!=="normal")){if(yi(Xe)){l(0,Ue=!1),l(4,$t=null);return}l(0,Ue=!0),l(4,$t=Xe.features??[]),l(10,Ce=Xe.lngLat)}}function Ut(Xe){if(Vt==="justOpened"){l(25,Vt="normal");return}if(!ae)return;let Ii=[ut,s instanceof Wn.Marker?s==null?void 0:s.getElement():null];Ue&&dt.isOpen()&&!Ii.some($i=>$i==null?void 0:$i.contains(Xe.originalEvent.target))&&(Xe.type==="contextmenu"&&ve==="contextmenu"||Xe.type!=="contextmenu")&&l(0,Ue=!1)}let jt;const ki=()=>l(0,Ue=!1);function Hi(Xe){gr[Xe?"unshift":"push"](()=>{jt=Xe,l(1,jt)})}return u.$$set=Xe=>{"closeButton"in Xe&&l(11,ie=Xe.closeButton),"closeOnClickOutside"in Xe&&l(12,ae=Xe.closeOnClickOutside),"closeOnClickInside"in Xe&&l(13,ce=Xe.closeOnClickInside),"closeOnMove"in Xe&&l(14,ge=Xe.closeOnMove),"openOn"in Xe&&l(15,ve=Xe.openOn),"openIfTopMost"in Xe&&l(16,Ee=Xe.openIfTopMost),"focusAfterOpen"in Xe&&l(17,W=Xe.focusAfterOpen),"anchor"in Xe&&l(18,ne=Xe.anchor),"offset"in Xe&&l(19,re=Xe.offset),"popupClass"in Xe&&l(20,_e=Xe.popupClass),"maxWidth"in Xe&&l(21,ze=Xe.maxWidth),"lngLat"in Xe&&l(10,Ce=Xe.lngLat),"html"in Xe&&l(22,Ae=Xe.html),"open"in Xe&&l(0,Ue=Xe.open),"$$scope"in Xe&&l(29,B=Xe.$$scope)},u.$$.update=()=>{if(u.$$.dirty[0]&14336&&l(27,c=ie??(!ae&&!ce)),u.$$.dirty[0]&146685952&&(dt||(l(23,dt=new Wn.Popup({closeButton:c,closeOnClick:!1,closeOnMove:ge,focusAfterOpen:W,maxWidth:ze,className:_e,anchor:ne,offset:re})),ut=dt.getElement(),dt.on("open",()=>{l(0,Ue=!0),kt()}),dt.on("close",Xe=>{l(0,Ue=!1)}))),u.$$.dirty[0]&8421384&&dt&&s instanceof Wn.Marker&&(ve==="click"?s.setPopup(dt):s.getPopup()===dt&&s.setPopup(void 0)),u.$$.dirty[0]&268468224&&it.includes(ve)&&(S==null?void 0:S.type)===ve&&(Xt(S),ei(Te,S=null,S)),u.$$.dirty[0]&268468224&&l(26,p=ve==="hover"&&((S==null?void 0:S.type)==="mousemove"||(S==null?void 0:S.type)==="mouseenter")),u.$$.dirty[0]&352354304&&ve==="hover"&&Te&&(p&&S&&(S.layerType==="deckgl"?(l(10,Ce=S.coordinate),l(4,$t=S.object?[S.object]:null)):(l(10,Ce=S.lngLat),l(4,$t=S.features??[]))),l(0,Ue=(p||Pt)??!1)),u.$$.dirty[0]&12582914&&(jt?dt.setDOMContent(jt):Ae&&dt.setHTML(Ae)),u.$$.dirty[0]&8389632&&Ce&&dt.setLngLat(Ce),u.$$.dirty[0]&41943045&&v){let Xe=dt.isOpen();Ue&&!Xe?(dt.addTo(v),Vt==="opening"&&l(25,Vt="justOpened")):!Ue&&Xe&&dt.remove()}},[Ue,jt,v,s,$t,je,we,Te,xt,j,Ce,ie,ae,ce,ge,ve,Ee,W,ne,re,_e,ze,Ae,dt,Pt,Vt,p,c,S,B,M,ki,Hi]}class wo extends ci{constructor(n){super(),li(this,n,d0,h0,ti,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function f0(u){let n;const l=u[16].default,c=Yr(l,u,u[24],null);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v&16777216)&&en(c,l,p,p[24],n?Qr(l,p[24],v,null):tn(p[24]),null)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function p0(u){let n,l,c;function p(S){u[17](S)}let v={id:u[1],type:"symbol",source:u[2],sourceLayer:u[3],beforeId:u[4],beforeLayerType:u[5],paint:u[6],layout:u[7],filter:u[8],applyToClusters:u[9],minzoom:u[10],maxzoom:u[11],hoverCursor:u[12],manageHoverState:u[13],eventsIfTopMost:u[14],interactive:u[15],$$slots:{default:[f0]},$$scope:{ctx:u}};return u[0]!==void 0&&(v.hovered=u[0]),n=new Nu({props:v}),gr.push(()=>_s(n,"hovered",p)),n.$on("click",u[18]),n.$on("dblclick",u[19]),n.$on("contextmenu",u[20]),n.$on("mouseenter",u[21]),n.$on("mousemove",u[22]),n.$on("mouseleave",u[23]),{c(){$e(n.$$.fragment)},m(S,s){We(n,S,s),c=!0},p(S,[s]){const I={};s&2&&(I.id=S[1]),s&4&&(I.source=S[2]),s&8&&(I.sourceLayer=S[3]),s&16&&(I.beforeId=S[4]),s&32&&(I.beforeLayerType=S[5]),s&64&&(I.paint=S[6]),s&128&&(I.layout=S[7]),s&256&&(I.filter=S[8]),s&512&&(I.applyToClusters=S[9]),s&1024&&(I.minzoom=S[10]),s&2048&&(I.maxzoom=S[11]),s&4096&&(I.hoverCursor=S[12]),s&8192&&(I.manageHoverState=S[13]),s&16384&&(I.eventsIfTopMost=S[14]),s&32768&&(I.interactive=S[15]),s&16777216&&(I.$$scope={dirty:s,ctx:S}),!l&&s&1&&(l=!0,I.hovered=S[0],ms(()=>l=!1)),n.$set(I)},i(S){c||(be(n.$$.fragment,S),c=!0)},o(S){Ie(n.$$.fragment,S),c=!1},d(S){He(n,S)}}}function m0(u,n,l){let{$$slots:c={},$$scope:p}=n,{id:v=Oa("symbol")}=n,{source:S=void 0}=n,{sourceLayer:s=void 0}=n,{beforeId:I=void 0}=n,{beforeLayerType:M=void 0}=n,{paint:B=void 0}=n,{layout:j=void 0}=n,{filter:ie=void 0}=n,{applyToClusters:ae=void 0}=n,{minzoom:ce=void 0}=n,{maxzoom:ge=void 0}=n,{hoverCursor:ve=void 0}=n,{manageHoverState:Ee=!1}=n,{hovered:W=null}=n,{eventsIfTopMost:ne=!1}=n,{interactive:re=!0}=n;function _e(Te){W=Te,l(0,W)}function ze(Te){Vi.call(this,u,Te)}function Ce(Te){Vi.call(this,u,Te)}function Ae(Te){Vi.call(this,u,Te)}function Ue(Te){Vi.call(this,u,Te)}function je(Te){Vi.call(this,u,Te)}function we(Te){Vi.call(this,u,Te)}return u.$$set=Te=>{"id"in Te&&l(1,v=Te.id),"source"in Te&&l(2,S=Te.source),"sourceLayer"in Te&&l(3,s=Te.sourceLayer),"beforeId"in Te&&l(4,I=Te.beforeId),"beforeLayerType"in Te&&l(5,M=Te.beforeLayerType),"paint"in Te&&l(6,B=Te.paint),"layout"in Te&&l(7,j=Te.layout),"filter"in Te&&l(8,ie=Te.filter),"applyToClusters"in Te&&l(9,ae=Te.applyToClusters),"minzoom"in Te&&l(10,ce=Te.minzoom),"maxzoom"in Te&&l(11,ge=Te.maxzoom),"hoverCursor"in Te&&l(12,ve=Te.hoverCursor),"manageHoverState"in Te&&l(13,Ee=Te.manageHoverState),"hovered"in Te&&l(0,W=Te.hovered),"eventsIfTopMost"in Te&&l(14,ne=Te.eventsIfTopMost),"interactive"in Te&&l(15,re=Te.interactive),"$$scope"in Te&&l(24,p=Te.$$scope)},[W,v,S,s,I,M,B,j,ie,ae,ce,ge,ve,Ee,ne,re,c,_e,ze,Ce,Ae,Ue,je,we,p]}class vm extends ci{constructor(n){super(),li(this,n,m0,p0,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var _c=Uint8Array,bm=Uint16Array,_0=Int32Array,g0=new _c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),y0=new _c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xm=function(u,n){for(var l=new bm(31),c=0;c<31;++c)l[c]=n+=1<<u[c-1];for(var p=new _0(l[30]),c=1;c<30;++c)for(var v=l[c];v<l[c+1];++v)p[v]=v-l[c]<<5|c;return{b:l,r:p}},wm=xm(g0,2),v0=wm.b,b0=wm.r;v0[28]=258,b0[258]=28;xm(y0,0);var x0=new bm(32768);for(Si=0;Si<32768;++Si)Uo=(Si&43690)>>1|(Si&21845)<<1,Uo=(Uo&52428)>>2|(Uo&13107)<<2,Uo=(Uo&61680)>>4|(Uo&3855)<<4,x0[Si]=((Uo&65280)>>8|(Uo&255)<<8)>>1;var Uo,Si,Vu=new _c(288);for(Si=0;Si<144;++Si)Vu[Si]=8;var Si;for(Si=144;Si<256;++Si)Vu[Si]=9;var Si;for(Si=256;Si<280;++Si)Vu[Si]=7;var Si;for(Si=280;Si<288;++Si)Vu[Si]=8;var Si,w0=new _c(32);for(Si=0;Si<32;++Si)w0[Si]=5;var Si,S0=new _c(0),T0=typeof TextDecoder<"u"&&new TextDecoder,k0=0;try{T0.decode(S0,{stream:!0}),k0=1}catch{}const I0=u=>({}),Ip=u=>({}),M0=u=>({}),Mp=u=>({});function C0(u){let n,l,c,p;const v=u[1].left,S=Yr(v,u,u[0],Mp),s=u[1].main,I=Yr(s,u,u[0],Ip);return{c(){n=ye("div"),S&&S.c(),l=et(),c=ye("div"),I&&I.c(),Ot(n,"class","left svelte-6kzmjs"),Ot(c,"class","main svelte-6kzmjs")},m(M,B){Be(M,n,B),S&&S.m(n,null),Be(M,l,B),Be(M,c,B),I&&I.m(c,null),p=!0},p(M,[B]){S&&S.p&&(!p||B&1)&&en(S,v,M,M[0],p?Qr(v,M[0],B,M0):tn(M[0]),Mp),I&&I.p&&(!p||B&1)&&en(I,s,M,M[0],p?Qr(s,M[0],B,I0):tn(M[0]),Ip)},i(M){p||(be(S,M),be(I,M),p=!0)},o(M){Ie(S,M),Ie(I,M),p=!1},d(M){M&&(De(n),De(l),De(c)),S&&S.d(M),I&&I.d(M)}}}function A0(u,n,l){let{$$slots:c={},$$scope:p}=n;return u.$$set=v=>{"$$scope"in v&&l(0,p=v.$$scope)},[p,c]}class E0 extends ci{constructor(n){super(),li(this,n,A0,C0,ti,{})}}function Cp(u){let n,l;return{c(){n=ye("div"),l=Gt(u[0]),Ot(n,"class","svelte-1uuov7f")},m(c,p){Be(c,n,p),fe(n,l)},p(c,p){p&1&&jr(l,c[0])},d(c){c&&De(n)}}}function P0(u){let n,l=u[0]&&Cp(u);return{c(){l&&l.c(),n=Bn()},m(c,p){l&&l.m(c,p),Be(c,n,p)},p(c,[p]){c[0]?l?l.p(c,p):(l=Cp(c),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null)},i:Dt,o:Dt,d(c){c&&De(n),l&&l.d(c)}}}function z0(u,n,l){let{msg:c=null}=n;return u.$$set=p=>{"msg"in p&&l(0,c=p.msg)},[c]}class Sm extends ci{constructor(n){super(),li(this,n,z0,P0,ti,{msg:0})}}const L0=u=>({dialog:u&1}),Ap=u=>({dialog:u[0]});function D0(u){let n,l,c,p,v;const S=u[4].default,s=Yr(S,u,u[3],Ap);return{c(){n=ye("dialog"),l=ye("div"),s&&s.c(),Ot(l,"class","svelte-4ltw9q"),n.open=!0,Ot(n,"class","svelte-4ltw9q")},m(I,M){Be(I,n,M),fe(n,l),s&&s.m(l,null),u[6](n),c=!0,p||(v=[Et(window,"click",u[1]),Et(window,"keydown",u[2]),Et(n,"close",u[5])],p=!0)},p(I,[M]){s&&s.p&&(!c||M&9)&&en(s,S,I,I[3],c?Qr(S,I[3],M,L0):tn(I[3]),Ap)},i(I){c||(be(s,I),c=!0)},o(I){Ie(s,I),c=!1},d(I){I&&De(n),s&&s.d(I),u[6](null),p=!1,_n(v)}}}function B0(u,n,l){let{$$slots:c={},$$scope:p}=n,v;function S(B){v.open&&B.target==v&&v.close()}function s(B){(B.key=="Escape"||B.key=="Enter")&&(B.stopPropagation(),v.close())}function I(B){Vi.call(this,u,B)}function M(B){gr[B?"unshift":"push"](()=>{v=B,l(0,v)})}return u.$$set=B=>{"$$scope"in B&&l(3,p=B.$$scope)},[v,S,s,p,c,I,M]}class Tm extends ci{constructor(n){super(),li(this,n,B0,D0,ti,{})}}var Jr=63710088e-1,vd={centimeters:Jr*100,centimetres:Jr*100,degrees:Jr/111325,feet:Jr*3.28084,inches:Jr*39.37,kilometers:Jr/1e3,kilometres:Jr/1e3,meters:Jr,metres:Jr,miles:Jr/1609.344,millimeters:Jr*1e3,millimetres:Jr*1e3,nauticalmiles:Jr/1852,radians:1,yards:Jr*1.0936},F0={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Jr,yards:1.0936133},cd={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Kn(u,n,l){l===void 0&&(l={});var c={type:"Feature"};return(l.id===0||l.id)&&(c.id=l.id),l.bbox&&(c.bbox=l.bbox),c.properties=n||{},c.geometry=u,c}function R0(u,n,l){switch(u){case"Point":return In(n).geometry;case"LineString":return Hn(n).geometry;case"Polygon":return bd(n).geometry;case"MultiPoint":return Im(n).geometry;case"MultiLineString":return km(n).geometry;case"MultiPolygon":return Mm(n).geometry;default:throw new Error(u+" is invalid")}}function In(u,n,l){if(l===void 0&&(l={}),!u)throw new Error("coordinates is required");if(!Array.isArray(u))throw new Error("coordinates must be an Array");if(u.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Bu(u[0])||!Bu(u[1]))throw new Error("coordinates must contain numbers");var c={type:"Point",coordinates:u};return Kn(c,n,l)}function O0(u,n,l){return l===void 0&&(l={}),Us(u.map(function(c){return In(c,n)}),l)}function bd(u,n,l){l===void 0&&(l={});for(var c=0,p=u;c<p.length;c++){var v=p[c];if(v.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var S=0;S<v[v.length-1].length;S++)if(v[v.length-1][S]!==v[0][S])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:u};return Kn(s,n,l)}function N0(u,n,l){return l===void 0&&(l={}),Us(u.map(function(c){return bd(c,n)}),l)}function Hn(u,n,l){if(l===void 0&&(l={}),u.length<2)throw new Error("coordinates must be an array of two or more positions");var c={type:"LineString",coordinates:u};return Kn(c,n,l)}function V0(u,n,l){return l===void 0&&(l={}),Us(u.map(function(c){return Hn(c,n)}),l)}function Us(u,n){n===void 0&&(n={});var l={type:"FeatureCollection"};return n.id&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.features=u,l}function km(u,n,l){l===void 0&&(l={});var c={type:"MultiLineString",coordinates:u};return Kn(c,n,l)}function Im(u,n,l){l===void 0&&(l={});var c={type:"MultiPoint",coordinates:u};return Kn(c,n,l)}function Mm(u,n,l){l===void 0&&(l={});var c={type:"MultiPolygon",coordinates:u};return Kn(c,n,l)}function U0(u,n,l){l===void 0&&(l={});var c={type:"GeometryCollection",geometries:u};return Kn(c,n,l)}function j0(u,n){if(n===void 0&&(n=0),n&&!(n>=0))throw new Error("precision must be a positive number");var l=Math.pow(10,n||0);return Math.round(u*l)/l}function xd(u,n){n===void 0&&(n="kilometers");var l=vd[n];if(!l)throw new Error(n+" units is invalid");return u*l}function Uu(u,n){n===void 0&&(n="kilometers");var l=vd[n];if(!l)throw new Error(n+" units is invalid");return u/l}function q0(u,n){return lc(Uu(u,n))}function Z0(u){var n=u%360;return n<0&&(n+=360),n}function lc(u){var n=u%(2*Math.PI);return n*180/Math.PI}function $n(u){var n=u%360;return n*Math.PI/180}function G0(u,n,l){if(n===void 0&&(n="kilometers"),l===void 0&&(l="kilometers"),!(u>=0))throw new Error("length must be a positive number");return xd(Uu(u,n),l)}function X0(u,n,l){if(n===void 0&&(n="meters"),l===void 0&&(l="kilometers"),!(u>=0))throw new Error("area must be a positive number");var c=cd[n];if(!c)throw new Error("invalid original units");var p=cd[l];if(!p)throw new Error("invalid final units");return u/c*p}function Bu(u){return!isNaN(u)&&u!==null&&!Array.isArray(u)}function wd(u){return!!u&&u.constructor===Object}function W0(u){if(!u)throw new Error("bbox is required");if(!Array.isArray(u))throw new Error("bbox must be an Array");if(u.length!==4&&u.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");u.forEach(function(n){if(!Bu(n))throw new Error("bbox must only contain numbers")})}function H0(u){if(!u)throw new Error("id is required");if(["string","number"].indexOf(typeof u)===-1)throw new Error("id must be a number or a string")}const $0=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:cd,bearingToAzimuth:Z0,convertArea:X0,convertLength:G0,degreesToRadians:$n,earthRadius:Jr,factors:vd,feature:Kn,featureCollection:Us,geometry:R0,geometryCollection:U0,isNumber:Bu,isObject:wd,lengthToDegrees:q0,lengthToRadians:Uu,lineString:Hn,lineStrings:V0,multiLineString:km,multiPoint:Im,multiPolygon:Mm,point:In,points:O0,polygon:bd,polygons:N0,radiansToDegrees:lc,radiansToLength:xd,round:j0,unitsFactors:F0,validateBBox:W0,validateId:H0},Symbol.toStringTag,{value:"Module"}));function cc(u){if(!u)throw new Error("coord is required");if(!Array.isArray(u)){if(u.type==="Feature"&&u.geometry!==null&&u.geometry.type==="Point")return u.geometry.coordinates;if(u.type==="Point")return u.coordinates}if(Array.isArray(u)&&u.length>=2&&!Array.isArray(u[0])&&!Array.isArray(u[1]))return u;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ra(u){if(Array.isArray(u))return u;if(u.type==="Feature"){if(u.geometry!==null)return u.geometry.coordinates}else if(u.coordinates)return u.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Cm(u,n,l){if(l===void 0&&(l={}),l.final===!0)return K0(u,n);var c=cc(u),p=cc(n),v=$n(c[0]),S=$n(p[0]),s=$n(c[1]),I=$n(p[1]),M=Math.sin(S-v)*Math.cos(I),B=Math.cos(s)*Math.sin(I)-Math.sin(s)*Math.cos(I)*Math.cos(S-v);return lc(Math.atan2(M,B))}function K0(u,n){var l=Cm(n,u);return l=(l+180)%360,l}function Hl(u,n,l){l===void 0&&(l={});var c=cc(u),p=cc(n),v=$n(p[1]-c[1]),S=$n(p[0]-c[0]),s=$n(c[1]),I=$n(p[1]),M=Math.pow(Math.sin(v/2),2)+Math.pow(Math.sin(S/2),2)*Math.cos(s)*Math.cos(I);return xd(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)),l.units)}function Ep(u,n,l,c){c===void 0&&(c={});var p=cc(u),v=$n(p[0]),S=$n(p[1]),s=$n(l),I=Uu(n,c.units),M=Math.asin(Math.sin(S)*Math.cos(I)+Math.cos(S)*Math.sin(I)*Math.cos(s)),B=v+Math.atan2(Math.sin(s)*Math.sin(I)*Math.cos(S),Math.cos(I)-Math.sin(S)*Math.sin(M)),j=lc(B),ie=lc(M);return In([j,ie],c.properties)}function gc(u,n,l){if(u!==null)for(var c,p,v,S,s,I,M,B=0,j=0,ie,ae=u.type,ce=ae==="FeatureCollection",ge=ae==="Feature",ve=ce?u.features.length:1,Ee=0;Ee<ve;Ee++){M=ce?u.features[Ee].geometry:ge?u.geometry:u,ie=M?M.type==="GeometryCollection":!1,s=ie?M.geometries.length:1;for(var W=0;W<s;W++){var ne=0,re=0;if(S=ie?M.geometries[W]:M,S!==null){I=S.coordinates;var _e=S.type;switch(B=l&&(_e==="Polygon"||_e==="MultiPolygon")?1:0,_e){case null:break;case"Point":if(n(I,j,Ee,ne,re)===!1)return!1;j++,ne++;break;case"LineString":case"MultiPoint":for(c=0;c<I.length;c++){if(n(I[c],j,Ee,ne,re)===!1)return!1;j++,_e==="MultiPoint"&&ne++}_e==="LineString"&&ne++;break;case"Polygon":case"MultiLineString":for(c=0;c<I.length;c++){for(p=0;p<I[c].length-B;p++){if(n(I[c][p],j,Ee,ne,re)===!1)return!1;j++}_e==="MultiLineString"&&ne++,_e==="Polygon"&&re++}_e==="Polygon"&&ne++;break;case"MultiPolygon":for(c=0;c<I.length;c++){for(re=0,p=0;p<I[c].length;p++){for(v=0;v<I[c][p].length-B;v++){if(n(I[c][p][v],j,Ee,ne,re)===!1)return!1;j++}re++}ne++}break;case"GeometryCollection":for(c=0;c<S.geometries.length;c++)if(gc(S.geometries[c],n,l)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function J0(u,n,l,c){var p=l;return gc(u,function(v,S,s,I,M){S===0&&l===void 0?p=v:p=n(p,v,S,s,I,M)},c),p}function Am(u,n){var l;switch(u.type){case"FeatureCollection":for(l=0;l<u.features.length&&n(u.features[l].properties,l)!==!1;l++);break;case"Feature":n(u.properties,0);break}}function Y0(u,n,l){var c=l;return Am(u,function(p,v){v===0&&l===void 0?c=p:c=n(c,p,v)}),c}function Fu(u,n){if(u.type==="Feature")n(u,0);else if(u.type==="FeatureCollection")for(var l=0;l<u.features.length&&n(u.features[l],l)!==!1;l++);}function Q0(u,n,l){var c=l;return Fu(u,function(p,v){v===0&&l===void 0?c=p:c=n(c,p,v)}),c}function ev(u){var n=[];return gc(u,function(l){n.push(l)}),n}function Sd(u,n){var l,c,p,v,S,s,I,M,B,j,ie=0,ae=u.type==="FeatureCollection",ce=u.type==="Feature",ge=ae?u.features.length:1;for(l=0;l<ge;l++){for(s=ae?u.features[l].geometry:ce?u.geometry:u,M=ae?u.features[l].properties:ce?u.properties:{},B=ae?u.features[l].bbox:ce?u.bbox:void 0,j=ae?u.features[l].id:ce?u.id:void 0,I=s?s.type==="GeometryCollection":!1,S=I?s.geometries.length:1,p=0;p<S;p++){if(v=I?s.geometries[p]:s,v===null){if(n(null,ie,M,B,j)===!1)return!1;continue}switch(v.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(v,ie,M,B,j)===!1)return!1;break}case"GeometryCollection":{for(c=0;c<v.geometries.length;c++)if(n(v.geometries[c],ie,M,B,j)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ie++}}function tv(u,n,l){var c=l;return Sd(u,function(p,v,S,s,I){v===0&&l===void 0?c=p:c=n(c,p,v,S,s,I)}),c}function Va(u,n){Sd(u,function(l,c,p,v,S){var s=l===null?null:l.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return n(Kn(l,p,{bbox:v,id:S}),c,0)===!1?!1:void 0}var I;switch(s){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon";break}for(var M=0;M<l.coordinates.length;M++){var B=l.coordinates[M],j={type:I,coordinates:B};if(n(Kn(j,p),c,M)===!1)return!1}})}function iv(u,n,l){var c=l;return Va(u,function(p,v,S){v===0&&S===0&&l===void 0?c=p:c=n(c,p,v,S)}),c}function Em(u,n){Va(u,function(l,c,p){var v=0;if(l.geometry){var S=l.geometry.type;if(!(S==="Point"||S==="MultiPoint")){var s,I=0,M=0,B=0;if(gc(l,function(j,ie,ae,ce,ge){if(s===void 0||c>I||ce>M||ge>B){s=j,I=c,M=ce,B=ge,v=0;return}var ve=Hn([s,j],l.properties);if(n(ve,c,p,ge,v)===!1)return!1;v++,s=j})===!1)return!1}}})}function rv(u,n,l){var c=l,p=!1;return Em(u,function(v,S,s,I,M){p===!1&&l===void 0?c=v:c=n(c,v,S,s,I,M),p=!0}),c}function Pm(u,n){if(!u)throw new Error("geojson is required");Va(u,function(l,c,p){if(l.geometry!==null){var v=l.geometry.type,S=l.geometry.coordinates;switch(v){case"LineString":if(n(l,c,p,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<S.length;s++)if(n(Hn(S[s],l.properties),c,p,s)===!1)return!1;break}}})}function nv(u,n,l){var c=l;return Pm(u,function(p,v,S,s){v===0&&l===void 0?c=p:c=n(c,p,v,S,s)}),c}function ov(u,n){if(n=n||{},!wd(n))throw new Error("options is invalid");var l=n.featureIndex||0,c=n.multiFeatureIndex||0,p=n.geometryIndex||0,v=n.segmentIndex||0,S=n.properties,s;switch(u.type){case"FeatureCollection":l<0&&(l=u.features.length+l),S=S||u.features[l].properties,s=u.features[l].geometry;break;case"Feature":S=S||u.properties,s=u.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=u;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var I=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return v<0&&(v=I.length+v-1),Hn([I[v],I[v+1]],S,n);case"Polygon":return p<0&&(p=I.length+p),v<0&&(v=I[p].length+v-1),Hn([I[p][v],I[p][v+1]],S,n);case"MultiLineString":return c<0&&(c=I.length+c),v<0&&(v=I[c].length+v-1),Hn([I[c][v],I[c][v+1]],S,n);case"MultiPolygon":return c<0&&(c=I.length+c),p<0&&(p=I[c].length+p),v<0&&(v=I[c][p].length-v-1),Hn([I[c][p][v],I[c][p][v+1]],S,n)}throw new Error("geojson is invalid")}function sv(u,n){if(n=n||{},!wd(n))throw new Error("options is invalid");var l=n.featureIndex||0,c=n.multiFeatureIndex||0,p=n.geometryIndex||0,v=n.coordIndex||0,S=n.properties,s;switch(u.type){case"FeatureCollection":l<0&&(l=u.features.length+l),S=S||u.features[l].properties,s=u.features[l].geometry;break;case"Feature":S=S||u.properties,s=u.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=u;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var I=s.coordinates;switch(s.type){case"Point":return In(I,S,n);case"MultiPoint":return c<0&&(c=I.length+c),In(I[c],S,n);case"LineString":return v<0&&(v=I.length+v),In(I[v],S,n);case"Polygon":return p<0&&(p=I.length+p),v<0&&(v=I[p].length+v),In(I[p][v],S,n);case"MultiLineString":return c<0&&(c=I.length+c),v<0&&(v=I[c].length+v),In(I[c][v],S,n);case"MultiPolygon":return c<0&&(c=I.length+c),p<0&&(p=I[c].length+p),v<0&&(v=I[c][p].length-v),In(I[c][p][v],S,n)}throw new Error("geojson is invalid")}const av=Object.freeze(Object.defineProperty({__proto__:null,coordAll:ev,coordEach:gc,coordReduce:J0,featureEach:Fu,featureReduce:Q0,findPoint:sv,findSegment:ov,flattenEach:Va,flattenReduce:iv,geomEach:Sd,geomReduce:tv,lineEach:Pm,lineReduce:nv,propEach:Am,propReduce:Y0,segmentEach:Em,segmentReduce:rv},Symbol.toStringTag,{value:"Module"}));function Pp(u){if(!u)throw new Error("geojson is required");var n=[];return Va(u,function(l){lv(l,n)}),Us(n)}function lv(u,n){var l=[],c=u.geometry;if(c!==null){switch(c.type){case"Polygon":l=Ra(c);break;case"LineString":l=[Ra(c)]}l.forEach(function(p){var v=cv(p,u.properties);v.forEach(function(S){S.id=n.length,n.push(S)})})}}function cv(u,n){var l=[];return u.reduce(function(c,p){var v=Hn([c,p],n);return v.bbox=uv(c,p),l.push(v),p}),l}function uv(u,n){var l=u[0],c=u[1],p=n[0],v=n[1],S=l<p?l:p,s=c<v?c:v,I=l>p?l:p,M=c>v?c:v;return[S,s,I,M]}var Td={exports:{}},zm={exports:{}};(function(u,n){(function(l,c){u.exports=c()})(fm,function(){function l(W,ne,re,_e,ze){(function Ce(Ae,Ue,je,we,Te){for(;we>je;){if(we-je>600){var xt=we-je+1,bt=Ue-je+1,it=Math.log(xt),dt=.5*Math.exp(2*it/3),Pt=.5*Math.sqrt(it*dt*(xt-dt)/xt)*(bt-xt/2<0?-1:1),ut=Math.max(je,Math.floor(Ue-bt*dt/xt+Pt)),kt=Math.min(we,Math.floor(Ue+(xt-bt)*dt/xt+Pt));Ce(Ae,Ue,ut,kt,Te)}var yi=Ae[Ue],$t=je,Vt=we;for(c(Ae,je,Ue),Te(Ae[we],yi)>0&&c(Ae,je,we);$t<Vt;){for(c(Ae,$t,Vt),$t++,Vt--;Te(Ae[$t],yi)<0;)$t++;for(;Te(Ae[Vt],yi)>0;)Vt--}Te(Ae[je],yi)===0?c(Ae,je,Vt):c(Ae,++Vt,we),Vt<=Ue&&(je=Vt+1),Ue<=Vt&&(we=Vt-1)}})(W,ne,re||0,_e||W.length-1,ze||p)}function c(W,ne,re){var _e=W[ne];W[ne]=W[re],W[re]=_e}function p(W,ne){return W<ne?-1:W>ne?1:0}var v=function(W){W===void 0&&(W=9),this._maxEntries=Math.max(4,W),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function S(W,ne,re){if(!re)return ne.indexOf(W);for(var _e=0;_e<ne.length;_e++)if(re(W,ne[_e]))return _e;return-1}function s(W,ne){I(W,0,W.children.length,ne,W)}function I(W,ne,re,_e,ze){ze||(ze=ve(null)),ze.minX=1/0,ze.minY=1/0,ze.maxX=-1/0,ze.maxY=-1/0;for(var Ce=ne;Ce<re;Ce++){var Ae=W.children[Ce];M(ze,W.leaf?_e(Ae):Ae)}return ze}function M(W,ne){return W.minX=Math.min(W.minX,ne.minX),W.minY=Math.min(W.minY,ne.minY),W.maxX=Math.max(W.maxX,ne.maxX),W.maxY=Math.max(W.maxY,ne.maxY),W}function B(W,ne){return W.minX-ne.minX}function j(W,ne){return W.minY-ne.minY}function ie(W){return(W.maxX-W.minX)*(W.maxY-W.minY)}function ae(W){return W.maxX-W.minX+(W.maxY-W.minY)}function ce(W,ne){return W.minX<=ne.minX&&W.minY<=ne.minY&&ne.maxX<=W.maxX&&ne.maxY<=W.maxY}function ge(W,ne){return ne.minX<=W.maxX&&ne.minY<=W.maxY&&ne.maxX>=W.minX&&ne.maxY>=W.minY}function ve(W){return{children:W,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ee(W,ne,re,_e,ze){for(var Ce=[ne,re];Ce.length;)if(!((re=Ce.pop())-(ne=Ce.pop())<=_e)){var Ae=ne+Math.ceil((re-ne)/_e/2)*_e;l(W,Ae,ne,re,ze),Ce.push(ne,Ae,Ae,re)}}return v.prototype.all=function(){return this._all(this.data,[])},v.prototype.search=function(W){var ne=this.data,re=[];if(!ge(W,ne))return re;for(var _e=this.toBBox,ze=[];ne;){for(var Ce=0;Ce<ne.children.length;Ce++){var Ae=ne.children[Ce],Ue=ne.leaf?_e(Ae):Ae;ge(W,Ue)&&(ne.leaf?re.push(Ae):ce(W,Ue)?this._all(Ae,re):ze.push(Ae))}ne=ze.pop()}return re},v.prototype.collides=function(W){var ne=this.data;if(!ge(W,ne))return!1;for(var re=[];ne;){for(var _e=0;_e<ne.children.length;_e++){var ze=ne.children[_e],Ce=ne.leaf?this.toBBox(ze):ze;if(ge(W,Ce)){if(ne.leaf||ce(W,Ce))return!0;re.push(ze)}}ne=re.pop()}return!1},v.prototype.load=function(W){if(!W||!W.length)return this;if(W.length<this._minEntries){for(var ne=0;ne<W.length;ne++)this.insert(W[ne]);return this}var re=this._build(W.slice(),0,W.length-1,0);if(this.data.children.length)if(this.data.height===re.height)this._splitRoot(this.data,re);else{if(this.data.height<re.height){var _e=this.data;this.data=re,re=_e}this._insert(re,this.data.height-re.height-1,!0)}else this.data=re;return this},v.prototype.insert=function(W){return W&&this._insert(W,this.data.height-1),this},v.prototype.clear=function(){return this.data=ve([]),this},v.prototype.remove=function(W,ne){if(!W)return this;for(var re,_e,ze,Ce=this.data,Ae=this.toBBox(W),Ue=[],je=[];Ce||Ue.length;){if(Ce||(Ce=Ue.pop(),_e=Ue[Ue.length-1],re=je.pop(),ze=!0),Ce.leaf){var we=S(W,Ce.children,ne);if(we!==-1)return Ce.children.splice(we,1),Ue.push(Ce),this._condense(Ue),this}ze||Ce.leaf||!ce(Ce,Ae)?_e?(re++,Ce=_e.children[re],ze=!1):Ce=null:(Ue.push(Ce),je.push(re),re=0,_e=Ce,Ce=Ce.children[0])}return this},v.prototype.toBBox=function(W){return W},v.prototype.compareMinX=function(W,ne){return W.minX-ne.minX},v.prototype.compareMinY=function(W,ne){return W.minY-ne.minY},v.prototype.toJSON=function(){return this.data},v.prototype.fromJSON=function(W){return this.data=W,this},v.prototype._all=function(W,ne){for(var re=[];W;)W.leaf?ne.push.apply(ne,W.children):re.push.apply(re,W.children),W=re.pop();return ne},v.prototype._build=function(W,ne,re,_e){var ze,Ce=re-ne+1,Ae=this._maxEntries;if(Ce<=Ae)return s(ze=ve(W.slice(ne,re+1)),this.toBBox),ze;_e||(_e=Math.ceil(Math.log(Ce)/Math.log(Ae)),Ae=Math.ceil(Ce/Math.pow(Ae,_e-1))),(ze=ve([])).leaf=!1,ze.height=_e;var Ue=Math.ceil(Ce/Ae),je=Ue*Math.ceil(Math.sqrt(Ae));Ee(W,ne,re,je,this.compareMinX);for(var we=ne;we<=re;we+=je){var Te=Math.min(we+je-1,re);Ee(W,we,Te,Ue,this.compareMinY);for(var xt=we;xt<=Te;xt+=Ue){var bt=Math.min(xt+Ue-1,Te);ze.children.push(this._build(W,xt,bt,_e-1))}}return s(ze,this.toBBox),ze},v.prototype._chooseSubtree=function(W,ne,re,_e){for(;_e.push(ne),!ne.leaf&&_e.length-1!==re;){for(var ze=1/0,Ce=1/0,Ae=void 0,Ue=0;Ue<ne.children.length;Ue++){var je=ne.children[Ue],we=ie(je),Te=(xt=W,bt=je,(Math.max(bt.maxX,xt.maxX)-Math.min(bt.minX,xt.minX))*(Math.max(bt.maxY,xt.maxY)-Math.min(bt.minY,xt.minY))-we);Te<Ce?(Ce=Te,ze=we<ze?we:ze,Ae=je):Te===Ce&&we<ze&&(ze=we,Ae=je)}ne=Ae||ne.children[0]}var xt,bt;return ne},v.prototype._insert=function(W,ne,re){var _e=re?W:this.toBBox(W),ze=[],Ce=this._chooseSubtree(_e,this.data,ne,ze);for(Ce.children.push(W),M(Ce,_e);ne>=0&&ze[ne].children.length>this._maxEntries;)this._split(ze,ne),ne--;this._adjustParentBBoxes(_e,ze,ne)},v.prototype._split=function(W,ne){var re=W[ne],_e=re.children.length,ze=this._minEntries;this._chooseSplitAxis(re,ze,_e);var Ce=this._chooseSplitIndex(re,ze,_e),Ae=ve(re.children.splice(Ce,re.children.length-Ce));Ae.height=re.height,Ae.leaf=re.leaf,s(re,this.toBBox),s(Ae,this.toBBox),ne?W[ne-1].children.push(Ae):this._splitRoot(re,Ae)},v.prototype._splitRoot=function(W,ne){this.data=ve([W,ne]),this.data.height=W.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},v.prototype._chooseSplitIndex=function(W,ne,re){for(var _e,ze,Ce,Ae,Ue,je,we,Te=1/0,xt=1/0,bt=ne;bt<=re-ne;bt++){var it=I(W,0,bt,this.toBBox),dt=I(W,bt,re,this.toBBox),Pt=(ze=it,Ce=dt,Ae=void 0,Ue=void 0,je=void 0,we=void 0,Ae=Math.max(ze.minX,Ce.minX),Ue=Math.max(ze.minY,Ce.minY),je=Math.min(ze.maxX,Ce.maxX),we=Math.min(ze.maxY,Ce.maxY),Math.max(0,je-Ae)*Math.max(0,we-Ue)),ut=ie(it)+ie(dt);Pt<Te?(Te=Pt,_e=bt,xt=ut<xt?ut:xt):Pt===Te&&ut<xt&&(xt=ut,_e=bt)}return _e||re-ne},v.prototype._chooseSplitAxis=function(W,ne,re){var _e=W.leaf?this.compareMinX:B,ze=W.leaf?this.compareMinY:j;this._allDistMargin(W,ne,re,_e)<this._allDistMargin(W,ne,re,ze)&&W.children.sort(_e)},v.prototype._allDistMargin=function(W,ne,re,_e){W.children.sort(_e);for(var ze=this.toBBox,Ce=I(W,0,ne,ze),Ae=I(W,re-ne,re,ze),Ue=ae(Ce)+ae(Ae),je=ne;je<re-ne;je++){var we=W.children[je];M(Ce,W.leaf?ze(we):we),Ue+=ae(Ce)}for(var Te=re-ne-1;Te>=ne;Te--){var xt=W.children[Te];M(Ae,W.leaf?ze(xt):xt),Ue+=ae(Ae)}return Ue},v.prototype._adjustParentBBoxes=function(W,ne,re){for(var _e=re;_e>=0;_e--)M(ne[_e],W)},v.prototype._condense=function(W){for(var ne=W.length-1,re=void 0;ne>=0;ne--)W[ne].children.length===0?ne>0?(re=W[ne-1].children).splice(re.indexOf(W[ne]),1):this.clear():s(W[ne],this.toBBox)},v})})(zm);var hv=zm.exports;const dv=mm($0),Lm=mm(av);var kd={};Object.defineProperty(kd,"__esModule",{value:!0});var fv=Lm;function ud(u){var n=[1/0,1/0,-1/0,-1/0];return fv.coordEach(u,function(l){n[0]>l[0]&&(n[0]=l[0]),n[1]>l[1]&&(n[1]=l[1]),n[2]<l[0]&&(n[2]=l[0]),n[3]<l[1]&&(n[3]=l[1])}),n}ud.default=ud;kd.default=ud;var bo=hv,Dm=dv,Bm=Lm,Ea=kd.default,pv=Bm.featureEach;Bm.coordEach;Dm.polygon;var zp=Dm.featureCollection;function Fm(u){var n=new bo(u);return n.insert=function(l){if(l.type!=="Feature")throw new Error("invalid feature");return l.bbox=l.bbox?l.bbox:Ea(l),bo.prototype.insert.call(this,l)},n.load=function(l){var c=[];return Array.isArray(l)?l.forEach(function(p){if(p.type!=="Feature")throw new Error("invalid features");p.bbox=p.bbox?p.bbox:Ea(p),c.push(p)}):pv(l,function(p){if(p.type!=="Feature")throw new Error("invalid features");p.bbox=p.bbox?p.bbox:Ea(p),c.push(p)}),bo.prototype.load.call(this,c)},n.remove=function(l,c){if(l.type!=="Feature")throw new Error("invalid feature");return l.bbox=l.bbox?l.bbox:Ea(l),bo.prototype.remove.call(this,l,c)},n.clear=function(){return bo.prototype.clear.call(this)},n.search=function(l){var c=bo.prototype.search.call(this,this.toBBox(l));return zp(c)},n.collides=function(l){return bo.prototype.collides.call(this,this.toBBox(l))},n.all=function(){var l=bo.prototype.all.call(this);return zp(l)},n.toJSON=function(){return bo.prototype.toJSON.call(this)},n.fromJSON=function(l){return bo.prototype.fromJSON.call(this,l)},n.toBBox=function(l){var c;if(l.bbox)c=l.bbox;else if(Array.isArray(l)&&l.length===4)c=l;else if(Array.isArray(l)&&l.length===6)c=[l[0],l[1],l[3],l[4]];else if(l.type==="Feature")c=Ea(l);else if(l.type==="FeatureCollection")c=Ea(l);else throw new Error("invalid geojson");return{minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]}},n}Td.exports=Fm;Td.exports.default=Fm;var mv=Td.exports;const _v=pm(mv);function gv(u,n){var l={},c=[];if(u.type==="LineString"&&(u=Kn(u)),n.type==="LineString"&&(n=Kn(n)),u.type==="Feature"&&n.type==="Feature"&&u.geometry!==null&&n.geometry!==null&&u.geometry.type==="LineString"&&n.geometry.type==="LineString"&&u.geometry.coordinates.length===2&&n.geometry.coordinates.length===2){var p=Lp(u,n);return p&&c.push(p),Us(c)}var v=_v();return v.load(Pp(n)),Fu(Pp(u),function(S){Fu(v.search(S),function(s){var I=Lp(S,s);if(I){var M=Ra(I).join(",");l[M]||(l[M]=!0,c.push(I))}})}),Us(c)}function Lp(u,n){var l=Ra(u),c=Ra(n);if(l.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(c.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var p=l[0][0],v=l[0][1],S=l[1][0],s=l[1][1],I=c[0][0],M=c[0][1],B=c[1][0],j=c[1][1],ie=(j-M)*(S-p)-(B-I)*(s-v),ae=(B-I)*(v-M)-(j-M)*(p-I),ce=(S-p)*(v-M)-(s-v)*(p-I);if(ie===0)return null;var ge=ae/ie,ve=ce/ie;if(ge>=0&&ge<=1&&ve>=0&&ve<=1){var Ee=p+ge*(S-p),W=v+ge*(s-v);return In([Ee,W])}return null}function yv(u,n,l){l===void 0&&(l={});var c=In([1/0,1/0],{dist:1/0}),p=0;return Va(u,function(v){for(var S=Ra(v),s=0;s<S.length-1;s++){var I=In(S[s]);I.properties.dist=Hl(n,I,l);var M=In(S[s+1]);M.properties.dist=Hl(n,M,l);var B=Hl(I,M,l),j=Math.max(I.properties.dist,M.properties.dist),ie=Cm(I,M),ae=Ep(n,j,ie+90,l),ce=Ep(n,j,ie-90,l),ge=gv(Hn([ae.geometry.coordinates,ce.geometry.coordinates]),Hn([I.geometry.coordinates,M.geometry.coordinates])),ve=null;ge.features.length>0&&(ve=ge.features[0],ve.properties.dist=Hl(n,ve,l),ve.properties.location=p+Hl(I,ve,l)),I.properties.dist<c.properties.dist&&(c=I,c.properties.index=s,c.properties.location=p),M.properties.dist<c.properties.dist&&(c=M,c.properties.index=s+1,c.properties.location=p+B),ve&&ve.properties.dist<c.properties.dist&&(c=ve,c.properties.index=s),p+=B}}),c}const Rm=Wi({type:"FeatureCollection",features:[]}),Om=Wi(0),vv=100;class bv{constructor(n){gi(this,"map");gi(this,"active");gi(this,"eventListenersSuccess");gi(this,"eventListenersUpdated");gi(this,"eventListenersFailure");gi(this,"points");gi(this,"cursor");gi(this,"hover");gi(this,"dragFrom");gi(this,"previousStates");gi(this,"onMouseMove",n=>{if(this.active&&!this.dragFrom)this.recalculateHovering(n);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let l=this.dragFrom[0]-n.lngLat.lng,c=this.dragFrom[1]-n.lngLat.lat;for(let p of this.points)p[0]-=l,p[1]-=c}else this.points[this.hover]=n.lngLat.toArray();this.dragFrom=n.lngLat.toArray(),this.redraw()}});gi(this,"onClick",n=>{if(this.beforeUpdate(),this.active&&this.cursor){let l=[];if(Dp(this.points).forEach((c,p)=>{l.push([p+1,yv(c,this.cursor).properties.dist])}),l.sort((c,p)=>c[1]-p[1]),l.length>0){let c=l[0][0];this.points.splice(c,0,this.cursor.geometry.coordinates),this.hover=c}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(n))});gi(this,"onDoubleClick",n=>{this.active&&(n.preventDefault(),this.cursor=td(n.lngLat.toArray()),this.onClick(n),this.finish())});gi(this,"onMouseDown",n=>{this.active&&!this.dragFrom&&this.hover!=null&&(n.preventDefault(),this.cursor=null,this.dragFrom=n.lngLat.toArray(),this.beforeUpdate(),this.redraw())});gi(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});gi(this,"onKeypress",n=>{this.active&&(n.key=="Enter"?(n.stopPropagation(),this.finish()):n.key=="z"&&n.ctrlKey&&this.undo())});gi(this,"onKeyDown",n=>{this.active&&n.key=="Escape"&&(n.stopPropagation(),this.cancel())});this.map=n,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let n=this.polygonFeature();if(n)for(let l of this.eventListenersSuccess)l(n);else for(let l of this.eventListenersFailure)l();this.stop()}cancel(){for(let n of this.eventListenersFailure)n();this.stop()}addEventListenerSuccess(n){this.eventListenersSuccess.push(n)}addEventListenerUpdated(n){this.eventListenersUpdated.push(n)}addEventListenerFailure(n){this.eventListenersFailure.push(n)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(n){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(n.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let n={type:"FeatureCollection",features:[]};this.points.forEach((p,v)=>{let S=td(p);S.properties.hover=this.hover==v,S.properties.idx=v,n.features.push(S)}),n.features=n.features.concat(Dp(this.points));let l=this.polygonFeature();l&&(l.properties.hover=this.hover=="polygon",n.features.push(l)),Rm.set(n);let c="crosshair";this.hover!=null&&(c=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=c,Om.set(this.previousStates.length)}pointsUpdated(){let n=this.polygonFeature();if(n)for(let l of this.eventListenersUpdated)l(n)}recalculateHovering(n){this.cursor=null,this.hover=null;for(let l of this.map.queryRenderedFeatures(n.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(l.geometry.type=="Polygon"){this.hover="polygon";break}else if(l.geometry.type=="Point"&&Object.hasOwn(l.properties,"idx")){this.hover=l.properties.idx;break}this.hover==null&&(this.cursor=td(n.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let n=this.points.map(jm),l=[JSON.parse(JSON.stringify(n))];return l[0].push(JSON.parse(JSON.stringify(l[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:l},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>vv&&this.previousStates.shift()}}function Dp(u){let n=[];for(let l=0;l<u.length-1;l++)n.push({type:"Feature",geometry:{type:"LineString",coordinates:[u[l],u[l+1]]},properties:{}});return u.length>=3&&n.push({type:"Feature",geometry:{type:"LineString",coordinates:[u[u.length-1],u[0]]},properties:{}}),n}function xv(u){let n,l,c;return{c(){n=Gt("Undo ("),l=Gt(u[1]),c=Gt(")")},m(p,v){Be(p,n,v),Be(p,l,v),Be(p,c,v)},p(p,v){v&2&&jr(l,p[1])},d(p){p&&(De(n),De(l),De(c))}}}function wv(u){let n;return{c(){n=Gt("Undo")},m(l,c){Be(l,n,c)},p:Dt,d(l){l&&De(n)}}}function Sv(u){let n,l,c,p,v,S;function s(B,j){return B[1]==0?wv:xv}let I=s(u),M=I(u);return{c(){n=ye("button"),M.c(),c=et(),p=ye("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,n.disabled=l=u[1]==0},m(B,j){Be(B,n,j),M.m(n,null),Be(B,c,j),Be(B,p,j),v||(S=Et(n,"click",u[2]),v=!0)},p(B,[j]){I===(I=s(B))&&M?M.p(B,j):(M.d(1),M=I(B),M&&(M.c(),M.m(n,null))),j&2&&l!==(l=B[1]==0)&&(n.disabled=l)},i:Dt,o:Dt,d(B){B&&(De(n),De(c),De(p)),M.d(),v=!1,S()}}}function Tv(u,n,l){let c;vt(u,Om,S=>l(1,c=S));let{polygonTool:p}=n;const v=()=>p.undo();return u.$$set=S=>{"polygonTool"in S&&l(0,p=S.polygonTool)},[p,c,v]}class kv extends ci{constructor(n){super(),li(this,n,Tv,Sv,ti,{polygonTool:0})}}function Iv(u){let n,l,c,p,v,S,s,I,M;return{c(){n=ye("div"),l=ye("button"),l.textContent="Import current view",c=et(),p=ye("i"),p.textContent="or...",v=et(),S=ye("div"),s=ye("button"),s.textContent="Draw an area to import on the map",Ot(l,"type","button"),Ot(s,"type","button")},m(B,j){Be(B,n,j),fe(n,l),Be(B,c,j),Be(B,p,j),Be(B,v,j),Be(B,S,j),fe(S,s),I||(M=[Et(l,"click",u[1]),Et(s,"click",u[2])],I=!0)},p:Dt,i:Dt,o:Dt,d(B){B&&(De(n),De(c),De(p),De(v),De(S)),I=!1,_n(M)}}}function Mv(u){let n,l;return n=new kv({props:{polygonTool:u[0]}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&1&&(v.polygonTool=c[0]),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Cv(u){let n,l,c,p;const v=[Mv,Iv],S=[];function s(I,M){return I[0]?0:1}return n=s(u),l=S[n]=v[n](u),{c(){l.c(),c=Bn()},m(I,M){S[n].m(I,M),Be(I,c,M),p=!0},p(I,[M]){let B=n;n=s(I),n===B?S[n].p(I,M):(yr(),Ie(S[B],1,1,()=>{S[B]=null}),vr(),l=S[n],l?l.p(I,M):(l=S[n]=v[n](I),l.c()),be(l,1),l.m(c.parentNode,c))},i(I){p||(be(l),p=!0)},o(I){Ie(l),p=!1},d(I){I&&De(c),S[n].d(I)}}}function $l(u){return[u.lng,u.lat]}function Av(u,n,l){let{map:c}=n;const p=fc();let v=null;async function S(B){try{p("loading","Loading from Overpass");let ie=await(await fetch(qm(B))).text();p("gotXml",ie)}catch(j){p("error",j.toString())}}function s(){let B=c.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[$l(B.getSouthWest()),$l(B.getNorthWest()),$l(B.getNorthEast()),$l(B.getSouthEast()),$l(B.getSouthWest())]],type:"Polygon"}}}async function I(){if(c){if(c.getZoom()<13){p("error","Zoom in more to import");return}await S(s())}}function M(){c&&(l(0,v=new bv(c)),v.startNew(),v.addEventListenerSuccess(async B=>{l(0,v=null),await S(B)}),v.addEventListenerFailure(()=>{l(0,v=null)}))}return u.$$set=B=>{"map"in B&&l(3,c=B.map)},[v,I,M,c]}class Ev extends ci{constructor(n){super(),li(this,n,Av,Cv,ti,{map:3})}}function Bp(u,n,l){const c=u.slice();return c[1]=n[l][0],c[2]=n[l][1],c}function Fp(u){let n,l,c=u[1]+"",p,v,S=u[2]+"",s;return{c(){n=ye("tr"),l=ye("td"),p=Gt(c),v=ye("td"),s=Gt(S)},m(I,M){Be(I,n,M),fe(n,l),fe(l,p),fe(n,v),fe(v,s)},p(I,M){M&1&&c!==(c=I[1]+"")&&jr(p,c),M&1&&S!==(S=I[2]+"")&&jr(s,S)},d(I){I&&De(n)}}}function Pv(u){let n,l,c=Fa(Object.entries(u[0])),p=[];for(let v=0;v<c.length;v+=1)p[v]=Fp(Bp(u,c,v));return{c(){n=ye("table"),l=ye("tbody");for(let v=0;v<p.length;v+=1)p[v].c();Ot(n,"class","svelte-lh2o9l")},m(v,S){Be(v,n,S),fe(n,l);for(let s=0;s<p.length;s+=1)p[s]&&p[s].m(l,null)},p(v,[S]){if(S&1){c=Fa(Object.entries(v[0]));let s;for(s=0;s<c.length;s+=1){const I=Bp(v,c,s);p[s]?p[s].p(I,S):(p[s]=Fp(I),p[s].c(),p[s].m(l,null))}for(;s<p.length;s+=1)p[s].d(1);p.length=c.length}},i:Dt,o:Dt,d(v){v&&De(n),md(p,v)}}}function zv(u,n,l){let{properties:c}=n;return u.$$set=p=>{"properties"in p&&l(0,c=p.properties)},[c]}class Ua extends ci{constructor(n){super(),li(this,n,zv,Pv,ti,{properties:0})}}const Nm=["==",["geometry-type"],"Polygon"],Vm=["==",["geometry-type"],"LineString"],Um=["==",["geometry-type"],"Point"];function hd(u,n,l){let c=["match",u];for(let[p,v]of Object.entries(n))c.push(p),c.push(v);return c.push(l),c}function Lv(u,n){let l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(n)),l.setAttribute("download",u),document.body.appendChild(l),l.click(),document.body.removeChild(l)}function Rt(u){if(u==null||u==null)throw new Error("Oops, notNull given something null");return u}function td(u){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:jm(u)}}}function jm(u){return[Math.round(u[0]*1e7)/1e7,Math.round(u[1]*1e7)/1e7]}function qm(u){let n='poly:"';for(let[c,p]of u.geometry.coordinates[0])n+=`${p} ${c} `;return n=n.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${n}); node(w)->.x; <;); out meta;`}`}const Zm=Wi({type:"FeatureCollection",features:[]}),Dv=Wi(!0),Gm=Wi(0),Bv=30;class Fv{constructor(n,l){gi(this,"map");gi(this,"inner");gi(this,"active");gi(this,"eventListenersSuccess");gi(this,"eventListenersUpdated");gi(this,"eventListenersFailure");gi(this,"onMouseMove",n=>{if(!this.active)return;const l=[n.point.x-Bv,n.point.y],c=this.map.unproject(n.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(n.lngLat.lng,n.lngLat.lat,c)&&(this.redraw(),this.dataUpdated())});gi(this,"onClick",()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())});gi(this,"onDoubleClick",n=>{this.active&&(n.preventDefault(),this.inner.onClick(),this.finish())});gi(this,"onDragStart",()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()});gi(this,"onMouseUp",()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()});gi(this,"onKeyDown",n=>{this.active&&n.key=="Escape"&&(n.stopPropagation(),this.cancel())});gi(this,"onKeyPress",n=>{this.active&&n.target.tagName!="INPUT"&&(n.key=="Enter"?(n.stopPropagation(),this.finish()):n.key=="s"?(n.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):n.key=="z"&&n.ctrlKey&&this.undo())});this.map=n,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Lu(l),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(n){n.properties??(n.properties={}),this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),n.properties.waypoints||(n.properties.waypoints=[{lon:n.geometry.coordinates[0][0],lat:n.geometry.coordinates[0][1],snapped:!0},{lon:n.geometry.coordinates[n.geometry.coordinates.length-1][0],lat:n.geometry.coordinates[n.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(n.properties.waypoints),this.redraw()}editExistingArea(n){n.properties??(n.properties={}),this.active&&window.alert("Bug: editExistingArea called when tool is already active"),n.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(n.properties.waypoints),this.redraw()}addEventListenerSuccess(n){this.eventListenersSuccess.push(n)}addEventListenerUpdated(n){this.eventListenersUpdated.push(n)}addEventListenerFailure(n){this.eventListenersFailure.push(n)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let n=this.inner.toFinalFeature();if(n)for(let l of this.eventListenersSuccess)l(JSON.parse(n));else for(let l of this.eventListenersFailure)l();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(n){this.inner.setRouteConfig(n),this.redraw()}addSnappedWaypoint(n){this.inner.addSnappedWaypoint(n[0],n[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}redraw(){let n=JSON.parse(this.inner.renderGeojson());Zm.set(n),this.map.getCanvas().style.cursor=n.cursor,Dv.set(n.snap_mode),Gm.set(n.undo_length)}dataUpdated(){let n=this.inner.toFinalFeature();if(n)for(let l of this.eventListenersUpdated)l(JSON.parse(n))}}let mn=Wi(null),Ns=Wi(1),zi=Wi({mode:"title"}),dd=Wi(!0),js=Wi(null),uc=Wi(null),ps=Wi(""),Ru=Wi(!0),fd=Wi(null),pd=Wi(null);const Rv=u=>({}),Rp=u=>({}),Ov=u=>({}),Op=u=>({});function Np(u){let n;const l=u[6]["line-popup"],c=Yr(l,u,u[8],Op);return{c(){c&&c.c()},m(p,v){c&&c.m(p,v),n=!0},p(p,v){c&&c.p&&(!n||v&256)&&en(c,l,p,p[8],n?Qr(l,p[8],v,Ov):tn(p[8]),Op)},i(p){n||(be(c,p),n=!0)},o(p){Ie(c,p),n=!1},d(p){c&&c.d(p)}}}function Nv(u){let n,l,c=u[0]&&Np(u);return{c(){c&&c.c(),n=Bn()},m(p,v){c&&c.m(p,v),Be(p,n,v),l=!0},p(p,v){p[0]?c?(c.p(p,v),v&1&&be(c,1)):(c=Np(p),c.c(),be(c,1),c.m(n.parentNode,n)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr())},i(p){l||(be(c),l=!0)},o(p){Ie(c),l=!1},d(p){p&&De(n),c&&c.d(p)}}}function Vv(u){let n,l,c,p,v;n=new mc({props:{beforeId:u[4]?"Building":void 0,filter:["==",["get","kind"],"cell"],paint:{"fill-color":["get","color"],"fill-opacity":.3}}}),c=new Xo({props:{filter:["==",["get","kind"],"interior_road"],paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",u[3],"#A32015"]},hoverCursor:u[0]?"pointer":void 0,$$slots:{default:[Nv]},$$scope:{ctx:u}}}),c.$on("click",u[7]);const S=u[6]["more-layers"],s=Yr(S,u,u[8],Rp);return{c(){$e(n.$$.fragment),l=et(),$e(c.$$.fragment),p=et(),s&&s.c()},m(I,M){We(n,I,M),Be(I,l,M),We(c,I,M),Be(I,p,M),s&&s.m(I,M),v=!0},p(I,M){const B={};M&16&&(B.beforeId=I[4]?"Building":void 0),n.$set(B);const j={};M&8&&(j.paint={"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",I[3],"#A32015"]}),M&1&&(j.hoverCursor=I[0]?"pointer":void 0),M&257&&(j.$$scope={dirty:M,ctx:I}),c.$set(j),s&&s.p&&(!v||M&256)&&en(s,S,I,I[8],v?Qr(S,I[8],M,Rv):tn(I[8]),Rp)},i(I){v||(be(n.$$.fragment,I),be(c.$$.fragment,I),be(s,I),v=!0)},o(I){Ie(n.$$.fragment,I),Ie(c.$$.fragment,I),Ie(s,I),v=!1},d(I){I&&(De(l),De(p)),He(n,I),He(c,I),s&&s.d(I)}}}function Uv(u){let n,l;return n=new Fn({props:{data:u[2],generateId:!0,$$slots:{default:[Vv]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&4&&(v.data=c[2]),p&283&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function jv(u,n,l){let c;vt(u,dd,ae=>l(4,c=ae));let{$$slots:p={},$$scope:v}=n,{gjInput:S}=n,{interactive:s=!0}=n,{onClickLine:I=ae=>{}}=n,M,B;function j(ae){let ce=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];l(3,B=Math.max(...S.features.map(ge=>ge.properties.shortcuts??0)));for(let ge of S.features)ge.properties??(ge.properties={}),ge.properties.cell_color=="disconnected"?ge.properties.color="red":Object.hasOwn(ge.properties,"cell_color")&&(ge.properties.color=ce[ge.properties.cell_color%ce.length]);l(2,M=S)}const ie=ae=>s&&I(ae.detail.features[0]);return u.$$set=ae=>{"gjInput"in ae&&l(5,S=ae.gjInput),"interactive"in ae&&l(0,s=ae.interactive),"onClickLine"in ae&&l(1,I=ae.onClickLine),"$$scope"in ae&&l(8,v=ae.$$scope)},u.$$.update=()=>{u.$$.dirty&32&&j()},[s,I,M,B,c,S,p,ie,v]}class ju extends ci{constructor(n){super(),li(this,n,jv,Uv,ti,{gjInput:5,interactive:0,onClickLine:1})}}const qv=u=>({}),Vp=u=>({}),Zv=u=>({}),Up=u=>({});function Gv(u){let n,l,c,p;const v=u[3].sidebar,S=Yr(v,u,u[2],Up),s=u[3].map,I=Yr(s,u,u[2],Vp);return{c(){n=ye("div"),S&&S.c(),l=et(),c=ye("div"),I&&I.c()},m(M,B){Be(M,n,B),S&&S.m(n,null),u[4](n),Be(M,l,B),Be(M,c,B),I&&I.m(c,null),u[5](c),p=!0},p(M,[B]){S&&S.p&&(!p||B&4)&&en(S,v,M,M[2],p?Qr(v,M[2],B,Zv):tn(M[2]),Up),I&&I.p&&(!p||B&4)&&en(I,s,M,M[2],p?Qr(s,M[2],B,qv):tn(M[2]),Vp)},i(M){p||(be(S,M),be(I,M),p=!0)},o(M){Ie(S,M),Ie(I,M),p=!1},d(M){M&&(De(n),De(l),De(c)),S&&S.d(M),u[4](null),I&&I.d(M),u[5](null)}}}function Xv(u,n,l){let c,p;vt(u,fd,M=>l(0,c=M)),vt(u,pd,M=>l(1,p=M));let{$$slots:v={},$$scope:S}=n;function s(M){gr[M?"unshift":"push"](()=>{c=M,fd.set(c)})}function I(M){gr[M?"unshift":"push"](()=>{p=M,pd.set(p)})}return u.$$set=M=>{"$$scope"in M&&l(2,S=M.$$scope)},[c,p,S,v,s,I]}class gs extends ci{constructor(n){super(),li(this,n,Xv,Gv,ti,{})}}function Wv(u){let n,l,c,p,v,S,s;return{c(){n=ye("div"),l=ye("h1"),l.textContent="Debug mode",c=et(),p=ye("div"),v=ye("button"),v.textContent="Back to editing",Ot(n,"slot","sidebar")},m(I,M){Be(I,n,M),fe(n,l),fe(n,c),fe(n,p),fe(p,v),S||(s=Et(v,"click",u[3]),S=!0)},p:Dt,d(I){I&&De(n),S=!1,s()}}}function Hv(u){let n,l;return n=new Ua({props:{properties:Rt(u[4]).properties}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&16&&(v.properties=Rt(c[4]).properties),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function $v(u){let n,l,c;return l=new wo({props:{openOn:"hover",$$slots:{default:[Hv,({data:p})=>({4:p}),({data:p})=>p?16:0]},$$scope:{ctx:u}}}),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","line-popup")},m(p,v){Be(p,n,v),We(l,n,null),c=!0},p(p,v){const S={};v&48&&(S.$$scope={dirty:v,ctx:p}),l.$set(S)},i(p){c||(be(l.$$.fragment,p),c=!0)},o(p){Ie(l.$$.fragment,p),c=!1},d(p){p&&De(n),He(l)}}}function Kv(u){let n,l;return n=new Ua({props:{properties:Rt(u[4]).properties}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&16&&(v.properties=Rt(c[4]).properties),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Jv(u){let n,l;return n=new wo({props:{openOn:"hover",$$slots:{default:[Kv,({data:c})=>({4:c}),({data:c})=>c?16:0]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&48&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Yv(u){let n,l;return n=new Ua({props:{properties:Rt(u[4]).properties}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&16&&(v.properties=Rt(c[4]).properties),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Qv(u){let n,l;return n=new wo({props:{openOn:"hover",$$slots:{default:[Yv,({data:c})=>({4:c}),({data:c})=>c?16:0]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&48&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function eb(u){let n,l,c,p;return n=new pc({props:{filter:["==",["get","kind"],"border_intersection"],paint:{"circle-radius":15,"circle-color":"green"},$$slots:{default:[Jv]},$$scope:{ctx:u}}}),c=new Xo({props:{filter:["==",["get","kind"],"crosses"],paint:{"line-width":5,"line-color":"blue"},$$slots:{default:[Qv]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment),l=et(),$e(c.$$.fragment)},m(v,S){We(n,v,S),Be(v,l,S),We(c,v,S),p=!0},p(v,S){const s={};S&32&&(s.$$scope={dirty:S,ctx:v}),n.$set(s);const I={};S&32&&(I.$$scope={dirty:S,ctx:v}),c.$set(I)},i(v){p||(be(n.$$.fragment,v),be(c.$$.fragment,v),p=!0)},o(v){Ie(n.$$.fragment,v),Ie(c.$$.fragment,v),p=!1},d(v){v&&De(l),He(n,v),He(c,v)}}}function tb(u){let n,l;return n=new Ua({props:{properties:Rt(u[4]).properties}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&16&&(v.properties=Rt(c[4]).properties),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function ib(u){let n,l;return n=new wo({props:{openOn:"hover",$$slots:{default:[tb,({data:c})=>({4:c}),({data:c})=>c?16:0]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&48&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function rb(u){let n,l;return n=new pc({props:{paint:{"circle-radius":15,"circle-color":"black"},$$slots:{default:[ib]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&32&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function nb(u){let n,l,c,p,v;return l=new ju({props:{gjInput:JSON.parse(Rt(u[0]).renderNeighbourhood()),interactive:!0,onClickLine:u[2],$$slots:{"more-layers":[eb],"line-popup":[$v]},$$scope:{ctx:u}}}),p=new Fn({props:{data:JSON.parse(Rt(u[0]).renderModalFilters()),generateId:!0,$$slots:{default:[rb]},$$scope:{ctx:u}}}),{c(){n=ye("div"),$e(l.$$.fragment),c=et(),$e(p.$$.fragment),Ot(n,"slot","map")},m(S,s){Be(S,n,s),We(l,n,null),fe(n,c),We(p,n,null),v=!0},p(S,s){const I={};s&1&&(I.gjInput=JSON.parse(Rt(S[0]).renderNeighbourhood())),s&32&&(I.$$scope={dirty:s,ctx:S}),l.$set(I);const M={};s&1&&(M.data=JSON.parse(Rt(S[0]).renderModalFilters())),s&32&&(M.$$scope={dirty:s,ctx:S}),p.$set(M)},i(S){v||(be(l.$$.fragment,S),be(p.$$.fragment,S),v=!0)},o(S){Ie(l.$$.fragment,S),Ie(p.$$.fragment,S),v=!1},d(S){S&&De(n),He(l),He(p)}}}function ob(u){let n,l;return n=new gs({props:{$$slots:{map:[nb],sidebar:[Wv]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&35&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function sb(u,n,l){let c,p;return vt(u,mn,s=>l(0,c=s)),vt(u,zi,s=>l(1,p=s)),[c,p,s=>window.open(Rt(s.properties).way,"_blank"),()=>ei(zi,p={mode:"neighbourhood"},p)]}class ab extends ci{constructor(n){super(),li(this,n,sb,ob,ti,{})}}function lb(u){let n,l,c,p,v,S,s;return{c(){n=ye("div"),l=ye("h1"),l.textContent="Debug GJ",c=et(),p=ye("div"),v=ye("button"),v.textContent="Back",Ot(n,"slot","sidebar")},m(I,M){Be(I,n,M),fe(n,l),fe(n,c),fe(n,p),fe(p,v),S||(s=Et(v,"click",u[2]),S=!0)},p:Dt,d(I){I&&De(n),S=!1,s()}}}function cb(u){let n,l;return n=new Ua({props:{properties:Rt(u[3]).properties}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&8&&(v.properties=Rt(c[3]).properties),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function ub(u){let n,l;return n=new wo({props:{openOn:"hover",$$slots:{default:[cb,({data:c})=>({3:c}),({data:c})=>c?8:0]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&24&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function hb(u){let n,l;return n=new Ua({props:{properties:Rt(u[3]).properties}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&8&&(v.properties=Rt(c[3]).properties),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function db(u){let n,l;return n=new wo({props:{openOn:"hover",$$slots:{default:[hb,({data:c})=>({3:c}),({data:c})=>c?8:0]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&24&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function fb(u){let n,l,c,p;return n=new Xo({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":"black","line-opacity":ld(.5,1)},$$slots:{default:[ub]},$$scope:{ctx:u}}}),c=new pc({props:{manageHoverState:!0,paint:{"circle-radius":10,"circle-color":"black","circle-opacity":ld(.5,1)},$$slots:{default:[db]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment),l=et(),$e(c.$$.fragment)},m(v,S){We(n,v,S),Be(v,l,S),We(c,v,S),p=!0},p(v,S){const s={};S&16&&(s.$$scope={dirty:S,ctx:v}),n.$set(s);const I={};S&16&&(I.$$scope={dirty:S,ctx:v}),c.$set(I)},i(v){p||(be(n.$$.fragment,v),be(c.$$.fragment,v),p=!0)},o(v){Ie(n.$$.fragment,v),Ie(c.$$.fragment,v),p=!1},d(v){v&&De(l),He(n,v),He(c,v)}}}function pb(u){let n,l,c;return l=new Fn({props:{data:JSON.parse(Rt(u[0]).toRouteSnapperGj()),generateId:!0,$$slots:{default:[fb]},$$scope:{ctx:u}}}),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","map")},m(p,v){Be(p,n,v),We(l,n,null),c=!0},p(p,v){const S={};v&1&&(S.data=JSON.parse(Rt(p[0]).toRouteSnapperGj())),v&16&&(S.$$scope={dirty:v,ctx:p}),l.$set(S)},i(p){c||(be(l.$$.fragment,p),c=!0)},o(p){Ie(l.$$.fragment,p),c=!1},d(p){p&&De(n),He(l)}}}function mb(u){let n,l;return n=new gs({props:{$$slots:{map:[pb],sidebar:[lb]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&19&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function _b(u,n,l){let c,p;return vt(u,mn,S=>l(0,c=S)),vt(u,zi,S=>l(1,p=S)),[c,p,()=>ei(zi,p={mode:"network"},p)]}class gb extends ci{constructor(n){super(),li(this,n,_b,mb,ti,{})}}function yb(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae,ce,ge,ve,Ee,W,ne;return ve=new Sm({props:{msg:u[0]}}),{c(){n=ye("details"),l=ye("summary"),l.textContent="Save / load project",c=et(),p=ye("div"),v=ye("button"),v.textContent="Save to GJ",S=et(),s=ye("div"),I=ye("label"),M=Gt(`Load edits from GJ
      `),B=ye("input"),j=et(),ie=ye("div"),ae=ye("button"),ae.textContent="Save to local storage",ce=ye("button"),ce.textContent="Load from local storage",ge=et(),$e(ve.$$.fragment),Ot(B,"type","file")},m(re,_e){Be(re,n,_e),fe(n,l),fe(n,c),fe(n,p),fe(p,v),fe(n,S),fe(n,s),fe(s,I),fe(I,M),fe(I,B),u[7](B),fe(n,j),fe(n,ie),fe(ie,ae),fe(ie,ce),Be(re,ge,_e),We(ve,re,_e),Ee=!0,W||(ne=[Et(v,"click",u[2]),Et(B,"change",u[3]),Et(ae,"click",u[5]),Et(ce,"click",u[4])],W=!0)},p(re,[_e]){const ze={};_e&1&&(ze.msg=re[0]),ve.$set(ze)},i(re){Ee||(be(ve.$$.fragment,re),Ee=!0)},o(re){Ie(ve.$$.fragment,re),Ee=!1},d(re){re&&(De(n),De(ge)),u[7](null),He(ve,re),W=!1,_n(ne)}}}function vb(u,n,l){let c,p,v,S;vt(u,mn,ge=>l(9,p=ge)),vt(u,zi,ge=>l(10,v=ge)),vt(u,ps,ge=>l(6,S=ge));let s=null;function I(){Lv(c,p.toSavefile())}let M;async function B(ge){l(0,s="Loading project from file");try{ae(await M.files[0].text())}catch(ve){window.alert(`Couldn't open this file: ${ve}`)}l(0,s=null)}function j(){l(0,s="Loading projects from local storage");try{let ge=window.localStorage.getItem(c);ge?ae(ge):window.alert("Nothing was saved in local storage")}catch(ge){window.alert(`Couldn't load from local storage: ${ge}`)}l(0,s=null)}function ie(){window.localStorage.setItem(c,p.toSavefile())}function ae(ge){p.loadSavefile(JSON.parse(ge)),ei(zi,v={mode:"network"},v),mn.set(p)}function ce(ge){gr[ge?"unshift":"push"](()=>{M=ge,l(1,M)})}return u.$$.update=()=>{u.$$.dirty&64&&(c=`ltn_${S||"custom"}.geojson`)},[s,M,I,B,j,ie,S,ce]}class Xm extends ci{constructor(n){super(),li(this,n,vb,yb,ti,{})}}function jp(u,n,l){const c=u.slice();return c[7]=n[l][0],c[8]=n[l][1],c[9]=n[l][2],c}function qp(u){let n,l,c,p,v,S=u[8]+"",s,I,M,B,j;function ie(){return u[3](u[7])}return{c(){n=ye("div"),l=ye("button"),c=ye("img"),v=ye("br"),s=Gt(S),M=et(),id(c.src,p=`/ltn//filters/${u[7]}_icon.gif`)||Ot(c,"src",p),Ot(c,"width","80"),Ot(c,"alt",u[8]),La(l,"width","100%"),l.disabled=I=u[0]==u[7]},m(ae,ce){Be(ae,n,ce),fe(n,l),fe(l,c),fe(l,v),fe(l,s),fe(n,M),B||(j=Et(l,"click",ie),B=!0)},p(ae,ce){u=ae,ce&1&&I!==(I=u[0]==u[7])&&(l.disabled=I)},d(ae){ae&&De(n),B=!1,j()}}}function bb(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae=u[1][2]+"",ce,ge,ve,Ee,W,ne,re=Fa(u[2]),_e=[];for(let Ce=0;Ce<re.length;Ce+=1)_e[Ce]=qp(jp(u,re,Ce));function ze(){return u[4](u[6])}return{c(){n=ye("h3"),n.textContent="Choose a modal filter to place on streets",l=et(),c=ye("table"),p=ye("tr"),v=ye("td");for(let Ce=0;Ce<_e.length;Ce+=1)_e[Ce].c();S=et(),s=ye("td"),I=ye("img"),j=et(),ie=ye("p"),ce=Gt(ae),ge=et(),ve=ye("center"),Ee=ye("button"),Ee.textContent="Confirm",id(I.src,M=`/ltn//filters/${u[0]}.gif`)||Ot(I,"src",M),Ot(I,"height","300"),Ot(I,"alt",B=u[1][1])},m(Ce,Ae){Be(Ce,n,Ae),Be(Ce,l,Ae),Be(Ce,c,Ae),fe(c,p),fe(p,v);for(let Ue=0;Ue<_e.length;Ue+=1)_e[Ue]&&_e[Ue].m(v,null);fe(p,S),fe(p,s),fe(s,I),fe(s,j),fe(s,ie),fe(ie,ce),Be(Ce,ge,Ae),Be(Ce,ve,Ae),fe(ve,Ee),W||(ne=Et(Ee,"click",ze),W=!0)},p(Ce,Ae){if(u=Ce,Ae&5){re=Fa(u[2]);let Ue;for(Ue=0;Ue<re.length;Ue+=1){const je=jp(u,re,Ue);_e[Ue]?_e[Ue].p(je,Ae):(_e[Ue]=qp(je),_e[Ue].c(),_e[Ue].m(v,null))}for(;Ue<_e.length;Ue+=1)_e[Ue].d(1);_e.length=re.length}Ae&1&&!id(I.src,M=`/ltn//filters/${u[0]}.gif`)&&Ot(I,"src",M),Ae&2&&B!==(B=u[1][1])&&Ot(I,"alt",B),Ae&2&&ae!==(ae=u[1][2]+"")&&jr(ce,ae)},d(Ce){Ce&&(De(n),De(l),De(c),De(ge),De(ve)),md(_e,Ce),W=!1,ne()}}}function xb(u){let n,l;return n=new Tm({props:{$$slots:{default:[bb,({dialog:c})=>({6:c}),({dialog:c})=>c?64:0]},$$scope:{ctx:u}}}),n.$on("close",u[5]),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&4163&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function wb(u,n,l){let c,{filterType:p}=n,v=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const S=M=>l(0,p=M),s=M=>Rt(M).close();function I(M){Vi.call(this,u,M)}return u.$$set=M=>{"filterType"in M&&l(0,p=M.filterType)},u.$$.update=()=>{u.$$.dirty&1&&l(1,c=v.find(M=>M[0]==p))},[p,c,v,S,s,I]}class Sb extends ci{constructor(n){super(),li(this,n,wb,xb,ti,{filterType:0})}}function Zp(u){let n,l;return n=new Fn({props:{data:u[0],$$slots:{default:[Tb]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&1&&(v.data=c[0]),p&64&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Tb(u){let n,l;return n=new Xo({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function kb(u){let n,l,c=u[0]&&Zp(u);return{c(){c&&c.c(),n=Bn()},m(p,v){c&&c.m(p,v),Be(p,n,v),l=!0},p(p,[v]){p[0]?c?(c.p(p,v),v&1&&be(c,1)):(c=Zp(p),c.c(),be(c,1),c.m(n.parentNode,n)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr())},i(p){l||(be(c),l=!0)},o(p){Ie(c),l=!1},d(p){p&&De(n),c&&c.d(p)}}}function Ib(u,n,l){let{map:c}=n,p=null;const v=fc();c.on("dragstart",S),c.on("mousemove",s),c.on("mouseup",I),xo(()=>{c.dragPan.enable(),c.off("dragstart",S),c.off("mousemove",s),c.off("mouseup",I)});function S(){c.dragPan.disable(),l(0,p={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(M){p&&(p.geometry.coordinates.push(M.lngLat.toArray()),l(0,p))}function I(){p&&(v("done",p),l(0,p=null))}return u.$$set=M=>{"map"in M&&l(1,c=M.map)},[p,c]}class Mb extends ci{constructor(n){super(),li(this,n,Ib,kb,ti,{map:1})}}function Cb(u){let n,l,c;return{c(){n=Gt("Undo ("),l=Gt(u[5]),c=Gt(")")},m(p,v){Be(p,n,v),Be(p,l,v),Be(p,c,v)},p(p,v){v[0]&32&&jr(l,p[5])},d(p){p&&(De(n),De(l),De(c))}}}function Ab(u){let n;return{c(){n=Gt("Undo")},m(l,c){Be(l,n,c)},p:Dt,d(l){l&&De(n)}}}function Eb(u){let n,l,c;return{c(){n=Gt("Redo ("),l=Gt(u[6]),c=Gt(")")},m(p,v){Be(p,n,v),Be(p,l,v),Be(p,c,v)},p(p,v){v[0]&64&&jr(l,p[6])},d(p){p&&(De(n),De(l),De(c))}}}function Pb(u){let n;return{c(){n=Gt("Redo")},m(l,c){Be(l,n,c)},p:Dt,d(l){l&&De(n)}}}function Gp(u){let n,l,c;function p(S){u[23](S)}let v={};return u[2]!==void 0&&(v.filterType=u[2]),n=new Sb({props:v}),gr.push(()=>_s(n,"filterType",p)),n.$on("close",u[24]),{c(){$e(n.$$.fragment)},m(S,s){We(n,S,s),c=!0},p(S,s){const I={};!l&&s[0]&4&&(l=!0,I.filterType=S[2],ms(()=>l=!1)),n.$set(I)},i(S){c||(be(n.$$.fragment,S),c=!0)},o(S){Ie(n.$$.fragment,S),c=!1},d(S){He(n,S)}}}function zb(u){let n,l,c,p=Rt(Rt(u[7]).properties).name+"",v,S,s,I,M,B,j,ie,ae,ce,ge,ve,Ee,W,ne,re,_e,ze,Ce,Ae,Ue,je,we,Te,xt,bt,it,dt,Pt,ut,kt,yi,$t,Vt,Xt,hi,ar,Ti,Je,qe,Ut,jt,ki,Hi,Xe,Ii,$i,rn,Mn,Lr,_r,Pe,br;function Dr(si,ji){return si[5]==0?Ab:Cb}let di=Dr(u),qt=di(u);function nn(si,ji){return si[6]==0?Pb:Eb}let Cn=nn(u),rr=Cn(u),Ui=u[4]&&Gp(u);return Lr=new Xm({}),{c(){n=ye("div"),l=ye("h1"),c=Gt("Editing modal filters in "),v=Gt(p),S=et(),s=ye("p"),s.textContent=`Now that you've defined a neighbourhood boundary, you can see the possible
      shortcuts that vehicles are currently able to take through it. You can add
      a new modal filter to try and solve this. The colored "cell" areas show
      what's reachable for drivers without leaving the boundary you've drawn.`,I=et(),M=ye("div"),B=ye("button"),B.textContent="Start over and change your study area",j=et(),ie=ye("div"),ae=ye("button"),ae.textContent="Pick a different neighbourhood boundary",ce=et(),ge=ye("div"),ve=ye("button"),ve.textContent="Change this neighbourhood boundary",Ee=et(),W=ye("hr"),ne=et(),re=ye("div"),_e=ye("button"),ze=Gt("Add a modal filter"),Ae=et(),Ue=ye("button"),je=Gt("Add many modal filters along line"),Te=et(),xt=ye("button"),bt=Gt("Change modal filter type"),dt=et(),Pt=ye("div"),ut=ye("button"),qt.c(),yi=et(),$t=ye("button"),rr.c(),Xt=et(),Ui&&Ui.c(),hi=et(),ar=ye("hr"),Ti=et(),Je=ye("div"),qe=ye("button"),qe.textContent="View shortcuts",Ut=et(),jt=ye("div"),ki=ye("button"),ki.textContent="Route",Hi=et(),Xe=ye("div"),Ii=ye("button"),Ii.textContent="Debug",$i=et(),rn=ye("hr"),Mn=et(),$e(Lr.$$.fragment),_e.disabled=Ce=u[0]||u[3],Ue.disabled=we=u[0]||u[3],xt.disabled=it=u[0]||u[3],ut.disabled=kt=u[5]==0,$t.disabled=Vt=u[6]==0,Ot(n,"slot","sidebar")},m(si,ji){Be(si,n,ji),fe(n,l),fe(l,c),fe(l,v),fe(n,S),fe(n,s),fe(n,I),fe(n,M),fe(M,B),fe(n,j),fe(n,ie),fe(ie,ae),fe(n,ce),fe(n,ge),fe(ge,ve),fe(n,Ee),fe(n,W),fe(n,ne),fe(n,re),fe(re,_e),fe(_e,ze),fe(re,Ae),fe(re,Ue),fe(Ue,je),fe(re,Te),fe(re,xt),fe(xt,bt),fe(n,dt),fe(n,Pt),fe(Pt,ut),qt.m(ut,null),fe(Pt,yi),fe(Pt,$t),rr.m($t,null),fe(n,Xt),Ui&&Ui.m(n,null),fe(n,hi),fe(n,ar),fe(n,Ti),fe(n,Je),fe(Je,qe),fe(n,Ut),fe(n,jt),fe(jt,ki),fe(n,Hi),fe(n,Xe),fe(Xe,Ii),fe(n,$i),fe(n,rn),fe(n,Mn),We(Lr,n,null),_r=!0,Pe||(br=[Et(B,"click",u[18]),Et(ae,"click",u[15]),Et(ve,"click",u[19]),Et(_e,"click",u[20]),Et(Ue,"click",u[21]),Et(xt,"click",u[22]),Et(ut,"click",u[13]),Et($t,"click",u[14]),Et(qe,"click",u[25]),Et(ki,"click",u[26]),Et(Ii,"click",u[27])],Pe=!0)},p(si,ji){(!_r||ji[0]&128)&&p!==(p=Rt(Rt(si[7]).properties).name+"")&&jr(v,p),(!_r||ji[0]&9&&Ce!==(Ce=si[0]||si[3]))&&(_e.disabled=Ce),(!_r||ji[0]&9&&we!==(we=si[0]||si[3]))&&(Ue.disabled=we),(!_r||ji[0]&9&&it!==(it=si[0]||si[3]))&&(xt.disabled=it),di===(di=Dr(si))&&qt?qt.p(si,ji):(qt.d(1),qt=di(si),qt&&(qt.c(),qt.m(ut,null))),(!_r||ji[0]&32&&kt!==(kt=si[5]==0))&&(ut.disabled=kt),Cn===(Cn=nn(si))&&rr?rr.p(si,ji):(rr.d(1),rr=Cn(si),rr&&(rr.c(),rr.m($t,null))),(!_r||ji[0]&64&&Vt!==(Vt=si[6]==0))&&($t.disabled=Vt),si[4]?Ui?(Ui.p(si,ji),ji[0]&16&&be(Ui,1)):(Ui=Gp(si),Ui.c(),be(Ui,1),Ui.m(n,hi)):Ui&&(yr(),Ie(Ui,1,1,()=>{Ui=null}),vr())},i(si){_r||(be(Ui),be(Lr.$$.fragment,si),_r=!0)},o(si){Ie(Ui),Ie(Lr.$$.fragment,si),_r=!1},d(si){si&&De(n),qt.d(),rr.d(),Ui&&Ui.d(),He(Lr),Pe=!1,_n(br)}}}function Lb(u){let n,l=Rt(u[32]).properties.shortcuts+"",c,p,v=(Rt(u[32]).properties.name??"unnamed road")+"",S;return{c(){n=ye("p"),c=Gt(l),p=Gt(" shortcuts through "),S=Gt(v)},m(s,I){Be(s,n,I),fe(n,c),fe(n,p),fe(n,S)},p(s,I){I[1]&2&&l!==(l=Rt(s[32]).properties.shortcuts+"")&&jr(c,l),I[1]&2&&v!==(v=(Rt(s[32]).properties.name??"unnamed road")+"")&&jr(S,v)},d(s){s&&De(n)}}}function Db(u){let n,l,c;return l=new wo({props:{openOn:"hover",$$slots:{default:[Lb,({data:p})=>({32:p}),({data:p})=>[0,p?2:0]]},$$scope:{ctx:u}}}),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","line-popup")},m(p,v){Be(p,n,v),We(l,n,null),c=!0},p(p,v){const S={};v[1]&6&&(S.$$scope={dirty:v,ctx:p}),l.$set(S)},i(p){c||(be(l.$$.fragment,p),c=!0)},o(p){Ie(l.$$.fragment,p),c=!1},d(p){p&&De(n),He(l)}}}function Bb(u){let n;return{c(){n=Gt("Click to delete")},m(l,c){Be(l,n,c)},d(l){l&&De(n)}}}function Fb(u){let n,l;return n=new wo({props:{openOn:"hover",$$slots:{default:[Bb]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p[1]&4&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Rb(u){let n,l;return n=new vm({props:{layout:{"icon-image":["get","filter_kind"],"icon-allow-overlap":!0,"icon-size":.1},$$slots:{default:[Fb]},$$scope:{ctx:u}}}),n.$on("click",u[11]),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p[1]&4&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Xp(u){let n,l;return n=new Mb({props:{map:Rt(u[1])}}),n.$on("done",u[16]),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p[0]&2&&(v.map=Rt(c[1])),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Ob(u){let n,l,c,p,v,S;l=new ju({props:{gjInput:u[8],interactive:!u[0]&&!u[3],$$slots:{"line-popup":[Db]},$$scope:{ctx:u}}}),p=new Fn({props:{data:u[9],generateId:!0,$$slots:{default:[Rb]},$$scope:{ctx:u}}});let s=u[3]&&Xp(u);return{c(){n=ye("div"),$e(l.$$.fragment),c=et(),$e(p.$$.fragment),v=et(),s&&s.c(),Ot(n,"slot","map")},m(I,M){Be(I,n,M),We(l,n,null),fe(n,c),We(p,n,null),fe(n,v),s&&s.m(n,null),S=!0},p(I,M){const B={};M[0]&256&&(B.gjInput=I[8]),M[0]&9&&(B.interactive=!I[0]&&!I[3]),M[1]&4&&(B.$$scope={dirty:M,ctx:I}),l.$set(B);const j={};M[0]&512&&(j.data=I[9]),M[1]&4&&(j.$$scope={dirty:M,ctx:I}),p.$set(j),I[3]?s?(s.p(I,M),M[0]&8&&be(s,1)):(s=Xp(I),s.c(),be(s,1),s.m(n,null)):s&&(yr(),Ie(s,1,1,()=>{s=null}),vr())},i(I){S||(be(l.$$.fragment,I),be(p.$$.fragment,I),be(s),S=!0)},o(I){Ie(l.$$.fragment,I),Ie(p.$$.fragment,I),Ie(s),S=!1},d(I){I&&De(n),He(l),He(p),s&&s.d()}}}function Nb(u){let n,l,c,p;return n=new gs({props:{$$slots:{map:[Ob],sidebar:[zb]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(v,S){We(n,v,S),l=!0,c||(p=Et(window,"keydown",u[12]),c=!0)},p(v,S){const s={};S[0]&2047|S[1]&4&&(s.$$scope={dirty:S,ctx:v}),n.$set(s)},i(v){l||(be(n.$$.fragment,v),l=!0)},o(v){Ie(n.$$.fragment,v),l=!1},d(v){He(n,v),c=!1,p()}}}function Vb(u,n,l){let c,p,v,S;vt(u,Ns,kt=>l(17,c=kt)),vt(u,mn,kt=>l(28,p=kt)),vt(u,zi,kt=>l(10,v=kt)),vt(u,js,kt=>l(1,S=kt));let s="walk_cycle_only",I=!1,M=!1,B=!1,j=0,ie=0,ae,ce,ge;function ve(kt){l(8,ce=JSON.parse(p.renderNeighbourhood())),l(7,ae=ce.features.find(yi=>yi.properties.kind=="boundary")),l(5,j=ce.undo_length),l(6,ie=ce.redo_length),l(9,ge=JSON.parse(p.renderModalFilters()))}xo(()=>{W()});function Ee(kt){p.addModalFilter(kt.lngLat,s),ei(Ns,c++,c),W()}function W(){l(0,I=!1),S.off("click",Ee),S.getCanvas().style.cursor="inherit"}function ne(kt){let yi=kt.detail.features[0];p.deleteModalFilter(yi.properties.road),ei(Ns,c++,c)}function re(kt){kt.key=="a"&&!I&&!M&&l(0,I=!0),kt.key=="z"&&kt.ctrlKey&&_e(),kt.key=="y"&&kt.ctrlKey&&ze()}function _e(){p.undo(),ei(Ns,c++,c)}function ze(){p.redo(),ei(Ns,c++,c)}function Ce(){ei(zi,v={mode:"network"},v)}function Ae(kt){let yi=kt.detail;yi&&(p.addManyModalFilters(yi,s),ei(Ns,c++,c)),l(3,M=!1)}const Ue=()=>ei(zi,v={mode:"title"},v),je=()=>ei(zi,v={mode:"set-boundary",name:Rt(Rt(ae).properties).name,existing:ae},v),we=()=>l(0,I=!0),Te=()=>l(3,M=!0),xt=()=>l(4,B=!0);function bt(kt){s=kt,l(2,s)}const it=()=>l(4,B=!1),dt=()=>ei(zi,v={mode:"view-shortcuts"},v),Pt=()=>ei(zi,v={mode:"route"},v),ut=()=>ei(zi,v={mode:"debug"},v);return u.$$.update=()=>{u.$$.dirty[0]&131072&&ve(),u.$$.dirty[0]&3&&I&&(S.on("click",Ee),S.getCanvas().style.cursor="crosshair")},[I,S,s,M,B,j,ie,ae,ce,ge,v,ne,re,_e,ze,Ce,Ae,c,Ue,je,we,Te,xt,bt,it,dt,Pt,ut]}class Ub extends ci{constructor(n){super(),li(this,n,Vb,Nb,ti,{},null,[-1,-1])}}function jb(u){let n,l;return n=new vm({props:{layout:{"icon-image":["get","filter_kind"],"icon-allow-overlap":!0,"icon-size":.1}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function qb(u){let n,l;return n=new Fn({props:{data:u[0],$$slots:{default:[jb]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&1&&(v.data=c[0]),p&8&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Zb(u,n,l){let c,p,v;return vt(u,mn,S=>l(1,p=S)),vt(u,Ns,S=>l(2,v=S)),u.$$.update=()=>{u.$$.dirty&6&&l(0,c=v>0?JSON.parse(p.renderModalFilters()):null)},[c,p,v]}class Id extends ci{constructor(n){super(),li(this,n,Zb,qb,ti,{})}}function Wp(u,n,l){const c=u.slice();return c[13]=n[l],c}function Hp(u){let n,l,c=u[13]+"",p,v,S,s,I;function M(){return u[9](u[13])}function B(){return u[10](u[13])}return{c(){n=ye("div"),l=ye("button"),p=Gt(c),v=et(),S=ye("button"),S.textContent="X"},m(j,ie){Be(j,n,ie),fe(n,l),fe(l,p),fe(n,v),fe(n,S),s||(I=[Et(l,"click",M),Et(S,"click",B)],s=!0)},p(j,ie){u=j,ie&2&&c!==(c=u[13]+"")&&jr(p,c)},d(j){j&&De(n),s=!1,_n(I)}}}function Gb(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae,ce,ge,ve,Ee,W,ne,re,_e,ze=Fa(u[1]),Ce=[];for(let Ae=0;Ae<ze.length;Ae+=1)Ce[Ae]=Hp(Wp(u,ze,Ae));return W=new Xm({}),{c(){n=ye("div"),l=ye("h1"),l.textContent="Define neighbourhood boundaries",c=et(),p=ye("p"),p.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
      deliberately permit) through-traffic. An appropriate neighbourhood
      boundary depends on many factors. The simplest approach is to find the
      area bounded on all sides by "main" roads, which are designed for higher
      traffic volumes. There are many other considerations, though -- maybe
      severances like rivers or rail should be part of a boundary. Bridges and
      tunnels near a boundary may be confusing as well. And note that your
      boundary may not match the conventional definition of "neighbourhood."`,v=et(),S=ye("div"),s=ye("button"),s.textContent="Start over and change your study area",I=et(),M=ye("div"),B=ye("button"),B.textContent="Draw a new boundary",j=et();for(let Ae=0;Ae<Ce.length;Ae+=1)Ce[Ae].c();ie=et(),ae=ye("div"),ce=ye("button"),ce.textContent="Debug route snapper",ge=et(),ve=ye("hr"),Ee=et(),$e(W.$$.fragment),Ot(n,"slot","sidebar")},m(Ae,Ue){Be(Ae,n,Ue),fe(n,l),fe(n,c),fe(n,p),fe(n,v),fe(n,S),fe(S,s),fe(n,I),fe(n,M),fe(M,B),fe(n,j);for(let je=0;je<Ce.length;je+=1)Ce[je]&&Ce[je].m(n,null);fe(n,ie),fe(n,ae),fe(ae,ce),fe(n,ge),fe(n,ve),fe(n,Ee),We(W,n,null),ne=!0,re||(_e=[Et(s,"click",u[8]),Et(B,"click",u[5]),Et(ce,"click",u[11])],re=!0)},p(Ae,Ue){if(Ue&26){ze=Fa(Ae[1]);let je;for(je=0;je<ze.length;je+=1){const we=Wp(Ae,ze,je);Ce[je]?Ce[je].p(we,Ue):(Ce[je]=Hp(we),Ce[je].c(),Ce[je].m(n,ie))}for(;je<Ce.length;je+=1)Ce[je].d(1);Ce.length=ze.length}},i(Ae){ne||(be(W.$$.fragment,Ae),ne=!0)},o(Ae){Ie(W.$$.fragment,Ae),ne=!1},d(Ae){Ae&&De(n),md(Ce,Ae),He(W),re=!1,_n(_e)}}}function Xb(u){let n,l=Rt(u[12]).properties.name+"",c;return{c(){n=ye("p"),c=Gt(l)},m(p,v){Be(p,n,v),fe(n,c)},p(p,v){v&4096&&l!==(l=Rt(p[12]).properties.name+"")&&jr(c,l)},d(p){p&&De(n)}}}function Wb(u){let n,l;return n=new wo({props:{openOn:"hover",$$slots:{default:[Xb,({data:c})=>({12:c}),({data:c})=>c?4096:0]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&69632&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Hb(u){let n,l,c,p;return n=new mc({props:{filter:["==",["get","kind"],"boundary"],paint:{"fill-color":"red","fill-opacity":ld(.3,.5)},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[Wb]},$$scope:{ctx:u}}}),n.$on("click",u[7]),c=new Id({}),{c(){$e(n.$$.fragment),l=et(),$e(c.$$.fragment)},m(v,S){We(n,v,S),Be(v,l,S),We(c,v,S),p=!0},p(v,S){const s={};S&65536&&(s.$$scope={dirty:S,ctx:v}),n.$set(s)},i(v){p||(be(n.$$.fragment,v),be(c.$$.fragment,v),p=!0)},o(v){Ie(n.$$.fragment,v),Ie(c.$$.fragment,v),p=!1},d(v){v&&De(l),He(n,v),He(c,v)}}}function $b(u){let n,l,c;return l=new Fn({props:{data:u[0],generateId:!0,$$slots:{default:[Hb]},$$scope:{ctx:u}}}),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","map")},m(p,v){Be(p,n,v),We(l,n,null),c=!0},p(p,v){const S={};v&1&&(S.data=p[0]),v&65536&&(S.$$scope={dirty:v,ctx:p}),l.$set(S)},i(p){c||(be(l.$$.fragment,p),c=!0)},o(p){Ie(l.$$.fragment,p),c=!1},d(p){p&&De(n),He(l)}}}function Kb(u){let n,l;return n=new gs({props:{$$slots:{map:[$b],sidebar:[Gb]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&65543&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function Jb(u,n,l){let c,p,v,S;vt(u,zi,ge=>l(2,v=ge)),vt(u,mn,ge=>l(6,S=ge));function s(ge){S.setCurrentNeighbourhood(ge),ei(zi,v={mode:"neighbourhood"},v)}function I(ge){S.deleteNeighbourhoodBoundary(ge),l(0,c=JSON.parse(Rt(S).toSavefile()))}function M(){let ge=window.prompt("What do you want to name the neighbourhood?");ge&&ei(zi,v={mode:"set-boundary",name:ge,existing:null},v)}const B=ge=>s(Rt(ge.detail.features[0].properties).name),j=()=>ei(zi,v={mode:"title"},v),ie=ge=>s(ge),ae=ge=>I(ge),ce=()=>ei(zi,v={mode:"debug-gj"},v);return u.$$.update=()=>{u.$$.dirty&64&&l(0,c=JSON.parse(Rt(S).toSavefile())),u.$$.dirty&1&&l(1,p=c.features.filter(ge=>Rt(ge.properties).kind=="boundary").map(ge=>Rt(ge.properties).name))},[c,p,v,s,I,M,S,B,j,ie,ae,ce]}class Yb extends ci{constructor(n){super(),li(this,n,Jb,Kb,ti,{})}}function Qb(u){let n,l,c,p,v,S,s,I,M;return{c(){n=ye("div"),l=ye("div"),c=ye("button"),c.textContent="Back to editing",p=et(),v=ye("p"),v.textContent="Drag markers for a route",S=et(),s=ye("p"),s.innerHTML=`<span style="color: red">Route before</span>,
      <span style="color: blue">route after</span>`,Ot(n,"slot","sidebar")},m(B,j){Be(B,n,j),fe(n,l),fe(l,c),fe(n,p),fe(n,v),fe(n,S),fe(n,s),I||(M=Et(c,"click",u[5]),I=!0)},p:Dt,d(B){B&&De(n),I=!1,M()}}}function e1(u){let n,l;return n=new Xo({props:{paint:{"line-width":10,"line-color":hd(["get","kind"],{before:"red",after:"blue"},"red")}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function t1(u){let n;return{c(){n=ye("span"),n.textContent="A",Ot(n,"class","dot svelte-1ukzawy")},m(l,c){Be(l,n,c)},p:Dt,d(l){l&&De(n)}}}function i1(u){let n;return{c(){n=ye("span"),n.textContent="B",Ot(n,"class","dot svelte-1ukzawy")},m(l,c){Be(l,n,c)},p:Dt,d(l){l&&De(n)}}}function r1(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae;l=new ju({props:{gjInput:JSON.parse(Rt(u[2]).renderNeighbourhood()),interactive:!1}}),p=new Id({}),S=new Fn({props:{data:u[3],$$slots:{default:[e1]},$$scope:{ctx:u}}});function ce(W){u[6](W)}let ge={draggable:!0,$$slots:{default:[t1]},$$scope:{ctx:u}};u[0]!==void 0&&(ge.lngLat=u[0]),I=new wp({props:ge}),gr.push(()=>_s(I,"lngLat",ce));function ve(W){u[7](W)}let Ee={draggable:!0,$$slots:{default:[i1]},$$scope:{ctx:u}};return u[1]!==void 0&&(Ee.lngLat=u[1]),j=new wp({props:Ee}),gr.push(()=>_s(j,"lngLat",ve)),{c(){n=ye("div"),$e(l.$$.fragment),c=et(),$e(p.$$.fragment),v=et(),$e(S.$$.fragment),s=et(),$e(I.$$.fragment),B=et(),$e(j.$$.fragment),Ot(n,"slot","map")},m(W,ne){Be(W,n,ne),We(l,n,null),fe(n,c),We(p,n,null),fe(n,v),We(S,n,null),fe(n,s),We(I,n,null),fe(n,B),We(j,n,null),ae=!0},p(W,ne){const re={};ne&4&&(re.gjInput=JSON.parse(Rt(W[2]).renderNeighbourhood())),l.$set(re);const _e={};ne&8&&(_e.data=W[3]),ne&2048&&(_e.$$scope={dirty:ne,ctx:W}),S.$set(_e);const ze={};ne&2048&&(ze.$$scope={dirty:ne,ctx:W}),!M&&ne&1&&(M=!0,ze.lngLat=W[0],ms(()=>M=!1)),I.$set(ze);const Ce={};ne&2048&&(Ce.$$scope={dirty:ne,ctx:W}),!ie&&ne&2&&(ie=!0,Ce.lngLat=W[1],ms(()=>ie=!1)),j.$set(Ce)},i(W){ae||(be(l.$$.fragment,W),be(p.$$.fragment,W),be(S.$$.fragment,W),be(I.$$.fragment,W),be(j.$$.fragment,W),ae=!0)},o(W){Ie(l.$$.fragment,W),Ie(p.$$.fragment,W),Ie(S.$$.fragment,W),Ie(I.$$.fragment,W),Ie(j.$$.fragment,W),ae=!1},d(W){W&&De(n),He(l),He(p),He(S),He(I),He(j)}}}function n1(u){let n,l,c,p;return n=new gs({props:{$$slots:{map:[r1],sidebar:[Qb]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(v,S){We(n,v,S),l=!0,c||(p=Et(window,"keydown",u[4]),c=!0)},p(v,[S]){const s={};S&2063&&(s.$$scope={dirty:S,ctx:v}),n.$set(s)},i(v){l||(be(n.$$.fragment,v),l=!0)},o(v){Ie(n.$$.fragment,v),l=!1},d(v){He(n,v),c=!1,p()}}}function o1(u,n,l){let c,p,v,S;vt(u,zi,ce=>l(8,p=ce)),vt(u,mn,ce=>l(2,v=ce)),vt(u,js,ce=>l(9,S=ce));let s=M(),I=M();dc(()=>{S==null||S.keyboard.disable()}),xo(()=>{S==null||S.keyboard.enable()});function M(){let ce=v.getBounds(),ge=ce[0]+Math.random()*(ce[2]-ce[0]),ve=ce[1]+Math.random()*(ce[3]-ce[1]);return new ym.LngLat(ge,ve)}function B(ce){ce.key=="Escape"&&(ce.stopPropagation(),j())}function j(){ei(zi,p={mode:"neighbourhood"},p)}function ie(ce){s=ce,l(0,s)}function ae(ce){I=ce,l(1,I)}return u.$$.update=()=>{u.$$.dirty&7&&l(3,c=JSON.parse(v.compareRoute(s.lng,s.lat,I.lng,I.lat)))},[s,I,v,c,B,j,ie,ae]}class s1 extends ci{constructor(n){super(),li(this,n,o1,n1,ti,{})}}function a1(u){let n,l,c,p,v,S;return n=new pc({props:{filter:Um,paint:{"circle-color":hd(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":hd(["get","type"],{node:$p/2},$p)}}}),c=new Xo({props:{filter:Vm,paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}}),v=new mc({props:{filter:Nm,paint:{"fill-color":"black","fill-opacity":.5}}}),{c(){$e(n.$$.fragment),l=et(),$e(c.$$.fragment),p=et(),$e(v.$$.fragment)},m(s,I){We(n,s,I),Be(s,l,I),We(c,s,I),Be(s,p,I),We(v,s,I),S=!0},p:Dt,i(s){S||(be(n.$$.fragment,s),be(c.$$.fragment,s),be(v.$$.fragment,s),S=!0)},o(s){Ie(n.$$.fragment,s),Ie(c.$$.fragment,s),Ie(v.$$.fragment,s),S=!1},d(s){s&&(De(l),De(p)),He(n,s),He(c,s),He(v,s)}}}function l1(u){let n,l;return n=new Fn({props:{data:u[0],$$slots:{default:[a1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&1&&(v.data=c[0]),p&2&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}const $p=10;function c1(u,n,l){let c;return vt(u,Zm,p=>l(0,c=p)),[c]}class u1 extends ci{constructor(n){super(),li(this,n,c1,l1,ti,{})}}function h1(u){let n,l,c;return{c(){n=Gt("Undo ("),l=Gt(u[1]),c=Gt(")")},m(p,v){Be(p,n,v),Be(p,l,v),Be(p,c,v)},p(p,v){v&2&&jr(l,p[1])},d(p){p&&(De(n),De(l),De(c))}}}function d1(u){let n;return{c(){n=Gt("Undo")},m(l,c){Be(l,n,c)},p:Dt,d(l){l&&De(n)}}}function f1(u){let n,l,c,p,v,S;function s(B,j){return B[1]==0?d1:h1}let I=s(u),M=I(u);return{c(){n=ye("button"),M.c(),c=et(),p=ye("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,n.disabled=l=u[1]==0},m(B,j){Be(B,n,j),M.m(n,null),Be(B,c,j),Be(B,p,j),v||(S=Et(n,"click",u[2]),v=!0)},p(B,[j]){I===(I=s(B))&&M?M.p(B,j):(M.d(1),M=I(B),M&&(M.c(),M.m(n,null))),j&2&&l!==(l=B[1]==0)&&(n.disabled=l)},i:Dt,o:Dt,d(B){B&&(De(n),De(c),De(p)),M.d(),v=!1,S()}}}function p1(u,n,l){let c;vt(u,Gm,S=>l(1,c=S));let{route_tool:p}=n;const v=()=>p.undo();return u.$$set=S=>{"route_tool"in S&&l(0,p=S.route_tool)},[p,c,v]}class m1 extends ci{constructor(n){super(),li(this,n,p1,f1,ti,{route_tool:0})}}function _1(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae,ce,ge,ve;return I=new m1({props:{route_tool:Rt(u[1])}}),{c(){n=ye("div"),l=ye("h1"),c=Gt("Draw your neighbourhood boundary for "),p=Gt(u[0]),v=et(),S=ye("p"),S.textContent="TODO: maybe move the instructions from the previous screen to here...",s=et(),$e(I.$$.fragment),M=et(),B=ye("div"),j=ye("button"),j.textContent="Finish",ie=et(),ae=ye("button"),ae.textContent="Cancel",Ot(n,"slot","sidebar")},m(Ee,W){Be(Ee,n,W),fe(n,l),fe(l,c),fe(l,p),fe(n,v),fe(n,S),fe(n,s),We(I,n,null),fe(n,M),fe(n,B),fe(B,j),fe(B,ie),fe(B,ae),ce=!0,ge||(ve=[Et(j,"click",u[4]),Et(ae,"click",u[2])],ge=!0)},p(Ee,W){(!ce||W&1)&&jr(p,Ee[0]);const ne={};W&2&&(ne.route_tool=Rt(Ee[1])),I.$set(ne)},i(Ee){ce||(be(I.$$.fragment,Ee),ce=!0)},o(Ee){Ie(I.$$.fragment,Ee),ce=!1},d(Ee){Ee&&De(n),He(I),ge=!1,_n(ve)}}}function g1(u){let n,l,c;return l=new u1({}),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","map")},m(p,v){Be(p,n,v),We(l,n,null),c=!0},p:Dt,i(p){c||(be(l.$$.fragment,p),c=!0)},o(p){Ie(l.$$.fragment,p),c=!1},d(p){p&&De(n),He(l)}}}function y1(u){let n,l;return n=new gs({props:{$$slots:{map:[g1],sidebar:[_1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&131&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function v1(u,n,l){let c,p,v;vt(u,uc,B=>l(1,c=B)),vt(u,zi,B=>l(5,p=B)),vt(u,mn,B=>l(6,v=B));let{name:S}=n,{existing:s}=n;s?c.editExistingArea(s):c.startArea();function I(){ei(zi,p={mode:"network"},p),c.clearEventListeners()}c.addEventListenerSuccess(B=>{try{v.setNeighbourhoodBoundary(S,B),v.setCurrentNeighbourhood(S),ei(zi,p={mode:"neighbourhood"},p),c.clearEventListeners()}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),I()}}),c.addEventListenerFailure(I);const M=()=>Rt(c).finish();return u.$$set=B=>{"name"in B&&l(0,S=B.name),"existing"in B&&l(3,s=B.existing)},[S,c,I,s,M]}class b1 extends ci{constructor(n){super(),li(this,n,v1,y1,ti,{name:0,existing:3})}}function x1(u){let n,l,c,p,v,S;return n=new mc({props:{id:"edit-polygon-fill",filter:Nm,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),c=new Xo({props:{filter:Vm,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),v=new pc({props:{id:"edit-polygon-vertices",filter:Um,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){$e(n.$$.fragment),l=et(),$e(c.$$.fragment),p=et(),$e(v.$$.fragment)},m(s,I){We(n,s,I),Be(s,l,I),We(c,s,I),Be(s,p,I),We(v,s,I),S=!0},p:Dt,i(s){S||(be(n.$$.fragment,s),be(c.$$.fragment,s),be(v.$$.fragment,s),S=!0)},o(s){Ie(n.$$.fragment,s),Ie(c.$$.fragment,s),Ie(v.$$.fragment,s),S=!1},d(s){s&&(De(l),De(p)),He(n,s),He(c,s),He(v,s)}}}function w1(u){let n,l;return n=new Fn({props:{data:u[0],$$slots:{default:[x1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&1&&(v.data=c[0]),p&2&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function S1(u,n,l){let c;return vt(u,Rm,p=>l(0,c=p)),[c]}class T1 extends ci{constructor(n){super(),li(this,n,S1,w1,ti,{})}}function Kp(u){let n,l;return n=new Tm({props:{$$slots:{default:[k1,({dialog:c})=>({3:c}),({dialog:c})=>c?8:0]},$$scope:{ctx:u}}}),n.$on("close",u[2]),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&24&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function k1(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae,ce;function ge(){return u[1](u[3])}return{c(){n=ye("h1"),n.textContent="The Low-traffic neighbourhood (LTN) tool, v2",l=et(),c=ye("p"),c.innerHTML=`This is an <b>experimental</b> version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>. Most parts of it do not work yet, and you should probably use the other
      version of the tool instead.`,p=et(),v=ye("p"),v.textContent="To use this tool, you need to:",S=et(),s=ye("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, to fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>To create one or more proposals with new modal filters, and explore
        their effects</li>`,I=et(),M=ye("p"),M.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a> data.`,B=et(),j=ye("center"),ie=ye("button"),ie.textContent="Start!"},m(ve,Ee){Be(ve,n,Ee),Be(ve,l,Ee),Be(ve,c,Ee),Be(ve,p,Ee),Be(ve,v,Ee),Be(ve,S,Ee),Be(ve,s,Ee),Be(ve,I,Ee),Be(ve,M,Ee),Be(ve,B,Ee),Be(ve,j,Ee),fe(j,ie),ae||(ce=Et(ie,"click",ge),ae=!0)},p(ve,Ee){u=ve},d(ve){ve&&(De(n),De(l),De(c),De(p),De(v),De(S),De(s),De(I),De(M),De(B),De(j)),ae=!1,ce()}}}function I1(u){let n,l,c=u[0]&&Kp(u);return{c(){c&&c.c(),n=Bn()},m(p,v){c&&c.m(p,v),Be(p,n,v),l=!0},p(p,[v]){p[0]?c?(c.p(p,v),v&1&&be(c,1)):(c=Kp(p),c.c(),be(c,1),c.m(n.parentNode,n)):c&&(yr(),Ie(c,1,1,()=>{c=null}),vr())},i(p){l||(be(c),l=!0)},o(p){Ie(c),l=!1},d(p){p&&De(n),c&&c.d(p)}}}function M1(u,n,l){let c;return vt(u,Ru,S=>l(0,c=S)),[c,S=>Rt(S).close(),()=>ei(Ru,c=!1,c)]}class C1 extends ci{constructor(n){super(),li(this,n,M1,I1,ti,{})}}function A1(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae,ce,ge,ve,Ee,W,ne,re,_e,ze,Ce,Ae,Ue,je,we,Te,xt,bt,it,dt,Pt;return n=new Sm({props:{msg:u[1]}}),bt=new Ev({props:{map:u[4]}}),bt.$on("gotXml",u[6]),bt.$on("loading",u[11]),bt.$on("error",u[12]),{c(){$e(n.$$.fragment),l=et(),c=ye("div"),p=ye("label"),v=Gt(`Load an example:
    `),S=ye("select"),s=ye("option"),s.textContent="Custom file loaded",I=ye("option"),I.textContent="Akihabara",M=ye("option"),M.textContent="Hanegi Park",B=ye("option"),B.textContent="Harujuku",j=ye("option"),j.textContent="Taipei main station",ie=ye("option"),ie.textContent="Ximending",ae=ye("option"),ae.textContent="Hong Kong",ce=ye("option"),ce.textContent="Kowloon",ge=ye("option"),ge.textContent="Bristol",ve=ye("option"),ve.textContent="Elephant & Castle",Ee=ye("option"),Ee.textContent="Westminster",W=ye("option"),W.textContent="Montlake",ne=ye("option"),ne.textContent="Strasbourg",re=et(),_e=ye("i"),_e.textContent="or...",ze=et(),Ce=ye("div"),Ae=ye("label"),Ue=Gt(`Load an osm.xml or a .pbf file:
    `),je=ye("input"),we=et(),Te=ye("i"),Te.textContent="or...",xt=et(),$e(bt.$$.fragment),s.__value="",Ln(s,s.__value),I.__value="akihabara",Ln(I,I.__value),M.__value="hanegi",Ln(M,M.__value),B.__value="harujuku",Ln(B,B.__value),j.__value="taipei_main_station",Ln(j,j.__value),ie.__value="ximending",Ln(ie,ie.__value),ae.__value="hong_kong",Ln(ae,ae.__value),ce.__value="kowloon",Ln(ce,ce.__value),ge.__value="bristol",Ln(ge,ge.__value),ve.__value="elephant_castle",Ln(ve,ve.__value),Ee.__value="westminster",Ln(Ee,Ee.__value),W.__value="montlake",Ln(W,W.__value),ne.__value="strasbourg",Ln(ne,ne.__value),u[3]===void 0&&zu(()=>u[8].call(S)),Ot(je,"type","file")},m(ut,kt){We(n,ut,kt),Be(ut,l,kt),Be(ut,c,kt),fe(c,p),fe(p,v),fe(p,S),fe(S,s),fe(S,I),fe(S,M),fe(S,B),fe(S,j),fe(S,ie),fe(S,ae),fe(S,ce),fe(S,ge),fe(S,ve),fe(S,Ee),fe(S,W),fe(S,ne),up(S,u[3],!0),Be(ut,re,kt),Be(ut,_e,kt),Be(ut,ze,kt),Be(ut,Ce,kt),fe(Ce,Ae),fe(Ae,Ue),fe(Ae,je),u[10](je),Be(ut,we,kt),Be(ut,Te,kt),Be(ut,xt,kt),We(bt,ut,kt),it=!0,dt||(Pt=[Et(S,"change",u[8]),Et(S,"change",u[9]),Et(je,"change",u[5])],dt=!0)},p(ut,[kt]){const yi={};kt&2&&(yi.msg=ut[1]),n.$set(yi),kt&8&&up(S,ut[3]);const $t={};kt&16&&($t.map=ut[4]),bt.$set($t)},i(ut){it||(be(n.$$.fragment,ut),be(bt.$$.fragment,ut),it=!0)},o(ut){Ie(n.$$.fragment,ut),Ie(bt.$$.fragment,ut),it=!1},d(ut){ut&&(De(l),De(c),De(re),De(_e),De(ze),De(Ce),De(we),De(Te),De(xt)),He(n,ut),u[10](null),He(bt,ut),dt=!1,_n(Pt)}}}function E1(u,n,l){let c,p,v,S,s;vt(u,ps,_e=>l(3,c=_e)),vt(u,mn,_e=>l(14,p=_e)),vt(u,js,_e=>l(4,v=_e)),vt(u,uc,_e=>l(15,S=_e)),vt(u,zi,_e=>l(16,s=_e));let I=null,M=!1;dc(async()=>{try{M=(await fetch("/osm/kowloon.pbf",{method:"HEAD"})).ok,console.log("Using local cache, not od2net.org")}catch{}});let B;async function j(_e){try{ie(await B.files[0].arrayBuffer()),ei(ps,c="",c)}catch(ze){window.alert(`Couldn't open this file: ${ze}`)}l(1,I=null)}function ie(_e){l(1,I="Building map model from OSM input"),console.time("load"),ei(mn,p=new cy(new Uint8Array(_e),c==""?void 0:c),p),console.timeEnd("load");let ze=`ltn_${c||"custom"}.geojson`,Ce=window.localStorage.getItem(ze);if(Ce)try{p.loadSavefile(JSON.parse(Ce))}catch(Ae){console.log(`Didn't restore from local storage ${ze}: ${Ae}`)}ei(zi,s={mode:"network"},s),ei(uc,S=new Fv(v,p.toRouteSnapper()),S),v.fitBounds(Array.from(p.getBounds()),{animate:!1})}function ae(_e){try{ie(new TextEncoder().encode(_e.detail)),ei(ps,c="",c)}catch(ze){window.alert(`Couldn't import from Overpass: ${ze}`)}l(1,I=null)}async function ce(_e){_e!=""&&(M?await ge(`/osm/${_e}.pbf`):await ge(`https://assets.od2net.org/severance_pbfs/${_e}.pbf`))}async function ge(_e){try{l(1,I=`Downloading ${_e}`);let ze=await fetch(_e);ie(await ze.arrayBuffer())}catch(ze){window.alert(`Couldn't open from URL ${_e}: ${ze}`)}l(1,I=null)}function ve(){c=$g(this),ps.set(c)}const Ee=()=>ce(c);function W(_e){gr[_e?"unshift":"push"](()=>{B=_e,l(2,B)})}return[ce,I,B,c,v,j,ae,ie,ve,Ee,W,_e=>l(1,I=_e.detail),_e=>window.alert(_e.detail)]}class P1 extends ci{constructor(n){super(),li(this,n,E1,A1,ti,{loadMap:7,loadExample:0})}get loadMap(){return this.$$.ctx[7]}get loadExample(){return this.$$.ctx[0]}}function Jp(u){let n,l,c,p,v,S;return{c(){n=ye("div"),l=ye("label"),c=Gt(`Load a project from a file
          `),p=ye("input"),Ot(p,"type","file")},m(s,I){Be(s,n,I),fe(n,l),fe(l,c),fe(l,p),u[7](p),v||(S=Et(p,"change",u[5]),v=!0)},p:Dt,d(s){s&&De(n),u[7](null),v=!1,S()}}}function z1(u){let n;return{c(){n=ye("p"),n.textContent="Waiting for MapLibre and WASM to load..."},m(l,c){Be(l,n,c)},p:Dt,i:Dt,o:Dt,d(l){l&&De(n)}}}function L1(u){let n,l,c={};return n=new P1({props:c}),u[8](n),{c(){$e(n.$$.fragment)},m(p,v){We(n,p,v),l=!0},p(p,v){const S={};n.$set(S)},i(p){l||(be(n.$$.fragment,p),l=!0)},o(p){Ie(n.$$.fragment,p),l=!1},d(p){u[8](null),He(n,p)}}}function D1(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae,ce,ge;l=new C1({});let ve=u[1]&&Jp(u);const Ee=[L1,z1],W=[];function ne(re,_e){return re[4]&&re[0]?0:1}return j=ne(u),ie=W[j]=Ee[j](u),{c(){n=ye("div"),$e(l.$$.fragment),c=et(),p=ye("h1"),p.textContent="Choose your study area",v=et(),S=ye("button"),S.textContent="About the LTN tool",s=et(),ve&&ve.c(),I=et(),M=ye("hr"),B=et(),ie.c(),Ot(n,"slot","sidebar")},m(re,_e){Be(re,n,_e),We(l,n,null),fe(n,c),fe(n,p),fe(n,v),fe(n,S),fe(n,s),ve&&ve.m(n,null),fe(n,I),fe(n,M),fe(n,B),W[j].m(n,null),ae=!0,ce||(ge=Et(S,"click",u[6]),ce=!0)},p(re,_e){re[1]?ve?ve.p(re,_e):(ve=Jp(re),ve.c(),ve.m(n,I)):ve&&(ve.d(1),ve=null);let ze=j;j=ne(re),j===ze?W[j].p(re,_e):(yr(),Ie(W[ze],1,1,()=>{W[ze]=null}),vr(),ie=W[j],ie?ie.p(re,_e):(ie=W[j]=Ee[j](re),ie.c()),be(ie,1),ie.m(n,null))},i(re){ae||(be(l.$$.fragment,re),be(ie),ae=!0)},o(re){Ie(l.$$.fragment,re),Ie(ie),ae=!1},d(re){re&&De(n),He(l),ve&&ve.d(),W[j].d(),ce=!1,ge()}}}function B1(u){let n,l,c;return l=new T1({}),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","map")},m(p,v){Be(p,n,v),We(l,n,null),c=!0},p:Dt,i(p){c||(be(l.$$.fragment,p),c=!0)},o(p){Ie(l.$$.fragment,p),c=!1},d(p){p&&De(n),He(l)}}}function F1(u){let n,l;return n=new gs({props:{$$slots:{map:[B1],sidebar:[D1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&4127&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function R1(u,n,l){let c,p,v,S,s;vt(u,ps,ge=>l(9,c=ge)),vt(u,uc,ge=>l(10,p=ge)),vt(u,mn,ge=>l(11,v=ge)),vt(u,Ru,ge=>l(3,S=ge)),vt(u,js,ge=>l(4,s=ge));let{wasmReady:I}=n;ei(mn,v=null,v),ei(uc,p=null,p);let M,B;async function j(ge){try{let ve=JSON.parse(await B.files[0].text());if(ve.study_area_name)ei(ps,c=ve.study_area_name,c),window.localStorage.setItem(`ltn_${ve.study_area_name}.geojson`,JSON.stringify(ve)),await M.loadExample(ve.study_area_name);else{ei(ps,c="",c);let Ee=ve.features.find(re=>re.properties.kind=="study_area_boundary"),ne=await(await fetch(qm(Ee))).arrayBuffer();window.localStorage.setItem("ltn_custom.geojson",JSON.stringify(ve)),M.loadMap(ne)}}catch(ve){window.alert(`Couldn't open this file: ${ve}`)}}const ie=()=>ei(Ru,S=!0,S);function ae(ge){gr[ge?"unshift":"push"](()=>{B=ge,l(2,B)})}function ce(ge){gr[ge?"unshift":"push"](()=>{M=ge,l(1,M)})}return u.$$set=ge=>{"wasmReady"in ge&&l(0,I=ge.wasmReady)},[I,M,B,S,s,j,ie,ae,ce]}class O1 extends ci{constructor(n){super(),li(this,n,R1,F1,ti,{wasmReady:0})}}const{window:N1}=Wg;function V1(u){let n,l,c,p,v,S=u[0].shortcutIndex+"",s,I,M=u[0].gj.features.length+"",B,j,ie,ae,ce,ge,ve;return{c(){n=ye("div"),l=ye("button"),c=Gt("Prev"),v=et(),s=Gt(S),I=Gt(" / "),B=Gt(M),j=et(),ie=ye("button"),ae=Gt("Next"),l.disabled=p=u[0].shortcutIndex==null||u[0].shortcutIndex==0,ie.disabled=ce=u[0].shortcutIndex==u[0].gj.features.length-1},m(Ee,W){Be(Ee,n,W),fe(n,l),fe(l,c),fe(n,v),fe(n,s),fe(n,I),fe(n,B),fe(n,j),fe(n,ie),fe(ie,ae),ge||(ve=[Et(l,"click",u[6]),Et(ie,"click",u[7])],ge=!0)},p(Ee,W){W&1&&p!==(p=Ee[0].shortcutIndex==null||Ee[0].shortcutIndex==0)&&(l.disabled=p),W&1&&S!==(S=Ee[0].shortcutIndex+"")&&jr(s,S),W&1&&M!==(M=Ee[0].gj.features.length+"")&&jr(B,M),W&1&&ce!==(ce=Ee[0].shortcutIndex==Ee[0].gj.features.length-1)&&(ie.disabled=ce)},d(Ee){Ee&&De(n),ge=!1,_n(ve)}}}function U1(u){let n;return{c(){n=ye("p"),n.textContent="Click a road to see shortcuts"},m(l,c){Be(l,n,c)},p:Dt,d(l){l&&De(n)}}}function j1(u){let n,l,c,p,v,S;function s(B,j){if(B[0].state=="neutral")return U1;if(B[0].state=="chose-road")return V1}let I=s(u),M=I&&I(u);return{c(){n=ye("div"),l=ye("div"),c=ye("button"),c.textContent="Back to editing",p=et(),M&&M.c(),Ot(n,"slot","sidebar")},m(B,j){Be(B,n,j),fe(n,l),fe(l,c),fe(n,p),M&&M.m(n,null),v||(S=Et(c,"click",u[4]),v=!0)},p(B,j){I===(I=s(B))&&M?M.p(B,j):(M&&M.d(1),M=I&&I(B),M&&(M.c(),M.m(n,null)))},d(B){B&&De(n),M&&M.d(),v=!1,S()}}}function q1(u){let n,l,c,p;const v=[X1,G1],S=[];function s(I,M){return I[0].shortcutIndex==null?0:1}return n=s(u),l=S[n]=v[n](u),{c(){l.c(),c=Bn()},m(I,M){S[n].m(I,M),Be(I,c,M),p=!0},p(I,M){let B=n;n=s(I),n===B?S[n].p(I,M):(yr(),Ie(S[B],1,1,()=>{S[B]=null}),vr(),l=S[n],l?l.p(I,M):(l=S[n]=v[n](I),l.c()),be(l,1),l.m(c.parentNode,c))},i(I){p||(be(l),p=!0)},o(I){Ie(l),p=!1},d(I){I&&De(c),S[n].d(I)}}}function Z1(u){let n,l;return n=new ju({props:{gjInput:JSON.parse(Rt(u[1]).renderNeighbourhood()),onClickLine:u[5],$$slots:{"line-popup":[K1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&2&&(v.gjInput=JSON.parse(Rt(c[1]).renderNeighbourhood())),p&2048&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function G1(u){let n,l;return n=new Fn({props:{data:u[0].gj.features[u[0].shortcutIndex],$$slots:{default:[W1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&1&&(v.data=c[0].gj.features[c[0].shortcutIndex]),p&2048&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function X1(u){let n,l;return n=new Fn({props:{data:u[0].gj,$$slots:{default:[H1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&1&&(v.data=c[0].gj),p&2048&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function W1(u){let n,l;return n=new Xo({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function H1(u){let n,l;return n=new Xo({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function $1(u){let n=Rt(u[10]).properties.shortcuts+"",l;return{c(){l=Gt(n)},m(c,p){Be(c,l,p)},p(c,p){p&1024&&n!==(n=Rt(c[10]).properties.shortcuts+"")&&jr(l,n)},d(c){c&&De(l)}}}function K1(u){let n,l,c;return l=new wo({props:{openOn:"hover",$$slots:{default:[$1,({data:p})=>({10:p}),({data:p})=>p?1024:0]},$$scope:{ctx:u}}}),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","line-popup")},m(p,v){Be(p,n,v),We(l,n,null),c=!0},p(p,v){const S={};v&3072&&(S.$$scope={dirty:v,ctx:p}),l.$set(S)},i(p){c||(be(l.$$.fragment,p),c=!0)},o(p){Ie(l.$$.fragment,p),c=!1},d(p){p&&De(n),He(l)}}}function J1(u){let n,l,c,p,v,S;const s=[Z1,q1],I=[];function M(B,j){return B[0].state=="neutral"?0:B[0].state=="chose-road"?1:-1}return~(l=M(u))&&(c=I[l]=s[l](u)),v=new Id({}),{c(){n=ye("div"),c&&c.c(),p=et(),$e(v.$$.fragment),Ot(n,"slot","map")},m(B,j){Be(B,n,j),~l&&I[l].m(n,null),fe(n,p),We(v,n,null),S=!0},p(B,j){let ie=l;l=M(B),l===ie?~l&&I[l].p(B,j):(c&&(yr(),Ie(I[ie],1,1,()=>{I[ie]=null}),vr()),~l?(c=I[l],c?c.p(B,j):(c=I[l]=s[l](B),c.c()),be(c,1),c.m(n,p)):c=null)},i(B){S||(be(c),be(v.$$.fragment,B),S=!0)},o(B){Ie(c),Ie(v.$$.fragment,B),S=!1},d(B){B&&De(n),~l&&I[l].d(),He(v)}}}function Y1(u){let n,l,c,p;return n=new gs({props:{$$slots:{map:[J1],sidebar:[j1]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(v,S){We(n,v,S),l=!0,c||(p=Et(N1,"keydown",u[3]),c=!0)},p(v,[S]){const s={};S&2051&&(s.$$scope={dirty:S,ctx:v}),n.$set(s)},i(v){l||(be(n.$$.fragment,v),l=!0)},o(v){Ie(n.$$.fragment,v),l=!1},d(v){He(n,v),c=!1,p()}}}function Q1(u,n,l){let c,p,v;vt(u,zi,ae=>l(8,c=ae)),vt(u,js,ae=>l(9,p=ae)),vt(u,mn,ae=>l(1,v=ae));let S={state:"neutral"};function s(ae){let ce=JSON.parse(v.getShortcutsCrossingRoad(ae));if(ce.features.length==0){window.alert("No shortcuts here");return}l(0,S={state:"chose-road",road:ae,gj:ce,shortcutIndex:null})}dc(()=>{p==null||p.keyboard.disable()}),xo(()=>{p==null||p.keyboard.enable()});function I(ae){S.state=="chose-road"&&(ae.key=="ArrowLeft"&&S.shortcutIndex&&(ae.stopPropagation(),l(0,S.shortcutIndex--,S)),ae.key=="ArrowRight"&&(ae.stopPropagation(),S.shortcutIndex==null?l(0,S.shortcutIndex=0,S):S.shortcutIndex!=S.gj.features.length-1&&l(0,S.shortcutIndex++,S)),ae.key=="Escape"&&(ae.stopPropagation(),M()))}function M(){ei(zi,c={mode:"neighbourhood"},c)}return[S,v,s,I,M,ae=>s(Rt(ae.properties).id),()=>l(0,S.shortcutIndex--,S),()=>l(0,S.shortcutIndex++,S)]}class ex extends ci{constructor(n){super(),li(this,n,Q1,Y1,ti,{})}}function Yp(u){let n,l,c,p;return{c(){n=ye("div"),l=ye("button"),l.textContent="Zoom to fit study area"},m(v,S){Be(v,n,S),fe(n,l),c||(p=Et(l,"click",u[8]),c=!0)},p:Dt,d(v){v&&De(n),c=!1,p()}}}function tx(u){let n,l,c,p,v,S,s,I,M,B,j,ie,ae=u[6]&&Yp(u);return{c(){n=ye("div"),l=ye("div"),c=et(),p=ye("hr"),v=et(),ae&&ae.c(),S=et(),s=ye("div"),I=ye("label"),M=ye("input"),B=Gt("Show basemap"),Ot(M,"type","checkbox"),Ot(n,"slot","left")},m(ce,ge){Be(ce,n,ge),fe(n,l),u[14](l),fe(n,c),fe(n,p),fe(n,v),ae&&ae.m(n,null),fe(n,S),fe(n,s),fe(s,I),fe(I,M),M.checked=u[3],fe(I,B),j||(ie=Et(M,"change",u[15]),j=!0)},p(ce,ge){ce[6]?ae?ae.p(ce,ge):(ae=Yp(ce),ae.c(),ae.m(n,S)):ae&&(ae.d(1),ae=null),ge&8&&(M.checked=ce[3])},d(ce){ce&&De(n),u[14](null),ae&&ae.d(),j=!1,ie()}}}function Qp(u){let n,l;return n=new O1({props:{wasmReady:u[4]}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&16&&(v.wasmReady=c[4]),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function em(u){let n,l,c,p,v,S;n=new Fn({props:{data:JSON.parse(u[6].getInvertedBoundary()),$$slots:{default:[ix]},$$scope:{ctx:u}}});const s=[cx,lx,ax,sx,ox,nx,rx],I=[];function M(B,j){return B[7].mode=="network"?0:B[7].mode=="set-boundary"?1:B[7].mode=="neighbourhood"?2:B[7].mode=="view-shortcuts"?3:B[7].mode=="route"?4:B[7].mode=="debug"?5:B[7].mode=="debug-gj"?6:-1}return~(c=M(u))&&(p=I[c]=s[c](u)),{c(){$e(n.$$.fragment),l=et(),p&&p.c(),v=Bn()},m(B,j){We(n,B,j),Be(B,l,j),~c&&I[c].m(B,j),Be(B,v,j),S=!0},p(B,j){const ie={};j&64&&(ie.data=JSON.parse(B[6].getInvertedBoundary())),j&131072&&(ie.$$scope={dirty:j,ctx:B}),n.$set(ie);let ae=c;c=M(B),c===ae?~c&&I[c].p(B,j):(p&&(yr(),Ie(I[ae],1,1,()=>{I[ae]=null}),vr()),~c?(p=I[c],p?p.p(B,j):(p=I[c]=s[c](B),p.c()),be(p,1),p.m(v.parentNode,v)):p=null)},i(B){S||(be(n.$$.fragment,B),be(p),S=!0)},o(B){Ie(n.$$.fragment,B),Ie(p),S=!1},d(B){B&&(De(l),De(v)),He(n,B),~c&&I[c].d(B)}}}function ix(u){let n,l;return n=new mc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function rx(u){let n,l;return n=new gb({}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function nx(u){let n,l;return n=new ab({}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function ox(u){let n,l;return n=new s1({}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function sx(u){let n,l;return n=new ex({}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function ax(u){let n,l;return n=new Ub({}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function lx(u){let n,l;return n=new b1({props:{name:u[7].name,existing:u[7].existing}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,p){const v={};p&128&&(v.name=c[7].name),p&128&&(v.existing=c[7].existing),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function cx(u){let n,l;return n=new Yb({}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p:Dt,i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function ux(u){let n,l,c,p,v,S=u[7].mode=="title"&&Qp(u),s=u[6]&&em(u);return{c(){n=ye("div"),l=et(),S&&S.c(),c=et(),s&&s.c(),p=Bn()},m(I,M){Be(I,n,M),u[11](n),Be(I,l,M),S&&S.m(I,M),Be(I,c,M),s&&s.m(I,M),Be(I,p,M),v=!0},p(I,M){I[7].mode=="title"?S?(S.p(I,M),M&128&&be(S,1)):(S=Qp(I),S.c(),be(S,1),S.m(c.parentNode,c)):S&&(yr(),Ie(S,1,1,()=>{S=null}),vr()),I[6]?s?(s.p(I,M),M&64&&be(s,1)):(s=em(I),s.c(),be(s,1),s.m(p.parentNode,p)):s&&(yr(),Ie(s,1,1,()=>{s=null}),vr())},i(I){v||(be(S),be(s),v=!0)},o(I){Ie(S),Ie(s),v=!1},d(I){I&&(De(n),De(l),De(c),De(p)),u[11](null),S&&S.d(I),s&&s.d(I)}}}function hx(u){let n,l,c,p;function v(s){u[12](s)}let S={style:u[5],standardControls:!0,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"}],$$slots:{default:[ux]},$$scope:{ctx:u}};return u[0]!==void 0&&(S.map=u[0]),l=new s0({props:S}),gr.push(()=>_s(l,"map",v)),l.$on("error",u[13]),{c(){n=ye("div"),$e(l.$$.fragment),Ot(n,"slot","main"),La(n,"position","relative"),La(n,"width","100%"),La(n,"height","100vh")},m(s,I){Be(s,n,I),We(l,n,null),p=!0},p(s,I){const M={};I&32&&(M.style=s[5]),I&131284&&(M.$$scope={dirty:I,ctx:s}),!c&&I&1&&(c=!0,M.map=s[0],ms(()=>c=!1)),l.$set(M)},i(s){p||(be(l.$$.fragment,s),p=!0)},o(s){Ie(l.$$.fragment,s),p=!1},d(s){s&&De(n),He(l)}}}function dx(u){let n,l;return n=new E0({props:{$$slots:{main:[hx],left:[tx]},$$scope:{ctx:u}}}),{c(){$e(n.$$.fragment)},m(c,p){We(n,c,p),l=!0},p(c,[p]){const v={};p&131327&&(v.$$scope={dirty:p,ctx:c}),n.$set(v)},i(c){l||(be(n.$$.fragment,c),l=!0)},o(c){Ie(n.$$.fragment,c),l=!1},d(c){He(n,c)}}}function fx(u,n,l){let c,p,v,S,s,I,M;vt(u,pd,re=>l(9,p=re)),vt(u,fd,re=>l(10,v=re)),vt(u,mn,re=>l(6,S=re)),vt(u,js,re=>l(16,s=re)),vt(u,dd,re=>l(3,I=re)),vt(u,zi,re=>l(7,M=re));let B=!1;dc(async()=>{await um(),await dm(),l(4,B=!0)});let j;function ie(){s.fitBounds(Array.from(S.getBounds()),{animate:!1})}let ae,ce;function ge(re){gr[re?"unshift":"push"](()=>{ce=re,l(2,ce),l(9,p)})}function ve(re){j=re,l(0,j)}const Ee=re=>{console.log(re.detail.error)};function W(re){gr[re?"unshift":"push"](()=>{ae=re,l(1,ae),l(10,v)})}function ne(){I=this.checked,dd.set(I)}return u.$$.update=()=>{u.$$.dirty&8&&l(5,c=I?"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo":{version:8,sources:{},layers:[]}),u.$$.dirty&1&&j&&js.set(j),u.$$.dirty&1026&&ae&&v&&(l(1,ae.innerHTML="",ae),ae.appendChild(v)),u.$$.dirty&516&&ce&&p&&(l(2,ce.innerHTML="",ce),ce.appendChild(p))},[j,ae,ce,I,B,c,S,M,ie,p,v,ge,ve,Ee,W,ne]}class px extends ci{constructor(n){super(),li(this,n,fx,dx,ti,{})}}new px({target:document.getElementById("app")});
