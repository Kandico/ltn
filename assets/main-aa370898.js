var $v=Object.defineProperty;var Hv=(o,e,t)=>e in o?$v(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Dn=(o,e,t)=>(Hv(o,typeof e!="symbol"?e+"":e,t),t);function Xv(o,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in o)){const u=Object.getOwnPropertyDescriptor(n,l);u&&Object.defineProperty(o,l,u.get?u:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function Pt(){}function sn(o,e){for(const t in e)o[t]=e[t];return o}function Uy(o){return o()}function wg(){return Object.create(null)}function an(o){o.forEach(Uy)}function Kl(o){return typeof o=="function"}function Ft(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let Qh;function Tn(o,e){return o===e?!0:(Qh||(Qh=document.createElement("a")),Qh.href=e,o===Qh.href)}function Kv(o){return Object.keys(o).length===0}function Vy(o,...e){if(o==null){for(const n of e)n(void 0);return Pt}const t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ir(o){let e;return Vy(o,t=>e=t)(),e}function dt(o,e,t){o.$$.on_destroy.push(Vy(e,t))}function Bi(o,e,t,n){if(o){const l=qy(o,e,t,n);return o[0](l)}}function qy(o,e,t,n){return o[1]&&n?sn(t.ctx.slice(),o[1](n(e))):t.ctx}function Fi(o,e,t,n){if(o[2]&&n){const l=o[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],f=Math.max(e.dirty.length,l.length);for(let a=0;a<f;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Oi(o,e,t,n,l,u){if(l){const f=qy(e,t,n,u);o.p(f,l)}}function Ni(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function Jv(o){const e={};for(const t in o)e[t]=!0;return e}function pd(o){return o??""}function At(o,e,t){return o.set(t),e}function tp(o){return o&&Kl(o.destroy)?o.destroy:Pt}const Sd=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Y(o,e){o.appendChild(e)}function he(o,e,t){o.insertBefore(e,t||null)}function ue(o){o.parentNode&&o.parentNode.removeChild(o)}function Ss(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function ce(o){return document.createElement(o)}function xs(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Qe(o){return document.createTextNode(o)}function Re(){return Qe(" ")}function En(){return Qe("")}function Et(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function Tp(o){return function(e){return e.preventDefault(),o.call(this,e)}}function qf(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function Te(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Zy(o){let e;return{p(...t){e=t,e.forEach(n=>o.push(n))},r(){e.forEach(t=>o.splice(o.indexOf(t),1))}}}function Ep(o){return o===""?null:+o}function Yv(o){return Array.from(o.childNodes)}function Ci(o,e){e=""+e,o.data!==e&&(o.data=e)}function Bn(o,e){o.value=e??""}function fn(o,e,t,n){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,n?"important":"")}function Jl(o,e,t){for(let n=0;n<o.options.length;n+=1){const l=o.options[n];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Cp(o){const e=o.querySelector(":checked");return e&&e.__value}function ar(o,e,t){o.classList.toggle(e,!!t)}function Qv(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let Su;function vu(o){Su=o}function Nu(){if(!Su)throw new Error("Function called outside component initialization");return Su}function Td(o){Nu().$$.on_mount.push(o)}function Qn(o){Nu().$$.on_destroy.push(o)}function ts(){const o=Nu();return(e,t,{cancelable:n=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=Qv(e,t,{cancelable:n});return l.slice().forEach(f=>{f.call(o,u)}),!u.defaultPrevented}return!0}}function Ed(o,e){return Nu().$$.context.set(o,e),e}function Cd(o){return Nu().$$.context.get(o)}function ui(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Vl=[],Xi=[];let Wl=[];const ip=[],Gy=Promise.resolve();let np=!1;function Wy(){np||(np=!0,Gy.then(Hy))}function $y(){return Wy(),Gy}function Yl(o){Wl.push(o)}function Gr(o){ip.push(o)}const Zf=new Set;let Bl=0;function Hy(){if(Bl!==0)return;const o=Su;do{try{for(;Bl<Vl.length;){const e=Vl[Bl];Bl++,vu(e),eb(e.$$)}}catch(e){throw Vl.length=0,Bl=0,e}for(vu(null),Vl.length=0,Bl=0;Xi.length;)Xi.pop()();for(let e=0;e<Wl.length;e+=1){const t=Wl[e];Zf.has(t)||(Zf.add(t),t())}Wl.length=0}while(Vl.length);for(;ip.length;)ip.pop()();np=!1,Zf.clear(),vu(o)}function eb(o){if(o.fragment!==null){o.update(),an(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Yl)}}function tb(o){const e=[],t=[];Wl.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Wl=e}const rd=new Set;let Da;function gi(){Da={r:0,c:[],p:Da}}function _i(){Da.r||an(Da.c),Da=Da.p}function ie(o,e){o&&o.i&&(rd.delete(o),o.i(e))}function oe(o,e,t,n){if(o&&o.o){if(rd.has(o))return;rd.add(o),Da.c.push(()=>{rd.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function Kn(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function ib(o,e){oe(o,1,1,()=>{e.delete(o.key)})}function nb(o,e,t,n,l,u,f,a,_,b,k,S){let I=o.length,P=u.length,D=I;const B={};for(;D--;)B[o[D].key]=D;const z=[],R=new Map,O=new Map,U=[];for(D=P;D--;){const H=S(l,u,D),ee=t(H);let ve=f.get(ee);ve?n&&U.push(()=>ve.p(H,e)):(ve=b(ee,H),ve.c()),R.set(ee,z[D]=ve),ee in B&&O.set(ee,Math.abs(D-B[ee]))}const q=new Set,se=new Set;function re(H){ie(H,1),H.m(a,k),f.set(H.key,H),k=H.first,P--}for(;I&&P;){const H=z[P-1],ee=o[I-1],ve=H.key,Oe=ee.key;H===ee?(k=H.first,I--,P--):R.has(Oe)?!f.has(ve)||q.has(ve)?re(H):se.has(Oe)?I--:O.get(ve)>O.get(Oe)?(se.add(ve),re(H)):(q.add(Oe),I--):(_(ee,f),I--)}for(;I--;){const H=o[I];R.has(H.key)||_(H,f)}for(;P;)re(z[P-1]);return an(U),z}function Tu(o,e){const t={},n={},l={$$scope:1};let u=o.length;for(;u--;){const f=o[u],a=e[u];if(a){for(const _ in f)_ in a||(n[_]=1);for(const _ in a)l[_]||(t[_]=a[_],l[_]=1);o[u]=a}else for(const _ in f)l[_]=1}for(const f in n)f in t||(t[f]=void 0);return t}function Wr(o,e,t){const n=o.$$.props[e];n!==void 0&&(o.$$.bound[n]=t,t(o.$$.ctx[n]))}function Pe(o){o&&o.c()}function Le(o,e,t){const{fragment:n,after_update:l}=o.$$;n&&n.m(e,t),Yl(()=>{const u=o.$$.on_mount.map(Uy).filter(Kl);o.$$.on_destroy?o.$$.on_destroy.push(...u):an(u),o.$$.on_mount=[]}),l.forEach(Yl)}function Ae(o,e){const t=o.$$;t.fragment!==null&&(tb(t.after_update),an(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function rb(o,e){o.$$.dirty[0]===-1&&(Vl.push(o),Wy(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function qt(o,e,t,n,l,u,f=null,a=[-1]){const _=Su;vu(o);const b=o.$$={fragment:null,ctx:[],props:u,update:Pt,not_equal:l,bound:wg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:wg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};f&&f(b.root);let k=!1;if(b.ctx=t?t(o,e.props||{},(S,I,...P)=>{const D=P.length?P[0]:I;return b.ctx&&l(b.ctx[S],b.ctx[S]=D)&&(!b.skip_bound&&b.bound[S]&&b.bound[S](D),k&&rb(o,S)),I}):[],b.update(),k=!0,an(b.before_update),b.fragment=n?n(b.ctx):!1,e.target){if(e.hydrate){const S=Yv(e.target);b.fragment&&b.fragment.l(S),S.forEach(ue)}else b.fragment&&b.fragment.c();e.intro&&ie(o.$$.fragment),Le(o,e.target,e.anchor),Hy()}vu(_)}class Zt{constructor(){Dn(this,"$$");Dn(this,"$$set")}$destroy(){Ae(this,1),this.$destroy=Pt}$on(e,t){if(!Kl(t))return Pt;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!Kv(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ob="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ob);const sb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",ab="/ltn/assets/logo-97f2d067.svg";function xg(o){let e,t;return{c(){e=ce("div"),t=Qe(o[0]),Te(e,"class","svelte-1uuov7f")},m(n,l){he(n,e,l),Y(e,t)},p(n,l){l&1&&Ci(t,n[0])},d(n){n&&ue(e)}}}function lb(o){let e,t=o[0]&&xg(o);return{c(){t&&t.c(),e=En()},m(n,l){t&&t.m(n,l),he(n,e,l)},p(n,[l]){n[0]?t?t.p(n,l):(t=xg(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Pt,o:Pt,d(n){n&&ue(e),t&&t.d(n)}}}function cb(o,e,t){let{loading:n}=e;return o.$$set=l=>{"loading"in l&&t(0,n=l.loading)},[n]}class Xy extends Zt{constructor(e){super(),qt(this,e,cb,lb,Ft,{loading:0})}}const ub=o=>({dialog:o&1}),kg=o=>({dialog:o[0]});function hb(o){let e,t,n,l,u;const f=o[4].default,a=Bi(f,o,o[3],kg);return{c(){e=ce("dialog"),t=ce("article"),a&&a.c(),e.open=!0},m(_,b){he(_,e,b),Y(e,t),a&&a.m(t,null),o[6](e),n=!0,l||(u=[Et(window,"click",o[1]),Et(window,"keydown",o[2]),Et(e,"close",o[5])],l=!0)},p(_,[b]){a&&a.p&&(!n||b&9)&&Oi(a,f,_,_[3],n?Fi(f,_[3],b,ub):Ni(_[3]),kg)},i(_){n||(ie(a,_),n=!0)},o(_){oe(a,_),n=!1},d(_){_&&ue(e),a&&a.d(_),o[6](null),l=!1,an(u)}}}function db(o,e,t){let{$$slots:n={},$$scope:l}=e,u;function f(k){u.open&&k.target==u&&u.close()}function a(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function _(k){ui.call(this,o,k)}function b(k){Xi[k?"unshift":"push"](()=>{u=k,t(0,u)})}return o.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,f,a,l,n,_,b]}class Md extends Zt{constructor(e){super(),qt(this,e,db,hb,Ft,{})}}function Sg(o,e,t){const n=o.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function Tg(o){let e,t,n=o[1]+"",l,u,f,a=o[2]+"",_,b;return{c(){e=ce("tr"),t=ce("td"),l=Qe(n),u=Re(),f=ce("td"),_=Qe(a),b=Re()},m(k,S){he(k,e,S),Y(e,t),Y(t,l),Y(e,u),Y(e,f),Y(f,_),Y(e,b)},p(k,S){S&1&&n!==(n=k[1]+"")&&Ci(l,n),S&1&&a!==(a=k[2]+"")&&Ci(_,a)},d(k){k&&ue(e)}}}function fb(o){let e,t,n=Kn(Object.entries(o[0])),l=[];for(let u=0;u<n.length;u+=1)l[u]=Tg(Sg(o,n,u));return{c(){e=ce("table"),t=ce("tbody");for(let u=0;u<l.length;u+=1)l[u].c();Te(e,"class","svelte-lh2o9l")},m(u,f){he(u,e,f),Y(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[f]){if(f&1){n=Kn(Object.entries(u[0]));let a;for(a=0;a<n.length;a+=1){const _=Sg(u,n,a);l[a]?l[a].p(_,f):(l[a]=Tg(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}},i:Pt,o:Pt,d(u){u&&ue(e),Ss(l,u)}}}function pb(o,e,t){let{properties:n}=e;return o.$$set=l=>{"properties"in l&&t(0,n=l.properties)},[n]}class Id extends Zt{constructor(e){super(),qt(this,e,pb,fb,Ft,{properties:0})}}function md(o,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",o),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function gr(o){if(o==null||o==null)throw new Error("Oops, notNull given something null");return o}var Ky=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jy(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Mp(o){if(o.__esModule)return o;var e=o.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(o).forEach(function(n){var l=Object.getOwnPropertyDescriptor(o,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:function(){return o[n]}})}),t}var Yy={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(o,e){(function(t,n){o.exports=n()})(Ky,function(){var t={},n={};function l(f,a,_){if(n[f]=_,f==="index"){var b="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",k={};return n.shared(k),n.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([b],{type:"text/javascript"}))),t}}l("shared",["exports"],function(f){function a(s,i,c,d){return new(c||(c=Promise))(function(g,w){function x(A){try{M(d.next(A))}catch(N){w(N)}}function T(A){try{M(d.throw(A))}catch(N){w(N)}}function M(A){var N;A.done?g(A.value):(N=A.value,N instanceof c?N:new c(function(j){j(N)})).then(x,T)}M((d=d.apply(s,i||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var b=k;function k(s,i){this.x=s,this.y=i}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,c=s.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),c=Math.sin(s),d=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=d,this},_rotateAround:function(s,i){var c=Math.cos(s),d=Math.sin(s),g=i.y+d*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-d*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var S=_(b),I=P;function P(s,i,c,d){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=d}P.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,d=0;d<8;d++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var x=0,T=1;for(c=s,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));d++)s>g?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var D=_(I);let B,z;function R(){return B==null&&(B=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),B}function O(){if(z==null&&(z=!1,R())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let d=0;d<5*5;d++){const g=4*d;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(d%5,Math.floor(d/5),1,1)}const c=i.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&c[d]!==d){z=!0;break}}}return z||!1}function U(s,i,c,d){const g=new D(s,i,c,d);return function(w){return g.solve(w)}}const q=U(.25,.1,.25,1);function se(s,i,c){return Math.min(c,Math.max(i,s))}function re(s,i,c){const d=c-i,g=((s-i)%d+d)%d+i;return g===i?c:g}function H(s,...i){for(const c of i)for(const d in c)s[d]=c[d];return s}let ee=1;function ve(s,i,c){const d={};for(const g in s)d[g]=i.call(c||this,s[g],g,s);return d}function Oe(s,i,c){const d={};for(const g in s)i.call(c||this,s[g],g,s)&&(d[g]=s[g]);return d}function ne(s){return Array.isArray(s)?s.map(ne):typeof s=="object"&&s?ve(s,ne):s}const ye={};function Ke(s){ye[s]||(typeof console<"u"&&console.warn(s),ye[s]=!0)}function Ce(s,i,c){return(c.y-s.y)*(i.x-s.x)>(i.y-s.y)*(c.x-s.x)}function et(s){let i=0;for(let c,d,g=0,w=s.length,x=w-1;g<w;x=g++)c=s[g],d=s[x],i+=(d.x-c.x)*(c.y+d.y);return i}function bt(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let pt=null;function st(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ii(s,i,c,d,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const T=x.startsWith("BGR"),M=new Uint8ClampedArray(d*g*4);if(yield w.copyTo(M,function(A,N,j,$,K){const Q=4*Math.max(-N,0),le=(Math.max(0,j)-j)*$*4+Q,ge=4*$,xe=Math.max(0,N),Fe=Math.max(0,j);return{rect:{x:xe,y:Fe,width:Math.min(A.width,N+$)-xe,height:Math.min(A.height,j+K)-Fe},layout:[{offset:le,stride:ge}]}}(s,i,c,d,g)),T)for(let A=0;A<M.length;A+=4){const N=M[A];M[A]=M[A+2],M[A+2]=N}return M}finally{w.close()}})}let Ot,zt;const Jt="AbortError";function Mt(){return new Error(Jt)}const ei={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Vt(s){return ei.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const hi="global-dispatcher";class xi extends Error{constructor(i,c,d,g){super(`AJAXError: ${c} (${i}): ${d}`),this.status=i,this.statusText=c,this.url=d,this.body=g}}const yi=()=>bt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ai=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const d=Vt(s.url);if(d)return d(s,i);if(bt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:hi},i)}if(!(/^file:/.test(c=s.url)||/^file:/.test(yi())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(d,g){return a(this,void 0,void 0,function*(){const w=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:yi(),signal:g.signal});d.type==="json"&&w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const A=yield x.blob();throw new xi(x.status,x.statusText,d.url,A)}let T;T=d.type==="arrayBuffer"||d.type==="image"?x.arrayBuffer():d.type==="json"?x.json():x.text();const M=yield T;if(g.signal.aborted)throw Mt();return{data:M,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,i);if(bt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:hi},i)}var c;return function(d,g){return new Promise((w,x)=>{const T=new XMLHttpRequest;T.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(T.responseType="arraybuffer");for(const M in d.headers)T.setRequestHeader(M,d.headers[M]);d.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=d.credentials==="include",T.onerror=()=>{x(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let M=T.response;if(d.type==="json")try{M=JSON.parse(T.response)}catch(A){return void x(A)}w({data:M,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const M=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});x(new xi(T.status,T.statusText,d.url,M))}},g.signal.addEventListener("abort",()=>{T.abort(),x(Mt())}),T.send(d.body)})}(s,i)};function ct(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),c=window.location;return i.protocol===c.protocol&&i.host===c.host}function It(s,i,c){c[s]&&c[s].indexOf(i)!==-1||(c[s]=c[s]||[],c[s].push(i))}function Ne(s,i,c){if(c&&c[s]){const d=c[s].indexOf(i);d!==-1&&c[s].splice(d,1)}}class je{constructor(i,c={}){H(this,c),this.type=i}}class rt extends je{constructor(i,c={}){super("error",H({error:i},c))}}class xt{on(i,c){return this._listeners=this._listeners||{},It(i,c,this._listeners),this}off(i,c){return Ne(i,c,this._listeners),Ne(i,c,this._oneTimeListeners),this}once(i,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},It(i,c,this._oneTimeListeners),this):new Promise(d=>this.once(i,d))}fire(i,c){typeof i=="string"&&(i=new je(i,c||{}));const d=i.type;if(this.listens(d)){i.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of g)T.call(this,i);const w=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of w)Ne(d,T,this._oneTimeListeners),T.call(this,i);const x=this._eventedParent;x&&(H(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof rt&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,c){return this._eventedParent=i,this._eventedParentData=c,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const di=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ve(s,i){const c={};for(const d in s)d!=="ref"&&(c[d]=s[d]);return di.forEach(d=>{d in i&&(c[d]=i[d])}),c}function $e(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let c=0;c<s.length;c++)if(!$e(s[c],i[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const c in s)if(!$e(s[c],i[c]))return!1;return!0}return s===i}function kt(s,i){s.push(i)}function vn(s,i,c){kt(c,{command:"addSource",args:[s,i[s]]})}function bn(s,i,c){kt(i,{command:"removeSource",args:[s]}),c[s]=!0}function Cn(s,i,c,d){bn(s,c,d),vn(s,i,c)}function er(s,i,c){let d;for(d in s[c])if(Object.prototype.hasOwnProperty.call(s[c],d)&&d!=="data"&&!$e(s[c][d],i[c][d]))return!1;for(d in i[c])if(Object.prototype.hasOwnProperty.call(i[c],d)&&d!=="data"&&!$e(s[c][d],i[c][d]))return!1;return!0}function tr(s,i,c,d,g,w){s=s||{},i=i||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&($e(s[x],i[x])||c.push({command:w,args:[d,x,i[x],g]}));for(const x in i)Object.prototype.hasOwnProperty.call(i,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&($e(s[x],i[x])||c.push({command:w,args:[d,x,i[x],g]}))}function Uo(s){return s.id}function Ki(s,i){return s[i.id]=i,s}class ut{constructor(i,c,d,g){this.message=(i?`${i}: `:"")+d,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Hn(s,...i){for(const c of i)for(const d in c)s[d]=c[d];return s}class wn extends Error{constructor(i,c){super(c),this.message=c,this.key=i}}class Lo{constructor(i,c=[]){this.parent=i,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(i){return new Lo(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Vi={kind:"null"},gt={kind:"number"},ni={kind:"string"},Yt={kind:"boolean"},qi={kind:"color"},_r={kind:"object"},ti={kind:"value"},eo={kind:"collator"},ln={kind:"formatted"},me={kind:"padding"},W={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function te(s,i){return{kind:"array",itemType:s,N:i}}function de(s){if(s.kind==="array"){const i=de(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const Me=[Vi,gt,ni,Yt,qi,ln,_r,te(ti),me,W,X];function Ie(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Ie(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const c of Me)if(!Ie(c,i))return null}}return`Expected ${de(s)} but found ${de(i)} instead.`}function Be(s,i){return i.some(c=>c.kind===s.kind)}function ke(s,i){return i.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function G(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const Ue=.96422,qe=.82521,Ge=4/29,Je=6/29,ht=3*Je*Je,Rt=Je*Je*Je,Xt=Math.PI/180,ai=180/Math.PI;function vi(s){return(s%=360)<0&&(s+=360),s}function Ji([s,i,c,d]){let g,w;const x=li((.2225045*(s=Mn(s))+.7168786*(i=Mn(i))+.0606169*(c=Mn(c)))/1);s===i&&i===c?g=w=x:(g=li((.4360747*s+.3850649*i+.1430804*c)/Ue),w=li((.0139322*s+.0971045*i+.7141733*c)/qe));const T=116*x-16;return[T<0?0:T,500*(g-x),200*(x-w),d]}function Mn(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function li(s){return s>Rt?Math.pow(s,1/3):s/ht+Ge}function cn([s,i,c,d]){let g=(s+16)/116,w=isNaN(i)?g:g+i/500,x=isNaN(c)?g:g-c/200;return g=1*lr(g),w=Ue*lr(w),x=qe*lr(x),[Fn(3.1338561*w-1.6168667*g-.4906146*x),Fn(-.9787684*w+1.9161415*g+.033454*x),Fn(.0719453*w-.2289914*g+1.4052427*x),d]}function Fn(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function lr(s){return s>Je?s*s*s:ht*(s-Ge)}function yr(s){return parseInt(s.padEnd(2,s),16)/255}function Xn(s,i){return po(i?s/100:s,0,1)}function po(s,i,c){return Math.min(Math.max(i,s),c)}function Hu(s){return!s.some(Number.isNaN)}const Fd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class zi{constructor(i,c,d,g=1,w=!0){this.r=i,this.g=c,this.b=d,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,c,d,g]))}static parse(i){if(i instanceof zi)return i;if(typeof i!="string")return;const c=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Fd[d];if(g){const[x,T,M]=g;return[x/255,T/255,M/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const x=d.length<6?1:2;let T=1;return[yr(d.slice(T,T+=x)),yr(d.slice(T,T+=x)),yr(d.slice(T,T+=x)),yr(d.slice(T,T+x)||"ff")]}if(d.startsWith("rgb")){const x=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,M,A,N,j,$,K,Q,le,ge,xe,Fe]=x,Se=[N||" ",K||" ",ge].join("");if(Se==="  "||Se==="  /"||Se===",,"||Se===",,,"){const ze=[A,$,le].join(""),Ye=ze==="%%%"?100:ze===""?255:0;if(Ye){const tt=[po(+M/Ye,0,1),po(+j/Ye,0,1),po(+Q/Ye,0,1),xe?Xn(+xe,Fe):1];if(Hu(tt))return tt}}return}}const w=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,T,M,A,N,j,$,K,Q]=w,le=[M||" ",N||" ",$].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const ge=[+T,po(+A,0,100),po(+j,0,100),K?Xn(+K,Q):1];if(Hu(ge))return function([xe,Fe,Se,ze]){function Ye(tt){const Ct=(tt+xe/30)%12,Bt=Fe*Math.min(Se,1-Se);return Se-Bt*Math.max(-1,Math.min(Ct-3,9-Ct,1))}return xe=vi(xe),Fe/=100,Se/=100,[Ye(0),Ye(8),Ye(4),ze]}(ge)}}}(i);return c?new zi(...c,!1):void 0}get rgb(){const{r:i,g:c,b:d,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[i/w,c/w,d/w,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[c,d,g,w]=Ji(i),x=Math.sqrt(d*d+g*g);return[Math.round(1e4*x)?vi(Math.atan2(g,d)*ai):NaN,x,c,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ji(this.rgb))}overwriteGetter(i,c){return Object.defineProperty(this,i,{value:c}),c}toString(){const[i,c,d,g]=this.rgb;return`rgba(${[i,c,d].map(w=>Math.round(255*w)).join(",")},${g})`}}zi.black=new zi(0,0,0,1),zi.white=new zi(1,1,1,1),zi.transparent=new zi(0,0,0,0),zi.red=new zi(1,0,0,1);class oc{constructor(i,c,d){this.sensitivity=i?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,c){return this.collator.compare(i,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sc{constructor(i,c,d,g,w){this.text=i,this.image=c,this.scale=d,this.fontStack=g,this.textColor=w}}class Pr{constructor(i){this.sections=i}static fromString(i){return new Pr([new sc(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Pr?i:Pr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class vr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof vr)return i;if(typeof i=="number")return new vr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const c of i)if(typeof c!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new vr(i)}}toString(){return JSON.stringify(this.values)}}const aa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $r{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof $r)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let c=0;c<i.length;c+=2){const d=i[c],g=i[c+1];if(typeof d!="string"||!aa.has(d)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new $r(i)}}toString(){return JSON.stringify(this.values)}}class Hr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Hr({name:i,available:!1}):null}}function As(s,i,c,d){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[s,i,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[s,i,c,d]:[s,i,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Na(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof zi||s instanceof oc||s instanceof Pr||s instanceof vr||s instanceof $r||s instanceof Hr)return!0;if(Array.isArray(s)){for(const i of s)if(!Na(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!Na(s[i]))return!1;return!0}return!1}function In(s){if(s===null)return Vi;if(typeof s=="string")return ni;if(typeof s=="boolean")return Yt;if(typeof s=="number")return gt;if(s instanceof zi)return qi;if(s instanceof oc)return eo;if(s instanceof Pr)return ln;if(s instanceof vr)return me;if(s instanceof $r)return X;if(s instanceof Hr)return W;if(Array.isArray(s)){const i=s.length;let c;for(const d of s){const g=In(d);if(c){if(c===g)continue;c=ti;break}c=g}return te(c||ti,i)}return _r}function la(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof zi||s instanceof Pr||s instanceof vr||s instanceof $r||s instanceof Hr?s.toString():JSON.stringify(s)}class Vo{constructor(i,c){this.type=i,this.value=c}static parse(i,c){if(i.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Na(i[1]))return c.error("invalid value");const d=i[1];let g=In(d);const w=c.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new Vo(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class tn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ja={string:ni,number:gt,boolean:Yt,object:_r};class zr{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");let d,g=1;const w=i[0];if(w==="array"){let T,M;if(i.length>2){const A=i[1];if(typeof A!="string"||!(A in ja)||A==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=ja[A],g++}else T=ti;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return c.error('The length argument to "array" must be a positive integer literal',2);M=i[2],g++}d=te(T,M)}else{if(!ja[w])throw new Error(`Types doesn't contain name = ${w}`);d=ja[w]}const x=[];for(;g<i.length;g++){const T=c.parse(i[g],g,ti);if(!T)return null;x.push(T)}return new zr(d,x)}evaluate(i){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(i);if(!Ie(this.type,In(d)))return d;if(c===this.args.length-1)throw new tn(`Expected value to be of type ${de(this.type)}, but found ${de(In(d))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Ua={"to-boolean":Yt,"to-color":qi,"to-number":gt,"to-string":ni};class mo{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const d=i[0];if(!Ua[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&i.length!==2)return c.error("Expected one argument.");const g=Ua[d],w=[];for(let x=1;x<i.length;x++){const T=c.parse(i[x],x,ti);if(!T)return null;w.push(T)}return new mo(g,w)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let c,d;for(const g of this.args){if(c=g.evaluate(i),d=null,c instanceof zi)return c;if(typeof c=="string"){const w=i.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:As(c[0],c[1],c[2],c[3]),!d))return new zi(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new tn(d||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const d of this.args){c=d.evaluate(i);const g=vr.parse(c);if(g)return g}throw new tn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const d of this.args){c=d.evaluate(i);const g=$r.parse(c);if(g)return g}throw new tn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const d of this.args){if(c=d.evaluate(i),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new tn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Pr.fromString(la(this.args[0].evaluate(i)));case"resolvedImage":return Hr.fromString(la(this.args[0].evaluate(i)));default:return la(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ca=["Unknown","Point","LineString","Polygon"];class Di{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ca[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let c=this._parseColorCache[i];return c||(c=this._parseColorCache[i]=zi.parse(i)),c}}class Va{constructor(i,c,d=[],g,w=new Lo,x=[]){this.registry=i,this.path=d,this.key=d.map(T=>`[${T}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=c}parse(i,c,d,g,w={}){return c?this.concat(c,d,g)._parse(i,w):this._parse(i,w)}_parse(i,c){function d(g,w,x){return x==="assert"?new zr(w,[g]):x==="coerce"?new mo(w,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(i,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,M=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(T.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(T,M))return null}else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"assert")}if(!(x instanceof Vo)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const T=new Di;try{x=new Vo(x.type,x.evaluate(T))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,c,d){const g=typeof i=="number"?this.path.concat(i):this.path,w=d?this.scope.concat(d):this.scope;return new Va(this.registry,this._isConstant,g,c||null,w,this.errors)}error(i,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new wn(d,i))}checkSubtype(i,c){const d=Ie(i,c);return d&&this.error(d),d}}class Ps{constructor(i,c,d){this.type=eo,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=c}static parse(i,c){if(i.length!==2)return c.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,Yt);if(!g)return null;const w=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,Yt);if(!w)return null;let x=null;return d.locale&&(x=c.parse(d.locale,1,ni),!x)?null:new Ps(g,w,x)}evaluate(i){return new oc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const qo=8192;function qa(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function ua(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Od(s,i){const c=(180+s[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(c*g*qo),Math.round(d*g*qo)]}function Xu(s,i,c){const d=s[0]-i[0],g=s[1]-i[1],w=s[0]-c[0],x=s[1]-c[1];return d*x-w*g==0&&d*w<=0&&g*x<=0}function Za(s,i){let c=!1;for(let x=0,T=i.length;x<T;x++){const M=i[x];for(let A=0,N=M.length;A<N-1;A++){if(Xu(s,M[A],M[A+1]))return!1;(g=M[A])[1]>(d=s)[1]!=(w=M[A+1])[1]>d[1]&&d[0]<(w[0]-g[0])*(d[1]-g[1])/(w[1]-g[1])+g[0]&&(c=!c)}}var d,g,w;return c}function Nd(s,i){for(let c=0;c<i.length;c++)if(Za(s,i[c]))return!0;return!1}function Ku(s,i,c,d){const g=d[0]-c[0],w=d[1]-c[1],x=(s[0]-c[0])*w-g*(s[1]-c[1]),T=(i[0]-c[0])*w-g*(i[1]-c[1]);return x>0&&T<0||x<0&&T>0}function jd(s,i,c){for(const A of c)for(let N=0;N<A.length-1;++N)if((T=[(x=A[N+1])[0]-(w=A[N])[0],x[1]-w[1]])[0]*(M=[(g=i)[0]-(d=s)[0],g[1]-d[1]])[1]-T[1]*M[0]!=0&&Ku(d,g,w,x)&&Ku(w,x,d,g))return!0;var d,g,w,x,T,M;return!1}function Ju(s,i){for(let c=0;c<s.length;++c)if(!Za(s[c],i))return!1;for(let c=0;c<s.length-1;++c)if(jd(s[c],s[c+1],i))return!1;return!0}function Yu(s,i){for(let c=0;c<i.length;c++)if(Ju(s,i[c]))return!0;return!1}function Ga(s,i,c){const d=[];for(let g=0;g<s.length;g++){const w=[];for(let x=0;x<s[g].length;x++){const T=Od(s[g][x],c);qa(i,T),w.push(T)}d.push(w)}return d}function Qu(s,i,c){const d=[];for(let g=0;g<s.length;g++){const w=Ga(s[g],i,c);d.push(w)}return d}function eh(s,i,c,d){if(s[0]<c[0]||s[0]>c[2]){const g=.5*d;let w=s[0]-c[0]>g?-d:c[0]-s[0]>g?d:0;w===0&&(w=s[0]-c[2]>g?-d:c[2]-s[0]>g?d:0),s[0]+=w}qa(i,s)}function Wa(s,i,c,d){const g=Math.pow(2,d.z)*qo,w=[d.x*qo,d.y*qo],x=[];for(const T of s)for(const M of T){const A=[M.x+w[0],M.y+w[1]];eh(A,i,c,g),x.push(A)}return x}function th(s,i,c,d){const g=Math.pow(2,d.z)*qo,w=[d.x*qo,d.y*qo],x=[];for(const M of s){const A=[];for(const N of M){const j=[N.x+w[0],N.y+w[1]];qa(i,j),A.push(j)}x.push(A)}if(i[2]-i[0]<=g/2){(T=i)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const M of x)for(const A of M)eh(A,i,c,g)}var T;return x}class rs{constructor(i,c){this.type=Yt,this.geojson=i,this.geometries=c}static parse(i,c){if(i.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Na(i[1])){const d=i[1];if(d.type==="FeatureCollection"){const g=[];for(const w of d.features){const{type:x,coordinates:T}=w.geometry;x==="Polygon"&&g.push(T),x==="MultiPolygon"&&g.push(...T)}if(g.length)return new rs(d,{type:"MultiPolygon",coordinates:g})}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new rs(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new rs(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const T=Ga(d.coordinates,w,x),M=Wa(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const A of M)if(!Za(A,T))return!1}if(d.type==="MultiPolygon"){const T=Qu(d.coordinates,w,x),M=Wa(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const A of M)if(!Nd(A,T))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const T=Ga(d.coordinates,w,x),M=th(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const A of M)if(!Ju(A,T))return!1}if(d.type==="MultiPolygon"){const T=Qu(d.coordinates,w,x),M=th(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const A of M)if(!Yu(A,T))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $a{constructor(i,c){this.type=c.type,this.name=i,this.boundExpression=c}static parse(i,c){if(i.length!==2||typeof i[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=i[1];return c.scope.has(d)?new $a(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Dr{constructor(i,c,d,g){this.name=i,this.type=c,this._evaluate=d,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,c){const d=i[0],g=Dr.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=x.filter(([A])=>!Array.isArray(A)||A.length===i.length-1);let M=null;for(const[A,N]of T){M=new Va(c.registry,ha,c.path,null,c.scope);const j=[];let $=!1;for(let K=1;K<i.length;K++){const Q=i[K],le=Array.isArray(A)?A[K-1]:A.type,ge=M.parse(Q,1+j.length,le);if(!ge){$=!0;break}j.push(ge)}if(!$)if(Array.isArray(A)&&A.length!==j.length)M.error(`Expected ${A.length} arguments, but found ${j.length} instead.`);else{for(let K=0;K<j.length;K++){const Q=Array.isArray(A)?A[K]:A.type,le=j[K];M.concat(K+1).checkSubtype(Q,le.type)}if(M.errors.length===0)return new Dr(d,w,N,j)}}if(T.length===1)c.errors.push(...M.errors);else{const A=(T.length?T:x).map(([j])=>{return $=j,Array.isArray($)?`(${$.map(de).join(", ")})`:`(${de($.type)}...)`;var $}).join(" | "),N=[];for(let j=1;j<i.length;j++){const $=c.parse(i[j],1+N.length);if(!$)return null;N.push(de($.type))}c.error(`Expected arguments of type ${A}, but found (${N.join(", ")}) instead.`)}return null}static register(i,c){Dr.definitions=c;for(const d in c)i[d]=Dr}}function ha(s){if(s instanceof $a)return ha(s.boundExpression);if(s instanceof Dr&&s.name==="error"||s instanceof Ps||s instanceof rs)return!1;const i=s instanceof mo||s instanceof zr;let c=!0;return s.eachChild(d=>{c=i?c&&ha(d):c&&d instanceof Vo}),!!c&&Ha(s)&&fa(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ha(s){if(s instanceof Dr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof rs)return!1;let i=!0;return s.eachChild(c=>{i&&!Ha(c)&&(i=!1)}),i}function da(s){if(s instanceof Dr&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(c=>{i&&!da(c)&&(i=!1)}),i}function fa(s,i){if(s instanceof Dr&&i.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(d=>{c&&!fa(d,i)&&(c=!1)}),c}function pa(s,i){const c=s.length-1;let d,g,w=0,x=c,T=0;for(;w<=x;)if(T=Math.floor((w+x)/2),d=s[T],g=s[T+1],d<=i){if(T===c||i<g)return T;w=T+1}else{if(!(d>i))throw new tn("Input is not a number.");x=T-1}return 0}class ma{constructor(i,c,d){this.type=i,this.input=c,this.labels=[],this.outputs=[];for(const[g,w]of d)this.labels.push(g),this.outputs.push(w)}static parse(i,c){if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(i[1],1,gt);if(!d)return null;const g=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let x=1;x<i.length;x+=2){const T=x===1?-1/0:i[x],M=i[x+1],A=x,N=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const j=c.parse(M,N,w);if(!j)return null;w=w||j.type,g.push([T,j])}return new ma(w,d,g)}evaluate(i){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return d[0].evaluate(i);const w=c.length;return g>=c[w-1]?d[w-1].evaluate(i):d[pa(c,g)].evaluate(i)}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Ud(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Vd=ih;function ih(s,i,c,d){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=d}ih.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,d=0;d<8;d++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var x=0,T=1;for(c=s,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));d++)s>g?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var qd=Ud(Vd);function os(s,i,c){return s+c*(i-s)}function Xa(s,i,c){return s.map((d,g)=>os(d,i[g],c))}const cr={number:os,color:function(s,i,c,d="rgb"){switch(d){case"rgb":{const[g,w,x,T]=Xa(s.rgb,i.rgb,c);return new zi(g,w,x,T,!1)}case"hcl":{const[g,w,x,T]=s.hcl,[M,A,N,j]=i.hcl;let $,K;if(isNaN(g)||isNaN(M))isNaN(g)?isNaN(M)?$=NaN:($=M,x!==1&&x!==0||(K=A)):($=g,N!==1&&N!==0||(K=w));else{let Fe=M-g;M>g&&Fe>180?Fe-=360:M<g&&g-M>180&&(Fe+=360),$=g+c*Fe}const[Q,le,ge,xe]=function([Fe,Se,ze,Ye]){return Fe=isNaN(Fe)?0:Fe*Xt,cn([ze,Math.cos(Fe)*Se,Math.sin(Fe)*Se,Ye])}([$,K??os(w,A,c),os(x,N,c),os(T,j,c)]);return new zi(Q,le,ge,xe,!1)}case"lab":{const[g,w,x,T]=cn(Xa(s.lab,i.lab,c));return new zi(g,w,x,T,!1)}}},array:Xa,padding:function(s,i,c){return new vr(Xa(s.values,i.values,c))},variableAnchorOffsetCollection:function(s,i,c){const d=s.values,g=i.values;if(d.length!==g.length)throw new tn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const w=[];for(let x=0;x<d.length;x+=2){if(d[x]!==g[x])throw new tn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${d[x]}, to[${x}]: ${g[x]}`);w.push(d[x]);const[T,M]=d[x+1],[A,N]=g[x+1];w.push([os(T,A,c),os(M,N,c)])}return new $r(w)}};class ir{constructor(i,c,d,g,w){this.type=i,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[x,T]of w)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(i,c,d,g){let w=0;if(i.name==="exponential")w=Mi(c,i.base,d,g);else if(i.name==="linear")w=Mi(c,1,d,g);else if(i.name==="cubic-bezier"){const x=i.controlPoints;w=new qd(x[0],x[1],x[2],x[3]).solve(Mi(c,1,d,g))}return w}static parse(i,c){let[d,g,w,...x]=i;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const A=g[1];if(typeof A!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:A}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const A=g.slice(1);if(A.length!==4||A.some(N=>typeof N!="number"||N<0||N>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:A}}}if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,gt),!w)return null;const T=[];let M=null;d==="interpolate-hcl"||d==="interpolate-lab"?M=qi:c.expectedType&&c.expectedType.kind!=="value"&&(M=c.expectedType);for(let A=0;A<x.length;A+=2){const N=x[A],j=x[A+1],$=A+3,K=A+4;if(typeof N!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=N)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const Q=c.parse(j,K,M);if(!Q)return null;M=M||Q.type,T.push([N,Q])}return G(M,gt)||G(M,qi)||G(M,me)||G(M,X)||G(M,te(gt))?new ir(M,d,g,w,T):c.error(`Type ${de(M)} is not interpolatable.`)}evaluate(i){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return d[0].evaluate(i);const w=c.length;if(g>=c[w-1])return d[w-1].evaluate(i);const x=pa(c,g),T=ir.interpolationFactor(this.interpolation,g,c[x],c[x+1]),M=d[x].evaluate(i),A=d[x+1].evaluate(i);switch(this.operator){case"interpolate":return cr[this.type.kind](M,A,T);case"interpolate-hcl":return cr.color(M,A,T,"hcl");case"interpolate-lab":return cr.color(M,A,T,"lab")}}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Mi(s,i,c,d){const g=d-c,w=s-c;return g===0?0:i===1?w/g:(Math.pow(i,w)-1)/(Math.pow(i,g)-1)}class Ka{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&g.kind!=="value"&&(d=g);const w=[];for(const T of i.slice(1)){const M=c.parse(T,1+w.length,d,void 0,{typeAnnotation:"omit"});if(!M)return null;d=d||M.type,w.push(M)}if(!d)throw new Error("No output type");const x=g&&w.some(T=>Ie(g,T.type));return new Ka(x?ti:d,w)}evaluate(i){let c,d=null,g=0;for(const w of this.args)if(g++,d=w.evaluate(i),d&&d instanceof Hr&&!d.available&&(c||(c=d.name),d=null,g===this.args.length&&(d=c)),d!==null)break;return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class Ja{constructor(i,c){this.type=c.type,this.bindings=[].concat(i),this.result=c}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const c of this.bindings)i(c[1]);i(this.result)}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let w=1;w<i.length-1;w+=2){const x=i[w];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const T=c.parse(i[w+1],w+1);if(!T)return null;d.push([x,T])}const g=c.parse(i[i.length-1],i.length-1,c.expectedType,d);return g?new Ja(d,g):null}outputDefined(){return this.result.outputDefined()}}class ac{constructor(i,c,d){this.type=i,this.index=c,this.input=d}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,gt),g=c.parse(i[2],2,te(c.expectedType||ti));return d&&g?new ac(g.type.itemType,d,g):null}evaluate(i){const c=this.index.evaluate(i),d=this.input.evaluate(i);if(c<0)throw new tn(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new tn(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new tn(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class lc{constructor(i,c){this.type=Yt,this.needle=i,this.haystack=c}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,ti),g=c.parse(i[2],2,ti);return d&&g?Be(d.type,[Yt,ni,gt,Vi,ti])?new lc(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(d.type)} instead`):null}evaluate(i){const c=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!d)return!1;if(!ke(c,["boolean","string","number","null"]))throw new tn(`Expected first argument to be of type boolean, string, number or null, but found ${de(In(c))} instead.`);if(!ke(d,["string","array"]))throw new tn(`Expected second argument to be of type array or string, but found ${de(In(d))} instead.`);return d.indexOf(c)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Ya{constructor(i,c,d){this.type=gt,this.needle=i,this.haystack=c,this.fromIndex=d}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,ti),g=c.parse(i[2],2,ti);if(!d||!g)return null;if(!Be(d.type,[Yt,ni,gt,Vi,ti]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(d.type)} instead`);if(i.length===4){const w=c.parse(i[3],3,gt);return w?new Ya(d,g,w):null}return new Ya(d,g)}evaluate(i){const c=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!ke(c,["boolean","string","number","null"]))throw new tn(`Expected first argument to be of type boolean, string, number or null, but found ${de(In(c))} instead.`);if(!ke(d,["string","array"]))throw new tn(`Expected second argument to be of type array or string, but found ${de(In(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class cc{constructor(i,c,d,g,w,x){this.inputType=i,this.type=c,this.input=d,this.cases=g,this.outputs=w,this.otherwise=x}static parse(i,c){if(i.length<5)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const w={},x=[];for(let A=2;A<i.length-1;A+=2){let N=i[A];const j=i[A+1];Array.isArray(N)||(N=[N]);const $=c.concat(A);if(N.length===0)return $.error("Expected at least one branch label.");for(const Q of N){if(typeof Q!="number"&&typeof Q!="string")return $.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return $.error("Numeric branch labels must be integer values.");if(d){if($.checkSubtype(d,In(Q)))return null}else d=In(Q);if(w[String(Q)]!==void 0)return $.error("Branch labels must be unique.");w[String(Q)]=x.length}const K=c.parse(j,A,g);if(!K)return null;g=g||K.type,x.push(K)}const T=c.parse(i[1],1,ti);if(!T)return null;const M=c.parse(i[i.length-1],i.length-1,g);return M?T.type.kind!=="value"&&c.concat(1).checkSubtype(d,T.type)?null:new cc(d,g,T,w,x,M):null}evaluate(i){const c=this.input.evaluate(i);return(In(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class uc{constructor(i,c,d){this.type=i,this.branches=c,this.otherwise=d}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const g=[];for(let x=1;x<i.length-1;x+=2){const T=c.parse(i[x],x,Yt);if(!T)return null;const M=c.parse(i[x+1],x+1,d);if(!M)return null;g.push([T,M]),d=d||M.type}const w=c.parse(i[i.length-1],i.length-1,d);if(!w)return null;if(!d)throw new Error("Can't infer output type");return new uc(d,g,w)}evaluate(i){for(const[c,d]of this.branches)if(c.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[c,d]of this.branches)i(c),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Qa{constructor(i,c,d,g){this.type=i,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,ti),g=c.parse(i[2],2,gt);if(!d||!g)return null;if(!Be(d.type,[te(ti),ni,ti]))return c.error(`Expected first argument to be of type array or string, but found ${de(d.type)} instead`);if(i.length===4){const w=c.parse(i[3],3,gt);return w?new Qa(d.type,d,g,w):null}return new Qa(d.type,d,g)}evaluate(i){const c=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!ke(c,["string","array"]))throw new tn(`Expected first argument to be of type array or string, but found ${de(In(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return c.slice(d,g)}return c.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function nh(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function rh(s,i,c,d){return d.compare(i,c)===0}function zs(s,i,c){const d=s!=="=="&&s!=="!=";return class Qy{constructor(w,x,T){this.type=Yt,this.lhs=w,this.rhs=x,this.collator=T,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const T=w[0];let M=x.parse(w[1],1,ti);if(!M)return null;if(!nh(T,M.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${de(M.type)}'.`);let A=x.parse(w[2],2,ti);if(!A)return null;if(!nh(T,A.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${de(A.type)}'.`);if(M.type.kind!==A.type.kind&&M.type.kind!=="value"&&A.type.kind!=="value")return x.error(`Cannot compare types '${de(M.type)}' and '${de(A.type)}'.`);d&&(M.type.kind==="value"&&A.type.kind!=="value"?M=new zr(A.type,[M]):M.type.kind!=="value"&&A.type.kind==="value"&&(A=new zr(M.type,[A])));let N=null;if(w.length===4){if(M.type.kind!=="string"&&A.type.kind!=="string"&&M.type.kind!=="value"&&A.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(N=x.parse(w[3],3,eo),!N)return null}return new Qy(M,A,N)}evaluate(w){const x=this.lhs.evaluate(w),T=this.rhs.evaluate(w);if(d&&this.hasUntypedArgument){const M=In(x),A=In(T);if(M.kind!==A.kind||M.kind!=="string"&&M.kind!=="number")throw new tn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${A.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const M=In(x),A=In(T);if(M.kind!=="string"||A.kind!=="string")return i(w,x,T)}return this.collator?c(w,x,T,this.collator.evaluate(w)):i(w,x,T)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Zd=zs("==",function(s,i,c){return i===c},rh),Gd=zs("!=",function(s,i,c){return i!==c},function(s,i,c,d){return!rh(0,i,c,d)}),Wd=zs("<",function(s,i,c){return i<c},function(s,i,c,d){return d.compare(i,c)<0}),$d=zs(">",function(s,i,c){return i>c},function(s,i,c,d){return d.compare(i,c)>0}),Hd=zs("<=",function(s,i,c){return i<=c},function(s,i,c,d){return d.compare(i,c)<=0}),Xd=zs(">=",function(s,i,c){return i>=c},function(s,i,c,d){return d.compare(i,c)>=0});class hc{constructor(i,c,d,g,w){this.type=ni,this.number=i,this.locale=c,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(i,c){if(i.length!==3)return c.error("Expected two arguments.");const d=c.parse(i[1],1,gt);if(!d)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=c.parse(g.locale,1,ni),!w))return null;let x=null;if(g.currency&&(x=c.parse(g.currency,1,ni),!x))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,gt),!T))return null;let M=null;return g["max-fraction-digits"]&&(M=c.parse(g["max-fraction-digits"],1,gt),!M)?null:new hc(d,w,x,T,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class el{constructor(i){this.type=ln,this.sections=i}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=i.length-1;++x){const T=i[x];if(w&&typeof T=="object"&&!Array.isArray(T)){w=!1;let M=null;if(T["font-scale"]&&(M=c.parse(T["font-scale"],1,gt),!M))return null;let A=null;if(T["text-font"]&&(A=c.parse(T["text-font"],1,te(ni)),!A))return null;let N=null;if(T["text-color"]&&(N=c.parse(T["text-color"],1,qi),!N))return null;const j=g[g.length-1];j.scale=M,j.font=A,j.textColor=N}else{const M=c.parse(i[x],1,ti);if(!M)return null;const A=M.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:M,scale:null,font:null,textColor:null})}}return new el(g)}evaluate(i){return new Pr(this.sections.map(c=>{const d=c.content.evaluate(i);return In(d)===W?new sc("",d,null,null,null):new sc(la(d),null,c.scale?c.scale.evaluate(i):null,c.font?c.font.evaluate(i).join(","):null,c.textColor?c.textColor.evaluate(i):null)}))}eachChild(i){for(const c of this.sections)i(c.content),c.scale&&i(c.scale),c.font&&i(c.font),c.textColor&&i(c.textColor)}outputDefined(){return!1}}class dc{constructor(i){this.type=W,this.input=i}static parse(i,c){if(i.length!==2)return c.error("Expected two arguments.");const d=c.parse(i[1],1,ni);return d?new dc(d):c.error("No image name provided.")}evaluate(i){const c=this.input.evaluate(i),d=Hr.fromString(c);return d&&i.availableImages&&(d.available=i.availableImages.indexOf(c)>-1),d}eachChild(i){i(this.input)}outputDefined(){return!1}}class fc{constructor(i){this.type=gt,this.input=i}static parse(i,c){if(i.length!==2)return c.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=c.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${de(d.type)} instead.`):new fc(d):null}evaluate(i){const c=this.input.evaluate(i);if(typeof c=="string"||Array.isArray(c))return c.length;throw new tn(`Expected value to be of type string or array, but found ${de(In(c))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ds={"==":Zd,"!=":Gd,">":$d,"<":Wd,">=":Xd,"<=":Hd,array:zr,at:ac,boolean:zr,case:uc,coalesce:Ka,collator:Ps,format:el,image:dc,in:lc,"index-of":Ya,interpolate:ir,"interpolate-hcl":ir,"interpolate-lab":ir,length:fc,let:Ja,literal:Vo,match:cc,number:zr,"number-format":hc,object:zr,slice:Qa,step:ma,string:zr,"to-boolean":mo,"to-color":mo,"to-number":mo,"to-string":mo,var:$a,within:rs};function oh(s,[i,c,d,g]){i=i.evaluate(s),c=c.evaluate(s),d=d.evaluate(s);const w=g?g.evaluate(s):1,x=As(i,c,d,w);if(x)throw new tn(x);return new zi(i/255,c/255,d/255,w,!1)}function sh(s,i){return s in i}function pc(s,i){const c=i[s];return c===void 0?null:c}function ss(s){return{type:s}}function ah(s){return{result:"success",value:s}}function Rs(s){return{result:"error",value:s}}function Bs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function lh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function mc(s){return!!s.expression&&s.expression.interpolated}function Ei(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function tl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Kd(s){return s}function ch(s,i){const c=i.type==="color",d=s.stops&&typeof s.stops[0][0]=="object",g=d||!(d||s.property!==void 0),w=s.type||(mc(i)?"exponential":"interval");if(c||i.type==="padding"){const N=c?zi.parse:vr.parse;(s=Hn({},s)).stops&&(s.stops=s.stops.map(j=>[j[0],N(j[1])])),s.default=N(s.default?s.default:i.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let T,M,A;if(w==="exponential")T=ki;else if(w==="interval")T=Jd;else if(w==="categorical"){T=xn,M=Object.create(null);for(const N of s.stops)M[N[0]]=N[1];A=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);T=gc}if(d){const N={},j=[];for(let Q=0;Q<s.stops.length;Q++){const le=s.stops[Q],ge=le[0].zoom;N[ge]===void 0&&(N[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},j.push(ge)),N[ge].stops.push([le[0].value,le[1]])}const $=[];for(const Q of j)$.push([N[Q].zoom,ch(N[Q],i)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:ir.interpolationFactor.bind(void 0,K),zoomStops:$.map(Q=>Q[0]),evaluate:({zoom:Q},le)=>ki({stops:$,base:s.base},i,Q).evaluate(Q,le)}}if(g){const N=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:ir.interpolationFactor.bind(void 0,N),zoomStops:s.stops.map(j=>j[0]),evaluate:({zoom:j})=>T(s,i,j,M,A)}}return{kind:"source",evaluate(N,j){const $=j&&j.properties?j.properties[s.property]:void 0;return $===void 0?ga(s.default,i.default):T(s,i,$,M,A)}}}function ga(s,i,c){return s!==void 0?s:i!==void 0?i:c!==void 0?c:void 0}function xn(s,i,c,d,g){return ga(typeof c===g?d[c]:void 0,s.default,i.default)}function Jd(s,i,c){if(Ei(c)!=="number")return ga(s.default,i.default);const d=s.stops.length;if(d===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[d-1][0])return s.stops[d-1][1];const g=pa(s.stops.map(w=>w[0]),c);return s.stops[g][1]}function ki(s,i,c){const d=s.base!==void 0?s.base:1;if(Ei(c)!=="number")return ga(s.default,i.default);const g=s.stops.length;if(g===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[g-1][0])return s.stops[g-1][1];const w=pa(s.stops.map(N=>N[0]),c),x=function(N,j,$,K){const Q=K-$,le=N-$;return Q===0?0:j===1?le/Q:(Math.pow(j,le)-1)/(Math.pow(j,Q)-1)}(c,d,s.stops[w][0],s.stops[w+1][0]),T=s.stops[w][1],M=s.stops[w+1][1],A=cr[i.type]||Kd;return typeof T.evaluate=="function"?{evaluate(...N){const j=T.evaluate.apply(void 0,N),$=M.evaluate.apply(void 0,N);if(j!==void 0&&$!==void 0)return A(j,$,x,s.colorSpace)}}:A(T,M,x,s.colorSpace)}function gc(s,i,c){switch(i.type){case"color":c=zi.parse(c);break;case"formatted":c=Pr.fromString(c.toString());break;case"resolvedImage":c=Hr.fromString(c.toString());break;case"padding":c=vr.parse(c);break;default:Ei(c)===i.type||i.type==="enum"&&i.values[c]||(c=void 0)}return ga(c,s.default,i.default)}Dr.register(Ds,{error:[{kind:"error"},[ni],(s,[i])=>{throw new tn(i.evaluate(s))}],typeof:[ni,[ti],(s,[i])=>de(In(i.evaluate(s)))],"to-rgba":[te(gt,4),[qi],(s,[i])=>{const[c,d,g,w]=i.evaluate(s).rgb;return[255*c,255*d,255*g,w]}],rgb:[qi,[gt,gt,gt],oh],rgba:[qi,[gt,gt,gt,gt],oh],has:{type:Yt,overloads:[[[ni],(s,[i])=>sh(i.evaluate(s),s.properties())],[[ni,_r],(s,[i,c])=>sh(i.evaluate(s),c.evaluate(s))]]},get:{type:ti,overloads:[[[ni],(s,[i])=>pc(i.evaluate(s),s.properties())],[[ni,_r],(s,[i,c])=>pc(i.evaluate(s),c.evaluate(s))]]},"feature-state":[ti,[ni],(s,[i])=>pc(i.evaluate(s),s.featureState||{})],properties:[_r,[],s=>s.properties()],"geometry-type":[ni,[],s=>s.geometryType()],id:[ti,[],s=>s.id()],zoom:[gt,[],s=>s.globals.zoom],"heatmap-density":[gt,[],s=>s.globals.heatmapDensity||0],"line-progress":[gt,[],s=>s.globals.lineProgress||0],accumulated:[ti,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[gt,ss(gt),(s,i)=>{let c=0;for(const d of i)c+=d.evaluate(s);return c}],"*":[gt,ss(gt),(s,i)=>{let c=1;for(const d of i)c*=d.evaluate(s);return c}],"-":{type:gt,overloads:[[[gt,gt],(s,[i,c])=>i.evaluate(s)-c.evaluate(s)],[[gt],(s,[i])=>-i.evaluate(s)]]},"/":[gt,[gt,gt],(s,[i,c])=>i.evaluate(s)/c.evaluate(s)],"%":[gt,[gt,gt],(s,[i,c])=>i.evaluate(s)%c.evaluate(s)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(s,[i,c])=>Math.pow(i.evaluate(s),c.evaluate(s))],sqrt:[gt,[gt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))],log2:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[gt,[gt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[gt,[gt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[gt,[gt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[gt,[gt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[gt,[gt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[gt,[gt],(s,[i])=>Math.atan(i.evaluate(s))],min:[gt,ss(gt),(s,i)=>Math.min(...i.map(c=>c.evaluate(s)))],max:[gt,ss(gt),(s,i)=>Math.max(...i.map(c=>c.evaluate(s)))],abs:[gt,[gt],(s,[i])=>Math.abs(i.evaluate(s))],round:[gt,[gt],(s,[i])=>{const c=i.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[gt,[gt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[gt,[gt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Yt,[ni,ti],(s,[i,c])=>s.properties()[i.value]===c.value],"filter-id-==":[Yt,[ti],(s,[i])=>s.id()===i.value],"filter-type-==":[Yt,[ni],(s,[i])=>s.geometryType()===i.value],"filter-<":[Yt,[ni,ti],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[Yt,[ti],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c<d}],"filter->":[Yt,[ni,ti],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[Yt,[ti],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c>d}],"filter-<=":[Yt,[ni,ti],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[Yt,[ti],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c<=d}],"filter->=":[Yt,[ni,ti],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[Yt,[ti],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c>=d}],"filter-has":[Yt,[ti],(s,[i])=>i.value in s.properties()],"filter-has-id":[Yt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Yt,[te(ni)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Yt,[te(ti)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Yt,[ni,te(ti)],(s,[i,c])=>c.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Yt,[ni,te(ti)],(s,[i,c])=>function(d,g,w,x){for(;w<=x;){const T=w+x>>1;if(g[T]===d)return!0;g[T]>d?x=T-1:w=T+1}return!1}(s.properties()[i.value],c.value,0,c.value.length-1)],all:{type:Yt,overloads:[[[Yt,Yt],(s,[i,c])=>i.evaluate(s)&&c.evaluate(s)],[ss(Yt),(s,i)=>{for(const c of i)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Yt,overloads:[[[Yt,Yt],(s,[i,c])=>i.evaluate(s)||c.evaluate(s)],[ss(Yt),(s,i)=>{for(const c of i)if(c.evaluate(s))return!0;return!1}]]},"!":[Yt,[Yt],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Yt,[ni],(s,[i])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(i.evaluate(s))}],upcase:[ni,[ni],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[ni,[ni],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[ni,ss(ti),(s,i)=>i.map(c=>la(c.evaluate(s))).join("")],"resolved-locale":[ni,[eo],(s,[i])=>i.evaluate(s).resolvedLocale()]});class Wi{constructor(i,c){var d;this.expression=i,this._warningHistory={},this._evaluator=new Di,this._defaultValue=c?(d=c).type==="color"&&tl(d.default)?new zi(0,0,0,0):d.type==="color"?zi.parse(d.default)||null:d.type==="padding"?vr.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?$r.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(i,c,d,g,w,x){return this._evaluator.globals=i,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,c,d,g,w,x){this._evaluator.globals=i,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new tn(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Zi(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ds}function as(s,i){const c=new Va(Ds,ha,[],i?function(g){const w={color:qi,string:ni,number:gt,enum:ni,boolean:Yt,formatted:ln,padding:me,resolvedImage:W,variableAnchorOffsetCollection:X};return g.type==="array"?te(w[g.value]||ti,g.length):w[g.type]}(i):void 0),d=c.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?ah(new Wi(d,i)):Rs(c.errors)}class il{constructor(i,c){this.kind=i,this._styleExpression=c,this.isStateDependent=i!=="constant"&&!da(c.expression)}evaluateWithoutErrorHandling(i,c,d,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(i,c,d,g,w,x)}evaluate(i,c,d,g,w,x){return this._styleExpression.evaluate(i,c,d,g,w,x)}}class _c{constructor(i,c,d,g){this.kind=i,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=i!=="camera"&&!da(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,c,d,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(i,c,d,g,w,x)}evaluate(i,c,d,g,w,x){return this._styleExpression.evaluate(i,c,d,g,w,x)}interpolationFactor(i,c,d){return this.interpolationType?ir.interpolationFactor(this.interpolationType,i,c,d):0}}function uh(s,i){const c=as(s,i);if(c.result==="error")return c;const d=c.value.expression,g=Ha(d);if(!g&&!Bs(i))return Rs([new wn("","data expressions not supported")]);const w=fa(d,["zoom"]);if(!w&&!lh(i))return Rs([new wn("","zoom expressions not supported")]);const x=rl(d);return x||w?x instanceof wn?Rs([x]):x instanceof ir&&!mc(i)?Rs([new wn("",'"interpolate" expressions cannot be used with this property')]):ah(x?new _c(g?"camera":"composite",c.value,x.labels,x instanceof ir?x.interpolation:void 0):new il(g?"constant":"source",c.value)):Rs([new wn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nl{constructor(i,c){this._parameters=i,this._specification=c,Hn(this,ch(this._parameters,this._specification))}static deserialize(i){return new nl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function rl(s){let i=null;if(s instanceof Ja)i=rl(s.result);else if(s instanceof Ka){for(const c of s.args)if(i=rl(c),i)break}else(s instanceof ma||s instanceof ir)&&s.input instanceof Dr&&s.input.name==="zoom"&&(i=s);return i instanceof wn||s.eachChild(c=>{const d=rl(c);d instanceof wn?i=d:!i&&d?i=new wn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&d&&i!==d&&(i=new wn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function ol(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!ol(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const hh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function sl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};ol(s)||(s=ll(s));const i=as(s,hh);if(i.result==="error")throw new Error(i.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,g)=>i.value.evaluate(c,d,{},g),needGeometry:al(s)}}function dh(s,i){return s<i?-1:s>i?1:0}function al(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let i=1;i<s.length;i++)if(al(s[i]))return!0;return!1}function ll(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?yc(s[1],s[2],"=="):i==="!="?cl(yc(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?yc(s[1],s[2],i):i==="any"?(c=s.slice(1),["any"].concat(c.map(ll))):i==="all"?["all"].concat(s.slice(1).map(ll)):i==="none"?["all"].concat(s.slice(1).map(ll).map(cl)):i==="in"?fh(s[1],s.slice(2)):i==="!in"?cl(fh(s[1],s.slice(2))):i==="has"?ph(s[1]):i==="!has"?cl(ph(s[1])):i!=="within"||s;var c}function yc(s,i,c){switch(s){case"$type":return[`filter-type-${c}`,i];case"$id":return[`filter-id-${c}`,i];default:return[`filter-${c}`,s,i]}}function fh(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(c=>typeof c!=typeof i[0])?["filter-in-large",s,["literal",i.sort(dh)]]:["filter-in-small",s,["literal",i]]}}function ph(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function cl(s){return["!",s]}function vc(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const w of s)g+=`${vc(w)},`;return`${g}]`}const c=Object.keys(s).sort();let d="{";for(let g=0;g<c.length;g++)d+=`${JSON.stringify(c[g])}:${vc(s[c[g]])},`;return`${d}}`}function Yd(s){let i="";for(const c of di)i+=`/${vc(s[c])}`;return i}function mh(s){const i=s.value;return i?[new ut(s.key,i,"constants have been deprecated as of v8")]:[]}function un(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Zo(s){if(Array.isArray(s))return s.map(Zo);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const c in s)i[c]=Zo(s[c]);return i}return un(s)}function ur(s){const i=s.key,c=s.value,d=s.valueSpec||{},g=s.objectElementValidators||{},w=s.style,x=s.styleSpec,T=s.validateSpec;let M=[];const A=Ei(c);if(A!=="object")return[new ut(i,c,`object expected, ${A} found`)];for(const N in c){const j=N.split(".")[0],$=d[j]||d["*"];let K;if(g[j])K=g[j];else if(d[j])K=T;else if(g["*"])K=g["*"];else{if(!d["*"]){M.push(new ut(i,c[N],`unknown property "${N}"`));continue}K=T}M=M.concat(K({key:(i&&`${i}.`)+N,value:c[N],valueSpec:$,style:w,styleSpec:x,object:c,objectKey:N,validateSpec:T},c))}for(const N in d)g[N]||d[N].required&&d[N].default===void 0&&c[N]===void 0&&M.push(new ut(i,c,`missing required property "${N}"`));return M}function bc(s){const i=s.value,c=s.valueSpec,d=s.style,g=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(Ei(i)!=="array")return[new ut(w,i,`array expected, ${Ei(i)} found`)];if(c.length&&i.length!==c.length)return[new ut(w,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new ut(w,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Ei(c.value)==="object"&&(T=c.value);let M=[];for(let A=0;A<i.length;A++)M=M.concat(x({array:i,arrayIndex:A,value:i[A],valueSpec:T,validateSpec:s.validateSpec,style:d,styleSpec:g,key:`${w}[${A}]`}));return M}function ul(s){const i=s.key,c=s.value,d=s.valueSpec;let g=Ei(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new ut(i,c,`number expected, ${g} found`)]:"minimum"in d&&c<d.minimum?[new ut(i,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new ut(i,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function gh(s){const i=s.valueSpec,c=un(s.value.type);let d,g,w,x={};const T=c!=="categorical"&&s.value.property===void 0,M=!T,A=Ei(s.value.stops)==="array"&&Ei(s.value.stops[0])==="array"&&Ei(s.value.stops[0][0])==="object",N=ur({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(K){if(c==="identity")return[new ut(K.key,K.value,'identity function may not have a "stops" property')];let Q=[];const le=K.value;return Q=Q.concat(bc({key:K.key,value:le,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:j})),Ei(le)==="array"&&le.length===0&&Q.push(new ut(K.key,le,"array must have at least one stop")),Q},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return c==="identity"&&T&&N.push(new ut(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||N.push(new ut(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!mc(s.valueSpec)&&N.push(new ut(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!Bs(s.valueSpec)?N.push(new ut(s.key,s.value,"property functions not supported")):T&&!lh(s.valueSpec)&&N.push(new ut(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!A||s.value.property!==void 0||N.push(new ut(s.key,s.value,'"property" property is required')),N;function j(K){let Q=[];const le=K.value,ge=K.key;if(Ei(le)!=="array")return[new ut(ge,le,`array expected, ${Ei(le)} found`)];if(le.length!==2)return[new ut(ge,le,`array length 2 expected, length ${le.length} found`)];if(A){if(Ei(le[0])!=="object")return[new ut(ge,le,`object expected, ${Ei(le[0])} found`)];if(le[0].zoom===void 0)return[new ut(ge,le,"object stop key must have zoom")];if(le[0].value===void 0)return[new ut(ge,le,"object stop key must have value")];if(w&&w>un(le[0].zoom))return[new ut(ge,le[0].zoom,"stop zoom values must appear in ascending order")];un(le[0].zoom)!==w&&(w=un(le[0].zoom),g=void 0,x={}),Q=Q.concat(ur({key:`${ge}[0]`,value:le[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:ul,value:$}}))}else Q=Q.concat($({key:`${ge}[0]`,value:le[0],valueSpec:{},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},le));return Zi(Zo(le[1]))?Q.concat([new ut(`${ge}[1]`,le[1],"expressions are not allowed in function stops.")]):Q.concat(K.validateSpec({key:`${ge}[1]`,value:le[1],valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function $(K,Q){const le=Ei(K.value),ge=un(K.value),xe=K.value!==null?K.value:Q;if(d){if(le!==d)return[new ut(K.key,xe,`${le} stop domain type must match previous stop domain type ${d}`)]}else d=le;if(le!=="number"&&le!=="string"&&le!=="boolean")return[new ut(K.key,xe,"stop domain value must be a number, string, or boolean")];if(le!=="number"&&c!=="categorical"){let Fe=`number expected, ${le} found`;return Bs(i)&&c===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ut(K.key,xe,Fe)]}return c!=="categorical"||le!=="number"||isFinite(ge)&&Math.floor(ge)===ge?c!=="categorical"&&le==="number"&&g!==void 0&&ge<g?[new ut(K.key,xe,"stop domain values must appear in ascending order")]:(g=ge,c==="categorical"&&ge in x?[new ut(K.key,xe,"stop domain values must be unique")]:(x[ge]=!0,[])):[new ut(K.key,xe,`integer expected, found ${ge}`)]}}function Go(s){const i=(s.expressionContext==="property"?uh:as)(Zo(s.value),s.valueSpec);if(i.result==="error")return i.value.map(d=>new ut(`${s.key}${d.key}`,s.value,d.message));const c=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new ut(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!da(c))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!da(c))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!fa(c,["zoom","feature-state"]))return[new ut(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ha(c))return[new ut(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wo(s){const i=s.key,c=s.value,d=s.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(un(c))===-1&&g.push(new ut(i,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(un(c))===-1&&g.push(new ut(i,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Fs(s){return ol(Zo(s.value))?Go(Hn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):wc(s)}function wc(s){const i=s.value,c=s.key;if(Ei(i)!=="array")return[new ut(c,i,`array expected, ${Ei(i)} found`)];const d=s.styleSpec;let g,w=[];if(i.length<1)return[new ut(c,i,"filter array must have at least 1 element")];switch(w=w.concat(Wo({key:`${c}[0]`,value:i[0],valueSpec:d.filter_operator,style:s.style,styleSpec:s.styleSpec})),un(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&un(i[1])==="$type"&&w.push(new ut(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new ut(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Ei(i[1]),g!=="string"&&w.push(new ut(`${c}[1]`,i[1],`string expected, ${g} found`)));for(let x=2;x<i.length;x++)g=Ei(i[x]),un(i[1])==="$type"?w=w.concat(Wo({key:`${c}[${x}]`,value:i[x],valueSpec:d.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new ut(`${c}[${x}]`,i[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)w=w.concat(wc({key:`${c}[${x}]`,value:i[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Ei(i[1]),i.length!==2?w.push(new ut(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new ut(`${c}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=Ei(i[1]),i.length!==2?w.push(new ut(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&w.push(new ut(`${c}[1]`,i[1],`object expected, ${g} found`))}return w}function hl(s,i){const c=s.key,d=s.validateSpec,g=s.style,w=s.styleSpec,x=s.value,T=s.objectKey,M=w[`${i}_${s.layerType}`];if(!M)return[];const A=T.match(/^(.*)-transition$/);if(i==="paint"&&A&&M[A[1]]&&M[A[1]].transition)return d({key:c,value:x,valueSpec:w.transition,style:g,styleSpec:w});const N=s.valueSpec||M[T];if(!N)return[new ut(c,x,`unknown property "${T}"`)];let j;if(Ei(x)==="string"&&Bs(N)&&!N.tokens&&(j=/^{([^}]+)}$/.exec(x)))return[new ut(c,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const $=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&$.push(new ut(c,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&tl(Zo(x))&&un(x.type)==="identity"&&$.push(new ut(c,x,'"text-font" does not support identity functions'))),$.concat(d({key:s.key,value:x,valueSpec:N,style:g,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:T}))}function xc(s){return hl(s,"paint")}function kc(s){return hl(s,"layout")}function _a(s){let i=[];const c=s.value,d=s.key,g=s.style,w=s.styleSpec;c.type||c.ref||i.push(new ut(d,c,'either "type" or "ref" is required'));let x=un(c.type);const T=un(c.ref);if(c.id){const M=un(c.id);for(let A=0;A<s.arrayIndex;A++){const N=g.layers[A];un(N.id)===M&&i.push(new ut(d,c.id,`duplicate layer id "${c.id}", previously used at line ${N.id.__line__}`))}}if("ref"in c){let M;["type","source","source-layer","filter","layout"].forEach(A=>{A in c&&i.push(new ut(d,c[A],`"${A}" is prohibited for ref layers`))}),g.layers.forEach(A=>{un(A.id)===T&&(M=A)}),M?M.ref?i.push(new ut(d,c.ref,"ref cannot reference another ref layer")):x=un(M.type):i.push(new ut(d,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const M=g.sources&&g.sources[c.source],A=M&&un(M.type);M?A==="vector"&&x==="raster"?i.push(new ut(d,c.source,`layer "${c.id}" requires a raster source`)):A!=="raster-dem"&&x==="hillshade"?i.push(new ut(d,c.source,`layer "${c.id}" requires a raster-dem source`)):A==="raster"&&x!=="raster"?i.push(new ut(d,c.source,`layer "${c.id}" requires a vector source`)):A!=="vector"||c["source-layer"]?A==="raster-dem"&&x!=="hillshade"?i.push(new ut(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||A==="geojson"&&M.lineMetrics||i.push(new ut(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ut(d,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new ut(d,c.source,`source "${c.source}" not found`))}else i.push(new ut(d,c,'missing required property "source"'));return i=i.concat(ur({key:d,value:c,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${d}.type`,value:c.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Fs,layout:M=>ur({layer:c,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>kc(Hn({layerType:x},A))}}),paint:M=>ur({layer:c,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>xc(Hn({layerType:x},A))}})}})),i}function ls(s){const i=s.value,c=s.key,d=Ei(i);return d!=="string"?[new ut(c,i,`string expected, ${d} found`)]:[]}const _h={promoteId:function({key:s,value:i}){if(Ei(i)==="string")return ls({key:s,value:i});{const c=[];for(const d in i)c.push(...ls({key:`${s}.${d}`,value:i[d]}));return c}}};function yh(s){const i=s.value,c=s.key,d=s.styleSpec,g=s.style,w=s.validateSpec;if(!i.type)return[new ut(c,i,'"type" is required')];const x=un(i.type);let T;switch(x){case"vector":case"raster":return T=ur({key:c,value:i,valueSpec:d[`source_${x.replace("-","_")}`],style:s.style,styleSpec:d,objectElementValidators:_h,validateSpec:w}),T;case"raster-dem":return T=function(M){var A;const N=(A=M.sourceName)!==null&&A!==void 0?A:"",j=M.value,$=M.styleSpec,K=$.source_raster_dem,Q=M.style;let le=[];const ge=Ei(j);if(j===void 0)return le;if(ge!=="object")return le.push(new ut("source_raster_dem",j,`object expected, ${ge} found`)),le;const xe=un(j.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],Se=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const ze in j)!xe&&Fe.includes(ze)?le.push(new ut(ze,j[ze],`In "${N}": "${ze}" is only valid when "encoding" is set to "custom". ${Se} encoding found`)):K[ze]?le=le.concat(M.validateSpec({key:ze,value:j[ze],valueSpec:K[ze],validateSpec:M.validateSpec,style:Q,styleSpec:$})):le.push(new ut(ze,j[ze],`unknown property "${ze}"`));return le}({sourceName:c,value:i,style:s.style,styleSpec:d,validateSpec:w}),T;case"geojson":if(T=ur({key:c,value:i,valueSpec:d.source_geojson,style:g,styleSpec:d,validateSpec:w,objectElementValidators:_h}),i.cluster)for(const M in i.clusterProperties){const[A,N]=i.clusterProperties[M],j=typeof A=="string"?[A,["accumulated"],["get",M]]:A;T.push(...Go({key:`${c}.${M}.map`,value:N,validateSpec:w,expressionContext:"cluster-map"})),T.push(...Go({key:`${c}.${M}.reduce`,value:j,validateSpec:w,expressionContext:"cluster-reduce"}))}return T;case"video":return ur({key:c,value:i,valueSpec:d.source_video,style:g,validateSpec:w,styleSpec:d});case"image":return ur({key:c,value:i,valueSpec:d.source_image,style:g,validateSpec:w,styleSpec:d});case"canvas":return[new ut(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wo({key:`${c}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:w,styleSpec:d})}}function vh(s){const i=s.value,c=s.styleSpec,d=c.light,g=s.style;let w=[];const x=Ei(i);if(i===void 0)return w;if(x!=="object")return w=w.concat([new ut("light",i,`object expected, ${x} found`)]),w;for(const T in i){const M=T.match(/^(.*)-transition$/);w=w.concat(M&&d[M[1]]&&d[M[1]].transition?s.validateSpec({key:T,value:i[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:g,styleSpec:c}):d[T]?s.validateSpec({key:T,value:i[T],valueSpec:d[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new ut(T,i[T],`unknown property "${T}"`)])}return w}function bh(s){const i=s.value,c=s.styleSpec,d=c.sky,g=s.style,w=Ei(i);if(i===void 0)return[];if(w!=="object")return[new ut("sky",i,`object expected, ${w} found`)];let x=[];for(const T in i)x=x.concat(d[T]?go({key:T,value:i[T],valueSpec:d[T],style:g,styleSpec:c}):[new ut(T,i[T],`unknown property "${T}"`)]);return x}function ya(s){const i=s.value,c=s.styleSpec,d=c.terrain,g=s.style;let w=[];const x=Ei(i);if(i===void 0)return w;if(x!=="object")return w=w.concat([new ut("terrain",i,`object expected, ${x} found`)]),w;for(const T in i)w=w.concat(d[T]?s.validateSpec({key:T,value:i[T],valueSpec:d[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new ut(T,i[T],`unknown property "${T}"`)]);return w}function va(s){let i=[];const c=s.value,d=s.key;if(Array.isArray(c)){const g=[],w=[];for(const x in c)c[x].id&&g.includes(c[x].id)&&i.push(new ut(d,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),g.push(c[x].id),c[x].url&&w.includes(c[x].url)&&i.push(new ut(d,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),w.push(c[x].url),i=i.concat(ur({key:`${d}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return ls({key:d,value:c})}const br={"*":()=>[],array:bc,boolean:function(s){const i=s.value,c=s.key,d=Ei(i);return d!=="boolean"?[new ut(c,i,`boolean expected, ${d} found`)]:[]},number:ul,color:function(s){const i=s.key,c=s.value,d=Ei(c);return d!=="string"?[new ut(i,c,`color expected, ${d} found`)]:zi.parse(String(c))?[]:[new ut(i,c,`color expected, "${c}" found`)]},constants:mh,enum:Wo,filter:Fs,function:gh,layer:_a,object:ur,source:yh,light:vh,sky:bh,terrain:ya,string:ls,formatted:function(s){return ls(s).length===0?[]:Go(s)},resolvedImage:function(s){return ls(s).length===0?[]:Go(s)},padding:function(s){const i=s.key,c=s.value;if(Ei(c)==="array"){if(c.length<1||c.length>4)return[new ut(i,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let g=[];for(let w=0;w<c.length;w++)g=g.concat(s.validateSpec({key:`${i}[${w}]`,value:c[w],validateSpec:s.validateSpec,valueSpec:d}));return g}return ul({key:i,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,c=s.value,d=Ei(c),g=s.styleSpec;if(d!=="array"||c.length<1||c.length%2!=0)return[new ut(i,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<c.length;x+=2)w=w.concat(Wo({key:`${i}[${x}]`,value:c[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(bc({key:`${i}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return w},sprite:va};function go(s){const i=s.value,c=s.valueSpec,d=s.styleSpec;return s.validateSpec=go,c.expression&&tl(un(i))?gh(s):c.expression&&Zi(Zo(i))?Go(s):c.type&&br[c.type]?br[c.type](s):ur(Hn({},s,{valueSpec:c.type?d[c.type]:c}))}function Sc(s){const i=s.value,c=s.key,d=ls(s);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new ut(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new ut(c,i,'"glyphs" url must include a "{range}" token'))),d}function to(s,i=we){let c=[];return c=c.concat(go({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:go,objectElementValidators:{glyphs:Sc,"*":()=>[]}})),s.constants&&(c=c.concat(mh({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:go}))),Os(c)}function _o(s){return function(i){return s({...i,validateSpec:go})}}function Os(s){return[].concat(s).sort((i,c)=>i.line-c.line)}function io(s){return function(...i){return Os(s.apply(this,i))}}to.source=io(_o(yh)),to.sprite=io(_o(va)),to.glyphs=io(_o(Sc)),to.light=io(_o(vh)),to.sky=io(_o(bh)),to.terrain=io(_o(ya)),to.layer=io(_o(_a)),to.filter=io(_o(Fs)),to.paintProperty=io(_o(xc)),to.layoutProperty=io(_o(kc));const cs=to,Qd=cs.light,Tc=cs.paintProperty,ef=cs.layoutProperty;function Ns(s,i){let c=!1;if(i&&i.length)for(const d of i)s.fire(new rt(new Error(d.message))),c=!0;return c}class ba{constructor(i,c,d){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(c=x[1])+2*(d=x[2]);for(let M=0;M<this.d*this.d;M++){const A=x[3+M],N=x[3+M+1];g.push(A===N?null:x.subarray(A,N))}const T=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=i,this.padding=d,this.scale=c/i,this.uid=0;const w=d/c*i;this.min=-w,this.max=i+w}insert(i,c,d,g,w){this._forEachCell(c,d,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,c,d,g,w,x){this.cells[w].push(x)}query(i,c,d,g,w){const x=this.min,T=this.max;if(i<=x&&c<=x&&T<=d&&T<=g&&!w)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(i,c,d,g,this._queryCell,M,{},w),M}}_queryCell(i,c,d,g,w,x,T,M){const A=this.cells[w];if(A!==null){const N=this.keys,j=this.bboxes;for(let $=0;$<A.length;$++){const K=A[$];if(T[K]===void 0){const Q=4*K;(M?M(j[Q+0],j[Q+1],j[Q+2],j[Q+3]):i<=j[Q+2]&&c<=j[Q+3]&&d>=j[Q+0]&&g>=j[Q+1])?(T[K]=!0,x.push(N[K])):T[K]=!1}}}}_forEachCell(i,c,d,g,w,x,T,M){const A=this._convertToCellCoord(i),N=this._convertToCellCoord(c),j=this._convertToCellCoord(d),$=this._convertToCellCoord(g);for(let K=A;K<=j;K++)for(let Q=N;Q<=$;Q++){const le=this.d*Q+K;if((!M||M(this._convertFromCellCoord(K),this._convertFromCellCoord(Q),this._convertFromCellCoord(K+1),this._convertFromCellCoord(Q+1)))&&w.call(this,i,c,d,g,le,x,T,M))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,c=3+this.cells.length+1+1;let d=0;for(let x=0;x<this.cells.length;x++)d+=this.cells[x].length;const g=new Int32Array(c+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=c;for(let x=0;x<i.length;x++){const T=i[x];g[3+x]=w,g.set(T,w),w+=T.length}return g[3+i.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+i.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(i,c){const d=i.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(i){return new ba(i.buffer)}}const yo={};function Lt(s,i,c={}){if(yo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),yo[s]={klass:i,omit:c.omit||[],shallow:c.shallow||[]}}Lt("Object",Object),Lt("TransferableGridIndex",ba),Lt("Color",zi),Lt("Error",Error),Lt("AJAXError",xi),Lt("ResolvedImage",Hr),Lt("StylePropertyFunction",nl),Lt("StyleExpression",Wi,{omit:["_evaluator"]}),Lt("ZoomDependentExpression",_c),Lt("ZoomConstantExpression",il),Lt("CompoundExpression",Dr,{omit:["_evaluate"]});for(const s in Ds)Ds[s]._classRegistryKey||Lt(`Expression_${s}`,Ds[s]);function dl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function js(s,i){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(dl(s)||st(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return i&&i.push(c.buffer),c}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const d of s)c.push(js(d,i));return c}if(typeof s=="object"){const c=s.constructor,d=c._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!yo[d])throw new Error(`${d} is not registered.`);const g=c.serialize?c.serialize(s,i):{};if(c.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||yo[d].omit.indexOf(w)>=0)continue;const x=s[w];g[w]=yo[d].shallow.indexOf(w)>=0?x:js(x,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof s)}function Us(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||dl(s)||st(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Us);if(typeof s=="object"){const i=s.$name||"Object";if(!yo[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:c}=yo[i];if(!c)throw new Error(`can't deserialize unregistered class ${i}`);if(c.deserialize)return c.deserialize(s);const d=Object.create(c.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const w=s[g];d[g]=yo[i].shallow.indexOf(g)>=0?w:Us(w)}return d}throw new Error("can't deserialize object of type "+typeof s)}class wh{constructor(){this.first=!0}update(i,c){const d=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=d,!0))}}const St={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Vs(s){for(const i of s)if(fl(i.charCodeAt(0)))return!0;return!1}function xh(s){for(const i of s)if(!kh(i.charCodeAt(0)))return!1;return!0}function kh(s){return!(St.Arabic(s)||St["Arabic Supplement"](s)||St["Arabic Extended-A"](s)||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s))}function fl(s){return!(s!==746&&s!==747&&(s<4352||!(St["Bopomofo Extended"](s)||St.Bopomofo(s)||St["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||St["CJK Compatibility Ideographs"](s)||St["CJK Compatibility"](s)||St["CJK Radicals Supplement"](s)||St["CJK Strokes"](s)||!(!St["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||St["CJK Unified Ideographs Extension A"](s)||St["CJK Unified Ideographs"](s)||St["Enclosed CJK Letters and Months"](s)||St["Hangul Compatibility Jamo"](s)||St["Hangul Jamo Extended-A"](s)||St["Hangul Jamo Extended-B"](s)||St["Hangul Jamo"](s)||St["Hangul Syllables"](s)||St.Hiragana(s)||St["Ideographic Description Characters"](s)||St.Kanbun(s)||St["Kangxi Radicals"](s)||St["Katakana Phonetic Extensions"](s)||St.Katakana(s)&&s!==12540||!(!St["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!St["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||St["Unified Canadian Aboriginal Syllabics"](s)||St["Unified Canadian Aboriginal Syllabics Extended"](s)||St["Vertical Forms"](s)||St["Yijing Hexagram Symbols"](s)||St["Yi Syllables"](s)||St["Yi Radicals"](s))))}function Ec(s){return!(fl(s)||function(i){return!!(St["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||St["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||St["Letterlike Symbols"](i)||St["Number Forms"](i)||St["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||St["Control Pictures"](i)&&i!==9251||St["Optical Character Recognition"](i)||St["Enclosed Alphanumerics"](i)||St["Geometric Shapes"](i)||St["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||St["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||St["CJK Symbols and Punctuation"](i)||St.Katakana(i)||St["Private Use Area"](i)||St["CJK Compatibility Forms"](i)||St["Small Form Variants"](i)||St["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}function pl(s){return s>=1424&&s<=2303||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s)}function Sh(s,i){return!(!i&&pl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||St.Khmer(s))}function tf(s){for(const i of s)if(pl(i.charCodeAt(0)))return!0;return!1}const $o=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Yi{constructor(i,c){this.zoom=i,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wh,this.transition={})}isSupportedScript(i){return function(c,d){for(const g of c)if(!Sh(g.charCodeAt(0),d))return!1;return!0}(i,$o.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,c=i-Math.floor(i),d=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class wa{constructor(i,c){this.property=i,this.value=c,this.expression=function(d,g){if(tl(d))return new nl(d,g);if(Zi(d)){const w=uh(d,g);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=d;return g.type==="color"&&typeof d=="string"?w=zi.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(d)&&(w=$r.parse(d)):w=vr.parse(d),{kind:"constant",evaluate:()=>w}}}(c===void 0?i.specification.default:c,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,c,d){return this.property.possiblyEvaluate(this,i,c,d)}}class ml{constructor(i){this.property=i,this.value=new wa(i,void 0)}transitioned(i,c){return new Th(this.property,this.value,c,H({},i.transition,this.transition),i.now)}untransitioned(){return new Th(this.property,this.value,null,{},0)}}class Cc{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return ne(this._values[i].value.value)}setValue(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ml(this._values[i].property)),this._values[i].value=new wa(this._values[i].property,c===null?void 0:ne(c))}getTransition(i){return ne(this._values[i].transition)}setTransition(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ml(this._values[i].property)),this._values[i].transition=ne(c)||void 0}serialize(){const i={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(i[c]=d);const g=this.getTransition(c);g!==void 0&&(i[`${c}-transition`]=g)}return i}transitioned(i,c){const d=new Eh(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(i,c._values[g]);return d}untransitioned(){const i=new Eh(this._properties);for(const c of Object.keys(this._values))i._values[c]=this._values[c].untransitioned();return i}}class Th{constructor(i,c,d,g,w){this.property=i,this.value=c,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(i,c,d){const g=i.now||0,w=this.value.possiblyEvaluate(i,c,d),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(i,c,d);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,c,d),w,function(M){if(M<=0)return 0;if(M>=1)return 1;const A=M*M,N=A*M;return 4*(M<.5?N:3*(M-A)+N-.75)}(T))}}return w}}class Eh{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,c,d){const g=new xa(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(i,c,d);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Ch{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return ne(this._values[i].value)}setValue(i,c){this._values[i]=new wa(this._values[i].property,c===null?void 0:ne(c))}serialize(){const i={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(i[c]=d)}return i}possiblyEvaluate(i,c,d){const g=new xa(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(i,c,d);return g}}class no{constructor(i,c,d){this.property=i,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,c,d,g){return this.property.evaluate(this.value,this.parameters,i,c,d,g)}}class xa{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class jt{constructor(i){this.specification=i}possiblyEvaluate(i,c){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(c)}interpolate(i,c,d){const g=cr[this.specification.type];return g?g(i,c,d):i}}class $t{constructor(i,c){this.specification=i,this.overrides=c}possiblyEvaluate(i,c,d,g){return new no(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(c,null,{},d,g)}:i.expression,c)}interpolate(i,c,d){if(i.value.kind!=="constant"||c.value.kind!=="constant")return i;if(i.value.value===void 0||c.value.value===void 0)return new no(this,{kind:"constant",value:void 0},i.parameters);const g=cr[this.specification.type];if(g){const w=g(i.value.value,c.value.value,d);return new no(this,{kind:"constant",value:w},i.parameters)}return i}evaluate(i,c,d,g,w,x){return i.kind==="constant"?i.value:i.evaluate(c,d,g,w,x)}}class gl extends $t{possiblyEvaluate(i,c,d,g){if(i.value===void 0)return new no(this,{kind:"constant",value:void 0},c);if(i.expression.kind==="constant"){const w=i.expression.evaluate(c,null,{},d,g),x=i.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,T=this._calculate(x,x,x,c);return new no(this,{kind:"constant",value:T},c)}if(i.expression.kind==="camera"){const w=this._calculate(i.expression.evaluate({zoom:c.zoom-1}),i.expression.evaluate({zoom:c.zoom}),i.expression.evaluate({zoom:c.zoom+1}),c);return new no(this,{kind:"constant",value:w},c)}return new no(this,i.expression,c)}evaluate(i,c,d,g,w,x){if(i.kind==="source"){const T=i.evaluate(c,d,g,w,x);return this._calculate(T,T,T,c)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(c.zoom)-1},d,g),i.evaluate({zoom:Math.floor(c.zoom)},d,g),i.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):i.value}_calculate(i,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:d,to:c}}interpolate(i){return i}}class ka{constructor(i){this.specification=i}possiblyEvaluate(i,c,d,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const w=i.expression.evaluate(c,null,{},d,g);return this._calculate(w,w,w,c)}return this._calculate(i.expression.evaluate(new Yi(Math.floor(c.zoom-1),c)),i.expression.evaluate(new Yi(Math.floor(c.zoom),c)),i.expression.evaluate(new Yi(Math.floor(c.zoom+1),c)),c)}}_calculate(i,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:d,to:c}}interpolate(i){return i}}class Mc{constructor(i){this.specification=i}possiblyEvaluate(i,c,d,g){return!!i.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class wr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in i){const d=i[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new wa(d,void 0),w=this.defaultTransitionablePropertyValues[c]=new ml(d);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}Lt("DataDrivenProperty",$t),Lt("DataConstantProperty",jt),Lt("CrossFadedDataDrivenProperty",gl),Lt("CrossFadedProperty",ka),Lt("ColorRampProperty",Mc);const Ic="-transition";class ro extends xt{constructor(i,c){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),c.layout&&(this._unevaluatedLayout=new Ch(c.layout)),c.paint)){this._transitionablePaint=new Cc(c.paint);for(const d in i.paint)this.setPaintProperty(d,i.paint[d],{validate:!1});for(const d in i.layout)this.setLayoutProperty(d,i.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xa(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,c,d={}){c!=null&&this._validate(ef,`layers.${this.id}.layout.${i}`,i,c,d)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,c):this.visibility=c)}getPaintProperty(i){return i.endsWith(Ic)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,c,d={}){if(c!=null&&this._validate(Tc,`layers.${this.id}.paint.${i}`,i,c,d))return!1;if(i.endsWith(Ic))return this._transitionablePaint.setTransition(i.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[i],w=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(i,c),this._handleSpecialPaintPropertyUpdate(i);const M=this._transitionablePaint._values[i].value;return M.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(i,T,M)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,c,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,c){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,c)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Oe(i,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(i,c,d,g,w={}){return(!w||w.validate!==!1)&&Ns(this,i.call(cs,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const c=this.paint.get(i);if(c instanceof no&&Bs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Mh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sa{constructor(i,c){this._structArray=i,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,c){return i._trim(),c&&(i.isTransferred=!0,c.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const c=Object.create(this.prototype);return c.arrayBuffer=i.arrayBuffer,c.length=i.length,c.capacity=i.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function kn(s,i=1){let c=0,d=0;return{members:s.map(g=>{const w=Mh[g.type].BYTES_PER_ELEMENT,x=c=Ih(c,Math.max(i,w)),T=g.components||1;return d=Math.max(d,w),c+=w*T,{name:g.name,type:g.type,components:T,offset:x}}),size:Ih(c,Math.max(d,i)),alignment:i}}function Ih(s,i){return Math.ceil(s/i)*i}class Ta extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.int16[g+0]=c,this.int16[g+1]=d,i}}Ta.prototype.bytesPerElement=4,Lt("StructArrayLayout2i4",Ta);class Ao extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const w=3*i;return this.int16[w+0]=c,this.int16[w+1]=d,this.int16[w+2]=g,i}}Ao.prototype.bytesPerElement=6,Lt("StructArrayLayout3i6",Ao);class Lc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,c,d,g)}emplace(i,c,d,g,w){const x=4*i;return this.int16[x+0]=c,this.int16[x+1]=d,this.int16[x+2]=g,this.int16[x+3]=w,i}}Lc.prototype.bytesPerElement=8,Lt("StructArrayLayout4i8",Lc);class Ac extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,d,g,w,x)}emplace(i,c,d,g,w,x,T){const M=6*i;return this.int16[M+0]=c,this.int16[M+1]=d,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=T,i}}Ac.prototype.bytesPerElement=12,Lt("StructArrayLayout2i4i12",Ac);class Pc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,d,g,w,x)}emplace(i,c,d,g,w,x,T){const M=4*i,A=8*i;return this.int16[M+0]=c,this.int16[M+1]=d,this.uint8[A+4]=g,this.uint8[A+5]=w,this.uint8[A+6]=x,this.uint8[A+7]=T,i}}Pc.prototype.bytesPerElement=8,Lt("StructArrayLayout2i4ub8",Pc);class Ea extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.float32[g+0]=c,this.float32[g+1]=d,i}}Ea.prototype.bytesPerElement=8,Lt("StructArrayLayout2f8",Ea);class _l extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x,T,M,A,N){const j=this.length;return this.resize(j+1),this.emplace(j,i,c,d,g,w,x,T,M,A,N)}emplace(i,c,d,g,w,x,T,M,A,N,j){const $=10*i;return this.uint16[$+0]=c,this.uint16[$+1]=d,this.uint16[$+2]=g,this.uint16[$+3]=w,this.uint16[$+4]=x,this.uint16[$+5]=T,this.uint16[$+6]=M,this.uint16[$+7]=A,this.uint16[$+8]=N,this.uint16[$+9]=j,i}}_l.prototype.bytesPerElement=20,Lt("StructArrayLayout10ui20",_l);class zc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x,T,M,A,N,j,$){const K=this.length;return this.resize(K+1),this.emplace(K,i,c,d,g,w,x,T,M,A,N,j,$)}emplace(i,c,d,g,w,x,T,M,A,N,j,$,K){const Q=12*i;return this.int16[Q+0]=c,this.int16[Q+1]=d,this.int16[Q+2]=g,this.int16[Q+3]=w,this.uint16[Q+4]=x,this.uint16[Q+5]=T,this.uint16[Q+6]=M,this.uint16[Q+7]=A,this.int16[Q+8]=N,this.int16[Q+9]=j,this.int16[Q+10]=$,this.int16[Q+11]=K,i}}zc.prototype.bytesPerElement=24,Lt("StructArrayLayout4i4ui4i24",zc);class Dc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const w=3*i;return this.float32[w+0]=c,this.float32[w+1]=d,this.float32[w+2]=g,i}}Dc.prototype.bytesPerElement=12,Lt("StructArrayLayout3f12",Dc);class Po extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint32[1*i+0]=c,i}}Po.prototype.bytesPerElement=4,Lt("StructArrayLayout1ul4",Po);class yl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x,T,M,A){const N=this.length;return this.resize(N+1),this.emplace(N,i,c,d,g,w,x,T,M,A)}emplace(i,c,d,g,w,x,T,M,A,N){const j=10*i,$=5*i;return this.int16[j+0]=c,this.int16[j+1]=d,this.int16[j+2]=g,this.int16[j+3]=w,this.int16[j+4]=x,this.int16[j+5]=T,this.uint32[$+3]=M,this.uint16[j+8]=A,this.uint16[j+9]=N,i}}yl.prototype.bytesPerElement=20,Lt("StructArrayLayout6i1ul2ui20",yl);class Ca extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,d,g,w,x)}emplace(i,c,d,g,w,x,T){const M=6*i;return this.int16[M+0]=c,this.int16[M+1]=d,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=T,i}}Ca.prototype.bytesPerElement=12,Lt("StructArrayLayout2i2i2i12",Ca);class vl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,i,c,d,g,w)}emplace(i,c,d,g,w,x){const T=4*i,M=8*i;return this.float32[T+0]=c,this.float32[T+1]=d,this.float32[T+2]=g,this.int16[M+6]=w,this.int16[M+7]=x,i}}vl.prototype.bytesPerElement=16,Lt("StructArrayLayout2f1f2i16",vl);class Ma extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,c,d,g)}emplace(i,c,d,g,w){const x=12*i,T=3*i;return this.uint8[x+0]=c,this.uint8[x+1]=d,this.float32[T+1]=g,this.float32[T+2]=w,i}}Ma.prototype.bytesPerElement=12,Lt("StructArrayLayout2ub2f12",Ma);class bl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const w=3*i;return this.uint16[w+0]=c,this.uint16[w+1]=d,this.uint16[w+2]=g,i}}bl.prototype.bytesPerElement=6,Lt("StructArrayLayout3ui6",bl);class qs extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x,T,M,A,N,j,$,K,Q,le,ge,xe){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,i,c,d,g,w,x,T,M,A,N,j,$,K,Q,le,ge,xe)}emplace(i,c,d,g,w,x,T,M,A,N,j,$,K,Q,le,ge,xe,Fe){const Se=24*i,ze=12*i,Ye=48*i;return this.int16[Se+0]=c,this.int16[Se+1]=d,this.uint16[Se+2]=g,this.uint16[Se+3]=w,this.uint32[ze+2]=x,this.uint32[ze+3]=T,this.uint32[ze+4]=M,this.uint16[Se+10]=A,this.uint16[Se+11]=N,this.uint16[Se+12]=j,this.float32[ze+7]=$,this.float32[ze+8]=K,this.uint8[Ye+36]=Q,this.uint8[Ye+37]=le,this.uint8[Ye+38]=ge,this.uint32[ze+10]=xe,this.int16[Se+22]=Fe,i}}qs.prototype.bytesPerElement=48,Lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",qs);class us extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,w,x,T,M,A,N,j,$,K,Q,le,ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt,Tt,wt,mt,Dt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,i,c,d,g,w,x,T,M,A,N,j,$,K,Q,le,ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt,Tt,wt,mt,Dt)}emplace(i,c,d,g,w,x,T,M,A,N,j,$,K,Q,le,ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt,Tt,wt,mt,Dt,vt){const at=32*i,Wt=16*i;return this.int16[at+0]=c,this.int16[at+1]=d,this.int16[at+2]=g,this.int16[at+3]=w,this.int16[at+4]=x,this.int16[at+5]=T,this.int16[at+6]=M,this.int16[at+7]=A,this.uint16[at+8]=N,this.uint16[at+9]=j,this.uint16[at+10]=$,this.uint16[at+11]=K,this.uint16[at+12]=Q,this.uint16[at+13]=le,this.uint16[at+14]=ge,this.uint16[at+15]=xe,this.uint16[at+16]=Fe,this.uint16[at+17]=Se,this.uint16[at+18]=ze,this.uint16[at+19]=Ye,this.uint16[at+20]=tt,this.uint16[at+21]=Ct,this.uint16[at+22]=Bt,this.uint32[Wt+12]=Tt,this.float32[Wt+13]=wt,this.float32[Wt+14]=mt,this.uint16[at+30]=Dt,this.uint16[at+31]=vt,i}}us.prototype.bytesPerElement=64,Lt("StructArrayLayout8i15ui1ul2f2ui64",us);class wl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.float32[1*i+0]=c,i}}wl.prototype.bytesPerElement=4,Lt("StructArrayLayout1f4",wl);class xl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const w=3*i;return this.uint16[6*i+0]=c,this.float32[w+1]=d,this.float32[w+2]=g,i}}xl.prototype.bytesPerElement=12,Lt("StructArrayLayout1ui2f12",xl);class hs extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const w=4*i;return this.uint32[2*i+0]=c,this.uint16[w+2]=d,this.uint16[w+3]=g,i}}hs.prototype.bytesPerElement=8,Lt("StructArrayLayout1ul2ui8",hs);class Rc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.uint16[g+0]=c,this.uint16[g+1]=d,i}}Rc.prototype.bytesPerElement=4,Lt("StructArrayLayout2ui4",Rc);class Bc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint16[1*i+0]=c,i}}Bc.prototype.bytesPerElement=2,Lt("StructArrayLayout1ui2",Bc);class kl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,c,d,g)}emplace(i,c,d,g,w){const x=4*i;return this.float32[x+0]=c,this.float32[x+1]=d,this.float32[x+2]=g,this.float32[x+3]=w,i}}kl.prototype.bytesPerElement=16,Lt("StructArrayLayout4f16",kl);class Lh extends Sa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}Lh.prototype.size=20;class y extends yl{get(i){return new Lh(this,i)}}Lt("CollisionBoxArray",y);class r extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}r.prototype.size=48;class h extends qs{get(i){return new r(this,i)}}Lt("PlacedSymbolArray",h);class p extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends us{get(i){return new p(this,i)}}Lt("SymbolInstanceArray",m);class v extends wl{getoffsetX(i){return this.float32[1*i+0]}}Lt("GlyphOffsetArray",v);class E extends Ao{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Lt("SymbolLineVertexArray",E);class C extends Sa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}C.prototype.size=12;class L extends xl{get(i){return new C(this,i)}}Lt("TextAnchorOffsetArray",L);class F extends Sa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class V extends hs{get(i){return new F(this,i)}}Lt("FeatureIndexArray",V);class Z extends Ta{}class J extends Ta{}class pe extends Ta{}class fe extends Ac{}class _e extends Pc{}class ae extends Ea{}class Ee extends _l{}class Ze extends zc{}class be extends Dc{}class De extends Po{}class We extends Ca{}class He extends Ma{}class Xe extends bl{}class nt extends Rc{}const it=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ft}=it;class _t{constructor(i=[]){this.segments=i}prepareSegment(i,c,d,g){let w=this.segments[this.segments.length-1];return i>_t.MAX_VERTEX_ARRAY_LENGTH&&Ke(`Max vertices per segment is ${_t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!w||w.vertexLength+i>_t.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const i of this.segments)for(const c in i.vaos)i.vaos[c].destroy()}static simpleSegment(i,c,d,g){return new _t([{vertexOffset:i,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function oi(s,i){return 256*(s=se(Math.floor(s),0,255))+se(Math.floor(i),0,255)}_t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt("SegmentVector",_t);const yt=kn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Kt={exports:{}},si={exports:{}};si.exports=function(s,i){var c,d,g,w,x,T,M,A;for(d=s.length-(c=3&s.length),g=i,x=3432918353,T=461845907,A=0;A<d;)M=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24,++A,g=27492+(65535&(w=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(M=0,c){case 3:M^=(255&s.charCodeAt(A+2))<<16;case 2:M^=(255&s.charCodeAt(A+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&s.charCodeAt(A)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Si=si.exports,Qt={exports:{}};Qt.exports=function(s,i){for(var c,d=s.length,g=i^d,w=0;d>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++w;switch(d){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var ci=Si,pi=Qt.exports;Kt.exports=ci,Kt.exports.murmur3=ci,Kt.exports.murmur2=pi;var dn=_(Kt.exports);class Ri{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,c,d,g){this.ids.push(Rr(i)),this.positions.push(c,d,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Rr(i);let d=0,g=this.ids.length-1;for(;d<g;){const x=d+g>>1;this.ids[x]>=c?g=x:d=x+1}const w=[];for(;this.ids[d]===c;)w.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return w}static serialize(i,c){const d=new Float64Array(i.ids),g=new Uint32Array(i.positions);return On(d,g,0,d.length-1),c&&c.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(i){const c=new Ri;return c.ids=i.ids,c.positions=i.positions,c.indexed=!0,c}}function Rr(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:dn(String(s))}function On(s,i,c,d){for(;c<d;){const g=s[c+d>>1];let w=c-1,x=d+1;for(;;){do w++;while(s[w]<g);do x--;while(s[x]>g);if(w>=x)break;nn(s,w,x),nn(i,3*w,3*x),nn(i,3*w+1,3*x+1),nn(i,3*w+2,3*x+2)}x-c<d-x?(On(s,i,c,x),c=x+1):(On(s,i,x+1,d),d=x)}}function nn(s,i,c){const d=s[i];s[i]=s[c],s[c]=d}Lt("FeaturePositionMap",Ri);class Nn{constructor(i,c){this.gl=i.gl,this.location=c}}class Br extends Nn{constructor(i,c){super(i,c),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class vo extends Nn{constructor(i,c){super(i,c),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Ho extends Nn{constructor(i,c){super(i,c),this.current=zi.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Ia=new Float32Array(16);function Xo(s){return[oi(255*s.r,255*s.g),oi(255*s.b,255*s.a)]}class bo{constructor(i,c,d){this.value=i,this.uniformNames=c.map(g=>`u_${g}`),this.type=d}setUniform(i,c,d){i.set(d.constantOr(this.value))}getBinding(i,c,d){return this.type==="color"?new Ho(i,c):new Br(i,c)}}class Ln{constructor(i,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=i.tlbr}setUniform(i,c,d,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&i.set(w)}getBinding(i,c,d){return d.substr(0,9)==="u_pattern"?new vo(i,c):new Br(i,c)}}class rn{constructor(i,c,d,g){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(w=>({name:`a_${w}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,c,d,g,w){const x=this.paintVertexArray.length,T=this.expression.evaluate(new Yi(0),c,{},g,[],w);this.paintVertexArray.resize(i),this._setPaintValue(x,i,T)}updatePaintArray(i,c,d,g){const w=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(i,c,w)}_setPaintValue(i,c,d){if(this.type==="color"){const g=Xo(d);for(let w=i;w<c;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=i;g<c;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qi{constructor(i,c,d,g,w,x){this.expression=i,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,c,d,g,w){const x=this.expression.evaluate(new Yi(this.zoom),c,{},g,[],w),T=this.expression.evaluate(new Yi(this.zoom+1),c,{},g,[],w),M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,x,T)}updatePaintArray(i,c,d,g){const w=this.expression.evaluate({zoom:this.zoom},d,g),x=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(i,c,w,x)}_setPaintValue(i,c,d,g){if(this.type==="color"){const w=Xo(d),x=Xo(g);for(let T=i;T<c;T++)this.paintVertexArray.emplace(T,w[0],w[1],x[0],x[1])}else{for(let w=i;w<c;w++)this.paintVertexArray.emplace(w,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=se(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,c,d){return new Br(i,c)}}class Xr{constructor(i,c,d,g,w,x){this.expression=i,this.type=c,this.useIntegerZoom=d,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(i,c,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(i,c,d,g,w){this._setPaintValues(i,c,d.patterns&&d.patterns[this.layerId],w)}_setPaintValues(i,c,d,g){if(!g||!d)return;const{min:w,mid:x,max:T}=d,M=g[w],A=g[x],N=g[T];if(M&&A&&N)for(let j=i;j<c;j++)this.zoomInPaintVertexArray.emplace(j,A.tl[0],A.tl[1],A.br[0],A.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],A.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,A.tl[0],A.tl[1],A.br[0],A.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],A.pixelRatio,N.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class An{constructor(i,c,d){this.binders={},this._buffers=[];const g=[];for(const w in i.paint._values){if(!d(w))continue;const x=i.paint.get(w);if(!(x instanceof no&&Bs(x.property.specification)))continue;const T=Kr(w,i.type),M=x.value,A=x.property.specification.type,N=x.property.useIntegerZoom,j=x.property.specification["property-type"],$=j==="cross-faded"||j==="cross-faded-data-driven";if(M.kind==="constant")this.binders[w]=$?new Ln(M.value,T):new bo(M.value,T,A),g.push(`/u_${w}`);else if(M.kind==="source"||$){const K=Pn(w,A,"source");this.binders[w]=$?new Xr(M,A,N,c,K,i.id):new rn(M,T,A,K),g.push(`/a_${w}`)}else{const K=Pn(w,A,"composite");this.binders[w]=new Qi(M,T,A,N,c,K),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const c=this.binders[i];return c instanceof rn||c instanceof Qi?c.maxValue:0}populatePaintArrays(i,c,d,g,w){for(const x in this.binders){const T=this.binders[x];(T instanceof rn||T instanceof Qi||T instanceof Xr)&&T.populatePaintArray(i,c,d,g,w)}}setConstantPatternPositions(i,c){for(const d in this.binders){const g=this.binders[d];g instanceof Ln&&g.setConstantPatternPositions(i,c)}}updatePaintArrays(i,c,d,g,w){let x=!1;for(const T in i){const M=c.getPositions(T);for(const A of M){const N=d.feature(A.index);for(const j in this.binders){const $=this.binders[j];if(($ instanceof rn||$ instanceof Qi||$ instanceof Xr)&&$.expression.isStateDependent===!0){const K=g.paint.get(j);$.expression=K.value,$.updatePaintArray(A.start,A.end,N,i[T],w),x=!0}}}}return x}defines(){const i=[];for(const c in this.binders){const d=this.binders[c];(d instanceof bo||d instanceof Ln)&&i.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof rn||d instanceof Qi)for(let g=0;g<d.paintVertexAttributes.length;g++)i.push(d.paintVertexAttributes[g].name);else if(d instanceof Xr)for(let g=0;g<yt.members.length;g++)i.push(yt.members[g].name)}return i}getBinderUniforms(){const i=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof bo||d instanceof Ln||d instanceof Qi)for(const g of d.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,c){const d=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof bo||w instanceof Ln||w instanceof Qi){for(const x of w.uniformNames)if(c[x]){const T=w.getBinding(i,c[x],x);d.push({name:x,property:g,binding:T})}}}return d}setUniforms(i,c,d,g){for(const{name:w,property:x,binding:T}of c)this.binders[x].setUniform(T,g,d.get(x),w)}updatePaintBuffers(i){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(i&&d instanceof Xr){const g=i.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof rn||d instanceof Qi)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(i){for(const c in this.binders){const d=this.binders[c];(d instanceof rn||d instanceof Qi||d instanceof Xr)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const c=this.binders[i];(c instanceof rn||c instanceof Qi||c instanceof Xr)&&c.destroy()}}}class on{constructor(i,c,d=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new An(g,c,d);this.needsUpload=!1,this._featureMap=new Ri,this._bufferOffset=0}populatePaintArrays(i,c,d,g,w,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,c,g,w,x);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,c,d,g){for(const w of d)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(i,this._featureMap,c,w,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Kr(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Pn(s,i,c){const d={color:{source:Ea,composite:kl},number:{source:wl,composite:Ea}},g=function(w){return{"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee}}[w]}(s);return g&&g[c]||d[i][c]}Lt("ConstantBinder",bo),Lt("CrossFadedConstantBinder",Ln),Lt("SourceExpressionBinder",rn),Lt("CrossFadedCompositeBinder",Xr),Lt("CompositeExpressionBinder",Qi),Lt("ProgramConfiguration",An,{omit:["_buffers"]}),Lt("ProgramConfigurationSet",on);const _n=8192,Fc=Math.pow(2,14)-1,Ah=-Fc-1;function ds(s){const i=_n/s.extent,c=s.loadGeometry();for(let d=0;d<c.length;d++){const g=c[d];for(let w=0;w<g.length;w++){const x=g[w],T=Math.round(x.x*i),M=Math.round(x.y*i);x.x=se(T,Ah,Fc),x.y=se(M,Ah,Fc),(T<x.x||T>x.x+1||M<x.y||M>x.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function fs(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?ds(s):[]}}function Sl(s,i,c,d,g){s.emplaceBack(2*i+(d+1)/2,2*c+(g+1)/2)}class Ko{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new J,this.indexArray=new Xe,this.segments=new _t,this.programConfigurations=new on(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){const g=this.layers[0],w=[];let x=null,T=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:M,id:A,index:N,sourceLayerIndex:j}of i){const $=this.layers[0]._featureFilter.needGeometry,K=fs(M,$);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),K,d))continue;const Q=T?x.evaluate(K,{},d):void 0,le={id:A,properties:M.properties,type:M.type,sourceLayerIndex:j,index:N,geometry:$?K.geometry:ds(M),patterns:{},sortKey:Q};w.push(le)}T&&w.sort((M,A)=>M.sortKey-A.sortKey);for(const M of w){const{geometry:A,index:N,sourceLayerIndex:j}=M,$=i[N].feature;this.addFeature(M,A,N,d),c.featureIndex.insert($,A,N,j,this.index)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ft),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,c,d,g){for(const w of c)for(const x of w){const T=x.x,M=x.y;if(T<0||T>=_n||M<0||M>=_n)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),N=A.vertexLength;Sl(this.layoutVertexArray,T,M,-1,-1),Sl(this.layoutVertexArray,T,M,1,-1),Sl(this.layoutVertexArray,T,M,1,1),Sl(this.layoutVertexArray,T,M,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},g)}}function Oc(s,i){for(let c=0;c<s.length;c++)if(El(i,s[c]))return!0;for(let c=0;c<i.length;c++)if(El(s,i[c]))return!0;return!!Tl(s,i)}function Ph(s,i,c){return!!El(s,i)||!!nf(i,s,c)}function Nc(s,i){if(s.length===1)return $p(i,s[0]);for(let c=0;c<i.length;c++){const d=i[c];for(let g=0;g<d.length;g++)if(El(s,d[g]))return!0}for(let c=0;c<s.length;c++)if($p(i,s[c]))return!0;for(let c=0;c<i.length;c++)if(Tl(s,i[c]))return!0;return!1}function jc(s,i,c){if(s.length>1){if(Tl(s,i))return!0;for(let d=0;d<i.length;d++)if(nf(i[d],s,c))return!0}for(let d=0;d<s.length;d++)if(nf(s[d],i,c))return!0;return!1}function Tl(s,i){if(s.length===0||i.length===0)return!1;for(let c=0;c<s.length-1;c++){const d=s[c],g=s[c+1];for(let w=0;w<i.length-1;w++)if(Uc(d,g,i[w],i[w+1]))return!0}return!1}function Uc(s,i,c,d){return Ce(s,c,d)!==Ce(i,c,d)&&Ce(s,i,c)!==Ce(s,i,d)}function nf(s,i,c){const d=c*c;if(i.length===1)return s.distSqr(i[0])<d;for(let g=1;g<i.length;g++)if(Wp(s,i[g-1],i[g])<d)return!0;return!1}function Wp(s,i,c){const d=i.distSqr(c);if(d===0)return s.distSqr(i);const g=((s.x-i.x)*(c.x-i.x)+(s.y-i.y)*(c.y-i.y))/d;return s.distSqr(g<0?i:g>1?c:c.sub(i)._mult(g)._add(i))}function $p(s,i){let c,d,g,w=!1;for(let x=0;x<s.length;x++){c=s[x];for(let T=0,M=c.length-1;T<c.length;M=T++)d=c[T],g=c[M],d.y>i.y!=g.y>i.y&&i.x<(g.x-d.x)*(i.y-d.y)/(g.y-d.y)+d.x&&(w=!w)}return w}function El(s,i){let c=!1;for(let d=0,g=s.length-1;d<s.length;g=d++){const w=s[d],x=s[g];w.y>i.y!=x.y>i.y&&i.x<(x.x-w.x)*(i.y-w.y)/(x.y-w.y)+w.x&&(c=!c)}return c}function n1(s,i,c){const d=c[0],g=c[2];if(s.x<d.x&&i.x<d.x||s.x>g.x&&i.x>g.x||s.y<d.y&&i.y<d.y||s.y>g.y&&i.y>g.y)return!1;const w=Ce(s,i,c[0]);return w!==Ce(s,i,c[1])||w!==Ce(s,i,c[2])||w!==Ce(s,i,c[3])}function Vc(s,i,c){const d=i.paint.get(s).value;return d.kind==="constant"?d.value:c.programConfigurations.get(i.id).getMaxValue(s)}function zh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Dh(s,i,c,d,g){if(!i[0]&&!i[1])return s;const w=S.convert(i)._mult(g);c==="viewport"&&w._rotate(-d);const x=[];for(let T=0;T<s.length;T++)x.push(s[T].sub(w));return x}let Hp,Xp;Lt("CircleBucket",Ko,{omit:["layers"]});var r1={get paint(){return Xp=Xp||new wr({"circle-radius":new $t(we.paint_circle["circle-radius"]),"circle-color":new $t(we.paint_circle["circle-color"]),"circle-blur":new $t(we.paint_circle["circle-blur"]),"circle-opacity":new $t(we.paint_circle["circle-opacity"]),"circle-translate":new jt(we.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(we.paint_circle["circle-stroke-opacity"])})},get layout(){return Hp=Hp||new wr({"circle-sort-key":new $t(we.layout_circle["circle-sort-key"])})}},xr=1e-6,Cl=typeof Float32Array<"u"?Float32Array:Array;function rf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Kp(s,i,c){var d=i[0],g=i[1],w=i[2],x=i[3],T=i[4],M=i[5],A=i[6],N=i[7],j=i[8],$=i[9],K=i[10],Q=i[11],le=i[12],ge=i[13],xe=i[14],Fe=i[15],Se=c[0],ze=c[1],Ye=c[2],tt=c[3];return s[0]=Se*d+ze*T+Ye*j+tt*le,s[1]=Se*g+ze*M+Ye*$+tt*ge,s[2]=Se*w+ze*A+Ye*K+tt*xe,s[3]=Se*x+ze*N+Ye*Q+tt*Fe,s[4]=(Se=c[4])*d+(ze=c[5])*T+(Ye=c[6])*j+(tt=c[7])*le,s[5]=Se*g+ze*M+Ye*$+tt*ge,s[6]=Se*w+ze*A+Ye*K+tt*xe,s[7]=Se*x+ze*N+Ye*Q+tt*Fe,s[8]=(Se=c[8])*d+(ze=c[9])*T+(Ye=c[10])*j+(tt=c[11])*le,s[9]=Se*g+ze*M+Ye*$+tt*ge,s[10]=Se*w+ze*A+Ye*K+tt*xe,s[11]=Se*x+ze*N+Ye*Q+tt*Fe,s[12]=(Se=c[12])*d+(ze=c[13])*T+(Ye=c[14])*j+(tt=c[15])*le,s[13]=Se*g+ze*M+Ye*$+tt*ge,s[14]=Se*w+ze*A+Ye*K+tt*xe,s[15]=Se*x+ze*N+Ye*Q+tt*Fe,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var qc,o1=Kp;function Rh(s,i,c){var d=i[0],g=i[1],w=i[2],x=i[3];return s[0]=c[0]*d+c[4]*g+c[8]*w+c[12]*x,s[1]=c[1]*d+c[5]*g+c[9]*w+c[13]*x,s[2]=c[2]*d+c[6]*g+c[10]*w+c[14]*x,s[3]=c[3]*d+c[7]*g+c[11]*w+c[15]*x,s}qc=new Cl(4),Cl!=Float32Array&&(qc[0]=0,qc[1]=0,qc[2]=0,qc[3]=0);class s1 extends ro{constructor(i){super(i,r1)}createBucket(i){return new Ko(i)}queryRadius(i){const c=i;return Vc("circle-radius",this,c)+Vc("circle-stroke-width",this,c)+zh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,c,d,g,w,x,T,M){const A=Dh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,T),N=this.paint.get("circle-radius").evaluate(c,d)+this.paint.get("circle-stroke-width").evaluate(c,d),j=this.paint.get("circle-pitch-alignment")==="map",$=j?A:function(Q,le){return Q.map(ge=>Jp(ge,le))}(A,M),K=j?N*T:N;for(const Q of g)for(const le of Q){const ge=j?le:Jp(le,M);let xe=K;const Fe=Rh([],[le.x,le.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Fe[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=x.cameraToCenterDistance/Fe[3]),Ph($,ge,xe))return!0}return!1}}function Jp(s,i){const c=Rh([],[s.x,s.y,0,1],i);return new S(c[0]/c[3],c[1]/c[3])}class Yp extends Ko{}let Qp;Lt("HeatmapBucket",Yp,{omit:["layers"]});var a1={get paint(){return Qp=Qp||new wr({"heatmap-radius":new $t(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mc(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(we.paint_heatmap["heatmap-opacity"])})}};function of(s,{width:i,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*c*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*c*d}`)}else g=new Uint8Array(i*c*d);return s.width=i,s.height=c,s.data=g,s}function em(s,{width:i,height:c},d){if(i===s.width&&c===s.height)return;const g=of({},{width:i,height:c},d);sf(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,c)},d),s.width=i,s.height=c,s.data=g.data}function sf(s,i,c,d,g,w){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||c.x>s.width-g.width||c.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||d.x>i.width-g.width||d.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,T=i.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<g.height;M++){const A=((c.y+M)*s.width+c.x)*w,N=((d.y+M)*i.width+d.x)*w;for(let j=0;j<g.width*w;j++)T[N+j]=x[A+j]}return i}class Zc{constructor(i,c){of(this,i,1,c)}resize(i){em(this,i,1)}clone(){return new Zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,d,g,w){sf(i,c,d,g,w,1)}}class oo{constructor(i,c){of(this,i,4,c)}resize(i){em(this,i,4)}replace(i,c){c?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new oo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,d,g,w){sf(i,c,d,g,w,4)}}function tm(s){const i={},c=s.resolution||256,d=s.clips?s.clips.length:1,g=s.image||new oo({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(x,T,M)=>{i[s.evaluationKey]=M;const A=s.expression.evaluate(i);g.data[x+T+0]=Math.floor(255*A.r/A.a),g.data[x+T+1]=Math.floor(255*A.g/A.a),g.data[x+T+2]=Math.floor(255*A.b/A.a),g.data[x+T+3]=Math.floor(255*A.a)};if(s.clips)for(let x=0,T=0;x<d;++x,T+=4*c)for(let M=0,A=0;M<c;M++,A+=4){const N=M/(c-1),{start:j,end:$}=s.clips[x];w(T,A,j*(1-N)+$*N)}else for(let x=0,T=0;x<c;x++,T+=4)w(0,T,x/(c-1));return g}Lt("AlphaImage",Zc),Lt("RGBAImage",oo);class l1 extends ro{createBucket(i){return new Yp(i)}constructor(i){super(i,a1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let im;var c1={get paint(){return im=im||new wr({"hillshade-illumination-direction":new jt(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(we.paint_hillshade["hillshade-accent-color"])})}};class u1 extends ro{constructor(i){super(i,c1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const h1=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:d1}=h1;var af={exports:{}};function Bh(s,i,c){c=c||2;var d,g,w,x,T,M,A,N=i&&i.length,j=N?i[0]*c:s.length,$=nm(s,0,j,c,!0),K=[];if(!$||$.next===$.prev)return K;if(N&&($=function(le,ge,xe,Fe){var Se,ze,Ye,tt=[];for(Se=0,ze=ge.length;Se<ze;Se++)(Ye=nm(le,ge[Se]*Fe,Se<ze-1?ge[Se+1]*Fe:le.length,Fe,!1))===Ye.next&&(Ye.steiner=!0),tt.push(b1(Ye));for(tt.sort(_1),Se=0;Se<tt.length;Se++)xe=y1(tt[Se],xe);return xe}(s,i,$,c)),s.length>80*c){d=w=s[0],g=x=s[1];for(var Q=c;Q<j;Q+=c)(T=s[Q])<d&&(d=T),(M=s[Q+1])<g&&(g=M),T>w&&(w=T),M>x&&(x=M);A=(A=Math.max(w-d,x-g))!==0?32767/A:0}return Gc($,K,c,d,g,A,0),K}function nm(s,i,c,d,g){var w,x;if(g===uf(s,i,c,d)>0)for(w=i;w<c;w+=d)x=sm(w,s[w],s[w+1],x);else for(w=c-d;w>=i;w-=d)x=sm(w,s[w],s[w+1],x);return x&&Fh(x,x.next)&&($c(x),x=x.next),x}function La(s,i){if(!s)return s;i||(i=s);var c,d=s;do if(c=!1,d.steiner||!Fh(d,d.next)&&Sn(d.prev,d,d.next)!==0)d=d.next;else{if($c(d),(d=i=d.prev)===d.next)break;c=!0}while(c||d!==i);return i}function Gc(s,i,c,d,g,w,x){if(s){!x&&w&&function(N,j,$,K){var Q=N;do Q.z===0&&(Q.z=lf(Q.x,Q.y,j,$,K)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==N);Q.prevZ.nextZ=null,Q.prevZ=null,function(le){var ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt=1;do{for(xe=le,le=null,ze=null,Ye=0;xe;){for(Ye++,Fe=xe,tt=0,ge=0;ge<Bt&&(tt++,Fe=Fe.nextZ);ge++);for(Ct=Bt;tt>0||Ct>0&&Fe;)tt!==0&&(Ct===0||!Fe||xe.z<=Fe.z)?(Se=xe,xe=xe.nextZ,tt--):(Se=Fe,Fe=Fe.nextZ,Ct--),ze?ze.nextZ=Se:le=Se,Se.prevZ=ze,ze=Se;xe=Fe}ze.nextZ=null,Bt*=2}while(Ye>1)}(Q)}(s,d,g,w);for(var T,M,A=s;s.prev!==s.next;)if(T=s.prev,M=s.next,w?p1(s,d,g,w):f1(s))i.push(T.i/c|0),i.push(s.i/c|0),i.push(M.i/c|0),$c(s),s=M.next,A=M.next;else if((s=M)===A){x?x===1?Gc(s=m1(La(s),i,c),i,c,d,g,w,2):x===2&&g1(s,i,c,d,g,w):Gc(La(s),i,c,d,g,w,1);break}}}function f1(s){var i=s.prev,c=s,d=s.next;if(Sn(i,c,d)>=0)return!1;for(var g=i.x,w=c.x,x=d.x,T=i.y,M=c.y,A=d.y,N=g<w?g<x?g:x:w<x?w:x,j=T<M?T<A?T:A:M<A?M:A,$=g>w?g>x?g:x:w>x?w:x,K=T>M?T>A?T:A:M>A?M:A,Q=d.next;Q!==i;){if(Q.x>=N&&Q.x<=$&&Q.y>=j&&Q.y<=K&&Ml(g,T,w,M,x,A,Q.x,Q.y)&&Sn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function p1(s,i,c,d){var g=s.prev,w=s,x=s.next;if(Sn(g,w,x)>=0)return!1;for(var T=g.x,M=w.x,A=x.x,N=g.y,j=w.y,$=x.y,K=T<M?T<A?T:A:M<A?M:A,Q=N<j?N<$?N:$:j<$?j:$,le=T>M?T>A?T:A:M>A?M:A,ge=N>j?N>$?N:$:j>$?j:$,xe=lf(K,Q,i,c,d),Fe=lf(le,ge,i,c,d),Se=s.prevZ,ze=s.nextZ;Se&&Se.z>=xe&&ze&&ze.z<=Fe;){if(Se.x>=K&&Se.x<=le&&Se.y>=Q&&Se.y<=ge&&Se!==g&&Se!==x&&Ml(T,N,M,j,A,$,Se.x,Se.y)&&Sn(Se.prev,Se,Se.next)>=0||(Se=Se.prevZ,ze.x>=K&&ze.x<=le&&ze.y>=Q&&ze.y<=ge&&ze!==g&&ze!==x&&Ml(T,N,M,j,A,$,ze.x,ze.y)&&Sn(ze.prev,ze,ze.next)>=0))return!1;ze=ze.nextZ}for(;Se&&Se.z>=xe;){if(Se.x>=K&&Se.x<=le&&Se.y>=Q&&Se.y<=ge&&Se!==g&&Se!==x&&Ml(T,N,M,j,A,$,Se.x,Se.y)&&Sn(Se.prev,Se,Se.next)>=0)return!1;Se=Se.prevZ}for(;ze&&ze.z<=Fe;){if(ze.x>=K&&ze.x<=le&&ze.y>=Q&&ze.y<=ge&&ze!==g&&ze!==x&&Ml(T,N,M,j,A,$,ze.x,ze.y)&&Sn(ze.prev,ze,ze.next)>=0)return!1;ze=ze.nextZ}return!0}function m1(s,i,c){var d=s;do{var g=d.prev,w=d.next.next;!Fh(g,w)&&rm(g,d,d.next,w)&&Wc(g,w)&&Wc(w,g)&&(i.push(g.i/c|0),i.push(d.i/c|0),i.push(w.i/c|0),$c(d),$c(d.next),d=s=w),d=d.next}while(d!==s);return La(d)}function g1(s,i,c,d,g,w){var x=s;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&w1(x,T)){var M=om(x,T);return x=La(x,x.next),M=La(M,M.next),Gc(x,i,c,d,g,w,0),void Gc(M,i,c,d,g,w,0)}T=T.next}x=x.next}while(x!==s)}function _1(s,i){return s.x-i.x}function y1(s,i){var c=function(g,w){var x,T=w,M=g.x,A=g.y,N=-1/0;do{if(A<=T.y&&A>=T.next.y&&T.next.y!==T.y){var j=T.x+(A-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(j<=M&&j>N&&(N=j,x=T.x<T.next.x?T:T.next,j===M))return x}T=T.next}while(T!==w);if(!x)return null;var $,K=x,Q=x.x,le=x.y,ge=1/0;T=x;do M>=T.x&&T.x>=Q&&M!==T.x&&Ml(A<le?M:N,A,Q,le,A<le?N:M,A,T.x,T.y)&&($=Math.abs(A-T.y)/(M-T.x),Wc(T,g)&&($<ge||$===ge&&(T.x>x.x||T.x===x.x&&v1(x,T)))&&(x=T,ge=$)),T=T.next;while(T!==K);return x}(s,i);if(!c)return i;var d=om(c,s);return La(d,d.next),La(c,c.next)}function v1(s,i){return Sn(s.prev,s,i.prev)<0&&Sn(i.next,s,s.next)<0}function lf(s,i,c,d,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function b1(s){var i=s,c=s;do(i.x<c.x||i.x===c.x&&i.y<c.y)&&(c=i),i=i.next;while(i!==s);return c}function Ml(s,i,c,d,g,w,x,T){return(g-x)*(i-T)>=(s-x)*(w-T)&&(s-x)*(d-T)>=(c-x)*(i-T)&&(c-x)*(w-T)>=(g-x)*(d-T)}function w1(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(c,d){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&rm(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(s,i)&&(Wc(s,i)&&Wc(i,s)&&function(c,d){var g=c,w=!1,x=(c.x+d.x)/2,T=(c.y+d.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&x<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==c);return w}(s,i)&&(Sn(s.prev,s,i.prev)||Sn(s,i.prev,i))||Fh(s,i)&&Sn(s.prev,s,s.next)>0&&Sn(i.prev,i,i.next)>0)}function Sn(s,i,c){return(i.y-s.y)*(c.x-i.x)-(i.x-s.x)*(c.y-i.y)}function Fh(s,i){return s.x===i.x&&s.y===i.y}function rm(s,i,c,d){var g=Nh(Sn(s,i,c)),w=Nh(Sn(s,i,d)),x=Nh(Sn(c,d,s)),T=Nh(Sn(c,d,i));return g!==w&&x!==T||!(g!==0||!Oh(s,c,i))||!(w!==0||!Oh(s,d,i))||!(x!==0||!Oh(c,s,d))||!(T!==0||!Oh(c,i,d))}function Oh(s,i,c){return i.x<=Math.max(s.x,c.x)&&i.x>=Math.min(s.x,c.x)&&i.y<=Math.max(s.y,c.y)&&i.y>=Math.min(s.y,c.y)}function Nh(s){return s>0?1:s<0?-1:0}function Wc(s,i){return Sn(s.prev,s,s.next)<0?Sn(s,i,s.next)>=0&&Sn(s,s.prev,i)>=0:Sn(s,i,s.prev)<0||Sn(s,s.next,i)<0}function om(s,i){var c=new cf(s.i,s.x,s.y),d=new cf(i.i,i.x,i.y),g=s.next,w=i.prev;return s.next=i,i.prev=s,c.next=g,g.prev=c,d.next=c,c.prev=d,w.next=d,d.prev=w,d}function sm(s,i,c,d){var g=new cf(s,i,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function $c(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function cf(s,i,c){this.i=s,this.x=i,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uf(s,i,c,d){for(var g=0,w=i,x=c-d;w<c;w+=d)g+=(s[x]-s[w])*(s[w+1]+s[x+1]),x=w;return g}af.exports=Bh,af.exports.default=Bh,Bh.deviation=function(s,i,c,d){var g=i&&i.length,w=Math.abs(uf(s,0,g?i[0]*c:s.length,c));if(g)for(var x=0,T=i.length;x<T;x++)w-=Math.abs(uf(s,i[x]*c,x<T-1?i[x+1]*c:s.length,c));var M=0;for(x=0;x<d.length;x+=3){var A=d[x]*c,N=d[x+1]*c,j=d[x+2]*c;M+=Math.abs((s[A]-s[j])*(s[N+1]-s[A+1])-(s[A]-s[N])*(s[j+1]-s[A+1]))}return w===0&&M===0?0:Math.abs((M-w)/w)},Bh.flatten=function(s){for(var i=s[0][0].length,c={vertices:[],holes:[],dimensions:i},d=0,g=0;g<s.length;g++){for(var w=0;w<s[g].length;w++)for(var x=0;x<i;x++)c.vertices.push(s[g][w][x]);g>0&&c.holes.push(d+=s[g-1].length)}return c};var am=_(af.exports);function x1(s,i,c,d,g){lm(s,i,c||0,d||s.length-1,g||k1)}function lm(s,i,c,d,g){for(;d>c;){if(d-c>600){var w=d-c+1,x=i-c+1,T=Math.log(w),M=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*M*(w-M)/w)*(x-w/2<0?-1:1);lm(s,i,Math.max(c,Math.floor(i-x*M/w+A)),Math.min(d,Math.floor(i+(w-x)*M/w+A)),g)}var N=s[i],j=c,$=d;for(Hc(s,c,i),g(s[d],N)>0&&Hc(s,c,d);j<$;){for(Hc(s,j,$),j++,$--;g(s[j],N)<0;)j++;for(;g(s[$],N)>0;)$--}g(s[c],N)===0?Hc(s,c,$):Hc(s,++$,d),$<=i&&(c=$+1),i<=$&&(d=$-1)}}function Hc(s,i,c){var d=s[i];s[i]=s[c],s[c]=d}function k1(s,i){return s<i?-1:s>i?1:0}function hf(s,i){const c=s.length;if(c<=1)return[s];const d=[];let g,w;for(let x=0;x<c;x++){const T=et(s[x]);T!==0&&(s[x].area=Math.abs(T),w===void 0&&(w=T<0),w===T<0?(g&&d.push(g),g=[s[x]]):g.push(s[x]))}if(g&&d.push(g),i>1)for(let x=0;x<d.length;x++)d[x].length<=i||(x1(d[x],i,1,d[x].length-1,S1),d[x]=d[x].slice(0,i));return d}function S1(s,i){return i.area-s.area}function df(s,i,c){const d=c.patternDependencies;let g=!1;for(const w of i){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const T=x.constantOr(null);T&&(g=!0,d[T.to]=!0,d[T.from]=!0)}return g}function ff(s,i,c,d,g){const w=g.patternDependencies;for(const x of i){const T=x.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let M=T.evaluate({zoom:d-1},c,{},g.availableImages),A=T.evaluate({zoom:d},c,{},g.availableImages),N=T.evaluate({zoom:d+1},c,{},g.availableImages);M=M&&M.name?M.name:M,A=A&&A.name?A.name:A,N=N&&N.name?N.name:N,w[M]=!0,w[A]=!0,w[N]=!0,c.patterns[x.id]={min:M,mid:A,max:N}}}return c}class pf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pe,this.indexArray=new Xe,this.indexArray2=new nt,this.programConfigurations=new on(i.layers,i.zoom),this.segments=new _t,this.segments2=new _t,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){this.hasPattern=df("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:T,id:M,index:A,sourceLayerIndex:N}of i){const j=this.layers[0]._featureFilter.needGeometry,$=fs(T,j);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),$,d))continue;const K=w?g.evaluate($,{},d,c.availableImages):void 0,Q={id:M,properties:T.properties,type:T.type,sourceLayerIndex:N,index:A,geometry:j?$.geometry:ds(T),patterns:{},sortKey:K};x.push(Q)}w&&x.sort((T,M)=>T.sortKey-M.sortKey);for(const T of x){const{geometry:M,index:A,sourceLayerIndex:N}=T;if(this.hasPattern){const j=ff("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,M,A,d,{});c.featureIndex.insert(i[A].feature,M,A,N,this.index)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}addFeatures(i,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,d1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,c,d,g,w){for(const x of hf(c,500)){let T=0;for(const K of x)T+=K.length;const M=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=M.vertexLength,N=[],j=[];for(const K of x){if(K.length===0)continue;K!==x[0]&&j.push(N.length/2);const Q=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),le=Q.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(le+K.length-1,le),N.push(K[0].x),N.push(K[0].y);for(let ge=1;ge<K.length;ge++)this.layoutVertexArray.emplaceBack(K[ge].x,K[ge].y),this.indexArray2.emplaceBack(le+ge-1,le+ge),N.push(K[ge].x),N.push(K[ge].y);Q.vertexLength+=K.length,Q.primitiveLength+=K.length}const $=am(N,j);for(let K=0;K<$.length;K+=3)this.indexArray.emplaceBack(A+$[K],A+$[K+1],A+$[K+2]);M.vertexLength+=T,M.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,w,g)}}let cm,um;Lt("FillBucket",pf,{omit:["layers","patternFeatures"]});var T1={get paint(){return um=um||new wr({"fill-antialias":new jt(we.paint_fill["fill-antialias"]),"fill-opacity":new $t(we.paint_fill["fill-opacity"]),"fill-color":new $t(we.paint_fill["fill-color"]),"fill-outline-color":new $t(we.paint_fill["fill-outline-color"]),"fill-translate":new jt(we.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new gl(we.paint_fill["fill-pattern"])})},get layout(){return cm=cm||new wr({"fill-sort-key":new $t(we.layout_fill["fill-sort-key"])})}};class E1 extends ro{constructor(i){super(i,T1)}recalculate(i,c){super.recalculate(i,c);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new pf(i)}queryRadius(){return zh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,c,d,g,w,x,T){return Nc(Dh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,T),g)}isTileClipped(){return!0}}const C1=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),M1=kn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:I1}=C1;var Zs={},L1=b,hm=Il;function Il(s,i,c,d,g){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=d,this._values=g,s.readFields(A1,this,i)}function A1(s,i,c){s==1?i.id=c.readVarint():s==2?function(d,g){for(var w=d.readVarint()+d.pos;d.pos<w;){var x=g._keys[d.readVarint()],T=g._values[d.readVarint()];g.properties[x]=T}}(c,i):s==3?i.type=c.readVarint():s==4&&(i._geometry=c.pos)}function P1(s){for(var i,c,d=0,g=0,w=s.length,x=w-1;g<w;x=g++)d+=((c=s[x]).x-(i=s[g]).x)*(i.y+c.y);return d}Il.types=["Unknown","Point","LineString","Polygon"],Il.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,c=s.readVarint()+s.pos,d=1,g=0,w=0,x=0,T=[];s.pos<c;){if(g<=0){var M=s.readVarint();d=7&M,g=M>>3}if(g--,d===1||d===2)w+=s.readSVarint(),x+=s.readSVarint(),d===1&&(i&&T.push(i),i=[]),i.push(new L1(w,x));else{if(d!==7)throw new Error("unknown command "+d);i&&i.push(i[0].clone())}}return i&&T.push(i),T},Il.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,c=1,d=0,g=0,w=0,x=1/0,T=-1/0,M=1/0,A=-1/0;s.pos<i;){if(d<=0){var N=s.readVarint();c=7&N,d=N>>3}if(d--,c===1||c===2)(g+=s.readSVarint())<x&&(x=g),g>T&&(T=g),(w+=s.readSVarint())<M&&(M=w),w>A&&(A=w);else if(c!==7)throw new Error("unknown command "+c)}return[x,M,T,A]},Il.prototype.toGeoJSON=function(s,i,c){var d,g,w=this.extent*Math.pow(2,c),x=this.extent*s,T=this.extent*i,M=this.loadGeometry(),A=Il.types[this.type];function N(K){for(var Q=0;Q<K.length;Q++){var le=K[Q];K[Q]=[360*(le.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(le.y+T)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(d=0;d<M.length;d++)j[d]=M[d][0];N(M=j);break;case 2:for(d=0;d<M.length;d++)N(M[d]);break;case 3:for(M=function(K){var Q=K.length;if(Q<=1)return[K];for(var le,ge,xe=[],Fe=0;Fe<Q;Fe++){var Se=P1(K[Fe]);Se!==0&&(ge===void 0&&(ge=Se<0),ge===Se<0?(le&&xe.push(le),le=[K[Fe]]):le.push(K[Fe]))}return le&&xe.push(le),xe}(M),d=0;d<M.length;d++)for(g=0;g<M[d].length;g++)N(M[d][g])}M.length===1?M=M[0]:A="Multi"+A;var $={type:"Feature",geometry:{type:A,coordinates:M},properties:this.properties};return"id"in this&&($.id=this.id),$};var z1=hm,dm=fm;function fm(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(D1,this,i),this.length=this._features.length}function D1(s,i,c){s===15?i.version=c.readVarint():s===1?i.name=c.readString():s===5?i.extent=c.readVarint():s===2?i._features.push(c.pos):s===3?i._keys.push(c.readString()):s===4&&i._values.push(function(d){for(var g=null,w=d.readVarint()+d.pos;d.pos<w;){var x=d.readVarint()>>3;g=x===1?d.readString():x===2?d.readFloat():x===3?d.readDouble():x===4?d.readVarint64():x===5?d.readVarint():x===6?d.readSVarint():x===7?d.readBoolean():null}return g}(c))}fm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new z1(this._pbf,i,this.extent,this._keys,this._values)};var R1=dm;function B1(s,i,c){if(s===3){var d=new R1(c,c.readVarint()+c.pos);d.length&&(i[d.name]=d)}}Zs.VectorTile=function(s,i){this.layers=s.readFields(B1,{},i)},Zs.VectorTileFeature=hm,Zs.VectorTileLayer=dm;const F1=Zs.VectorTileFeature.types,mf=Math.pow(2,13);function Xc(s,i,c,d,g,w,x,T){s.emplaceBack(i,c,2*Math.floor(d*mf)+x,g*mf*2,w*mf*2,Math.round(T))}class gf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new Z,this.indexArray=new Xe,this.programConfigurations=new on(i.layers,i.zoom),this.segments=new _t,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){this.features=[],this.hasPattern=df("fill-extrusion",this.layers,c);for(const{feature:g,id:w,index:x,sourceLayerIndex:T}of i){const M=this.layers[0]._featureFilter.needGeometry,A=fs(g,M);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),A,d))continue;const N={id:w,sourceLayerIndex:T,index:x,geometry:M?A.geometry:ds(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(ff("fill-extrusion",this.layers,N,this.zoom,c)):this.addFeature(N,N.geometry,x,d,{}),c.featureIndex.insert(g,N.geometry,x,T,this.index,!0)}}addFeatures(i,c,d){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,c,d)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,I1),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,M1.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,c,d,g,w){const x={x:0,y:0,vertexCount:0};for(const T of hf(c,500)){let M=0;for(const Q of T)M+=Q.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Q of T){if(Q.length===0||N1(Q))continue;let le=0;for(let ge=0;ge<Q.length;ge++){const xe=Q[ge];if(ge>=1){const Fe=Q[ge-1];if(!O1(xe,Fe)){A.vertexLength+4>_t.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Se=xe.sub(Fe)._perp()._unit(),ze=Fe.dist(xe);le+ze>32768&&(le=0),Xc(this.layoutVertexArray,xe.x,xe.y,Se.x,Se.y,0,0,le),Xc(this.layoutVertexArray,xe.x,xe.y,Se.x,Se.y,0,1,le),x.x+=2*xe.x,x.y+=2*xe.y,x.vertexCount+=2,le+=ze,Xc(this.layoutVertexArray,Fe.x,Fe.y,Se.x,Se.y,0,0,le),Xc(this.layoutVertexArray,Fe.x,Fe.y,Se.x,Se.y,0,1,le),x.x+=2*Fe.x,x.y+=2*Fe.y,x.vertexCount+=2;const Ye=A.vertexLength;this.indexArray.emplaceBack(Ye,Ye+2,Ye+1),this.indexArray.emplaceBack(Ye+1,Ye+2,Ye+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+M>_t.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),F1[i.type]!=="Polygon")continue;const N=[],j=[],$=A.vertexLength;for(const Q of T)if(Q.length!==0){Q!==T[0]&&j.push(N.length/2);for(let le=0;le<Q.length;le++){const ge=Q[le];Xc(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),x.x+=ge.x,x.y+=ge.y,x.vertexCount+=1,N.push(ge.x),N.push(ge.y)}}const K=am(N,j);for(let Q=0;Q<K.length;Q+=3)this.indexArray.emplaceBack($+K[Q],$+K[Q+2],$+K[Q+1]);A.primitiveLength+=K.length/3,A.vertexLength+=M}for(let T=0;T<x.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,w,g)}}function O1(s,i){return s.x===i.x&&(s.x<0||s.x>_n)||s.y===i.y&&(s.y<0||s.y>_n)}function N1(s){return s.every(i=>i.x<0)||s.every(i=>i.x>_n)||s.every(i=>i.y<0)||s.every(i=>i.y>_n)}let pm;Lt("FillExtrusionBucket",gf,{omit:["layers","features"]});var j1={get paint(){return pm=pm||new wr({"fill-extrusion-opacity":new jt(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $t(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class U1 extends ro{constructor(i){super(i,j1)}createBucket(i){return new gf(i)}queryRadius(){return zh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,c,d,g,w,x,T,M){const A=Dh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,T),N=this.paint.get("fill-extrusion-height").evaluate(c,d),j=this.paint.get("fill-extrusion-base").evaluate(c,d),$=function(Q,le,ge,xe){const Fe=[];for(const Se of Q){const ze=[Se.x,Se.y,0,1];Rh(ze,ze,le),Fe.push(new S(ze[0]/ze[3],ze[1]/ze[3]))}return Fe}(A,M),K=function(Q,le,ge,xe){const Fe=[],Se=[],ze=xe[8]*le,Ye=xe[9]*le,tt=xe[10]*le,Ct=xe[11]*le,Bt=xe[8]*ge,Tt=xe[9]*ge,wt=xe[10]*ge,mt=xe[11]*ge;for(const Dt of Q){const vt=[],at=[];for(const Wt of Dt){const Nt=Wt.x,mi=Wt.y,$i=xe[0]*Nt+xe[4]*mi+xe[12],en=xe[1]*Nt+xe[5]*mi+xe[13],Un=xe[2]*Nt+xe[6]*mi+xe[14],Jr=xe[3]*Nt+xe[7]*mi+xe[15],kr=Un+tt,zn=Jr+Ct,Jn=$i+Bt,rr=en+Tt,Sr=Un+wt,Tr=Jr+mt,Vn=new S(($i+ze)/zn,(en+Ye)/zn);Vn.z=kr/zn,vt.push(Vn);const qn=new S(Jn/Tr,rr/Tr);qn.z=Sr/Tr,at.push(qn)}Fe.push(vt),Se.push(at)}return[Fe,Se]}(g,j,N,M);return function(Q,le,ge){let xe=1/0;Nc(ge,le)&&(xe=mm(ge,le[0]));for(let Fe=0;Fe<le.length;Fe++){const Se=le[Fe],ze=Q[Fe];for(let Ye=0;Ye<Se.length-1;Ye++){const tt=Se[Ye],Ct=[tt,Se[Ye+1],ze[Ye+1],ze[Ye],tt];Oc(ge,Ct)&&(xe=Math.min(xe,mm(ge,Ct)))}}return xe!==1/0&&xe}(K[0],K[1],$)}}function Kc(s,i){return s.x*i.x+s.y*i.y}function mm(s,i){if(s.length===1){let c=0;const d=i[c++];let g;for(;!g||d.equals(g);)if(g=i[c++],!g)return 1/0;for(;c<i.length;c++){const w=i[c],x=s[0],T=g.sub(d),M=w.sub(d),A=x.sub(d),N=Kc(T,T),j=Kc(T,M),$=Kc(M,M),K=Kc(A,T),Q=Kc(A,M),le=N*$-j*j,ge=($*K-j*Q)/le,xe=(N*Q-j*K)/le,Fe=d.z*(1-ge-xe)+g.z*ge+w.z*xe;if(isFinite(Fe))return Fe}return 1/0}{let c=1/0;for(const d of i)c=Math.min(c,d.z);return c}}const V1=kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:q1}=V1,Z1=kn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:G1}=Z1,W1=Zs.VectorTileFeature.types,$1=Math.cos(Math.PI/180*37.5),gm=Math.pow(2,14)/.5;class _f{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new _e,this.layoutVertexArray2=new ae,this.indexArray=new Xe,this.programConfigurations=new on(i.layers,i.zoom),this.segments=new _t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){this.hasPattern=df("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:T,id:M,index:A,sourceLayerIndex:N}of i){const j=this.layers[0]._featureFilter.needGeometry,$=fs(T,j);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),$,d))continue;const K=w?g.evaluate($,{},d):void 0,Q={id:M,properties:T.properties,type:T.type,sourceLayerIndex:N,index:A,geometry:j?$.geometry:ds(T),patterns:{},sortKey:K};x.push(Q)}w&&x.sort((T,M)=>T.sortKey-M.sortKey);for(const T of x){const{geometry:M,index:A,sourceLayerIndex:N}=T;if(this.hasPattern){const j=ff("line",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,M,A,d,{});c.featureIndex.insert(i[A].feature,M,A,N,this.index)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}addFeatures(i,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,G1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,q1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,c,d,g,w){const x=this.layers[0].layout,T=x.get("line-join").evaluate(i,{}),M=x.get("line-cap"),A=x.get("line-miter-limit"),N=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const j of c)this.addLine(j,i,T,M,A,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,w,g)}addLine(i,c,d,g,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<i.length-1;xe++)this.totalDistance+=i[xe].dist(i[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=W1[c.type]==="Polygon";let M=i.length;for(;M>=2&&i[M-1].equals(i[M-2]);)M--;let A=0;for(;A<M-1&&i[A].equals(i[A+1]);)A++;if(M<(T?3:2))return;d==="bevel"&&(w=1.05);const N=this.overscaling<=16?15*_n/(512*this.overscaling):0,j=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let $,K,Q,le,ge;this.e1=this.e2=-1,T&&($=i[M-2],ge=i[A].sub($)._unit()._perp());for(let xe=A;xe<M;xe++){if(Q=xe===M-1?T?i[A+1]:void 0:i[xe+1],Q&&i[xe].equals(Q))continue;ge&&(le=ge),$&&(K=$),$=i[xe],ge=Q?Q.sub($)._unit()._perp():le,le=le||ge;let Fe=le.add(ge);Fe.x===0&&Fe.y===0||Fe._unit();const Se=le.x*ge.x+le.y*ge.y,ze=Fe.x*ge.x+Fe.y*ge.y,Ye=ze!==0?1/ze:1/0,tt=2*Math.sqrt(2-2*ze),Ct=ze<$1&&K&&Q,Bt=le.x*ge.y-le.y*ge.x>0;if(Ct&&xe>A){const mt=$.dist(K);if(mt>2*N){const Dt=$.sub($.sub(K)._mult(N/mt)._round());this.updateDistance(K,Dt),this.addCurrentVertex(Dt,le,0,0,j),K=Dt}}const Tt=K&&Q;let wt=Tt?d:T?"butt":g;if(Tt&&wt==="round"&&(Ye<x?wt="miter":Ye<=2&&(wt="fakeround")),wt==="miter"&&Ye>w&&(wt="bevel"),wt==="bevel"&&(Ye>2&&(wt="flipbevel"),Ye<w&&(wt="miter")),K&&this.updateDistance(K,$),wt==="miter")Fe._mult(Ye),this.addCurrentVertex($,Fe,0,0,j);else if(wt==="flipbevel"){if(Ye>100)Fe=ge.mult(-1);else{const mt=Ye*le.add(ge).mag()/le.sub(ge).mag();Fe._perp()._mult(mt*(Bt?-1:1))}this.addCurrentVertex($,Fe,0,0,j),this.addCurrentVertex($,Fe.mult(-1),0,0,j)}else if(wt==="bevel"||wt==="fakeround"){const mt=-Math.sqrt(Ye*Ye-1),Dt=Bt?mt:0,vt=Bt?0:mt;if(K&&this.addCurrentVertex($,le,Dt,vt,j),wt==="fakeround"){const at=Math.round(180*tt/Math.PI/20);for(let Wt=1;Wt<at;Wt++){let Nt=Wt/at;if(Nt!==.5){const $i=Nt-.5;Nt+=Nt*$i*(Nt-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*$i*$i+(.848013+Se*(.215638*Se-1.06021)))}const mi=ge.sub(le)._mult(Nt)._add(le)._unit()._mult(Bt?-1:1);this.addHalfVertex($,mi.x,mi.y,!1,Bt,0,j)}}Q&&this.addCurrentVertex($,ge,-Dt,-vt,j)}else if(wt==="butt")this.addCurrentVertex($,Fe,0,0,j);else if(wt==="square"){const mt=K?1:-1;this.addCurrentVertex($,Fe,mt,mt,j)}else wt==="round"&&(K&&(this.addCurrentVertex($,le,0,0,j),this.addCurrentVertex($,le,1,1,j,!0)),Q&&(this.addCurrentVertex($,ge,-1,-1,j,!0),this.addCurrentVertex($,ge,0,0,j)));if(Ct&&xe<M-1){const mt=$.dist(Q);if(mt>2*N){const Dt=$.add(Q.sub($)._mult(N/mt)._round());this.updateDistance($,Dt),this.addCurrentVertex(Dt,ge,0,0,j),$=Dt}}}}addCurrentVertex(i,c,d,g,w,x=!1){const T=c.y*g-c.x,M=-c.y-c.x*g;this.addHalfVertex(i,c.x+c.y*d,c.y-c.x*d,x,!1,d,w),this.addHalfVertex(i,T,M,x,!0,-g,w),this.distance>gm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,c,d,g,w,x))}addHalfVertex({x:i,y:c},d,g,w,x,T,M){const A=.5*(this.lineClips?this.scaledDistance*(gm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(w?1:0),(c<<1)+(x?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),M.primitiveLength++),x?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,c){this.distance+=i.dist(c),this.updateScaledDistance()}}let _m,ym;Lt("LineBucket",_f,{omit:["layers","patternFeatures"]});var vm={get paint(){return ym=ym||new wr({"line-opacity":new $t(we.paint_line["line-opacity"]),"line-color":new $t(we.paint_line["line-color"]),"line-translate":new jt(we.paint_line["line-translate"]),"line-translate-anchor":new jt(we.paint_line["line-translate-anchor"]),"line-width":new $t(we.paint_line["line-width"]),"line-gap-width":new $t(we.paint_line["line-gap-width"]),"line-offset":new $t(we.paint_line["line-offset"]),"line-blur":new $t(we.paint_line["line-blur"]),"line-dasharray":new ka(we.paint_line["line-dasharray"]),"line-pattern":new gl(we.paint_line["line-pattern"]),"line-gradient":new Mc(we.paint_line["line-gradient"])})},get layout(){return _m=_m||new wr({"line-cap":new jt(we.layout_line["line-cap"]),"line-join":new $t(we.layout_line["line-join"]),"line-miter-limit":new jt(we.layout_line["line-miter-limit"]),"line-round-limit":new jt(we.layout_line["line-round-limit"]),"line-sort-key":new $t(we.layout_line["line-sort-key"])})}};class H1 extends $t{possiblyEvaluate(i,c){return c=new Yi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(i,c)}evaluate(i,c,d,g){return c=H({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(i,c,d,g)}}let jh;class X1 extends ro{constructor(i){super(i,vm),this.gradientVersion=0,jh||(jh=new H1(vm.paint.properties["line-width"].specification),jh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,c){super.recalculate(i,c),this.paint._values["line-floorwidth"]=jh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new _f(i)}queryRadius(i){const c=i,d=bm(Vc("line-width",this,c),Vc("line-gap-width",this,c)),g=Vc("line-offset",this,c);return d/2+Math.abs(g)+zh(this.paint.get("line-translate"))}queryIntersectsFeature(i,c,d,g,w,x,T){const M=Dh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,T),A=T/2*bm(this.paint.get("line-width").evaluate(c,d),this.paint.get("line-gap-width").evaluate(c,d)),N=this.paint.get("line-offset").evaluate(c,d);return N&&(g=function(j,$){const K=[];for(let Q=0;Q<j.length;Q++){const le=j[Q],ge=[];for(let xe=0;xe<le.length;xe++){const Fe=le[xe-1],Se=le[xe],ze=le[xe+1],Ye=xe===0?new S(0,0):Se.sub(Fe)._unit()._perp(),tt=xe===le.length-1?new S(0,0):ze.sub(Se)._unit()._perp(),Ct=Ye._add(tt)._unit(),Bt=Ct.x*tt.x+Ct.y*tt.y;Bt!==0&&Ct._mult(1/Bt),ge.push(Ct._mult($)._add(Se))}K.push(ge)}return K}(g,N*T)),function(j,$,K){for(let Q=0;Q<$.length;Q++){const le=$[Q];if(j.length>=3){for(let ge=0;ge<le.length;ge++)if(El(j,le[ge]))return!0}if(jc(j,le,K))return!0}return!1}(M,g,A)}isTileClipped(){return!0}}function bm(s,i){return i>0?i+2*s:s}const K1=kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),J1=kn([{name:"a_projected_pos",components:3,type:"Float32"}],4);kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Y1=kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);kn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wm=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Q1=kn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ev(s,i,c){return s.sections.forEach(d=>{d.text=function(g,w,x){const T=w.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),$o.applyArabicShaping&&(g=$o.applyArabicShaping(g)),g}(d.text,i,c)}),s}kn([{name:"triangle",components:3,type:"Uint16"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),kn([{type:"Float32",name:"offsetX"}]),kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),kn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Jc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var jn=24,xm=ji,km=function(s,i,c,d,g){var w,x,T=8*g-d-1,M=(1<<T)-1,A=M>>1,N=-7,j=c?g-1:0,$=c?-1:1,K=s[i+j];for(j+=$,w=K&(1<<-N)-1,K>>=-N,N+=T;N>0;w=256*w+s[i+j],j+=$,N-=8);for(x=w&(1<<-N)-1,w>>=-N,N+=d;N>0;x=256*x+s[i+j],j+=$,N-=8);if(w===0)w=1-A;else{if(w===M)return x?NaN:1/0*(K?-1:1);x+=Math.pow(2,d),w-=A}return(K?-1:1)*x*Math.pow(2,w-d)},Sm=function(s,i,c,d,g,w){var x,T,M,A=8*w-g-1,N=(1<<A)-1,j=N>>1,$=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=d?0:w-1,Q=d?1:-1,le=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(T=isNaN(i)?1:0,x=N):(x=Math.floor(Math.log(i)/Math.LN2),i*(M=Math.pow(2,-x))<1&&(x--,M*=2),(i+=x+j>=1?$/M:$*Math.pow(2,1-j))*M>=2&&(x++,M/=2),x+j>=N?(T=0,x=N):x+j>=1?(T=(i*M-1)*Math.pow(2,g),x+=j):(T=i*Math.pow(2,j-1)*Math.pow(2,g),x=0));g>=8;s[c+K]=255&T,K+=Q,T/=256,g-=8);for(x=x<<g|T,A+=g;A>0;s[c+K]=255&x,K+=Q,x/=256,A-=8);s[c+K-Q]|=128*le};function ji(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}ji.Varint=0,ji.Fixed64=1,ji.Bytes=2,ji.Fixed32=5;var yf=4294967296,Tm=1/yf,Em=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ps(s){return s.type===ji.Bytes?s.readVarint()+s.pos:s.pos+1}function Ll(s,i,c){return c?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function Cm(s,i,c){var d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));c.realloc(d);for(var g=c.pos-1;g>=s;g--)c.buf[g+d]=c.buf[g]}function tv(s,i){for(var c=0;c<s.length;c++)i.writeVarint(s[c])}function iv(s,i){for(var c=0;c<s.length;c++)i.writeSVarint(s[c])}function nv(s,i){for(var c=0;c<s.length;c++)i.writeFloat(s[c])}function rv(s,i){for(var c=0;c<s.length;c++)i.writeDouble(s[c])}function ov(s,i){for(var c=0;c<s.length;c++)i.writeBoolean(s[c])}function sv(s,i){for(var c=0;c<s.length;c++)i.writeFixed32(s[c])}function av(s,i){for(var c=0;c<s.length;c++)i.writeSFixed32(s[c])}function lv(s,i){for(var c=0;c<s.length;c++)i.writeFixed64(s[c])}function cv(s,i){for(var c=0;c<s.length;c++)i.writeSFixed64(s[c])}function Uh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Al(s,i,c){s[c]=i,s[c+1]=i>>>8,s[c+2]=i>>>16,s[c+3]=i>>>24}function Mm(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}ji.prototype={destroy:function(){this.buf=null},readFields:function(s,i,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),g=d>>3,w=this.pos;this.type=7&d,s(g,i,this),this.pos===w&&this.skip(d)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Uh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Mm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Uh(this.buf,this.pos)+Uh(this.buf,this.pos+4)*yf;return this.pos+=8,s},readSFixed64:function(){var s=Uh(this.buf,this.pos)+Mm(this.buf,this.pos+4)*yf;return this.pos+=8,s},readFloat:function(){var s=km(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=km(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,c,d=this.buf;return i=127&(c=d[this.pos++]),c<128?i:(i|=(127&(c=d[this.pos++]))<<7,c<128?i:(i|=(127&(c=d[this.pos++]))<<14,c<128?i:(i|=(127&(c=d[this.pos++]))<<21,c<128?i:function(g,w,x){var T,M,A=x.buf;if(T=(112&(M=A[x.pos++]))>>4,M<128||(T|=(127&(M=A[x.pos++]))<<3,M<128)||(T|=(127&(M=A[x.pos++]))<<10,M<128)||(T|=(127&(M=A[x.pos++]))<<17,M<128)||(T|=(127&(M=A[x.pos++]))<<24,M<128)||(T|=(1&(M=A[x.pos++]))<<31,M<128))return Ll(g,T,w);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(c=d[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&Em?function(c,d,g){return Em.decode(c.subarray(d,g))}(this.buf,i,s):function(c,d,g){for(var w="",x=d;x<g;){var T,M,A,N=c[x],j=null,$=N>239?4:N>223?3:N>191?2:1;if(x+$>g)break;$===1?N<128&&(j=N):$===2?(192&(T=c[x+1]))==128&&(j=(31&N)<<6|63&T)<=127&&(j=null):$===3?(M=c[x+2],(192&(T=c[x+1]))==128&&(192&M)==128&&((j=(15&N)<<12|(63&T)<<6|63&M)<=2047||j>=55296&&j<=57343)&&(j=null)):$===4&&(M=c[x+2],A=c[x+3],(192&(T=c[x+1]))==128&&(192&M)==128&&(192&A)==128&&((j=(15&N)<<18|(63&T)<<12|(63&M)<<6|63&A)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,$=1):j>65535&&(j-=65536,w+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),w+=String.fromCharCode(j),x+=$}return w}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==ji.Bytes)return s.push(this.readVarint(i));var c=ps(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==ji.Bytes)return s.push(this.readSVarint());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==ji.Bytes)return s.push(this.readBoolean());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==ji.Bytes)return s.push(this.readFloat());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==ji.Bytes)return s.push(this.readDouble());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==ji.Bytes)return s.push(this.readFixed32());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==ji.Bytes)return s.push(this.readSFixed32());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==ji.Bytes)return s.push(this.readFixed64());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==ji.Bytes)return s.push(this.readSFixed64());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===ji.Varint)for(;this.buf[this.pos++]>127;);else if(i===ji.Bytes)this.pos=this.readVarint()+this.pos;else if(i===ji.Fixed32)this.pos+=4;else{if(i!==ji.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var c=new Uint8Array(i);c.set(this.buf),this.buf=c,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Al(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Al(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Al(this.buf,-1&s,this.pos),Al(this.buf,Math.floor(s*Tm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Al(this.buf,-1&s,this.pos),Al(this.buf,Math.floor(s*Tm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,c){var d,g;if(i>=0?(d=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(d=~(-i%4294967296))?d=d+1|0:(d=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(w,x,T){T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,T.buf[T.pos]=127&(w>>>=7)}(d,0,c),function(w,x){var T=(7&w)<<4;x.buf[x.pos++]|=T|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(g,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(d,g,w){for(var x,T,M=0;M<g.length;M++){if((x=g.charCodeAt(M))>55295&&x<57344){if(!T){x>56319||M+1===g.length?(d[w++]=239,d[w++]=191,d[w++]=189):T=x;continue}if(x<56320){d[w++]=239,d[w++]=191,d[w++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(d[w++]=239,d[w++]=191,d[w++]=189,T=null);x<128?d[w++]=x:(x<2048?d[w++]=x>>6|192:(x<65536?d[w++]=x>>12|224:(d[w++]=x>>18|240,d[w++]=x>>12&63|128),d[w++]=x>>6&63|128),d[w++]=63&x|128)}return w}(this.buf,s,this.pos);var c=this.pos-i;c>=128&&Cm(i,c,this),this.pos=i-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),Sm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Sm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var c=0;c<i;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,i){this.pos++;var c=this.pos;s(i,this);var d=this.pos-c;d>=128&&Cm(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(s,i,c){this.writeTag(s,ji.Bytes),this.writeRawMessage(i,c)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,tv,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,iv,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,ov,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,nv,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,rv,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,sv,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,av,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,lv,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,cv,i)},writeBytesField:function(s,i){this.writeTag(s,ji.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,ji.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,ji.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,ji.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,ji.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,ji.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,ji.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,ji.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,ji.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,ji.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var vf=_(xm);const bf=3;function uv(s,i,c){s===1&&c.readMessage(hv,i)}function hv(s,i,c){if(s===3){const{id:d,bitmap:g,width:w,height:x,left:T,top:M,advance:A}=c.readMessage(dv,{});i.push({id:d,bitmap:new Zc({width:w+2*bf,height:x+2*bf},g),metrics:{width:w,height:x,left:T,top:M,advance:A}})}}function dv(s,i,c){s===1?i.id=c.readVarint():s===2?i.bitmap=c.readBytes():s===3?i.width=c.readVarint():s===4?i.height=c.readVarint():s===5?i.left=c.readSVarint():s===6?i.top=c.readSVarint():s===7&&(i.advance=c.readVarint())}const Im=bf;function Lm(s){let i=0,c=0;for(const x of s)i+=x.w*x.h,c=Math.max(c,x.w);s.sort((x,T)=>T.h-x.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),c),h:1/0}];let g=0,w=0;for(const x of s)for(let T=d.length-1;T>=0;T--){const M=d[T];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===M.w&&x.h===M.h){const A=d.pop();T<d.length&&(d[T]=A)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(d.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:g,h:w,fill:i/(g*w)||0}}const Fr=1;class wf{constructor(i,{pixelRatio:c,version:d,stretchX:g,stretchY:w,content:x}){this.paddedRect=i,this.pixelRatio=c,this.stretchX=g,this.stretchY=w,this.content=x,this.version=d}get tl(){return[this.paddedRect.x+Fr,this.paddedRect.y+Fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fr,this.paddedRect.y+this.paddedRect.h-Fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Fr)/this.pixelRatio,(this.paddedRect.h-2*Fr)/this.pixelRatio]}}class Am{constructor(i,c){const d={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(i,d,w),this.addImages(c,g,w);const{w:x,h:T}=Lm(w),M=new oo({width:x||1,height:T||1});for(const A in i){const N=i[A],j=d[A].paddedRect;oo.copy(N.data,M,{x:0,y:0},{x:j.x+Fr,y:j.y+Fr},N.data)}for(const A in c){const N=c[A],j=g[A].paddedRect,$=j.x+Fr,K=j.y+Fr,Q=N.data.width,le=N.data.height;oo.copy(N.data,M,{x:0,y:0},{x:$,y:K},N.data),oo.copy(N.data,M,{x:0,y:le-1},{x:$,y:K-1},{width:Q,height:1}),oo.copy(N.data,M,{x:0,y:0},{x:$,y:K+le},{width:Q,height:1}),oo.copy(N.data,M,{x:Q-1,y:0},{x:$-1,y:K},{width:1,height:le}),oo.copy(N.data,M,{x:0,y:0},{x:$+Q,y:K},{width:1,height:le})}this.image=M,this.iconPositions=d,this.patternPositions=g}addImages(i,c,d){for(const g in i){const w=i[g],x={x:0,y:0,w:w.data.width+2*Fr,h:w.data.height+2*Fr};d.push(x),c[g]=new wf(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,c){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in i.updatedImages)this.patchUpdatedImage(this.iconPositions[d],i.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],i.getImage(d),c)}patchUpdatedImage(i,c,d){if(!i||!c||i.version===c.version)return;i.version=c.version;const[g,w]=i.tl;d.update(c.data,void 0,{x:g,y:w})}}var Gs;Lt("ImagePosition",wf),Lt("ImageAtlas",Am),f.ah=void 0,(Gs=f.ah||(f.ah={}))[Gs.none=0]="none",Gs[Gs.horizontal=1]="horizontal",Gs[Gs.vertical=2]="vertical",Gs[Gs.horizontalOnly=3]="horizontalOnly";const Yc=-17;class Qc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,c){const d=new Qc;return d.scale=i||1,d.fontStack=c,d}static forImage(i){const c=new Qc;return c.imageName=i,c}}class Pl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,c){const d=new Pl;for(let g=0;g<i.sections.length;g++){const w=i.sections[g];w.image?d.addImageSection(w):d.addTextSection(w,c)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let c="";for(let d=0;d<i.length;d++){const g=i.charCodeAt(d+1)||null,w=i.charCodeAt(d-1)||null;c+=g&&Ec(g)&&!Jc[i[d+1]]||w&&Ec(w)&&!Jc[i[d-1]]||!Jc[i[d]]?i[d]:Jc[i[d]]}return c}(this.text)}trim(){let i=0;for(let d=0;d<this.text.length&&qh[this.text.charCodeAt(d)];d++)i++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&qh[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(i,c),this.sectionIndex=this.sectionIndex.slice(i,c)}substring(i,c){const d=new Pl;return d.text=this.text.substring(i,c),d.sectionIndex=this.sectionIndex.slice(i,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,c)=>Math.max(i,this.sections[c].scale),0)}addTextSection(i,c){this.text+=i.text,this.sections.push(Qc.forText(i.scale,i.fontStack||c));const d=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(d)}addImageSection(i){const c=i.image?i.image.name:"";if(c.length===0)return void Ke("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Qc.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vh(s,i,c,d,g,w,x,T,M,A,N,j,$,K,Q,le){const ge=Pl.fromFeature(s,g);let xe;j===f.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Fe,processStyledBidirectionalText:Se}=$o;if(Fe&&ge.sections.length===1){xe=[];const tt=Fe(ge.toString(),xf(ge,A,w,i,d,K,Q));for(const Ct of tt){const Bt=new Pl;Bt.text=Ct,Bt.sections=ge.sections;for(let Tt=0;Tt<Ct.length;Tt++)Bt.sectionIndex.push(0);xe.push(Bt)}}else if(Se){xe=[];const tt=Se(ge.text,ge.sectionIndex,xf(ge,A,w,i,d,K,Q));for(const Ct of tt){const Bt=new Pl;Bt.text=Ct[0],Bt.sectionIndex=Ct[1],Bt.sections=ge.sections,xe.push(Bt)}}else xe=function(tt,Ct){const Bt=[],Tt=tt.text;let wt=0;for(const mt of Ct)Bt.push(tt.substring(wt,mt)),wt=mt;return wt<Tt.length&&Bt.push(tt.substring(wt,Tt.length)),Bt}(ge,xf(ge,A,w,i,d,K,Q));const ze=[],Ye={positionedLines:ze,text:ge.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(tt,Ct,Bt,Tt,wt,mt,Dt,vt,at,Wt,Nt,mi){let $i=0,en=Yc,Un=0,Jr=0;const kr=vt==="right"?1:vt==="left"?0:.5;let zn=0;for(const Vn of wt){Vn.trim();const qn=Vn.getMaxScale(),hr=(qn-1)*jn,Er={positionedGlyphs:[],lineOffset:0};tt.positionedLines[zn]=Er;const dr=Er.positionedGlyphs;let Or=0;if(!Vn.length()){en+=mt,++zn;continue}for(let Zn=0;Zn<Vn.length();Zn++){const bi=Vn.getSection(Zn),fr=Vn.getSectionIndex(Zn),or=Vn.getCharCode(Zn);let Gn=0,wo=null,zo=null,Do=null,ms=jn;const xo=!(at===f.ah.horizontal||!Nt&&!fl(or)||Nt&&(qh[or]||(Jn=or,St.Arabic(Jn)||St["Arabic Supplement"](Jn)||St["Arabic Extended-A"](Jn)||St["Arabic Presentation Forms-A"](Jn)||St["Arabic Presentation Forms-B"](Jn))));if(bi.imageName){const ao=Tt[bi.imageName];if(!ao)continue;Do=bi.imageName,tt.iconsInText=tt.iconsInText||!0,zo=ao.paddedRect;const jr=ao.displaySize;bi.scale=bi.scale*jn/mi,wo={width:jr[0],height:jr[1],left:Fr,top:-Im,advance:xo?jr[1]:jr[0]},Gn=hr+(jn-jr[1]*bi.scale),ms=wo.advance;const gs=xo?jr[0]*bi.scale-jn*qn:jr[1]*bi.scale-jn*qn;gs>0&&gs>Or&&(Or=gs)}else{const ao=Bt[bi.fontStack],jr=ao&&ao[or];if(jr&&jr.rect)zo=jr.rect,wo=jr.metrics;else{const gs=Ct[bi.fontStack],ru=gs&&gs[or];if(!ru)continue;wo=ru.metrics}Gn=(qn-bi.scale)*jn}xo?(tt.verticalizable=!0,dr.push({glyph:or,imageName:Do,x:$i,y:en+Gn,vertical:xo,scale:bi.scale,fontStack:bi.fontStack,sectionIndex:fr,metrics:wo,rect:zo}),$i+=ms*bi.scale+Wt):(dr.push({glyph:or,imageName:Do,x:$i,y:en+Gn,vertical:xo,scale:bi.scale,fontStack:bi.fontStack,sectionIndex:fr,metrics:wo,rect:zo}),$i+=wo.advance*bi.scale+Wt)}dr.length!==0&&(Un=Math.max($i-Wt,Un),mv(dr,0,dr.length-1,kr,Or)),$i=0;const Nr=mt*qn+Or;Er.lineOffset=Math.max(Or,hr),en+=Nr,Jr=Math.max(Nr,Jr),++zn}var Jn;const rr=en-Yc,{horizontalAlign:Sr,verticalAlign:Tr}=kf(Dt);(function(Vn,qn,hr,Er,dr,Or,Nr,Zn,bi){const fr=(qn-hr)*dr;let or=0;or=Or!==Nr?-Zn*Er-Yc:(-Er*bi+.5)*Nr;for(const Gn of Vn)for(const wo of Gn.positionedGlyphs)wo.x+=fr,wo.y+=or})(tt.positionedLines,kr,Sr,Tr,Un,Jr,mt,rr,wt.length),tt.top+=-Tr*rr,tt.bottom=tt.top+rr,tt.left+=-Sr*Un,tt.right=tt.left+Un}(Ye,i,c,d,xe,x,T,M,j,A,$,le),!function(tt){for(const Ct of tt)if(Ct.positionedGlyphs.length!==0)return!1;return!0}(ze)&&Ye}const qh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Pm(s,i,c,d,g,w){if(i.imageName){const x=d[i.imageName];return x?x.displaySize[0]*i.scale*jn/w+g:0}{const x=c[i.fontStack],T=x&&x[s];return T?T.metrics.advance*i.scale+g:0}}function zm(s,i,c,d){const g=Math.pow(s-i,2);return d?s<i?g/2:2*g:g+Math.abs(c)*c}function pv(s,i,c){let d=0;return s===10&&(d-=1e4),c&&(d+=150),s!==40&&s!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function Dm(s,i,c,d,g,w){let x=null,T=zm(i,c,g,w);for(const M of d){const A=zm(i-M.x,c,g,w)+M.badness;A<=T&&(x=M,T=A)}return{index:s,x:i,priorBreak:x,badness:T}}function Rm(s){return s?Rm(s.priorBreak).concat(s.index):[]}function xf(s,i,c,d,g,w,x){if(w!=="point")return[];if(!s)return[];const T=[],M=function($,K,Q,le,ge,xe){let Fe=0;for(let Se=0;Se<$.length();Se++){const ze=$.getSection(Se);Fe+=Pm($.getCharCode(Se),ze,le,ge,K,xe)}return Fe/Math.max(1,Math.ceil(Fe/Q))}(s,i,c,d,g,x),A=s.text.indexOf("​")>=0;let N=0;for(let $=0;$<s.length();$++){const K=s.getSection($),Q=s.getCharCode($);if(qh[Q]||(N+=Pm(Q,K,d,g,i,x)),$<s.length()-1){const le=!((j=Q)<11904||!(St["Bopomofo Extended"](j)||St.Bopomofo(j)||St["CJK Compatibility Forms"](j)||St["CJK Compatibility Ideographs"](j)||St["CJK Compatibility"](j)||St["CJK Radicals Supplement"](j)||St["CJK Strokes"](j)||St["CJK Symbols and Punctuation"](j)||St["CJK Unified Ideographs Extension A"](j)||St["CJK Unified Ideographs"](j)||St["Enclosed CJK Letters and Months"](j)||St["Halfwidth and Fullwidth Forms"](j)||St.Hiragana(j)||St["Ideographic Description Characters"](j)||St["Kangxi Radicals"](j)||St["Katakana Phonetic Extensions"](j)||St.Katakana(j)||St["Vertical Forms"](j)||St["Yi Radicals"](j)||St["Yi Syllables"](j)));(fv[Q]||le||K.imageName)&&T.push(Dm($+1,N,M,T,pv(Q,s.getCharCode($+1),le&&A),!1))}}var j;return Rm(Dm(s.length(),N,M,T,0,!0))}function kf(s){let i=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:i,verticalAlign:c}}function mv(s,i,c,d,g){if(!d&&!g)return;const w=s[c],x=(s[c].x+w.metrics.advance*w.scale)*d;for(let T=i;T<=c;T++)s[T].x-=x,s[T].y+=g}function gv(s,i,c){const{horizontalAlign:d,verticalAlign:g}=kf(c),w=i[0]-s.displaySize[0]*d,x=i[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function Bm(s,i,c,d,g,w){const x=s.image;let T;if(x.content){const ge=x.content,xe=x.pixelRatio||1;T=[ge[0]/xe,ge[1]/xe,x.displaySize[0]-ge[2]/xe,x.displaySize[1]-ge[3]/xe]}const M=i.left*w,A=i.right*w;let N,j,$,K;c==="width"||c==="both"?(K=g[0]+M-d[3],j=g[0]+A+d[1]):(K=g[0]+(M+A-x.displaySize[0])/2,j=K+x.displaySize[0]);const Q=i.top*w,le=i.bottom*w;return c==="height"||c==="both"?(N=g[1]+Q-d[0],$=g[1]+le+d[2]):(N=g[1]+(Q+le-x.displaySize[1])/2,$=N+x.displaySize[1]),{image:x,top:N,right:j,bottom:$,left:K,collisionPadding:T}}const eu=255,Jo=128,Ws=eu*Jo;function Fm(s,i){const{expression:c}=i;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Yi(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let w=0;for(;w<d.length&&d[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<d.length&&d[x]<s+1;)x++;x=Math.min(d.length-1,x);const T=d[w],M=d[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:M,minSize:c.evaluate(new Yi(T)),maxSize:c.evaluate(new Yi(M)),interpolationType:g}}}function Sf(s,i,c){let d="never";const g=s.get(i);return g?d=g:s.get(c)&&(d="always"),d}const _v=Zs.VectorTileFeature.types,yv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zh(s,i,c,d,g,w,x,T,M,A,N,j,$){const K=T?Math.min(Ws,Math.round(T[0])):0,Q=T?Math.min(Ws,Math.round(T[1])):0;s.emplaceBack(i,c,Math.round(32*d),Math.round(32*g),w,x,(K<<1)+(M?1:0),Q,16*A,16*N,256*j,256*$)}function Tf(s,i,c){s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c)}function vv(s){for(const i of s.sections)if(tf(i.text))return!0;return!1}class Ef{constructor(i){this.layoutVertexArray=new Ze,this.indexArray=new Xe,this.programConfigurations=i,this.segments=new _t,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new De,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,c,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,K1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,J1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,yv,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Lt("SymbolBuffers",Ef);class Cf{constructor(i,c,d){this.layoutVertexArray=new i,this.layoutAttributes=c,this.indexArray=new d,this.segments=new _t,this.collisionVertexArray=new He}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Y1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Lt("CollisionBuffers",Cf);class zl{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rf([]),this.placementViewportMatrix=rf([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fm(this.zoom,c["text-size"]),this.iconSizeData=Fm(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),w=d.get("symbol-z-order");this.canOverlap=Sf(d,"text-overlap","text-allow-overlap")!=="never"||Sf(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(x=>f.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new Ef(new on(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Ef(new on(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new v,this.lineVertexArray=new E,this.symbolInstances=new m,this.textAnchorOffsets=new L}calculateGlyphDependencies(i,c,d,g,w){for(let x=0;x<i.length;x++)if(c[i.charCodeAt(x)]=!0,(d||g)&&w){const T=Jc[i.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(i,c,d){const g=this.layers[0],w=g.layout,x=w.get("text-font"),T=w.get("text-field"),M=w.get("icon-image"),A=(T.value.kind!=="constant"||T.value.value instanceof Pr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),N=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,j=w.get("symbol-sort-key");if(this.features=[],!A&&!N)return;const $=c.iconDependencies,K=c.glyphDependencies,Q=c.availableImages,le=new Yi(this.zoom);for(const{feature:ge,id:xe,index:Fe,sourceLayerIndex:Se}of i){const ze=g._featureFilter.needGeometry,Ye=fs(ge,ze);if(!g._featureFilter.filter(le,Ye,d))continue;let tt,Ct;if(ze||(Ye.geometry=ds(ge)),A){const Tt=g.getValueAndResolveTokens("text-field",Ye,d,Q),wt=Pr.factory(Tt),mt=this.hasRTLText=this.hasRTLText||vv(wt);(!mt||$o.getRTLTextPluginStatus()==="unavailable"||mt&&$o.isParsed())&&(tt=ev(wt,g,Ye))}if(N){const Tt=g.getValueAndResolveTokens("icon-image",Ye,d,Q);Ct=Tt instanceof Hr?Tt:Hr.fromString(Tt)}if(!tt&&!Ct)continue;const Bt=this.sortFeaturesByKey?j.evaluate(Ye,{},d):void 0;if(this.features.push({id:xe,text:tt,icon:Ct,index:Fe,sourceLayerIndex:Se,geometry:Ye.geometry,properties:ge.properties,type:_v[ge.type],sortKey:Bt}),Ct&&($[Ct.name]=!0),tt){const Tt=x.evaluate(Ye,{},d).join(","),wt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ah.vertical)>=0;for(const mt of tt.sections)if(mt.image)$[mt.image.name]=!0;else{const Dt=Vs(tt.toString()),vt=mt.fontStack||Tt,at=K[vt]=K[vt]||{};this.calculateGlyphDependencies(mt.text,at,wt,this.allowVerticalPlacement,Dt)}}}w.get("symbol-placement")==="line"&&(this.features=function(ge){const xe={},Fe={},Se=[];let ze=0;function Ye(Tt){Se.push(ge[Tt]),ze++}function tt(Tt,wt,mt){const Dt=Fe[Tt];return delete Fe[Tt],Fe[wt]=Dt,Se[Dt].geometry[0].pop(),Se[Dt].geometry[0]=Se[Dt].geometry[0].concat(mt[0]),Dt}function Ct(Tt,wt,mt){const Dt=xe[wt];return delete xe[wt],xe[Tt]=Dt,Se[Dt].geometry[0].shift(),Se[Dt].geometry[0]=mt[0].concat(Se[Dt].geometry[0]),Dt}function Bt(Tt,wt,mt){const Dt=mt?wt[0][wt[0].length-1]:wt[0][0];return`${Tt}:${Dt.x}:${Dt.y}`}for(let Tt=0;Tt<ge.length;Tt++){const wt=ge[Tt],mt=wt.geometry,Dt=wt.text?wt.text.toString():null;if(!Dt){Ye(Tt);continue}const vt=Bt(Dt,mt),at=Bt(Dt,mt,!0);if(vt in Fe&&at in xe&&Fe[vt]!==xe[at]){const Wt=Ct(vt,at,mt),Nt=tt(vt,at,Se[Wt].geometry);delete xe[vt],delete Fe[at],Fe[Bt(Dt,Se[Nt].geometry,!0)]=Nt,Se[Wt].geometry=null}else vt in Fe?tt(vt,at,mt):at in xe?Ct(vt,at,mt):(Ye(Tt),xe[vt]=ze-1,Fe[at]=ze-1)}return Se.filter(Tt=>Tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,xe)=>ge.sortKey-xe.sortKey)}update(i,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(i,c,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,c){const d=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(c[i.segment+1]),w=i.dist(c[i.segment]);const x={};for(let T=i.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=i.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:w},T>0&&(w+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const M=x[T];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,c,d,g,w,x,T,M,A,N,j,$){const K=i.indexArray,Q=i.layoutVertexArray,le=i.segments.prepareSegment(4*c.length,Q,K,this.canOverlap?x.sortKey:void 0),ge=this.glyphOffsetArray.length,xe=le.vertexLength,Fe=this.allowVerticalPlacement&&T===f.ah.vertical?Math.PI/2:0,Se=x.text&&x.text.sections;for(let ze=0;ze<c.length;ze++){const{tl:Ye,tr:tt,bl:Ct,br:Bt,tex:Tt,pixelOffsetTL:wt,pixelOffsetBR:mt,minFontScaleX:Dt,minFontScaleY:vt,glyphOffset:at,isSDF:Wt,sectionIndex:Nt}=c[ze],mi=le.vertexLength,$i=at[1];Zh(Q,M.x,M.y,Ye.x,$i+Ye.y,Tt.x,Tt.y,d,Wt,wt.x,wt.y,Dt,vt),Zh(Q,M.x,M.y,tt.x,$i+tt.y,Tt.x+Tt.w,Tt.y,d,Wt,mt.x,wt.y,Dt,vt),Zh(Q,M.x,M.y,Ct.x,$i+Ct.y,Tt.x,Tt.y+Tt.h,d,Wt,wt.x,mt.y,Dt,vt),Zh(Q,M.x,M.y,Bt.x,$i+Bt.y,Tt.x+Tt.w,Tt.y+Tt.h,d,Wt,mt.x,mt.y,Dt,vt),Tf(i.dynamicLayoutVertexArray,M,Fe),K.emplaceBack(mi,mi+1,mi+2),K.emplaceBack(mi+1,mi+2,mi+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),ze!==c.length-1&&Nt===c[ze+1].sectionIndex||i.programConfigurations.populatePaintArrays(Q.length,x,x.index,{},$,Se&&Se[Nt])}i.placedSymbolArray.emplaceBack(M.x,M.y,ge,this.glyphOffsetArray.length-ge,xe,A,N,M.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],T,0,!1,0,j)}_addCollisionDebugVertex(i,c,d,g,w,x){return c.emplaceBack(0,0),i.emplaceBack(d.x,d.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,c,d,g,w,x,T){const M=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),A=M.vertexLength,N=w.layoutVertexArray,j=w.collisionVertexArray,$=T.anchorX,K=T.anchorY;this._addCollisionDebugVertex(N,j,x,$,K,new S(i,c)),this._addCollisionDebugVertex(N,j,x,$,K,new S(d,c)),this._addCollisionDebugVertex(N,j,x,$,K,new S(d,g)),this._addCollisionDebugVertex(N,j,x,$,K,new S(i,g)),M.vertexLength+=4;const Q=w.indexArray;Q.emplaceBack(A,A+1),Q.emplaceBack(A+1,A+2),Q.emplaceBack(A+2,A+3),Q.emplaceBack(A+3,A),M.primitiveLength+=4}addDebugCollisionBoxes(i,c,d,g){for(let w=i;w<c;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cf(We,wm.members,nt),this.iconCollisionBox=new Cf(We,wm.members,nt);for(let i=0;i<this.symbolInstances.length;i++){const c=this.symbolInstances.get(i);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(i,c,d,g,w,x,T,M,A){const N={};for(let j=c;j<d;j++){const $=i.get(j);N.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},N.textFeatureIndex=$.featureIndex;break}for(let j=g;j<w;j++){const $=i.get(j);N.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},N.verticalTextFeatureIndex=$.featureIndex;break}for(let j=x;j<T;j++){const $=i.get(j);N.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},N.iconFeatureIndex=$.featureIndex;break}for(let j=M;j<A;j++){const $=i.get(j);N.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},N.verticalIconFeatureIndex=$.featureIndex;break}return N}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,c){const d=i.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let w=d.vertexStartIndex;w<g;w+=4)i.indexArray.emplaceBack(w,w+1,w+2),i.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(i),d=Math.cos(i),g=[],w=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const M=this.symbolInstances.get(T);g.push(0|Math.round(c*M.anchorX+d*M.anchorY)),w.push(M.featureIndex)}return x.sort((T,M)=>g[T]-g[M]||w[M]-w[T]),x}addToSortKeyRanges(i,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Om,Nm;Lt("SymbolBucket",zl,{omit:["layers","collisionBoxArray","features","compareText"]}),zl.MAX_GLYPHS=65535,zl.addDynamicAttributes=Tf;var Mf={get paint(){return Nm=Nm||new wr({"icon-opacity":new $t(we.paint_symbol["icon-opacity"]),"icon-color":new $t(we.paint_symbol["icon-color"]),"icon-halo-color":new $t(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(we.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new $t(we.paint_symbol["text-opacity"]),"text-color":new $t(we.paint_symbol["text-color"],{runtimeType:qi,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new $t(we.paint_symbol["text-halo-color"]),"text-halo-width":new $t(we.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(we.paint_symbol["text-halo-blur"]),"text-translate":new jt(we.paint_symbol["text-translate"]),"text-translate-anchor":new jt(we.paint_symbol["text-translate-anchor"])})},get layout(){return Om=Om||new wr({"symbol-placement":new jt(we.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(we.layout_symbol["icon-size"]),"icon-text-fit":new jt(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(we.layout_symbol["icon-image"]),"icon-rotate":new $t(we.layout_symbol["icon-rotate"]),"icon-padding":new $t(we.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(we.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(we.layout_symbol["icon-offset"]),"icon-anchor":new $t(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(we.layout_symbol["text-rotation-alignment"]),"text-field":new $t(we.layout_symbol["text-field"]),"text-font":new $t(we.layout_symbol["text-font"]),"text-size":new $t(we.layout_symbol["text-size"]),"text-max-width":new $t(we.layout_symbol["text-max-width"]),"text-line-height":new jt(we.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(we.layout_symbol["text-letter-spacing"]),"text-justify":new $t(we.layout_symbol["text-justify"]),"text-radial-offset":new $t(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new $t(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new $t(we.layout_symbol["text-anchor"]),"text-max-angle":new jt(we.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(we.layout_symbol["text-writing-mode"]),"text-rotate":new $t(we.layout_symbol["text-rotate"]),"text-padding":new jt(we.layout_symbol["text-padding"]),"text-keep-upright":new jt(we.layout_symbol["text-keep-upright"]),"text-transform":new $t(we.layout_symbol["text-transform"]),"text-offset":new $t(we.layout_symbol["text-offset"]),"text-allow-overlap":new jt(we.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(we.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(we.layout_symbol["text-ignore-placement"]),"text-optional":new jt(we.layout_symbol["text-optional"])})}};class jm{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Vi,this.defaultValue=i}evaluate(i){if(i.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(i.formattedSection))return c.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt("FormatSectionOverride",jm,{omit:["defaultValue"]});class Gh extends ro{constructor(i){super(i,Mf)}recalculate(i,c){if(super.recalculate(i,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const w of d)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,c,d,g){const w=this.layout.get(i).evaluate(c,{},d,g),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||Zi(x.value)||!w?w:function(T,M){return M.replace(/{([^{}]+)}/g,(A,N)=>T&&N in T?String(T[N]):"")}(c.properties,w)}createBucket(i){return new zl(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Mf.paint.overridableProperties){if(!Gh.hasPaintOverride(this.layout,i))continue;const c=this.paint.get(i),d=new jm(c),g=new Wi(d,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new il("source",g):new _c("composite",g,c.value.zoomStops),this.paint._values[i]=new no(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(i,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&Gh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,c){const d=i.get("text-field"),g=Mf.paint.properties[c];let w=!1;const x=T=>{for(const M of T)if(g.overrides&&g.overrides.hasOverride(M))return void(w=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Pr)x(d.value.value.sections);else if(d.value.kind==="source"){const T=A=>{w||(A instanceof Vo&&In(A.value)===ln?x(A.value.sections):A instanceof el?x(A.sections):A.eachChild(T))},M=d.value;M._styleExpression&&T(M._styleExpression.expression)}return w}}let Um;var bv={get paint(){return Um=Um||new wr({"background-color":new jt(we.paint_background["background-color"]),"background-pattern":new ka(we.paint_background["background-pattern"]),"background-opacity":new jt(we.paint_background["background-opacity"])})}};class wv extends ro{constructor(i){super(i,bv)}}let Vm;var xv={get paint(){return Vm=Vm||new wr({"raster-opacity":new jt(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(we.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(we.paint_raster["raster-saturation"]),"raster-contrast":new jt(we.paint_raster["raster-contrast"]),"raster-resampling":new jt(we.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(we.paint_raster["raster-fade-duration"])})}};class kv extends ro{constructor(i){super(i,xv)}}class Sv extends ro{constructor(i){super(i,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Tv{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const If=63710088e-1;class $s{constructor(i,c){if(isNaN(i)||isNaN(c))throw new Error(`Invalid LngLat object: (${i}, ${c})`);if(this.lng=+i,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $s(re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const c=Math.PI/180,d=this.lat*c,g=i.lat*c,w=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((i.lng-this.lng)*c);return If*Math.acos(Math.min(w,1))}static convert(i){if(i instanceof $s)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new $s(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new $s(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const qm=2*Math.PI*If;function Zm(s){return qm*Math.cos(s*Math.PI/180)}function Gm(s){return(180+s)/360}function Wm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function $m(s,i){return s/Zm(i)}function Lf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Wh{constructor(i,c,d=0){this.x=+i,this.y=+c,this.z=+d}static fromLngLat(i,c=0){const d=$s.convert(i);return new Wh(Gm(d.lng),Wm(d.lat),$m(c,d.lat))}toLngLat(){return new $s(360*this.x-180,Lf(this.y))}toAltitude(){return this.z*Zm(Lf(this.y))}meterInMercatorCoordinateUnits(){return 1/qm*(i=Lf(this.y),1/Math.cos(i*Math.PI/180));var i}}function Hm(s,i,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[s*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}class Af{constructor(i,c,d){if(i<0||i>25||d<0||d>=Math.pow(2,i)||c<0||c>=Math.pow(2,i))throw new Error(`x=${c}, y=${d}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=c,this.y=d,this.key=tu(0,i,i,c,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,c,d){const g=(x=this.y,T=this.z,M=Hm(256*(w=this.x),256*(x=Math.pow(2,T)-x-1),T),A=Hm(256*(w+1),256*(x+1),T),M[0]+","+M[1]+","+A[0]+","+A[1]);var w,x,T,M,A;const N=function(j,$,K){let Q,le="";for(let ge=j;ge>0;ge--)Q=1<<ge-1,le+=($&Q?1:0)+(K&Q?2:0);return le}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const c=this.z-i.z;return c>0&&i.x===this.x>>c&&i.y===this.y>>c}getTilePoint(i){const c=Math.pow(2,this.z);return new S((i.x*c-this.x)*_n,(i.y*c-this.y)*_n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xm{constructor(i,c){this.wrap=i,this.canonical=c,this.key=tu(i,c.z,c.z,c.x,c.y)}}class so{constructor(i,c,d,g,w){if(i<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${d}`);this.overscaledZ=i,this.wrap=c,this.canonical=new Af(d,+g,+w),this.key=tu(c,i,d,g,w)}clone(){return new so(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-i;return i>this.canonical.z?new so(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new so(i,this.wrap,i,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(i,c){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-i;return i>this.canonical.z?tu(this.wrap*+c,i,this.canonical.z,this.canonical.x,this.canonical.y):tu(this.wrap*+c,i,i,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const c=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>c&&i.canonical.y===this.canonical.y>>c}children(i){if(this.overscaledZ>=i)return[new so(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new so(c,this.wrap,c,d,g),new so(c,this.wrap,c,d+1,g),new so(c,this.wrap,c,d,g+1),new so(c,this.wrap,c,d+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new so(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new so(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Wh(i.x-this.wrap,i.y))}}function tu(s,i,c,d,g){(s*=2)<0&&(s=-1*s-1);const w=1<<c;return(w*w*s+w*g+d).toString(36)+c.toString(36)+i.toString(36)}Lt("CanonicalTileID",Af),Lt("OverscaledTileID",so,{omit:["posMatrix"]});class Km{constructor(i,c,d,g=1,w=1,x=1,T=0){if(this.uid=i,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void Ke(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const M=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<M;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(M,A)]=this.data[this._idx(M-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,M)]=this.data[this._idx(A,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<M;A++)for(let N=0;N<M;N++){const j=this.get(A,N);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(i,c){const d=new Uint8Array(this.data.buffer),g=4*this._idx(i,c);return this.unpack(d[g],d[g+1],d[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,c){if(i<-1||i>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(i+1)}unpack(i,c,d){return i*this.redFactor+c*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new oo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,c,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,w=c*this.dim+this.dim,x=d*this.dim,T=d*this.dim+this.dim;switch(c){case-1:g=w-1;break;case 1:w=g+1}switch(d){case-1:x=T-1;break;case 1:T=x+1}const M=-c*this.dim,A=-d*this.dim;for(let N=x;N<T;N++)for(let j=g;j<w;j++)this.data[this._idx(j,N)]=i.data[this._idx(j+M,N+A)]}}Lt("DEMData",Km);class Jm{constructor(i){this._stringToNumber={},this._numberToString=[];for(let c=0;c<i.length;c++){const d=i[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Ym{constructor(i,c,d,g,w){this.type="Feature",this._vectorTileFeature=i,i._z=c,i._x=d,i._y=g,this.properties=i.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(i[c]=this[c]);return i}}class Qm{constructor(i,c){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new ba(_n,16,0),this.grid3D=new ba(_n,16,0),this.featureIndexArray=new V,this.promoteId=c}insert(i,c,d,g,w,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,w);const M=x?this.grid3D:this.grid;for(let A=0;A<c.length;A++){const N=c[A],j=[1/0,1/0,-1/0,-1/0];for(let $=0;$<N.length;$++){const K=N[$];j[0]=Math.min(j[0],K.x),j[1]=Math.min(j[1],K.y),j[2]=Math.max(j[2],K.x),j[3]=Math.max(j[3],K.y)}j[0]<_n&&j[1]<_n&&j[2]>=0&&j[3]>=0&&M.insert(T,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Zs.VectorTile(new vf(this.rawTileData)).layers,this.sourceLayerCoder=new Jm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,c,d,g){this.loadVTLayers();const w=i.params||{},x=_n/i.tileSize/i.scale,T=sl(w.filter),M=i.queryGeometry,A=i.queryPadding*x,N=tg(M),j=this.grid.query(N.minX-A,N.minY-A,N.maxX+A,N.maxY+A),$=tg(i.cameraQueryGeometry),K=this.grid3D.query($.minX-A,$.minY-A,$.maxX+A,$.maxY+A,(ge,xe,Fe,Se)=>function(ze,Ye,tt,Ct,Bt){for(const wt of ze)if(Ye<=wt.x&&tt<=wt.y&&Ct>=wt.x&&Bt>=wt.y)return!0;const Tt=[new S(Ye,tt),new S(Ye,Bt),new S(Ct,Bt),new S(Ct,tt)];if(ze.length>2){for(const wt of Tt)if(El(ze,wt))return!0}for(let wt=0;wt<ze.length-1;wt++)if(n1(ze[wt],ze[wt+1],Tt))return!0;return!1}(i.cameraQueryGeometry,ge-A,xe-A,Fe+A,Se+A));for(const ge of K)j.push(ge);j.sort(Ev);const Q={};let le;for(let ge=0;ge<j.length;ge++){const xe=j[ge];if(xe===le)continue;le=xe;const Fe=this.featureIndexArray.get(xe);let Se=null;this.loadMatchingFeature(Q,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,T,w.layers,w.availableImages,c,d,g,(ze,Ye,tt)=>(Se||(Se=ds(ze)),Ye.queryIntersectsFeature(M,ze,tt,Se,this.z,i.transform,x,i.pixelPosMatrix)))}return Q}loadMatchingFeature(i,c,d,g,w,x,T,M,A,N,j){const $=this.bucketLayerIDs[c];if(x&&!function(ge,xe){for(let Fe=0;Fe<ge.length;Fe++)if(xe.indexOf(ge[Fe])>=0)return!0;return!1}(x,$))return;const K=this.sourceLayerCoder.decode(d),Q=this.vtLayers[K].feature(g);if(w.needGeometry){const ge=fs(Q,!0);if(!w.filter(new Yi(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!w.filter(new Yi(this.tileID.overscaledZ),Q))return;const le=this.getId(Q,K);for(let ge=0;ge<$.length;ge++){const xe=$[ge];if(x&&x.indexOf(xe)<0)continue;const Fe=M[xe];if(!Fe)continue;let Se={};le&&N&&(Se=N.getState(Fe.sourceLayer||"_geojsonTileLayer",le));const ze=H({},A[xe]);ze.paint=eg(ze.paint,Fe.paint,Q,Se,T),ze.layout=eg(ze.layout,Fe.layout,Q,Se,T);const Ye=!j||j(Q,Fe,Se);if(!Ye)continue;const tt=new Ym(Q,this.z,this.x,this.y,le);tt.layer=ze;let Ct=i[xe];Ct===void 0&&(Ct=i[xe]=[]),Ct.push({featureIndex:g,feature:tt,intersectionZ:Ye})}}lookupSymbolFeatures(i,c,d,g,w,x,T,M){const A={};this.loadVTLayers();const N=sl(w);for(const j of i)this.loadMatchingFeature(A,d,g,j,N,x,T,M,c);return A}hasLayer(i){for(const c of this.bucketLayerIDs)for(const d of c)if(i===d)return!0;return!1}getId(i,c){let d=i.id;return this.promoteId&&(d=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function eg(s,i,c,d,g){return ve(s,(w,x)=>{const T=i instanceof xa?i.get(x):null;return T&&T.evaluate?T.evaluate(c,d,g):T})}function tg(s){let i=1/0,c=1/0,d=-1/0,g=-1/0;for(const w of s)i=Math.min(i,w.x),c=Math.min(c,w.y),d=Math.max(d,w.x),g=Math.max(g,w.y);return{minX:i,minY:c,maxX:d,maxY:g}}function Ev(s,i){return i-s}function ig(s,i,c,d,g){const w=[];for(let x=0;x<s.length;x++){const T=s[x];let M;for(let A=0;A<T.length-1;A++){let N=T[A],j=T[A+1];N.x<i&&j.x<i||(N.x<i?N=new S(i,N.y+(i-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x<i&&(j=new S(i,N.y+(i-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y<c&&j.y<c||(N.y<c?N=new S(N.x+(c-N.y)/(j.y-N.y)*(j.x-N.x),c)._round():j.y<c&&(j=new S(N.x+(c-N.y)/(j.y-N.y)*(j.x-N.x),c)._round()),N.x>=d&&j.x>=d||(N.x>=d?N=new S(d,N.y+(d-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x>=d&&(j=new S(d,N.y+(d-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y>=g&&j.y>=g||(N.y>=g?N=new S(N.x+(g-N.y)/(j.y-N.y)*(j.x-N.x),g)._round():j.y>=g&&(j=new S(N.x+(g-N.y)/(j.y-N.y)*(j.x-N.x),g)._round()),M&&N.equals(M[M.length-1])||(M=[N],w.push(M)),M.push(j)))))}}return w}Lt("FeatureIndex",Qm,{omit:["rawTileData","sourceLayerCoder"]});class Hs extends S{constructor(i,c,d,g){super(i,c),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new Hs(this.x,this.y,this.angle,this.segment)}}function ng(s,i,c,d,g){if(i.segment===void 0||c===0)return!0;let w=i,x=i.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=s[x].dist(w),w=s[x]}T+=s[x].dist(s[x+1]),x++;const M=[];let A=0;for(;T<c/2;){const N=s[x],j=s[x+1];if(!j)return!1;let $=s[x-1].angleTo(N)-N.angleTo(j);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:T,angleDelta:$}),A+=$;T-M[0].distance>d;)A-=M.shift().angleDelta;if(A>g)return!1;x++,T+=N.dist(j)}return!0}function rg(s){let i=0;for(let c=0;c<s.length-1;c++)i+=s[c].dist(s[c+1]);return i}function og(s,i,c){return s?.6*i*c:0}function sg(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function Cv(s,i,c,d,g,w){const x=og(c,g,w),T=sg(c,d)*w;let M=0;const A=rg(s)/2;for(let N=0;N<s.length-1;N++){const j=s[N],$=s[N+1],K=j.dist($);if(M+K>A){const Q=(A-M)/K,le=cr.number(j.x,$.x,Q),ge=cr.number(j.y,$.y,Q),xe=new Hs(le,ge,$.angleTo(j),N);return xe._round(),!x||ng(s,xe,T,x,i)?xe:void 0}M+=K}}function Mv(s,i,c,d,g,w,x,T,M){const A=og(d,w,x),N=sg(d,g),j=N*x,$=s[0].x===0||s[0].x===M||s[0].y===0||s[0].y===M;return i-j<i/4&&(i=j+i/4),ag(s,$?i/2*T%i:(N/2+2*w)*x*T%i,i,A,c,j,$,!1,M)}function ag(s,i,c,d,g,w,x,T,M){const A=w/2,N=rg(s);let j=0,$=i-c,K=[];for(let Q=0;Q<s.length-1;Q++){const le=s[Q],ge=s[Q+1],xe=le.dist(ge),Fe=ge.angleTo(le);for(;$+c<j+xe;){$+=c;const Se=($-j)/xe,ze=cr.number(le.x,ge.x,Se),Ye=cr.number(le.y,ge.y,Se);if(ze>=0&&ze<M&&Ye>=0&&Ye<M&&$-A>=0&&$+A<=N){const tt=new Hs(ze,Ye,Fe,Q);tt._round(),d&&!ng(s,tt,w,d,g)||K.push(tt)}}j+=xe}return T||K.length||x||(K=ag(s,j/2,c,d,g,w,x,!0,M)),K}Lt("Anchor",Hs);const Dl=Fr;function lg(s,i,c,d){const g=[],w=s.image,x=w.pixelRatio,T=w.paddedRect.w-2*Dl,M=w.paddedRect.h-2*Dl,A=s.right-s.left,N=s.bottom-s.top,j=w.stretchX||[[0,T]],$=w.stretchY||[[0,M]],K=(mt,Dt)=>mt+Dt[1]-Dt[0],Q=j.reduce(K,0),le=$.reduce(K,0),ge=T-Q,xe=M-le;let Fe=0,Se=Q,ze=0,Ye=le,tt=0,Ct=ge,Bt=0,Tt=xe;if(w.content&&d){const mt=w.content;Fe=$h(j,0,mt[0]),ze=$h($,0,mt[1]),Se=$h(j,mt[0],mt[2]),Ye=$h($,mt[1],mt[3]),tt=mt[0]-Fe,Bt=mt[1]-ze,Ct=mt[2]-mt[0]-Se,Tt=mt[3]-mt[1]-Ye}const wt=(mt,Dt,vt,at)=>{const Wt=Hh(mt.stretch-Fe,Se,A,s.left),Nt=Xh(mt.fixed-tt,Ct,mt.stretch,Q),mi=Hh(Dt.stretch-ze,Ye,N,s.top),$i=Xh(Dt.fixed-Bt,Tt,Dt.stretch,le),en=Hh(vt.stretch-Fe,Se,A,s.left),Un=Xh(vt.fixed-tt,Ct,vt.stretch,Q),Jr=Hh(at.stretch-ze,Ye,N,s.top),kr=Xh(at.fixed-Bt,Tt,at.stretch,le),zn=new S(Wt,mi),Jn=new S(en,mi),rr=new S(en,Jr),Sr=new S(Wt,Jr),Tr=new S(Nt/x,$i/x),Vn=new S(Un/x,kr/x),qn=i*Math.PI/180;if(qn){const dr=Math.sin(qn),Or=Math.cos(qn),Nr=[Or,-dr,dr,Or];zn._matMult(Nr),Jn._matMult(Nr),Sr._matMult(Nr),rr._matMult(Nr)}const hr=mt.stretch+mt.fixed,Er=Dt.stretch+Dt.fixed;return{tl:zn,tr:Jn,bl:Sr,br:rr,tex:{x:w.paddedRect.x+Dl+hr,y:w.paddedRect.y+Dl+Er,w:vt.stretch+vt.fixed-hr,h:at.stretch+at.fixed-Er},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Tr,pixelOffsetBR:Vn,minFontScaleX:Ct/x/A,minFontScaleY:Tt/x/N,isSDF:c}};if(d&&(w.stretchX||w.stretchY)){const mt=cg(j,ge,Q),Dt=cg($,xe,le);for(let vt=0;vt<mt.length-1;vt++){const at=mt[vt],Wt=mt[vt+1];for(let Nt=0;Nt<Dt.length-1;Nt++)g.push(wt(at,Dt[Nt],Wt,Dt[Nt+1]))}}else g.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:M+1}));return g}function $h(s,i,c){let d=0;for(const g of s)d+=Math.max(i,Math.min(c,g[1]))-Math.max(i,Math.min(c,g[0]));return d}function cg(s,i,c){const d=[{fixed:-Dl,stretch:0}];for(const[g,w]of s){const x=d[d.length-1];d.push({fixed:g-x.stretch,stretch:x.stretch}),d.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return d.push({fixed:i+Dl,stretch:c}),d}function Hh(s,i,c,d){return s/i*c+d}function Xh(s,i,c,d){return s-i*c/d}class Kh{constructor(i,c,d,g,w,x,T,M,A,N){if(this.boxStartIndex=i.length,A){let j=x.top,$=x.bottom;const K=x.collisionPadding;K&&(j-=K[1],$+=K[3]);let Q=$-j;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{let j=x.top*T-M[0],$=x.bottom*T+M[2],K=x.left*T-M[3],Q=x.right*T+M[1];const le=x.collisionPadding;if(le&&(K-=le[0]*T,j-=le[1]*T,Q+=le[2]*T,$+=le[3]*T),N){const ge=new S(K,j),xe=new S(Q,j),Fe=new S(K,$),Se=new S(Q,$),ze=N*Math.PI/180;ge._rotate(ze),xe._rotate(ze),Fe._rotate(ze),Se._rotate(ze),K=Math.min(ge.x,xe.x,Fe.x,Se.x),Q=Math.max(ge.x,xe.x,Fe.x,Se.x),j=Math.min(ge.y,xe.y,Fe.y,Se.y),$=Math.max(ge.y,xe.y,Fe.y,Se.y)}i.emplaceBack(c.x,c.y,K,j,Q,$,d,g,w)}this.boxEndIndex=i.length}}class Iv{constructor(i=[],c=Lv){if(this.data=i,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:c,compare:d}=this,g=c[i];for(;i>0;){const w=i-1>>1,x=c[w];if(d(g,x)>=0)break;c[i]=x,i=w}c[i]=g}_down(i){const{data:c,compare:d}=this,g=this.length>>1,w=c[i];for(;i<g;){let x=1+(i<<1),T=c[x];const M=x+1;if(M<this.length&&d(c[M],T)<0&&(x=M,T=c[M]),d(T,w)>=0)break;c[i]=T,i=x}c[i]=w}}function Lv(s,i){return s<i?-1:s>i?1:0}function Av(s,i=1,c=!1){let d=1/0,g=1/0,w=-1/0,x=-1/0;const T=s[0];for(let K=0;K<T.length;K++){const Q=T[K];(!K||Q.x<d)&&(d=Q.x),(!K||Q.y<g)&&(g=Q.y),(!K||Q.x>w)&&(w=Q.x),(!K||Q.y>x)&&(x=Q.y)}const M=Math.min(w-d,x-g);let A=M/2;const N=new Iv([],Pv);if(M===0)return new S(d,g);for(let K=d;K<w;K+=M)for(let Q=g;Q<x;Q+=M)N.push(new Rl(K+A,Q+A,A,s));let j=function(K){let Q=0,le=0,ge=0;const xe=K[0];for(let Fe=0,Se=xe.length,ze=Se-1;Fe<Se;ze=Fe++){const Ye=xe[Fe],tt=xe[ze],Ct=Ye.x*tt.y-tt.x*Ye.y;le+=(Ye.x+tt.x)*Ct,ge+=(Ye.y+tt.y)*Ct,Q+=3*Ct}return new Rl(le/Q,ge/Q,0,K)}(s),$=N.length;for(;N.length;){const K=N.pop();(K.d>j.d||!j.d)&&(j=K,c&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,$)),K.max-j.d<=i||(A=K.h/2,N.push(new Rl(K.p.x-A,K.p.y-A,A,s)),N.push(new Rl(K.p.x+A,K.p.y-A,A,s)),N.push(new Rl(K.p.x-A,K.p.y+A,A,s)),N.push(new Rl(K.p.x+A,K.p.y+A,A,s)),$+=4)}return c&&(console.log(`num probes: ${$}`),console.log(`best distance: ${j.d}`)),j.p}function Pv(s,i){return i.max-s.max}function Rl(s,i,c,d){this.p=new S(s,i),this.h=c,this.d=function(g,w){let x=!1,T=1/0;for(let M=0;M<w.length;M++){const A=w[M];for(let N=0,j=A.length,$=j-1;N<j;$=N++){const K=A[N],Q=A[$];K.y>g.y!=Q.y>g.y&&g.x<(Q.x-K.x)*(g.y-K.y)/(Q.y-K.y)+K.x&&(x=!x),T=Math.min(T,Wp(g,K,Q))}}return(x?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var nr;f.ap=void 0,(nr=f.ap||(f.ap={}))[nr.center=1]="center",nr[nr.left=2]="left",nr[nr.right=3]="right",nr[nr.top=4]="top",nr[nr.bottom=5]="bottom",nr[nr["top-left"]=6]="top-left",nr[nr["top-right"]=7]="top-right",nr[nr["bottom-left"]=8]="bottom-left",nr[nr["bottom-right"]=9]="bottom-right";const Xs=7,Pf=Number.POSITIVE_INFINITY;function ug(s,i){return i[1]!==Pf?function(c,d,g){let w=0,x=0;switch(d=Math.abs(d),g=Math.abs(g),c){case"top-right":case"top-left":case"top":x=g-Xs;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Xs}switch(c){case"top-right":case"bottom-right":case"right":w=-d;break;case"top-left":case"bottom-left":case"left":w=d}return[w,x]}(s,i[0],i[1]):function(c,d){let g=0,w=0;d<0&&(d=0);const x=d/Math.SQRT2;switch(c){case"top-right":case"top-left":w=x-Xs;break;case"bottom-right":case"bottom-left":w=-x+Xs;break;case"bottom":w=-d+Xs;break;case"top":w=d-Xs}switch(c){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=d;break;case"right":g=-d}return[g,w]}(s,i[0])}function hg(s,i,c){var d;const g=s.layout,w=(d=g.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(i,{},c);if(w){const T=w.values,M=[];for(let A=0;A<T.length;A+=2){const N=M[A]=T[A],j=T[A+1].map($=>$*jn);N.startsWith("top")?j[1]-=Xs:N.startsWith("bottom")&&(j[1]+=Xs),M[A+1]=j}return new $r(M)}const x=g.get("text-variable-anchor");if(x){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},c)*jn,Pf]:g.get("text-offset").evaluate(i,{},c).map(A=>A*jn);const M=[];for(const A of x)M.push(A,ug(A,T));return new $r(M)}return null}function zf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zv(s,i,c,d,g,w,x,T,M,A,N){let j=w.textMaxSize.evaluate(i,{});j===void 0&&(j=x);const $=s.layers[0].layout,K=$.get("icon-offset").evaluate(i,{},N),Q=fg(c.horizontal),le=x/24,ge=s.tilePixelRatio*le,xe=s.tilePixelRatio*j/24,Fe=s.tilePixelRatio*T,Se=s.tilePixelRatio*$.get("symbol-spacing"),ze=$.get("text-padding")*s.tilePixelRatio,Ye=function(at,Wt,Nt,mi=1){const $i=at.get("icon-padding").evaluate(Wt,{},Nt),en=$i&&$i.values;return[en[0]*mi,en[1]*mi,en[2]*mi,en[3]*mi]}($,i,N,s.tilePixelRatio),tt=$.get("text-max-angle")/180*Math.PI,Ct=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Bt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Tt=$.get("symbol-placement"),wt=Se/2,mt=$.get("icon-text-fit");let Dt;d&&mt!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Dt=Bm(d,c.vertical,mt,$.get("icon-text-fit-padding"),K,le)),Q&&(d=Bm(d,Q,mt,$.get("icon-text-fit-padding"),K,le)));const vt=(at,Wt)=>{Wt.x<0||Wt.x>=_n||Wt.y<0||Wt.y>=_n||function(Nt,mi,$i,en,Un,Jr,kr,zn,Jn,rr,Sr,Tr,Vn,qn,hr,Er,dr,Or,Nr,Zn,bi,fr,or,Gn,wo){const zo=Nt.addToLineVertexArray(mi,$i);let Do,ms,xo,ao,jr=0,gs=0,ru=0,_g=0,Uf=-1,Vf=-1;const _s={};let yg=dn("");if(Nt.allowVerticalPlacement&&en.vertical){const pr=zn.layout.get("text-rotate").evaluate(bi,{},Gn)+90;xo=new Kh(Jn,mi,rr,Sr,Tr,en.vertical,Vn,qn,hr,pr),kr&&(ao=new Kh(Jn,mi,rr,Sr,Tr,kr,dr,Or,hr,pr))}if(Un){const pr=zn.layout.get("icon-rotate").evaluate(bi,{}),lo=zn.layout.get("icon-text-fit")!=="none",Aa=lg(Un,pr,or,lo),Bo=kr?lg(kr,pr,or,lo):void 0;ms=new Kh(Jn,mi,rr,Sr,Tr,Un,dr,Or,!1,pr),jr=4*Aa.length;const Pa=Nt.iconSizeData;let Yo=null;Pa.kind==="source"?(Yo=[Jo*zn.layout.get("icon-size").evaluate(bi,{})],Yo[0]>Ws&&Ke(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)):Pa.kind==="composite"&&(Yo=[Jo*fr.compositeIconSizes[0].evaluate(bi,{},Gn),Jo*fr.compositeIconSizes[1].evaluate(bi,{},Gn)],(Yo[0]>Ws||Yo[1]>Ws)&&Ke(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)),Nt.addSymbols(Nt.icon,Aa,Yo,Zn,Nr,bi,f.ah.none,mi,zo.lineStartIndex,zo.lineLength,-1,Gn),Uf=Nt.icon.placedSymbolArray.length-1,Bo&&(gs=4*Bo.length,Nt.addSymbols(Nt.icon,Bo,Yo,Zn,Nr,bi,f.ah.vertical,mi,zo.lineStartIndex,zo.lineLength,-1,Gn),Vf=Nt.icon.placedSymbolArray.length-1)}const vg=Object.keys(en.horizontal);for(const pr of vg){const lo=en.horizontal[pr];if(!Do){yg=dn(lo.text);const Bo=zn.layout.get("text-rotate").evaluate(bi,{},Gn);Do=new Kh(Jn,mi,rr,Sr,Tr,lo,Vn,qn,hr,Bo)}const Aa=lo.positionedLines.length===1;if(ru+=dg(Nt,mi,lo,Jr,zn,hr,bi,Er,zo,en.vertical?f.ah.horizontal:f.ah.horizontalOnly,Aa?vg:[pr],_s,Uf,fr,Gn),Aa)break}en.vertical&&(_g+=dg(Nt,mi,en.vertical,Jr,zn,hr,bi,Er,zo,f.ah.vertical,["vertical"],_s,Vf,fr,Gn));const Bv=Do?Do.boxStartIndex:Nt.collisionBoxArray.length,Fv=Do?Do.boxEndIndex:Nt.collisionBoxArray.length,Ov=xo?xo.boxStartIndex:Nt.collisionBoxArray.length,Nv=xo?xo.boxEndIndex:Nt.collisionBoxArray.length,jv=ms?ms.boxStartIndex:Nt.collisionBoxArray.length,Uv=ms?ms.boxEndIndex:Nt.collisionBoxArray.length,Vv=ao?ao.boxStartIndex:Nt.collisionBoxArray.length,qv=ao?ao.boxEndIndex:Nt.collisionBoxArray.length;let Ro=-1;const Yh=(pr,lo)=>pr&&pr.circleDiameter?Math.max(pr.circleDiameter,lo):lo;Ro=Yh(Do,Ro),Ro=Yh(xo,Ro),Ro=Yh(ms,Ro),Ro=Yh(ao,Ro);const bg=Ro>-1?1:0;bg&&(Ro*=wo/jn),Nt.glyphOffsetArray.length>=zl.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bi.sortKey!==void 0&&Nt.addToSortKeyRanges(Nt.symbolInstances.length,bi.sortKey);const Zv=hg(zn,bi,Gn),[Gv,Wv]=function(pr,lo){const Aa=pr.length,Bo=lo==null?void 0:lo.values;if((Bo==null?void 0:Bo.length)>0)for(let Pa=0;Pa<Bo.length;Pa+=2){const Yo=Bo[Pa+1];pr.emplaceBack(f.ap[Bo[Pa]],Yo[0],Yo[1])}return[Aa,pr.length]}(Nt.textAnchorOffsets,Zv);Nt.symbolInstances.emplaceBack(mi.x,mi.y,_s.right>=0?_s.right:-1,_s.center>=0?_s.center:-1,_s.left>=0?_s.left:-1,_s.vertical||-1,Uf,Vf,yg,Bv,Fv,Ov,Nv,jv,Uv,Vv,qv,rr,ru,_g,jr,gs,bg,0,Vn,Ro,Gv,Wv)}(s,Wt,at,c,d,g,Dt,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,ge,[ze,ze,ze,ze],Ct,M,Fe,Ye,Bt,K,i,w,A,N,x)};if(Tt==="line")for(const at of ig(i.geometry,0,0,_n,_n)){const Wt=Mv(at,Se,tt,c.vertical||Q,d,24,xe,s.overscaling,_n);for(const Nt of Wt)Q&&Dv(s,Q.text,wt,Nt)||vt(at,Nt)}else if(Tt==="line-center"){for(const at of i.geometry)if(at.length>1){const Wt=Cv(at,tt,c.vertical||Q,d,24,xe);Wt&&vt(at,Wt)}}else if(i.type==="Polygon")for(const at of hf(i.geometry,0)){const Wt=Av(at,16);vt(at[0],new Hs(Wt.x,Wt.y,0))}else if(i.type==="LineString")for(const at of i.geometry)vt(at,new Hs(at[0].x,at[0].y,0));else if(i.type==="Point")for(const at of i.geometry)for(const Wt of at)vt([Wt],new Hs(Wt.x,Wt.y,0))}function dg(s,i,c,d,g,w,x,T,M,A,N,j,$,K,Q){const le=function(Fe,Se,ze,Ye,tt,Ct,Bt,Tt){const wt=Ye.layout.get("text-rotate").evaluate(Ct,{})*Math.PI/180,mt=[];for(const Dt of Se.positionedLines)for(const vt of Dt.positionedGlyphs){if(!vt.rect)continue;const at=vt.rect||{};let Wt=Im+1,Nt=!0,mi=1,$i=0;const en=(tt||Tt)&&vt.vertical,Un=vt.metrics.advance*vt.scale/2;if(Tt&&Se.verticalizable&&($i=Dt.lineOffset/2-(vt.imageName?-(jn-vt.metrics.width*vt.scale)/2:(vt.scale-1)*jn)),vt.imageName){const Zn=Bt[vt.imageName];Nt=Zn.sdf,mi=Zn.pixelRatio,Wt=Fr/mi}const Jr=tt?[vt.x+Un,vt.y]:[0,0];let kr=tt?[0,0]:[vt.x+Un+ze[0],vt.y+ze[1]-$i],zn=[0,0];en&&(zn=kr,kr=[0,0]);const Jn=vt.metrics.isDoubleResolution?2:1,rr=(vt.metrics.left-Wt)*vt.scale-Un+kr[0],Sr=(-vt.metrics.top-Wt)*vt.scale+kr[1],Tr=rr+at.w/Jn*vt.scale/mi,Vn=Sr+at.h/Jn*vt.scale/mi,qn=new S(rr,Sr),hr=new S(Tr,Sr),Er=new S(rr,Vn),dr=new S(Tr,Vn);if(en){const Zn=new S(-Un,Un-Yc),bi=-Math.PI/2,fr=jn/2-Un,or=new S(5-Yc-fr,-(vt.imageName?fr:0)),Gn=new S(...zn);qn._rotateAround(bi,Zn)._add(or)._add(Gn),hr._rotateAround(bi,Zn)._add(or)._add(Gn),Er._rotateAround(bi,Zn)._add(or)._add(Gn),dr._rotateAround(bi,Zn)._add(or)._add(Gn)}if(wt){const Zn=Math.sin(wt),bi=Math.cos(wt),fr=[bi,-Zn,Zn,bi];qn._matMult(fr),hr._matMult(fr),Er._matMult(fr),dr._matMult(fr)}const Or=new S(0,0),Nr=new S(0,0);mt.push({tl:qn,tr:hr,bl:Er,br:dr,tex:at,writingMode:Se.writingMode,glyphOffset:Jr,sectionIndex:vt.sectionIndex,isSDF:Nt,pixelOffsetTL:Or,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return mt}(0,c,T,g,w,x,d,s.allowVerticalPlacement),ge=s.textSizeData;let xe=null;ge.kind==="source"?(xe=[Jo*g.layout.get("text-size").evaluate(x,{})],xe[0]>Ws&&Ke(`${s.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)):ge.kind==="composite"&&(xe=[Jo*K.compositeTextSizes[0].evaluate(x,{},Q),Jo*K.compositeTextSizes[1].evaluate(x,{},Q)],(xe[0]>Ws||xe[1]>Ws)&&Ke(`${s.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)),s.addSymbols(s.text,le,xe,T,w,x,A,i,M.lineStartIndex,M.lineLength,$,Q);for(const Fe of N)j[Fe]=s.text.placedSymbolArray.length-1;return 4*le.length}function fg(s){for(const i in s)return s[i];return null}function Dv(s,i,c,d){const g=s.compareText;if(i in g){const w=g[i];for(let x=w.length-1;x>=0;x--)if(d.dist(w[x])<c)return!0}else g[i]=[];return g[i].push(d),!1}const pg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Df{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,d]=new Uint8Array(i,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=pg[15&d];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[T]=new Uint32Array(i,4,1);return new Df(T,x,w,i)}constructor(i,c=64,d=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const w=pg.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,T=i*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-T%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+M,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+M),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+M,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=i)}add(i,c){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=c,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Rf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,c,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:T}=this,M=[0,w.length-1,0],A=[];for(;M.length;){const N=M.pop()||0,j=M.pop()||0,$=M.pop()||0;if(j-$<=T){for(let ge=$;ge<=j;ge++){const xe=x[2*ge],Fe=x[2*ge+1];xe>=i&&xe<=d&&Fe>=c&&Fe<=g&&A.push(w[ge])}continue}const K=$+j>>1,Q=x[2*K],le=x[2*K+1];Q>=i&&Q<=d&&le>=c&&le<=g&&A.push(w[K]),(N===0?i<=Q:c<=le)&&(M.push($),M.push(K-1),M.push(1-N)),(N===0?d>=Q:g>=le)&&(M.push(K+1),M.push(j),M.push(1-N))}return A}within(i,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,T=[0,g.length-1,0],M=[],A=d*d;for(;T.length;){const N=T.pop()||0,j=T.pop()||0,$=T.pop()||0;if(j-$<=x){for(let ge=$;ge<=j;ge++)gg(w[2*ge],w[2*ge+1],i,c)<=A&&M.push(g[ge]);continue}const K=$+j>>1,Q=w[2*K],le=w[2*K+1];gg(Q,le,i,c)<=A&&M.push(g[K]),(N===0?i-d<=Q:c-d<=le)&&(T.push($),T.push(K-1),T.push(1-N)),(N===0?i+d>=Q:c+d>=le)&&(T.push(K+1),T.push(j),T.push(1-N))}return M}}function Rf(s,i,c,d,g,w){if(g-d<=c)return;const x=d+g>>1;mg(s,i,x,d,g,w),Rf(s,i,c,d,x-1,1-w),Rf(s,i,c,x+1,g,1-w)}function mg(s,i,c,d,g,w){for(;g>d;){if(g-d>600){const A=g-d+1,N=c-d+1,j=Math.log(A),$=.5*Math.exp(2*j/3),K=.5*Math.sqrt(j*$*(A-$)/A)*(N-A/2<0?-1:1);mg(s,i,c,Math.max(d,Math.floor(c-N*$/A+K)),Math.min(g,Math.floor(c+(A-N)*$/A+K)),w)}const x=i[2*c+w];let T=d,M=g;for(iu(s,i,d,c),i[2*g+w]>x&&iu(s,i,d,g);T<M;){for(iu(s,i,T,M),T++,M--;i[2*T+w]<x;)T++;for(;i[2*M+w]>x;)M--}i[2*d+w]===x?iu(s,i,d,M):(M++,iu(s,i,M,g)),M<=c&&(d=M+1),c<=M&&(g=M-1)}}function iu(s,i,c,d){Bf(s,c,d),Bf(i,2*c,2*d),Bf(i,2*c+1,2*d+1)}function Bf(s,i,c){const d=s[i];s[i]=s[c],s[c]=d}function gg(s,i,c,d){const g=s-c,w=i-d;return g*g+w*w}var Ff;f.bd=void 0,(Ff=f.bd||(f.bd={})).create="create",Ff.load="load",Ff.fullLoad="fullLoad";let Jh=null,nu=[];const Of=1e3/60,Nf="loadTime",jf="fullLoadTime",Rv={mark(s){performance.mark(s)},frame(s){const i=s;Jh!=null&&nu.push(i-Jh),Jh=i},clearMetrics(){Jh=null,nu=[],performance.clearMeasures(Nf),performance.clearMeasures(jf);for(const s in f.bd)performance.clearMarks(f.bd[s])},getPerformanceMetrics(){performance.measure(Nf,f.bd.create,f.bd.load),performance.measure(jf,f.bd.create,f.bd.fullLoad);const s=performance.getEntriesByName(Nf)[0].duration,i=performance.getEntriesByName(jf)[0].duration,c=nu.length,d=1/(nu.reduce((w,x)=>w+x,0)/c/1e3),g=nu.filter(w=>w>Of).reduce((w,x)=>w+(x-Of)/Of,0);return{loadTime:s,fullLoadTime:i,fps:d,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};f.$=_t,f.A=Cl,f.B=function(s){if(pt==null){const i=s.navigator?s.navigator.userAgent:null;pt=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return pt},f.C=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Tv(()=>this.process()),this.subscription=function(c,d,g,w){return c.addEventListener(d,g,!1),{unsubscribe:()=>{c.removeEventListener(d,g,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=bt(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((c,d)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:c,reject:d},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:js(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const i=s.data,c=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[c];const d=this.abortControllers[c];return delete this.abortControllers[c],void(d&&d.abort())}if(bt(self)||i.mustQueue)return this.tasks[c]=i,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Us(i.error)):g.resolve(Us(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Us(i.data),d=new AbortController;this.abortControllers[s]=d;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,c,d);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,c){const d=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?js(i):null,data:js(c,d)};this.target.postMessage(g,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.D=jt,f.E=xt,f.F=function(){var s=new Cl(16);return Cl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},f.G=hi,f.H=function(s,i,c){var d,g,w,x,T,M,A,N,j,$,K,Q,le=c[0],ge=c[1],xe=c[2];return i===s?(s[12]=i[0]*le+i[4]*ge+i[8]*xe+i[12],s[13]=i[1]*le+i[5]*ge+i[9]*xe+i[13],s[14]=i[2]*le+i[6]*ge+i[10]*xe+i[14],s[15]=i[3]*le+i[7]*ge+i[11]*xe+i[15]):(g=i[1],w=i[2],x=i[3],T=i[4],M=i[5],A=i[6],N=i[7],j=i[8],$=i[9],K=i[10],Q=i[11],s[0]=d=i[0],s[1]=g,s[2]=w,s[3]=x,s[4]=T,s[5]=M,s[6]=A,s[7]=N,s[8]=j,s[9]=$,s[10]=K,s[11]=Q,s[12]=d*le+T*ge+j*xe+i[12],s[13]=g*le+M*ge+$*xe+i[13],s[14]=w*le+A*ge+K*xe+i[14],s[15]=x*le+N*ge+Q*xe+i[15]),s},f.I=wf,f.J=function(s,i,c){var d=c[0],g=c[1],w=c[2];return s[0]=i[0]*d,s[1]=i[1]*d,s[2]=i[2]*d,s[3]=i[3]*d,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*w,s[9]=i[9]*w,s[10]=i[10]*w,s[11]=i[11]*w,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.K=Kp,f.L=function(s,i){const c={};for(let d=0;d<i.length;d++){const g=i[d];g in s&&(c[g]=s[g])}return c},f.M=$s,f.N=Gm,f.O=Wm,f.P=S,f.Q=so,f.R=oo,f.S=R,f.T=Cc,f.U=O,f.V=ii,f.W=_n,f.X=kn,f.Y=Wh,f.Z=class extends Lc{},f._=a,f.a=ei,f.a$=function(s,i,c){return s[0]=i[0]*c[0],s[1]=i[1]*c[1],s[2]=i[2]*c[2],s[3]=i[3]*c[3],s},f.a0=Af,f.a1=ut,f.a2=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(c=>{i.onloadstart=()=>{c(i)};for(const d of s){const g=window.document.createElement("source");ct(d)||(i.crossOrigin="Anonymous"),g.src=d,i.appendChild(g)}})},f.a3=function(){return ee++},f.a4=y,f.a5=zl,f.a6=sl,f.a7=fs,f.a8=Yi,f.a9=Ym,f.aA=ne,f.aB=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let c=[];try{if(!$e(s.version,i.version))return[{command:"setStyle",args:[i]}];$e(s.center,i.center)||c.push({command:"setCenter",args:[i.center]}),$e(s.zoom,i.zoom)||c.push({command:"setZoom",args:[i.zoom]}),$e(s.bearing,i.bearing)||c.push({command:"setBearing",args:[i.bearing]}),$e(s.pitch,i.pitch)||c.push({command:"setPitch",args:[i.pitch]}),$e(s.sprite,i.sprite)||c.push({command:"setSprite",args:[i.sprite]}),$e(s.glyphs,i.glyphs)||c.push({command:"setGlyphs",args:[i.glyphs]}),$e(s.transition,i.transition)||c.push({command:"setTransition",args:[i.transition]}),$e(s.light,i.light)||c.push({command:"setLight",args:[i.light]}),$e(s.terrain,i.terrain)||c.push({command:"setTerrain",args:[i.terrain]}),$e(s.sky,i.sky)||c.push({command:"setSky",args:[i.sky]});const d={},g=[];(function(x,T,M,A){let N;for(N in T=T||{},x=x||{})Object.prototype.hasOwnProperty.call(x,N)&&(Object.prototype.hasOwnProperty.call(T,N)||bn(N,M,A));for(N in T)Object.prototype.hasOwnProperty.call(T,N)&&(Object.prototype.hasOwnProperty.call(x,N)?$e(x[N],T[N])||(x[N].type==="geojson"&&T[N].type==="geojson"&&er(x,T,N)?kt(M,{command:"setGeoJSONSourceData",args:[N,T[N].data]}):Cn(N,T,M,A)):vn(N,T,M))})(s.sources,i.sources,g,d);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&d[x.source]?c.push({command:"removeLayer",args:[x.id]}):w.push(x)}),c=c.concat(g),function(x,T,M){T=T||[];const A=(x=x||[]).map(Uo),N=T.map(Uo),j=x.reduce(Ki,{}),$=T.reduce(Ki,{}),K=A.slice(),Q=Object.create(null);let le,ge,xe,Fe,Se;for(let ze=0,Ye=0;ze<A.length;ze++)le=A[ze],Object.prototype.hasOwnProperty.call($,le)?Ye++:(kt(M,{command:"removeLayer",args:[le]}),K.splice(K.indexOf(le,Ye),1));for(let ze=0,Ye=0;ze<N.length;ze++)le=N[N.length-1-ze],K[K.length-1-ze]!==le&&(Object.prototype.hasOwnProperty.call(j,le)?(kt(M,{command:"removeLayer",args:[le]}),K.splice(K.lastIndexOf(le,K.length-Ye),1)):Ye++,Fe=K[K.length-ze],kt(M,{command:"addLayer",args:[$[le],Fe]}),K.splice(K.length-ze,0,le),Q[le]=!0);for(let ze=0;ze<N.length;ze++)if(le=N[ze],ge=j[le],xe=$[le],!Q[le]&&!$e(ge,xe))if($e(ge.source,xe.source)&&$e(ge["source-layer"],xe["source-layer"])&&$e(ge.type,xe.type)){for(Se in tr(ge.layout,xe.layout,M,le,null,"setLayoutProperty"),tr(ge.paint,xe.paint,M,le,null,"setPaintProperty"),$e(ge.filter,xe.filter)||kt(M,{command:"setFilter",args:[le,xe.filter]}),$e(ge.minzoom,xe.minzoom)&&$e(ge.maxzoom,xe.maxzoom)||kt(M,{command:"setLayerZoomRange",args:[le,xe.minzoom,xe.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?tr(ge[Se],xe[Se],M,le,Se.slice(6),"setPaintProperty"):$e(ge[Se],xe[Se])||kt(M,{command:"setLayerProperty",args:[le,Se,xe[Se]]}));for(Se in xe)Object.prototype.hasOwnProperty.call(xe,Se)&&!Object.prototype.hasOwnProperty.call(ge,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?tr(ge[Se],xe[Se],M,le,Se.slice(6),"setPaintProperty"):$e(ge[Se],xe[Se])||kt(M,{command:"setLayerProperty",args:[le,Se,xe[Se]]}))}else kt(M,{command:"removeLayer",args:[le]}),Fe=K[K.lastIndexOf(le)+1],kt(M,{command:"addLayer",args:[xe,Fe]})}(w,i.layers,c)}catch(d){console.warn("Unable to compute style diff:",d),c=[{command:"setStyle",args:[i]}]}return c},f.aC=function(s){const i=[],c=s.id;return c===void 0&&i.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),i},f.aD=function s(i,c){if(Array.isArray(i)){if(!Array.isArray(c)||i.length!==c.length)return!1;for(let d=0;d<i.length;d++)if(!s(i[d],c[d]))return!1;return!0}if(typeof i=="object"&&i!==null&&c!==null){if(typeof c!="object"||Object.keys(i).length!==Object.keys(c).length)return!1;for(const d in i)if(!s(i[d],c[d]))return!1;return!0}return i===c},f.aE=ve,f.aF=Oe,f.aG=class extends Nn{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},f.aH=Br,f.aI=class extends Nn{constructor(s,i){super(s,i),this.current=Ia}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},f.aJ=vo,f.aK=class extends Nn{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},f.aL=class extends Nn{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},f.aM=Ho,f.aN=function(s,i,c,d,g,w,x){var T=1/(i-c),M=1/(d-g),A=1/(w-x);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*M,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*A,s[11]=0,s[12]=(i+c)*T,s[13]=(g+d)*M,s[14]=(x+w)*A,s[15]=1,s},f.aO=zi,f.aP=o1,f.aQ=class extends vl{},f.aR=Q1,f.aS=class extends bl{},f.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},f.aU=tm,f.aV=Z,f.aW=class extends Bc{},f.aX=Xe,f.aY=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},f.aZ=function(s,i){var c=s[0],d=s[1],g=s[2],w=s[3],x=s[4],T=s[5],M=s[6],A=s[7],N=s[8],j=s[9],$=s[10],K=s[11],Q=s[12],le=s[13],ge=s[14],xe=s[15],Fe=i[0],Se=i[1],ze=i[2],Ye=i[3],tt=i[4],Ct=i[5],Bt=i[6],Tt=i[7],wt=i[8],mt=i[9],Dt=i[10],vt=i[11],at=i[12],Wt=i[13],Nt=i[14],mi=i[15];return Math.abs(c-Fe)<=xr*Math.max(1,Math.abs(c),Math.abs(Fe))&&Math.abs(d-Se)<=xr*Math.max(1,Math.abs(d),Math.abs(Se))&&Math.abs(g-ze)<=xr*Math.max(1,Math.abs(g),Math.abs(ze))&&Math.abs(w-Ye)<=xr*Math.max(1,Math.abs(w),Math.abs(Ye))&&Math.abs(x-tt)<=xr*Math.max(1,Math.abs(x),Math.abs(tt))&&Math.abs(T-Ct)<=xr*Math.max(1,Math.abs(T),Math.abs(Ct))&&Math.abs(M-Bt)<=xr*Math.max(1,Math.abs(M),Math.abs(Bt))&&Math.abs(A-Tt)<=xr*Math.max(1,Math.abs(A),Math.abs(Tt))&&Math.abs(N-wt)<=xr*Math.max(1,Math.abs(N),Math.abs(wt))&&Math.abs(j-mt)<=xr*Math.max(1,Math.abs(j),Math.abs(mt))&&Math.abs($-Dt)<=xr*Math.max(1,Math.abs($),Math.abs(Dt))&&Math.abs(K-vt)<=xr*Math.max(1,Math.abs(K),Math.abs(vt))&&Math.abs(Q-at)<=xr*Math.max(1,Math.abs(Q),Math.abs(at))&&Math.abs(le-Wt)<=xr*Math.max(1,Math.abs(le),Math.abs(Wt))&&Math.abs(ge-Nt)<=xr*Math.max(1,Math.abs(ge),Math.abs(Nt))&&Math.abs(xe-mi)<=xr*Math.max(1,Math.abs(xe),Math.abs(mi))},f.a_=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,w)=>{const x=g||w;return i[d]=!x||x.toLowerCase(),""}),i["max-age"]){const c=parseInt(i["max-age"],10);isNaN(c)?delete i["max-age"]:i["max-age"]=c}return i},f.ab=function(s,i){const c=[];for(const d in s)d in i||c.push(d);return c},f.ac=se,f.ad=function(s,i,c){var d=Math.sin(c),g=Math.cos(c),w=i[0],x=i[1],T=i[2],M=i[3],A=i[4],N=i[5],j=i[6],$=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*g+A*d,s[1]=x*g+N*d,s[2]=T*g+j*d,s[3]=M*g+$*d,s[4]=A*g-w*d,s[5]=N*g-x*d,s[6]=j*g-T*d,s[7]=$*g-M*d,s},f.ae=function(s){var i=new Cl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},f.af=Rh,f.ag=function(s,i){let c=0,d=0;if(s.kind==="constant")d=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:x}=s,T=g?se(ir.interpolationFactor(g,i,w,x),0,1):0;s.kind==="camera"?d=cr.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:d}},f.ai=function(s,{uSize:i,uSizeT:c},{lowerSize:d,upperSize:g}){return s.kind==="source"?d/Jo:s.kind==="composite"?cr.number(d/Jo,g/Jo,c):i},f.aj=Tf,f.ak=function(s,i,c,d){const g=i.y-s.y,w=i.x-s.x,x=d.y-c.y,T=d.x-c.x,M=x*w-T*g;if(M===0)return null;const A=(T*(s.y-c.y)-x*(s.x-c.x))/M;return new S(s.x+A*w,s.y+A*g)},f.al=ig,f.am=Oc,f.an=rf,f.ao=jn,f.aq=Sf,f.ar=function(s,i){var c=i[0],d=i[1],g=i[2],w=i[3],x=i[4],T=i[5],M=i[6],A=i[7],N=i[8],j=i[9],$=i[10],K=i[11],Q=i[12],le=i[13],ge=i[14],xe=i[15],Fe=c*T-d*x,Se=c*M-g*x,ze=c*A-w*x,Ye=d*M-g*T,tt=d*A-w*T,Ct=g*A-w*M,Bt=N*le-j*Q,Tt=N*ge-$*Q,wt=N*xe-K*Q,mt=j*ge-$*le,Dt=j*xe-K*le,vt=$*xe-K*ge,at=Fe*vt-Se*Dt+ze*mt+Ye*wt-tt*Tt+Ct*Bt;return at?(s[0]=(T*vt-M*Dt+A*mt)*(at=1/at),s[1]=(g*Dt-d*vt-w*mt)*at,s[2]=(le*Ct-ge*tt+xe*Ye)*at,s[3]=($*tt-j*Ct-K*Ye)*at,s[4]=(M*wt-x*vt-A*Tt)*at,s[5]=(c*vt-g*wt+w*Tt)*at,s[6]=(ge*ze-Q*Ct-xe*Se)*at,s[7]=(N*Ct-$*ze+K*Se)*at,s[8]=(x*Dt-T*wt+A*Bt)*at,s[9]=(d*wt-c*Dt-w*Bt)*at,s[10]=(Q*tt-le*ze+xe*Fe)*at,s[11]=(j*ze-N*tt-K*Fe)*at,s[12]=(T*Tt-x*mt-M*Bt)*at,s[13]=(c*mt-d*Tt+g*Bt)*at,s[14]=(le*Se-Q*Ye-ge*Fe)*at,s[15]=(N*Ye-j*Se+$*Fe)*at,s):null},f.as=zf,f.at=kf,f.au=Df,f.av=function(){const s={},i=we.$version;for(const c in we.$root){const d=we.$root[c];if(d.required){let g=null;g=c==="version"?i:d.type==="array"?[]:{},g!=null&&(s[c]=g)}}return s},f.aw=wh,f.ax=yi,f.ay=function(s){s=s.slice();const i=Object.create(null);for(let c=0;c<s.length;c++)i[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=Ve(s[c],i[s[c].ref]));return s},f.az=function(s){if(s.type==="custom")return new Sv(s);switch(s.type){case"background":return new wv(s);case"circle":return new s1(s);case"fill":return new E1(s);case"fill-extrusion":return new U1(s);case"heatmap":return new l1(s);case"hillshade":return new u1(s);case"line":return new X1(s);case"raster":return new kv(s);case"symbol":return new Gh(s)}},f.b=st,f.b0=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},f.b1=re,f.b2=Xm,f.b3=$m,f.b4=function(s,i,c,d,g){var w,x=1/Math.tan(i/2);return s[0]=x/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+d)*(w=1/(d-g)),s[14]=2*g*d*w):(s[10]=-1,s[14]=-2*d),s},f.b5=function(s,i,c){var d=Math.sin(c),g=Math.cos(c),w=i[4],x=i[5],T=i[6],M=i[7],A=i[8],N=i[9],j=i[10],$=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=w*g+A*d,s[5]=x*g+N*d,s[6]=T*g+j*d,s[7]=M*g+$*d,s[8]=A*g-w*d,s[9]=N*g-x*d,s[10]=j*g-T*d,s[11]=$*g-M*d,s},f.b6=U,f.b7=q,f.b8=function(s){return s*Math.PI/180},f.b9=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},f.bA=$o,f.ba=class extends Ao{},f.bb=If,f.bc=Rv,f.be=xi,f.bf=function(s,i){ei.REGISTERED_PROTOCOLS[s]=i},f.bg=function(s){delete ei.REGISTERED_PROTOCOLS[s]},f.bh=function(s,i){const c={};for(let g=0;g<s.length;g++){const w=i&&i[s[g].id]||Yd(s[g]);i&&(i[s[g].id]=w);let x=c[w];x||(x=c[w]=[]),x.push(s[g])}const d=[];for(const g in c)d.push(c[g]);return d},f.bi=Lt,f.bj=Jm,f.bk=Qm,f.bl=Am,f.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=_n/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],c=i.layout,d=i._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new Yi(s.bucket.zoom+1),s.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new Yi(s.bucket.zoom+1),s.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new Yi(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:N}=s.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Yi(A),s.canonical),d["text-size"].possiblyEvaluate(new Yi(N),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:N}=s.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Yi(A),s.canonical),d["icon-size"].possiblyEvaluate(new Yi(N),s.canonical)]}const w=c.get("text-line-height")*jn,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),M=c.get("text-size");for(const A of s.bucket.features){const N=c.get("text-font").evaluate(A,{},s.canonical).join(","),j=M.evaluate(A,{},s.canonical),$=g.layoutTextSize.evaluate(A,{},s.canonical),K=g.layoutIconSize.evaluate(A,{},s.canonical),Q={horizontal:{},vertical:void 0},le=A.text;let ge,xe=[0,0];if(le){const ze=le.toString(),Ye=c.get("text-letter-spacing").evaluate(A,{},s.canonical)*jn,tt=xh(ze)?Ye:0,Ct=c.get("text-anchor").evaluate(A,{},s.canonical),Bt=hg(i,A,s.canonical);if(!Bt){const vt=c.get("text-radial-offset").evaluate(A,{},s.canonical);xe=vt?ug(Ct,[vt*jn,Pf]):c.get("text-offset").evaluate(A,{},s.canonical).map(at=>at*jn)}let Tt=x?"center":c.get("text-justify").evaluate(A,{},s.canonical);const wt=c.get("symbol-placement"),mt=wt==="point"?c.get("text-max-width").evaluate(A,{},s.canonical)*jn:0,Dt=()=>{s.bucket.allowVerticalPlacement&&Vs(ze)&&(Q.vertical=Vh(le,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,Ct,"left",tt,xe,f.ah.vertical,!0,wt,$,j))};if(!x&&Bt){const vt=new Set;if(Tt==="auto")for(let Wt=0;Wt<Bt.values.length;Wt+=2)vt.add(zf(Bt.values[Wt]));else vt.add(Tt);let at=!1;for(const Wt of vt)if(!Q.horizontal[Wt])if(at)Q.horizontal[Wt]=Q.horizontal[0];else{const Nt=Vh(le,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,"center",Wt,tt,xe,f.ah.horizontal,!1,wt,$,j);Nt&&(Q.horizontal[Wt]=Nt,at=Nt.positionedLines.length===1)}Dt()}else{Tt==="auto"&&(Tt=zf(Ct));const vt=Vh(le,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,Ct,Tt,tt,xe,f.ah.horizontal,!1,wt,$,j);vt&&(Q.horizontal[Tt]=vt),Dt(),Vs(ze)&&x&&T&&(Q.vertical=Vh(le,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,Ct,Tt,tt,xe,f.ah.vertical,!1,wt,$,j))}}let Fe=!1;if(A.icon&&A.icon.name){const ze=s.imageMap[A.icon.name];ze&&(ge=gv(s.imagePositions[A.icon.name],c.get("icon-offset").evaluate(A,{},s.canonical),c.get("icon-anchor").evaluate(A,{},s.canonical)),Fe=!!ze.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Fe:s.bucket.sdfIcons!==Fe&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Se=fg(Q.horizontal)||Q.vertical;s.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||ge)&&zv(s.bucket,A,Q,ge,s.imageMap,g,$,K,xe,Fe,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},f.bn=_f,f.bo=pf,f.bp=gf,f.bq=Zs,f.br=vf,f.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},f.bt=function(s,i,c,d,g){return a(this,void 0,void 0,function*(){if(O())try{return yield ii(s,i,c,d,g)}catch{}return function(w,x,T,M,A){const N=w.width,j=w.height;Ot&&zt||(Ot=new OffscreenCanvas(N,j),zt=Ot.getContext("2d",{willReadFrequently:!0})),Ot.width=N,Ot.height=j,zt.drawImage(w,0,0,N,j);const $=zt.getImageData(x,T,M,A);return zt.clearRect(0,0,N,j),$.data}(s,i,c,d,g)})},f.bu=Km,f.bv=_,f.bw=b,f.bx=xm,f.by=as,f.bz=function(s){return s.message===Jt},f.c=Mt,f.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=H,f.f=s=>new Promise((i,c)=>{const d=new Image;d.onload=()=>{i(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=Ht})},d.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});d.src=s.byteLength?URL.createObjectURL(g):Ht}),f.g=Vt,f.h=(s,i)=>Ai(H(s,{type:"json"}),i),f.i=bt,f.j=rt,f.k=je,f.l=(s,i)=>Ai(H(s,{type:"arrayBuffer"}),i),f.m=Ai,f.n=function(s){return new vf(s).readFields(uv,[])},f.o=Zc,f.p=Lm,f.q=wr,f.r=Qd,f.s=ct,f.t=Ns,f.u=St,f.v=we,f.w=Ke,f.x=cs,f.y=function([s,i,c]){return i+=90,i*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(c),y:s*Math.sin(i)*Math.sin(c),z:s*Math.cos(c)}},f.z=cr}),l("worker",["./shared"],function(f){class a{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const de of W){this._layerConfigs[de.id]=de;const Me=this._layers[de.id]=f.az(de);Me._featureFilter=f.a6(Me.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of X)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const te=f.bh(Object.values(this._layerConfigs),this.keyCache);for(const de of te){const Me=de.map(qe=>this._layers[qe.id]),Ie=Me[0];if(Ie.visibility==="none")continue;const Be=Ie.source||"";let ke=this.familiesBySource[Be];ke||(ke=this.familiesBySource[Be]={});const G=Ie.sourceLayer||"_geojsonTileLayer";let Ue=ke[G];Ue||(Ue=ke[G]=[]),Ue.push(Me)}}}class _{constructor(W){const X={},te=[];for(const Be in W){const ke=W[Be],G=X[Be]={};for(const Ue in ke){const qe=ke[+Ue];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Ge={x:0,y:0,w:qe.bitmap.width+2,h:qe.bitmap.height+2};te.push(Ge),G[Ue]={rect:Ge,metrics:qe.metrics}}}const{w:de,h:Me}=f.p(te),Ie=new f.o({width:de||1,height:Me||1});for(const Be in W){const ke=W[Be];for(const G in ke){const Ue=ke[+G];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const qe=X[Be][G].rect;f.o.copy(Ue.bitmap,Ie,{x:0,y:0},{x:qe.x+1,y:qe.y+1},Ue.bitmap)}}this.image=Ie,this.positions=X}}f.bi("GlyphAtlas",_);class b{constructor(W){this.tileID=new f.Q(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,X,te,de){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new f.a4;const Me=new f.bj(Object.keys(W.layers).sort()),Ie=new f.bk(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Be={},ke={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},G=X.familiesBySource[this.source];for(const li in G){const cn=W.layers[li];if(!cn)continue;cn.version===1&&f.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fn=Me.encode(li),lr=[];for(let yr=0;yr<cn.length;yr++){const Xn=cn.feature(yr),po=Ie.getId(Xn,li);lr.push({feature:Xn,id:po,index:yr,sourceLayerIndex:Fn})}for(const yr of G[li]){const Xn=yr[0];Xn.source!==this.source&&f.w(`layer.source = ${Xn.source} does not equal this.source = ${this.source}`),Xn.minzoom&&this.zoom<Math.floor(Xn.minzoom)||Xn.maxzoom&&this.zoom>=Xn.maxzoom||Xn.visibility!=="none"&&(k(yr,this.zoom,te),(Be[Xn.id]=Xn.createBucket({index:Ie.bucketLayerIDs.length,layers:yr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fn,sourceID:this.source})).populate(lr,ke,this.tileID.canonical),Ie.bucketLayerIDs.push(yr.map(po=>po.id)))}}const Ue=f.aE(ke.glyphDependencies,li=>Object.keys(li).map(Number));this.inFlightDependencies.forEach(li=>li==null?void 0:li.abort()),this.inFlightDependencies=[];let qe=Promise.resolve({});if(Object.keys(Ue).length){const li=new AbortController;this.inFlightDependencies.push(li),qe=de.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},li)}const Ge=Object.keys(ke.iconDependencies);let Je=Promise.resolve({});if(Ge.length){const li=new AbortController;this.inFlightDependencies.push(li),Je=de.sendAsync({type:"GI",data:{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"}},li)}const ht=Object.keys(ke.patternDependencies);let Rt=Promise.resolve({});if(ht.length){const li=new AbortController;this.inFlightDependencies.push(li),Rt=de.sendAsync({type:"GI",data:{icons:ht,source:this.source,tileID:this.tileID,type:"patterns"}},li)}const[Xt,ai,vi]=yield Promise.all([qe,Je,Rt]),Ji=new _(Xt),Mn=new f.bl(ai,vi);for(const li in Be){const cn=Be[li];cn instanceof f.a5?(k(cn.layers,this.zoom,te),f.bm({bucket:cn,glyphMap:Xt,glyphPositions:Ji.positions,imageMap:ai,imagePositions:Mn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):cn.hasPattern&&(cn instanceof f.bn||cn instanceof f.bo||cn instanceof f.bp)&&(k(cn.layers,this.zoom,te),cn.addFeatures(ke,this.tileID.canonical,Mn.patternPositions))}return this.status="done",{buckets:Object.values(Be).filter(li=>!li.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ji.image,imageAtlas:Mn,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?ai:null,glyphPositions:this.returnDependencies?Ji.positions:null}})}}function k(me,W,X){const te=new f.a8(W);for(const de of me)de.recalculate(te,X)}class S{constructor(W,X,te){this.actor=W,this.layerIndex=X,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return f._(this,void 0,void 0,function*(){const te=yield f.l(W.request,X);try{return{vectorTile:new f.bq.VectorTile(new f.br(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(de){const Me=new Uint8Array(te.data);let Ie=`Unable to parse the tile at ${W.request.url}, `;throw Ie+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.messge}`,new Error(Ie)}})}loadTile(W){return f._(this,void 0,void 0,function*(){const X=W.uid,te=!!(W&&W.request&&W.request.collectResourceTiming)&&new f.bs(W.request),de=new b(W);this.loading[X]=de;const Me=new AbortController;de.abort=Me;try{const Ie=yield this.loadVectorTile(W,Me);if(delete this.loading[X],!Ie)return null;const Be=Ie.rawData,ke={};Ie.expires&&(ke.expires=Ie.expires),Ie.cacheControl&&(ke.cacheControl=Ie.cacheControl);const G={};if(te){const qe=te.finish();qe&&(G.resourceTiming=JSON.parse(JSON.stringify(qe)))}de.vectorTile=Ie.vectorTile;const Ue=de.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=de,this.fetching[X]={rawTileData:Be,cacheControl:ke,resourceTiming:G};try{const qe=yield Ue;return f.e({rawTileData:Be.slice(0)},qe,ke,G)}finally{delete this.fetching[X]}}catch(Ie){throw delete this.loading[X],de.status="done",this.loaded[X]=de,Ie}})}reloadTile(W){return f._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[X];if(te.showCollisionBoxes=W.showCollisionBoxes,te.status==="parsing"){const de=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[X]){const{rawTileData:Ie,cacheControl:Be,resourceTiming:ke}=this.fetching[X];delete this.fetching[X],Me=f.e({rawTileData:Ie.slice(0)},de,Be,ke)}else Me=de;return Me}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return f._(this,void 0,void 0,function*(){const X=this.loading,te=W.uid;X&&X[te]&&X[te].abort&&(X[te].abort.abort(),delete X[te])})}removeTile(W){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class I{constructor(){this.loaded={}}loadTile(W){return f._(this,void 0,void 0,function*(){const{uid:X,encoding:te,rawImageData:de,redFactor:Me,greenFactor:Ie,blueFactor:Be,baseShift:ke}=W,G=de.width+2,Ue=de.height+2,qe=f.b(de)?new f.R({width:G,height:Ue},yield f.bt(de,-1,-1,G,Ue)):de,Ge=new f.bu(X,qe,te,Me,Ie,Be,ke);return this.loaded=this.loaded||{},this.loaded[X]=Ge,Ge})}removeTile(W){const X=this.loaded,te=W.uid;X&&X[te]&&delete X[te]}}function P(me,W){if(me.length!==0){D(me[0],W);for(var X=1;X<me.length;X++)D(me[X],!W)}}function D(me,W){for(var X=0,te=0,de=0,Me=me.length,Ie=Me-1;de<Me;Ie=de++){var Be=(me[de][0]-me[Ie][0])*(me[Ie][1]+me[de][1]),ke=X+Be;te+=Math.abs(X)>=Math.abs(Be)?X-ke+Be:Be-ke+X,X=ke}X+te>=0!=!!W&&me.reverse()}var B=f.bv(function me(W,X){var te,de=W&&W.type;if(de==="FeatureCollection")for(te=0;te<W.features.length;te++)me(W.features[te],X);else if(de==="GeometryCollection")for(te=0;te<W.geometries.length;te++)me(W.geometries[te],X);else if(de==="Feature")me(W.geometry,X);else if(de==="Polygon")P(W.coordinates,X);else if(de==="MultiPolygon")for(te=0;te<W.coordinates.length;te++)P(W.coordinates[te],X);return W});const z=f.bq.VectorTileFeature.prototype.toGeoJSON;var R={exports:{}},O=f.bw,U=f.bq.VectorTileFeature,q=se;function se(me,W){this.options=W||{},this.features=me,this.length=me.length}function re(me,W){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=W||4096}se.prototype.feature=function(me){return new re(this.features[me],this.options.extent)},re.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var W=0;W<me.length;W++){for(var X=me[W],te=[],de=0;de<X.length;de++)te.push(new O(X[de][0],X[de][1]));this.geometry.push(te)}return this.geometry},re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,W=1/0,X=-1/0,te=1/0,de=-1/0,Me=0;Me<me.length;Me++)for(var Ie=me[Me],Be=0;Be<Ie.length;Be++){var ke=Ie[Be];W=Math.min(W,ke.x),X=Math.max(X,ke.x),te=Math.min(te,ke.y),de=Math.max(de,ke.y)}return[W,te,X,de]},re.prototype.toGeoJSON=U.prototype.toGeoJSON;var H=f.bx,ee=q;function ve(me){var W=new H;return function(X,te){for(var de in X.layers)te.writeMessage(3,Oe,X.layers[de])}(me,W),W.finish()}function Oe(me,W){var X;W.writeVarintField(15,me.version||1),W.writeStringField(1,me.name||""),W.writeVarintField(5,me.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<me.length;X++)te.feature=me.feature(X),W.writeMessage(2,ne,te);var de=te.keys;for(X=0;X<de.length;X++)W.writeStringField(3,de[X]);var Me=te.values;for(X=0;X<Me.length;X++)W.writeMessage(4,bt,Me[X])}function ne(me,W){var X=me.feature;X.id!==void 0&&W.writeVarintField(1,X.id),W.writeMessage(2,ye,me),W.writeVarintField(3,X.type),W.writeMessage(4,et,X)}function ye(me,W){var X=me.feature,te=me.keys,de=me.values,Me=me.keycache,Ie=me.valuecache;for(var Be in X.properties){var ke=X.properties[Be],G=Me[Be];if(ke!==null){G===void 0&&(te.push(Be),Me[Be]=G=te.length-1),W.writeVarint(G);var Ue=typeof ke;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(ke=JSON.stringify(ke));var qe=Ue+":"+ke,Ge=Ie[qe];Ge===void 0&&(de.push(ke),Ie[qe]=Ge=de.length-1),W.writeVarint(Ge)}}}function Ke(me,W){return(W<<3)+(7&me)}function Ce(me){return me<<1^me>>31}function et(me,W){for(var X=me.loadGeometry(),te=me.type,de=0,Me=0,Ie=X.length,Be=0;Be<Ie;Be++){var ke=X[Be],G=1;te===1&&(G=ke.length),W.writeVarint(Ke(1,G));for(var Ue=te===3?ke.length-1:ke.length,qe=0;qe<Ue;qe++){qe===1&&te!==1&&W.writeVarint(Ke(2,Ue-1));var Ge=ke[qe].x-de,Je=ke[qe].y-Me;W.writeVarint(Ce(Ge)),W.writeVarint(Ce(Je)),de+=Ge,Me+=Je}te===3&&W.writeVarint(Ke(7,1))}}function bt(me,W){var X=typeof me;X==="string"?W.writeStringField(1,me):X==="boolean"?W.writeBooleanField(7,me):X==="number"&&(me%1!=0?W.writeDoubleField(3,me):me<0?W.writeSVarintField(6,me):W.writeVarintField(5,me))}R.exports=ve,R.exports.fromVectorTileJs=ve,R.exports.fromGeojsonVt=function(me,W){W=W||{};var X={};for(var te in me)X[te]=new ee(me[te].features,W),X[te].name=te,X[te].version=W.version,X[te].extent=W.extent;return ve({layers:X})},R.exports.GeoJSONWrapper=ee;var pt=f.bv(R.exports);const st={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},Ht=Math.fround||(ii=new Float32Array(1),me=>(ii[0]=+me,ii[0]));var ii;const Ot=3,zt=5,Jt=6;class Mt{constructor(W){this.options=Object.assign(Object.create(st),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:te,maxZoom:de}=this.options;X&&console.time("total time");const Me=`prepare ${W.length} points`;X&&console.time(Me),this.points=W;const Ie=[];for(let ke=0;ke<W.length;ke++){const G=W[ke];if(!G.geometry)continue;const[Ue,qe]=G.geometry.coordinates,Ge=Ht(hi(Ue)),Je=Ht(xi(qe));Ie.push(Ge,Je,1/0,ke,-1,1),this.options.reduce&&Ie.push(0)}let Be=this.trees[de+1]=this._createTree(Ie);X&&console.timeEnd(Me);for(let ke=de;ke>=te;ke--){const G=+Date.now();Be=this.trees[ke]=this._createTree(this._cluster(Be,ke)),X&&console.log("z%d: %d clusters in %dms",ke,Be.numItems,+Date.now()-G)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let te=((W[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,W[1]));let Me=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)te=-180,Me=180;else if(te>Me){const qe=this.getClusters([te,de,180,Ie],X),Ge=this.getClusters([-180,de,Me,Ie],X);return qe.concat(Ge)}const Be=this.trees[this._limitZoom(X)],ke=Be.range(hi(te),xi(Ie),hi(Me),xi(de)),G=Be.data,Ue=[];for(const qe of ke){const Ge=this.stride*qe;Ue.push(G[Ge+zt]>1?ei(G,Ge,this.clusterProps):this.points[G[Ge+Ot]])}return Ue}getChildren(W){const X=this._getOriginId(W),te=this._getOriginZoom(W),de="No cluster with the specified id.",Me=this.trees[te];if(!Me)throw new Error(de);const Ie=Me.data;if(X*this.stride>=Ie.length)throw new Error(de);const Be=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ke=Me.within(Ie[X*this.stride],Ie[X*this.stride+1],Be),G=[];for(const Ue of ke){const qe=Ue*this.stride;Ie[qe+4]===W&&G.push(Ie[qe+zt]>1?ei(Ie,qe,this.clusterProps):this.points[Ie[qe+Ot]])}if(G.length===0)throw new Error(de);return G}getLeaves(W,X,te){const de=[];return this._appendLeaves(de,W,X=X||10,te=te||0,0),de}getTile(W,X,te){const de=this.trees[this._limitZoom(W)],Me=Math.pow(2,W),{extent:Ie,radius:Be}=this.options,ke=Be/Ie,G=(te-ke)/Me,Ue=(te+1+ke)/Me,qe={features:[]};return this._addTileFeatures(de.range((X-ke)/Me,G,(X+1+ke)/Me,Ue),de.data,X,te,Me,qe),X===0&&this._addTileFeatures(de.range(1-ke/Me,G,1,Ue),de.data,Me,te,Me,qe),X===Me-1&&this._addTileFeatures(de.range(0,G,ke/Me,Ue),de.data,-1,te,Me,qe),qe.features.length?qe:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const te=this.getChildren(W);if(X++,te.length!==1)break;W=te[0].properties.cluster_id}return X}_appendLeaves(W,X,te,de,Me){const Ie=this.getChildren(X);for(const Be of Ie){const ke=Be.properties;if(ke&&ke.cluster?Me+ke.point_count<=de?Me+=ke.point_count:Me=this._appendLeaves(W,ke.cluster_id,te,de,Me):Me<de?Me++:W.push(Be),W.length===te)break}return Me}_createTree(W){const X=new f.au(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<W.length;te+=this.stride)X.add(W[te],W[te+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,te,de,Me,Ie){for(const Be of W){const ke=Be*this.stride,G=X[ke+zt]>1;let Ue,qe,Ge;if(G)Ue=Vt(X,ke,this.clusterProps),qe=X[ke],Ge=X[ke+1];else{const Rt=this.points[X[ke+Ot]];Ue=Rt.properties;const[Xt,ai]=Rt.geometry.coordinates;qe=hi(Xt),Ge=xi(ai)}const Je={type:1,geometry:[[Math.round(this.options.extent*(qe*Me-te)),Math.round(this.options.extent*(Ge*Me-de))]],tags:Ue};let ht;ht=G||this.options.generateId?X[ke+Ot]:this.points[X[ke+Ot]].id,ht!==void 0&&(Je.id=ht),Ie.features.push(Je)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:te,extent:de,reduce:Me,minPoints:Ie}=this.options,Be=te/(de*Math.pow(2,X)),ke=W.data,G=[],Ue=this.stride;for(let qe=0;qe<ke.length;qe+=Ue){if(ke[qe+2]<=X)continue;ke[qe+2]=X;const Ge=ke[qe],Je=ke[qe+1],ht=W.within(ke[qe],ke[qe+1],Be),Rt=ke[qe+zt];let Xt=Rt;for(const ai of ht){const vi=ai*Ue;ke[vi+2]>X&&(Xt+=ke[vi+zt])}if(Xt>Rt&&Xt>=Ie){let ai,vi=Ge*Rt,Ji=Je*Rt,Mn=-1;const li=((qe/Ue|0)<<5)+(X+1)+this.points.length;for(const cn of ht){const Fn=cn*Ue;if(ke[Fn+2]<=X)continue;ke[Fn+2]=X;const lr=ke[Fn+zt];vi+=ke[Fn]*lr,Ji+=ke[Fn+1]*lr,ke[Fn+4]=li,Me&&(ai||(ai=this._map(ke,qe,!0),Mn=this.clusterProps.length,this.clusterProps.push(ai)),Me(ai,this._map(ke,Fn)))}ke[qe+4]=li,G.push(vi/Xt,Ji/Xt,1/0,li,-1,Xt),Me&&G.push(Mn)}else{for(let ai=0;ai<Ue;ai++)G.push(ke[qe+ai]);if(Xt>1)for(const ai of ht){const vi=ai*Ue;if(!(ke[vi+2]<=X)){ke[vi+2]=X;for(let Ji=0;Ji<Ue;Ji++)G.push(ke[vi+Ji])}}}}return G}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,te){if(W[X+zt]>1){const Ie=this.clusterProps[W[X+Jt]];return te?Object.assign({},Ie):Ie}const de=this.points[W[X+Ot]].properties,Me=this.options.map(de);return te&&Me===de?Object.assign({},Me):Me}}function ei(me,W,X){return{type:"Feature",id:me[W+Ot],properties:Vt(me,W,X),geometry:{type:"Point",coordinates:[(te=me[W],360*(te-.5)),yi(me[W+1])]}};var te}function Vt(me,W,X){const te=me[W+zt],de=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,Me=me[W+Jt],Ie=Me===-1?{}:Object.assign({},X[Me]);return Object.assign(Ie,{cluster:!0,cluster_id:me[W+Ot],point_count:te,point_count_abbreviated:de})}function hi(me){return me/360+.5}function xi(me){const W=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function yi(me){const W=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Ai(me,W,X,te){for(var de,Me=te,Ie=X-W>>1,Be=X-W,ke=me[W],G=me[W+1],Ue=me[X],qe=me[X+1],Ge=W+3;Ge<X;Ge+=3){var Je=ct(me[Ge],me[Ge+1],ke,G,Ue,qe);if(Je>Me)de=Ge,Me=Je;else if(Je===Me){var ht=Math.abs(Ge-Ie);ht<Be&&(de=Ge,Be=ht)}}Me>te&&(de-W>3&&Ai(me,W,de,te),me[de+2]=Me,X-de>3&&Ai(me,de,X,te))}function ct(me,W,X,te,de,Me){var Ie=de-X,Be=Me-te;if(Ie!==0||Be!==0){var ke=((me-X)*Ie+(W-te)*Be)/(Ie*Ie+Be*Be);ke>1?(X=de,te=Me):ke>0&&(X+=Ie*ke,te+=Be*ke)}return(Ie=me-X)*Ie+(Be=W-te)*Be}function It(me,W,X,te){var de={id:me===void 0?null:me,type:W,geometry:X,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var Ie=Me.geometry,Be=Me.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")Ne(Me,Ie);else if(Be==="Polygon"||Be==="MultiLineString")for(var ke=0;ke<Ie.length;ke++)Ne(Me,Ie[ke]);else if(Be==="MultiPolygon")for(ke=0;ke<Ie.length;ke++)for(var G=0;G<Ie[ke].length;G++)Ne(Me,Ie[ke][G])}(de),de}function Ne(me,W){for(var X=0;X<W.length;X+=3)me.minX=Math.min(me.minX,W[X]),me.minY=Math.min(me.minY,W[X+1]),me.maxX=Math.max(me.maxX,W[X]),me.maxY=Math.max(me.maxY,W[X+1])}function je(me,W,X,te){if(W.geometry){var de=W.geometry.coordinates,Me=W.geometry.type,Ie=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Be=[],ke=W.id;if(X.promoteId?ke=W.properties[X.promoteId]:X.generateId&&(ke=te||0),Me==="Point")rt(de,Be);else if(Me==="MultiPoint")for(var G=0;G<de.length;G++)rt(de[G],Be);else if(Me==="LineString")xt(de,Be,Ie,!1);else if(Me==="MultiLineString"){if(X.lineMetrics){for(G=0;G<de.length;G++)xt(de[G],Be=[],Ie,!1),me.push(It(ke,"LineString",Be,W.properties));return}we(de,Be,Ie,!1)}else if(Me==="Polygon")we(de,Be,Ie,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(G=0;G<W.geometry.geometries.length;G++)je(me,{id:ke,geometry:W.geometry.geometries[G],properties:W.properties},X,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(G=0;G<de.length;G++){var Ue=[];we(de[G],Ue,Ie,!0),Be.push(Ue)}}me.push(It(ke,Me,Be,W.properties))}}function rt(me,W){W.push(di(me[0])),W.push(Ve(me[1])),W.push(0)}function xt(me,W,X,te){for(var de,Me,Ie=0,Be=0;Be<me.length;Be++){var ke=di(me[Be][0]),G=Ve(me[Be][1]);W.push(ke),W.push(G),W.push(0),Be>0&&(Ie+=te?(de*G-ke*Me)/2:Math.sqrt(Math.pow(ke-de,2)+Math.pow(G-Me,2))),de=ke,Me=G}var Ue=W.length-3;W[2]=1,Ai(W,0,Ue,X),W[Ue+2]=1,W.size=Math.abs(Ie),W.start=0,W.end=W.size}function we(me,W,X,te){for(var de=0;de<me.length;de++){var Me=[];xt(me[de],Me,X,te),W.push(Me)}}function di(me){return me/360+.5}function Ve(me){var W=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function $e(me,W,X,te,de,Me,Ie,Be){if(te/=W,Me>=(X/=W)&&Ie<te)return me;if(Ie<X||Me>=te)return null;for(var ke=[],G=0;G<me.length;G++){var Ue=me[G],qe=Ue.geometry,Ge=Ue.type,Je=de===0?Ue.minX:Ue.minY,ht=de===0?Ue.maxX:Ue.maxY;if(Je>=X&&ht<te)ke.push(Ue);else if(!(ht<X||Je>=te)){var Rt=[];if(Ge==="Point"||Ge==="MultiPoint")kt(qe,Rt,X,te,de);else if(Ge==="LineString")vn(qe,Rt,X,te,de,!1,Be.lineMetrics);else if(Ge==="MultiLineString")Cn(qe,Rt,X,te,de,!1);else if(Ge==="Polygon")Cn(qe,Rt,X,te,de,!0);else if(Ge==="MultiPolygon")for(var Xt=0;Xt<qe.length;Xt++){var ai=[];Cn(qe[Xt],ai,X,te,de,!0),ai.length&&Rt.push(ai)}if(Rt.length){if(Be.lineMetrics&&Ge==="LineString"){for(Xt=0;Xt<Rt.length;Xt++)ke.push(It(Ue.id,Ge,Rt[Xt],Ue.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(Rt.length===1?(Ge="LineString",Rt=Rt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=Rt.length===3?"Point":"MultiPoint"),ke.push(It(Ue.id,Ge,Rt,Ue.tags))}}}return ke.length?ke:null}function kt(me,W,X,te,de){for(var Me=0;Me<me.length;Me+=3){var Ie=me[Me+de];Ie>=X&&Ie<=te&&(W.push(me[Me]),W.push(me[Me+1]),W.push(me[Me+2]))}}function vn(me,W,X,te,de,Me,Ie){for(var Be,ke,G=bn(me),Ue=de===0?tr:Uo,qe=me.start,Ge=0;Ge<me.length-3;Ge+=3){var Je=me[Ge],ht=me[Ge+1],Rt=me[Ge+2],Xt=me[Ge+3],ai=me[Ge+4],vi=de===0?Je:ht,Ji=de===0?Xt:ai,Mn=!1;Ie&&(Be=Math.sqrt(Math.pow(Je-Xt,2)+Math.pow(ht-ai,2))),vi<X?Ji>X&&(ke=Ue(G,Je,ht,Xt,ai,X),Ie&&(G.start=qe+Be*ke)):vi>te?Ji<te&&(ke=Ue(G,Je,ht,Xt,ai,te),Ie&&(G.start=qe+Be*ke)):er(G,Je,ht,Rt),Ji<X&&vi>=X&&(ke=Ue(G,Je,ht,Xt,ai,X),Mn=!0),Ji>te&&vi<=te&&(ke=Ue(G,Je,ht,Xt,ai,te),Mn=!0),!Me&&Mn&&(Ie&&(G.end=qe+Be*ke),W.push(G),G=bn(me)),Ie&&(qe+=Be)}var li=me.length-3;Je=me[li],ht=me[li+1],Rt=me[li+2],(vi=de===0?Je:ht)>=X&&vi<=te&&er(G,Je,ht,Rt),li=G.length-3,Me&&li>=3&&(G[li]!==G[0]||G[li+1]!==G[1])&&er(G,G[0],G[1],G[2]),G.length&&W.push(G)}function bn(me){var W=[];return W.size=me.size,W.start=me.start,W.end=me.end,W}function Cn(me,W,X,te,de,Me){for(var Ie=0;Ie<me.length;Ie++)vn(me[Ie],W,X,te,de,Me,!1)}function er(me,W,X,te){me.push(W),me.push(X),me.push(te)}function tr(me,W,X,te,de,Me){var Ie=(Me-W)/(te-W);return me.push(Me),me.push(X+(de-X)*Ie),me.push(1),Ie}function Uo(me,W,X,te,de,Me){var Ie=(Me-X)/(de-X);return me.push(W+(te-W)*Ie),me.push(Me),me.push(1),Ie}function Ki(me,W){for(var X=[],te=0;te<me.length;te++){var de,Me=me[te],Ie=Me.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")de=ut(Me.geometry,W);else if(Ie==="MultiLineString"||Ie==="Polygon"){de=[];for(var Be=0;Be<Me.geometry.length;Be++)de.push(ut(Me.geometry[Be],W))}else if(Ie==="MultiPolygon")for(de=[],Be=0;Be<Me.geometry.length;Be++){for(var ke=[],G=0;G<Me.geometry[Be].length;G++)ke.push(ut(Me.geometry[Be][G],W));de.push(ke)}X.push(It(Me.id,Ie,de,Me.tags))}return X}function ut(me,W){var X=[];X.size=me.size,me.start!==void 0&&(X.start=me.start,X.end=me.end);for(var te=0;te<me.length;te+=3)X.push(me[te]+W,me[te+1],me[te+2]);return X}function Hn(me,W){if(me.transformed)return me;var X,te,de,Me=1<<me.z,Ie=me.x,Be=me.y;for(X=0;X<me.features.length;X++){var ke=me.features[X],G=ke.geometry,Ue=ke.type;if(ke.geometry=[],Ue===1)for(te=0;te<G.length;te+=2)ke.geometry.push(wn(G[te],G[te+1],W,Me,Ie,Be));else for(te=0;te<G.length;te++){var qe=[];for(de=0;de<G[te].length;de+=2)qe.push(wn(G[te][de],G[te][de+1],W,Me,Ie,Be));ke.geometry.push(qe)}}return me.transformed=!0,me}function wn(me,W,X,te,de,Me){return[Math.round(X*(me*te-de)),Math.round(X*(W*te-Me))]}function Lo(me,W,X,te,de){for(var Me=W===de.maxZoom?0:de.tolerance/((1<<W)*de.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:te,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<me.length;Be++){Ie.numFeatures++,Vi(Ie,me[Be],Me,de);var ke=me[Be].minX,G=me[Be].minY,Ue=me[Be].maxX,qe=me[Be].maxY;ke<Ie.minX&&(Ie.minX=ke),G<Ie.minY&&(Ie.minY=G),Ue>Ie.maxX&&(Ie.maxX=Ue),qe>Ie.maxY&&(Ie.maxY=qe)}return Ie}function Vi(me,W,X,te){var de=W.geometry,Me=W.type,Ie=[];if(Me==="Point"||Me==="MultiPoint")for(var Be=0;Be<de.length;Be+=3)Ie.push(de[Be]),Ie.push(de[Be+1]),me.numPoints++,me.numSimplified++;else if(Me==="LineString")gt(Ie,de,me,X,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(Be=0;Be<de.length;Be++)gt(Ie,de[Be],me,X,Me==="Polygon",Be===0);else if(Me==="MultiPolygon")for(var ke=0;ke<de.length;ke++){var G=de[ke];for(Be=0;Be<G.length;Be++)gt(Ie,G[Be],me,X,!0,Be===0)}if(Ie.length){var Ue=W.tags||null;if(Me==="LineString"&&te.lineMetrics){for(var qe in Ue={},W.tags)Ue[qe]=W.tags[qe];Ue.mapbox_clip_start=de.start/de.size,Ue.mapbox_clip_end=de.end/de.size}var Ge={geometry:Ie,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ue};W.id!==null&&(Ge.id=W.id),me.features.push(Ge)}}function gt(me,W,X,te,de,Me){var Ie=te*te;if(te>0&&W.size<(de?Ie:te))X.numPoints+=W.length/3;else{for(var Be=[],ke=0;ke<W.length;ke+=3)(te===0||W[ke+2]>Ie)&&(X.numSimplified++,Be.push(W[ke]),Be.push(W[ke+1])),X.numPoints++;de&&function(G,Ue){for(var qe=0,Ge=0,Je=G.length,ht=Je-2;Ge<Je;ht=Ge,Ge+=2)qe+=(G[Ge]-G[ht])*(G[Ge+1]+G[ht+1]);if(qe>0===Ue)for(Ge=0,Je=G.length;Ge<Je/2;Ge+=2){var Rt=G[Ge],Xt=G[Ge+1];G[Ge]=G[Je-2-Ge],G[Ge+1]=G[Je-1-Ge],G[Je-2-Ge]=Rt,G[Je-1-Ge]=Xt}}(Be,Me),me.push(Be)}}function ni(me,W){var X=(W=this.options=function(de,Me){for(var Ie in Me)de[Ie]=Me[Ie];return de}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(de,Me){var Ie=[];if(de.type==="FeatureCollection")for(var Be=0;Be<de.features.length;Be++)je(Ie,de.features[Be],Me,Be);else je(Ie,de.type==="Feature"?de:{geometry:de},Me);return Ie}(me,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(de,Me){var Ie=Me.buffer/Me.extent,Be=de,ke=$e(de,1,-1-Ie,Ie,0,-1,2,Me),G=$e(de,1,1-Ie,2+Ie,0,-1,2,Me);return(ke||G)&&(Be=$e(de,1,-Ie,1+Ie,0,-1,2,Me)||[],ke&&(Be=Ki(ke,1).concat(Be)),G&&(Be=Be.concat(Ki(G,-1)))),Be}(te,W),te.length&&this.splitTile(te,0,0,0),X&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yt(me,W,X){return 32*((1<<me)*X+W)+me}function qi(me,W){return W?me.properties[W]:me.id}function _r(me,W){if(me==null)return!0;if(me.type==="Feature")return qi(me,W)!=null;if(me.type==="FeatureCollection"){const X=new Set;for(const te of me.features){const de=qi(te,W);if(de==null||X.has(de))return!1;X.add(de)}return!0}return!1}function ti(me,W){const X=new Map;if(me!=null)if(me.type==="Feature")X.set(qi(me,W),me);else for(const te of me.features)X.set(qi(te,W),te);return X}ni.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ni.prototype.splitTile=function(me,W,X,te,de,Me,Ie){for(var Be=[me,W,X,te],ke=this.options,G=ke.debug;Be.length;){te=Be.pop(),X=Be.pop(),W=Be.pop(),me=Be.pop();var Ue=1<<W,qe=Yt(W,X,te),Ge=this.tiles[qe];if(!Ge&&(G>1&&console.time("creation"),Ge=this.tiles[qe]=Lo(me,W,X,te,ke),this.tileCoords.push({z:W,x:X,y:te}),G)){G>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,te,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Je="z"+W;this.stats[Je]=(this.stats[Je]||0)+1,this.total++}if(Ge.source=me,de){if(W===ke.maxZoom||W===de)continue;var ht=1<<de-W;if(X!==Math.floor(Me/ht)||te!==Math.floor(Ie/ht))continue}else if(W===ke.indexMaxZoom||Ge.numPoints<=ke.indexMaxPoints)continue;if(Ge.source=null,me.length!==0){G>1&&console.time("clipping");var Rt,Xt,ai,vi,Ji,Mn,li=.5*ke.buffer/ke.extent,cn=.5-li,Fn=.5+li,lr=1+li;Rt=Xt=ai=vi=null,Ji=$e(me,Ue,X-li,X+Fn,0,Ge.minX,Ge.maxX,ke),Mn=$e(me,Ue,X+cn,X+lr,0,Ge.minX,Ge.maxX,ke),me=null,Ji&&(Rt=$e(Ji,Ue,te-li,te+Fn,1,Ge.minY,Ge.maxY,ke),Xt=$e(Ji,Ue,te+cn,te+lr,1,Ge.minY,Ge.maxY,ke),Ji=null),Mn&&(ai=$e(Mn,Ue,te-li,te+Fn,1,Ge.minY,Ge.maxY,ke),vi=$e(Mn,Ue,te+cn,te+lr,1,Ge.minY,Ge.maxY,ke),Mn=null),G>1&&console.timeEnd("clipping"),Be.push(Rt||[],W+1,2*X,2*te),Be.push(Xt||[],W+1,2*X,2*te+1),Be.push(ai||[],W+1,2*X+1,2*te),Be.push(vi||[],W+1,2*X+1,2*te+1)}}},ni.prototype.getTile=function(me,W,X){var te=this.options,de=te.extent,Me=te.debug;if(me<0||me>24)return null;var Ie=1<<me,Be=Yt(me,W=(W%Ie+Ie)%Ie,X);if(this.tiles[Be])return Hn(this.tiles[Be],de);Me>1&&console.log("drilling down to z%d-%d-%d",me,W,X);for(var ke,G=me,Ue=W,qe=X;!ke&&G>0;)G--,Ue=Math.floor(Ue/2),qe=Math.floor(qe/2),ke=this.tiles[Yt(G,Ue,qe)];return ke&&ke.source?(Me>1&&console.log("found parent tile z%d-%d-%d",G,Ue,qe),Me>1&&console.time("drilling down"),this.splitTile(ke.source,G,Ue,qe,me,W,X),Me>1&&console.timeEnd("drilling down"),this.tiles[Be]?Hn(this.tiles[Be],de):null):null};class eo extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return f._(this,void 0,void 0,function*(){const te=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!de)return null;const Me=new class{constructor(Be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.W,this.length=Be.length,this._features=Be}feature(Be){return new class{constructor(ke){this._feature=ke,this.extent=f.W,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const G of this._feature.geometry)ke.push([new f.P(G[0],G[1])]);return ke}{const ke=[];for(const G of this._feature.geometry){const Ue=[];for(const qe of G)Ue.push(new f.P(qe[0],qe[1]));ke.push(Ue)}return ke}}toGeoJSON(ke,G,Ue){return z.call(this,ke,G,Ue)}}(this._features[Be])}}(de.features);let Ie=pt(Me);return Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),{vectorTile:Me,rawData:Ie.buffer}})}loadData(W){return f._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const te=!!(W&&W.request&&W.request.collectResourceTiming)&&new f.bs(W.request);this._pendingRequest=new AbortController;try{let de=yield this.loadGeoJSON(W,this._pendingRequest);if(delete this._pendingRequest,typeof de!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(B(de,!0),W.filter){const Ie=f.by(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(ke=>Ie.value.evaluate({zoom:0},ke))}}this._geoJSONIndex=W.cluster?new Mt(function({superclusterOptions:Ie,clusterProperties:Be}){if(!Be||!Ie)return Ie;const ke={},G={},Ue={accumulated:null,zoom:0},qe={properties:null},Ge=Object.keys(Be);for(const Je of Ge){const[ht,Rt]=Be[Je],Xt=f.by(Rt),ai=f.by(typeof ht=="string"?[ht,["accumulated"],["get",Je]]:ht);ke[Je]=Xt.value,G[Je]=ai.value}return Ie.map=Je=>{qe.properties=Je;const ht={};for(const Rt of Ge)ht[Rt]=ke[Rt].evaluate(Ue,qe);return ht},Ie.reduce=(Je,ht)=>{qe.properties=ht;for(const Rt of Ge)Ue.accumulated=Je[Rt],Je[Rt]=G[Rt].evaluate(Ue,qe)},Ie}(W)).load(de.features):function(Ie,Be){return new ni(Ie,Be)}(de,W.geojsonVtOptions),this.loaded={};const Me={};if(te){const Ie=te.finish();Ie&&(Me.resourceTiming={},Me.resourceTiming[W.source]=JSON.parse(JSON.stringify(Ie)))}return Me}catch(de){if(delete this._pendingRequest,f.bz(de))return{abandoned:!0};throw de}})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadGeoJSON(W,X){return f._(this,void 0,void 0,function*(){const{promoteId:te}=W;if(W.request){const de=yield f.h(W.request,X);return this._dataUpdateable=_r(de.data,te)?ti(de.data,te):void 0,de.data}if(typeof W.data=="string")try{const de=JSON.parse(W.data);return this._dataUpdateable=_r(de,te)?ti(de,te):void 0,de}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(de,Me,Ie){var Be,ke,G,Ue;if(Me.removeAll&&de.clear(),Me.remove)for(const qe of Me.remove)de.delete(qe);if(Me.add)for(const qe of Me.add){const Ge=qi(qe,Ie);Ge!=null&&de.set(Ge,qe)}if(Me.update)for(const qe of Me.update){let Ge=de.get(qe.id);if(Ge==null)continue;const Je=!qe.removeAllProperties&&(((Be=qe.removeProperties)===null||Be===void 0?void 0:Be.length)>0||((ke=qe.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((qe.newGeometry||qe.removeAllProperties||Je)&&(Ge=Object.assign({},Ge),de.set(qe.id,Ge),Je&&(Ge.properties=Object.assign({},Ge.properties))),qe.newGeometry&&(Ge.geometry=qe.newGeometry),qe.removeAllProperties)Ge.properties={};else if(((G=qe.removeProperties)===null||G===void 0?void 0:G.length)>0)for(const ht of qe.removeProperties)Object.prototype.hasOwnProperty.call(Ge.properties,ht)&&delete Ge.properties[ht];if(((Ue=qe.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:ht,value:Rt}of qe.addOrUpdateProperties)Ge.properties[ht]=Rt}}(this._dataUpdateable,W.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class ln{constructor(W){this.self=W,this.actor=new f.C(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,te)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=te},this.self.addProtocol=f.bf,this.self.removeProtocol=f.bg,this.self.registerRTLTextPlugin=X=>{if(f.bA.isParsed())throw new Error("RTL text plugin already registered.");f.bA.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,te)=>this._getDEMWorkerSource(X,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(X,te)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(X,te)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(X,te)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(X,te)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(X,te)=>this._getWorkerSource(X,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("LT",(X,te)=>this._getWorkerSource(X,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(X,te)=>this._getWorkerSource(X,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(X,te)=>this._getWorkerSource(X,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(X,te)=>this._getWorkerSource(X,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(X,te)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][te.type]||!this.workerSources[X][te.type][te.source])return;const de=this.workerSources[X][te.type][te.source];delete this.workerSources[X][te.type][te.source],de.removeSource!==void 0&&de.removeSource(te)})),this.actor.registerMessageHandler("RM",X=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,te)=>f._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(X,te)=>this._syncRTLPluginState(X,te)),this.actor.registerMessageHandler("IS",(X,te)=>f._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(X,te)=>this._setImages(X,te)),this.actor.registerMessageHandler("UL",(X,te)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(te.layers,te.removedIds)})),this.actor.registerMessageHandler("SL",(X,te)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(te)}))}_setImages(W,X){return f._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const te in this.workerSources[W]){const de=this.workerSources[W][te];for(const Me in de)de[Me].availableImages=X}})}_syncRTLPluginState(W,X){return f._(this,void 0,void 0,function*(){if(f.bA.isParsed())return f.bA.getState();if(X.pluginStatus!=="loading")return f.bA.setState(X),X;const te=X.pluginURL;if(this.self.importScripts(te),f.bA.isParsed()){const de={pluginStatus:"loaded",pluginURL:te};return f.bA.setState(de),de}throw f.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${te}`)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new a),X}_getWorkerSource(W,X,te){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][te]){const de={sendAsync:(Me,Ie)=>(Me.targetMapId=W,this.actor.sendAsync(Me,Ie))};switch(X){case"vector":this.workerSources[W][X][te]=new S(de,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][te]=new eo(de,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][te]=new this.externalWorkerSourceTypes[X](de,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][te]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new I),this.demWorkerSources[W][X]}}return f.i(self)&&(self.worker=new ln(self)),ln}),l("index",["exports","./shared"],function(f,a){var _="4.1.3";let b,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((r,h)=>{const p=requestAnimationFrame(r);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(y,r=0){return this.getImageCanvasContext(y).getImageData(-r,-r,y.width+2*r,y.height+2*r)},getImageCanvasContext(y){const r=window.document.createElement("canvas"),h=r.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return r.width=y.width,r.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(b||(b=document.createElement("a")),b.href=y,b.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class I{static testProp(r){if(!I.docStyle)return r[0];for(let h=0;h<r.length;h++)if(r[h]in I.docStyle)return r[h];return r[0]}static create(r,h,p){const m=window.document.createElement(r);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(r,h){return window.document.createElementNS(r,h)}static disableDrag(){I.docStyle&&I.selectProp&&(I.userSelect=I.docStyle[I.selectProp],I.docStyle[I.selectProp]="none")}static enableDrag(){I.docStyle&&I.selectProp&&(I.docStyle[I.selectProp]=I.userSelect)}static setTransform(r,h){r.style[I.transformProp]=h}static addEventListener(r,h,p,m={}){r.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(r,h,p,m={}){r.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",I.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",I.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",I.suppressClickInternal,!0)},0)}static getScale(r){const h=r.getBoundingClientRect();return{x:h.width/r.offsetWidth||1,y:h.height/r.offsetHeight||1,boundingClientRect:h}}static getPoint(r,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-r.clientLeft,(p.clientY-m.top)/h.y-r.clientTop)}static mousePos(r,h){const p=I.getScale(r);return I.getPoint(r,p,h)}static touchPos(r,h){const p=[],m=I.getScale(r);for(let v=0;v<h.length;v++)p.push(I.getPoint(r,m,h[v]));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}I.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,I.selectProp=I.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),I.transformProp=I.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(y){!z&&B&&(R?O(y):D=y)}};let D,B,z=!1,R=!1;function O(y){const r=y.createTexture();y.bindTexture(y.TEXTURE_2D,r);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,B),y.isContextLost())return;P.supported=!0}catch{}y.deleteTexture(r),z=!0}var U;typeof document<"u"&&(B=document.createElement("img"),B.onload=function(){D&&O(D),D=null,R=!0},B.onerror=function(){z=!0,D=null},B.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let r,h,p,m;y.resetRequestQueue=()=>{r=[],h=0,p=0,m={}},y.addThrottleControl=L=>{const F=p++;return m[F]=L,F},y.removeThrottleControl=L=>{delete m[L],E()},y.getImage=(L,F,V=!0)=>new Promise((Z,J)=>{P.supported&&(L.headers||(L.headers={}),L.headers.accept="image/webp,*/*"),a.e(L,{type:"image"}),r.push({abortController:F,requestParameters:L,supportImageRefresh:V,state:"queued",onError:pe=>{J(pe)},onSuccess:pe=>{Z(pe)}}),E()});const v=L=>a._(this,void 0,void 0,function*(){L.state="running";const{requestParameters:F,supportImageRefresh:V,onError:Z,onSuccess:J,abortController:pe}=L,fe=V===!1&&!a.i(self)&&!a.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((Ee,Ze)=>Ee&&Ze==="accept",!0));h++;const _e=fe?C(F,pe):a.m(F,pe);try{const Ee=yield _e;delete L.abortController,L.state="completed",Ee.data instanceof HTMLImageElement||a.b(Ee.data)?J(Ee):Ee.data&&J({data:yield(ae=Ee.data,typeof createImageBitmap=="function"?a.d(ae):a.f(ae)),cacheControl:Ee.cacheControl,expires:Ee.expires})}catch(Ee){delete L.abortController,Z(Ee)}finally{h--,E()}var ae}),E=()=>{const L=(()=>{for(const F of Object.keys(m))if(m[F]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=h;F<L&&r.length>0;F++){const V=r.shift();V.abortController.signal.aborted?F--:v(V)}},C=(L,F)=>new Promise((V,Z)=>{const J=new Image,pe=L.url,fe=L.credentials;fe&&fe==="include"?J.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!a.s(pe))&&(J.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{J.src="",Z(a.c())}),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,V({data:J})},J.onerror=()=>{J.onerror=J.onload=null,F.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=pe})}(U||(U={})),U.resetRequestQueue();class q{constructor(r){this._transformRequestFn=r}transformRequest(r,h){return this._transformRequestFn&&this._transformRequestFn(r,h)||{url:r}}normalizeSpriteURL(r,h,p){const m=function(v){const E=v.match(se);if(!E)throw new Error(`Unable to parse URL "${v}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(r);return m.path+=`${h}${p}`,function(v){const E=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${E}`}(m)}setTransformRequest(r){this._transformRequestFn=r}}const se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function re(y){var r=new a.A(3);return r[0]=y[0],r[1]=y[1],r[2]=y[2],r}var H,ee=function(y,r,h){return y[0]=r[0]-h[0],y[1]=r[1]-h[1],y[2]=r[2]-h[2],y};H=new a.A(3),a.A!=Float32Array&&(H[0]=0,H[1]=0,H[2]=0);var ve=function(y){var r=y[0],h=y[1];return r*r+h*h};function Oe(y){const r=[];if(typeof y=="string")r.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:p,url:m}of y){const v=`${p}${m}`;h.indexOf(v)===-1&&(h.push(v),r.push({id:p,url:m}))}}return r}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class ne{constructor(r,h,p,m){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(h,m)}update(r,h,p){const{width:m,height:v}=r,E=!(this.size&&this.size[0]===m&&this.size[1]===v||p),{context:C}=this,{gl:L}=C;if(this.useMipmap=!!(h&&h.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[m,v],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,r):L.texImage2D(L.TEXTURE_2D,0,this.format,m,v,0,this.format,L.UNSIGNED_BYTE,r.data);else{const{x:F,y:V}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?L.texSubImage2D(L.TEXTURE_2D,0,F,V,L.RGBA,L.UNSIGNED_BYTE,r):L.texSubImage2D(L.TEXTURE_2D,0,F,V,m,v,L.RGBA,L.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(r,h,p){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),r!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||r),this.filter=r),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function ye(y){const{userImage:r}=y;return!!(r&&r.render&&r.render())&&(y.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ke extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(r){const h=this.images[r];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(r,h){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,h)&&(this.images[r]=h)}_validate(r,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,h){if(!r)return!0;let p=0;for(const m of r){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(r,h){if(!r)return!0;if(r.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,v=p&&p.height||h.data.height;return!(r[0]<0||m<r[0]||r[1]<0||v<r[1]||r[2]<0||m<r[2]||r[3]<0||v<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,h,p=!0){const m=this.getImage(r);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[r]=h,this.updatedImages[r]=!0}removeImage(r){const h=this.images[r];delete this.images[r],delete this.patterns[r],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const v of r)this.images[v]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:h})})}_getImagesForIds(r){const h={};for(const p of r){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:r,height:h}=this.atlasImage;return{width:r,height:h}}getPattern(r){const h=this.patterns[r],p=this.getImage(r);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new a.I(m,p);this.patterns[r]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const h=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ne(r,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:h,h:p}=a.p(r),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],C=E.x+1,L=E.y+1,F=this.getImage(v).data,V=F.width,Z=F.height;a.R.copy(F,m,{x:0,y:0},{x:C,y:L},{width:V,height:Z}),a.R.copy(F,m,{x:0,y:Z-1},{x:C,y:L-1},{width:V,height:1}),a.R.copy(F,m,{x:0,y:0},{x:C,y:L+Z},{width:V,height:1}),a.R.copy(F,m,{x:V-1,y:0},{x:C-1,y:L},{width:1,height:Z}),a.R.copy(F,m,{x:0,y:0},{x:C+V,y:L},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const h of r){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ye(p)&&this.updateImage(h,p)}}}const Ce=1e20;function et(y,r,h,p,m,v,E,C,L){for(let F=r;F<r+p;F++)bt(y,h*v+F,v,m,E,C,L);for(let F=h;F<h+m;F++)bt(y,F*v+r,1,p,E,C,L)}function bt(y,r,h,p,m,v,E){v[0]=0,E[0]=-Ce,E[1]=Ce,m[0]=y[r];for(let C=1,L=0,F=0;C<p;C++){m[C]=y[r+C*h];const V=C*C;do{const Z=v[L];F=(m[C]-m[Z]+V-Z*Z)/(C-Z)/2}while(F<=E[L]&&--L>-1);L++,v[L]=C,E[L]=F,E[L+1]=Ce}for(let C=0,L=0;C<p;C++){for(;E[L+1]<C;)L++;const F=v[L],V=C-F;y[r+C*h]=m[F]+V*V}}class pt{constructor(r,h){this.requestManager=r,this.localIdeographFontFamily=h,this.entries={}}setURL(r){this.url=r}getGlyphs(r){return a._(this,void 0,void 0,function*(){const h=[];for(const v in r)for(const E of r[v])h.push(this._getAndCacheGlyphsPromise(v,E));const p=yield Promise.all(h),m={};for(const{stack:v,id:E,glyph:C}of p)m[v]||(m[v]={}),m[v][E]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return m})}_getAndCacheGlyphsPromise(r,h){return a._(this,void 0,void 0,function*(){let p=this.entries[r];p||(p=this.entries[r]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:r,id:h,glyph:m};if(m=this._tinySDF(p,r,h),m)return p.glyphs[h]=m,{stack:r,id:h,glyph:m};const v=Math.floor(h/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[v])return{stack:r,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[v]){const C=pt.loadGlyphRange(r,v,this.url,this.requestManager);p.requests[v]=C}const E=yield p.requests[v];for(const C in E)this._doesCharSupportLocalGlyph(+C)||(p.glyphs[+C]=E[+C]);return p.ranges[v]=!0,{stack:r,id:h,glyph:E[h]||null}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](r)||a.u["Hangul Syllables"](r)||a.u.Hiragana(r)||a.u.Katakana(r))}_tinySDF(r,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let v=r.tinySDF;if(!v){let C="400";/bold/i.test(h)?C="900":/medium/i.test(h)?C="500":/light/i.test(h)&&(C="200"),v=r.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:C})}const E=v.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(y,r,h,p){return a._(this,void 0,void 0,function*(){const m=256*r,v=m+255,E=p.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${v}`),"Glyphs"),C=yield a.l(E,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${r}, ${m}-${v}`);const L={};for(const F of a.n(C.data))L[F.id]=F;return L})},pt.TinySDF=class{constructor({fontSize:y=24,buffer:r=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:E="normal"}={}){this.buffer=r,this.cutoff=p,this.radius=h;const C=this.size=y+4*r,L=this._createCanvas(C),F=this.ctx=L.getContext("2d",{willReadFrequently:!0});F.font=`${E} ${v} ${y}px ${m}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(y){const r=document.createElement("canvas");return r.width=r.height=y,r}draw(y){const{width:r,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(y),E=Math.ceil(h),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),L=Math.min(this.size-this.buffer,E+Math.ceil(p)),F=C+2*this.buffer,V=L+2*this.buffer,Z=Math.max(F*V,0),J=new Uint8ClampedArray(Z),pe={data:J,width:F,height:V,glyphWidth:C,glyphHeight:L,glyphTop:E,glyphLeft:0,glyphAdvance:r};if(C===0||L===0)return pe;const{ctx:fe,buffer:_e,gridInner:ae,gridOuter:Ee}=this;fe.clearRect(_e,_e,C,L),fe.fillText(y,_e,_e+E);const Ze=fe.getImageData(_e,_e,C,L);Ee.fill(Ce,0,Z),ae.fill(0,0,Z);for(let be=0;be<L;be++)for(let De=0;De<C;De++){const We=Ze.data[4*(be*C+De)+3]/255;if(We===0)continue;const He=(be+_e)*F+De+_e;if(We===1)Ee[He]=0,ae[He]=Ce;else{const Xe=.5-We;Ee[He]=Xe>0?Xe*Xe:0,ae[He]=Xe<0?Xe*Xe:0}}et(Ee,0,0,F,V,F,this.f,this.v,this.z),et(ae,_e,_e,C,L,F,this.f,this.v,this.z);for(let be=0;be<Z;be++){const De=Math.sqrt(Ee[be])-Math.sqrt(ae[be]);J[be]=Math.round(255-255*(De/this.radius+this.cutoff))}return pe}};class st{constructor(){this.specification=a.v.light.position}possiblyEvaluate(r,h){return a.y(r.expression.evaluate(h))}interpolate(r,h,p){return{x:a.z.number(r.x,h.x,p),y:a.z.number(r.y,h.y,p),z:a.z.number(r.z,h.z,p)}}}let Ht;class ii extends a.E{constructor(r){super(),Ht=Ht||new a.q({anchor:new a.D(a.v.light.anchor),position:new st,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ht),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h={}){if(!this._validate(a.r,r,h))for(const p in r){const m=r[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,p){return(!p||p.validate!==!1)&&a.t(this,r.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Ot{constructor(r,h){this.width=r,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,h){const p=r.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(r,h)),this.dashEntry[p]}getDashRanges(r,h,p){const m=[];let v=r.length%2==1?-r[r.length-1]*p:0,E=r[0]*p,C=!0;m.push({left:v,right:E,isDash:C,zeroLength:r[0]===0});let L=r[0];for(let F=1;F<r.length;F++){C=!C;const V=r[F];v=L*p,L+=V,E=L*p,m.push({left:v,right:E,isDash:C,zeroLength:V===0})}return m}addRoundDash(r,h,p){const m=h/2;for(let v=-p;v<=p;v++){const E=this.width*(this.nextRow+p+v);let C=0,L=r[C];for(let F=0;F<this.width;F++){F/L.right>1&&(L=r[++C]);const V=Math.abs(F-L.left),Z=Math.abs(F-L.right),J=Math.min(V,Z);let pe;const fe=v/p*(m+1);if(L.isDash){const _e=m-Math.abs(fe);pe=Math.sqrt(J*J+_e*_e)}else pe=m-Math.sqrt(J*J+fe*fe);this.data[E+F]=Math.max(0,Math.min(255,pe+128))}}}addRegularDash(r){for(let C=r.length-1;C>=0;--C){const L=r[C],F=r[C+1];L.zeroLength?r.splice(C,1):F&&F.isDash===L.isDash&&(F.left=L.left,r.splice(C,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let v=0,E=r[v];for(let C=0;C<this.width;C++){C/E.right>1&&(E=r[++v]);const L=Math.abs(C-E.left),F=Math.abs(C-E.right),V=Math.min(L,F);this.data[m+C]=Math.max(0,Math.min(255,(E.isDash?V:-V)+128))}}addDash(r,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let v=0;for(let C=0;C<r.length;C++)v+=r[C];if(v!==0){const C=this.width/v,L=this.getDashRanges(r,this.width,C);h?this.addRoundDash(L,C,p):this.addRegularDash(L)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=m,this.dirty=!0,E}bind(r){const h=r.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const zt="maplibre_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zt]}numActive(){return Object.keys(this.active).length}}const Mt=Math.floor(S.hardwareConcurrency/2);let ei,Vt;function hi(){return ei||(ei=new Jt),ei}Jt.workerCount=a.B(globalThis)?Math.max(Math.min(Mt,3),1):1;class xi{constructor(r,h){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const v=new a.C(p[m],h);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:r,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,h){for(const p of this.actors)p.registerMessageHandler(r,h)}}function yi(){return Vt||(Vt=new xi(hi(),a.G),Vt.registerMessageHandler("GR",(y,r,h)=>a.m(r,h))),Vt}function Ai(y,r){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*y.width,.5*y.height,1]),a.K(h,h,y.calculatePosMatrix(r.toUnwrapped()))}function ct(y,r,h,p,m,v){const E=function(Z,J,pe){if(Z)for(const fe of Z){const _e=J[fe];if(_e&&_e.source===pe&&_e.type==="fill-extrusion")return!0}else for(const fe in J){const _e=J[fe];if(_e.source===pe&&_e.type==="fill-extrusion")return!0}return!1}(m&&m.layers,r,y.id),C=v.maxPitchScaleFactor(),L=y.tilesIn(p,C,E);L.sort(It);const F=[];for(const Z of L)F.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(r,h,y._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,m,v,C,Ai(y.transform,Z.tileID))});const V=function(Z){const J={},pe={};for(const fe of Z){const _e=fe.queryResults,ae=fe.wrappedTileID,Ee=pe[ae]=pe[ae]||{};for(const Ze in _e){const be=_e[Ze],De=Ee[Ze]=Ee[Ze]||{},We=J[Ze]=J[Ze]||[];for(const He of be)De[He.featureIndex]||(De[He.featureIndex]=!0,We.push(He))}}return J}(F);for(const Z in V)V[Z].forEach(J=>{const pe=J.feature,fe=y.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=fe});return V}function It(y,r){const h=y.tileID,p=r.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function Ne(y,r,h){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(r.transformRequest(y.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(v=>v.id)),m})}class je{constructor(r,h){r&&(h?this.setSouthWest(r).setNorthEast(h):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}setSouthWest(r){return this._sw=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}extend(r){const h=this._sw,p=this._ne;let m,v;if(r instanceof a.M)m=r,v=r;else{if(!(r instanceof je))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(je.convert(r)):this.extend(a.M.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(a.M.convert(r)):this;if(m=r._sw,v=r._ne,!m||!v)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(v.lng,p.lng),p.lat=Math.max(v.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(v.lng,v.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:h,lat:p}=a.M.convert(r);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(r){return r instanceof je?r:r&&new je(r)}static fromLngLat(r,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*r.lat);return new je(new a.M(r.lng-m,r.lat-p),new a.M(r.lng+m,r.lat+p))}}class rt{constructor(r,h,p){this.bounds=je.convert(this.validateBounds(r)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const h=Math.pow(2,r.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),v=Math.ceil(a.N(this.bounds.getEast())*h),E=Math.ceil(a.O(this.bounds.getSouth())*h);return r.x>=p&&r.x<v&&r.y>=m&&r.y<E}}class xt extends a.E{constructor(r,h,p,m){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(a.e(this,r),r.bounds&&(this.tileBounds=new rt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((v,E)=>{r.reloadPromise={resolve:v,reject:E}})}else r.actor=this.dispatcher.getActor(),m="LT";r.abortController=new AbortController;try{const v=yield r.actor.sendAsync({type:m,data:p},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,v)}catch(v){if(delete r.abortController,r.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(r,null)}})}_afterTileLoadWorkerResponse(r,h){if(h&&h.resourceTiming&&(r.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&r.setExpiryData(h),r.loadVectorData(h,this.map.painter),r.reloadPromise){const p=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(p.resolve).catch(p.reject)}}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class we extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(a.e(this,r),r.bounds&&(this.tileBounds=new rt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return a.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const p=yield U.getImage(this.map._requestManager.transformRequest(h,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&r.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,v=m.gl,E=p.data;r.texture=this.map.painter.getTileTexture(E.width),r.texture?r.texture.update(E,{useMipmap:!0}):(r.texture=new ne(m,E,v.RGBA,{useMipmap:!0}),r.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),r.state="loaded"}}catch(p){if(delete r.abortController,r.aborted)r.state="unloaded";else if(p)throw r.state="errored",p}})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class di extends we{constructor(r,h,p,m){super(r,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const m=yield U.getImage(p,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(m&&m.data){const v=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&r.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=a.b(v)&&a.S()?v:yield this.readImageNow(v),C={type:this.type,uid:r.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const L=yield r.actor.sendAsync({type:"LDT",data:C});r.dem=L,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(m){if(delete r.abortController,r.aborted)r.state="unloaded";else if(m)throw r.state="errored",m}})}readImageNow(r){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=r.width+2,p=r.height+2;try{return new a.R({width:h,height:p},yield a.V(r,-1,-1,h,p))}catch{}}return S.getImageData(r,1)})}_getNeighboringTiles(r){const h=r.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,v=h.x===0?r.wrap-1:r.wrap,E=(h.x+1+p)%p,C=h.x+1===p?r.wrap+1:r.wrap,L={};return L[new a.Q(r.overscaledZ,v,h.z,m,h.y).key]={backfilled:!1},L[new a.Q(r.overscaledZ,C,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(L[new a.Q(r.overscaledZ,v,h.z,m,h.y-1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,C,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(L[new a.Q(r.overscaledZ,v,h.z,m,h.y+1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,C,h.z,E,h.y+1).key]={backfilled:!1}),L}unloadTile(r){return a._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}class Ve extends a.E{constructor(r,h,p,m){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:h,offset:p}})}_updateWorkerData(r){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);r?h.dataDiff=r:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(v,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.actor?"RT":"LT";r.actor=this.actor;const p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var $e=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kt extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(r){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield U.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,r&&(this.coordinates=r),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const h=r.map(a.Y.fromLngLat);this.tileID=function(m){let v=1/0,E=1/0,C=-1/0,L=-1/0;for(const J of m)v=Math.min(v,J.x),E=Math.min(E,J.y),C=Math.max(C,J.x),L=Math.max(L,J.y);const F=Math.max(C-v,L-E),V=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),Z=Math.pow(2,V);return new a.a0(V,Math.floor((v+C)/2*Z),Math.floor((E+L)/2*Z))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ne(r,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class vn extends kt{constructor(r,h,p,m){super(r,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const h of r.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const h=this.video.seekable;r<h.start(0)||r>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ne(r,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class bn extends kt{constructor(r,h,p,m){super(r,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ne(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Cn={},er=y=>{switch(y){case"geojson":return Ve;case"image":return kt;case"raster":return we;case"raster-dem":return di;case"vector":return xt;case"video":return vn;case"canvas":return bn}return Cn[y]},tr="RTLPluginLoaded";class Uo extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=yi()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(tr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ki=null;function ut(){return Ki||(Ki=new Uo),Ki}class Hn{constructor(r,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const h=r+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(m,v){const E={};if(!v)return E;for(const C of m){const L=C.layerIds.map(F=>v.getLayer(F)).filter(Boolean);if(L.length!==0){C.layers=L,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(F=>L.filter(V=>V.id===F)[0]));for(const F of L)E[F.id]=C}}return E}(r.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5&&v.hasRTLText){this.hasRTLText=!0,ut().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(v))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(r)}const h=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ne(r,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ne(r,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,h,p,m,v,E,C,L,F,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:E,tileSize:this.tileSize,pixelPosMatrix:V,transform:L,params:C,queryPadding:this.queryPadding*F},r,h,p):{}}querySourceFeatures(r,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),v=h&&h.sourceLayer?h.sourceLayer:"",E=m._geojsonTileLayer||m[v];if(!E)return;const C=a.a6(h&&h.filter),{z:L,x:F,y:V}=this.tileID.canonical,Z={z:L,x:F,y:V};for(let J=0;J<E.length;J++){const pe=E.feature(J);if(C.needGeometry){const ae=a.a7(pe,!0);if(!C.filter(new a.a8(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!C.filter(new a.a8(this.tileID.overscaledZ),pe))continue;const fe=p.getId(pe,v),_e=new a.a9(pe,L,F,V,fe);_e.tile=Z,r.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const h=this.expirationTime;if(r.cacheControl){const p=a.aa(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const v=this.buckets[m],E=v.layers[0].sourceLayer||"_geojsonTileLayer",C=p[E],L=r[E];if(!C||!L||Object.keys(L).length===0)continue;v.update(L,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=h&&h.style&&h.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=S.now()+r}setDependencies(r,h){const p={};for(const m of h)p[m]=!0;this.dependencies[r]=p}hasDependency(r,h){for(const p of r){const m=this.dependencies[p];if(m){for(const v of h)if(m[v])return!0}}return!1}}class wn{constructor(r,h){this.max=r,this.onRemove=h,this.reset()}reset(){for(const r in this.data)for(const h of this.data[r])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(r,h,p){const m=r.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},p)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const h=this.data[r].shift();return h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),h.value}getByKey(r){const h=this.data[r];return h?h[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,h){if(!this.has(r))return this;const p=r.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][m];return this.data[p].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(r){const h=[];for(const p in this.data)for(const m of this.data[p])r(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Lo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,h,p){const m=String(h);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][m]=this.stateChanges[r][m]||{},a.e(this.stateChanges[r][m],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const v in this.state[r])v!==m&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][m]===null){this.deletedStates[r][m]={};for(const v in this.state[r][m])p[v]||(this.deletedStates[r][m][v]=null)}else for(const v in p)this.deletedStates[r]&&this.deletedStates[r][m]&&this.deletedStates[r][m][v]===null&&delete this.deletedStates[r][m][v]}removeFeatureState(r,h,p){if(this.deletedStates[r]===null)return;const m=String(h);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&h!==void 0)this.deletedStates[r][m]!==null&&(this.deletedStates[r][m]=this.deletedStates[r][m]||{},this.deletedStates[r][m][p]=null);else if(h!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][m])for(p in this.deletedStates[r][m]={},this.stateChanges[r][m])this.deletedStates[r][m][p]=null;else this.deletedStates[r][m]=null;else this.deletedStates[r]=null}getState(r,h){const p=String(h),m=a.e({},(this.state[r]||{})[p],(this.stateChanges[r]||{})[p]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const v=this.deletedStates[r][h];if(v===null)return{};for(const E in v)delete m[E]}return m}initializeTileState(r,h){r.setFeatureState(this.state,h)}coalesceChanges(r,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),a.e(this.state[m][E],this.stateChanges[m][E]),v[E]=this.state[m][E];p[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const E in this.state[m])v[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const C of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][C];v[E]=this.state[m][E]}p[m]=p[m]||{},a.e(p[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in r)r[m].setFeatureState(p,h)}}class Vi extends a.E{constructor(r,h,p){super(),this.id=r,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,E,C)=>{const L=new(er(v.type))(m,v,E,C);if(L.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${L.id}`);return L})(r,h,p,this),this._tiles={},this._cache=new wn(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lo,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const h=this._tiles[r];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,h,p)}catch(m){r.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new a.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(r),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(gt).map(r=>r.key)}getRenderableIds(r){const h=[];for(const p in this._tiles)this._isIdRenderable(p,r)&&h.push(this._tiles[p]);return r?h.sort((p,m)=>{const v=p.tileID,E=m.tileID,C=new a.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),L=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-E.overscaledZ||L.y-C.y||L.x-C.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(gt).map(p=>p.key)}hasRenderableParent(r){const h=this.findLoadedParent(r,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(r,h){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(h||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,r,h))})}_tileLoaded(r,h,p){r.timeAdded=S.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(h,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const v=h[m];if(r.neighboringTiles&&r.neighboringTiles[v]){const E=this.getTileByID(v);p(r,E),p(E,r)}}function p(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=v.tileID.canonical.x-m.tileID.canonical.x;const C=v.tileID.canonical.y-m.tileID.canonical.y,L=Math.pow(2,m.tileID.canonical.z),F=v.tileID.key;E===0&&C===0||Math.abs(C)>1||(Math.abs(E)>1&&(Math.abs(E+L)===1?E+=L:Math.abs(E-L)===1&&(E-=L)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,E,C),m.neighboringTiles&&m.neighboringTiles[F]&&(m.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,h,p,m){for(const v in this._tiles){let E=this._tiles[v];if(m[v]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let C=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const F=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[F.key],E&&E.hasData()&&(C=F)}let L=C;for(;L.overscaledZ>h;)if(L=L.scaledTo(L.overscaledZ-1),r[L.key]){m[C.key]=C;break}}}findLoadedParent(r,h){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=r.overscaledZ-1;p>=h;p--){const m=r.scaledTo(p),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(r){const h=this._tiles[r.key];return h&&h.hasData()?h:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const h=Math.ceil(r.width/this._source.tileSize)+1,p=Math.ceil(r.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(r){const h=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,h){const p={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(r,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=r,this.terrain=h,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new a.Q(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(p=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(V=>this._source.hasTile(V)))):p=[];const m=r.coveringZoomLevel(this._source),v=Math.max(m-Vi.maxOverzooming,this._source.minzoom),E=Math.max(m+Vi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const Z of p)if(Z.canonical.z>this._source.minzoom){const J=Z.scaledTo(Z.canonical.z-1);V[J.key]=J;const pe=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));V[pe.key]=pe}p=p.concat(Object.values(V))}const C=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const L=this._updateRetainedTiles(p,m);if(ni(this._source.type)){const V={},Z={},J=Object.keys(L),pe=S.now();for(const fe of J){const _e=L[fe],ae=this._tiles[fe];if(!ae||ae.fadeEndTime!==0&&ae.fadeEndTime<=pe)continue;const Ee=this.findLoadedParent(_e,v);Ee&&(this._addTile(Ee.tileID),V[Ee.tileID.key]=Ee.tileID),Z[fe]=_e}this._retainLoadedChildren(Z,m,E,L);for(const fe in V)L[fe]||(this._coveredTiles[fe]=!0,L[fe]=V[fe]);if(h){const fe={},_e={};for(const ae of p)this._tiles[ae.key].hasData()?fe[ae.key]=ae:_e[ae.key]=ae;for(const ae in _e){const Ee=_e[ae].children(this._source.maxzoom);this._tiles[Ee[0].key]&&this._tiles[Ee[1].key]&&this._tiles[Ee[2].key]&&this._tiles[Ee[3].key]&&(fe[Ee[0].key]=L[Ee[0].key]=Ee[0],fe[Ee[1].key]=L[Ee[1].key]=Ee[1],fe[Ee[2].key]=L[Ee[2].key]=Ee[2],fe[Ee[3].key]=L[Ee[3].key]=Ee[3],delete _e[ae])}for(const ae in _e){const Ee=this.findLoadedParent(_e[ae],this._source.minzoom);if(Ee){fe[Ee.tileID.key]=L[Ee.tileID.key]=Ee.tileID;for(const Ze in fe)fe[Ze].isChildOf(Ee.tileID)&&delete fe[Ze]}}for(const ae in this._tiles)fe[ae]||(this._coveredTiles[ae]=!0)}}for(const V in L)this._tiles[V].clearFadeHold();const F=a.ab(this._tiles,L);for(const V of F){const Z=this._tiles[V];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,h){const p={},m={},v=Math.max(h-Vi.maxOverzooming,this._source.minzoom),E=Math.max(h+Vi.maxUnderzooming,this._source.minzoom),C={};for(const L of r){const F=this._addTile(L);p[L.key]=L,F.hasData()||h<this._source.maxzoom&&(C[L.key]=L)}this._retainLoadedChildren(C,h,E,p);for(const L of r){let F=this._tiles[L.key];if(F.hasData())continue;if(h+1>this._source.maxzoom){const Z=L.children(this._source.maxzoom)[0],J=this.getTile(Z);if(J&&J.hasData()){p[Z.key]=Z;continue}}else{const Z=L.children(this._source.maxzoom);if(p[Z[0].key]&&p[Z[1].key]&&p[Z[2].key]&&p[Z[3].key])continue}let V=F.wasRequested();for(let Z=L.overscaledZ-1;Z>=v;--Z){const J=L.scaledTo(Z);if(m[J.key])break;if(m[J.key]=!0,F=this.getTile(J),!F&&V&&(F=this._addTile(J)),F){const pe=F.hasData();if((V||pe)&&(p[J.key]=J),V=F.wasRequested(),pe)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const h=[];let p,m=this._tiles[r].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;m=v}for(const v of h)this._loadedParentTiles[v]=p}}_addTile(r){let h=this._tiles[r.key];if(h)return h;h=this._cache.getAndRemove(r),h&&(this._setTileReloadTimer(r.key,h),h.tileID=r,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,h)));const p=h;return h||(h=new Hn(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(h,r.key,h.state)),h.uses++,this._tiles[r.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(r,h){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=h.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const h=this._tiles[r];h&&(h.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(r){const h=r.sourceDataType;r.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,h,p){const m=[],v=this.transform;if(!v)return m;const E=p?v.getCameraQueryGeometry(r):r,C=r.map(fe=>v.pointCoordinate(fe,this.terrain)),L=E.map(fe=>v.pointCoordinate(fe,this.terrain)),F=this.getIds();let V=1/0,Z=1/0,J=-1/0,pe=-1/0;for(const fe of L)V=Math.min(V,fe.x),Z=Math.min(Z,fe.y),J=Math.max(J,fe.x),pe=Math.max(pe,fe.y);for(let fe=0;fe<F.length;fe++){const _e=this._tiles[F[fe]];if(_e.holdingForFade())continue;const ae=_e.tileID,Ee=Math.pow(2,v.zoom-_e.tileID.overscaledZ),Ze=h*_e.queryPadding*a.W/_e.tileSize/Ee,be=[ae.getTilePoint(new a.Y(V,Z)),ae.getTilePoint(new a.Y(J,pe))];if(be[0].x-Ze<a.W&&be[0].y-Ze<a.W&&be[1].x+Ze>=0&&be[1].y+Ze>=0){const De=C.map(He=>ae.getTilePoint(He)),We=L.map(He=>ae.getTilePoint(He));m.push({tile:_e,tileID:ae,queryGeometry:De,cameraQueryGeometry:We,scale:Ee})}}return m}getVisibleCoordinates(r){const h=this.getRenderableIds(r).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ni(this._source.type)){const r=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=r)return!0}return!1}setFeatureState(r,h,p){this._state.updateState(r=r||"_geojsonTileLayer",h,p)}removeFeatureState(r,h,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",h,p)}getFeatureState(r,h){return this._state.getState(r=r||"_geojsonTileLayer",h)}setDependencies(r,h,p){const m=this._tiles[r];m&&m.setDependencies(h,p)}reloadTilesForDependencies(r,h){for(const p in this._tiles)this._tiles[p].hasDependency(r,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(r,h))}}function gt(y,r){const h=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return y.overscaledZ-r.overscaledZ||p-h||r.canonical.y-y.canonical.y||r.canonical.x-y.canonical.x}function ni(y){return y==="raster"||y==="image"||y==="video"}Vi.maxOverzooming=10,Vi.maxUnderzooming=3;class Yt{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.ac(r,0,1);let h=1,p=this._distances[h];const m=r*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const v=h-1,E=this._distances[v],C=p-E,L=C>0?(m-E)/C:0;return this.points[v].mult(1-L).add(this.points[h].mult(L))}}function qi(y,r){let h=!0;return y==="always"||y!=="never"&&r!=="never"||(h=!1),h}class _r{constructor(r,h,p){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,p,m,v){this._forEachCell(h,p,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(r,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(r,h,p,m,v,E){this.boxCells[v].push(E)}_insertCircleCell(r,h,p,m,v,E){this.circleCells[v].push(E)}_query(r,h,p,m,v,E,C){if(p<0||r>this.width||m<0||h>this.height)return[];const L=[];if(r<=0&&h<=0&&this.width<=p&&this.height<=m){if(v)return[{key:null,x1:r,y1:h,x2:p,y2:m}];for(let F=0;F<this.boxKeys.length;F++)L.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],Z=this.circles[3*F+1],J=this.circles[3*F+2];L.push({key:this.circleKeys[F],x1:V-J,y1:Z-J,x2:V+J,y2:Z+J})}}else this._forEachCell(r,h,p,m,this._queryCell,L,{hitTest:v,overlapMode:E,seenUids:{box:{},circle:{}}},C);return L}query(r,h,p,m){return this._query(r,h,p,m,!1,null)}hitTest(r,h,p,m,v,E){return this._query(r,h,p,m,!0,v,E).length>0}hitTestCircle(r,h,p,m,v){const E=r-p,C=r+p,L=h-p,F=h+p;if(C<0||E>this.width||F<0||L>this.height)return!1;const V=[];return this._forEachCell(E,L,C,F,this._queryCellCircle,V,{hitTest:!0,overlapMode:m,circle:{x:r,y:h,radius:p},seenUids:{box:{},circle:{}}},v),V.length>0}_queryCell(r,h,p,m,v,E,C,L){const{seenUids:F,hitTest:V,overlapMode:Z}=C,J=this.boxCells[v];if(J!==null){const fe=this.bboxes;for(const _e of J)if(!F.box[_e]){F.box[_e]=!0;const ae=4*_e,Ee=this.boxKeys[_e];if(r<=fe[ae+2]&&h<=fe[ae+3]&&p>=fe[ae+0]&&m>=fe[ae+1]&&(!L||L(Ee))&&(!V||!qi(Z,Ee.overlapMode))&&(E.push({key:Ee,x1:fe[ae],y1:fe[ae+1],x2:fe[ae+2],y2:fe[ae+3]}),V))return!0}}const pe=this.circleCells[v];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!F.circle[_e]){F.circle[_e]=!0;const ae=3*_e,Ee=this.circleKeys[_e];if(this._circleAndRectCollide(fe[ae],fe[ae+1],fe[ae+2],r,h,p,m)&&(!L||L(Ee))&&(!V||!qi(Z,Ee.overlapMode))){const Ze=fe[ae],be=fe[ae+1],De=fe[ae+2];if(E.push({key:Ee,x1:Ze-De,y1:be-De,x2:Ze+De,y2:be+De}),V)return!0}}}return!1}_queryCellCircle(r,h,p,m,v,E,C,L){const{circle:F,seenUids:V,overlapMode:Z}=C,J=this.boxCells[v];if(J!==null){const fe=this.bboxes;for(const _e of J)if(!V.box[_e]){V.box[_e]=!0;const ae=4*_e,Ee=this.boxKeys[_e];if(this._circleAndRectCollide(F.x,F.y,F.radius,fe[ae+0],fe[ae+1],fe[ae+2],fe[ae+3])&&(!L||L(Ee))&&!qi(Z,Ee.overlapMode))return E.push(!0),!0}}const pe=this.circleCells[v];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!V.circle[_e]){V.circle[_e]=!0;const ae=3*_e,Ee=this.circleKeys[_e];if(this._circlesCollide(fe[ae],fe[ae+1],fe[ae+2],F.x,F.y,F.radius)&&(!L||L(Ee))&&!qi(Z,Ee.overlapMode))return E.push(!0),!0}}}_forEachCell(r,h,p,m,v,E,C,L){const F=this._convertToXCellCoord(r),V=this._convertToYCellCoord(h),Z=this._convertToXCellCoord(p),J=this._convertToYCellCoord(m);for(let pe=F;pe<=Z;pe++)for(let fe=V;fe<=J;fe++)if(v.call(this,r,h,p,m,this.xCellCount*fe+pe,E,C,L))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,p,m,v,E){const C=m-r,L=v-h,F=p+E;return F*F>C*C+L*L}_circleAndRectCollide(r,h,p,m,v,E,C){const L=(E-m)/2,F=Math.abs(r-(m+L));if(F>L+p)return!1;const V=(C-v)/2,Z=Math.abs(h-(v+V));if(Z>V+p)return!1;if(F<=L||Z<=V)return!0;const J=F-L,pe=Z-V;return J*J+pe*pe<=p*p}}function ti(y,r,h,p,m){const v=a.F();return r?(a.J(v,v,[1/m,1/m,1]),h||a.ad(v,v,p.angle)):a.K(v,p.labelPlaneMatrix,y),v}function eo(y,r,h,p,m){if(r){const v=a.ae(y);return a.J(v,v,[m,m,1]),h||a.ad(v,v,-p.angle),v}return p.glCoordMatrix}function ln(y,r,h){let p;h?(p=[y.x,y.y,h(y.x,y.y),1],a.af(p,p,r)):(p=[y.x,y.y,0,1],Je(p,p,r));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function me(y,r){return .5+y/r*.5}function W(y,r){const h=y[0]/y[3],p=y[1]/y[3];return h>=-r[0]&&h<=r[0]&&p>=-r[1]&&p<=r[1]}function X(y,r,h,p,m,v,E,C,L,F){const V=p?y.textSizeData:y.iconSizeData,Z=a.ag(V,h.transform.zoom),J=[256/h.width*2+1,256/h.height*2+1],pe=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;pe.clear();const fe=y.lineVertexArray,_e=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,ae=h.transform.width/h.transform.height;let Ee=!1;for(let Ze=0;Ze<_e.length;Ze++){const be=_e.get(Ze);if(be.hidden||be.writingMode===a.ah.vertical&&!Ee){Ge(be.numGlyphs,pe);continue}let De;if(Ee=!1,F?(De=[be.anchorX,be.anchorY,F(be.anchorX,be.anchorY),1],a.af(De,De,r)):(De=[be.anchorX,be.anchorY,0,1],Je(De,De,r)),!W(De,J)){Ge(be.numGlyphs,pe);continue}const We=me(h.transform.cameraToCenterDistance,De[3]),He=a.ai(V,Z,be),Xe=E?He/We:He*We,nt=new a.P(be.anchorX,be.anchorY),it=ln(nt,m,F).point,ft={projections:{},offsets:{}},_t=Me(be,Xe,!1,C,r,m,v,y.glyphOffsetArray,fe,pe,it,nt,ft,ae,L,F);Ee=_t.useVertical,(_t.notEnoughRoom||Ee||_t.needsFlipping&&Me(be,Xe,!0,C,r,m,v,y.glyphOffsetArray,fe,pe,it,nt,ft,ae,L,F).notEnoughRoom)&&Ge(be.numGlyphs,pe)}p?y.text.dynamicLayoutVertexBuffer.updateData(pe):y.icon.dynamicLayoutVertexBuffer.updateData(pe)}function te(y,r,h,p,m,v,E,C,L,F,V,Z,J){const pe=C.glyphStartIndex+C.numGlyphs,fe=C.lineStartIndex,_e=C.lineStartIndex+C.lineLength,ae=r.getoffsetX(C.glyphStartIndex),Ee=r.getoffsetX(pe-1),Ze=Ue(y*ae,h,p,m,v,E,C.segment,fe,_e,L,F,V,Z,J);if(!Ze)return null;const be=Ue(y*Ee,h,p,m,v,E,C.segment,fe,_e,L,F,V,Z,J);return be?{first:Ze,last:be}:null}function de(y,r,h,p){return y===a.ah.horizontal&&Math.abs(h.y-r.y)>Math.abs(h.x-r.x)*p?{useVertical:!0}:(y===a.ah.vertical?r.y<h.y:r.x>h.x)?{needsFlipping:!0}:null}function Me(y,r,h,p,m,v,E,C,L,F,V,Z,J,pe,fe,_e){const ae=r/24,Ee=y.lineOffsetX*ae,Ze=y.lineOffsetY*ae;let be;if(y.numGlyphs>1){const De=y.glyphStartIndex+y.numGlyphs,We=y.lineStartIndex,He=y.lineStartIndex+y.lineLength,Xe=te(ae,C,Ee,Ze,h,V,Z,y,L,v,J,fe,_e);if(!Xe)return{notEnoughRoom:!0};const nt=ln(Xe.first.point,E,_e).point,it=ln(Xe.last.point,E,_e).point;if(p&&!h){const ft=de(y.writingMode,nt,it,pe);if(ft)return ft}be=[Xe.first];for(let ft=y.glyphStartIndex+1;ft<De-1;ft++)be.push(Ue(ae*C.getoffsetX(ft),Ee,Ze,h,V,Z,y.segment,We,He,L,v,J,fe,_e));be.push(Xe.last)}else{if(p&&!h){const We=ln(Z,m,_e).point,He=y.lineStartIndex+y.segment+1,Xe=new a.P(L.getx(He),L.gety(He)),nt=ln(Xe,m,_e),it=nt.signedDistanceFromCamera>0?nt.point:Ie(Z,Xe,We,1,m,_e),ft=de(y.writingMode,We,it,pe);if(ft)return ft}const De=Ue(ae*C.getoffsetX(y.glyphStartIndex),Ee,Ze,h,V,Z,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,L,v,J,fe,_e);if(!De)return{notEnoughRoom:!0};be=[De]}for(const De of be)a.aj(F,De.point,De.angle);return{}}function Ie(y,r,h,p,m,v){const E=ln(y.add(y.sub(r)._unit()),m,v).point,C=h.sub(E);return h.add(C._mult(p/C.mag()))}function Be(y,r){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:v,distanceFromAnchor:E,getElevation:C,previousVertex:L,direction:F,absOffsetX:V}=r;if(h.projections[y])return h.projections[y];const Z=new a.P(p.getx(y),p.gety(y)),J=ln(Z,m,C);if(J.signedDistanceFromCamera>0)return h.projections[y]=J.point,J.point;const pe=y-F;return Ie(E===0?v:new a.P(p.getx(pe),p.gety(pe)),Z,L,V-E+1,m,C)}function ke(y,r,h){return y._unit()._perp()._mult(r*h)}function G(y,r,h,p,m,v,E,C){const{projectionCache:L,direction:F}=C;if(L.offsets[y])return L.offsets[y];const V=h.add(r);if(y+F<p||y+F>=m)return L.offsets[y]=V,V;const Z=Be(y+F,C),J=ke(Z.sub(h),E,F),pe=h.add(J),fe=Z.add(J);return L.offsets[y]=a.ak(v,V,pe,fe)||V,L.offsets[y]}function Ue(y,r,h,p,m,v,E,C,L,F,V,Z,J,pe){const fe=p?y-r:y+r;let _e=fe>0?1:-1,ae=0;p&&(_e*=-1,ae=Math.PI),_e<0&&(ae+=Math.PI);let Ee,Ze,be=_e>0?C+E:C+E+1,De=m,We=m,He=0,Xe=0;const nt=Math.abs(fe),it=[];let ft;for(;He+Xe<=nt;){if(be+=_e,be<C||be>=L)return null;He+=Xe,We=De,Ze=Ee;const yt={projectionCache:Z,lineVertexArray:F,labelPlaneMatrix:V,tileAnchorPoint:v,distanceFromAnchor:He,getElevation:pe,previousVertex:We,direction:_e,absOffsetX:nt};if(De=Be(be,yt),h===0)it.push(We),ft=De.sub(We);else{let Kt;const si=De.sub(We);Kt=si.mag()===0?ke(Be(be+_e,yt).sub(De),h,_e):ke(si,h,_e),Ze||(Ze=We.add(Kt)),Ee=G(be,Kt,De,C,L,Ze,h,yt),it.push(Ze),ft=Ee.sub(Ze)}Xe=ft.mag()}const _t=ft._mult((nt-He)/Xe)._add(Ze||We),oi=ae+Math.atan2(De.y-We.y,De.x-We.x);return it.push(_t),{point:_t,angle:J?oi:0,path:it}}const qe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ge(y,r){for(let h=0;h<y;h++){const p=r.length;r.resize(p+4),r.float32.set(qe,3*p)}}function Je(y,r,h){const p=r[0],m=r[1];return y[0]=h[0]*p+h[4]*m+h[12],y[1]=h[1]*p+h[5]*m+h[13],y[3]=h[3]*p+h[7]*m+h[15],y}const ht=100;class Rt{constructor(r,h=new _r(r.width+200,r.height+200,25),p=new _r(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ht,this.screenBottomBoundary=r.height+ht,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,h,p,m,v,E){const C=this.projectAndGetPerspectiveRatio(m,r.anchorPointX,r.anchorPointY,E),L=p*C.perspectiveRatio,F=r.x1*L+C.point.x,V=r.y1*L+C.point.y,Z=r.x2*L+C.point.x,J=r.y2*L+C.point.y;return!this.isInsideGrid(F,V,Z,J)||h!=="always"&&this.grid.hitTest(F,V,Z,J,h,v)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,V,Z,J],offscreen:this.isOffscreen(F,V,Z,J)}}placeCollisionCircles(r,h,p,m,v,E,C,L,F,V,Z,J,pe,fe){const _e=[],ae=new a.P(h.anchorX,h.anchorY),Ee=ln(ae,E,fe),Ze=me(this.transform.cameraToCenterDistance,Ee.signedDistanceFromCamera),be=(V?v/Ze:v*Ze)/a.ao,De=ln(ae,C,fe).point,We=te(be,m,h.lineOffsetX*be,h.lineOffsetY*be,!1,De,ae,h,p,C,{projections:{},offsets:{}},!1,fe);let He=!1,Xe=!1,nt=!0;if(We){const it=.5*J*Ze+pe,ft=new a.P(-100,-100),_t=new a.P(this.screenRightBoundary,this.screenBottomBoundary),oi=new Yt,yt=We.first,Kt=We.last;let si=[];for(let ci=yt.path.length-1;ci>=1;ci--)si.push(yt.path[ci]);for(let ci=1;ci<Kt.path.length;ci++)si.push(Kt.path[ci]);const Si=2.5*it;if(L){const ci=si.map(pi=>ln(pi,L,fe));si=ci.some(pi=>pi.signedDistanceFromCamera<=0)?[]:ci.map(pi=>pi.point)}let Qt=[];if(si.length>0){const ci=si[0].clone(),pi=si[0].clone();for(let dn=1;dn<si.length;dn++)ci.x=Math.min(ci.x,si[dn].x),ci.y=Math.min(ci.y,si[dn].y),pi.x=Math.max(pi.x,si[dn].x),pi.y=Math.max(pi.y,si[dn].y);Qt=ci.x>=ft.x&&pi.x<=_t.x&&ci.y>=ft.y&&pi.y<=_t.y?[si]:pi.x<ft.x||ci.x>_t.x||pi.y<ft.y||ci.y>_t.y?[]:a.al([si],ft.x,ft.y,_t.x,_t.y)}for(const ci of Qt){oi.reset(ci,.25*it);let pi=0;pi=oi.length<=.5*it?1:Math.ceil(oi.paddedLength/Si)+1;for(let dn=0;dn<pi;dn++){const Ri=dn/Math.max(pi-1,1),Rr=oi.lerp(Ri),On=Rr.x+ht,nn=Rr.y+ht;_e.push(On,nn,it,0);const Nn=On-it,Br=nn-it,vo=On+it,Ho=nn+it;if(nt=nt&&this.isOffscreen(Nn,Br,vo,Ho),Xe=Xe||this.isInsideGrid(Nn,Br,vo,Ho),r!=="always"&&this.grid.hitTestCircle(On,nn,it,r,Z)&&(He=!0,!F))return{circles:[],offscreen:!1,collisionDetected:He}}}}return{circles:!F&&He||!Xe||Ze<this.perspectiveRatioCutoff?[]:_e,offscreen:nt,collisionDetected:He}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,v=-1/0,E=-1/0;for(const V of r){const Z=new a.P(V.x+ht,V.y+ht);p=Math.min(p,Z.x),m=Math.min(m,Z.y),v=Math.max(v,Z.x),E=Math.max(E,Z.y),h.push(Z)}const C=this.grid.query(p,m,v,E).concat(this.ignoredGrid.query(p,m,v,E)),L={},F={};for(const V of C){const Z=V.key;if(L[Z.bucketInstanceId]===void 0&&(L[Z.bucketInstanceId]={}),L[Z.bucketInstanceId][Z.featureIndex])continue;const J=[new a.P(V.x1,V.y1),new a.P(V.x2,V.y1),new a.P(V.x2,V.y2),new a.P(V.x1,V.y2)];a.am(h,J)&&(L[Z.bucketInstanceId][Z.featureIndex]=!0,F[Z.bucketInstanceId]===void 0&&(F[Z.bucketInstanceId]=[]),F[Z.bucketInstanceId].push(Z.featureIndex))}return F}insertCollisionBox(r,h,p,m,v,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,p,m,v,E){const C=p?this.ignoredGrid:this.grid,L={bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h};for(let F=0;F<r.length;F+=4)C.insertCircle(L,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,h,p,m){let v;return m?(v=[h,p,m(h,p),1],a.af(v,v,r)):(v=[h,p,0,1],Je(v,v,r)),{point:new a.P((v[0]/v[3]+1)/2*this.transform.width+ht,(-v[1]/v[3]+1)/2*this.transform.height+ht),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(r,h,p,m){return p<ht||r>=this.screenRightBoundary||m<ht||h>this.screenBottomBoundary}isInsideGrid(r,h,p,m){return p>=0&&r<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const r=a.an([]);return a.H(r,r,[-100,-100,0]),r}}function Xt(y,r,h){return r*(a.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class ai{constructor(r,h,p,m){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class vi{constructor(r,h,p,m,v){this.text=new ai(r?r.text:null,h,p,v),this.icon=new ai(r?r.icon:null,h,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ji{constructor(r,h,p){this.text=r,this.icon=h,this.skipFade=p}}class Mn{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class li{constructor(r,h,p,m,v){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=v}}class cn{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[r]}}function Fn(y,r,h,p,m){const{horizontalAlign:v,verticalAlign:E}=a.at(y);return new a.P(-(v-.5)*r+p[0]*m,-(E-.5)*h+p[1]*m)}function lr(y,r,h,p,m,v){const{x1:E,x2:C,y1:L,y2:F,anchorPointX:V,anchorPointY:Z}=y,J=new a.P(r,h);return p&&J._rotate(m?v:-v),{x1:E+J.x,y1:L+J.y,x2:C+J.x,y2:F+J.y,anchorPointX:V,anchorPointY:Z}}class yr{constructor(r,h,p,m,v){this.transform=r.clone(),this.terrain=h,this.collisionIndex=new Rt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new cn(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,h,p,m){const v=p.getBucket(h),E=p.latestFeatureIndex;if(!v||!E||h.id!==v.layerIds[0])return;const C=p.collisionBoxArray,L=v.layers[0].layout,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/a.W,Z=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),J=L.get("text-pitch-alignment")==="map",pe=L.get("text-rotation-alignment")==="map",fe=Xt(p,1,this.transform.zoom),_e=ti(Z,J,pe,this.transform,fe);let ae=null;if(J){const Ze=eo(Z,J,pe,this.transform,fe);ae=a.K([],this.transform.labelPlaneMatrix,Ze)}this.retainedQueryData[v.bucketInstanceId]=new li(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const Ee={bucket:v,layout:L,posMatrix:Z,textLabelPlaneMatrix:_e,labelToScreenMatrix:ae,scale:F,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:a.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const Ze of v.sortKeyRanges){const{sortKey:be,symbolInstanceStart:De,symbolInstanceEnd:We}=Ze;r.push({sortKey:be,symbolInstanceStart:De,symbolInstanceEnd:We,parameters:Ee})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(r,h,p,m,v,E,C,L,F,V,Z,J,pe,fe,_e,ae){const Ee=a.ap[r.textAnchor],Ze=[r.textOffset0,r.textOffset1],be=Fn(Ee,p,m,Ze,v),De=this.collisionIndex.placeCollisionBox(lr(h,be.x,be.y,E,C,this.transform.angle),Z,L,F,V.predicate,ae);if((!_e||this.collisionIndex.placeCollisionBox(lr(_e,be.x,be.y,E,C,this.transform.angle),Z,L,F,V.predicate,ae).box.length!==0)&&De.box.length>0){let We;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(We=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:Ze,width:p,height:m,anchor:Ee,textBoxScale:v,prevAnchor:We},this.markUsedJustification(pe,Ee,J,fe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,fe,J),this.placedOrientations[J.crossTileID]=fe),{shift:be,placedGlyphBoxes:De}}}placeLayerBucketPart(r,h,p){const{bucket:m,layout:v,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:L,textPixelRatio:F,holdingForFade:V,collisionBoxArray:Z,partiallyEvaluatedTextSize:J,collisionGroup:pe}=r.parameters,fe=v.get("text-optional"),_e=v.get("icon-optional"),ae=a.aq(v,"text-overlap","text-allow-overlap"),Ee=ae==="always",Ze=a.aq(v,"icon-overlap","icon-allow-overlap"),be=Ze==="always",De=v.get("text-rotation-alignment")==="map",We=v.get("text-pitch-alignment")==="map",He=v.get("icon-text-fit")!=="none",Xe=v.get("symbol-z-order")==="viewport-y",nt=Ee&&(be||!m.hasIconData()||_e),it=be&&(Ee||!m.hasTextData()||fe);!m.collisionArrays&&Z&&m.deserializeCollisionBoxes(Z);const ft=this.retainedQueryData[m.bucketInstanceId].tileID,_t=this.terrain?(yt,Kt)=>this.terrain.getElevation(ft,yt,Kt):null,oi=(yt,Kt)=>{var si,Si;if(h[yt.crossTileID])return;if(V)return void(this.placements[yt.crossTileID]=new Ji(!1,!1,!1));let Qt=!1,ci=!1,pi=!0,dn=null,Ri={box:null,offscreen:null},Rr={box:null,offscreen:null},On=null,nn=null,Nn=null,Br=0,vo=0,Ho=0;Kt.textFeatureIndex?Br=Kt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(Br=yt.featureIndex),Kt.verticalTextFeatureIndex&&(vo=Kt.verticalTextFeatureIndex);const Ia=Kt.textBox;if(Ia){const Ln=An=>{let on=a.ah.horizontal;if(m.allowVerticalPlacement&&!An&&this.prevPlacement){const Kr=this.prevPlacement.placedOrientations[yt.crossTileID];Kr&&(this.placedOrientations[yt.crossTileID]=Kr,on=Kr,this.markUsedOrientation(m,on,yt))}return on},rn=(An,on)=>{if(m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Kt.verticalTextBox){for(const Kr of m.writingModes)if(Kr===a.ah.vertical?(Ri=on(),Rr=Ri):Ri=An(),Ri&&Ri.box&&Ri.box.length)break}else Ri=An()},Qi=yt.textAnchorOffsetStartIndex,Xr=yt.textAnchorOffsetEndIndex;if(Xr===Qi){const An=(on,Kr)=>{const Pn=this.collisionIndex.placeCollisionBox(on,ae,F,E,pe.predicate,_t);return Pn&&Pn.box&&Pn.box.length&&(this.markUsedOrientation(m,Kr,yt),this.placedOrientations[yt.crossTileID]=Kr),Pn};rn(()=>An(Ia,a.ah.horizontal),()=>{const on=Kt.verticalTextBox;return m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&on?An(on,a.ah.vertical):{box:null,offscreen:null}}),Ln(Ri&&Ri.box&&Ri.box.length)}else{let An=a.ap[(Si=(si=this.prevPlacement)===null||si===void 0?void 0:si.variableOffsets[yt.crossTileID])===null||Si===void 0?void 0:Si.anchor];const on=(Pn,_n,Fc)=>{const Ah=Pn.x2-Pn.x1,ds=Pn.y2-Pn.y1,fs=yt.textBoxScale,Sl=He&&Ze==="never"?_n:null;let Ko={box:[],offscreen:!1},Oc=ae==="never"?1:2,Ph="never";An&&Oc++;for(let Nc=0;Nc<Oc;Nc++){for(let jc=Qi;jc<Xr;jc++){const Tl=m.textAnchorOffsets.get(jc);if(An&&Tl.textAnchor!==An)continue;const Uc=this.attemptAnchorPlacement(Tl,Pn,Ah,ds,fs,De,We,F,E,pe,Ph,yt,m,Fc,Sl,_t);if(Uc&&(Ko=Uc.placedGlyphBoxes,Ko&&Ko.box&&Ko.box.length))return Qt=!0,dn=Uc.shift,Ko}An?An=null:Ph=ae}return Ko};rn(()=>on(Ia,Kt.iconBox,a.ah.horizontal),()=>{const Pn=Kt.verticalTextBox;return m.allowVerticalPlacement&&!(Ri&&Ri.box&&Ri.box.length)&&yt.numVerticalGlyphVertices>0&&Pn?on(Pn,Kt.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Ri&&(Qt=Ri.box,pi=Ri.offscreen);const Kr=Ln(Ri&&Ri.box);if(!Qt&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[yt.crossTileID];Pn&&(this.variableOffsets[yt.crossTileID]=Pn,this.markUsedJustification(m,Pn.anchor,yt,Kr))}}}if(On=Ri,Qt=On&&On.box&&On.box.length>0,pi=On&&On.offscreen,yt.useRuntimeCollisionCircles){const Ln=m.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),rn=a.ai(m.textSizeData,J,Ln),Qi=v.get("text-padding");nn=this.collisionIndex.placeCollisionCircles(ae,Ln,m.lineVertexArray,m.glyphOffsetArray,rn,E,C,L,p,We,pe.predicate,yt.collisionCircleDiameter,Qi,_t),nn.circles.length&&nn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),Qt=Ee||nn.circles.length>0&&!nn.collisionDetected,pi=pi&&nn.offscreen}if(Kt.iconFeatureIndex&&(Ho=Kt.iconFeatureIndex),Kt.iconBox){const Ln=rn=>{const Qi=He&&dn?lr(rn,dn.x,dn.y,De,We,this.transform.angle):rn;return this.collisionIndex.placeCollisionBox(Qi,Ze,F,E,pe.predicate,_t)};Rr&&Rr.box&&Rr.box.length&&Kt.verticalIconBox?(Nn=Ln(Kt.verticalIconBox),ci=Nn.box.length>0):(Nn=Ln(Kt.iconBox),ci=Nn.box.length>0),pi=pi&&Nn.offscreen}const Xo=fe||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,bo=_e||yt.numIconVertices===0;if(Xo||bo?bo?Xo||(ci=ci&&Qt):Qt=ci&&Qt:ci=Qt=ci&&Qt,Qt&&On&&On.box&&this.collisionIndex.insertCollisionBox(On.box,ae,v.get("text-ignore-placement"),m.bucketInstanceId,Rr&&Rr.box&&vo?vo:Br,pe.ID),ci&&Nn&&this.collisionIndex.insertCollisionBox(Nn.box,Ze,v.get("icon-ignore-placement"),m.bucketInstanceId,Ho,pe.ID),nn&&(Qt&&this.collisionIndex.insertCollisionCircles(nn.circles,ae,v.get("text-ignore-placement"),m.bucketInstanceId,Br,pe.ID),p)){const Ln=m.bucketInstanceId;let rn=this.collisionCircleArrays[Ln];rn===void 0&&(rn=this.collisionCircleArrays[Ln]=new Mn);for(let Qi=0;Qi<nn.circles.length;Qi+=4)rn.circles.push(nn.circles[Qi+0]),rn.circles.push(nn.circles[Qi+1]),rn.circles.push(nn.circles[Qi+2]),rn.circles.push(nn.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new Ji(Qt||nt,ci||it,pi||m.justReloaded),h[yt.crossTileID]=!0};if(Xe){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=m.getSortedSymbolIndexes(this.transform.angle);for(let Kt=yt.length-1;Kt>=0;--Kt){const si=yt[Kt];oi(m.symbolInstances.get(si),m.collisionArrays[si])}}else for(let yt=r.symbolInstanceStart;yt<r.symbolInstanceEnd;yt++)oi(m.symbolInstances.get(yt),m.collisionArrays[yt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(yt.invProjMatrix,E),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(r,h,p,m){let v;v=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const C of E)C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=v>=0&&C!==v?0:p.crossTileID)}markUsedOrientation(r,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,v=h===a.ah.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const C of E)r.text.placedSymbolArray.get(C).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(r):1,v=h?h.opacities:{},E=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const L in this.placements){const F=this.placements[L],V=v[L];V?(this.opacities[L]=new vi(V,m,F.text,F.icon),p=p||F.text!==V.text.placed||F.icon!==V.icon.placed):(this.opacities[L]=new vi(null,m,F.text,F.icon,F.skipFade),p=p||F.text||F.icon)}for(const L in v){const F=v[L];if(!this.opacities[L]){const V=new vi(F,m,!1,!1);V.isHidden()||(this.opacities[L]=V,p=p||F.text.placed||F.icon.placed)}}for(const L in E)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=E[L]);for(const L in C)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=C[L]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h){const p={};for(const m of h){const v=m.getBucket(r);v&&m.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,m.collisionBoxArray)}}updateBucketOpacities(r,h,p){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const m=r.layers[0],v=m.layout,E=new vi(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),L=v.get("icon-allow-overlap"),F=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=v.get("text-rotation-alignment")==="map",Z=v.get("text-pitch-alignment")==="map",J=v.get("icon-text-fit")!=="none",pe=new vi(null,0,C&&(L||!r.hasIconData()||v.get("icon-optional")),L&&(C||!r.hasTextData()||v.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const fe=(_e,ae,Ee)=>{for(let Ze=0;Ze<ae/4;Ze++)_e.opacityVertexArray.emplaceBack(Ee);_e.hasVisibleVertices=_e.hasVisibleVertices||Ee!==aa};for(let _e=0;_e<r.symbolInstances.length;_e++){const ae=r.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Ze,crossTileID:be}=ae;let De=this.opacities[be];h[be]?De=E:De||(De=pe,this.opacities[be]=De),h[be]=!0;const We=ae.numIconVertices>0,He=this.placedOrientations[ae.crossTileID],Xe=He===a.ah.vertical,nt=He===a.ah.horizontal||He===a.ah.horizontalOnly;if(Ee>0||Ze>0){const it=vr(De.text);fe(r.text,Ee,Xe?aa:it),fe(r.text,Ze,nt?aa:it);const ft=De.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(r.text.placedSymbolArray.get(yt).hidden=ft||Xe?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=ft||nt?1:0);const _t=this.variableOffsets[ae.crossTileID];_t&&this.markUsedJustification(r,_t.anchor,ae,He);const oi=this.placedOrientations[ae.crossTileID];oi&&(this.markUsedJustification(r,"left",ae,oi),this.markUsedOrientation(r,oi,ae))}if(We){const it=vr(De.icon),ft=!(J&&ae.verticalPlacedIconSymbolIndex&&Xe);ae.placedIconSymbolIndex>=0&&(fe(r.icon,ae.numIconVertices,ft?it:aa),r.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=De.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(fe(r.icon,ae.numVerticalIconVertices,ft?aa:it),r.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=De.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const it=r.collisionArrays[_e];if(it){let ft=new a.P(0,0);if(it.textBox||it.verticalTextBox){let oi=!0;if(F){const yt=this.variableOffsets[be];yt?(ft=Fn(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),V&&ft._rotate(Z?this.transform.angle:-this.transform.angle)):oi=!1}it.textBox&&Xn(r.textCollisionBox.collisionVertexArray,De.text.placed,!oi||Xe,ft.x,ft.y),it.verticalTextBox&&Xn(r.textCollisionBox.collisionVertexArray,De.text.placed,!oi||nt,ft.x,ft.y)}const _t=!!(!nt&&it.verticalIconBox);it.iconBox&&Xn(r.iconCollisionBox.collisionVertexArray,De.icon.placed,_t,J?ft.x:0,J?ft.y:0),it.verticalIconBox&&Xn(r.iconCollisionBox.collisionVertexArray,De.icon.placed,!_t,J?ft.x:0,J?ft.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=_e.invProjMatrix,r.placementViewportMatrix=_e.viewportMatrix,r.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Xn(y,r,h,p,m){y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0)}const po=Math.pow(2,25),Hu=Math.pow(2,24),Fd=Math.pow(2,17),zi=Math.pow(2,16),oc=Math.pow(2,9),sc=Math.pow(2,8),Pr=Math.pow(2,1);function vr(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const r=y.placed?1:0,h=Math.floor(127*y.opacity);return h*po+r*Hu+h*Fd+r*zi+h*oc+r*sc+h*Pr+r}const aa=0;class $r{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,h,p,m,v){const E=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(E,m,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,L)=>C.sortKey-L.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class Hr{constructor(r,h,p,m,v,E,C,L){this.placement=new yr(r,h,E,C,L),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(r,h,p){const m=S.now(),v=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=h[r[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new $r(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const As=512/a.W/2;class Na{constructor(r,h,p){this.tileID=r,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let v=0;v<h.length;v++){const E=h.get(v),C=E.key,L=m.get(C);L?L.push(E):m.set(C,[E])}for(const[v,E]of m){const C={positions:E.map(L=>({x:Math.floor(L.anchorX*As),y:Math.floor(L.anchorY*As)})),crossTileIDs:E.map(L=>L.crossTileID)};if(C.positions.length>128){const L=new a.au(C.positions.length,16,Uint16Array);for(const{x:F,y:V}of C.positions)L.add(F,V);L.finish(),delete C.positions,C.index=L}this._symbolsByKey[v]=C}}getScaledCoordinates(r,h){const{x:p,y:m,z:v}=this.tileID.canonical,{x:E,y:C,z:L}=h.canonical,F=As/Math.pow(2,L-v),V=(C*a.W+r.anchorY)*F,Z=m*a.W*As;return{x:Math.floor((E*a.W+r.anchorX)*F-p*a.W*As),y:Math.floor(V-Z)}}findMatches(r,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<r.length;v++){const E=r.get(v);if(E.crossTileID)continue;const C=this._symbolsByKey[E.key];if(!C)continue;const L=this.getScaledCoordinates(E,h);if(C.index){const F=C.index.range(L.x-m,L.y-m,L.x+m,L.y+m).sort();for(const V of F){const Z=C.crossTileIDs[V];if(!p[Z]){p[Z]=!0,E.crossTileID=Z;break}}}else if(C.positions)for(let F=0;F<C.positions.length;F++){const V=C.positions[F],Z=C.crossTileIDs[F];if(Math.abs(V.x-L.x)<=m&&Math.abs(V.y-L.y)<=m&&!p[Z]){p[Z]=!0,E.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class In{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class la{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const h=Math.round((r-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],v={};for(const E in m){const C=m[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),v[C.tileID.key]=C}this.indexes[p]=v}this.lng=r}addBucket(r,h,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const m=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>r.overscaledZ)for(const C in E){const L=E[C];L.tileID.isChildOf(r)&&L.findMatches(h.symbolInstances,r,m)}else{const C=E[r.scaledTo(Number(v)).key];C&&C.findMatches(h.symbolInstances,r,m)}}for(let v=0;v<h.symbolInstances.length;v++){const E=h.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),m[E.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Na(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[r][m]}removeStaleBuckets(r){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const v in m)r[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[v]),delete m[v],h=!0)}return h}}class Vo{constructor(){this.layerIndexes={},this.crossTileIDs=new In,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,p){let m=this.layerIndexes[r.id];m===void 0&&(m=this.layerIndexes[r.id]=new la);let v=!1;const E={};m.handleWrapJump(p);for(const C of h){const L=C.getBucket(r);L&&r.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(C.tileID,L,this.crossTileIDs)&&(v=!0),E[L.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(r){const h={};r.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const tn=(y,r)=>a.t(y,r&&r.filter(h=>h.identifier!=="source.canvas")),ja=a.av();class zr extends a.E{constructor(r,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=r,this.dispatcher=new xi(hi(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Ke,this.imageManager.setEventedParent(this),this.glyphManager=new pt(r._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ot(256,512),this.crossTileSymbolIndex=new Vo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),ut().on(tr,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const v=m.getSource();if(v&&v.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===v.id&&this._validateLayer(C)}})}loadURL(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,h,p)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new a.j(v))})}loadJSON(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(r,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(ja,{validate:!1})}_load(r,h,p){var m;const v=h.transformStyle?h.transformStyle(p,r):r;if(!h.validate||!tn(this,a.x(v))){this._loaded=!0,this.stylesheet=v;for(const E in v.sources)this.addSource(E,v.sources[E],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new ii(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const r=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",r),this._order=r.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of r){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(r,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,E,C,L){return a._(this,void 0,void 0,function*(){const F=Oe(v),V=C>1?"@2x":"",Z={},J={};for(const{id:pe,url:fe}of F){const _e=E.transformRequest(E.normalizeSpriteURL(fe,V,".json"),"SpriteJSON");Z[pe]=a.h(_e,L);const ae=E.transformRequest(E.normalizeSpriteURL(fe,V,".png"),"SpriteImage");J[pe]=U.getImage(ae,L)}return yield Promise.all([...Object.values(Z),...Object.values(J)]),function(pe,fe){return a._(this,void 0,void 0,function*(){const _e={};for(const ae in pe){_e[ae]={};const Ee=S.getImageCanvasContext((yield fe[ae]).data),Ze=(yield pe[ae]).data;for(const be in Ze){const{width:De,height:We,x:He,y:Xe,sdf:nt,pixelRatio:it,stretchX:ft,stretchY:_t,content:oi}=Ze[be];_e[ae][be]={data:null,pixelRatio:it,sdf:nt,stretchX:ft,stretchY:_t,content:oi,spriteData:{width:De,height:We,x:He,y:Xe,context:Ee}}}}return _e})}(Z,J)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const E in v){this._spritesImagesIds[E]=[];const C=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(L=>!(L in v)):[];for(const L of C)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in v[E]){const F=E==="default"?L:`${E}:${L}`;this._spritesImagesIds[E].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,v[E][L],!1):this.imageManager.addImage(F,v[E][L]),h&&(this._changedImages[F]=!0)}}}).catch(v=>{this._spriteRequest=null,m=v,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(r){const h=this.sourceCaches[r.source];if(!h)return;const p=r.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const h=this._serializedAllLayers();if(!r||r.length===0)return Object.values(h);const p=[];for(const m of r)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(r[p]=m.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const E in this._updatedSources){const C=this._updatedSources[E];if(C==="reload")this._reloadSource(E);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];p[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in p){const v=this.sourceCaches[m];!!p[m]!=!!v.used&&v.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(r),this.z=r.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,h={}){var p;this._checkLoaded();const m=this.serialize();if(r=h.transformStyle?h.transformStyle(m,r):r,((p=h.validate)===null||p===void 0||p)&&tn(this,a.x(r)))return!1;(r=a.aA(r)).layers=a.ay(r.layers);const v=a.aB(m,r),E=this._getOperationsToPerform(v);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const C of E.operations)C();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const h=[],p=[];for(const m of r)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(r,h){if(this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,h),this._afterImageUpdated(r)}updateImage(r,h){this.imageManager.updateImage(r,h)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,h,p={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${r}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[r]=new Vi(r,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:r})),m.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===r)return this.fire(new a.j(new Error(`Source "${r}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,h){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const p=this.sourceCaches[r].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,h,p={}){this._checkLoaded();const m=r.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let v;if(r.type==="custom"){if(tn(this,a.aC(r)))return;v=a.az(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(m,r.source),r=a.aA(r),r=a.e(r,{source:m})),this._validate(a.x.layer,`layers.${m}`,r,{arrayIndex:-1},p))return;v=a.az(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(r,h){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===h)return;const p=this._order.indexOf(r);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${r}" before non-existing layer "${h}".`))):(this._order.splice(m,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const h=this._layers[r];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${r}".`)));h.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=h,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],h.onRemove&&h.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,h,p){this._checkLoaded();const m=this.getLayer(r);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,h,p={}){this._checkLoaded();const m=this.getLayer(r);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return a.aA(this.getLayer(r).filter)}setLayoutProperty(r,h,p,m={}){this._checkLoaded();const v=this.getLayer(r);v?a.aD(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,m),this._updateLayer(v)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,h){const p=this.getLayer(r);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,h,p,m={}){this._checkLoaded();const v=this.getLayer(r);v?a.aD(v.getPaintProperty(h),p)||(v.setPaintProperty(h,p,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,h){return this.getLayer(r).getPaintProperty(h)}setFeatureState(r,h){this._checkLoaded();const p=r.source,m=r.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.getSource().type;E==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,r.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,h){this._checkLoaded();const p=r.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const v=m.getSource().type,E=v==="vector"?r.sourceLayer:void 0;v!=="vector"||E?h&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,r.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const h=r.source,p=r.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,r.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=a.aE(this.sourceCaches,v=>v.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:r,layers:h,terrain:p},v=>v!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const h=E=>this._layers[E].type==="fill-extrusion",p={},m=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C)){p[C]=E;for(const L of r){const F=L[C];if(F)for(const V of F)m.push(V)}}}m.sort((E,C)=>C.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C))for(let L=m.length-1;L>=0;L--){const F=m[L].feature;if(p[F.layer.id]<E)break;v.push(F),m.pop()}else for(const L of r){const F=L[C];if(F)for(const V of F)v.push(V.feature)}}return v}queryRenderedFeatures(r,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const C of h.layers){const L=this._layers[C];if(!L)return this.fire(new a.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[L.source]=!0}}const v=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const C in this.sourceCaches)h.layers&&!m[C]||v.push(ct(this.sourceCaches[C],this._layers,E,r,h,p));return this.placement&&v.push(function(C,L,F,V,Z,J,pe){const fe={},_e=J.queryRenderedSymbols(V),ae=[];for(const Ee of Object.keys(_e).map(Number))ae.push(pe[Ee]);ae.sort(It);for(const Ee of ae){const Ze=Ee.featureIndex.lookupSymbolFeatures(_e[Ee.bucketInstanceId],L,Ee.bucketIndex,Ee.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,C);for(const be in Ze){const De=fe[be]=fe[be]||[],We=Ze[be];We.sort((He,Xe)=>{const nt=Ee.featureSortOrder;if(nt){const it=nt.indexOf(He.featureIndex);return nt.indexOf(Xe.featureIndex)-it}return Xe.featureIndex-He.featureIndex});for(const He of We)De.push(He)}}for(const Ee in fe)fe[Ee].forEach(Ze=>{const be=Ze.feature,De=F[C[Ee].source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=De});return fe}(this._layers,E,this.sourceCaches,r,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[r];return p?function(m,v){const E=m.getRenderableIds().map(F=>m.getTileByID(F)),C=[],L={};for(let F=0;F<E.length;F++){const V=E[F],Z=V.tileID.canonical.key;L[Z]||(L[Z]=!0,V.querySourceFeatures(C,v))}return C}(p,h):[]}getLight(){return this.light.getLight()}setLight(r,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const E in r)if(!a.aD(r[E],p[E])){m=!0;break}if(!m)return;const v={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,h),this.light.updateTransitions(v)}_validate(r,h,p,m,v={}){return(!v||v.validate!==!1)&&tn(this,r.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ut().off(tr,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const h in this.sourceCaches)this.sourceCaches[h].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,h,p,m,v=!1){let E=!1,C=!1;const L={};for(const F of this._order){const V=this._layers[F];if(V.type!=="symbol")continue;if(!L[V.source]){const J=this.sourceCaches[V.source];L[V.source]=J.getRenderableIds(!0).map(pe=>J.getTileByID(pe)).sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(V,L[V.source],r.center.lng);E=E||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),r.zoom))&&(this.pauseablePlacement=new Hr(r,this.map.terrain,this._order,v,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const F of this._order){const V=this._layers[F];V.type==="symbol"&&this.placement.updateLayerOpacities(V,L[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,h={}){this._checkLoaded(),r&&this._validate(a.x.glyphs,"glyphs",r,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,h,p={},m){this._checkLoaded();const v=[{id:r,url:h}],E=[...Oe(this.stylesheet.sprite),...v];this._validate(a.x.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(v,!0,m))}removeSprite(r){this._checkLoaded();const h=Oe(this.stylesheet.sprite);if(h.find(p=>p.id===r)){if(this._spritesImagesIds[r])for(const p of this._spritesImagesIds[r])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===r),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Oe(this.stylesheet.sprite)}setSprite(r,h={},p){this._checkLoaded(),r&&this._validate(a.x.sprite,"sprite",r,null,h)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,p):(this._unloadSprite(),p&&p(null)))}}var Ua=a.X([{name:"a_pos",type:"Int16",components:2}]),mo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ca={prelude:Di(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Di(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Di(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Di("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Di(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Di(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Di("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",mo),terrainDepth:Di("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",mo),terrainCoords:Di("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",mo)};function Di(y,r){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=v?v.concat(m):m,C={};return{fragmentSource:y=y.replace(h,(L,F,V,Z,J)=>(C[J]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
varying ${V} ${Z} ${J};
#else
uniform ${V} ${Z} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${V} ${Z} ${J} = u_${J};
#endif
`)),vertexSource:r=r.replace(h,(L,F,V,Z,J)=>{const pe=Z==="float"?"vec2":"vec4",fe=J.match(/color/)?"color":pe;return C[J]?F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${V} ${pe} a_${J};
varying ${V} ${Z} ${J};
#else
uniform ${V} ${Z} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${V} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${V} ${Z} ${J} = u_${J};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${V} ${pe} a_${J};
#else
uniform ${V} ${Z} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${V} ${Z} ${J} = a_${J};
#else
    ${V} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${V} ${Z} ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${V} ${Z} ${J} = u_${J};
#endif
`}),staticAttributes:p,staticUniforms:E}}class Va{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,h,p,m,v,E,C,L,F){this.context=r;let V=this.boundPaintVertexBuffers.length!==m.length;for(let Z=0;!V&&Z<m.length;Z++)this.boundPaintVertexBuffers[Z]!==m[Z]&&(V=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||V||this.boundIndexBuffer!==v||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==L||this.boundDynamicVertexBuffer3!==F?this.freshBind(h,p,m,v,E,C,L,F):(r.bindVertexArray.set(this.vao),C&&C.bind(),v&&v.dynamicDraw&&v.bind(),L&&L.bind(),F&&F.bind())}freshBind(r,h,p,m,v,E,C,L){const F=r.numAttributes,V=this.context,Z=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=L,h.enableAttributes(Z,r);for(const J of p)J.enableAttributes(Z,r);E&&E.enableAttributes(Z,r),C&&C.enableAttributes(Z,r),L&&L.enableAttributes(Z,r),h.bind(),h.setVertexAttribPointers(Z,r,v);for(const J of p)J.bind(),J.setVertexAttribPointers(Z,r,v);E&&(E.bind(),E.setVertexAttribPointers(Z,r,v)),m&&m.bind(),C&&(C.bind(),C.setVertexAttribPointers(Z,r,v)),L&&(L.bind(),L.setVertexAttribPointers(Z,r,v)),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ps(y){const r=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const p=y[h].split(" ");r.push(p.pop())}return r}class qo{constructor(r,h,p,m,v,E){const C=r.gl;this.program=C.createProgram();const L=Ps(h.staticAttributes),F=p?p.getBinderAttributes():[],V=L.concat(F),Z=ca.prelude.staticUniforms?Ps(ca.prelude.staticUniforms):[],J=h.staticUniforms?Ps(h.staticUniforms):[],pe=p?p.getBinderUniforms():[],fe=Z.concat(J).concat(pe),_e=[];for(const He of fe)_e.indexOf(He)<0&&_e.push(He);const ae=p?p.defines():[];v&&ae.push("#define OVERDRAW_INSPECTOR;"),E&&ae.push("#define TERRAIN3D;");const Ee=ae.concat(ca.prelude.fragmentSource,h.fragmentSource).join(`
`),Ze=ae.concat(ca.prelude.vertexSource,h.vertexSource).join(`
`),be=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(be,Ee),C.compileShader(be),!C.getShaderParameter(be,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(be)}`);C.attachShader(this.program,be);const De=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(De,Ze),C.compileShader(De),!C.getShaderParameter(De,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(De)}`);C.attachShader(this.program,De),this.attributes={};const We={};this.numAttributes=V.length;for(let He=0;He<this.numAttributes;He++)V[He]&&(C.bindAttribLocation(this.program,He,V[He]),this.attributes[V[He]]=He);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(De),C.deleteShader(be);for(let He=0;He<_e.length;He++){const Xe=_e[He];if(Xe&&!We[Xe]){const nt=C.getUniformLocation(this.program,Xe);nt&&(We[Xe]=nt)}}this.fixedUniforms=m(r,We),this.terrainUniforms=((He,Xe)=>({u_depth:new a.aG(He,Xe.u_depth),u_terrain:new a.aG(He,Xe.u_terrain),u_terrain_dim:new a.aH(He,Xe.u_terrain_dim),u_terrain_matrix:new a.aI(He,Xe.u_terrain_matrix),u_terrain_unpack:new a.aJ(He,Xe.u_terrain_unpack),u_terrain_exaggeration:new a.aH(He,Xe.u_terrain_exaggeration)}))(r,We),this.binderUniforms=p?p.getUniforms(r,We):[]}draw(r,h,p,m,v,E,C,L,F,V,Z,J,pe,fe,_e,ae,Ee,Ze){const be=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(m),r.setColorMode(v),r.setCullFace(E),L){r.activeTexture.set(be.TEXTURE2),be.bindTexture(be.TEXTURE_2D,L.depthTexture),r.activeTexture.set(be.TEXTURE3),be.bindTexture(be.TEXTURE_2D,L.texture);for(const We in this.terrainUniforms)this.terrainUniforms[We].set(L[We])}for(const We in this.fixedUniforms)this.fixedUniforms[We].set(C[We]);_e&&_e.setUniforms(r,this.binderUniforms,pe,{zoom:fe});let De=0;switch(h){case be.LINES:De=2;break;case be.TRIANGLES:De=3;break;case be.LINE_STRIP:De=1}for(const We of J.get()){const He=We.vaos||(We.vaos={});(He[F]||(He[F]=new Va)).bind(r,this,V,_e?_e.getPaintVertexBuffers():[],Z,We.vertexOffset,ae,Ee,Ze),be.drawElements(h,We.primitiveLength*De,be.UNSIGNED_SHORT,We.primitiveOffset*De*2)}}}function qa(y,r,h){const p=1/Xt(h,1,r.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,r.transform.tileZoom)/m,E=v*(h.tileID.canonical.x+h.tileID.wrap*m),C=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const ua=(y,r,h,p)=>{const m=r.style.light,v=m.properties.get("position"),E=[v.x,v.y,v.z],C=function(){var F=new a.A(9);return a.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();m.properties.get("anchor")==="viewport"&&function(F,V){var Z=Math.sin(V),J=Math.cos(V);F[0]=J,F[1]=Z,F[2]=0,F[3]=-Z,F[4]=J,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(C,-r.transform.angle),function(F,V,Z){var J=V[0],pe=V[1],fe=V[2];F[0]=J*Z[0]+pe*Z[3]+fe*Z[6],F[1]=J*Z[1]+pe*Z[4]+fe*Z[7],F[2]=J*Z[2]+pe*Z[5]+fe*Z[8]}(E,E,C);const L=m.properties.get("color");return{u_matrix:y,u_lightpos:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+h,u_opacity:p}},Od=(y,r,h,p,m,v,E)=>a.e(ua(y,r,h,p),qa(v,r,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),Xu=y=>({u_matrix:y}),Za=(y,r,h,p)=>a.e(Xu(y),qa(h,r,p)),Nd=(y,r)=>({u_matrix:y,u_world:r}),Ku=(y,r,h,p,m)=>a.e(Za(y,r,h,p),{u_world:m}),jd=(y,r,h,p)=>{const m=y.transform;let v,E;if(p.paint.get("circle-pitch-alignment")==="map"){const C=Xt(h,1,m.zoom);v=!0,E=[C,C]}else v=!1,E=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(r.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E}},Ju=(y,r,h)=>{const p=Xt(h,1,r.zoom),m=Math.pow(2,r.zoom-h.tileID.overscaledZ),v=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[r.pixelsToGLUnits[0]/(p*m),r.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:v}},Yu=(y,r,h=1)=>({u_matrix:y,u_color:r,u_overlay:0,u_overlay_scale:h}),Ga=y=>({u_matrix:y}),Qu=(y,r,h,p)=>({u_matrix:y,u_extrude_scale:Xt(r,1,h),u_intensity:p});function eh(y,r){const h=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const Wa=(y,r,h,p)=>{const m=y.transform;return{u_matrix:ha(y,r,h,p),u_ratio:1/Xt(r,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},th=(y,r,h,p,m)=>a.e(Wa(y,r,h,m),{u_image:0,u_image_height:p}),rs=(y,r,h,p,m)=>{const v=y.transform,E=Dr(r,v);return{u_matrix:ha(y,r,h,m),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Xt(r,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},$a=(y,r,h,p,m,v)=>{const E=y.lineAtlas,C=Dr(r,y.transform),L=h.layout.get("line-cap")==="round",F=E.getDash(p.from,L),V=E.getDash(p.to,L),Z=F.width*m.fromScale,J=V.width*m.toScale;return a.e(Wa(y,r,h,v),{u_patternscale_a:[C/Z,-F.height/2],u_patternscale_b:[C/J,-V.height/2],u_sdfgamma:E.width/(256*Math.min(Z,J)*y.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:V.y,u_mix:m.t})};function Dr(y,r){return 1/Xt(y,1,r.tileZoom)}function ha(y,r,h,p){return y.translatePosMatrix(p?p.posMatrix:r.tileID.posMatrix,r,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ha=(y,r,h,p,m)=>{return{u_matrix:y,u_tl_parent:r,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:da(m.paint.get("raster-hue-rotate"))};var v,E};function da(y){y*=Math.PI/180;const r=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}const fa=(y,r,h,p,m,v,E,C,L,F)=>{const V=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:V.width/V.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+L,u_pitch_with_map:+p,u_texsize:F,u_texture:0}},pa=(y,r,h,p,m,v,E,C,L,F,V)=>{const Z=m.transform;return a.e(fa(y,r,h,p,m,v,E,C,L,F),{u_gamma_scale:p?Math.cos(Z._pitch)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+V})},ma=(y,r,h,p,m,v,E,C,L,F)=>a.e(pa(y,r,h,p,m,v,E,C,!0,L,!0),{u_texsize_icon:F,u_texture_icon:1}),Ud=(y,r,h)=>({u_matrix:y,u_opacity:r,u_color:h}),Vd=(y,r,h,p,m,v)=>a.e(function(E,C,L,F){const V=L.imageManager.getPattern(E.from.toString()),Z=L.imageManager.getPattern(E.to.toString()),{width:J,height:pe}=L.imageManager.getPixelSize(),fe=Math.pow(2,F.tileID.overscaledZ),_e=F.tileSize*Math.pow(2,L.transform.tileZoom)/fe,ae=_e*(F.tileID.canonical.x+F.tileID.wrap*fe),Ee=_e*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[J,pe],u_mix:C.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Xt(F,1,L.transform.tileZoom),u_pixel_coord_upper:[ae>>16,Ee>>16],u_pixel_coord_lower:[65535&ae,65535&Ee]}}(p,v,h,m),{u_matrix:y,u_opacity:r}),ih={fillExtrusion:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_opacity:new a.aH(y,r.u_opacity)}),fillExtrusionPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_height_factor:new a.aH(y,r.u_height_factor),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade),u_opacity:new a.aH(y,r.u_opacity)}),fill:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),fillPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),fillOutline:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world)}),fillOutlinePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),circle:(y,r)=>({u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,r.u_scale_with_map),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_matrix:new a.aI(y,r.u_matrix)}),collisionBox:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,r.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_overscale_factor:new a.aH(y,r.u_overscale_factor)}),collisionCircle:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_inv_matrix:new a.aI(y,r.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_viewport_size:new a.aL(y,r.u_viewport_size)}),debug:(y,r)=>({u_color:new a.aM(y,r.u_color),u_matrix:new a.aI(y,r.u_matrix),u_overlay:new a.aG(y,r.u_overlay),u_overlay_scale:new a.aH(y,r.u_overlay_scale)}),clippingMask:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),heatmap:(y,r)=>({u_extrude_scale:new a.aH(y,r.u_extrude_scale),u_intensity:new a.aH(y,r.u_intensity),u_matrix:new a.aI(y,r.u_matrix)}),heatmapTexture:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_color_ramp:new a.aG(y,r.u_color_ramp),u_opacity:new a.aH(y,r.u_opacity)}),hillshade:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_latrange:new a.aL(y,r.u_latrange),u_light:new a.aL(y,r.u_light),u_shadow:new a.aM(y,r.u_shadow),u_highlight:new a.aM(y,r.u_highlight),u_accent:new a.aM(y,r.u_accent)}),hillshadePrepare:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_dimension:new a.aL(y,r.u_dimension),u_zoom:new a.aH(y,r.u_zoom),u_unpack:new a.aJ(y,r.u_unpack)}),line:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels)}),lineGradient:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_image:new a.aG(y,r.u_image),u_image_height:new a.aH(y,r.u_image_height)}),linePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texsize:new a.aL(y,r.u_texsize),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_image:new a.aG(y,r.u_image),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),lineSDF:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_patternscale_a:new a.aL(y,r.u_patternscale_a),u_patternscale_b:new a.aL(y,r.u_patternscale_b),u_sdfgamma:new a.aH(y,r.u_sdfgamma),u_image:new a.aG(y,r.u_image),u_tex_y_a:new a.aH(y,r.u_tex_y_a),u_tex_y_b:new a.aH(y,r.u_tex_y_b),u_mix:new a.aH(y,r.u_mix)}),raster:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_tl_parent:new a.aL(y,r.u_tl_parent),u_scale_parent:new a.aH(y,r.u_scale_parent),u_buffer_scale:new a.aH(y,r.u_buffer_scale),u_fade_t:new a.aH(y,r.u_fade_t),u_opacity:new a.aH(y,r.u_opacity),u_image0:new a.aG(y,r.u_image0),u_image1:new a.aG(y,r.u_image1),u_brightness_low:new a.aH(y,r.u_brightness_low),u_brightness_high:new a.aH(y,r.u_brightness_high),u_saturation_factor:new a.aH(y,r.u_saturation_factor),u_contrast_factor:new a.aH(y,r.u_contrast_factor),u_spin_weights:new a.aK(y,r.u_spin_weights)}),symbolIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture)}),symbolSDF:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),symbolTextAndIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texsize_icon:new a.aL(y,r.u_texsize_icon),u_texture:new a.aG(y,r.u_texture),u_texture_icon:new a.aG(y,r.u_texture_icon),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),background:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_color:new a.aM(y,r.u_color)}),backgroundPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_image:new a.aG(y,r.u_image),u_pattern_tl_a:new a.aL(y,r.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,r.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,r.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,r.u_pattern_br_b),u_texsize:new a.aL(y,r.u_texsize),u_mix:new a.aH(y,r.u_mix),u_pattern_size_a:new a.aL(y,r.u_pattern_size_a),u_pattern_size_b:new a.aL(y,r.u_pattern_size_b),u_scale_a:new a.aH(y,r.u_scale_a),u_scale_b:new a.aH(y,r.u_scale_b),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,r.u_tile_units_to_pixels)}),terrain:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainDepth:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainCoords:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_terrain_coords_id:new a.aH(y,r.u_terrain_coords_id),u_ele_delta:new a.aH(y,r.u_ele_delta)})};class qd{constructor(r,h,p){this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const os={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xa{constructor(r,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&r.enableVertexAttribArray(m)}}setVertexAttribPointers(r,h,p){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],E=h.attributes[v.name];E!==void 0&&r.vertexAttribPointer(E,v.components,r[os[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const cr=new WeakMap;function ir(y){var r;if(cr.has(y))return cr.get(y);{const h=(r=y.getParameter(y.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return cr.set(y,h),h}}class Mi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ka extends Mi{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ja extends Mi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ac extends Mi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class lc extends Mi{getDefault(){return[!0,!0,!0,!0]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ya extends Mi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class cc extends Mi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class uc extends Mi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Qa extends Mi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class nh extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class rh extends Mi{getDefault(){return[0,1]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class zs extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class Zd extends Mi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Gd extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class Wd extends Mi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class $d extends Mi{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Hd extends Mi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Xd extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class hc extends Mi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class el extends Mi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class dc extends Mi{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class fc extends Mi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ds extends Mi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class oh extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class sh extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class pc extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ss extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ah extends Mi{getDefault(){return null}set(r){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Rs extends Mi{getDefault(){return null}set(r){var h;if(r===this.current&&!this.dirty)return;const p=this.gl;ir(p)?p.bindVertexArray(r):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Bs extends Mi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class lh extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class mc extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ei extends Mi{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class tl extends Ei{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Kd extends Ei{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ch extends Ei{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ga{constructor(r,h,p,m,v){this.context=r,this.width=h,this.height=p;const E=r.gl,C=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new tl(r,C),m)this.depthAttachment=v?new ch(r,C):new Kd(r,C);else if(v)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,h=this.colorAttachment.get();if(h&&r.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class xn{constructor(r,h,p){this.blendFunction=r,this.blendColor=h,this.mask=p}}xn.Replace=[1,0],xn.disabled=new xn(xn.Replace,a.aO.transparent,[!1,!1,!1,!1]),xn.unblended=new xn(xn.Replace,a.aO.transparent,[!0,!0,!0,!0]),xn.alphaBlended=new xn([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Jd{constructor(r){var h,p;if(this.gl=r,this.clearColor=new Ka(this),this.clearDepth=new Ja(this),this.clearStencil=new ac(this),this.colorMask=new lc(this),this.depthMask=new Ya(this),this.stencilMask=new cc(this),this.stencilFunc=new uc(this),this.stencilOp=new Qa(this),this.stencilTest=new nh(this),this.depthRange=new rh(this),this.depthTest=new zs(this),this.depthFunc=new Zd(this),this.blend=new Gd(this),this.blendFunc=new Wd(this),this.blendColor=new $d(this),this.blendEquation=new Hd(this),this.cullFace=new Xd(this),this.cullFaceSide=new hc(this),this.frontFace=new el(this),this.program=new dc(this),this.activeTexture=new fc(this),this.viewport=new Ds(this),this.bindFramebuffer=new oh(this),this.bindRenderbuffer=new sh(this),this.bindTexture=new pc(this),this.bindVertexBuffer=new ss(this),this.bindElementBuffer=new ah(this),this.bindVertexArray=new Rs(this),this.pixelStoreUnpack=new Bs(this),this.pixelStoreUnpackPremultiplyAlpha=new lh(this),this.pixelStoreUnpackFlipY=new mc(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),ir(r)){this.HALF_FLOAT=r.HALF_FLOAT;const m=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=r.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=r.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const m=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h){return new qd(this,r,h)}createVertexBuffer(r,h,p){return new Xa(this,r,h,p)}createRenderbuffer(r,h,p){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,r,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(r,h,p,m){return new ga(this,r,h,p,m)}clear({color:r,depth:h,stencil:p}){const m=this.gl;let v=0;r&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(v)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){a.aD(r.blendFunction,xn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return ir(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var h;return ir(this.gl)?this.gl.deleteVertexArray(r):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class ki{constructor(r,h,p){this.func=r,this.mask=h,this.range=p}}ki.ReadOnly=!1,ki.ReadWrite=!0,ki.disabled=new ki(519,ki.ReadOnly,[0,1]);const gc=7680;class Wi{constructor(r,h,p,m,v,E){this.test=r,this.ref=h,this.mask=p,this.fail=m,this.depthFail=v,this.pass=E}}Wi.disabled=new Wi({func:519,mask:0},0,0,gc,gc,gc);class Zi{constructor(r,h,p){this.enable=r,this.mode=h,this.frontFace=p}}let as;function il(y,r,h,p,m,v,E){const C=y.context,L=C.gl,F=y.useProgram("collisionBox"),V=[];let Z=0,J=0;for(let be=0;be<p.length;be++){const De=p[be],We=r.getTile(De),He=We.getBucket(h);if(!He)continue;let Xe=De.posMatrix;m[0]===0&&m[1]===0||(Xe=y.translatePosMatrix(De.posMatrix,We,m,v));const nt=E?He.textCollisionBox:He.iconCollisionBox,it=He.collisionCircleArray;if(it.length>0){const ft=a.F(),_t=Xe;a.aP(ft,He.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(ft,ft,He.placementViewportMatrix),V.push({circleArray:it,circleOffset:J,transform:_t,invTransform:ft,coord:De}),Z+=it.length/4,J=Z}nt&&F.draw(C,L.LINES,ki.disabled,Wi.disabled,y.colorModeForRenderPass(),Zi.disabled,Ju(Xe,y.transform,We),y.style.map.terrain&&y.style.map.terrain.getTerrainData(De),h.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,y.transform.zoom,null,null,nt.collisionVertexBuffer)}if(!E||!V.length)return;const pe=y.useProgram("collisionCircle"),fe=new a.aQ;fe.resize(4*Z),fe._trim();let _e=0;for(const be of V)for(let De=0;De<be.circleArray.length/4;De++){const We=4*De,He=be.circleArray[We+0],Xe=be.circleArray[We+1],nt=be.circleArray[We+2],it=be.circleArray[We+3];fe.emplace(_e++,He,Xe,nt,it,0),fe.emplace(_e++,He,Xe,nt,it,1),fe.emplace(_e++,He,Xe,nt,it,2),fe.emplace(_e++,He,Xe,nt,it,3)}(!as||as.length<2*Z)&&(as=function(be){const De=2*be,We=new a.aS;We.resize(De),We._trim();for(let He=0;He<De;He++){const Xe=6*He;We.uint16[Xe+0]=4*He+0,We.uint16[Xe+1]=4*He+1,We.uint16[Xe+2]=4*He+2,We.uint16[Xe+3]=4*He+2,We.uint16[Xe+4]=4*He+3,We.uint16[Xe+5]=4*He+0}return We}(Z));const ae=C.createIndexBuffer(as,!0),Ee=C.createVertexBuffer(fe,a.aR.members,!0);for(const be of V){const De={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(Ze=y.transform).cameraToCenterDistance,u_viewport_size:[Ze.width,Ze.height]};pe.draw(C,L.TRIANGLES,ki.disabled,Wi.disabled,y.colorModeForRenderPass(),Zi.disabled,De,y.style.map.terrain&&y.style.map.terrain.getTerrainData(be.coord),h.id,Ee,ae,a.$.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ze;Ee.destroy(),ae.destroy()}Zi.disabled=new Zi(!1,1029,2305),Zi.backCCW=new Zi(!0,1029,2305);const _c=a.an(new Float32Array(16));function uh(y,r,h,p,m,v){const{horizontalAlign:E,verticalAlign:C}=a.at(y);return new a.P((-(E-.5)*r/m+p[0])*v,(-(C-.5)*h/m+p[1])*v)}function nl(y,r,h,p,m,v,E,C,L,F,V){const Z=y.text.placedSymbolArray,J=y.text.dynamicLayoutVertexArray,pe=y.icon.dynamicLayoutVertexArray,fe={};J.clear();for(let _e=0;_e<Z.length;_e++){const ae=Z.get(_e),Ee=ae.hidden||!ae.crossTileID||y.allowVerticalPlacement&&!ae.placedOrientation?null:p[ae.crossTileID];if(Ee){const Ze=new a.P(ae.anchorX,ae.anchorY),be=ln(Ze,h?E:v,V),De=me(m.cameraToCenterDistance,be.signedDistanceFromCamera);let We=a.ai(y.textSizeData,L,ae)*De/a.ao;h&&(We*=y.tilePixelRatio/C);const{width:He,height:Xe,anchor:nt,textOffset:it,textBoxScale:ft}=Ee,_t=uh(nt,He,Xe,it,ft,We),oi=h?ln(Ze.add(_t),v,V).point:be.point.add(r?_t.rotate(-m.angle):_t),yt=y.allowVerticalPlacement&&ae.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Kt=0;Kt<ae.numGlyphs;Kt++)a.aj(J,oi,yt);F&&ae.associatedIconIndex>=0&&(fe[ae.associatedIconIndex]={shiftedAnchor:oi,angle:yt})}else Ge(ae.numGlyphs,J)}if(F){pe.clear();const _e=y.icon.placedSymbolArray;for(let ae=0;ae<_e.length;ae++){const Ee=_e.get(ae);if(Ee.hidden)Ge(Ee.numGlyphs,pe);else{const Ze=fe[ae];if(Ze)for(let be=0;be<Ee.numGlyphs;be++)a.aj(pe,Ze.shiftedAnchor,Ze.angle);else Ge(Ee.numGlyphs,pe)}}y.icon.dynamicLayoutVertexBuffer.updateData(pe)}y.text.dynamicLayoutVertexBuffer.updateData(J)}function rl(y,r,h){return h.iconsInText&&r?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function ol(y,r,h,p,m,v,E,C,L,F,V,Z){const J=y.context,pe=J.gl,fe=y.transform,_e=C==="map",ae=L==="map",Ee=C!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ze=_e&&!ae&&!Ee,be=!h.layout.get("symbol-sort-key").isConstant();let De=!1;const We=y.depthModeForSublayer(0,ki.ReadOnly),He=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xe=[];for(const nt of p){const it=r.getTile(nt),ft=it.getBucket(h);if(!ft)continue;const _t=m?ft.text:ft.icon;if(!_t||!_t.segments.get().length||!_t.hasVisibleVertices)continue;const oi=_t.programConfigurations.get(h.id),yt=m||ft.sdfIcons,Kt=m?ft.textSizeData:ft.iconSizeData,si=ae||fe.pitch!==0,Si=y.useProgram(rl(yt,m,ft),oi),Qt=a.ag(Kt,fe.zoom),ci=y.style.map.terrain&&y.style.map.terrain.getTerrainData(nt);let pi,dn,Ri,Rr,On=[0,0],nn=null;if(m)dn=it.glyphAtlasTexture,Ri=pe.LINEAR,pi=it.glyphAtlasTexture.size,ft.iconsInText&&(On=it.imageAtlasTexture.size,nn=it.imageAtlasTexture,Rr=si||y.options.rotating||y.options.zooming||Kt.kind==="composite"||Kt.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const An=h.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;dn=it.imageAtlasTexture,Ri=yt||y.options.rotating||y.options.zooming||An||si?pe.LINEAR:pe.NEAREST,pi=it.imageAtlasTexture.size}const Nn=Xt(it,1,y.transform.zoom),Br=ti(nt.posMatrix,ae,_e,y.transform,Nn),vo=eo(nt.posMatrix,ae,_e,y.transform,Nn),Ho=He&&ft.hasTextData(),Ia=h.layout.get("icon-text-fit")!=="none"&&Ho&&ft.hasIconData();if(Ee){const An=y.style.map.terrain?(Kr,Pn)=>y.style.map.terrain.getElevation(nt,Kr,Pn):null,on=h.layout.get("text-rotation-alignment")==="map";X(ft,nt.posMatrix,y,m,Br,vo,ae,F,on,An)}const Xo=y.translatePosMatrix(nt.posMatrix,it,v,E),bo=Ee||m&&He||Ia?_c:Br,Ln=y.translatePosMatrix(vo,it,v,E,!0),rn=yt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Qi;Qi=yt?ft.iconsInText?ma(Kt.kind,Qt,Ze,ae,y,Xo,bo,Ln,pi,On):pa(Kt.kind,Qt,Ze,ae,y,Xo,bo,Ln,m,pi,!0):fa(Kt.kind,Qt,Ze,ae,y,Xo,bo,Ln,m,pi);const Xr={program:Si,buffers:_t,uniformValues:Qi,atlasTexture:dn,atlasTextureIcon:nn,atlasInterpolation:Ri,atlasInterpolationIcon:Rr,isSDF:yt,hasHalo:rn};if(be&&ft.canOverlap){De=!0;const An=_t.segments.get();for(const on of An)Xe.push({segments:new a.$([on]),sortKey:on.sortKey,state:Xr,terrainData:ci})}else Xe.push({segments:_t.segments,sortKey:0,state:Xr,terrainData:ci})}De&&Xe.sort((nt,it)=>nt.sortKey-it.sortKey);for(const nt of Xe){const it=nt.state;if(J.activeTexture.set(pe.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,pe.CLAMP_TO_EDGE),it.atlasTextureIcon&&(J.activeTexture.set(pe.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),it.isSDF){const ft=it.uniformValues;it.hasHalo&&(ft.u_is_halo=1,hh(it.buffers,nt.segments,h,y,it.program,We,V,Z,ft,nt.terrainData)),ft.u_is_halo=0}hh(it.buffers,nt.segments,h,y,it.program,We,V,Z,it.uniformValues,nt.terrainData)}}function hh(y,r,h,p,m,v,E,C,L,F){const V=p.context;m.draw(V,V.gl.TRIANGLES,v,E,C,Zi.disabled,L,F,h.id,y.layoutVertexBuffer,y.indexBuffer,r,h.paint,p.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function sl(y,r,h,p,m){if(!h||!p||!p.imageAtlas)return;const v=p.imageAtlas.patternPositions;let E=v[h.to.toString()],C=v[h.from.toString()];if(!E&&C&&(E=C),!C&&E&&(C=E),!E||!C){const L=m.getPaintProperty(r);E=v[L],C=v[L]}E&&C&&y.setConstantPatternPositions(E,C)}function dh(y,r,h,p,m,v,E){const C=y.context.gl,L="fill-pattern",F=h.paint.get(L),V=F&&F.constantOr(1),Z=h.getCrossfadeParameters();let J,pe,fe,_e,ae;E?(pe=V&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=C.LINES):(pe=V?"fillPattern":"fill",J=C.TRIANGLES);const Ee=F.constantOr(null);for(const Ze of p){const be=r.getTile(Ze);if(V&&!be.patternsLoaded())continue;const De=be.getBucket(h);if(!De)continue;const We=De.programConfigurations.get(h.id),He=y.useProgram(pe,We),Xe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ze);V&&(y.context.activeTexture.set(C.TEXTURE0),be.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),We.updatePaintBuffers(Z)),sl(We,L,Ee,be,h);const nt=Xe?Ze:null,it=y.translatePosMatrix(nt?nt.posMatrix:Ze.posMatrix,be,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){_e=De.indexBuffer2,ae=De.segments2;const ft=[C.drawingBufferWidth,C.drawingBufferHeight];fe=pe==="fillOutlinePattern"&&V?Ku(it,y,Z,be,ft):Nd(it,ft)}else _e=De.indexBuffer,ae=De.segments,fe=V?Za(it,y,Z,be):Xu(it);He.draw(y.context,J,m,y.stencilModeForClipping(Ze),v,Zi.disabled,fe,Xe,h.id,De.layoutVertexBuffer,_e,ae,h.paint,y.transform.zoom,We)}}function al(y,r,h,p,m,v,E){const C=y.context,L=C.gl,F="fill-extrusion-pattern",V=h.paint.get(F),Z=V.constantOr(1),J=h.getCrossfadeParameters(),pe=h.paint.get("fill-extrusion-opacity"),fe=V.constantOr(null);for(const _e of p){const ae=r.getTile(_e),Ee=ae.getBucket(h);if(!Ee)continue;const Ze=y.style.map.terrain&&y.style.map.terrain.getTerrainData(_e),be=Ee.programConfigurations.get(h.id),De=y.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",be);Z&&(y.context.activeTexture.set(L.TEXTURE0),ae.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),be.updatePaintBuffers(J)),sl(be,F,fe,ae,h);const We=y.translatePosMatrix(_e.posMatrix,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),Xe=Z?Od(We,y,He,pe,_e,J,ae):ua(We,y,He,pe);De.draw(C,C.gl.TRIANGLES,m,v,E,Zi.backCCW,Xe,Ze,h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,y.transform.zoom,be,y.style.map.terrain&&Ee.centroidVertexBuffer)}}function ll(y,r,h,p,m,v,E){const C=y.context,L=C.gl,F=h.fbo;if(!F)return;const V=y.useProgram("hillshade"),Z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(r);C.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get()),V.draw(C,L.TRIANGLES,m,v,E,Zi.disabled,((J,pe,fe,_e)=>{const ae=fe.paint.get("hillshade-shadow-color"),Ee=fe.paint.get("hillshade-highlight-color"),Ze=fe.paint.get("hillshade-accent-color");let be=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=J.transform.angle);const De=!J.options.moving;return{u_matrix:_e?_e.posMatrix:J.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),De),u_image:0,u_latrange:eh(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),be],u_shadow:ae,u_highlight:Ee,u_accent:Ze}})(y,h,p,Z?r:null),Z,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function yc(y,r,h,p,m,v){const E=y.context,C=E.gl,L=r.dem;if(L&&L.data){const F=L.dim,V=L.stride,Z=L.getPixels();if(E.activeTexture.set(C.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||y.getTileTexture(V),r.demTexture){const pe=r.demTexture;pe.update(Z,{premultiply:!1}),pe.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else r.demTexture=new ne(E,Z,C.RGBA,{premultiply:!1}),r.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);E.activeTexture.set(C.TEXTURE0);let J=r.fbo;if(!J){const pe=new ne(E,{width:F,height:F,data:null},C.RGBA);pe.bind(C.LINEAR,C.CLAMP_TO_EDGE),J=r.fbo=E.createFramebuffer(F,F,!0,!1),J.colorAttachment.set(pe.texture)}E.bindFramebuffer.set(J.framebuffer),E.viewport.set([0,0,F,F]),y.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,p,m,v,Zi.disabled,((pe,fe)=>{const _e=fe.stride,ae=a.F();return a.aN(ae,0,a.W,-a.W,0,0,1),a.H(ae,ae,[0,-a.W,0]),{u_matrix:ae,u_image:1,u_dimension:[_e,_e],u_zoom:pe.overscaledZ,u_unpack:fe.getUnpackVector()}})(r.tileID,L),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function fh(y,r,h,p,m,v){const E=p.paint.get("raster-fade-duration");if(!v&&E>0){const C=S.now(),L=(C-y.timeAdded)/E,F=r?(C-r.timeAdded)/E:-1,V=h.getSource(),Z=m.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),J=!r||Math.abs(r.tileID.overscaledZ-Z)>Math.abs(y.tileID.overscaledZ-Z),pe=J&&y.refreshedUponExpiration?1:a.ac(J?L:1-F,0,1);return y.refreshedUponExpiration&&L>=1&&(y.refreshedUponExpiration=!1),r?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}const ph=new a.aO(1,0,0,1),cl=new a.aO(0,1,0,1),vc=new a.aO(0,0,1,1),Yd=new a.aO(1,0,1,1),mh=new a.aO(0,1,1,1);function un(y,r,h,p){ur(y,0,r+h/2,y.transform.width,h,p)}function Zo(y,r,h,p){ur(y,r-h/2,0,h,y.transform.height,p)}function ur(y,r,h,p,m,v){const E=y.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(r*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),E.clear({color:v}),C.disable(C.SCISSOR_TEST)}function bc(y,r,h){const p=y.context,m=p.gl,v=h.posMatrix,E=y.useProgram("debug"),C=ki.disabled,L=Wi.disabled,F=y.colorModeForRenderPass(),V="$debug",Z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const J=r.getTileByID(h.key).latestRawTileData,pe=Math.floor((J&&J.byteLength||0)/1024),fe=r.getTile(h).tileSize,_e=512/Math.min(fe,512)*(h.overscaledZ/y.transform.zoom)*.5;let ae=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ae+=` => ${h.overscaledZ}`),function(Ee,Ze){Ee.initDebugOverlayCanvas();const be=Ee.debugOverlayCanvas,De=Ee.context.gl,We=Ee.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,be.width,be.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(Ze,5,5),We.strokeText(Ze,5,5),Ee.debugOverlayTexture.update(be),Ee.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(y,`${ae} ${pe}kB`),E.draw(p,m.TRIANGLES,C,L,xn.alphaBlended,Zi.disabled,Yu(v,a.aO.transparent,_e),null,V,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),E.draw(p,m.LINE_STRIP,C,L,F,Zi.disabled,Yu(v,a.aO.red),Z,V,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function ul(y,r,h){const p=y.context,m=p.gl,v=y.colorModeForRenderPass(),E=new ki(m.LEQUAL,ki.ReadWrite,y.depthRangeFor3D),C=y.useProgram("terrain"),L=r.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const F of h){const V=y.renderToTexture.getTexture(F),Z=r.getTerrainData(F.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,V.texture);const J={u_matrix:y.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(y.transform.zoom)};C.draw(p,m.TRIANGLES,E,Wi.disabled,v,Zi.backCCW,J,Z,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}class gh{constructor(r,h){this.context=new Jd(r),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Vi.maxUnderzooming+Vi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vo}resize(r,h,p){if(this.width=Math.floor(r*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const r=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=r.createVertexBuffer(h,Ua.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=r.createVertexBuffer(p,Ua.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=r.createVertexBuffer(m,$e.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const v=new a.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,Ua.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(E);const C=new a.aX;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(C);const L=this.context.gl;this.stencilClearMode=new Wi({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const r=this.context,h=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,h.TRIANGLES,ki.disabled,this.stencilClearMode,xn.disabled,Zi.disabled,Ga(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,h){if(this.currentStencilSource===r.source||!r.isTileClipped()||!h||!h.length)return;this.currentStencilSource=r.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(xn.disabled),p.setDepthMode(ki.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const C=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);v.draw(p,m.TRIANGLES,ki.disabled,new Wi({func:m.ALWAYS,mask:0},C,255,m.KEEP,m.KEEP,m.REPLACE),xn.disabled,Zi.disabled,Ga(E.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,h=this.context.gl;return new Wi({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){const h=this.context.gl;return new Wi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(r){const h=this.context.gl,p=r.sort((E,C)=>C.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,v=p[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let C=0;C<v;C++)E[C+m]=new Wi({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[m]:Wi.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new xn([r.CONSTANT_COLOR,r.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xn.unblended:xn.alphaBlended}depthModeForSublayer(r,h,p){if(!this.opaquePassEnabledForLayer())return ki.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new ki(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,h){this.style=r,this.options=h,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,v={},E={},C={};for(const L in m){const F=m[L];F.used&&F.prepare(this.context),v[L]=F.getVisibleCoordinates(),E[L]=v[L].slice().reverse(),C[L]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<p.length;L++)if(this.style._layers[p[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of p){const F=this.style._layers[L];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const V=E[F.source];(F.type==="custom"||V.length)&&this.renderLayer(this,m[F.source],F,V)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[p[this.currentLayer]],F=m[L.source],V=v[L.source];this._renderTileClippingMasks(L,V),this.renderLayer(this,F,L,V)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const L=this.style._layers[p[this.currentLayer]],F=m[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L))continue;const V=(L.type==="symbol"?C:E)[L.source];this._renderTileClippingMasks(L,v[L.source]),this.renderLayer(this,F,L,V)}if(this.options.showTileBoundaries){const L=function(F,V){let Z=null;const J=Object.values(F._layers).flatMap(ae=>ae.source&&!ae.isHidden(V)?[F.sourceCaches[ae.source]]:[]),pe=J.filter(ae=>ae.getSource().type==="vector"),fe=J.filter(ae=>ae.getSource().type!=="vector"),_e=ae=>{(!Z||Z.getSource().maxzoom<ae.getSource().maxzoom)&&(Z=ae)};return pe.forEach(ae=>_e(ae)),Z||fe.forEach(ae=>_e(ae)),Z}(this.style,this.transform.zoom);L&&function(F,V,Z){for(let J=0;J<Z.length;J++)bc(F,V,Z[J])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const F=L.transform.padding;un(L,L.transform.height-(F.top||0),3,ph),un(L,F.bottom||0,3,cl),Zo(L,F.left||0,3,vc),Zo(L,L.transform.width-(F.right||0),3,Yd);const V=L.transform.centerPoint;(function(Z,J,pe,fe){ur(Z,J-1,pe-10,2,20,fe),ur(Z,J-10,pe-1,20,2,fe)})(L,V.x,L.transform.height-V.y,mh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=r?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,E){const C=v.context,L=C.gl,F=xn.unblended,V=new ki(L.LEQUAL,ki.ReadWrite,[0,1]),Z=E.getTerrainMesh(),J=E.sourceCache.getRenderableTiles(),pe=v.useProgram("terrainDepth");C.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),C.clear({color:a.aO.transparent,depth:1});for(const fe of J){const _e=E.getTerrainData(fe.tileID),ae={u_matrix:v.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};pe.draw(C,L.TRIANGLES,V,Wi.disabled,F,Zi.backCCW,ae,_e,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,E){const C=v.context,L=C.gl,F=xn.unblended,V=new ki(L.LEQUAL,ki.ReadWrite,[0,1]),Z=E.getTerrainMesh(),J=E.getCoordsTexture(),pe=E.sourceCache.getRenderableTiles(),fe=v.useProgram("terrainCoords");C.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),C.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const _e of pe){const ae=E.getTerrainData(_e.tileID);C.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,J.texture);const Ee={u_matrix:v.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};fe.draw(C,L.TRIANGLES,V,Wi.disabled,F,Zi.backCCW,Ee,ae,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),E.coordsIndex.push(_e.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(r,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(v,E,C,L,F){if(v.renderPass!=="translucent")return;const V=Wi.disabled,Z=v.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(J,pe,fe,_e,ae,Ee,Ze){const be=pe.transform,De=ae==="map",We=Ee==="map";for(const He of J){const Xe=_e.getTile(He),nt=Xe.getBucket(fe);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const it=a.ag(nt.textSizeData,be.zoom),ft=Xt(Xe,1,pe.transform.zoom),_t=ti(He.posMatrix,We,De,pe.transform,ft),oi=fe.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(it){const yt=Math.pow(2,be.zoom-Xe.tileID.overscaledZ);nl(nt,De,We,Ze,be,_t,He.posMatrix,yt,it,oi,pe.style.map.terrain?(Kt,si)=>pe.style.map.terrain.getElevation(He,Kt,si):null)}}}(L,v,C,E,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),F),C.paint.get("icon-opacity").constantOr(1)!==0&&ol(v,E,C,L,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),V,Z),C.paint.get("text-opacity").constantOr(1)!==0&&ol(v,E,C,L,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),V,Z),E.map.showCollisionBoxes&&(il(v,E,C,L,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),!0),il(v,E,C,L,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),!1))})(r,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(v,E,C,L){if(v.renderPass!=="translucent")return;const F=C.paint.get("circle-opacity"),V=C.paint.get("circle-stroke-width"),Z=C.paint.get("circle-stroke-opacity"),J=!C.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(V.constantOr(1)===0||Z.constantOr(1)===0))return;const pe=v.context,fe=pe.gl,_e=v.depthModeForSublayer(0,ki.ReadOnly),ae=Wi.disabled,Ee=v.colorModeForRenderPass(),Ze=[];for(let be=0;be<L.length;be++){const De=L[be],We=E.getTile(De),He=We.getBucket(C);if(!He)continue;const Xe=He.programConfigurations.get(C.id),nt=v.useProgram("circle",Xe),it=He.layoutVertexBuffer,ft=He.indexBuffer,_t=v.style.map.terrain&&v.style.map.terrain.getTerrainData(De),oi={programConfiguration:Xe,program:nt,layoutVertexBuffer:it,indexBuffer:ft,uniformValues:jd(v,De,We,C),terrainData:_t};if(J){const yt=He.segments.get();for(const Kt of yt)Ze.push({segments:new a.$([Kt]),sortKey:Kt.sortKey,state:oi})}else Ze.push({segments:He.segments,sortKey:0,state:oi})}J&&Ze.sort((be,De)=>be.sortKey-De.sortKey);for(const be of Ze){const{programConfiguration:De,program:We,layoutVertexBuffer:He,indexBuffer:Xe,uniformValues:nt,terrainData:it}=be.state;We.draw(pe,fe.TRIANGLES,_e,ae,Ee,Zi.disabled,nt,it,C.id,He,Xe,be.segments,C.paint,v.transform.zoom,De)}})(r,h,p,m);break;case"heatmap":(function(v,E,C,L){if(C.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const F=v.context,V=F.gl,Z=Wi.disabled,J=new xn([V.ONE,V.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(pe,fe,_e){const ae=pe.gl;pe.activeTexture.set(ae.TEXTURE1),pe.viewport.set([0,0,fe.width/4,fe.height/4]);let Ee=_e.heatmapFbo;if(Ee)ae.bindTexture(ae.TEXTURE_2D,Ee.colorAttachment.get()),pe.bindFramebuffer.set(Ee.framebuffer);else{const Ze=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Ze),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),Ee=_e.heatmapFbo=pe.createFramebuffer(fe.width/4,fe.height/4,!1,!1),function(be,De,We,He){var Xe,nt;const it=be.gl,ft=(Xe=be.HALF_FLOAT)!==null&&Xe!==void 0?Xe:it.UNSIGNED_BYTE,_t=(nt=be.RGBA16F)!==null&&nt!==void 0?nt:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,_t,De.width/4,De.height/4,0,it.RGBA,ft,null),He.colorAttachment.set(We)}(pe,fe,Ze,Ee)}})(F,v,C),F.clear({color:a.aO.transparent});for(let pe=0;pe<L.length;pe++){const fe=L[pe];if(E.hasRenderableParent(fe))continue;const _e=E.getTile(fe),ae=_e.getBucket(C);if(!ae)continue;const Ee=ae.programConfigurations.get(C.id),Ze=v.useProgram("heatmap",Ee),{zoom:be}=v.transform;Ze.draw(F,V.TRIANGLES,ki.disabled,Z,J,Zi.disabled,Qu(fe.posMatrix,_e,be,C.paint.get("heatmap-intensity")),null,C.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,C.paint,v.transform.zoom,Ee)}F.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(F,V){const Z=F.context,J=Z.gl,pe=V.heatmapFbo;if(!pe)return;Z.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,pe.colorAttachment.get()),Z.activeTexture.set(J.TEXTURE1);let fe=V.colorRampTexture;fe||(fe=V.colorRampTexture=new ne(Z,V.colorRamp,J.RGBA)),fe.bind(J.LINEAR,J.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(Z,J.TRIANGLES,ki.disabled,Wi.disabled,F.colorModeForRenderPass(),Zi.disabled,((_e,ae,Ee,Ze)=>{const be=a.F();a.aN(be,0,_e.width,_e.height,0,0,1);const De=_e.context.gl;return{u_matrix:be,u_world:[De.drawingBufferWidth,De.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ae.paint.get("heatmap-opacity")}})(F,V),null,V.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,V.paint,F.transform.zoom)}(v,C))})(r,h,p,m);break;case"line":(function(v,E,C,L){if(v.renderPass!=="translucent")return;const F=C.paint.get("line-opacity"),V=C.paint.get("line-width");if(F.constantOr(1)===0||V.constantOr(1)===0)return;const Z=v.depthModeForSublayer(0,ki.ReadOnly),J=v.colorModeForRenderPass(),pe=C.paint.get("line-dasharray"),fe=C.paint.get("line-pattern"),_e=fe.constantOr(1),ae=C.paint.get("line-gradient"),Ee=C.getCrossfadeParameters(),Ze=_e?"linePattern":pe?"lineSDF":ae?"lineGradient":"line",be=v.context,De=be.gl;let We=!0;for(const He of L){const Xe=E.getTile(He);if(_e&&!Xe.patternsLoaded())continue;const nt=Xe.getBucket(C);if(!nt)continue;const it=nt.programConfigurations.get(C.id),ft=v.context.program.get(),_t=v.useProgram(Ze,it),oi=We||_t.program!==ft,yt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(He),Kt=fe.constantOr(null);if(Kt&&Xe.imageAtlas){const Qt=Xe.imageAtlas,ci=Qt.patternPositions[Kt.to.toString()],pi=Qt.patternPositions[Kt.from.toString()];ci&&pi&&it.setConstantPatternPositions(ci,pi)}const si=yt?He:null,Si=_e?rs(v,Xe,C,Ee,si):pe?$a(v,Xe,C,pe,Ee,si):ae?th(v,Xe,C,nt.lineClipsArray.length,si):Wa(v,Xe,C,si);if(_e)be.activeTexture.set(De.TEXTURE0),Xe.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),it.updatePaintBuffers(Ee);else if(pe&&(oi||v.lineAtlas.dirty))be.activeTexture.set(De.TEXTURE0),v.lineAtlas.bind(be);else if(ae){const Qt=nt.gradients[C.id];let ci=Qt.texture;if(C.gradientVersion!==Qt.version){let pi=256;if(C.stepInterpolant){const dn=E.getSource().maxzoom,Ri=He.canonical.z===dn?Math.ceil(1<<v.transform.maxZoom-He.canonical.z):1;pi=a.ac(a.aT(nt.maxLineLength/a.W*1024*Ri),256,be.maxTextureSize)}Qt.gradient=a.aU({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:Qt.gradient||void 0,clips:nt.lineClipsArray}),Qt.texture?Qt.texture.update(Qt.gradient):Qt.texture=new ne(be,Qt.gradient,De.RGBA),Qt.version=C.gradientVersion,ci=Qt.texture}be.activeTexture.set(De.TEXTURE0),ci.bind(C.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}_t.draw(be,De.TRIANGLES,Z,v.stencilModeForClipping(He),J,Zi.disabled,Si,yt,C.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,C.paint,v.transform.zoom,it,nt.layoutVertexBuffer2),We=!1}})(r,h,p,m);break;case"fill":(function(v,E,C,L){const F=C.paint.get("fill-color"),V=C.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const Z=v.colorModeForRenderPass(),J=C.paint.get("fill-pattern"),pe=v.opaquePassEnabledForLayer()&&!J.constantOr(1)&&F.constantOr(a.aO.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===pe){const fe=v.depthModeForSublayer(1,v.renderPass==="opaque"?ki.ReadWrite:ki.ReadOnly);dh(v,E,C,L,fe,Z,!1)}if(v.renderPass==="translucent"&&C.paint.get("fill-antialias")){const fe=v.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,ki.ReadOnly);dh(v,E,C,L,fe,Z,!0)}})(r,h,p,m);break;case"fill-extrusion":(function(v,E,C,L){const F=C.paint.get("fill-extrusion-opacity");if(F!==0&&v.renderPass==="translucent"){const V=new ki(v.context.gl.LEQUAL,ki.ReadWrite,v.depthRangeFor3D);if(F!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))al(v,E,C,L,V,Wi.disabled,xn.disabled),al(v,E,C,L,V,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const Z=v.colorModeForRenderPass();al(v,E,C,L,V,Wi.disabled,Z)}}})(r,h,p,m);break;case"hillshade":(function(v,E,C,L){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const F=v.context,V=v.depthModeForSublayer(0,ki.ReadOnly),Z=v.colorModeForRenderPass(),[J,pe]=v.renderPass==="translucent"?v.stencilConfigForOverlap(L):[{},L];for(const fe of pe){const _e=E.getTile(fe);_e.needsHillshadePrepare!==void 0&&_e.needsHillshadePrepare&&v.renderPass==="offscreen"?yc(v,_e,C,V,Wi.disabled,Z):v.renderPass==="translucent"&&ll(v,fe,_e,C,V,J[fe.overscaledZ],Z)}F.viewport.set([0,0,v.width,v.height])})(r,h,p,m);break;case"raster":(function(v,E,C,L){if(v.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!L.length)return;const F=v.context,V=F.gl,Z=E.getSource(),J=v.useProgram("raster"),pe=v.colorModeForRenderPass(),[fe,_e]=Z instanceof kt?[{},L]:v.stencilConfigForOverlap(L),ae=_e[_e.length-1].overscaledZ,Ee=!v.options.moving;for(const Ze of _e){const be=v.depthModeForSublayer(Ze.overscaledZ-ae,C.paint.get("raster-opacity")===1?ki.ReadWrite:ki.ReadOnly,V.LESS),De=E.getTile(Ze);De.registerFadeDuration(C.paint.get("raster-fade-duration"));const We=E.findLoadedParent(Ze,0),He=fh(De,We,E,C,v.transform,v.style.map.terrain);let Xe,nt;const it=C.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;F.activeTexture.set(V.TEXTURE0),De.texture.bind(it,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(V.TEXTURE1),We?(We.texture.bind(it,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,We.tileID.overscaledZ-De.tileID.overscaledZ),nt=[De.tileID.canonical.x*Xe%1,De.tileID.canonical.y*Xe%1]):De.texture.bind(it,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ze),_t=ft?Ze:null,oi=_t?_t.posMatrix:v.transform.calculatePosMatrix(Ze.toUnwrapped(),Ee),yt=Ha(oi,nt||[0,0],Xe||1,He,C);Z instanceof kt?J.draw(F,V.TRIANGLES,be,Wi.disabled,pe,Zi.disabled,yt,ft,C.id,Z.boundsBuffer,v.quadTriangleIndexBuffer,Z.boundsSegments):J.draw(F,V.TRIANGLES,be,fe[Ze.overscaledZ],pe,Zi.disabled,yt,ft,C.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(r,h,p,m);break;case"background":(function(v,E,C,L){const F=C.paint.get("background-color"),V=C.paint.get("background-opacity");if(V===0)return;const Z=v.context,J=Z.gl,pe=v.transform,fe=pe.tileSize,_e=C.paint.get("background-pattern");if(v.isPatternMissing(_e))return;const ae=!_e&&F.a===1&&V===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==ae)return;const Ee=Wi.disabled,Ze=v.depthModeForSublayer(0,ae==="opaque"?ki.ReadWrite:ki.ReadOnly),be=v.colorModeForRenderPass(),De=v.useProgram(_e?"backgroundPattern":"background"),We=L||pe.coveringTiles({tileSize:fe,terrain:v.style.map.terrain});_e&&(Z.activeTexture.set(J.TEXTURE0),v.imageManager.bind(v.context));const He=C.getCrossfadeParameters();for(const Xe of We){const nt=L?Xe.posMatrix:v.transform.calculatePosMatrix(Xe.toUnwrapped()),it=_e?Vd(nt,V,v,_e,{tileID:Xe,tileSize:fe},He):Ud(nt,V,F),ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Xe);De.draw(Z,J.TRIANGLES,Ze,Ee,be,Zi.disabled,it,ft,C.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(r,0,p,m);break;case"custom":(function(v,E,C){const L=v.context,F=C.implementation;if(v.renderPass==="offscreen"){const V=F.prerender;V&&(v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),V.call(F,L.gl,v.transform.customLayerMatrix()),L.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),L.setStencilMode(Wi.disabled);const V=F.renderingMode==="3d"?new ki(v.context.gl.LEQUAL,ki.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,ki.ReadOnly);L.setDepthMode(V),F.render(L.gl,v.transform.customLayerMatrix()),L.setDirty(),v.setBaseState(),L.bindFramebuffer.set(null)}})(r,0,p)}}translatePosMatrix(r,h,p,m,v){if(!p[0]&&!p[1])return r;const E=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(E){const F=Math.sin(E),V=Math.cos(E);p=[p[0]*V-p[1]*F,p[0]*F+p[1]*V]}const C=[v?p[0]:Xt(h,p[0],this.transform.zoom),v?p[1]:Xt(h,p[1],this.transform.zoom),0],L=new Float32Array(16);return a.H(L,r,C),L}saveTileTexture(r){const h=this._tileTextures[r.size[0]];h?h.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const h=this._tileTextures[r];return h&&h.length>0?h.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const h=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!h||!p}useProgram(r,h){this.cache=this.cache||{};const p=r+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new qo(this.context,ca[r],h,ih[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ne(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:h}=this.context.gl;return this.width!==r||this.height!==h}}class Go{constructor(r,h){this.points=r,this.planes=h}static fromInvProjectionMatrix(r,h,p){const m=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const L=1/(C=a.af([],C,r))[3]/h*m;return a.a$(C,C,[L,L,1/C[3],L])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const L=function(J,pe){var fe=pe[0],_e=pe[1],ae=pe[2],Ee=fe*fe+_e*_e+ae*ae;return Ee>0&&(Ee=1/Math.sqrt(Ee)),J[0]=pe[0]*Ee,J[1]=pe[1]*Ee,J[2]=pe[2]*Ee,J}([],function(J,pe,fe){var _e=pe[0],ae=pe[1],Ee=pe[2],Ze=fe[0],be=fe[1],De=fe[2];return J[0]=ae*De-Ee*be,J[1]=Ee*Ze-_e*De,J[2]=_e*be-ae*Ze,J}([],ee([],v[C[0]],v[C[1]]),ee([],v[C[2]],v[C[1]]))),F=-((V=L)[0]*(Z=v[C[1]])[0]+V[1]*Z[1]+V[2]*Z[2]);var V,Z;return L.concat(F)});return new Go(v,E)}}class Wo{constructor(r,h){this.min=r,this.max=h,this.center=function(p,m,v){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,v){return p[0]=m[0]+v[0],p[1]=m[1]+v[1],p[2]=m[2]+v[2],p}([],this.min,this.max))}quadrant(r){const h=[r%2==0,r<2],p=re(this.min),m=re(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],m[v]=h[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Wo(p,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<r.planes.length;m++){const v=r.planes[m];let E=0;for(let C=0;C<h.length;C++)a.b0(v,h[C])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let C=0;C<r.points.length;C++){const L=r.points[C][m]-this.min[m];v=Math.min(v,L),E=Math.max(E,L)}if(E<0||v>this.max[m]-this.min[m])return 0}return 1}}class Fs{constructor(r=0,h=0,p=0,m=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=p,this.right=m}interpolate(r,h,p){return h.top!=null&&r.top!=null&&(this.top=a.z.number(r.top,h.top,p)),h.bottom!=null&&r.bottom!=null&&(this.bottom=a.z.number(r.bottom,h.bottom,p)),h.left!=null&&r.left!=null&&(this.left=a.z.number(r.left,h.left,p)),h.right!=null&&r.right!=null&&(this.right=a.z.number(r.right,h.right,p)),this}getCenter(r,h){const p=a.ac((this.left+r-this.right)/2,0,r),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wc=85.051129;class hl{constructor(r,h,p,m,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=r||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const r=new hl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this.minElevationForCurrentTile=r.minElevationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const h=-a.b1(r,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,v){var E=m[0],C=m[1],L=m[2],F=m[3],V=Math.sin(v),Z=Math.cos(v);p[0]=E*Z+L*V,p[1]=C*Z+F*V,p[2]=E*-V+L*Z,p[3]=C*-V+F*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const h=a.ac(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const h=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,p){this._unmodified=!1,this._edgeInsets.interpolate(r,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const h=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(r){const h=[new a.b2(0,r)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),C=Math.floor(Math.min(p.x,m.x,v.x,E.x)),L=Math.floor(Math.max(p.x,m.x,v.x,E.x)),F=1;for(let V=C-F;V<=L+F;V++)V!==0&&h.push(new a.b2(V,r))}return h}coveringTiles(r){var h,p;let m=this.coveringZoomLevel(r);const v=m;if(r.minzoom!==void 0&&m<r.minzoom)return[];r.maxzoom!==void 0&&m>r.maxzoom&&(m=r.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),C=a.Y.fromLngLat(this.center),L=Math.pow(2,m),F=[L*E.x,L*E.y,0],V=[L*C.x,L*C.y,0],Z=Go.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let J=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(J=m);const pe=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,fe=be=>({aabb:new Wo([be*L,0,0],[(be+1)*L,L,0]),zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),_e=[],ae=[],Ee=m,Ze=r.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let be=1;be<=3;be++)_e.push(fe(-be)),_e.push(fe(be));for(_e.push(fe(0));_e.length>0;){const be=_e.pop(),De=be.x,We=be.y;let He=be.fullyVisible;if(!He){const _t=be.aabb.intersects(Z);if(_t===0)continue;He=_t===2}const Xe=r.terrain?F:V,nt=be.aabb.distanceX(Xe),it=be.aabb.distanceY(Xe),ft=Math.max(Math.abs(nt),Math.abs(it));if(be.zoom===Ee||ft>pe+(1<<Ee-be.zoom)-2&&be.zoom>=J){const _t=Ee-be.zoom,oi=F[0]-.5-(De<<_t),yt=F[1]-.5-(We<<_t);ae.push({tileID:new a.Q(be.zoom===Ee?Ze:be.zoom,be.wrap,be.zoom,De,We),distanceSq:ve([V[0]-.5-De,V[1]-.5-We]),tileDistanceToCamera:Math.sqrt(oi*oi+yt*yt)})}else for(let _t=0;_t<4;_t++){const oi=(De<<1)+_t%2,yt=(We<<1)+(_t>>1),Kt=be.zoom+1;let si=be.aabb.quadrant(_t);if(r.terrain){const Si=new a.Q(Kt,be.wrap,Kt,oi,yt),Qt=r.terrain.getMinMaxElevation(Si),ci=(h=Qt.minElevation)!==null&&h!==void 0?h:this.elevation,pi=(p=Qt.maxElevation)!==null&&p!==void 0?p:this.elevation;si=new Wo([si.min[0],si.min[1],ci],[si.max[0],si.max[1],pi])}_e.push({aabb:si,zoom:Kt,x:oi,y:yt,wrap:be.wrap,fullyVisible:He})}}return ae.sort((be,De)=>be.distanceSq-De.distanceSq).map(be=>be.tileID)}resize(r,h){this.width=r,this.height=h,this.pixelsToGLUnits=[2/r,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const h=a.ac(r.lat,-85.051129,wc);return new a.P(a.N(r.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(r){return new a.Y(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,r),v=r.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-v))return;const E=p+h-v,C=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,m.lat),L=this.scaleZoom(C/this.tileSize);this._elevation=v,this._center=m,this.zoom=L}setLocationAtPoint(r,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(r),E=new a.Y(v.x-(p.x-m.x),v.y-(p.y-m.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,h){return h?this.coordinatePoint(this.locationCoordinate(r),h.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,h){return this.coordinateLocation(this.pointCoordinate(r,h))}locationCoordinate(r){return a.Y.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,h){if(h){const J=h.pointCoordinate(r);if(J!=null)return J}const p=[r.x,r.y,0,1],m=[r.x,r.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const v=p[3],E=m[3],C=p[1]/v,L=m[1]/E,F=p[2]/v,V=m[2]/E,Z=F===V?0:(0-F)/(V-F);return new a.Y(a.z.number(p[0]/v,m[0]/E,Z)/this.worldSize,a.z.number(C,L,Z)/this.worldSize)}coordinatePoint(r,h=0,p=this.pixelMatrix){const m=[r.x*this.worldSize,r.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new je().extend(this.pointLocation(new a.P(0,r))).extend(this.pointLocation(new a.P(this.width,r))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,wc])}calculatePosMatrix(r,h=!1){const p=r.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const v=r.canonical,E=this.worldSize/this.zoomScale(v.z),C=v.x+Math.pow(2,v.z)*r.wrap,L=a.an(new Float64Array(16));return a.H(L,L,[C*E,v.y*E,0]),a.J(L,L,[E/a.W,E/a.W,1]),a.K(L,h?this.alignedProjMatrix:this.projMatrix,L),m[p]=new Float32Array(L),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(r,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(r.lng,r.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const be=179.9999999999;m=[-be,be]}const v=this.tileSize*this.zoomScale(p.zoom);let E=0,C=v,L=0,F=v,V=0,Z=0;const{x:J,y:pe}=this.size;if(this.latRange){const be=this.latRange;E=a.O(be[1])*v,C=a.O(be[0])*v,C-E<pe&&(V=pe/(C-E))}m&&(L=a.b1(a.N(m[0])*v,0,v),F=a.b1(a.N(m[1])*v,0,v),F<L&&(F+=v),F-L<J&&(Z=J/(F-L)));const{x:fe,y:_e}=this.project.call({worldSize:v},r);let ae,Ee;const Ze=Math.max(Z||0,V||0);if(Ze){const be=new a.P(Z?(F+L)/2:fe,V?(C+E)/2:_e);return p.center=this.unproject.call({worldSize:v},be).wrap(),p.zoom+=this.scaleZoom(Ze),p}if(this.latRange){const be=pe/2;_e-be<E&&(Ee=E+be),_e+be>C&&(Ee=C-be)}if(m){const be=(L+F)/2;let De=fe;this._renderWorldCopies&&(De=a.b1(fe,be-v/2,be+v/2));const We=J/2;De-We<L&&(ae=L+We),De+We>F&&(ae=F-We)}if(ae!==void 0||Ee!==void 0){const be=new a.P(ae??fe,Ee??_e);p.center=this.unproject.call({worldSize:v},be).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=r,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),C=v-E*this._pixelPerMeter/Math.cos(this._pitch),L=E<0?C:v,F=Math.PI/2+this._pitch,V=this._fov*(.5+r.y/this.height),Z=Math.sin(V)*L/Math.sin(a.ac(Math.PI-F-V,.01,Math.PI-.01)),J=this.getHorizon(),pe=2*Math.atan(J/this.cameraToCenterDistance)*(.5+r.y/(2*J)),fe=Math.sin(pe)*L/Math.sin(a.ac(Math.PI-F-pe,.01,Math.PI-.01)),_e=Math.min(Z,fe),ae=1.01*(Math.cos(Math.PI/2-this._pitch)*_e+L),Ee=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Ee,ae),m[8]=2*-r.x/this.width,m[9]=2*r.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const Ze=this.width%2/2,be=this.height%2/2,De=Math.cos(this.angle),We=Math.sin(this.angle),He=h-Math.round(h)+De*Ze+We*be,Xe=p-Math.round(p)+De*be+We*Ze,nt=new Float64Array(m);if(a.H(nt,nt,[He>.5?He-1:He,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=nt,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new a.P(0,0)),h=[r.x*this.worldSize,r.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,r))}getCameraQueryGeometry(r){const h=this.getCameraPoint();if(r.length===1)return[r[0],h];{let p=h.x,m=h.y,v=h.x,E=h.y;for(const C of r)p=Math.min(p,C.x),m=Math.min(m,C.y),v=Math.max(v,C.x),E=Math.max(E,C.y);return[new a.P(p,m),new a.P(v,m),new a.P(v,E),new a.P(p,E),new a.P(p,m)]}}lngLatToCameraDepth(r,h){const p=this.locationCoordinate(r),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function xc(y,r){let h,p=!1,m=null,v=null;const E=()=>{m=null,p&&(y.apply(v,h),m=setTimeout(E,r),p=!1)};return(...C)=>(p=!0,v=this,h=C,m||E(),m)}class kc{constructor(r){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=xc(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),E=Math.round(h.lng*v)/v,C=Math.round(h.lat*v)/v,L=this._map.getBearing(),F=this._map.getPitch();let V="";if(V+=r?`/${E}/${C}/${p}`:`${p}/${C}/${E}`,(L||F)&&(V+="/"+Math.round(10*L)/10),F&&(V+=`/${Math.round(F)}`),this._hashName){const Z=this._hashName;let J=!1;const pe=window.location.hash.slice(1).split("&").map(fe=>{const _e=fe.split("=")[0];return _e===Z?(J=!0,`${_e}=${V}`):fe}).filter(fe=>fe);return J||pe.push(`${Z}=${V}`),`#${pe.join("&")}`}return`#${V}`}}const _a={linearity:.3,easing:a.b6(0,0,.3,1)},ls=a.e({deceleration:2500,maxSpeed:1400},_a),_h=a.e({deceleration:20,maxSpeed:1400},_a),yh=a.e({deceleration:1e3,maxSpeed:360},_a),vh=a.e({deceleration:1e3,maxSpeed:90},_a);class bh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,h=S.now();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const v=va(h.pan.mag(),p,a.e({},ls,r||{}));m.offset=h.pan.mult(v.amount/h.pan.mag()),m.center=this._map.transform.center,ya(m,v)}if(h.zoom){const v=va(h.zoom,p,_h);m.zoom=this._map.transform.zoom+v.amount,ya(m,v)}if(h.bearing){const v=va(h.bearing,p,yh);m.bearing=this._map.transform.bearing+a.ac(v.amount,-179,179),ya(m,v)}if(h.pitch){const v=va(h.pitch,p,vh);m.pitch=this._map.transform.pitch+v.amount,ya(m,v)}if(m.zoom||m.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ya(y,r){(!y.duration||y.duration<r.duration)&&(y.duration=r.duration,y.easing=r.easing)}function va(y,r,h){const{maxSpeed:p,linearity:m,deceleration:v}=h,E=a.ac(y*m/(r/1e3),-p,p),C=Math.abs(E)/(v*m);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}class br extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p,m={}){const v=I.mousePos(h.getCanvas(),p),E=h.unproject(v);super(r,a.e({point:v,lngLat:E,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class go extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){const m=r==="touchend"?p.changedTouches:p.touches,v=I.touchPos(h.getCanvasContainer(),m),E=v.map(L=>h.unproject(L)),C=v.reduce((L,F,V,Z)=>L.add(F.div(Z.length)),new a.P(0,0));super(r,{points:v,point:C,lngLats:E,lngLat:h.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class Sc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class to{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Sc(r.type,this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new br(r.type,this._map,r))}mouseup(r){this._map.fire(new br(r.type,this._map,r))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new br(r.type,this._map,r))}dblclick(r){return this._firePreventable(new br(r.type,this._map,r))}mouseover(r){this._map.fire(new br(r.type,this._map,r))}mouseout(r){this._map.fire(new br(r.type,this._map,r))}touchstart(r){return this._firePreventable(new go(r.type,this._map,r))}touchmove(r){this._map.fire(new go(r.type,this._map,r))}touchend(r){this._map.fire(new go(r.type,this._map,r))}touchcancel(r){this._map.fire(new go(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _o{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new br(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new br(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(a.P.convert(r),this._map.terrain)}}class io{constructor(r,h){this._map=r,this._tr=new Os(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(I.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=I.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(m.x,p.x),E=Math.max(m.x,p.x),C=Math.min(m.y,p.y),L=Math.max(m.y,p.y);I.setTransform(this._box,`translate(${v}px,${C}px)`),this._box.style.width=E-v+"px",this._box.style.height=L-C+"px"}mouseupWindow(r,h){if(!this._active||r.button!==0)return;const p=this._startPos,m=h;if(this.reset(),I.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(I.remove(this._box),this._box=null),I.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new a.k(r,{originalEvent:h}))}}function cs(y,r){if(y.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${r.length}`);const h={};for(let p=0;p<y.length;p++)h[y[p].identifier]=r[p];return h}class Qd{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const v=new a.P(0,0);for(const E of m)v._add(E);return v.div(m.length)}(h),this.touches=cs(p,h)))}touchmove(r,h,p){if(this.aborted||!this.centroid)return;const m=cs(p,h);for(const v in this.touches){const E=m[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,h,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Tc{constructor(r){this.singleTap=new Qd(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,h,p){this.singleTap.touchstart(r,h,p)}touchmove(r,h,p){this.singleTap.touchmove(r,h,p)}touchend(r,h,p){const m=this.singleTap.touchend(r,h,p);if(m){const v=r.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(v&&E||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class ef{constructor(r){this._tr=new Os(r),this._zoomIn=new Tc({numTouches:1,numTaps:2}),this._zoomOut=new Tc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,p){this._zoomIn.touchstart(r,h,p),this._zoomOut.touchstart(r,h,p)}touchmove(r,h,p){this._zoomIn.touchmove(r,h,p),this._zoomOut.touchmove(r,h,p)}touchend(r,h,p){const m=this._zoomIn.touchend(r,h,p),v=this._zoomOut.touchend(r,h,p),E=this._tr;return m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const h=this._moveFunction(...r);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(r,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&I.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ba={0:1,2:2};class yo{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const h=I.mouseButton(r);this._eventButton=h}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(h,p){const m=ba[p];return h.buttons===void 0||(h.buttons&m)!==m}(r,this._eventButton)}isValidEndEvent(r){return I.mouseButton(r)===this._eventButton}}class Lt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const dl=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(r){r.preventDefault()}},js=({enable:y,clickTolerance:r,bearingDegreesPerPixelMoved:h=.8})=>{const p=new yo({checkCorrectEvent:m=>I.mouseButton(m)===0&&m.ctrlKey||I.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,v)=>({bearingDelta:(v.x-m.x)*h}),moveStateManager:p,enable:y,assignEvents:dl})},Us=({enable:y,clickTolerance:r,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new yo({checkCorrectEvent:m=>I.mouseButton(m)===0&&m.ctrlKey||I.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,v)=>({pitchDelta:(v.y-m.y)*h}),moveStateManager:p,enable:y,assignEvents:dl})};class wh{constructor(r,h){this._clickTolerance=r.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(r,h,p){return this._calculateTransform(r,h,p)}touchmove(r,h,p){if(this._active&&!(p.length<this.minTouchs()))return r.preventDefault(),this._calculateTransform(r,h,p)}touchend(r,h,p){this._calculateTransform(r,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,p){p.length>0&&(this._active=!0);const m=cs(p,h),v=new a.P(0,0),E=new a.P(0,0);let C=0;for(const F in m){const V=m[F],Z=this._touches[F];Z&&(v._add(V),E._add(V.sub(Z)),C++,m[F]=V)}if(this._touches=m,C<this.minTouchs()||!E.mag())return;const L=E.div(C);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,p){if(!this._firstTwoTouches)return;r.preventDefault();const[m,v]=this._firstTwoTouches,E=Vs(p,h,m),C=Vs(p,h,v);if(!E||!C)return;const L=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],L,r)}touchend(r,h,p){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,E=Vs(p,h,m),C=Vs(p,h,v);E&&C||(this._active&&I.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Vs(y,r,h){for(let p=0;p<y.length;p++)if(y[p].identifier===h)return r[p]}function xh(y,r){return Math.log(y/r)/Math.LN2}class kh extends St{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xh(this._distance,p),pinchAround:h}}}function fl(y,r){return 180*y.angleWith(r)/Math.PI}class Ec extends St{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h,p){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fl(this._vector,m),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const h=25/(Math.PI*this._minDiameter)*360,p=fl(r,this._startVector);return Math.abs(p)<h}}function pl(y){return Math.abs(y.y)>Math.abs(y.x)}class Sh extends St{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,h,p){super.touchstart(r,h,p),this._currentTouchCount=p.length}_start(r){this._lastPoints=r,pl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=r[0].sub(this._lastPoints[0]),v=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,p.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(r,h,p){if(this._valid!==void 0)return this._valid;const m=r.mag()>=2,v=h.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=r.y>0==h.y>0;return pl(r)&&pl(h)&&E}}const tf={panStep:100,bearingStep:15,pitchStep:10};class $o{constructor(r){this._tr=new Os(r);const h=tf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,p=0,m=0,v=0,E=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?m=1:(r.preventDefault(),E=-1);break;case 40:r.shiftKey?m=-1:(r.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:C=>{const L=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Yi,zoom:h?Math.round(L.zoom)+h*(r.shiftKey?2:1):L.zoom,bearing:L.bearing+p*this._bearingStep,pitch:L.pitch+m*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:L.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yi(y){return y*(2-y)}const wa=4.000244140625;class ml{constructor(r,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=r,this._tr=new Os(r),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!r[this._map.cooperativeGestures._bypassKey])return;let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%wa==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=I.mousePos(this._map.getCanvas(),r),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>wa?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&L!==0&&(L=1/L);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*L))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,p=this._startZoom,m=this._easing;let v,E=!1;if(this._type==="wheel"&&p&&m){const C=Math.min((S.now()-this._lastWheelEventTime)/200,1),L=m(C);v=a.z.number(p,h,L),C<1?this._frameId||(this._frameId=!0):E=!0}else v=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,v=p.easing(m+.01)-p.easing(m),E=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-E*E);h=a.b6(E,C,.25,1)}return this._prevEase={start:S.now(),duration:r,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cc{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Th{constructor(r){this._tr=new Os(r),this.reset()}reset(){this._active=!1}dblclick(r,h){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh{constructor(){this._tap=new Tc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],v=r.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;v&&E?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(r,h,p)}touchmove(r,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,h,p)}touchend(r,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(r,h,p);m&&(this._tapTime=r.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ch{constructor(r,h,p){this._el=r,this._mousePan=h,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class no{constructor(r,h,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xa{constructor(r,h,p,m){this._el=r,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class jt{constructor(r,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=I.create("div","maplibregl-cooperative-gesture-screen",r);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=p,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(I.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(r){this._onCooperativeGesture(r.touches.length===1)}wheel(r){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!r[this._bypassKey])}_onCooperativeGesture(r){this._enabled&&r&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const $t=y=>y.zoom||y.drag||y.pitch||y.rotate;class gl extends a.k{}function ka(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Mc{constructor(r,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=m.type==="renderFrame"?void 0:m,C={needsRenderFrame:!1},L={},F={},V=m.touches,Z=V?this._getMapTouches(V):void 0,J=Z?I.touchPos(this._map.getCanvas(),Z):I.mousePos(this._map.getCanvas(),m);for(const{handlerName:_e,handler:ae,allowed:Ee}of this._handlers){if(!ae.isEnabled())continue;let Ze;this._blockedByActive(F,Ee,_e)?ae.reset():ae[v||m.type]&&(Ze=ae[v||m.type](m,J,Z),this.mergeHandlerResult(C,L,Ze,_e,E),Ze&&Ze.needsRenderFrame&&this._triggerRenderFrame()),(Ze||ae.isActive())&&(F[_e]=ae)}const pe={};for(const _e in this._previousActiveHandlers)F[_e]||(pe[_e]=E);this._previousActiveHandlers=F,(Object.keys(pe).length||ka(C))&&(this._changes.push([C,L,pe]),this._triggerRenderFrame()),(Object.keys(F).length||ka(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=C;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bh(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,E]of this._listeners)I.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[r,h,p]of this._listeners)I.removeEventListener(r,h,r===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new to(h,r));const m=h.boxZoom=new io(h,r);this._add("boxZoom",m),r.interactive&&r.boxZoom&&m.enable();const v=h.cooperativeGestures=new jt(h,r.cooperativeGestures);this._add("cooperativeGestures",v),r.cooperativeGestures&&v.enable();const E=new ef(h),C=new Th(h);h.doubleClickZoom=new Cc(C,E),this._add("tapZoom",E),this._add("clickZoom",C),r.interactive&&r.doubleClickZoom&&h.doubleClickZoom.enable();const L=new Eh;this._add("tapDragZoom",L);const F=h.touchPitch=new Sh(h);this._add("touchPitch",F),r.interactive&&r.touchPitch&&h.touchPitch.enable(r.touchPitch);const V=js(r),Z=Us(r);h.dragRotate=new no(r,V,Z),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]),r.interactive&&r.dragRotate&&h.dragRotate.enable();const J=(({enable:Ze,clickTolerance:be})=>{const De=new yo({checkCorrectEvent:We=>I.mouseButton(We)===0&&!We.ctrlKey});return new Ns({clickTolerance:be,move:(We,He)=>({around:He,panDelta:He.sub(We)}),activateOnStart:!0,moveStateManager:De,enable:Ze,assignEvents:dl})})(r),pe=new wh(r,h);h.dragPan=new Ch(p,J,pe),this._add("mousePan",J),this._add("touchPan",pe,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&h.dragPan.enable(r.dragPan);const fe=new Ec,_e=new kh;h.touchZoomRotate=new xa(p,_e,fe,L),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&h.touchZoomRotate.enable(r.touchZoomRotate);const ae=h.scrollZoom=new ml(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ae,["mousePan"]),r.interactive&&r.scrollZoom&&h.scrollZoom.enable(r.scrollZoom);const Ee=h.keyboard=new $o(h);this._add("keyboard",Ee),r.interactive&&r.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _o(h))}_add(r,h,p){this._handlers.push({handlerName:r,handler:h,allowed:p}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$t(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,h,p){for(const m in r)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(r){const h=[];for(const p of r)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(r,h,p,m,v){if(!p)return;a.e(r,p);const E={handlerName:m,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const r={},h={},p={};for(const[m,v,E]of this._changes)m.panDelta&&(r.panDelta=(r.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(r.around=m.around),m.pinchAround!==void 0&&(r.pinchAround=m.pinchAround),m.noInertia&&(r.noInertia=m.noInertia),a.e(h,v),a.e(p,E);this._updateMapTransform(r,h,p),this._changes=[]}_updateMapTransform(r,h,p){const m=this._map,v=m._getTransformForUpdate(),E=m.terrain;if(!(ka(r)||E&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:C,zoomDelta:L,bearingDelta:F,pitchDelta:V,around:Z,pinchAround:J}=r;J!==void 0&&(Z=J),m._stop(!0),Z=Z||m.transform.centerPoint;const pe=v.pointLocation(C?Z.sub(C):Z);F&&(v.bearing+=F),V&&(v.pitch+=V),L&&(v.zoom+=L),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(C)):v.setLocationAtPoint(pe,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(pe,Z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(m.terrain)})):v.setLocationAtPoint(pe,Z),m._applyUpdatedTransform(v),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,p,!0)}_fireEvents(r,h,p){const m=$t(this._eventsInProgress),v=$t(r),E={};for(const V in r){const{originalEvent:Z}=r[V];this._eventsInProgress[V]||(E[`${V}start`]=Z),this._eventsInProgress[V]=r[V]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const V in E)this._fireEvent(V,E[V]);v&&this._fireEvent("move",v.originalEvent);for(const V in r){const{originalEvent:Z}=r[V];this._fireEvent(V,Z)}const C={};let L;for(const V in this._eventsInProgress){const{handlerName:Z,originalEvent:J}=this._eventsInProgress[V];this._handlersById[Z].isActive()||(delete this._eventsInProgress[V],L=h[Z]||J,C[`${V}end`]=L)}for(const V in C)this._fireEvent(V,C[V]);const F=$t(this._eventsInProgress);if(p&&(m||v)&&!F){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!V||!V.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:L})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:L})),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new a.k(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new gl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class wr extends a.E{constructor(r,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}panBy(r,h,p){return r=a.P.convert(r).mult(-1),this.panTo(this.transform.center,a.e({offset:r},h),p)}panTo(r,h,p){return this.easeTo(a.e({center:r},h),p)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,p){return this.easeTo(a.e({zoom:r},h),p)}zoomIn(r,h){return this.zoomTo(this.getZoom()+1,r,h),this}zoomOut(r,h){return this.zoomTo(this.getZoom()-1,r,h),this}getBearing(){return this.transform.bearing}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,p){return this.easeTo(a.e({bearing:r},h),p)}resetNorth(r,h){return this.rotateTo(0,a.e({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}cameraForBounds(r,h){r=je.convert(r);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,h)}_cameraForBoxAndBearing(r,h,p,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const _t=m.padding;m.padding={top:_t,bottom:_t,right:_t,left:_t}}m.padding=a.e(v,m.padding);const E=this.transform,C=E.padding,L=new je(r,h),F=E.project(L.getNorthWest()),V=E.project(L.getNorthEast()),Z=E.project(L.getSouthEast()),J=E.project(L.getSouthWest()),pe=a.b8(-p),fe=F.rotate(pe),_e=V.rotate(pe),ae=Z.rotate(pe),Ee=J.rotate(pe),Ze=new a.P(Math.max(fe.x,_e.x,Ee.x,ae.x),Math.max(fe.y,_e.y,Ee.y,ae.y)),be=new a.P(Math.min(fe.x,_e.x,Ee.x,ae.x),Math.min(fe.y,_e.y,Ee.y,ae.y)),De=Ze.sub(be),We=(E.width-(C.left+C.right+m.padding.left+m.padding.right))/De.x,He=(E.height-(C.top+C.bottom+m.padding.top+m.padding.bottom))/De.y;if(He<0||We<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xe=Math.min(E.scaleZoom(E.scale*Math.min(We,He)),m.maxZoom),nt=a.P.convert(m.offset),it=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),ft=nt.add(it).mult(E.scale/E.zoomScale(Xe));return{center:E.unproject(F.add(Z).div(2).sub(ft)),zoom:Xe,bearing:p}}fitBounds(r,h,p){return this._fitInternal(this.cameraForBounds(r,h),h,p)}fitScreenCoordinates(r,h,p,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(r)),this.transform.pointLocation(a.P.convert(h)),p,m),m,v)}_fitInternal(r,h,p){return r?(delete(h=a.e(r,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(r,h){this.stop();const p=this._getTransformForUpdate();let m=!1,v=!1,E=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(m=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=a.M.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(v=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(E=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),v&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),E&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(r,h,p,m=0){const v=a.Y.fromLngLat(r,h),E=a.Y.fromLngLat(p,m),C=E.x-v.x,L=E.y-v.y,F=E.z-v.z,V=Math.hypot(C,L,F);if(V===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(C,L),J=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),pe=180*Math.atan2(C,-L)/Math.PI;let fe=180*Math.acos(Z/V)/Math.PI;return fe=F<0?90-fe:90+fe,{center:E.toLngLat(),zoom:J,pitch:fe,bearing:pe}}easeTo(r,h){var p;this._stop(!1,r.easeId),((r=a.e({offset:[0,0],duration:500,easing:a.b7},r)).animate===!1||!r.essential&&S.prefersReducedMotion)&&(r.duration=0);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),C=this.getPitch(),L=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,E):E,V="pitch"in r?+r.pitch:C,Z="padding"in r?r.padding:m.padding,J=a.P.convert(r.offset);let pe=m.centerPoint.add(J);const fe=m.pointLocation(pe),{center:_e,zoom:ae}=m.getConstrained(a.M.convert(r.center||fe),(p=r.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(_e);const Ee=m.project(fe),Ze=m.project(_e).sub(Ee),be=m.zoomScale(ae-v);let De,We;r.around&&(De=a.M.convert(r.around),We=m.locationPoint(De));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ae!==v,this._rotating=this._rotating||E!==F,this._pitching=this._pitching||V!==C,this._padding=!m.isPaddingEqual(Z),this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,He),this.terrain&&this._prepareElevation(_e),this._ease(Xe=>{if(this._zooming&&(m.zoom=a.z.number(v,ae,Xe)),this._rotating&&(m.bearing=a.z.number(E,F,Xe)),this._pitching&&(m.pitch=a.z.number(C,V,Xe)),this._padding&&(m.interpolatePadding(L,Z,Xe),pe=m.centerPoint.add(J)),this.terrain&&!r.freezeElevation&&this._updateElevation(Xe),De)m.setLocationAtPoint(De,We);else{const nt=m.zoomScale(m.zoom-v),it=ae>v?Math.min(2,be):Math.max(.5,be),ft=Math.pow(it,1-Xe),_t=m.unproject(Ee.add(Ze.mult(Xe*ft)).mult(nt));m.setLocationAtPoint(m.renderWorldCopies?_t.wrap():_t,pe)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Xe)},r),this}_prepareEase(r,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",r)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(p-(h-(p*r+this._elevationStart))/(1-r)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const h=r.clone(),{center:p,zoom:m,pitch:v,bearing:E,elevation:C}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),v!==void 0&&(h.pitch=v),E!==void 0&&(h.bearing=E),C!==void 0&&(h.elevation=C),this.transform.apply(h)}_fireMoveEvents(r){this.fire(new a.k("move",r)),this._zooming&&this.fire(new a.k("zoom",r)),this._rotating&&this.fire(new a.k("rotate",r)),this._pitching&&this.fire(new a.k("pitch",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",r)),m&&this.fire(new a.k("rotateend",r)),v&&this.fire(new a.k("pitchend",r)),this.fire(new a.k("moveend",r))}flyTo(r,h){var p;if(!r.essential&&S.prefersReducedMotion){const Si=a.L(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Si,h)}this.stop(),r=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},r);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),C=this.getPitch(),L=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,E):E,V="pitch"in r?+r.pitch:C,Z="padding"in r?r.padding:m.padding,J=a.P.convert(r.offset);let pe=m.centerPoint.add(J);const fe=m.pointLocation(pe),{center:_e,zoom:ae}=m.getConstrained(a.M.convert(r.center||fe),(p=r.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(_e);const Ee=m.zoomScale(ae-v),Ze=m.project(fe),be=m.project(_e).sub(Ze);let De=r.curve;const We=Math.max(m.width,m.height),He=We/Ee,Xe=be.mag();if("minZoom"in r){const Si=a.ac(Math.min(r.minZoom,v,ae),m.minZoom,m.maxZoom),Qt=We/m.zoomScale(Si-v);De=Math.sqrt(Qt/Xe*2)}const nt=De*De;function it(Si){const Qt=(He*He-We*We+(Si?-1:1)*nt*nt*Xe*Xe)/(2*(Si?He:We)*nt*Xe);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function ft(Si){return(Math.exp(Si)-Math.exp(-Si))/2}function _t(Si){return(Math.exp(Si)+Math.exp(-Si))/2}const oi=it(!1);let yt=function(Si){return _t(oi)/_t(oi+De*Si)},Kt=function(Si){return We*((_t(oi)*(ft(Qt=oi+De*Si)/_t(Qt))-ft(oi))/nt)/Xe;var Qt},si=(it(!0)-oi)/De;if(Math.abs(Xe)<1e-6||!isFinite(si)){if(Math.abs(We-He)<1e-6)return this.easeTo(r,h);const Si=He<We?-1:1;si=Math.abs(Math.log(He/We))/De,Kt=function(){return 0},yt=function(Qt){return Math.exp(Si*De*Qt)}}return r.duration="duration"in r?+r.duration:1e3*si/("screenSpeed"in r?+r.screenSpeed/De:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=E!==F,this._pitching=V!==C,this._padding=!m.isPaddingEqual(Z),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(_e),this._ease(Si=>{const Qt=Si*si,ci=1/yt(Qt);m.zoom=Si===1?ae:v+m.scaleZoom(ci),this._rotating&&(m.bearing=a.z.number(E,F,Si)),this._pitching&&(m.pitch=a.z.number(C,V,Si)),this._padding&&(m.interpolatePadding(L,Z,Si),pe=m.centerPoint.add(J)),this.terrain&&!r.freezeElevation&&this._updateElevation(Si);const pi=Si===1?_e:m.unproject(Ze.add(be.mult(Kt(Qt))).mult(ci));m.setLocationAtPoint(m.renderWorldCopies?pi.wrap():pi,pe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,h,p){p.animate===!1||p.duration===0?(r(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,h){r=a.b1(r,-180,180);const p=Math.abs(r-h);return Math.abs(r-360-h)<p&&(r-=360),Math.abs(r+360-h)<p&&(r+=360),r}_normalizeCenter(r){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=r.lng-h.center.lng;r.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}const Ic={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ro{constructor(r=Ic){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=I.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=I.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=I.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){I.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,h){const p=this._map._getUIString(`AttributionControl.${h}`);r.title=p,r.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const v=h[m];if(v.used||v.usedForTerrain){const E=v.getSource();E.attribution&&r.indexOf(E.attribution)<0&&r.push(E.attribution)}}r=r.filter(m=>String(m).trim()),r.sort((m,v)=>m.length-v.length),r=r.filter((m,v)=>{for(let E=v+1;E<r.length;E++)if(r[E].indexOf(m)>=0)return!1;return!0});const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Mh{constructor(r={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=I.create("div","maplibregl-ctrl");const h=I.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){I.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===r)return void(m.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var hn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class kn extends a.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,h){this.sourceCache.update(r,h),this._renderableTilesKeys=[];const p={};for(const m of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Hn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(r){for(const h in this._tiles){const p=this._tiles[h];(!r||p.tileID.equals(r)||p.tileID.isChildOf(r)||r.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(r.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16),a.aN(v.posMatrix,0,a.W,0,a.W,0,1),h[p]=v}else if(m.canonical.isChildOf(r.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16);const E=m.canonical.z-r.canonical.z,C=m.canonical.x-(m.canonical.x>>E<<E),L=m.canonical.y-(m.canonical.y>>E<<E),F=a.W>>E;a.aN(v.posMatrix,0,F,0,F,0,1),a.H(v.posMatrix,v.posMatrix,[-C*F,-L*F,0]),h[p]=v}else if(r.canonical.isChildOf(m.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16);const E=r.canonical.z-m.canonical.z,C=r.canonical.x-(r.canonical.x>>E<<E),L=r.canonical.y-(r.canonical.y>>E<<E),F=a.W>>E;a.aN(v.posMatrix,0,a.W,0,a.W,0,1),a.H(v.posMatrix,v.posMatrix,[C*F,L*F,0]),a.J(v.posMatrix,v.posMatrix,[1/2**E,1/2**E,0]),h[p]=v}}return h}getSourceTile(r,h){const p=this.sourceCache._source;let m=r.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!v||!v.dem)&&h)for(;m>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(r.scaledTo(m--).key);return v}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=r)}}class Ih{constructor(r,h,p){this.painter=r,this.sourceCache=new kn(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,h,p,m=a.W){var v;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const E=this.getTerrainData(r),C=(v=E.tile)===null||v===void 0?void 0:v.dem;if(!C)return 0;const L=function(fe,_e,ae){var Ee=_e[0],Ze=_e[1];return fe[0]=ae[0]*Ee+ae[4]*Ze+ae[12],fe[1]=ae[1]*Ee+ae[5]*Ze+ae[13],fe}([],[h/m*a.W,p/m*a.W],E.u_terrain_matrix),F=[L[0]*C.dim,L[1]*C.dim],V=Math.floor(F[0]),Z=Math.floor(F[1]),J=F[0]-V,pe=F[1]-Z;return C.get(V,Z)*(1-J)*(1-pe)+C.get(V+1,Z)*J*(1-pe)+C.get(V,Z+1)*(1-J)*pe+C.get(V+1,Z+1)*J*pe}getElevationForLngLatZoom(r,h){const{tileID:p,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(r,h);return this.getElevation(p,m%a.W,v%a.W,a.W)}getElevation(r,h,p,m=a.W){return this.getDEMElevation(r,h,p,m)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const m=this.painter.context,v=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ne(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ne(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(r,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ne(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+r.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=r.canonical.z-h.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=m?v=r.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=r.canonical.x-(r.canonical.x>>v<<v),C=r.canonical.y-(r.canonical.y>>v<<v),L=a.b9(new Float64Array(16),[1/(a.W<<v),1/(a.W<<v),0]);a.H(L,L,[E*a.W,C*a.W,0]),this._demMatrixCache[r.key]={matrix:L,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(r){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,E=0;v<this._coordsTextureSize;v++)for(let C=0;C<this._coordsTextureSize;C++,E+=4)h[E+0]=255&C,h[E+1]=255&v,h[E+2]=C>>8<<4|v>>8,h[E+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new ne(r,p,r.gl.RGBA,{premultiply:!1});return m.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,v=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(v,C-E-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const L=h[0]+(h[2]>>4<<8),F=h[1]+((15&h[2])<<8),V=this.coordsIndex[255-h[3]],Z=V&&this.sourceCache.getTileByID(V);if(!Z)return null;const J=this._coordsTextureSize,pe=(1<<Z.tileID.canonical.z)*J;return new a.Y((Z.tileID.canonical.x*J+L)/pe+Z.tileID.wrap,(Z.tileID.canonical.y*J+F)/pe,this.getElevation(Z.tileID,L,F,J))}depthAtPoint(r){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,v=a.W/m,E=m*m;for(let Z=0;Z<=m;Z++)for(let J=0;J<=m;J++)h.emplaceBack(J*v,Z*v,0);for(let Z=0;Z<E;Z+=m+1)for(let J=0;J<m;J++)p.emplaceBack(J+Z,m+J+Z+1,m+J+Z+2),p.emplaceBack(J+Z,m+J+Z+2,J+Z+1);const C=h.length,L=C+2*(m+1);for(const Z of[0,1])for(let J=0;J<=m;J++)for(const pe of[0,1])h.emplaceBack(J*v,Z*a.W,pe);for(let Z=0;Z<2*m;Z+=2)p.emplaceBack(L+Z,L+Z+1,L+Z+3),p.emplaceBack(L+Z,L+Z+3,L+Z+2),p.emplaceBack(C+Z,C+Z+3,C+Z+1),p.emplaceBack(C+Z,C+Z+2,C+Z+3);const F=h.length,V=F+2*(m+1);for(const Z of[0,1])for(let J=0;J<=m;J++)for(const pe of[0,1])h.emplaceBack(Z*a.W,J*v,pe);for(let Z=0;Z<2*m;Z+=2)p.emplaceBack(F+Z,F+Z+1,F+Z+3),p.emplaceBack(F+Z,F+Z+3,F+Z+2),p.emplaceBack(V+Z,V+Z+3,V+Z+1),p.emplaceBack(V+Z,V+Z+2,V+Z+3);return this._mesh={indexBuffer:r.createIndexBuffer(p),vertexBuffer:r.createVertexBuffer(h,hn.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*a.bb/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(r,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(r){const h=this.getTerrainData(r).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(r,h){const p=a.Y.fromLngLat(r.wrap()),m=(1<<h)*a.W,v=p.x*m,E=p.y*m,C=Math.floor(v/a.W),L=Math.floor(E/a.W);return{tileID:new a.Q(h,0,h,C,L),mercatorX:v,mercatorY:E}}}class Ta{constructor(r,h,p){this._context=r,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ne(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:r,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>r.id!==h),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Ao={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Lc{constructor(r,h){this.painter=r,this.terrain=h,this.pool=new Ta(r.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(p=>!r._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in r.sourceCaches){this._coordsDescendingInv[p]={};const m=r.sourceCaches[p].getVisibleCoordinates();for(const v of m){const E=this.terrain.sourceCache.getTerrainCoords(v);for(const C in E)this._coordsDescendingInv[p][C]||(this._coordsDescendingInv[p][C]=[]),this._coordsDescendingInv[p][C].push(E[C])}}this._coordsDescendingInvStr={};for(const p of r._order){const m=r._layers[p],v=m.source;if(Ao[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const E in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][E]=this._coordsDescendingInv[v][E].map(C=>C.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][p.tileID.key];v&&v!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const h=r.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Ao[h]&&(this._prevType&&Ao[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(r.id),!m))return!0;if(Ao[this._prevType]||Ao[h]&&m){this._prevType=h;const v=this._stacks.length-1,E=this._stacks[v]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(ul(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[v]){const F=this.pool.getObjectForId(C.rtt[v].id);if(F.stamp===C.rtt[v].stamp){this.pool.useObject(F);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),C.rtt[v]={id:L.id,stamp:L.stamp},p.context.bindFramebuffer.set(L.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let F=0;F<E.length;F++){const V=p.style._layers[E[F]],Z=V.source?this._coordsDescendingInv[V.source][C.tileID.key]:[C.tileID];p.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),p._renderTileClippingMasks(V,Z),p.renderLayer(p,p.style.sourceCaches[V.source],V,Z),V.source&&(C.rttCoords[V.source]=this._coordsDescendingInvStr[V.source][C.tileID.key])}}return ul(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ao[h]}return!1}}const Ac={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Pc=_,Ea={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ic,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},_l=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},zc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dc{constructor(r,h,p=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),I.mousePos(this.element,E)),I.addEventListener(window,"mousemove",this.mousemove),I.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,I.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=I.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),I.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=I.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=r.dragRotate._mouseRotate.getClickTolerance(),v=r.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=js({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:C,bearingDegreesPerPixelMoved:L=.8})=>{const F=new Lt;return new Ns({clickTolerance:C,move:(V,Z)=>({bearingDelta:(Z.x-V.x)*L}),moveStateManager:F,enable:E,assignEvents:_l})})({clickTolerance:m,enable:!0}),this.map=r,p&&(this.mousePitch=Us({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:C,pitchDegreesPerPixelMoved:L=-.5})=>{const F=new Lt;return new Ns({clickTolerance:C,move:(V,Z)=>({pitchDelta:(Z.y-V.y)*L}),moveStateManager:F,enable:E,assignEvents:_l})})({clickTolerance:v,enable:!0})),I.addEventListener(h,"mousedown",this.mousedown),I.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),I.addEventListener(h,"touchcancel",this.reset)}startMouse(r,h){this.mouseRotate.dragStart(r,h),this.mousePitch&&this.mousePitch.dragStart(r,h),I.disableDrag()}startTouch(r,h){this.touchRotate.dragStart(r,h),this.touchPitch&&this.touchPitch.dragStart(r,h),I.disableDrag()}moveMouse(r,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(r,h)||{};v&&p.setPitch(p.getPitch()+v)}}moveTouch(r,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(r,h)||{};v&&p.setPitch(p.getPitch()+v)}}off(){const r=this.element;I.removeEventListener(r,"mousedown",this.mousedown),I.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend),I.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){I.enableDrag(),I.removeEventListener(window,"mousemove",this.mousemove),I.removeEventListener(window,"mouseup",this.mouseup),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend)}}let Po;function yl(y,r,h){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),r){const m=new a.M(y.lng-360,y.lat),v=new a.M(y.lng+360,y.lat),E=h.locationPoint(y).distSqr(r);h.locationPoint(m).distSqr(r)<E?y=m:h.locationPoint(v).distSqr(r)<E&&(y=v)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:p}const Ca={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vl(y,r,h){const p=y.classList;for(const m in Ca)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${r}`)}class Ma extends a.E{constructor(r){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?yl(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),I.setTransform(this._element,`${Ca[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${v}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=a.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=I.create("div"),this._element.setAttribute("aria-label","Map marker");const h=I.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const v=I.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const E=I.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const C=I.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ee of L){const Ze=I.createNS("http://www.w3.org/2000/svg","ellipse");Ze.setAttributeNS(null,"opacity","0.04"),Ze.setAttributeNS(null,"cx","10.5"),Ze.setAttributeNS(null,"cy","5.80029008"),Ze.setAttributeNS(null,"rx",Ee.rx),Ze.setAttributeNS(null,"ry",Ee.ry),C.appendChild(Ze)}const F=I.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const V=I.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(V);const Z=I.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const J=I.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(J);const pe=I.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),pe.setAttributeNS(null,"fill","#FFFFFF");const fe=I.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=I.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const ae=I.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),fe.appendChild(_e),fe.appendChild(ae),E.appendChild(C),E.appendChild(F),E.appendChild(Z),E.appendChild(pe),E.appendChild(fe),h.appendChild(E),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),vl(this._element,this._anchor,"marker"),r&&r.className)for(const h of r.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),I.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.M.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const m=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,v=m.terrain.depthAtPoint(this._pos),E=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,E)-v<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/m.transform._pixelPerMeter,L=Math.sin(m.getPitch()*Math.PI/180)*C,F=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),V=m.transform.lngLatToCameraDepth(this._lngLat,E+L)-F>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=a.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,h){return r===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qs=0,us=!1;const wl={maxWidth:100,unit:"metric"};function xl(y,r,h){const p=h&&h.maxWidth||100,m=y._container.clientHeight/2,v=y.unproject([0,m]),E=y.unproject([p,m]),C=v.distanceTo(E);if(h&&h.unit==="imperial"){const L=3.2808*C;L>5280?hs(r,p,L/5280,y._getUIString("ScaleControl.Miles")):hs(r,p,L,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?hs(r,p,C/1852,y._getUIString("ScaleControl.NauticalMiles")):C>=1e3?hs(r,p,C/1e3,y._getUIString("ScaleControl.Kilometers")):hs(r,p,C,y._getUIString("ScaleControl.Meters"))}function hs(y,r,h,p){const m=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let C=v/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(L){const F=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*F)/F}(C),E*C}(h);y.style.width=r*(m/h)+"px",y.innerHTML=`${m}&nbsp;${p}`}const Rc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kl(y){if(y){if(typeof y=="number"){const r=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(r,r),"top-right":new a.P(-r,r),bottom:new a.P(0,-y),"bottom-left":new a.P(r,-r),"bottom-right":new a.P(-r,-r),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const r=a.P.convert(y);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return kl(new a.P(0,0))}const Lh=_;f.AJAXError=a.be,f.Evented=a.E,f.LngLat=a.M,f.MercatorCoordinate=a.Y,f.Point=a.P,f.addProtocol=a.bf,f.config=a.a,f.removeProtocol=a.bg,f.AttributionControl=ro,f.BoxZoomHandler=io,f.CanvasSource=bn,f.CooperativeGesturesHandler=jt,f.DoubleClickZoomHandler=Cc,f.DragPanHandler=Ch,f.DragRotateHandler=no,f.EdgeInsets=Fs,f.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var r;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=h==null?void 0:h.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){I.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=I.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);I.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Ve,f.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const h=new a.M(r.coords.longitude,r.coords.latitude),p=r.coords.accuracy,m=this._map.getBearing(),v=a.e({bearing:m},this.options.fitBoundsOptions),E=je.fromLngLat(h,p);this._map.fitBounds(E,v,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const h=new a.M(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&us)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=I.create("button","maplibregl-ctrl-geolocate",this._container),I.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=I.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ma({element:this._dotElement}),this._circleElement=I.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ma({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},bl,y)}onAdd(y){return this._map=y,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(r=!1){if(Po!==void 0&&!r)return Po;if(window.navigator.permissions===void 0)return Po=!!window.navigator.geolocation,Po;try{Po=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Po=!!window.navigator.geolocation}return Po})}().then(r=>this._setupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),I.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,qs=0,us=!1}_isOutOfMapMaxBounds(y){const r=this._map.getMaxBounds(),h=y.coords;return r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),r=y.getSouthEast(),h=y.getNorthEast(),p=r.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qs--,us=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qs++,qs>1?(y={maximumAge:6e5,timeout:0},us=!0):(y=this.options.positionOptions,us=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.Hash=kc,f.ImageSource=kt,f.KeyboardHandler=$o,f.LngLatBounds=je,f.LogoControl=Mh,f.Map=class extends wr{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},Ea,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Sa,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},Ac,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=U.addThrottleControl(()=>this.isMoving()),this._requestManager=new q(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const h=xc(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{r?h(p):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Mc(this,y),this._hash=y.hash&&new kc(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new ro(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Mh,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new a.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(y,r){if(r===void 0&&(r=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(y);return r>-1&&this._controls.splice(r,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,r,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,r,h,p)}resize(y){var r;const h=this._containerDimensions(),p=h[0],m=h[1],v=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,v),this.painter.resize(p,m,v),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const L=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,L),this.painter.resize(p,m,L)}this.transform.resize(p,m),(r=this._requestedCameraState)===null||r===void 0||r.resize(p,m);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),E&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,r){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),v=y*m,E=r*m;return Math.min(v>h?h/v:1,E>p?p/E:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(je.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,r,h){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:v=>{const E=this.getLayer(r)?this.queryRenderedFeatures(v.point,{layers:[r]}):[];E.length?p||(p=!0,h.call(this,new br(y,this,v.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:E=>{(this.getLayer(r)?this.queryRenderedFeatures(E.point,{layers:[r]}):[]).length?p=!0:p&&(p=!1,h.call(this,new br(y,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new br(y,this,E.originalEvent)))}}}}{const p=m=>{const v=this.getLayer(r)?this.queryRenderedFeatures(m.point,{layers:[r]}):[];v.length&&(m.features=v,h.call(this,m),delete m.features)};return{layer:r,listener:h,delegates:{[y]:p}}}}on(y,r,h){if(h===void 0)return super.on(y,r);const p=this._createDelegatedListener(y,r,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,r,h){if(h===void 0)return super.once(y,r);const p=this._createDelegatedListener(y,r,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,r,h){return h===void 0?super.off(y,r):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let v=0;v<m.length;v++){const E=m[v];if(E.layer===r&&E.listener===h){for(const C in E.delegates)this.off(C,E.delegates[C]);return m.splice(v,1),this}}})(),this)}queryRenderedFeatures(y,r){if(!this.style)return[];let h;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const v=a.P.convert(m[0]),E=a.P.convert(m[1]);h=[v,new a.P(E.x,v.y),E,new a.P(v.x,E.y),v]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(y,r){return this.style.querySourceFeatures(y,r)}setStyle(y,r){return(r=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(y,r))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const r=this._locale[y];if(r==null)throw new Error(`Missing UI string '${y}'`);return r}_updateStyle(y,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,r));const h=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new zr(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,r,h):this.style.loadJSON(y,r,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,r){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,r)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,r)}_updateDiff(y,r){try{this.style.setState(y,r)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,r){return this._lazyInitEmptyStyle(),this.style.addSource(y,r),this._update(!0)}isSourceLoaded(y){const r=this.style&&this.style.sourceCaches[y];if(r!==void 0)return r.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const r=this.style.sourceCaches[y.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&r.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ih(this.painter,r,y),this.painter.renderToTexture=new Lc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,r;return(r=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const r in y){const h=y[r]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,r,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:v,stretchY:E,content:C}=h;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||a.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:F,data:V}=r,Z=r;return this.style.addImage(y,{data:new a.R({width:L,height:F},new Uint8Array(V)),pixelRatio:p,stretchX:v,stretchY:E,content:C,sdf:m,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,y),this}}{const{width:L,height:F,data:V}=S.getImageData(r);this.style.addImage(y,{data:new a.R({width:L,height:F},V),pixelRatio:p,stretchX:v,stretchY:E,content:C,sdf:m,version:0})}}updateImage(y,r){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof HTMLImageElement||a.b(r)?S.getImageData(r):r,{width:m,height:v,data:E}=p;if(m===void 0||v===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||v!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(r instanceof HTMLImageElement||a.b(r));return h.data.replace(E,C),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return U.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,r){return this._lazyInitEmptyStyle(),this.style.addLayer(y,r),this._update(!0)}moveLayer(y,r){return this.style.moveLayer(y,r),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,r,h){return this.style.setLayerZoomRange(y,r,h),this._update(!0)}setFilter(y,r,h={}){return this.style.setFilter(y,r,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,r,h,p={}){return this.style.setPaintProperty(y,r,h,p),this._update(!0)}getPaintProperty(y,r){return this.style.getPaintProperty(y,r)}setLayoutProperty(y,r,h,p={}){return this.style.setLayoutProperty(y,r,h,p),this._update(!0)}getLayoutProperty(y,r){return this.style.getLayoutProperty(y,r)}setGlyphs(y,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,r,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,r,h,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,r,h=>{h||this._update(!0)}),this}setLight(y,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,r){return this.style.setFeatureState(y,r),this._update()}removeFeatureState(y,r){return this.style.removeFeatureState(y,r),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,r=0;return this._container&&(y=this._container.clientWidth||400,r=this._container.clientHeight||300),[y,r]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const r=this._canvasContainer=I.create("div","maplibregl-canvas-container",y);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=I.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=I.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{v[E]=I.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,r,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*r),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{r={requestedAttributes:y},p&&(r.statusMessage=p.statusMessage,r.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const p="Failed to initialize WebGL";throw r?(r.message=p,new Error(JSON.stringify(r))):new Error(p)}this.painter=new gh(h,this.transform),P.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,v=S.now();this.style.zoomHistory.update(m,v);const E=new a.a8(m,{now:v,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=E.crossFadingFactor();C===1&&C===this._crossFadingFactor||(h=!0,this._crossFadingFactor=C),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),U.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),I.remove(this._canvasContainer),I.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Pc}getCameraTargetElevation(){return this.transform.elevation}},f.MapMouseEvent=br,f.MapTouchEvent=go,f.MapWheelEvent=Sc,f.Marker=Ma,f.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const r=this._map.getZoom(),h=r===this._map.getMaxZoom(),p=r===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);r.title=p,r.setAttribute("aria-label",p)},this.options=a.e({},zc,y),this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),I.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),I.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=I.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){I.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,r){const h=I.create("button",y,this._container);return h.type="button",h.addEventListener("click",r),h}},f.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&I.remove(this._content),this._container&&(I.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=I.create("div","maplibregl-popup",this._map.getContainer()),this._tip=I.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?yl(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!r)return;const p=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const v=kl(this.options.offset);if(!m){const C=this._container.offsetWidth,L=this._container.offsetHeight;let F;F=p.y+v.bottom.y<L?["top"]:p.y>this._map.transform.height-L?["bottom"]:[],p.x<C/2?F.push("left"):p.x>this._map.transform.width-C/2&&F.push("right"),m=F.length===0?"bottom":F.join("-")}let E=p.add(v[m]);this.options.subpixelPositioning||(E=E.round()),I.setTransform(this._container,`${Ca[m]} translate(${E.x}px,${E.y}px)`),vl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Rc),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const r=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=y;p=h.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=I.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=I.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Bc);y&&y.focus()}},f.RasterDEMTileSource=di,f.RasterTileSource=we,f.ScaleControl=class{constructor(y){this._onMove=()=>{xl(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,xl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wl),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){I.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=ml,f.Style=zr,f.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=I.create("button","maplibregl-ctrl-terrain",this._container),I.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){I.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=Sh,f.TwoFingersTouchRotateHandler=Ec,f.TwoFingersTouchZoomHandler=kh,f.TwoFingersTouchZoomRotateHandler=xa,f.VectorTileSource=xt,f.VideoSource=vn,f.addSourceType=(y,r)=>a._(void 0,void 0,void 0,function*(){if(er(y))throw new Error(`A source type called "${y}" already exists.`);((h,p)=>{Cn[h]=p})(y,r)}),f.clearPrewarmedResources=function(){const y=ei;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(zt),ei=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return ut().getRTLTextPluginStatus()},f.getVersion=function(){return Lh},f.getWorkerCount=function(){return Jt.workerCount},f.getWorkerUrl=function(){return a.a.WORKER_URL},f.importScriptInWorkers=function(y){return yi().broadcast("IS",y)},f.prewarm=function(){hi().acquire(zt)},f.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},f.setRTLTextPlugin=function(y,r){return ut().setRTLTextPlugin(y,r)},f.setWorkerCount=function(y){Jt.workerCount=y},f.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var u=t;return u})})(Yy);var Ts=Yy.exports;const Qr=Jy(Ts),mb=Xv({__proto__:null,default:Qr},[Ts]);let Ut;const e0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&e0.decode();let du=null;function bu(){return(du===null||du.byteLength===0)&&(du=new Uint8Array(Ut.memory.buffer)),du}function So(o,e){return o=o>>>0,e0.decode(bu().subarray(o,o+e))}const bs=new Array(128).fill(void 0);bs.push(void 0,null,!0,!1);let wu=bs.length;function Rn(o){wu===bs.length&&bs.push(bs.length+1);const e=wu;return wu=bs[e],bs[e]=o,e}function Ti(o){return bs[o]}function gb(o){o<132||(bs[o]=wu,wu=o)}function ql(o){const e=Ti(o);return gb(o),e}function Gf(o){return o==null}let fu=null;function _b(){return(fu===null||fu.byteLength===0)&&(fu=new Float64Array(Ut.memory.buffer)),fu}let pu=null;function Ii(){return(pu===null||pu.byteLength===0)&&(pu=new Int32Array(Ut.memory.buffer)),pu}let Js=0;const od=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},yb=typeof od.encodeInto=="function"?function(o,e){return od.encodeInto(o,e)}:function(o,e){const t=od.encode(o);return e.set(t),{read:o.length,written:t.length}};function ed(o,e,t){if(t===void 0){const a=od.encode(o),_=e(a.length,1)>>>0;return bu().subarray(_,_+a.length).set(a),Js=a.length,_}let n=o.length,l=e(n,1)>>>0;const u=bu();let f=0;for(;f<n;f++){const a=o.charCodeAt(f);if(a>127)break;u[l+f]=a}if(f!==n){f!==0&&(o=o.slice(f)),l=t(l,n,n=f+o.length*3,1)>>>0;const a=bu().subarray(l+f,l+n),_=yb(o,a);f+=_.written}return Js=f,l}function rp(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=rp(o[0]));for(let f=1;f<l;f++)u+=", "+rp(o[f]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function vb(o,e){const t=e(o.length*1,1)>>>0;return bu().set(o,t/1),Js=o.length,t}function Wf(o,e){try{return o.apply(this,e)}catch(t){Ut.__wbindgen_exn_store(Rn(t))}}class gd{static __wrap(e){e=e>>>0;const t=Object.create(gd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ut.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=Ut.__wbindgen_add_to_stack_pointer(-16),f=vb(e,Ut.__wbindgen_malloc),a=Js;Ut.jsroutesnapper_new(u,f,a);var t=Ii()[u/4+0],n=Ii()[u/4+1],l=Ii()[u/4+2];if(l)throw ql(n);return gd.__wrap(t)}finally{Ut.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Ut.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Rn(e))}setAreaMode(){Ut.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_getConfig(u,this.__wbg_ptr);var n=Ii()[u/4+0],l=Ii()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Ii()[n/4+0],t=Ii()[n/4+1];let l;return e!==0&&(l=So(e,t).slice(),Ut.__wbindgen_free(e,t*1)),l}finally{Ut.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var n=Ii()[u/4+0],l=Ii()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}toggleSnapMode(){Ut.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return Ut.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){Ut.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Ut.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Ut.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Ut.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_editExisting(l,this.__wbg_ptr,Rn(e));var t=Ii()[l/4+0],n=Ii()[l/4+1];if(n)throw ql(t)}finally{Ut.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var n=Ii()[u/4+0],l=Ii()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var n=Ii()[u/4+0],l=Ii()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const k=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Rn(e));var l=Ii()[k/4+0],u=Ii()[k/4+1],f=Ii()[k/4+2],a=Ii()[k/4+3],_=l,b=u;if(a)throw _=0,b=0,ql(f);return t=_,n=b,So(_,b)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){Ut.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Ut.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const k=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Rn(e));var l=Ii()[k/4+0],u=Ii()[k/4+1],f=Ii()[k/4+2],a=Ii()[k/4+3],_=l,b=u;if(a)throw _=0,b=0,ql(f);return t=_,n=b,So(_,b)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,l;try{const S=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Rn(e),Rn(t));var u=Ii()[S/4+0],f=Ii()[S/4+1],a=Ii()[S/4+2],_=Ii()[S/4+3],b=u,k=f;if(_)throw b=0,k=0,ql(a);return n=b,l=k,So(b,k)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(n,l,1)}}}async function bb(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function wb(){const o={};return o.wbg={},o.wbg.__wbindgen_string_new=function(e,t){const n=So(e,t);return Rn(n)},o.wbg.__wbindgen_object_drop_ref=function(e){ql(e)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(So(e,t));return Rn(n)},o.wbg.__wbindgen_number_get=function(e,t){const n=Ti(t),l=typeof n=="number"?n:void 0;_b()[e/8+1]=Gf(l)?0:l,Ii()[e/4+0]=!Gf(l)},o.wbg.__wbindgen_is_object=function(e){const t=Ti(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_is_undefined=function(e){return Ti(e)===void 0},o.wbg.__wbindgen_in=function(e,t){return Ti(e)in Ti(t)},o.wbg.__wbindgen_boolean_get=function(e){const t=Ti(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ti(e)==Ti(t)},o.wbg.__wbindgen_string_get=function(e,t){const n=Ti(t),l=typeof n=="string"?n:void 0;var u=Gf(l)?0:ed(l,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),f=Js;Ii()[e/4+1]=f,Ii()[e/4+0]=u},o.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Ti(t)),l=ed(n,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),u=Js;Ii()[e/4+1]=u,Ii()[e/4+0]=l},o.wbg.__wbindgen_object_clone_ref=function(e){const t=Ti(e);return Rn(t)},o.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Ti(e)[Ti(t)];return Rn(n)},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Rn(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ti(t).stack,l=ed(n,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),u=Js;Ii()[e/4+1]=u,Ii()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(So(e,t))}finally{Ut.__wbindgen_free(n,l,1)}},o.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ti(e))},o.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ti(e))},o.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ti(e))},o.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ti(e))},o.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ti(e))},o.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Ti(e)[t>>>0];return Rn(n)},o.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ti(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof Ti(e)=="function"},o.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ti(e).next;return Rn(t)},o.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Wf(function(e){const t=Ti(e).next();return Rn(t)},arguments)},o.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ti(e).done},o.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ti(e).value;return Rn(t)},o.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Rn(Symbol.iterator)},o.wbg.__wbg_get_97b561fb56f034b5=function(){return Wf(function(e,t){const n=Reflect.get(Ti(e),Ti(t));return Rn(n)},arguments)},o.wbg.__wbg_call_cb65541d95d71282=function(){return Wf(function(e,t){const n=Ti(e).call(Ti(t));return Rn(n)},arguments)},o.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ti(e))},o.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ti(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ti(e).buffer;return Rn(t)},o.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ti(e));return Rn(t)},o.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Ti(e).set(Ti(t),n>>>0)},o.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ti(e).length},o.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ti(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_debug_string=function(e,t){const n=rp(Ti(t)),l=ed(n,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),u=Js;Ii()[e/4+1]=u,Ii()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(So(e,t))},o.wbg.__wbindgen_memory=function(){const e=Ut.memory;return Rn(e)},o}function xb(o,e){return Ut=o.exports,t0.__wbindgen_wasm_module=e,fu=null,pu=null,du=null,Ut}async function t0(o){if(Ut!==void 0)return Ut;typeof o>"u"&&(o="/ltn/assets/route_snapper_bg.wasm");const e=wb();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await bb(await o,e);return xb(t,n)}var Mr=63710088e-1,Ip={centimeters:Mr*100,centimetres:Mr*100,degrees:Mr/111325,feet:Mr*3.28084,inches:Mr*39.37,kilometers:Mr/1e3,kilometres:Mr/1e3,meters:Mr,metres:Mr,miles:Mr/1609.344,millimeters:Mr*1e3,millimetres:Mr*1e3,nauticalmiles:Mr/1852,radians:1,yards:Mr*1.0936},kb={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Mr,yards:1.0936133},op={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Io(o,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function Sb(o,e,t){switch(o){case"Point":return Yr(e).geometry;case"LineString":return Eo(e).geometry;case"Polygon":return Lp(e).geometry;case"MultiPoint":return n0(e).geometry;case"MultiLineString":return i0(e).geometry;case"MultiPolygon":return r0(e).geometry;default:throw new Error(o+" is invalid")}}function Yr(o,e,t){if(t===void 0&&(t={}),!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_d(o[0])||!_d(o[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:o};return Io(n,e,t)}function Tb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Yr(n,e)}),t)}function Lp(o,e,t){t===void 0&&(t={});for(var n=0,l=o;n<l.length;n++){var u=l[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<u[u.length-1].length;f++)if(u[u.length-1][f]!==u[0][f])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:o};return Io(a,e,t)}function Eb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Lp(n,e)}),t)}function Eo(o,e,t){if(t===void 0&&(t={}),o.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:o};return Io(n,e,t)}function Cb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Eo(n,e)}),t)}function Ba(o,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function i0(o,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:o};return Io(n,e,t)}function n0(o,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:o};return Io(n,e,t)}function r0(o,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:o};return Io(n,e,t)}function Mb(o,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:o};return Io(n,e,t)}function Ib(o,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(o*t)/t}function Ap(o,e){e===void 0&&(e="kilometers");var t=Ip[e];if(!t)throw new Error(e+" units is invalid");return o*t}function Ld(o,e){e===void 0&&(e="kilometers");var t=Ip[e];if(!t)throw new Error(e+" units is invalid");return o/t}function Lb(o,e){return Eu(Ld(o,e))}function Ab(o){var e=o%360;return e<0&&(e+=360),e}function Eu(o){var e=o%(2*Math.PI);return e*180/Math.PI}function Co(o){var e=o%360;return e*Math.PI/180}function Pb(o,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("length must be a positive number");return Ap(Ld(o,e),t)}function zb(o,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("area must be a positive number");var n=op[e];if(!n)throw new Error("invalid original units");var l=op[t];if(!l)throw new Error("invalid final units");return o/n*l}function _d(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Pp(o){return!!o&&o.constructor===Object}function Db(o){if(!o)throw new Error("bbox is required");if(!Array.isArray(o))throw new Error("bbox must be an Array");if(o.length!==4&&o.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");o.forEach(function(e){if(!_d(e))throw new Error("bbox must only contain numbers")})}function Rb(o){if(!o)throw new Error("id is required");if(["string","number"].indexOf(typeof o)===-1)throw new Error("id must be a number or a string")}const Bb=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:op,bearingToAzimuth:Ab,convertArea:zb,convertLength:Pb,degreesToRadians:Co,earthRadius:Mr,factors:Ip,feature:Io,featureCollection:Ba,geometry:Sb,geometryCollection:Mb,isNumber:_d,isObject:Pp,lengthToDegrees:Lb,lengthToRadians:Ld,lineString:Eo,lineStrings:Cb,multiLineString:i0,multiPoint:n0,multiPolygon:r0,point:Yr,points:Tb,polygon:Lp,polygons:Eb,radiansToDegrees:Eu,radiansToLength:Ap,round:Ib,unitsFactors:kb,validateBBox:Db,validateId:Rb},Symbol.toStringTag,{value:"Module"}));function Cu(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return o.geometry.coordinates;if(o.type==="Point")return o.coordinates}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return o;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ql(o){if(Array.isArray(o))return o;if(o.type==="Feature"){if(o.geometry!==null)return o.geometry.coordinates}else if(o.coordinates)return o.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ou(o,e,t){t===void 0&&(t={});var n=Cu(o),l=Cu(e),u=Co(l[1]-n[1]),f=Co(l[0]-n[0]),a=Co(n[1]),_=Co(l[1]),b=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(a)*Math.cos(_);return Ap(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)),t.units)}function ju(o,e,t){if(o!==null)for(var n,l,u,f,a,_,b,k=0,S=0,I,P=o.type,D=P==="FeatureCollection",B=P==="Feature",z=D?o.features.length:1,R=0;R<z;R++){b=D?o.features[R].geometry:B?o.geometry:o,I=b?b.type==="GeometryCollection":!1,a=I?b.geometries.length:1;for(var O=0;O<a;O++){var U=0,q=0;if(f=I?b.geometries[O]:b,f!==null){_=f.coordinates;var se=f.type;switch(k=t&&(se==="Polygon"||se==="MultiPolygon")?1:0,se){case null:break;case"Point":if(e(_,S,R,U,q)===!1)return!1;S++,U++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,R,U,q)===!1)return!1;S++,se==="MultiPoint"&&U++}se==="LineString"&&U++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,R,U,q)===!1)return!1;S++}se==="MultiLineString"&&U++,se==="Polygon"&&q++}se==="Polygon"&&U++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(q=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,R,U,q)===!1)return!1;S++}q++}U++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(ju(f.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Fb(o,e,t,n){var l=t;return ju(o,function(u,f,a,_,b){f===0&&t===void 0?l=u:l=e(l,u,f,a,_,b)},n),l}function o0(o,e){var t;switch(o.type){case"FeatureCollection":for(t=0;t<o.features.length&&e(o.features[t].properties,t)!==!1;t++);break;case"Feature":e(o.properties,0);break}}function Ob(o,e,t){var n=t;return o0(o,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function yd(o,e){if(o.type==="Feature")e(o,0);else if(o.type==="FeatureCollection")for(var t=0;t<o.features.length&&e(o.features[t],t)!==!1;t++);}function Nb(o,e,t){var n=t;return yd(o,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function jb(o){var e=[];return ju(o,function(t){e.push(t)}),e}function zp(o,e){var t,n,l,u,f,a,_,b,k,S,I=0,P=o.type==="FeatureCollection",D=o.type==="Feature",B=P?o.features.length:1;for(t=0;t<B;t++){for(a=P?o.features[t].geometry:D?o.geometry:o,b=P?o.features[t].properties:D?o.properties:{},k=P?o.features[t].bbox:D?o.bbox:void 0,S=P?o.features[t].id:D?o.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,l=0;l<f;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,I,b,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,I,b,k,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],I,b,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function Ub(o,e,t){var n=t;return zp(o,function(l,u,f,a,_){u===0&&t===void 0?n=l:n=e(n,l,u,f,a,_)}),n}function ic(o,e){zp(o,function(t,n,l,u,f){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Io(t,l,{bbox:u,id:f}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var b=0;b<t.coordinates.length;b++){var k=t.coordinates[b],S={type:_,coordinates:k};if(e(Io(S,l),n,b)===!1)return!1}})}function Vb(o,e,t){var n=t;return ic(o,function(l,u,f){u===0&&f===0&&t===void 0?n=l:n=e(n,l,u,f)}),n}function s0(o,e){ic(o,function(t,n,l){var u=0;if(t.geometry){var f=t.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var a,_=0,b=0,k=0;if(ju(t,function(S,I,P,D,B){if(a===void 0||n>_||D>b||B>k){a=S,_=n,b=D,k=B,u=0;return}var z=Eo([a,S],t.properties);if(e(z,n,l,B,u)===!1)return!1;u++,a=S})===!1)return!1}}})}function qb(o,e,t){var n=t,l=!1;return s0(o,function(u,f,a,_,b){l===!1&&t===void 0?n=u:n=e(n,u,f,a,_,b),l=!0}),n}function a0(o,e){if(!o)throw new Error("geojson is required");ic(o,function(t,n,l){if(t.geometry!==null){var u=t.geometry.type,f=t.geometry.coordinates;switch(u){case"LineString":if(e(t,n,l,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<f.length;a++)if(e(Eo(f[a],t.properties),n,l,a)===!1)return!1;break}}})}function Zb(o,e,t){var n=t;return a0(o,function(l,u,f,a){u===0&&t===void 0?n=l:n=e(n,l,u,f,a)}),n}function Gb(o,e){if(e=e||{},!Pp(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.segmentIndex||0,f=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),f=f||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":f=f||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Eo([_[u],_[u+1]],f,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u-1),Eo([_[l][u],_[l][u+1]],f,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u-1),Eo([_[n][u],_[n][u+1]],f,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u-1),Eo([_[n][l][u],_[n][l][u+1]],f,e)}throw new Error("geojson is invalid")}function Wb(o,e){if(e=e||{},!Pp(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.coordIndex||0,f=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),f=f||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":f=f||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return Yr(_,f,e);case"MultiPoint":return n<0&&(n=_.length+n),Yr(_[n],f,e);case"LineString":return u<0&&(u=_.length+u),Yr(_[u],f,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u),Yr(_[l][u],f,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u),Yr(_[n][u],f,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u),Yr(_[n][l][u],f,e)}throw new Error("geojson is invalid")}const $b=Object.freeze(Object.defineProperty({__proto__:null,coordAll:jb,coordEach:ju,coordReduce:Fb,featureEach:yd,featureReduce:Nb,findPoint:Wb,findSegment:Gb,flattenEach:ic,flattenReduce:Vb,geomEach:zp,geomReduce:Ub,lineEach:a0,lineReduce:Zb,propEach:o0,propReduce:Ob,segmentEach:s0,segmentReduce:qb},Symbol.toStringTag,{value:"Module"}));function l0(o,e,t){if(t===void 0&&(t={}),t.final===!0)return Hb(o,e);var n=Cu(o),l=Cu(e),u=Co(n[0]),f=Co(l[0]),a=Co(n[1]),_=Co(l[1]),b=Math.sin(f-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(f-u);return Eu(Math.atan2(b,k))}function Hb(o,e){var t=l0(e,o);return t=(t+180)%360,t}function Eg(o,e,t,n){n===void 0&&(n={});var l=Cu(o),u=Co(l[0]),f=Co(l[1]),a=Co(t),_=Ld(e,n.units),b=Math.asin(Math.sin(f)*Math.cos(_)+Math.cos(f)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(f),Math.cos(_)-Math.sin(f)*Math.sin(b)),S=Eu(k),I=Eu(b);return Yr([S,I],n.properties)}function Cg(o){if(!o)throw new Error("geojson is required");var e=[];return ic(o,function(t){Xb(t,e)}),Ba(e)}function Xb(o,e){var t=[],n=o.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ql(n);break;case"LineString":t=[Ql(n)]}t.forEach(function(l){var u=Kb(l,o.properties);u.forEach(function(f){f.id=e.length,e.push(f)})})}}function Kb(o,e){var t=[];return o.reduce(function(n,l){var u=Eo([n,l],e);return u.bbox=Jb(n,l),t.push(u),l}),t}function Jb(o,e){var t=o[0],n=o[1],l=e[0],u=e[1],f=t<l?t:l,a=n<u?n:u,_=t>l?t:l,b=n>u?n:u;return[f,a,_,b]}var Dp={exports:{}},c0={exports:{}};(function(o,e){(function(t,n){o.exports=n()})(Ky,function(){function t(O,U,q,se,re){(function H(ee,ve,Oe,ne,ye){for(;ne>Oe;){if(ne-Oe>600){var Ke=ne-Oe+1,Ce=ve-Oe+1,et=Math.log(Ke),bt=.5*Math.exp(2*et/3),pt=.5*Math.sqrt(et*bt*(Ke-bt)/Ke)*(Ce-Ke/2<0?-1:1),st=Math.max(Oe,Math.floor(ve-Ce*bt/Ke+pt)),Ht=Math.min(ne,Math.floor(ve+(Ke-Ce)*bt/Ke+pt));H(ee,ve,st,Ht,ye)}var ii=ee[ve],Ot=Oe,zt=ne;for(n(ee,Oe,ve),ye(ee[ne],ii)>0&&n(ee,Oe,ne);Ot<zt;){for(n(ee,Ot,zt),Ot++,zt--;ye(ee[Ot],ii)<0;)Ot++;for(;ye(ee[zt],ii)>0;)zt--}ye(ee[Oe],ii)===0?n(ee,Oe,zt):n(ee,++zt,ne),zt<=ve&&(Oe=zt+1),ve<=zt&&(ne=zt-1)}})(O,U,q||0,se||O.length-1,re||l)}function n(O,U,q){var se=O[U];O[U]=O[q],O[q]=se}function l(O,U){return O<U?-1:O>U?1:0}var u=function(O){O===void 0&&(O=9),this._maxEntries=Math.max(4,O),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function f(O,U,q){if(!q)return U.indexOf(O);for(var se=0;se<U.length;se++)if(q(O,U[se]))return se;return-1}function a(O,U){_(O,0,O.children.length,U,O)}function _(O,U,q,se,re){re||(re=z(null)),re.minX=1/0,re.minY=1/0,re.maxX=-1/0,re.maxY=-1/0;for(var H=U;H<q;H++){var ee=O.children[H];b(re,O.leaf?se(ee):ee)}return re}function b(O,U){return O.minX=Math.min(O.minX,U.minX),O.minY=Math.min(O.minY,U.minY),O.maxX=Math.max(O.maxX,U.maxX),O.maxY=Math.max(O.maxY,U.maxY),O}function k(O,U){return O.minX-U.minX}function S(O,U){return O.minY-U.minY}function I(O){return(O.maxX-O.minX)*(O.maxY-O.minY)}function P(O){return O.maxX-O.minX+(O.maxY-O.minY)}function D(O,U){return O.minX<=U.minX&&O.minY<=U.minY&&U.maxX<=O.maxX&&U.maxY<=O.maxY}function B(O,U){return U.minX<=O.maxX&&U.minY<=O.maxY&&U.maxX>=O.minX&&U.maxY>=O.minY}function z(O){return{children:O,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function R(O,U,q,se,re){for(var H=[U,q];H.length;)if(!((q=H.pop())-(U=H.pop())<=se)){var ee=U+Math.ceil((q-U)/se/2)*se;t(O,ee,U,q,re),H.push(U,ee,ee,q)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(O){var U=this.data,q=[];if(!B(O,U))return q;for(var se=this.toBBox,re=[];U;){for(var H=0;H<U.children.length;H++){var ee=U.children[H],ve=U.leaf?se(ee):ee;B(O,ve)&&(U.leaf?q.push(ee):D(O,ve)?this._all(ee,q):re.push(ee))}U=re.pop()}return q},u.prototype.collides=function(O){var U=this.data;if(!B(O,U))return!1;for(var q=[];U;){for(var se=0;se<U.children.length;se++){var re=U.children[se],H=U.leaf?this.toBBox(re):re;if(B(O,H)){if(U.leaf||D(O,H))return!0;q.push(re)}}U=q.pop()}return!1},u.prototype.load=function(O){if(!O||!O.length)return this;if(O.length<this._minEntries){for(var U=0;U<O.length;U++)this.insert(O[U]);return this}var q=this._build(O.slice(),0,O.length-1,0);if(this.data.children.length)if(this.data.height===q.height)this._splitRoot(this.data,q);else{if(this.data.height<q.height){var se=this.data;this.data=q,q=se}this._insert(q,this.data.height-q.height-1,!0)}else this.data=q;return this},u.prototype.insert=function(O){return O&&this._insert(O,this.data.height-1),this},u.prototype.clear=function(){return this.data=z([]),this},u.prototype.remove=function(O,U){if(!O)return this;for(var q,se,re,H=this.data,ee=this.toBBox(O),ve=[],Oe=[];H||ve.length;){if(H||(H=ve.pop(),se=ve[ve.length-1],q=Oe.pop(),re=!0),H.leaf){var ne=f(O,H.children,U);if(ne!==-1)return H.children.splice(ne,1),ve.push(H),this._condense(ve),this}re||H.leaf||!D(H,ee)?se?(q++,H=se.children[q],re=!1):H=null:(ve.push(H),Oe.push(q),q=0,se=H,H=H.children[0])}return this},u.prototype.toBBox=function(O){return O},u.prototype.compareMinX=function(O,U){return O.minX-U.minX},u.prototype.compareMinY=function(O,U){return O.minY-U.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(O){return this.data=O,this},u.prototype._all=function(O,U){for(var q=[];O;)O.leaf?U.push.apply(U,O.children):q.push.apply(q,O.children),O=q.pop();return U},u.prototype._build=function(O,U,q,se){var re,H=q-U+1,ee=this._maxEntries;if(H<=ee)return a(re=z(O.slice(U,q+1)),this.toBBox),re;se||(se=Math.ceil(Math.log(H)/Math.log(ee)),ee=Math.ceil(H/Math.pow(ee,se-1))),(re=z([])).leaf=!1,re.height=se;var ve=Math.ceil(H/ee),Oe=ve*Math.ceil(Math.sqrt(ee));R(O,U,q,Oe,this.compareMinX);for(var ne=U;ne<=q;ne+=Oe){var ye=Math.min(ne+Oe-1,q);R(O,ne,ye,ve,this.compareMinY);for(var Ke=ne;Ke<=ye;Ke+=ve){var Ce=Math.min(Ke+ve-1,ye);re.children.push(this._build(O,Ke,Ce,se-1))}}return a(re,this.toBBox),re},u.prototype._chooseSubtree=function(O,U,q,se){for(;se.push(U),!U.leaf&&se.length-1!==q;){for(var re=1/0,H=1/0,ee=void 0,ve=0;ve<U.children.length;ve++){var Oe=U.children[ve],ne=I(Oe),ye=(Ke=O,Ce=Oe,(Math.max(Ce.maxX,Ke.maxX)-Math.min(Ce.minX,Ke.minX))*(Math.max(Ce.maxY,Ke.maxY)-Math.min(Ce.minY,Ke.minY))-ne);ye<H?(H=ye,re=ne<re?ne:re,ee=Oe):ye===H&&ne<re&&(re=ne,ee=Oe)}U=ee||U.children[0]}var Ke,Ce;return U},u.prototype._insert=function(O,U,q){var se=q?O:this.toBBox(O),re=[],H=this._chooseSubtree(se,this.data,U,re);for(H.children.push(O),b(H,se);U>=0&&re[U].children.length>this._maxEntries;)this._split(re,U),U--;this._adjustParentBBoxes(se,re,U)},u.prototype._split=function(O,U){var q=O[U],se=q.children.length,re=this._minEntries;this._chooseSplitAxis(q,re,se);var H=this._chooseSplitIndex(q,re,se),ee=z(q.children.splice(H,q.children.length-H));ee.height=q.height,ee.leaf=q.leaf,a(q,this.toBBox),a(ee,this.toBBox),U?O[U-1].children.push(ee):this._splitRoot(q,ee)},u.prototype._splitRoot=function(O,U){this.data=z([O,U]),this.data.height=O.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(O,U,q){for(var se,re,H,ee,ve,Oe,ne,ye=1/0,Ke=1/0,Ce=U;Ce<=q-U;Ce++){var et=_(O,0,Ce,this.toBBox),bt=_(O,Ce,q,this.toBBox),pt=(re=et,H=bt,ee=void 0,ve=void 0,Oe=void 0,ne=void 0,ee=Math.max(re.minX,H.minX),ve=Math.max(re.minY,H.minY),Oe=Math.min(re.maxX,H.maxX),ne=Math.min(re.maxY,H.maxY),Math.max(0,Oe-ee)*Math.max(0,ne-ve)),st=I(et)+I(bt);pt<ye?(ye=pt,se=Ce,Ke=st<Ke?st:Ke):pt===ye&&st<Ke&&(Ke=st,se=Ce)}return se||q-U},u.prototype._chooseSplitAxis=function(O,U,q){var se=O.leaf?this.compareMinX:k,re=O.leaf?this.compareMinY:S;this._allDistMargin(O,U,q,se)<this._allDistMargin(O,U,q,re)&&O.children.sort(se)},u.prototype._allDistMargin=function(O,U,q,se){O.children.sort(se);for(var re=this.toBBox,H=_(O,0,U,re),ee=_(O,q-U,q,re),ve=P(H)+P(ee),Oe=U;Oe<q-U;Oe++){var ne=O.children[Oe];b(H,O.leaf?re(ne):ne),ve+=P(H)}for(var ye=q-U-1;ye>=U;ye--){var Ke=O.children[ye];b(ee,O.leaf?re(Ke):Ke),ve+=P(ee)}return ve},u.prototype._adjustParentBBoxes=function(O,U,q){for(var se=q;se>=0;se--)b(U[se],O)},u.prototype._condense=function(O){for(var U=O.length-1,q=void 0;U>=0;U--)O[U].children.length===0?U>0?(q=O[U-1].children).splice(q.indexOf(O[U]),1):this.clear():a(O[U],this.toBBox)},u})})(c0);var Yb=c0.exports;const Qb=Mp(Bb),ew=Mp($b);function u0(o,e,t){if(o!==null)for(var n,l,u,f,a,_,b,k=0,S=0,I,P=o.type,D=P==="FeatureCollection",B=P==="Feature",z=D?o.features.length:1,R=0;R<z;R++){b=D?o.features[R].geometry:B?o.geometry:o,I=b?b.type==="GeometryCollection":!1,a=I?b.geometries.length:1;for(var O=0;O<a;O++){var U=0,q=0;if(f=I?b.geometries[O]:b,f!==null){_=f.coordinates;var se=f.type;switch(k=t&&(se==="Polygon"||se==="MultiPolygon")?1:0,se){case null:break;case"Point":if(e(_,S,R,U,q)===!1)return!1;S++,U++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,R,U,q)===!1)return!1;S++,se==="MultiPoint"&&U++}se==="LineString"&&U++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,R,U,q)===!1)return!1;S++}se==="MultiLineString"&&U++,se==="Polygon"&&q++}se==="Polygon"&&U++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(q=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,R,U,q)===!1)return!1;S++}q++}U++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(u0(f.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function h0(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return u0(o,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var tw=h0;const iw=Object.freeze(Object.defineProperty({__proto__:null,bbox:h0,default:tw},Symbol.toStringTag,{value:"Module"})),nw=Mp(iw);var Qo=Yb,d0=Qb,f0=ew,Fl=nw.default,rw=f0.featureEach;f0.coordEach;d0.polygon;var Mg=d0.featureCollection;function p0(o){var e=new Qo(o);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Fl(t),Qo.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Fl(l),n.push(l)}):rw(t,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Fl(l),n.push(l)}),Qo.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Fl(t),Qo.prototype.remove.call(this,t,n)},e.clear=function(){return Qo.prototype.clear.call(this)},e.search=function(t){var n=Qo.prototype.search.call(this,this.toBBox(t));return Mg(n)},e.collides=function(t){return Qo.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Qo.prototype.all.call(this);return Mg(t)},e.toJSON=function(){return Qo.prototype.toJSON.call(this)},e.fromJSON=function(t){return Qo.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Fl(t);else if(t.type==="FeatureCollection")n=Fl(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Dp.exports=p0;Dp.exports.default=p0;var ow=Dp.exports;const sw=Jy(ow);function aw(o,e){var t={},n=[];if(o.type==="LineString"&&(o=Io(o)),e.type==="LineString"&&(e=Io(e)),o.type==="Feature"&&e.type==="Feature"&&o.geometry!==null&&e.geometry!==null&&o.geometry.type==="LineString"&&e.geometry.type==="LineString"&&o.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Ig(o,e);return l&&n.push(l),Ba(n)}var u=sw();return u.load(Cg(e)),yd(Cg(o),function(f){yd(u.search(f),function(a){var _=Ig(f,a);if(_){var b=Ql(_).join(",");t[b]||(t[b]=!0,n.push(_))}})}),Ba(n)}function Ig(o,e){var t=Ql(o),n=Ql(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=t[0][0],u=t[0][1],f=t[1][0],a=t[1][1],_=n[0][0],b=n[0][1],k=n[1][0],S=n[1][1],I=(S-b)*(f-l)-(k-_)*(a-u),P=(k-_)*(u-b)-(S-b)*(l-_),D=(f-l)*(u-b)-(a-u)*(l-_);if(I===0)return null;var B=P/I,z=D/I;if(B>=0&&B<=1&&z>=0&&z<=1){var R=l+B*(f-l),O=u+B*(a-u);return Yr([R,O])}return null}function lw(o,e,t){t===void 0&&(t={});var n=Yr([1/0,1/0],{dist:1/0}),l=0;return ic(o,function(u){for(var f=Ql(u),a=0;a<f.length-1;a++){var _=Yr(f[a]);_.properties.dist=ou(e,_,t);var b=Yr(f[a+1]);b.properties.dist=ou(e,b,t);var k=ou(_,b,t),S=Math.max(_.properties.dist,b.properties.dist),I=l0(_,b),P=Eg(e,S,I+90,t),D=Eg(e,S,I-90,t),B=aw(Eo([P.geometry.coordinates,D.geometry.coordinates]),Eo([_.geometry.coordinates,b.geometry.coordinates])),z=null;B.features.length>0&&(z=B.features[0],z.properties.dist=ou(e,z,t),z.properties.location=l+ou(_,z,t)),_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a,n.properties.location=l),b.properties.dist<n.properties.dist&&(n=b,n.properties.index=a+1,n.properties.location=l+k),z&&z.properties.dist<n.properties.dist&&(n=z,n.properties.index=a),l+=k}}),n}const cw=30;class uw{constructor(e,t,n,l,u){this.onMouseMove=f=>{if(!this.active)return;const a=[f.point.x-cw,f.point.y],_=this.map.unproject(f.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(f.lngLat.lng,f.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=f=>{this.active&&(f.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=f=>{if(!this.active)return;let a=f.target.tagName;a=="INPUT"||a=="TEXTAREA"||f.key=="Escape"&&(f.stopPropagation(),this.cancel())},this.onKeyPress=f=>{if(!this.active)return;let a=f.target.tagName;a=="INPUT"||a=="TEXTAREA"||(f.key=="Enter"?(f.stopPropagation(),this.finish()):f.key=="s"||f.key=="S"?(f.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):f.key=="z"&&f.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new gd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Ol=[];function $f(o,e){return{subscribe:wi(o,e).subscribe}}function wi(o,e=Pt){let t;const n=new Set;function l(a){if(Ft(o,a)&&(o=a,t)){const _=!Ol.length;for(const b of n)b[1](),Ol.push(b,o);if(_){for(let b=0;b<Ol.length;b+=2)Ol[b][0](Ol[b+1]);Ol.length=0}}}function u(a){l(a(o))}function f(a,_=Pt){const b=[a,_];return n.add(b),n.size===1&&(t=e(l,u)||Pt),a(o),()=>{n.delete(b),n.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:f}}const sp="MZEJTanw3WpxRvt7qDfo";let es=wi(null),Mu=wi(!1),Es=wi(""),vd=wi(!0),$n=wi(null),Iu=wi(new Ts.LngLat(0,0)),Lu=wi(new Ts.LngLat(0,0)),sd=wi(new Ts.LngLat(0,0)),Lg=wi(1),vs=wi(1),ri=wi({mode:"title",firstLoad:!0}),ap=wi("streets-v2"),lp=wi("walk_cycle_only"),Ag=wi(!1),Au=wi(!1),bd=wi("shortcuts"),cp=wi(!1);function ec(){let o=Ir(Es);o||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(o,JSON.stringify(Ir($n).toSavefile()))}function Pg(o){let e,t;return e=new Md({props:{$$slots:{default:[hw,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:o}}}),e.$on("close",o[2]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&24&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function hw(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D;function B(){return o[1](o[3])}return{c(){e=ce("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=Re(),n=ce("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=Re(),u=ce("p"),u.textContent="To use this tool, you need to:",f=Re(),a=ce("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Re(),b=ce("p"),b.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,k=Re(),S=ce("center"),I=ce("button"),I.textContent="Start!"},m(z,R){he(z,e,R),he(z,t,R),he(z,n,R),he(z,l,R),he(z,u,R),he(z,f,R),he(z,a,R),he(z,_,R),he(z,b,R),he(z,k,R),he(z,S,R),Y(S,I),P||(D=Et(I,"click",B),P=!0)},p(z,R){o=z},d(z){z&&(ue(e),ue(t),ue(n),ue(l),ue(u),ue(f),ue(a),ue(_),ue(b),ue(k),ue(S)),P=!1,D()}}}function dw(o){let e,t,n=o[0]&&Pg(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=Pg(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function fw(o,e,t){let n;return dt(o,vd,f=>t(0,n=f)),[n,f=>gr(f).close(),()=>At(vd,n=!1,n)]}class pw extends Zt{constructor(e){super(),qt(this,e,fw,dw,Ft,{})}}let lt;const ws=new Array(128).fill(void 0);ws.push(void 0,null,!0,!1);function fi(o){return ws[o]}let qr=0,mu=null;function $l(){return(mu===null||mu.byteLength===0)&&(mu=new Uint8Array(lt.memory.buffer)),mu}const ad=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},mw=typeof ad.encodeInto=="function"?function(o,e){return ad.encodeInto(o,e)}:function(o,e){const t=ad.encode(o);return e.set(t),{read:o.length,written:t.length}};function Fo(o,e,t){if(t===void 0){const a=ad.encode(o),_=e(a.length,1)>>>0;return $l().subarray(_,_+a.length).set(a),qr=a.length,_}let n=o.length,l=e(n,1)>>>0;const u=$l();let f=0;for(;f<n;f++){const a=o.charCodeAt(f);if(a>127)break;u[l+f]=a}if(f!==n){f!==0&&(o=o.slice(f)),l=t(l,n,n=f+o.length*3,1)>>>0;const a=$l().subarray(l+f,l+n),_=mw(o,a);f+=_.written}return qr=f,l}function Zl(o){return o==null}let gu=null;function Gt(){return(gu===null||gu.byteLength===0)&&(gu=new Int32Array(lt.memory.buffer)),gu}let xu=ws.length;function gw(o){o<132||(ws[o]=xu,xu=o)}function mr(o){const e=fi(o);return gw(o),e}const m0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&m0.decode();function Vr(o,e){return o=o>>>0,m0.decode($l().subarray(o,o+e))}function Gi(o){xu===ws.length&&ws.push(ws.length+1);const e=xu;return xu=ws[e],ws[e]=o,e}let _u=null;function g0(){return(_u===null||_u.byteLength===0)&&(_u=new Float64Array(lt.memory.buffer)),_u}let yu=null;function _w(){return(yu===null||yu.byteLength===0)&&(yu=new BigInt64Array(lt.memory.buffer)),yu}function up(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=up(o[0]));for(let f=1;f<l;f++)u+=", "+up(o[f]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function yw(o,e){const t=e(o.length*1,1)>>>0;return $l().set(o,t/1),qr=o.length,t}function vw(o,e){return o=o>>>0,g0().subarray(o/8,o/8+e)}function bw(o,e){return o=o>>>0,$l().subarray(o/1,o/1+e)}function za(o,e){try{return o.apply(this,e)}catch(t){lt.__wbindgen_exn_store(Gi(t))}}class ww{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();lt.__wbg_ltn_free(e)}constructor(e,t,n){try{const b=lt.__wbindgen_add_to_stack_pointer(-16),k=yw(e,lt.__wbindgen_malloc),S=qr;var l=Zl(n)?0:Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;lt.ltn_new(b,k,S,Gi(t),l,u);var f=Gt()[b/4+0],a=Gt()[b/4+1],_=Gt()[b/4+2];if(_)throw mr(a);return this.__wbg_ptr=f>>>0,this}finally{lt.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const b=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getInvertedBoundary(b,this.__wbg_ptr);var n=Gt()[b/4+0],l=Gt()[b/4+1],u=Gt()[b/4+2],f=Gt()[b/4+3],a=n,_=l;if(f)throw a=0,_=0,mr(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}getBounds(){try{const l=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getBounds(l,this.__wbg_ptr);var e=Gt()[l/4+0],t=Gt()[l/4+1],n=vw(e,t).slice();return lt.__wbindgen_free(e,t*8,8),n}finally{lt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=Gt()[l/4+0],t=Gt()[l/4+1],n=bw(e,t).slice();return lt.__wbindgen_free(e,t*1,1),n}finally{lt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const b=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toRouteSnapperGj(b,this.__wbg_ptr);var n=Gt()[b/4+0],l=Gt()[b/4+1],u=Gt()[b/4+2],f=Gt()[b/4+3],a=n,_=l;if(f)throw a=0,_=0,mr(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const b=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderModalFilters(b,this.__wbg_ptr);var n=Gt()[b/4+0],l=Gt()[b/4+1],u=Gt()[b/4+2],f=Gt()[b/4+3],a=n,_=l;if(f)throw a=0,_=0,mr(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const b=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderNeighbourhood(b,this.__wbg_ptr);var n=Gt()[b/4+0],l=Gt()[b/4+1],u=Gt()[b/4+2],f=Gt()[b/4+3],a=n,_=l;if(f)throw a=0,_=0,mr(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const b=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderAutoBoundaries(b,this.__wbg_ptr);var n=Gt()[b/4+0],l=Gt()[b/4+1],u=Gt()[b/4+2],f=Gt()[b/4+3],a=n,_=l;if(f)throw a=0,_=0,mr(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,f,a,Gi(t));var n=Gt()[u/4+0],l=Gt()[u/4+1];if(l)throw mr(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),n=qr;lt.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),l=qr,u=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),f=qr;lt.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,l,u,f)}setCurrentNeighbourhood(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,f,a,t);var n=Gt()[u/4+0],l=Gt()[u/4+1];if(l)throw mr(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_addModalFilter(u,this.__wbg_ptr,Gi(e),f,a);var n=Gt()[u/4+0],l=Gt()[u/4+1];if(l)throw mr(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_addManyModalFilters(u,this.__wbg_ptr,Gi(e),f,a);var n=Gt()[u/4+0],l=Gt()[u/4+1];if(l)throw mr(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){lt.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){lt.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){lt.ltn_undo(this.__wbg_ptr)}redo(){lt.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const k=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getShortcutsCrossingRoad(k,this.__wbg_ptr,e);var l=Gt()[k/4+0],u=Gt()[k/4+1],f=Gt()[k/4+2],a=Gt()[k/4+3],_=l,b=u;if(a)throw _=0,b=0,mr(f);return t=_,n=b,Vr(_,b)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const b=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getAllShortcuts(b,this.__wbg_ptr);var n=Gt()[b/4+0],l=Gt()[b/4+1],u=Gt()[b/4+2],f=Gt()[b/4+3],a=n,_=l;if(f)throw a=0,_=0,mr(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const b=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toSavefile(b,this.__wbg_ptr);var n=Gt()[b/4+0],l=Gt()[b/4+1],u=Gt()[b/4+2],f=Gt()[b/4+3],a=n,_=l;if(f)throw a=0,_=0,mr(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_loadSavefile(l,this.__wbg_ptr,Gi(e));var t=Gt()[l/4+0],n=Gt()[l/4+1];if(n)throw mr(t)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,l,u){let f,a;try{const D=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_compareRoute(D,this.__wbg_ptr,e,t,n,l,u);var _=Gt()[D/4+0],b=Gt()[D/4+1],k=Gt()[D/4+2],S=Gt()[D/4+3],I=_,P=b;if(S)throw I=0,P=0,mr(k);return f=I,a=P,Vr(I,P)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(f,a,1)}}impactToOneDestination(e,t){let n,l;try{const S=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_impactToOneDestination(S,this.__wbg_ptr,e,t);var u=Gt()[S/4+0],f=Gt()[S/4+1],a=Gt()[S/4+2],_=Gt()[S/4+3],b=u,k=f;if(_)throw b=0,k=0,mr(a);return n=b,l=k,Vr(b,k)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(n,l,1)}}}async function xw(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function kw(){const o={};return o.wbg={},o.wbg.__wbindgen_string_get=function(e,t){const n=fi(t),l=typeof n=="string"?n:void 0;var u=Zl(l)?0:Fo(l,lt.__wbindgen_malloc,lt.__wbindgen_realloc),f=qr;Gt()[e/4+1]=f,Gt()[e/4+0]=u},o.wbg.__wbindgen_object_drop_ref=function(e){mr(e)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Vr(e,t));return Gi(n)},o.wbg.__wbindgen_string_new=function(e,t){const n=Vr(e,t);return Gi(n)},o.wbg.__wbindgen_boolean_get=function(e){const t=fi(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_is_bigint=function(e){return typeof fi(e)=="bigint"},o.wbg.__wbindgen_number_get=function(e,t){const n=fi(t),l=typeof n=="number"?n:void 0;g0()[e/8+1]=Zl(l)?0:l,Gt()[e/4+0]=!Zl(l)},o.wbg.__wbindgen_is_object=function(e){const t=fi(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_in=function(e,t){return fi(e)in fi(t)},o.wbg.__wbindgen_bigint_from_i64=function(e){return Gi(e)},o.wbg.__wbindgen_jsval_eq=function(e,t){return fi(e)===fi(t)},o.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Gi(t)},o.wbg.__wbindgen_is_undefined=function(e){return fi(e)===void 0},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return fi(e)==fi(t)},o.wbg.__wbindgen_object_clone_ref=function(e){const t=fi(e);return Gi(t)},o.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=fi(e)[fi(t)];return Gi(n)},o.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(fi(e))},o.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(fi(e))},o.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(fi(e))},o.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(fi(e))},o.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(fi(e))},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Gi(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=fi(t).stack,l=Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;Gt()[e/4+1]=u,Gt()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(Vr(e,t))}finally{lt.__wbindgen_free(n,l,1)}},o.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=fi(e).performance;return Gi(t)},o.wbg.__wbg_now_2fd65358804c9485=function(e){return fi(e).now()},o.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=fi(e)[t>>>0];return Gi(n)},o.wbg.__wbg_length_1009b1af0c481d7b=function(e){return fi(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof fi(e)=="function"},o.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Vr(e,t));return Gi(n)},o.wbg.__wbg_next_9b877f231f476d01=function(e){const t=fi(e).next;return Gi(t)},o.wbg.__wbg_next_6529ee0cca8d57ed=function(){return za(function(e){const t=fi(e).next();return Gi(t)},arguments)},o.wbg.__wbg_done_5fe336b092d60cf2=function(e){return fi(e).done},o.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=fi(e).value;return Gi(t)},o.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Gi(Symbol.iterator)},o.wbg.__wbg_get_7b48513de5dc5ea4=function(){return za(function(e,t){const n=Reflect.get(fi(e),fi(t));return Gi(n)},arguments)},o.wbg.__wbg_call_90c26b09837aba1c=function(){return za(function(e,t){const n=fi(e).call(fi(t));return Gi(n)},arguments)},o.wbg.__wbg_self_f0e34d89f33b99fd=function(){return za(function(){const e=self.self;return Gi(e)},arguments)},o.wbg.__wbg_window_d3b084224f4774d7=function(){return za(function(){const e=window.window;return Gi(e)},arguments)},o.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return za(function(){const e=globalThis.globalThis;return Gi(e)},arguments)},o.wbg.__wbg_global_35dfdd59a4da3e74=function(){return za(function(){const e=global.global;return Gi(e)},arguments)},o.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(fi(e))},o.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=fi(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(fi(e))},o.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(fi(e));return Gi(t)},o.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=fi(e).buffer;return Gi(t)},o.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(fi(e));return Gi(t)},o.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){fi(e).set(fi(t),n>>>0)},o.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return fi(e).length},o.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=fi(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=fi(t),l=typeof n=="bigint"?n:void 0;_w()[e/8+1]=Zl(l)?BigInt(0):l,Gt()[e/4+0]=!Zl(l)},o.wbg.__wbindgen_debug_string=function(e,t){const n=up(fi(t)),l=Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;Gt()[e/4+1]=u,Gt()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(Vr(e,t))},o.wbg.__wbindgen_memory=function(){const e=lt.memory;return Gi(e)},o}function Sw(o,e){return lt=o.exports,_0.__wbindgen_wasm_module=e,yu=null,_u=null,gu=null,mu=null,lt}async function _0(o){if(lt!==void 0)return lt;typeof o>"u"&&(o="/ltn/assets/backend_bg.wasm");const e=kw();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await xw(await o,e);return Sw(t,n)}let Tw=Date.now();function nc(o){return`${o}-${Tw++}`}const Rp=Symbol.for("svelte-maplibre");function rc(){return Cd(Rp)}function Ew(o){let e=new WeakMap;return t=>{var f;let n=e.get(t.originalEvent);if(n!==void 0)return n;let u=(f=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=o.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:f.layer.id;return e.set(t.originalEvent,u),u}}function Cw(){let o=new Map;return Ed(Rp,{map:wi(null),source:$f(null),layer:$f(null),popupTarget:$f(null),cluster:wi(),loadedImages:wi(new Set),minzoom:wi(0),maxzoom:wi(24),layerEvent:wi(null),layerInfo:o,eventTopMost:Ew(o),markerClickManager:new Aw})}function zg(o){return{subscribe:o.subscribe}}function Bp({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=rc(),u=wi(null),f=zg(u),a={...l,[o]:zg(u)};if(e&&(a.popupTarget=f),n){let _=wi(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=wi()),Ed(Rp,a),{...l,self:u}}function Mw(){return Bp({key:"source",setCluster:!0})}function Iw(o=!0){return Bp({key:"layer",setPopupTarget:o,setMouseEvent:o})}function Lw(){return Bp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Aw{constructor(){Dn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Dg(o){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&o(n,u,l)}else if(e)for(let n in e)o(n,void 0,e[n]);e=t}}function Pw(o,...e){let t=[o];for(let n of e)if(n)Array.isArray(n)&&n[0]===o?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function zw(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function Fa(o,e){return["case",["boolean",["feature-state","hover"],!1],e,o]}var Oa=Dw;function Dw(o){var e,t,n;if(o){if(Array.isArray(o)){for(e=[],t=o.length,n=0;n<t;n++){var l=o[n];l!=null&&e.push(l)}return e}if(typeof o=="object"){e={};var u=Object.keys(o);for(t=u.length,n=0;n<t;n++){var f=u[n],a=o[f];a!=null&&(e[f]=a)}return e}}}function Rg(o){let e=o[0],t,n,l=Bg(o);return{c(){l.c(),t=En()},m(u,f){l.m(u,f),he(u,t,f),n=!0},p(u,f){f[0]&1&&Ft(e,e=u[0])?(gi(),oe(l,1,1,Pt),_i(),l=Bg(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(ie(l),n=!0)},o(u){oe(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function Bg(o){let e;const t=o[36].default,n=Bi(t,o,o[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Oi(n,t,l,l[35],e?Fi(t,l[35],u,null):Ni(l[35]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function Rw(o){let e,t,n=o[0]&&Rg(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&ie(n,1)):(n=Rg(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function Bw(o,e,t){let n,l,u,f,a,_,b,k,S,I,P,D,{$$slots:B={},$$scope:z}=e,{id:R=nc("layer")}=e,{source:O=void 0}=e,{sourceLayer:U=void 0}=e,{beforeId:q=void 0}=e,{beforeLayerType:se=void 0}=e,{type:re}=e,{paint:H=void 0}=e,{layout:ee=void 0}=e,{filter:ve=void 0}=e,{applyToClusters:Oe=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Ce=null}=e,{interactive:et=!0}=e,{hoverCursor:bt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const st=ts(),{map:Ht,source:ii,self:Ot,minzoom:zt,maxzoom:Jt,eventTopMost:Mt,layerInfo:ei}=Iw();dt(o,Ht,Ne=>t(31,S=Ne)),dt(o,ii,Ne=>t(32,I=Ne)),dt(o,Ot,Ne=>t(0,k=Ne)),dt(o,zt,Ne=>t(34,D=Ne)),dt(o,Jt,Ne=>t(33,P=Ne)),Qn(()=>{k&&S&&(ei.delete(k),S==null||S.removeLayer(k))});let Vt;function hi(Ne){var we,di;if(!et||!k||!S||pt&&Mt(Ne)!==k)return;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt={event:Ne,map:S,clusterId:rt,layer:k,source:a,features:je};st(Ne.type,xt)}function xi(Ne){var we,di;if(!et||!k||!S||pt&&Mt(Ne)!==k)return;bt&&(S.getCanvas().style.cursor=bt);let je=Ne.features??[];t(6,Ce=je[0]??null);let rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;st("mouseenter",{event:Ne,map:S,clusterId:rt,layer:k,source:a,features:je})}function yi(Ne){var we,di,Ve;if(!et||!S)return;if(pt&&Mt(Ne)!==k){t(6,Ce=null),Ke&&Vt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:U,id:Vt},{hover:!1}),Vt=void 0);return}S.getCanvas().style.cursor=bt;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt=(Ve=je[0])==null?void 0:Ve.id;xt!==Vt&&(Ke&&(Vt!==void 0&&(S==null||S.setFeatureState({source:a,id:Vt,sourceLayer:U},{hover:!1})),S==null||S.setFeatureState({source:a,id:xt,sourceLayer:U},{hover:!0})),Vt=xt,t(6,Ce=je[0]??null)),st("mousemove",{event:Ne,map:S,clusterId:rt,layer:k,source:a,features:je})}function Ai(Ne){if(!(!et||!k||!S)){if(bt&&(S.getCanvas().style.cursor=""),t(6,Ce=null),Ke&&Vt!==void 0){const je={source:a,id:Vt,sourceLayer:U};S==null||S.setFeatureState(je,{hover:!1}),Vt=void 0}st("mouseleave",{map:S,layer:k,source:a})}}let ct=!0;function It(Ne){S&&(S.off("click",Ne,hi),S.off("dblclick",Ne,hi),S.off("contextmenu",Ne,hi),S.off("mouseenter",Ne,xi),S.off("mousemove",Ne,yi),S.off("mouseleave",Ne,Ai))}return Qn(()=>{S&&k&&It(k)}),o.$$set=Ne=>{"id"in Ne&&t(7,R=Ne.id),"source"in Ne&&t(8,O=Ne.source),"sourceLayer"in Ne&&t(9,U=Ne.sourceLayer),"beforeId"in Ne&&t(10,q=Ne.beforeId),"beforeLayerType"in Ne&&t(11,se=Ne.beforeLayerType),"type"in Ne&&t(12,re=Ne.type),"paint"in Ne&&t(13,H=Ne.paint),"layout"in Ne&&t(14,ee=Ne.layout),"filter"in Ne&&t(15,ve=Ne.filter),"applyToClusters"in Ne&&t(16,Oe=Ne.applyToClusters),"minzoom"in Ne&&t(17,ne=Ne.minzoom),"maxzoom"in Ne&&t(18,ye=Ne.maxzoom),"manageHoverState"in Ne&&t(19,Ke=Ne.manageHoverState),"hovered"in Ne&&t(6,Ce=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,bt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,pt=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,z=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,n=zw(Oe)),o.$$.dirty[0]&1073774592&&t(24,l=Pw("all",n,ve)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ne??D),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,f=ye??P),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=O||I),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&S&&k!==R&&a){k&&(It(k),ei.delete(k));let Ne=q;if(!q&&se){let je=S.getStyle().layers,rt=typeof se=="function"?se:we=>we.type===se,xt=je==null?void 0:je.find(rt);xt&&(Ne=xt.id)}At(Ot,k=R,k),S.addLayer(Oa({id:k,type:re,source:a,"source-layer":U,filter:l,paint:H,layout:ee,minzoom:u,maxzoom:f}),Ne),t(23,ct=!0),S.on("click",k,hi),S.on("dblclick",k,hi),S.on("contextmenu",k,hi),S.on("mouseenter",k,xi),S.on("mousemove",k,yi),S.on("mouseleave",k,Ai)}o.$$.dirty[0]&1048577&&k&&ei.set(k,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=k?Dg((Ne,je)=>{S!=null&&S.style._loaded?S.setPaintProperty(k,Ne,je):S==null||S.once("styledata",()=>S==null?void 0:S.setPaintProperty(k,Ne,je))}):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,b=k?Dg((Ne,je)=>{S!=null&&S.style._loaded?S.setLayoutProperty(k,Ne,je):S==null||S.once("styledata",()=>S==null?void 0:S.setLayoutProperty(k,Ne,je))}):void 0),o.$$.dirty[0]&268443648&&(_==null||_(H)),o.$$.dirty[0]&134234112&&(b==null||b(ee)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,f)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&k&&(ct?t(23,ct=!1):S==null||S.setFilter(k,l))},[k,Ht,ii,Ot,zt,Jt,Ce,R,O,U,q,se,re,H,ee,ve,Oe,ne,ye,Ke,et,bt,pt,ct,l,f,u,b,_,a,n,S,I,P,D,z,B]}let Ad=class extends Zt{constructor(e){super(),qt(this,e,Bw,Rw,Ft,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Fw(o){let e;const t=o[16].default,n=Bi(t,o,o[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Oi(n,t,l,l[24],e?Fi(t,l[24],u,null):Ni(l[24]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function Ow(o){let e,t,n;function l(f){o[17](f)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Fw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Ad({props:u}),Xi.push(()=>Wr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function Nw(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("circle")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:I=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:B=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:R=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:q=!0}=e;function se(ye){O=ye,t(0,O)}function re(ye){ui.call(this,o,ye)}function H(ye){ui.call(this,o,ye)}function ee(ye){ui.call(this,o,ye)}function ve(ye){ui.call(this,o,ye)}function Oe(ye){ui.call(this,o,ye)}function ne(ye){ui.call(this,o,ye)}return o.$$set=ye=>{"id"in ye&&t(1,u=ye.id),"source"in ye&&t(2,f=ye.source),"sourceLayer"in ye&&t(3,a=ye.sourceLayer),"beforeId"in ye&&t(4,_=ye.beforeId),"beforeLayerType"in ye&&t(5,b=ye.beforeLayerType),"paint"in ye&&t(6,k=ye.paint),"layout"in ye&&t(7,S=ye.layout),"filter"in ye&&t(8,I=ye.filter),"applyToClusters"in ye&&t(9,P=ye.applyToClusters),"minzoom"in ye&&t(10,D=ye.minzoom),"maxzoom"in ye&&t(11,B=ye.maxzoom),"hoverCursor"in ye&&t(12,z=ye.hoverCursor),"manageHoverState"in ye&&t(13,R=ye.manageHoverState),"hovered"in ye&&t(0,O=ye.hovered),"eventsIfTopMost"in ye&&t(14,U=ye.eventsIfTopMost),"interactive"in ye&&t(15,q=ye.interactive),"$$scope"in ye&&t(24,l=ye.$$scope)},[O,u,f,a,_,b,k,S,I,P,D,B,z,R,U,q,n,se,re,H,ee,ve,Oe,ne,l]}let Fp=class extends Zt{constructor(e){super(),qt(this,e,Nw,Ow,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function jw(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function Uw(o){let e,t,n;function l(f){o[16](f)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[jw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Ad({props:u}),Xi.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function Vw(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("fill")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:z=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:U=!0}=e;function q(ne){R=ne,t(0,R)}function se(ne){ui.call(this,o,ne)}function re(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function ve(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,b=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,I=ne.filter),"minzoom"in ne&&t(9,P=ne.minzoom),"maxzoom"in ne&&t(10,D=ne.maxzoom),"hoverCursor"in ne&&t(11,B=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,R=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,U=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[R,u,f,a,_,b,k,S,I,P,D,B,z,O,U,n,q,se,re,H,ee,ve,Oe,l]}let Cs=class extends Zt{constructor(e){super(),qt(this,e,Vw,Uw,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function qw(o,e,t){let n;const{map:l}=rc();dt(o,l,_=>t(4,n=_));let{position:u="top-left"}=e,{container:f=void 0}=e,a=null;return Qn(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),o.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,f=_.container)},o.$$.update=()=>{if(o.$$.dirty&30&&n&&!a){let _;typeof f=="string"?_=document.querySelector(f)??void 0:_=f,t(3,a=new Qr.FullscreenControl({container:_})),n.addControl(a,u)}},[l,u,f,a,n]}class Zw extends Zt{constructor(e){super(),qt(this,e,qw,null,Ft,{position:1,container:2})}}function Gw(o,e,t,n,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const f=()=>{n(e)&&(o.addSource(e,t),l())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):f())};a()}else f()}function Ww(o,e,t){$y().then(()=>{let n=Ir(o);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Fg(o){let e=o[0],t,n,l=Og(o);return{c(){l.c(),t=En()},m(u,f){l.m(u,f),he(u,t,f),n=!0},p(u,f){f&1&&Ft(e,e=u[0])?(gi(),oe(l,1,1,Pt),_i(),l=Og(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(ie(l),n=!0)},o(u){oe(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function Og(o){let e;const t=o[19].default,n=Bi(t,o,o[18],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&262144)&&Oi(n,t,l,l[18],e?Fi(t,l[18],u,null):Ni(l[18]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function $w(o){let e,t,n=o[0]&&Fg(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=Fg(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function Hw(o,e,t){let n,l,u,{$$slots:f={},$$scope:a}=e,{id:_=nc("geojson")}=e,{data:b}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:I=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:D=void 0}=e,{maxzoom:B=void 0}=e,{attribution:z=void 0}=e,{buffer:R=void 0}=e,{tolerance:O=void 0}=e;const{map:U,cluster:q,self:se}=Mw();dt(o,U,ee=>t(17,l=ee)),dt(o,q,ee=>t(20,u=ee)),dt(o,se,ee=>t(0,n=ee));let re,H=!0;return Qn(()=>{n&&re&&l&&(Ww(U,n,re),At(se,n=null,n),t(15,re=void 0))}),o.$$set=ee=>{"id"in ee&&t(4,_=ee.id),"data"in ee&&t(5,b=ee.data),"generateId"in ee&&t(6,k=ee.generateId),"promoteId"in ee&&t(7,S=ee.promoteId),"filter"in ee&&t(8,I=ee.filter),"lineMetrics"in ee&&t(9,P=ee.lineMetrics),"cluster"in ee&&t(10,D=ee.cluster),"maxzoom"in ee&&t(11,B=ee.maxzoom),"attribution"in ee&&t(12,z=ee.attribution),"buffer"in ee&&t(13,R=ee.buffer),"tolerance"in ee&&t(14,O=ee.tolerance),"$$scope"in ee&&t(18,a=ee.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&At(q,u=D,u),o.$$.dirty&196593&&l&&n!==_&&(At(se,n=_,n),Gw(l,n,Oa({type:"geojson",data:b,filter:I,lineMetrics:P,generateId:k,promoteId:S,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties,maxzoom:B,attribution:z,buffer:R,tolerance:O}),ee=>l&&ee===n,()=>{n&&(t(15,re=l==null?void 0:l.getSource(n)),t(16,H=!0))})),o.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,re=l==null?void 0:l.getSource(_))})),o.$$.dirty&98336&&re&&(H?t(16,H=!1):re.setData(b)),o.$$.dirty&33792&&(re==null||re.setClusterOptions(Oa({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[n,U,q,se,_,b,k,S,I,P,D,B,z,R,O,re,H,l,a,f]}let Lr=class extends Zt{constructor(e){super(),qt(this,e,Hw,$w,Ft,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function Xw(o,e,t){let n;const{map:l}=rc();dt(o,l,I=>t(8,n=I));let{position:u="top-left"}=e,{positionOptions:f=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:b=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return Qn(()=>{n!=null&&n.loaded()&&S&&n.removeControl(S)}),o.$$set=I=>{"position"in I&&t(2,u=I.position),"positionOptions"in I&&t(3,f=I.positionOptions),"fitBoundsOptions"in I&&t(4,a=I.fitBoundsOptions),"trackUserLocation"in I&&t(5,_=I.trackUserLocation),"showAccuracyCircle"in I&&t(6,b=I.showAccuracyCircle),"showUserLocation"in I&&t(7,k=I.showUserLocation),"control"in I&&t(1,S=I.control)},o.$$.update=()=>{o.$$.dirty&510&&n&&!S&&(t(1,S=new Qr.GeolocateControl({positionOptions:f,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:b,showUserLocation:k})),n.addControl(S,u))},[l,S,u,f,a,_,b,k,n]}class Kw extends Zt{constructor(e){super(),qt(this,e,Xw,null,Ft,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function Jw(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function Yw(o){let e,t,n;function l(f){o[16](f)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[Jw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Ad({props:u}),Xi.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function Qw(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("line")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:z=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:U=!0}=e;function q(ne){R=ne,t(0,R)}function se(ne){ui.call(this,o,ne)}function re(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function ve(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,b=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,I=ne.filter),"minzoom"in ne&&t(9,P=ne.minzoom),"maxzoom"in ne&&t(10,D=ne.maxzoom),"hoverCursor"in ne&&t(11,B=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,R=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,U=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[R,u,f,a,_,b,k,S,I,P,D,B,z,O,U,n,q,se,re,H,ee,ve,Oe,l]}let fo=class extends Zt{constructor(e){super(),qt(this,e,Qw,Yw,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function ex(o,e,t){let n;const l=ts();let{layer:u=void 0}=e;const{map:f}=rc();dt(o,f,k=>t(2,n=k));function a(k){l(k.type,{...k,map:f})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],b=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Qn(()=>{if(n)if(u)for(const k of _)n.off(k,u,a);else for(const k of b)n.off(k,a)}),o.$$set=k=>{"layer"in k&&t(1,u=k.layer)},o.$$.update=()=>{if(o.$$.dirty&6&&n)if(u)for(const k of _)n.on(k,u,a);else for(const k of b)n.on(k,a)},[f,u,n]}class y0 extends Zt{constructor(e){super(),qt(this,e,ex,null,Ft,{layer:1})}}function tx(o){let e=o.getCenter(),t=Math.round(o.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,n),u=Math.round(e.lat*l)/l,f=Math.round(e.lng*l)/l,a=`${t}/${u}/${f}`,_=o.getBearing(),b=o.getPitch();return(_||b)&&(a+=`/${Math.round(_*10)/10}`),b&&(a+=`/${Math.round(b)}`),`#${a}`}function ix(o){return o.replace("#","").split("/").map(parseFloat)}var Nl=Op;function Op(o,e){return o===e||o!==o&&e!==e?!0:typeof o!=typeof e||{}.toString.call(o)!={}.toString.call(e)||o!==Object(o)||!o?!1:Array.isArray(o)?Ng(o,e):{}.toString.call(o)=="[object Set]"?Ng(Array.from(o),Array.from(e)):{}.toString.call(o)=="[object Object]"?rx(o,e):nx(o,e)}function nx(o,e){return o.toString()===e.toString()}function Ng(o,e){var t=o.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Op(o[n],e[n]))return!1;return!0}function rx(o,e){var t=Object.keys(o),n=t.length;if(n!=Object.keys(e).length)return!1;for(var l=0;l<n;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Op(o[u],e[u])))return!1}return!0}function ox(o,e,t){let n;const{map:l}=rc();dt(o,l,k=>t(6,n=k));let{position:u="top-left"}=e,{showCompass:f=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,b=null;return Qn(()=>{n!=null&&n.loaded()&&b&&n.removeControl(b)}),o.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,f=k.showCompass),"showZoom"in k&&t(3,a=k.showZoom),"visualizePitch"in k&&t(4,_=k.visualizePitch)},o.$$.update=()=>{o.$$.dirty&126&&n&&!b&&(t(5,b=new Qr.NavigationControl({showCompass:f,showZoom:a,visualizePitch:_})),n.addControl(b,u))},[l,u,f,a,_,b,n]}class v0 extends Zt{constructor(e){super(),qt(this,e,ox,null,Ft,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function sx(o,e,t){let n;const{map:l}=rc();dt(o,l,b=>t(5,n=b));let{position:u="bottom-left"}=e,{maxWidth:f=void 0}=e,{unit:a="metric"}=e,_=null;return Qn(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),o.$$set=b=>{"position"in b&&t(1,u=b.position),"maxWidth"in b&&t(2,f=b.maxWidth),"unit"in b&&t(3,a=b.unit)},o.$$.update=()=>{o.$$.dirty&62&&n&&!_&&(t(4,_=new Qr.ScaleControl({maxWidth:f,unit:a})),n.addControl(_,u))},[l,u,f,a,_,n]}class b0 extends Zt{constructor(e){super(),qt(this,e,sx,null,Ft,{position:1,maxWidth:2,unit:3})}}const{window:ax}=Sd,lx=o=>({map:o[0]&16,loadedImages:o[0]&32,allImagesLoaded:o[0]&64}),jg=o=>({map:o[4],loadedImages:o[5],allImagesLoaded:o[6]});function Ug(o){let e,t,n=o[3]&&Vg(o);const l=o[46].default,u=Bi(l,o,o[45],jg);return{c(){n&&n.c(),e=Re(),u&&u.c()},m(f,a){n&&n.m(f,a),he(f,e,a),u&&u.m(f,a),t=!0},p(f,a){f[3]?n?(n.p(f,a),a[0]&8&&ie(n,1)):(n=Vg(f),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Oi(u,l,f,f[45],t?Fi(l,f[45],a,lx):Ni(f[45]),jg)},i(f){t||(ie(n),ie(u,f),t=!0)},o(f){oe(n),oe(u,f),t=!1},d(f){f&&ue(e),n&&n.d(f),u&&u.d(f)}}}function Vg(o){let e,t,n,l,u,f,a,_;return e=new v0({props:{position:o[7]}}),n=new Kw({props:{position:o[7],fitBoundsOptions:{maxZoom:12}}}),u=new Zw({props:{position:o[7]}}),a=new b0({props:{position:o[7]}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),Pe(a.$$.fragment)},m(b,k){Le(e,b,k),he(b,t,k),Le(n,b,k),he(b,l,k),Le(u,b,k),he(b,f,k),Le(a,b,k),_=!0},p(b,k){const S={};k[0]&128&&(S.position=b[7]),e.$set(S);const I={};k[0]&128&&(I.position=b[7]),n.$set(I);const P={};k[0]&128&&(P.position=b[7]),u.$set(P);const D={};k[0]&128&&(D.position=b[7]),a.$set(D)},i(b){_||(ie(e.$$.fragment,b),ie(n.$$.fragment,b),ie(u.$$.fragment,b),ie(a.$$.fragment,b),_=!0)},o(b){oe(e.$$.fragment,b),oe(n.$$.fragment,b),oe(u.$$.fragment,b),oe(a.$$.fragment,b),_=!1},d(b){b&&(ue(t),ue(l),ue(f)),Ae(e,b),Ae(n,b),Ae(u,b),Ae(a,b)}}}function cx(o){let e,t,n,l,u,f=o[4]&&o[0]&&Ug(o);return{c(){e=ce("div"),f&&f.c(),Te(e,"class",t=pd(o[2])+" svelte-p00lfq"),Te(e,"data-testid","map-container"),ar(e,"expand-map",!o[2])},m(a,_){he(a,e,_),f&&f.m(e,null),o[47](e),n=!0,l||(u=[Et(ax,"hashchange",o[11]),tp(o[10].call(null,e))],l=!0)},p(a,_){a[4]&&a[0]?f?(f.p(a,_),_[0]&17&&ie(f,1)):(f=Ug(a),f.c(),ie(f,1),f.m(e,null)):f&&(gi(),oe(f,1,1,()=>{f=null}),_i()),(!n||_[0]&4&&t!==(t=pd(a[2])+" svelte-p00lfq"))&&Te(e,"class",t),(!n||_[0]&4)&&ar(e,"expand-map",!a[2])},i(a){n||(ie(f),n=!0)},o(a){oe(f),n=!1},d(a){a&&ue(e),f&&f.d(),o[47](null),l=!1,an(u)}}}function ux(o,e,t){let n,l,u,f,{$$slots:a={},$$scope:_}=e,{map:b=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:I}=e,{diffStyleUpdates:P=!1}=e,{center:D=void 0}=e,{zoom:B=void 0}=e,{pitch:z=0}=e,{bearing:R=0}=e,{bounds:O=void 0}=e,{hash:U=!1}=e,{updateHash:q=Ve=>{window.history.replaceState(window.history.state,"",Ve)}}=e,{loaded:se=!1}=e,{minZoom:re=0}=e,{maxZoom:H=22}=e,{minPitch:ee=0}=e,{maxPitch:ve=60}=e,{renderWorldCopies:Oe=void 0}=e,{dragPan:ne=void 0}=e,{dragRotate:ye=void 0}=e,{pitchWithRotate:Ke=void 0}=e,{antialias:Ce=void 0}=e,{zoomOnDoubleClick:et=!0}=e,{locale:bt=void 0}=e,{interactive:pt=!0}=e,{attributionControl:st=!0}=e,{cooperativeGestures:Ht=!1}=e,{preserveDrawingBuffer:ii=!1}=e,{maxBounds:Ot=void 0}=e,{images:zt=[]}=e,{standardControls:Jt=!1}=e,{filterLayers:Mt=void 0}=e,{transformRequest:ei=void 0}=e;const Vt=ts(),{map:hi,loadedImages:xi}=Cw();dt(o,hi,Ve=>t(4,u=Ve)),dt(o,xi,Ve=>t(5,f=Ve));let yi=new Set;async function Ai(Ve,$e=!1){if(u&&!(!u.loaded()&&!$e))if("url"in Ve){yi.add(Ve.id);try{let kt=await u.loadImage(Ve.url);u==null||u.addImage(Ve.id,kt.data,Ve.options),f.add(Ve.id),xi.set(f)}catch(kt){Vt("error",kt)}finally{yi.delete(Ve.id)}}else u.addImage(Ve.id,Ve.data,Ve.options),f.add(Ve.id),xi.set(f)}let ct,It,Ne,je;function rt(Ve){return we(),At(hi,u=new Qr.Map(Oa({container:Ve,style:I,locale:bt,center:D,zoom:B,pitch:z,bearing:R,minZoom:re,maxZoom:H,minPitch:ee,maxPitch:ve,renderWorldCopies:Oe,dragPan:ne,dragRotate:ye,pitchWithRotate:Ke,antialias:Ce,interactive:pt,preserveDrawingBuffer:ii,maxBounds:Ot,bounds:O,attributionControl:st,transformRequest:ei,cooperativeGestures:Ht})),u),u.on("load",$e=>{$e.target.getContainer().setAttribute("data-testid","map"),$e.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,se=!0),Vt("load",u)}),u.on("error",$e=>Vt("error",{...$e,map:u})),u.on("movestart",$e=>Vt("movestart",{...$e,map:u})),u.on("moveend",$e=>{if(t(12,D=$e.target.getCenter()),t(13,B=$e.target.getZoom()),t(14,z=$e.target.getPitch()),t(15,R=$e.target.getBearing()),t(16,O=$e.target.getBounds()),Vt("moveend",{...$e,map:u}),U){let kt=new URL(window.location.href.replace(/(#.+)?$/,tx(u)));q(kt)}}),u.on("click",$e=>Vt("click",{...$e,map:u})),u.on("dblclick",$e=>Vt("dblclick",{...$e,map:u})),u.on("contextmenu",$e=>Vt("contextmenu",{...$e,map:u})),u.on("zoomstart",$e=>Vt("zoomstart",{...$e,map:u})),u.on("zoom",$e=>{Vt("zoom",{...$e,map:u})}),u.on("zoomend",$e=>{Vt("zoomend",{...$e,map:u})}),u.on("style.load",()=>{if(u){const $e=u.getStyle();if(t(42,ct=$e.layers.map(kt=>kt.id)),t(43,It=Object.keys($e.sources)),je)for(const[kt,vn]of Object.entries(je))u.addSource(kt,vn);if(Ne)for(const kt of Ne)u.addLayer(kt);for(const kt of zt)Ai(kt,!0)}}),u.on("styledata",$e=>{if(u&&Mt){const kt=u.getStyle().layers;if(kt)for(let vn of kt)Mt(vn)||u.setLayoutProperty(vn.id,"visibility","none")}Vt("styledata",{...$e,map:u})}),{destroy(){t(0,se=!1),u==null||u.remove(),At(hi,u=null,u)}}}let xt=I;function we(){if(U){let Ve=ix(window.location.hash);Ve.length>=3&&(t(13,B=Ve[0]),t(12,D=[Ve[2],Ve[1]])),Ve.length==5&&(t(15,R=Ve[3]),t(14,z=Ve[4]))}}function di(Ve){Xi[Ve?"unshift":"push"](()=>{k=Ve,t(1,k)})}return o.$$set=Ve=>{"map"in Ve&&t(17,b=Ve.map),"mapContainer"in Ve&&t(1,k=Ve.mapContainer),"class"in Ve&&t(2,S=Ve.class),"style"in Ve&&t(18,I=Ve.style),"diffStyleUpdates"in Ve&&t(19,P=Ve.diffStyleUpdates),"center"in Ve&&t(12,D=Ve.center),"zoom"in Ve&&t(13,B=Ve.zoom),"pitch"in Ve&&t(14,z=Ve.pitch),"bearing"in Ve&&t(15,R=Ve.bearing),"bounds"in Ve&&t(16,O=Ve.bounds),"hash"in Ve&&t(20,U=Ve.hash),"updateHash"in Ve&&t(21,q=Ve.updateHash),"loaded"in Ve&&t(0,se=Ve.loaded),"minZoom"in Ve&&t(22,re=Ve.minZoom),"maxZoom"in Ve&&t(23,H=Ve.maxZoom),"minPitch"in Ve&&t(24,ee=Ve.minPitch),"maxPitch"in Ve&&t(25,ve=Ve.maxPitch),"renderWorldCopies"in Ve&&t(26,Oe=Ve.renderWorldCopies),"dragPan"in Ve&&t(27,ne=Ve.dragPan),"dragRotate"in Ve&&t(28,ye=Ve.dragRotate),"pitchWithRotate"in Ve&&t(29,Ke=Ve.pitchWithRotate),"antialias"in Ve&&t(30,Ce=Ve.antialias),"zoomOnDoubleClick"in Ve&&t(31,et=Ve.zoomOnDoubleClick),"locale"in Ve&&t(32,bt=Ve.locale),"interactive"in Ve&&t(33,pt=Ve.interactive),"attributionControl"in Ve&&t(34,st=Ve.attributionControl),"cooperativeGestures"in Ve&&t(35,Ht=Ve.cooperativeGestures),"preserveDrawingBuffer"in Ve&&t(36,ii=Ve.preserveDrawingBuffer),"maxBounds"in Ve&&t(37,Ot=Ve.maxBounds),"images"in Ve&&t(38,zt=Ve.images),"standardControls"in Ve&&t(3,Jt=Ve.standardControls),"filterLayers"in Ve&&t(39,Mt=Ve.filterLayers),"transformRequest"in Ve&&t(40,ei=Ve.transformRequest),"$$scope"in Ve&&t(45,_=Ve.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&8&&t(7,n=typeof Jt=="boolean"?void 0:Jt),o.$$.dirty[0]&16&&t(17,b=u),o.$$.dirty[0]&786448|o.$$.dirty[1]&14336&&u&&!Nl(I,xt)){const Ve=u.getStyle();if(ct&&(Ne=Ve.layers.filter($e=>!ct.includes($e.id))),It){const $e=Object.keys(Ve.sources).filter(kt=>!It.includes(kt));je={};for(const kt of $e)je[kt]=Ve.sources[kt]}t(44,xt=I),u.setStyle(I,{diff:P}),At(xi,f=new Set,f),t(41,yi=new Set)}if(o.$$.dirty[0]&49|o.$$.dirty[1]&1152&&se&&u!=null&&u.loaded())for(let Ve of zt)!f.has(Ve.id)&&!yi.has(Ve.id)&&!u.hasImage(Ve.id)&&Ai(Ve);if(o.$$.dirty[0]&32|o.$$.dirty[1]&128&&t(6,l=zt.every(Ve=>f.has(Ve.id))),o.$$.dirty[0]&61456&&u){let Ve={};D!=null&&!Nl(D,u==null?void 0:u.getCenter())&&(Ve.center=D),B!=null&&!Nl(B,u==null?void 0:u.getZoom())&&(Ve.zoom=B),R!=null&&!Nl(R,u==null?void 0:u.getBearing())&&(Ve.bearing=R),z!=null&&!Nl(z,u==null?void 0:u.getPitch())&&(Ve.pitch=z),Object.keys(Ve).length&&u.easeTo(Ve)}o.$$.dirty[0]&65552&&O&&!Nl(O,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(O)),o.$$.dirty[0]&16|o.$$.dirty[1]&1&&(et?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[se,k,S,Jt,u,f,l,n,hi,xi,rt,we,D,B,z,R,O,b,I,P,U,q,re,H,ee,ve,Oe,ne,ye,Ke,Ce,et,bt,pt,st,Ht,ii,Ot,zt,Mt,ei,yi,ct,It,xt,_,a,di]}class hx extends Zt{constructor(e){super(),qt(this,e,ux,cx,Ft,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const dx=o=>({marker:o&8}),qg=o=>({marker:o[3]});function fx(o){let e,t,n,l,u,f,a;const _=o[19].default,b=Bi(_,o,o[18],qg);return{c(){e=ce("div"),b&&b.c(),Te(e,"tabindex",t=o[1]?0:void 0),Te(e,"role",n=o[1]?"button":void 0),fn(e,"z-index",o[2])},m(k,S){he(k,e,S),b&&b.m(e,null),u=!0,f||(a=[tp(o[7].call(null,e)),tp(l=px.call(null,e,o[0])),Et(e,"click",qf(o[20])),Et(e,"dblclick",qf(o[21])),Et(e,"contextmenu",qf(Tp(o[22]))),Et(e,"mouseenter",o[23]),Et(e,"mouseleave",o[24]),Et(e,"mousemove",o[25]),Et(e,"keydown",o[8])],f=!0)},p(k,[S]){b&&b.p&&(!u||S&262152)&&Oi(b,_,k,k[18],u?Fi(_,k[18],S,dx):Ni(k[18]),qg),(!u||S&2&&t!==(t=k[1]?0:void 0))&&Te(e,"tabindex",t),(!u||S&2&&n!==(n=k[1]?"button":void 0))&&Te(e,"role",n),l&&Kl(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&fn(e,"z-index",k[2])},i(k){u||(ie(b,k),u=!0)},o(k){oe(b,k),u=!1},d(k){k&&ue(e),b&&b.d(k),f=!1,an(a)}}}function px(o,e){const t=o.className;function n(l){l?o.className=`${t} ${l}`:o.className=t}return n(e),{update:n}}function mx(o,e,t){let n,l,u,{$$slots:f={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:b}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:I=!1}=e,{draggable:P=!1}=e,{feature:D=null}=e,{offset:B=void 0}=e,{zIndex:z=void 0}=e,{rotation:R=0}=e,{opacity:O=1}=e;const U=ts(),{map:q,layerEvent:se,self:re,markerClickManager:H}=Lw();dt(o,q,st=>t(27,u=st)),dt(o,se,st=>t(26,n=st)),dt(o,re,st=>t(3,l=st));function ee(st){At(re,l=new Qr.Marker({element:st,rotation:R,draggable:P,offset:B,opacity:O.toString()}).setLngLat(b).addTo(u),l),t(11,_=l);const Ht=()=>ne("dragstart"),ii=()=>{ve(),ne("drag")},Ot=()=>{ve(),ne("dragend")};return P&&(l.on("dragstart",Ht),l.on("drag",ii),l.on("dragend",Ot)),{destroy(){P&&(l==null||l.off("dragstart",Ht),l==null||l.off("drag",ii),l==null||l.off("dragend",Ot)),t(11,_=void 0),l==null||l.remove()}}}function ve(){let st=l==null?void 0:l.getLngLat();st&&(Array.isArray(b)?t(10,b=[st.lng,st.lat]):b&&"lon"in b?t(10,b={lon:st.lng,lat:st.lat}):t(10,b=st))}function Oe(st){st.key===" "&&(st.preventDefault(),st.stopPropagation(),ne("click"))}function ne(st){if(!S)return;let Ht=l==null?void 0:l.getLngLat();if(!Ht)return;const ii=[Ht.lng,Ht.lat];let Ot={map:u,marker:l,lngLat:ii,features:[{type:"Feature",properties:(D==null?void 0:D.properties)??{},geometry:{type:"Point",coordinates:ii}}]};(st==="click"||st==="contextmenu")&&H.handleClick(Ot),At(se,n={...Ot,layerType:"marker",type:st},n),U(st,Ot)}const ye=()=>ne("click"),Ke=()=>ne("dblclick"),Ce=()=>{ne("contextmenu")},et=()=>{ne("mouseenter")},bt=()=>{ne("mouseleave")},pt=()=>ne("mousemove");return o.$$set=st=>{"marker"in st&&t(11,_=st.marker),"lngLat"in st&&t(10,b=st.lngLat),"class"in st&&t(0,k=st.class),"interactive"in st&&t(12,S=st.interactive),"asButton"in st&&t(1,I=st.asButton),"draggable"in st&&t(13,P=st.draggable),"feature"in st&&t(14,D=st.feature),"offset"in st&&t(15,B=st.offset),"zIndex"in st&&t(2,z=st.zIndex),"rotation"in st&&t(16,R=st.rotation),"opacity"in st&&t(17,O=st.opacity),"$$scope"in st&&t(18,a=st.$$scope)},o.$$.update=()=>{o.$$.dirty&1032&&(l==null||l.setLngLat(b)),o.$$.dirty&32776&&(l==null||l.setOffset(B??[0,0])),o.$$.dirty&65544&&(l==null||l.setRotation(R)),o.$$.dirty&131080&&(l==null||l.setOpacity(O.toString()))},[k,I,z,l,q,se,re,ee,Oe,ne,b,_,S,P,D,B,R,O,a,f,ye,Ke,Ce,et,bt,pt]}class Pd extends Zt{constructor(e){super(),qt(this,e,mx,fx,Ft,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}var Uu=Uint8Array,w0=Uint16Array,gx=Int32Array,_x=new Uu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yx=new Uu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),x0=function(o,e){for(var t=new w0(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var l=new gx(t[30]),n=1;n<30;++n)for(var u=t[n];u<t[n+1];++u)l[u]=u-t[n]<<5|n;return{b:t,r:l}},k0=x0(_x,2),vx=k0.b,bx=k0.r;vx[28]=258,bx[258]=28;x0(yx,0);var wx=new w0(32768);for(Ui=0;Ui<32768;++Ui)ys=(Ui&43690)>>1|(Ui&21845)<<1,ys=(ys&52428)>>2|(ys&13107)<<2,ys=(ys&61680)>>4|(ys&3855)<<4,wx[Ui]=((ys&65280)>>8|(ys&255)<<8)>>1;var ys,Ui,zd=new Uu(288);for(Ui=0;Ui<144;++Ui)zd[Ui]=8;var Ui;for(Ui=144;Ui<256;++Ui)zd[Ui]=9;var Ui;for(Ui=256;Ui<280;++Ui)zd[Ui]=7;var Ui;for(Ui=280;Ui<288;++Ui)zd[Ui]=8;var Ui,xx=new Uu(32);for(Ui=0;Ui<32;++Ui)xx[Ui]=5;var Ui,kx=new Uu(0),Sx=typeof TextDecoder<"u"&&new TextDecoder,Tx=0;try{Sx.decode(kx,{stream:!0}),Tx=1}catch{}function Ex(o){let e;const t=o[16].default,n=Bi(t,o,o[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Oi(n,t,l,l[24],e?Fi(t,l[24],u,null):Ni(l[24]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function Cx(o){let e,t,n;function l(f){o[17](f)}let u={id:o[1],type:"symbol",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Ex]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Ad({props:u}),Xi.push(()=>Wr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function Mx(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("symbol")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k=void 0}=e,{layout:S=void 0}=e,{filter:I=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:B=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:R=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:q=!0}=e;function se(ye){O=ye,t(0,O)}function re(ye){ui.call(this,o,ye)}function H(ye){ui.call(this,o,ye)}function ee(ye){ui.call(this,o,ye)}function ve(ye){ui.call(this,o,ye)}function Oe(ye){ui.call(this,o,ye)}function ne(ye){ui.call(this,o,ye)}return o.$$set=ye=>{"id"in ye&&t(1,u=ye.id),"source"in ye&&t(2,f=ye.source),"sourceLayer"in ye&&t(3,a=ye.sourceLayer),"beforeId"in ye&&t(4,_=ye.beforeId),"beforeLayerType"in ye&&t(5,b=ye.beforeLayerType),"paint"in ye&&t(6,k=ye.paint),"layout"in ye&&t(7,S=ye.layout),"filter"in ye&&t(8,I=ye.filter),"applyToClusters"in ye&&t(9,P=ye.applyToClusters),"minzoom"in ye&&t(10,D=ye.minzoom),"maxzoom"in ye&&t(11,B=ye.maxzoom),"hoverCursor"in ye&&t(12,z=ye.hoverCursor),"manageHoverState"in ye&&t(13,R=ye.manageHoverState),"hovered"in ye&&t(0,O=ye.hovered),"eventsIfTopMost"in ye&&t(14,U=ye.eventsIfTopMost),"interactive"in ye&&t(15,q=ye.interactive),"$$scope"in ye&&t(24,l=ye.$$scope)},[O,u,f,a,_,b,k,S,I,P,D,B,z,R,U,q,n,se,re,H,ee,ve,Oe,ne,l]}class S0 extends Zt{constructor(e){super(),qt(this,e,Mx,Cx,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ix=Object.defineProperty,T0=o=>{throw TypeError(o)},Lx=(o,e,t)=>e in o?Ix(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,uo=(o,e,t)=>Lx(o,typeof e!="symbol"?e+"":e,t),E0=(o,e,t)=>e.has(o)||T0("Cannot "+t),Yn=(o,e,t)=>(E0(o,e,"read from private field"),t?t.call(o):e.get(o)),Zg=(o,e,t)=>e.has(o)?T0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t),Gg=(o,e,t,n)=>(E0(o,e,"write to private field"),n?n.call(o,t):e.set(o,t),t);function pn(){}function Ax(o,e){for(const t in e)o[t]=e[t];return o}function C0(o){return o()}function Wg(){return Object.create(null)}function Ls(o){o.forEach(C0)}function M0(o){return typeof o=="function"}function na(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let td;function Ar(o,e){return o===e?!0:(td||(td=document.createElement("a")),td.href=e,o===td.href)}function Px(o){return Object.keys(o).length===0}function zx(o,e,t,n){if(o){const l=I0(o,e,t,n);return o[0](l)}}function I0(o,e,t,n){return o[1]&&n?Ax(t.ctx.slice(),o[1](n(e))):t.ctx}function Dx(o,e,t,n){if(o[2]&&n){const l=o[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],f=Math.max(e.dirty.length,l.length);for(let a=0;a<f;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Rx(o,e,t,n,l,u){if(l){const f=I0(e,t,n,u);o.p(f,l)}}function Bx(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function $g(o){return o??""}function Li(o,e){o.appendChild(e)}function yn(o,e,t){o.insertBefore(e,t||null)}function gn(o){o.parentNode&&o.parentNode.removeChild(o)}function Hi(o){return document.createElement(o)}function jo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ea(o){return document.createTextNode(o)}function ho(){return ea(" ")}function Fx(){return ea("")}function Zr(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function Ox(o){return function(e){return e.preventDefault(),o.call(this,e)}}function ot(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Nx(o){return Array.from(o.childNodes)}function Pu(o,e){e=""+e,o.data!==e&&(o.data=e)}function Hg(o,e){o.value=e??""}function Mo(o,e,t){o.classList.toggle(e,!!t)}function jx(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let zu;function ku(o){zu=o}function L0(){if(!zu)throw new Error("Function called outside component initialization");return zu}function Ux(o){L0().$$.on_destroy.push(o)}function Vx(){const o=L0();return(e,t,{cancelable:n=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=jx(e,t,{cancelable:n});return l.slice().forEach(f=>{f.call(o,u)}),!u.defaultPrevented}return!0}}function Xg(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Gl=[],hp=[];let Hl=[];const Kg=[],qx=Promise.resolve();let dp=!1;function Zx(){dp||(dp=!0,qx.then(A0))}function fp(o){Hl.push(o)}const Hf=new Set;let jl=0;function A0(){if(jl!==0)return;const o=zu;do{try{for(;jl<Gl.length;){const e=Gl[jl];jl++,ku(e),Gx(e.$$)}}catch(e){throw Gl.length=0,jl=0,e}for(ku(null),Gl.length=0,jl=0;hp.length;)hp.pop()();for(let e=0;e<Hl.length;e+=1){const t=Hl[e];Hf.has(t)||(Hf.add(t),t())}Hl.length=0}while(Gl.length);for(;Kg.length;)Kg.pop()();dp=!1,Hf.clear(),ku(o)}function Gx(o){if(o.fragment!==null){o.update(),Ls(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(fp)}}function Wx(o){const e=[],t=[];Hl.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Hl=e}const ld=new Set;let Ra;function cd(){Ra={r:0,c:[],p:Ra}}function ud(){Ra.r||Ls(Ra.c),Ra=Ra.p}function Wn(o,e){o&&o.i&&(ld.delete(o),o.i(e))}function sr(o,e,t,n){if(o&&o.o){if(ld.has(o))return;ld.add(o),Ra.c.push(()=>{ld.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function Jg(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function $x(o,e){sr(o,1,1,()=>{e.delete(o.key)})}function Hx(o,e,t,n,l,u,f,a,_,b,k,S){let I=o.length,P=u.length,D=I;const B={};for(;D--;)B[o[D].key]=D;const z=[],R=new Map,O=new Map,U=[];for(D=P;D--;){const H=S(l,u,D),ee=t(H);let ve=f.get(ee);ve?U.push(()=>ve.p(H,e)):(ve=b(ee,H),ve.c()),R.set(ee,z[D]=ve),ee in B&&O.set(ee,Math.abs(D-B[ee]))}const q=new Set,se=new Set;function re(H){Wn(H,1),H.m(a,k),f.set(H.key,H),k=H.first,P--}for(;I&&P;){const H=z[P-1],ee=o[I-1],ve=H.key,Oe=ee.key;H===ee?(k=H.first,I--,P--):R.has(Oe)?!f.has(ve)||q.has(ve)?re(H):se.has(Oe)?I--:O.get(ve)>O.get(Oe)?(se.add(ve),re(H)):(q.add(Oe),I--):(_(ee,f),I--)}for(;I--;){const H=o[I];R.has(H.key)||_(H,f)}for(;P;)re(z[P-1]);return Ls(U),z}function ta(o){o&&o.c()}function Ms(o,e,t){const{fragment:n,after_update:l}=o.$$;n&&n.m(e,t),fp(()=>{const u=o.$$.on_mount.map(C0).filter(M0);o.$$.on_destroy?o.$$.on_destroy.push(...u):Ls(u),o.$$.on_mount=[]}),l.forEach(fp)}function Is(o,e){const t=o.$$;t.fragment!==null&&(Wx(t.after_update),Ls(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Xx(o,e){o.$$.dirty[0]===-1&&(Gl.push(o),Zx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function ra(o,e,t,n,l,u,f=null,a=[-1]){const _=zu;ku(o);const b=o.$$={fragment:null,ctx:[],props:u,update:pn,not_equal:l,bound:Wg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Wg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};f&&f(b.root);let k=!1;if(b.ctx=t?t(o,e.props||{},(S,I,...P)=>{const D=P.length?P[0]:I;return b.ctx&&l(b.ctx[S],b.ctx[S]=D)&&(!b.skip_bound&&b.bound[S]&&b.bound[S](D),k&&Xx(o,S)),I}):[],b.update(),k=!0,Ls(b.before_update),b.fragment=n?n(b.ctx):!1,e.target){if(e.hydrate){const S=Nx(e.target);b.fragment&&b.fragment.l(S),S.forEach(gn)}else b.fragment&&b.fragment.c();e.intro&&Wn(o.$$.fragment),Ms(o,e.target,e.anchor),A0()}ku(_)}class oa{constructor(){uo(this,"$$"),uo(this,"$$set")}$destroy(){Is(this,1),this.$destroy=pn}$on(e,t){if(!M0(t))return pn;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!Px(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Kx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Kx);function Jx(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ot(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ot(e,"viewBox","0 0 14 14"),ot(e,"width","13"),ot(e,"height","13"),ot(e,"class","svelte-en2qvf")},m(n,l){yn(n,e,l),Li(e,t)},p:pn,i:pn,o:pn,d(n){n&&gn(e)}}}class P0 extends oa{constructor(e){super(),ra(this,e,null,Jx,na,{})}}function Yx(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ot(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ot(e,"viewBox","0 0 30 30"),ot(e,"fill","none"),ot(e,"xmlns","http://www.w3.org/2000/svg"),ot(e,"class","svelte-d2loi5")},m(n,l){yn(n,e,l),Li(e,t)},p:pn,i:pn,o:pn,d(n){n&&gn(e)}}}class z0 extends oa{constructor(e){super(),ra(this,e,null,Yx,na,{})}}function Qx(o){let e,t;return{c(){e=Hi("img"),Ar(e.src,t=o[3]+"area.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){yn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"area.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&gn(e)}}}function e2(o){let e,t;return{c(){e=Hi("img"),Ar(e.src,t=o[3]+"reverse.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){yn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"reverse.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&gn(e)}}}function t2(o){let e,t;return{c(){e=Hi("img"),Ar(e.src,t=o[3]+"poi.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){yn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"poi.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&gn(e)}}}function i2(o){let e,t;return{c(){e=Hi("img"),Ar(e.src,t=o[3]+"postal_code.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){yn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"postal_code.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&gn(e)}}}function n2(o){let e,t;return{c(){e=Hi("img"),Ar(e.src,t=o[3]+"street.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){yn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"street.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&gn(e)}}}function r2(o){let e,t;return{c(){e=Hi("img"),Ar(e.src,t=o[3]+"road.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){yn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"road.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&gn(e)}}}function o2(o){let e,t;return{c(){e=Hi("img"),Ar(e.src,t=o[3]+"housenumber.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){yn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"housenumber.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&gn(e)}}}function s2(o){let e,t,n,l;return{c(){e=Hi("img"),Ar(e.src,t=o[5])||ot(e,"src",t),ot(e,"alt",o[4]),ot(e,"class","svelte-ltkwvy")},m(u,f){yn(u,e,f),n||(l=Zr(e,"error",o[14]),n=!0)},p(u,f){f&32&&!Ar(e.src,t=u[5])&&ot(e,"src",t),f&16&&ot(e,"alt",u[4])},d(u){u&&gn(e),n=!1,l()}}}function Yg(o){let e,t;return{c(){e=Hi("span"),t=ea(o[6]),ot(e,"class","secondary svelte-ltkwvy")},m(n,l){yn(n,e,l),Li(e,t)},p(n,l){l&64&&Pu(t,n[6])},d(n){n&&gn(e)}}}function a2(o){let e,t,n,l,u,f,a,_,b,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,I,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],D,B,z=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",R,O,U;function q(ee,ve){return ve&1&&(t=null),ve&1&&(n=null),ve&1&&(l=null),ve&1&&(u=null),ee[5]?s2:ee[0].address?o2:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?r2:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?n2:(l==null&&(l=!!ee[0].id.startsWith("postal_code.")),l?i2:(u==null&&(u=!!ee[0].id.startsWith("poi.")),u?t2:ee[7]?e2:Qx))))}let se=q(o,-1),re=se(o),H=P&&Yg(o);return{c(){e=Hi("li"),re.c(),f=ho(),a=Hi("span"),_=Hi("span"),b=Hi("span"),S=ea(k),I=ho(),H&&H.c(),D=ho(),B=Hi("span"),R=ea(z),ot(b,"class","primary svelte-ltkwvy"),ot(_,"class","svelte-ltkwvy"),ot(B,"class","line2 svelte-ltkwvy"),ot(a,"class","texts svelte-ltkwvy"),ot(e,"tabindex","0"),ot(e,"data-selected",o[1]),ot(e,"class","svelte-ltkwvy"),Mo(e,"selected",o[1])},m(ee,ve){yn(ee,e,ve),re.m(e,null),Li(e,f),Li(e,a),Li(a,_),Li(_,b),Li(b,S),Li(_,I),H&&H.m(_,null),Li(a,D),Li(a,B),Li(B,R),O||(U=[Zr(e,"mouseenter",o[12]),Zr(e,"focus",o[13])],O=!0)},p(ee,[ve]){se===(se=q(ee,ve))&&re?re.p(ee,ve):(re.d(1),re=se(ee),re&&(re.c(),re.m(e,f))),ve&1&&k!==(k=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&Pu(S,k),ve&37&&(P=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),P?H?H.p(ee,ve):(H=Yg(ee),H.c(),H.m(_,null)):H&&(H.d(1),H=null),ve&1&&z!==(z=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Pu(R,z),ve&2&&ot(e,"data-selected",ee[1]),ve&2&&Mo(e,"selected",ee[1])},i:pn,o:pn,d(ee){ee&&gn(e),re.d(),H&&H.d(),O=!1,Ls(U)}}}function l2(o,e,t){var n;let l,u,{feature:f}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:b}=e,{iconsBaseUrl:k}=e;const S=(n=f.properties)==null?void 0:n.categories;let I,P,D=0,B=f.place_type[0]==="reverse";function z(){P&&b.add(P),t(10,D++,D)}function R(q){Xg.call(this,o,q)}function O(q){Xg.call(this,o,q)}const U=()=>z();return o.$$set=q=>{"feature"in q&&t(0,f=q.feature),"selected"in q&&t(1,a=q.selected),"showPlaceType"in q&&t(2,_=q.showPlaceType),"missingIconsCache"in q&&t(9,b=q.missingIconsCache),"iconsBaseUrl"in q&&t(3,k=q.iconsBaseUrl)},o.$$.update=()=>{var q,se,re,H;if(o.$$.dirty&3640)do t(11,l--,l),t(4,I=S==null?void 0:S[l]),t(5,P=I?k+I.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!P||b.has(P)));o.$$.dirty&1&&t(6,u=((se=(q=f.properties)==null?void 0:q.categories)==null?void 0:se.join(", "))??((H=(re=f.properties)==null?void 0:re.place_type_name)==null?void 0:H[0])??f.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[f,a,_,k,I,P,u,B,z,b,D,l,R,O,U]}class c2 extends oa{constructor(e){super(),ra(this,e,l2,a2,na,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function u2(o){let e;return{c(){e=Hi("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ot(e,"class","svelte-7cmwmc")},m(t,n){yn(t,e,n)},p:pn,i:pn,o:pn,d(t){t&&gn(e)}}}class h2 extends oa{constructor(e){super(),ra(this,e,null,u2,na,{})}}function d2(o){let e,t,n;return{c(){e=jo("svg"),t=jo("path"),ot(t,"stroke-width","4"),ot(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ot(t,"class","svelte-gzo3ar"),ot(e,"width",n=o[0]==="list"?20:void 0),ot(e,"viewBox","0 0 70 85"),ot(e,"fill","none"),ot(e,"class","svelte-gzo3ar"),Mo(e,"in-map",o[0]!=="list"),Mo(e,"list-icon",o[0]==="list")},m(l,u){yn(l,e,u),Li(e,t)},p(l,[u]){u&1&&n!==(n=l[0]==="list"?20:void 0)&&ot(e,"width",n),u&1&&Mo(e,"in-map",l[0]!=="list"),u&1&&Mo(e,"list-icon",l[0]==="list")},i:pn,o:pn,d(l){l&&gn(e)}}}function f2(o,e,t){let{displayIn:n}=e;return o.$$set=l=>{"displayIn"in l&&t(0,n=l.displayIn)},[n]}class p2 extends oa{constructor(e){super(),ra(this,e,f2,d2,na,{displayIn:0})}}function m2(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ot(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ot(e,"viewBox","0 0 60.006 21.412"),ot(e,"width","14"),ot(e,"height","20"),ot(e,"class","svelte-en2qvf")},m(n,l){yn(n,e,l),Li(e,t)},p:pn,i:pn,o:pn,d(n){n&&gn(e)}}}class g2 extends oa{constructor(e){super(),ra(this,e,null,m2,na,{})}}function _2(o){let e,t,n;return{c(){e=jo("svg"),t=jo("circle"),n=jo("path"),ot(t,"cx","4.789"),ot(t,"cy","4.787"),ot(t,"r","3.85"),ot(t,"class","svelte-1aq105l"),ot(n,"d","M12.063 12.063 7.635 7.635"),ot(n,"class","svelte-1aq105l"),ot(e,"xmlns","http://www.w3.org/2000/svg"),ot(e,"width","13"),ot(e,"height","13"),ot(e,"viewBox","0 0 13 13"),ot(e,"class","svelte-1aq105l")},m(l,u){yn(l,e,u),Li(e,t),Li(e,n)},p:pn,i:pn,o:pn,d(l){l&&gn(e)}}}class y2 extends oa{constructor(e){super(),ra(this,e,null,_2,na,{})}}function v2(o,e,t){const n=e[1],l=e[0],u=n-l;return o===n&&t?o:((o-l)%u+u)%u+l}function wd(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let su;async function b2(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(su&&l.cachedLocationExpiry&&su.time+l.cachedLocationExpiry>Date.now()){if(!su.coords)break e;return su.coords}let u;try{return u=await new Promise((f,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(b=>b.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(su={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const w2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Qg=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,e_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,t_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,i_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,n_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function x2(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),f=t>0?"N":"S",a=n>0?"E":"W";let _;o=="DD"&&(_=`${l}° ${f}, ${u}° ${a}`);const b=Math.floor(l),k=Math.floor(u),S=(l-b)*60,I=(u-k)*60;if(o=="DM"){let P=r_(S,3).toFixed(3).padStart(6,"0"),D=r_(I,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&D.endsWith(".000")&&(P=P.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${b}° ${P}' ${f}, ${k}° ${D}' ${a}`}if(o=="DMS"){const P=Math.floor(S),D=Math.floor(I);let B=((S-P)*60).toFixed(1).padStart(4,"0"),z=((I-D)*60).toFixed(1).padStart(4,"0");const R=P.toString().padStart(2,"0"),O=D.toString().padStart(2,"0");B.endsWith(".0")&&z.endsWith(".0")&&(B=B.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),_=`${b}° ${R}' ${B}" ${f}, ${k}° ${O}' ${z}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function r_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Np(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",f=null,a=[],_=!1;if(w2.test(o))throw new Error("invalid coordinate value");if(Qg.test(o))if(a=Qg.exec(o),_=au(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),f="DM";else throw new Error("invalid coordinate format");else if(e_.test(o))if(a=e_.exec(o),_=au(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),f="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(t_.test(o))if(a=t_.exec(o),_=au(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(i_.test(o))if(a=i_.exec(o),_=au(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6]/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(n_.test(o)){if(a=n_.exec(o),_=au(a),a.filter(b=>b).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let b=/S|SOUTH/i;b.test(l)&&t>0&&(t=-1*t),b=/W|WEST/i,b.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,I;const P=/[,/;\u0020]/g,D=k.match(P);if(D==null){const R=Math.floor(o.length/2);S=k.substring(0,R).trim(),I=k.substring(R).trim()}else{let R;D.length%2==1?R=Math.floor(D.length/2):R=D.length/2-1;let O=0;if(R==0)O=k.indexOf(D[0]),S=k.substring(0,O).trim(),I=k.substring(O+1).trim();else{let U=0,q=0;for(;U<=R;)O=k.indexOf(D[U],q),q=O+1,U++;S=k.substring(0,O).trim(),I=k.substring(O+1).trim()}}const B=S.split(".");if(B.length==2&&B[1]==0&&B[1].length!=2)throw new Error("invalid coordinates format");const z=I.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(I))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:I,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:f,closeEnough:k2,toCoordinateFormat:x2})}else throw new Error("coordinates pattern match failed")}function au(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const f=e[u],a=e[u+l],_=t.test(f)&&t.test(a),b=n.test(f)&&n.test(a),k=f==a;if(!(f==null&&a==null)){if(f==null||a==null)return!1;if(_||b||k)continue;return!1}}return!0}function o_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function k2(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return o_(this.decimalLatitude,Number(e[0]))&&o_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const S2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Np.to=S2;const T2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],E2={decimalLatitude:40.123,decimalLongitude:-74.123},C2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],M2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function I2(){const o=[];return T2.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...E2})}),[...o,...C2,...M2]}const L2=I2();Np.formats=L2.map(o=>o.verbatimCoordinates);const A2=Np;function s_(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function a_(o){let e,t;return e=new h2({}),{c(){ta(e.$$.fragment)},m(n,l){Ms(e,n,l),t=!0},i(n){t||(Wn(e.$$.fragment,n),t=!0)},o(n){sr(e.$$.fragment,n),t=!1},d(n){Is(e,n)}}}function l_(o){let e,t,n,l,u;return t=new g2({}),{c(){e=Hi("button"),ta(t.$$.fragment),ot(e,"type","button"),ot(e,"title",o[9]),ot(e,"class","svelte-bz0zu3"),Mo(e,"active",o[0])},m(f,a){yn(f,e,a),Ms(t,e,null),n=!0,l||(u=Zr(e,"click",o[69]),l=!0)},p(f,a){(!n||a[0]&512)&&ot(e,"title",f[9]),(!n||a[0]&1)&&Mo(e,"active",f[0])},i(f){n||(Wn(t.$$.fragment,f),n=!0)},o(f){sr(t.$$.fragment,f),n=!1},d(f){f&&gn(e),Is(t),l=!1,u()}}}function P2(o){let e,t=[],n=new Map,l,u,f,a=Jg(o[14]);const _=b=>b[84].id+(b[84].address?","+b[84].address:"");for(let b=0;b<a.length;b+=1){let k=s_(o,a,b),S=_(k);n.set(S,t[b]=c_(S,k))}return{c(){e=Hi("ul");for(let b=0;b<t.length;b+=1)t[b].c();ot(e,"class","options svelte-bz0zu3")},m(b,k){yn(b,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(f=[Zr(e,"mouseleave",o[73]),Zr(e,"blur",o[74])],u=!0)},p(b,k){k[0]&17880064&&(a=Jg(b[14]),cd(),t=Hx(t,k,_,1,b,a,n,e,$x,c_,null,s_),ud())},i(b){if(!l){for(let k=0;k<a.length;k+=1)Wn(t[k]);l=!0}},o(b){for(let k=0;k<t.length;k+=1)sr(t[k]);l=!1},d(b){b&&gn(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,Ls(f)}}}function z2(o){let e,t,n,l,u,f;return t=new z0({}),{c(){e=Hi("div"),ta(t.$$.fragment),n=ho(),l=Hi("div"),u=ea(o[7]),ot(l,"class","svelte-bz0zu3"),ot(e,"class","no-results svelte-bz0zu3")},m(a,_){yn(a,e,_),Ms(t,e,null),Li(e,n),Li(e,l),Li(l,u),f=!0},p(a,_){(!f||_[0]&128)&&Pu(u,a[7])},i(a){f||(Wn(t.$$.fragment,a),f=!0)},o(a){sr(t.$$.fragment,a),f=!1},d(a){a&&gn(e),Is(t)}}}function D2(o){let e="",t;return{c(){t=ea(e)},m(n,l){yn(n,t,l)},p:pn,i:pn,o:pn,d(n){n&&gn(t)}}}function R2(o){let e,t,n,l,u,f,a,_,b,k,S;return t=new z0({}),_=new P0({}),{c(){e=Hi("div"),ta(t.$$.fragment),n=ho(),l=Hi("div"),u=ea(o[6]),f=ho(),a=Hi("button"),ta(_.$$.fragment),ot(l,"class","svelte-bz0zu3"),ot(a,"class","svelte-bz0zu3"),ot(e,"class","error svelte-bz0zu3")},m(I,P){yn(I,e,P),Ms(t,e,null),Li(e,n),Li(e,l),Li(l,u),Li(e,f),Li(e,a),Ms(_,a,null),b=!0,k||(S=Zr(a,"click",o[70]),k=!0)},p(I,P){(!b||P[0]&64)&&Pu(u,I[6])},i(I){b||(Wn(t.$$.fragment,I),Wn(_.$$.fragment,I),b=!0)},o(I){sr(t.$$.fragment,I),sr(_.$$.fragment,I),b=!1},d(I){I&&gn(e),Is(t),Is(_),k=!1,S()}}}function c_(o,e){let t,n,l;function u(){return e[71](e[86])}function f(){return e[72](e[84])}return n=new c2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",f),{key:o,first:null,c(){t=Fx(),ta(n.$$.fragment),this.first=t},m(a,_){yn(a,t,_),Ms(n,a,_),l=!0},p(a,_){e=a;const b={};_[0]&16384&&(b.feature=e[84]),_[0]&1024&&(b.showPlaceType=e[10]),_[0]&49152&&(b.selected=e[15]===e[86]),_[0]&4096&&(b.iconsBaseUrl=e[12]),n.$set(b)},i(a){l||(Wn(n.$$.fragment,a),l=!0)},o(a){sr(n.$$.fragment,a),l=!1},d(a){a&&gn(t),Is(n,a)}}}function B2(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R,O,U,q,se,re=!1;u=new y2({}),S=new P0({});let H=o[19]&&a_(),ee=o[5]==="button"&&l_(o);const ve=o[61].default,Oe=zx(ve,o,o[60],null),ne=[R2,D2,z2,P2],ye=[];function Ke(Ce,et){var bt,pt;return Ce[18]?0:Ce[16]?((bt=Ce[14])==null?void 0:bt.length)===0?2:Ce[16]&&(pt=Ce[14])!=null&&pt.length?3:-1:1}return~(z=Ke(o))&&(R=ye[z]=ne[z](o)),{c(){e=ho(),t=Hi("form"),n=Hi("div"),l=Hi("button"),ta(u.$$.fragment),f=ho(),a=Hi("input"),_=ho(),b=Hi("div"),k=Hi("button"),ta(S.$$.fragment),I=ho(),H&&H.c(),P=ho(),ee&&ee.c(),D=ho(),Oe&&Oe.c(),B=ho(),R&&R.c(),ot(l,"class","search-button svelte-bz0zu3"),ot(l,"type","button"),ot(a,"placeholder",o[8]),ot(a,"aria-label",o[8]),ot(a,"class","svelte-bz0zu3"),ot(k,"type","button"),ot(k,"title",o[3]),ot(k,"class","svelte-bz0zu3"),ot(b,"class","clear-button-container svelte-bz0zu3"),Mo(b,"displayable",o[1]!==""),ot(n,"class","input-group svelte-bz0zu3"),ot(t,"tabindex","0"),ot(t,"class",O=$g(o[2])+" svelte-bz0zu3"),Mo(t,"can-collapse",o[4]&&o[1]==="")},m(Ce,et){yn(Ce,e,et),yn(Ce,t,et),Li(t,n),Li(n,l),Ms(u,l,null),Li(n,f),Li(n,a),o[63](a),Hg(a,o[1]),Li(n,_),Li(n,b),Li(b,k),Ms(S,k,null),Li(b,I),H&&H.m(b,null),Li(n,P),ee&&ee.m(n,null),Li(n,D),Oe&&Oe.m(n,null),Li(t,B),~z&&ye[z].m(t,null),U=!0,q||(se=[Zr(l,"click",o[62]),Zr(a,"input",o[64]),Zr(a,"focus",o[65]),Zr(a,"blur",o[66]),Zr(a,"keydown",o[22]),Zr(a,"input",o[67]),Zr(k,"click",o[68]),Zr(t,"submit",Ox(o[21]))],q=!0)},p(Ce,et){(!U||et[0]&256)&&ot(a,"placeholder",Ce[8]),(!U||et[0]&256)&&ot(a,"aria-label",Ce[8]),et[0]&2&&a.value!==Ce[1]&&Hg(a,Ce[1]),(!U||et[0]&8)&&ot(k,"title",Ce[3]),Ce[19]?H?et[0]&524288&&Wn(H,1):(H=a_(),H.c(),Wn(H,1),H.m(b,null)):H&&(cd(),sr(H,1,1,()=>{H=null}),ud()),(!U||et[0]&2)&&Mo(b,"displayable",Ce[1]!==""),Ce[5]==="button"?ee?(ee.p(Ce,et),et[0]&32&&Wn(ee,1)):(ee=l_(Ce),ee.c(),Wn(ee,1),ee.m(n,D)):ee&&(cd(),sr(ee,1,1,()=>{ee=null}),ud()),Oe&&Oe.p&&(!U||et[1]&536870912)&&Rx(Oe,ve,Ce,Ce[60],U?Dx(ve,Ce[60],et,null):Bx(Ce[60]),null);let bt=z;z=Ke(Ce),z===bt?~z&&ye[z].p(Ce,et):(R&&(cd(),sr(ye[bt],1,1,()=>{ye[bt]=null}),ud()),~z?(R=ye[z],R?R.p(Ce,et):(R=ye[z]=ne[z](Ce),R.c()),Wn(R,1),R.m(t,null)):R=null),(!U||et[0]&4&&O!==(O=$g(Ce[2])+" svelte-bz0zu3"))&&ot(t,"class",O),(!U||et[0]&22)&&Mo(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){U||(Wn(re),Wn(u.$$.fragment,Ce),Wn(S.$$.fragment,Ce),Wn(H),Wn(ee),Wn(Oe,Ce),Wn(R),U=!0)},o(Ce){sr(re),sr(u.$$.fragment,Ce),sr(S.$$.fragment,Ce),sr(H),sr(ee),sr(Oe,Ce),sr(R),U=!1},d(Ce){Ce&&(gn(e),gn(t)),Is(u),o[63](null),Is(S),H&&H.d(),ee&&ee.d(),Oe&&Oe.d(Ce),~z&&ye[z].d(),q=!1,Ls(se)}}}function F2(o,e,t){let n,l,{$$slots:u={},$$scope:f}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:b}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:I=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:z="never"}=e,{errorMessage:R="Something went wrong…"}=e,{filter:O=()=>!0}=e,{flyTo:U=!0}=e,{fuzzyMatch:q=!0}=e,{language:se=void 0}=e,{limit:re=void 0}=e,{mapController:H=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:ve="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Oe="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:ye=z==="always"}=e,{reverseButtonTitle:Ke="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:bt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:st=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:ii=!0}=e,{types:Ot=void 0}=e,{exhaustiveReverseGeocoding:zt=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Mt=a}=e,{apiUrl:ei="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Vt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:xi=()=>{}}=e;function yi(){Ve.focus()}function Ai(){Ve.blur()}function ct(G,Ue=!0,qe=!1){t(1,Ce=G),Ue?(t(15,$e=-1),ut()):(Yt(!qe,qe),setTimeout(()=>{Ve.focus(),Ve.select()}))}function It(){t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1)}function Ne(){t(55,xt=[]),t(56,we=void 0)}let je=!1,rt,xt,we,di="",Ve,$e=-1,kt,vn=[],bn,Cn,er,tr;const Uo=new Set,Ki=Vx();Ux(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function ut(G){if(Cn&&(clearTimeout(Cn),Cn=void 0),$e>-1&&rt)t(56,we=rt[$e]),t(1,Ce=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,kt=void 0),t(55,xt=void 0),t(15,$e=-1);else if(Ce){const Ue=G||!Hn(Ce);wn(Ce,{exact:!0}).then(()=>{t(55,xt=rt),t(56,we=void 0),Ue&&Lo()}).catch(qe=>t(18,kt=qe))}}function Hn(G){try{return A2(G,6)}catch{return!1}}async function wn(G,{byId:Ue=!1,exact:qe=!1}={}){t(18,kt=void 0),bn==null||bn.abort();const Ge=new AbortController;t(19,bn=Ge);try{const Je=Hn(G),ht=new URLSearchParams;if(se!==void 0&&ht.set("language",Array.isArray(se)?se.join(","):se??""),Ot&&ht.set("types",Ot.join(",")),Jt&&ht.set("excludeTypes",String(Jt)),k&&ht.set("bbox",k.map(vi=>vi.toFixed(6)).join(",")),D&&ht.set("country",Array.isArray(D)?D.join(","):D),!Ue&&!Je){const vi=await b2(H,ne,Ge);vi&&ht.set("proximity",vi),(qe||!pt)&&ht.set("autocomplete","false"),ht.set("fuzzyMatch",String(q))}re!==void 0&&(zt||!Je||(Ot==null?void 0:Ot.length)===1)&&ht.set("limit",String(re)),ht.set("key",b),xi(ht);const Rt=ei+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:G)+".json?"+ht.toString();if(Rt===di){Ue?(t(14,rt=void 0),t(56,we=vn[0])):t(14,rt=vn);return}di=Rt;const Xt=await fetch(Rt,{signal:Ge.signal,...Vt});if(!Xt.ok)throw new Error(await Xt.text());const ai=await Xt.json();Ki("response",{url:Rt,featureCollection:ai}),Ue?(t(14,rt=void 0),t(56,we=ai.features[0]),vn=[we]):(t(14,rt=ai.features.filter(O)),Je&&rt.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),vn=rt,Je&&Ve.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{Ge===bn&&t(19,bn=void 0)}}function Lo(){var G;if(!(xt!=null&&xt.length)||!U)return;const Ue=[180,90,-180,-90],qe=!xt.some(Je=>!Je.matching_text);let Ge;for(const Je of xt){const ht=Vi(Je);if(Ge=Ge===void 0?ht:ht===void 0?Ge:Math.max(Ge,ht),qe||!Je.matching_text)for(const Rt of[0,1,2,3])Ue[Rt]=Math[Rt<2?"min":"max"](Ue[Rt],((G=Je.bbox)==null?void 0:G[Rt])??Je.center[Rt%2])}H&&xt.length>0&&(we&&Ue[0]===Ue[2]&&Ue[1]===Ue[3]?H.flyTo(we.center,Vi(we)):H.fitBounds(wd(Ue),50,Ge))}function Vi(G){var Ue;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const qe=G.id.replace(/\..*/,"");return(Array.isArray((Ue=G.properties)==null?void 0:Ue.categories)?G.properties.categories.reduce((Ge,Je)=>{const ht=Mt[qe+"."+Je];return Ge===void 0?ht:ht===void 0?Ge:Math.max(Ge,ht)},void 0):void 0)??Mt[qe]}function gt(G){t(0,ye=z==="always"),t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1),ct(G[1].toFixed(6)+", "+v2(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ni(G){if(!rt)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&($e===(st?0:-1)&&Ue===-1&&t(15,$e=rt.length),t(15,$e+=Ue),$e>=rt.length&&t(15,$e=-1),$e<0&&st&&t(15,$e=0),G.preventDefault())}function Yt(G=!0,Ue=!1){if(t(18,kt=void 0),pt||Ue){if(Cn&&clearTimeout(Cn),Ce.length<ee)return;const qe=Ce;Cn=window.setTimeout(()=>{wn(qe).catch(Ge=>t(18,kt=Ge))},G?B:0)}else t(14,rt=void 0),t(18,kt=void 0)}function qi(G){t(56,we=G),t(1,Ce=G.place_name),t(15,$e=-1)}const _r=()=>Ve.focus();function ti(G){hp[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function eo(){Ce=this.value,t(1,Ce),t(13,je),t(28,I)}const ln=()=>t(13,je=!0),me=()=>t(13,je=!1),W=()=>Yt(),X=()=>{t(1,Ce=""),Ve.focus()},te=()=>t(0,ye=!ye),de=()=>t(18,kt=void 0),Me=G=>t(15,$e=G),Ie=G=>qi(G),Be=()=>{st||t(15,$e=-1)},ke=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,b=G.apiKey),"bbox"in G&&t(27,k=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,I=G.clearOnBlur),"collapsed"in G&&t(4,P=G.collapsed),"country"in G&&t(29,D=G.country),"debounceSearch"in G&&t(30,B=G.debounceSearch),"enableReverse"in G&&t(5,z=G.enableReverse),"errorMessage"in G&&t(6,R=G.errorMessage),"filter"in G&&t(31,O=G.filter),"flyTo"in G&&t(32,U=G.flyTo),"fuzzyMatch"in G&&t(33,q=G.fuzzyMatch),"language"in G&&t(34,se=G.language),"limit"in G&&t(35,re=G.limit),"mapController"in G&&t(36,H=G.mapController),"minLength"in G&&t(37,ee=G.minLength),"noResultsMessage"in G&&t(7,ve=G.noResultsMessage),"placeholder"in G&&t(8,Oe=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,ye=G.reverseActive),"reverseButtonTitle"in G&&t(9,Ke=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,bt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,st=G.selectFirst),"flyToSelected"in G&&t(41,Ht=G.flyToSelected),"markerOnSelected"in G&&t(42,ii=G.markerOnSelected),"types"in G&&t(43,Ot=G.types),"exhaustiveReverseGeocoding"in G&&t(44,zt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Mt=G.zoom),"apiUrl"in G&&t(47,ei=G.apiUrl),"fetchParameters"in G&&t(48,Vt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,xi=G.adjustUrlQuery),"$$scope"in G&&t(60,f=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ye=z==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,er=je),I&&!je&&t(1,Ce="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ce.length<ee&&(t(56,we=void 0),t(14,rt=void 0),t(18,kt=void 0),t(55,xt=rt)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&wn(we.id,{byId:!0}).catch(G=>t(18,kt=G)),o.$$.dirty[1]&100663330&&(H&&we&&we.id!==tr&&U&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?H.flyTo(we.center,Vi(we)):H.fitBounds(wd(we.bbox),50,Vi(we)),t(14,rt=void 0),t(55,xt=void 0),t(15,$e=-1)),t(57,tr=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&st&&rt!=null&&rt.length&&t(15,$e=0),o.$$.dirty[0]&2&&t(15,$e=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&xt!==rt&&t(55,xt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&H&&H.setEventHandler(G=>{switch(G.type){case"mapClick":ye&&gt(G.coordinates);break;case"markerClick":{const Ue=rt==null?void 0:rt.find(qe=>qe.id===G.id);Ue&&qi(Ue)}break;case"markerMouseEnter":xt&&t(15,$e=er?(rt==null?void 0:rt.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,$e=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=rt==null?void 0:rt[$e]),o.$$.dirty[1]&134218786&&H&&l&&U&&Ht&&H.flyTo(l.center,Vi(l)),o.$$.dirty[1]&256&&t(59,n=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ii||H==null||H.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&H&&ii&&!xt&&(H.setFeatures(l?[l]:void 0,void 0,n),H.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&H&&H.setFeatures(xt,we,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&xt&&H&&H.setSelectedMarker($e),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&H){const G=Hn(Ce);H.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ki("select",{feature:l}),o.$$.dirty[1]&33554432&&Ki("pick",{feature:we}),o.$$.dirty[0]&81920&&Ki("optionsvisibilitychange",{optionsVisible:er&&!!rt}),o.$$.dirty[0]&16384&&Ki("featureslisted",{features:rt}),o.$$.dirty[1]&16777216&&Ki("featuresmarked",{features:xt}),o.$$.dirty[0]&1&&Ki("reversetoggle",{reverse:ye}),o.$$.dirty[0]&2&&Ki("querychange",{query:Ce}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&H&&H.indicateReverse(ye)},[ye,Ce,_,S,P,z,R,ve,Oe,Ke,bt,st,hi,je,rt,$e,er,Ve,kt,bn,Uo,ut,ni,Yt,qi,a,b,k,I,D,B,O,U,q,se,re,H,ee,ne,et,pt,Ht,ii,Ot,zt,Jt,Mt,ei,Vt,xi,yi,Ai,ct,It,Ne,xt,we,tr,l,n,f,u,_r,ti,eo,ln,me,W,X,te,de,Me,Ie,Be,ke]}let O2=class extends oa{constructor(o){super(),ra(this,o,F2,B2,na,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Du(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function jp(o,e,t={}){for(const n of o){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<n[n.length-1].length;l++)if(n[n.length-1][l]!==n[0][l])throw new Error("First and last Position are not equivalent.")}return Du({type:"Polygon",coordinates:o},e,t)}function Ru(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function D0(o,e,t={}){return Du({type:"MultiPolygon",coordinates:o},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function N2(o,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,l,u,f;return f={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function a(b){return function(k){return _([b,k])}}function _(b){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,l&&(u=b[0]&2?l.return:b[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,b[1])).done)return u;switch(l=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return t.label++,{value:b[1],done:!1};case 5:t.label++,l=b[1],b=[0];continue;case 7:b=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){t=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){t.label=b[1];break}if(b[0]===6&&t.label<u[1]){t.label=u[1],u=b;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(b);break}u[2]&&t.ops.pop(),t.trys.pop();continue}b=e.call(o,t)}catch(k){b=[6,k],l=0}finally{n=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}var ia=function(){function o(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return o}();function j2(o,e){return o>e?1:o<e?-1:0}function Ks(o,e,t){for(var n=new ia(null,null),l=n,u=n;;){var f=t(o,e.key);if(f<0){if(e.left===null)break;if(t(o,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(f>0){if(e.right===null)break;if(t(o,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=n.right,e.right=n.left,e}function Xf(o,e,t,n){var l=new ia(o,e);if(t===null)return l.left=l.right=null,l;t=Ks(o,t,n);var u=n(o,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function u_(o,e,t){var n=null,l=null;if(e){e=Ks(o,e,t);var u=t(e.key,o);u===0?(n=e.left,l=e.right):u<0?(l=e.right,e.right=null,n=e):(n=e.left,e.left=null,l=e)}return{left:n,right:l}}function U2(o,e,t){return e===null?o:(o===null||(e=Ks(o.key,e,t),e.left=o),e)}function pp(o,e,t,n,l){if(o){n(""+e+(t?"└── ":"├── ")+l(o)+`
`);var u=e+(t?"    ":"│   ");o.left&&pp(o.left,u,!1,n,l),o.right&&pp(o.right,u,!0,n,l)}}var Up=function(){function o(e){e===void 0&&(e=j2),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=Xf(e,t,this._root,this._comparator)},o.prototype.add=function(e,t){var n=new ia(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var l=this._comparator,u=Ks(e,this._root,l),f=l(e,u.key);return f===0?this._root=u:(f<0?(n.left=u.left,n.right=u,u.left=null):f>0&&(n.right=u.right,n.left=u,u.right=null),this._size++,this._root=n),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,n){var l;if(t===null)return null;t=Ks(e,t,n);var u=n(e,t.key);return u===0?(t.left===null?l=t.right:(l=Ks(e,t.left,n),l.right=t.right),this._size--,l):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ks(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=Ks(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},o.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},o.prototype.forEach=function(e,t){for(var n=this._root,l=[],u=!1;!u;)n!==null?(l.push(n),n=n.left):l.length!==0?(n=l.pop(),e.call(t,n),n=n.right):u=!0;return this},o.prototype.range=function(e,t,n,l){for(var u=[],f=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=f(a.key,t),_>0)break;if(f(a.key,e)>=0&&n.call(l,a))return this;a=a.right}return this},o.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},o.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,n=!1,l=0,u=[];!n;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else n=!0;return null},o.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(n=t,t=t.left):t=t.right}return n},o.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(n=t,t=t.right)}return n},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return q2(this._root)},o.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var l=e.length,u=this._comparator;if(n&&_p(e,t,0,l-1,u),this._root===null)this._root=mp(e,t,0,l),this._size=l;else{var f=Z2(this.toList(),V2(e,t),u);l=this._size+l,this._root=gp({head:f},0,l)}return this},o.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return pp(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},o.prototype.update=function(e,t,n){var l=this._comparator,u=u_(e,this._root,l),f=u.left,a=u.right;l(e,t)<0?a=Xf(t,n,a,l):f=Xf(t,n,f,l),this._root=U2(f,a,l)},o.prototype.split=function(e){return u_(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var e,t,n;return N2(this,function(l){switch(l.label){case 0:e=this._root,t=[],n=!1,l.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:n=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},o}();function mp(o,e,t,n){var l=n-t;if(l>0){var u=t+Math.floor(l/2),f=o[u],a=e[u],_=new ia(f,a);return _.left=mp(o,e,t,u),_.right=mp(o,e,u+1,n),_}return null}function V2(o,e){for(var t=new ia(null,null),n=t,l=0;l<o.length;l++)n=n.next=new ia(o[l],e[l]);return n.next=null,t.next}function q2(o){for(var e=o,t=[],n=!1,l=new ia(null,null),u=l;!n;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):n=!0;return u.next=null,l.next}function gp(o,e,t){var n=t-e;if(n>0){var l=e+Math.floor(n/2),u=gp(o,e,l),f=o.head;return f.left=u,o.head=o.head.next,f.right=gp(o,l+1,t),f}return null}function Z2(o,e,t){for(var n=new ia(null,null),l=n,u=o,f=e;u!==null&&f!==null;)t(u.key,f.key)<0?(l.next=u,u=u.next):(l.next=f,f=f.next),l=l.next;return u!==null?l.next=u:f!==null&&(l.next=f),n.next}function _p(o,e,t,n,l){if(!(t>=n)){for(var u=o[t+n>>1],f=t-1,a=n+1;;){do f++;while(l(o[f],u)<0);do a--;while(l(o[a],u)>0);if(f>=a)break;var _=o[f];o[f]=o[a],o[a]=_,_=e[f],e[f]=e[a],e[a]=_}_p(o,e,t,a,l),_p(o,e,a+1,n,l)}}const ks=11102230246251565e-32,Cr=134217729,G2=(3+8*ks)*ks;function Kf(o,e,t,n,l){let u,f,a,_,b=e[0],k=n[0],S=0,I=0;k>b==k>-b?(u=b,b=e[++S]):(u=k,k=n[++I]);let P=0;if(S<o&&I<t)for(k>b==k>-b?(f=b+u,a=u-(f-b),b=e[++S]):(f=k+u,a=u-(f-k),k=n[++I]),u=f,a!==0&&(l[P++]=a);S<o&&I<t;)k>b==k>-b?(f=u+b,_=f-u,a=u-(f-_)+(b-_),b=e[++S]):(f=u+k,_=f-u,a=u-(f-_)+(k-_),k=n[++I]),u=f,a!==0&&(l[P++]=a);for(;S<o;)f=u+b,_=f-u,a=u-(f-_)+(b-_),b=e[++S],u=f,a!==0&&(l[P++]=a);for(;I<t;)f=u+k,_=f-u,a=u-(f-_)+(k-_),k=n[++I],u=f,a!==0&&(l[P++]=a);return(u!==0||P===0)&&(l[P++]=u),P}function W2(o,e){let t=e[0];for(let n=1;n<o;n++)t+=e[n];return t}function Vu(o){return new Float64Array(o)}const $2=(3+16*ks)*ks,H2=(2+12*ks)*ks,X2=(9+64*ks)*ks*ks,Ul=Vu(4),h_=Vu(8),d_=Vu(12),f_=Vu(16),Ur=Vu(4);function K2(o,e,t,n,l,u,f){let a,_,b,k,S,I,P,D,B,z,R,O,U,q,se,re,H,ee;const ve=o-l,Oe=t-l,ne=e-u,ye=n-u;q=ve*ye,I=Cr*ve,P=I-(I-ve),D=ve-P,I=Cr*ye,B=I-(I-ye),z=ye-B,se=D*z-(q-P*B-D*B-P*z),re=ne*Oe,I=Cr*ne,P=I-(I-ne),D=ne-P,I=Cr*Oe,B=I-(I-Oe),z=Oe-B,H=D*z-(re-P*B-D*B-P*z),R=se-H,S=se-R,Ul[0]=se-(R+S)+(S-H),O=q+R,S=O-q,U=q-(O-S)+(R-S),R=U-re,S=U-R,Ul[1]=U-(R+S)+(S-re),ee=O+R,S=ee-O,Ul[2]=O-(ee-S)+(R-S),Ul[3]=ee;let Ke=W2(4,Ul),Ce=H2*f;if(Ke>=Ce||-Ke>=Ce||(S=o-ve,a=o-(ve+S)+(S-l),S=t-Oe,b=t-(Oe+S)+(S-l),S=e-ne,_=e-(ne+S)+(S-u),S=n-ye,k=n-(ye+S)+(S-u),a===0&&_===0&&b===0&&k===0)||(Ce=X2*f+G2*Math.abs(Ke),Ke+=ve*k+ye*a-(ne*b+Oe*_),Ke>=Ce||-Ke>=Ce))return Ke;q=a*ye,I=Cr*a,P=I-(I-a),D=a-P,I=Cr*ye,B=I-(I-ye),z=ye-B,se=D*z-(q-P*B-D*B-P*z),re=_*Oe,I=Cr*_,P=I-(I-_),D=_-P,I=Cr*Oe,B=I-(I-Oe),z=Oe-B,H=D*z-(re-P*B-D*B-P*z),R=se-H,S=se-R,Ur[0]=se-(R+S)+(S-H),O=q+R,S=O-q,U=q-(O-S)+(R-S),R=U-re,S=U-R,Ur[1]=U-(R+S)+(S-re),ee=O+R,S=ee-O,Ur[2]=O-(ee-S)+(R-S),Ur[3]=ee;const et=Kf(4,Ul,4,Ur,h_);q=ve*k,I=Cr*ve,P=I-(I-ve),D=ve-P,I=Cr*k,B=I-(I-k),z=k-B,se=D*z-(q-P*B-D*B-P*z),re=ne*b,I=Cr*ne,P=I-(I-ne),D=ne-P,I=Cr*b,B=I-(I-b),z=b-B,H=D*z-(re-P*B-D*B-P*z),R=se-H,S=se-R,Ur[0]=se-(R+S)+(S-H),O=q+R,S=O-q,U=q-(O-S)+(R-S),R=U-re,S=U-R,Ur[1]=U-(R+S)+(S-re),ee=O+R,S=ee-O,Ur[2]=O-(ee-S)+(R-S),Ur[3]=ee;const bt=Kf(et,h_,4,Ur,d_);q=a*k,I=Cr*a,P=I-(I-a),D=a-P,I=Cr*k,B=I-(I-k),z=k-B,se=D*z-(q-P*B-D*B-P*z),re=_*b,I=Cr*_,P=I-(I-_),D=_-P,I=Cr*b,B=I-(I-b),z=b-B,H=D*z-(re-P*B-D*B-P*z),R=se-H,S=se-R,Ur[0]=se-(R+S)+(S-H),O=q+R,S=O-q,U=q-(O-S)+(R-S),R=U-re,S=U-R,Ur[1]=U-(R+S)+(S-re),ee=O+R,S=ee-O,Ur[2]=O-(ee-S)+(R-S),Ur[3]=ee;const pt=Kf(bt,d_,4,Ur,f_);return f_[pt-1]}function J2(o,e,t,n,l,u){const f=(e-u)*(t-l),a=(o-l)*(n-u),_=f-a,b=Math.abs(f+a);return Math.abs(_)>=$2*b?_:-K2(o,e,t,n,l,u,b)}const lu=(o,e)=>o.ll.x<=e.x&&e.x<=o.ur.x&&o.ll.y<=e.y&&e.y<=o.ur.y,yp=(o,e)=>{if(e.ur.x<o.ll.x||o.ur.x<e.ll.x||e.ur.y<o.ll.y||o.ur.y<e.ll.y)return null;const t=o.ll.x<e.ll.x?e.ll.x:o.ll.x,n=o.ur.x<e.ur.x?o.ur.x:e.ur.x,l=o.ll.y<e.ll.y?e.ll.y:o.ll.y,u=o.ur.y<e.ur.y?o.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:n,y:u}}};let Ys=Number.EPSILON;Ys===void 0&&(Ys=Math.pow(2,-52));const Y2=Ys*Ys,p_=(o,e)=>{if(-Ys<o&&o<Ys&&-Ys<e&&e<Ys)return 0;const t=o-e;return t*t<Y2*o*e?0:o<e?-1:1};class Q2{constructor(){this.reset()}reset(){this.xRounder=new m_,this.yRounder=new m_}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class m_{constructor(){this.tree=new Up,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&p_(t.key,n.key)===0)return this.tree.remove(e),n.key;const l=this.tree.next(t);return l!==null&&p_(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const Bu=new Q2,hd=(o,e)=>o.x*e.y-o.y*e.x,R0=(o,e)=>o.x*e.x+o.y*e.y,g_=(o,e,t)=>{const n=J2(o.x,o.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},xd=o=>Math.sqrt(R0(o,o)),ek=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return hd(l,n)/xd(l)/xd(n)},tk=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return R0(l,n)/xd(l)/xd(n)},__=(o,e,t)=>e.y===0?null:{x:o.x+e.x/e.y*(t-o.y),y:t},y_=(o,e,t)=>e.x===0?null:{x:t,y:o.y+e.y/e.x*(t-o.x)},ik=(o,e,t,n)=>{if(e.x===0)return y_(t,n,o.x);if(n.x===0)return y_(o,e,t.x);if(e.y===0)return __(t,n,o.y);if(n.y===0)return __(o,e,t.y);const l=hd(e,n);if(l==0)return null;const u={x:t.x-o.x,y:t.y-o.y},f=hd(u,e)/l,a=hd(u,n)/l,_=o.x+a*e.x,b=t.x+f*n.x,k=o.y+a*e.y,S=t.y+f*n.y,I=(_+b)/2,P=(k+S)/2;return{x:I,y:P}};class To{static compare(e,t){const n=To.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Qs.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,l=t.length;n<l;n++){const u=t[n];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&n.otherSE.point.events===u.otherSE.point.events&&n.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,n=l=>{const u=l.otherSE;t.set(l,{sine:ek(this.point,e.point,u.point),cosine:tk(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||n(l),t.has(u)||n(u);const{sine:f,cosine:a}=t.get(l),{sine:_,cosine:b}=t.get(u);return f>=0&&_>=0?a<b?1:a>b?-1:0:f<0&&_<0?a<b?-1:a>b?1:0:_<f?-1:_>f?1:0}}}let nk=0;class Qs{static compare(e,t){const n=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,f=t.rightSE.point.x;if(f<n)return 1;if(u<l)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,b=e.rightSE.point.y,k=t.rightSE.point.y;if(n<l){if(_<a&&_<b)return 1;if(_>a&&_>b)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const I=t.comparePoint(e.rightSE.point);return I!==0?I:-1}if(n>l){if(a<_&&a<k)return-1;if(a>_&&a>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const I=e.comparePoint(t.rightSE.point);return I<0?1:I>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<f){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>f){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==f){const S=b-a,I=u-n,P=k-_,D=f-l;if(S>I&&P<D)return 1;if(S<I&&P>D)return-1}return u>f?1:u<f||b<k?-1:b>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,l){this.id=++nk,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=l}static fromRing(e,t,n){let l,u,f;const a=To.comparePoints(e,t);if(a<0)l=e,u=t,f=1;else if(a>0)l=t,u=e,f=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new To(l,!0),b=new To(u,!1);return new Qs(_,b,[n],[f])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,l=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,f=t.x+u*l.x;if(e.x===f)return 0;const a=(e.x-t.x)/l.x,_=t.y+a*l.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),l=yp(t,n);if(l===null)return null;const u=this.leftSE.point,f=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,b=lu(t,a)&&this.comparePoint(a)===0,k=lu(n,u)&&e.comparePoint(u)===0,S=lu(t,_)&&this.comparePoint(_)===0,I=lu(n,f)&&e.comparePoint(f)===0;if(k&&b)return I&&!S?f:!I&&S?_:null;if(k)return S&&u.x===_.x&&u.y===_.y?null:u;if(b)return I&&f.x===a.x&&f.y===a.y?null:a;if(I&&S)return null;if(I)return f;if(S)return _;const P=ik(u,this.vector(),a,e.vector());return P===null||!lu(l,P)?null:Bu.round(P.x,P.y)}split(e){const t=[],n=e.events!==void 0,l=new To(e,!0),u=new To(e,!1),f=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new Qs(l,f,this.rings.slice(),this.windings.slice());return To.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),To.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const l=Qs.compare(t,n);if(l!==0){if(l>0){const u=t;t=n,n=u}if(t.prev===n){const u=t;t=n,n=u}for(let u=0,f=n.rings.length;u<f;u++){const a=n.rings[u],_=n.windings[u],b=t.rings.indexOf(a);b===-1?(t.rings.push(a),t.windings.push(_)):t.windings[b]+=_}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const b=this.rings[a],k=this.windings[a],S=t.indexOf(b);S===-1?(t.push(b),n.push(k)):n[S]+=k}const u=[],f=[];for(let a=0,_=t.length;a<_;a++){if(n[a]===0)continue;const b=t[a],k=b.poly;if(f.indexOf(k)===-1)if(b.isExterior)u.push(k);else{f.indexOf(k)===-1&&f.push(k);const S=u.indexOf(b.poly);S!==-1&&u.splice(S,1)}}for(let a=0,_=u.length;a<_;a++){const b=u[a].multiPoly;l.indexOf(b)===-1&&l.push(b)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Oo.type){case"union":{const n=e.length===0,l=t.length===0;this._isInResult=n!==l;break}case"intersection":{let n,l;e.length<t.length?(n=e.length,l=t.length):(n=t.length,l=e.length),this._isInResult=l===Oo.numMultiPolys&&n<l;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=l=>l.length===1&&l[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${Oo.type}`)}return this._isInResult}}class v_{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=Bu.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let f=1,a=e.length;f<a;f++){if(typeof e[f][0]!="number"||typeof e[f][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=Bu.round(e[f][0],e[f][1]);_.x===u.x&&_.y===u.y||(this.segments.push(Qs.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(Qs.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class rk{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new v_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,l=e.length;n<l;n++){const u=new v_(e[n],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,f=l.length;u<f;u++)e.push(l[u])}return e}}class b_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,l=e.length;n<l;n++){const u=new rk(e[n],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getSweepEvents();for(let u=0,f=l.length;u<f;u++)e.push(l[u])}return e}}class kd{static factory(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.isInResult()||u.ringOut)continue;let f=null,a=u.leftSE,_=u.rightSE;const b=[a],k=a.point,S=[];for(;f=a,a=_,b.push(a),a.point!==k;)for(;;){const I=a.getAvailableLinkedEvents();if(I.length===0){const B=b[0].point,z=b[b.length-1].point;throw new Error(`Unable to complete output ring starting at [${B.x}, ${B.y}]. Last matching segment found ends at [${z.x}, ${z.y}].`)}if(I.length===1){_=I[0].otherSE;break}let P=null;for(let B=0,z=S.length;B<z;B++)if(S[B].point===a.point){P=B;break}if(P!==null){const B=S.splice(P)[0],z=b.splice(B.index);z.unshift(z[0].otherSE),t.push(new kd(z.reverse()));continue}S.push({index:b.length,point:a.point});const D=a.getLeftmostComparator(f);_=I.sort(D)[0].otherSE;break}t.push(new kd(b))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let b=1,k=this.events.length-1;b<k;b++){const S=this.events[b].point,I=this.events[b+1].point;g_(S,e,I)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const n=t[0],l=t[1];g_(n,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let b=f;b!=a;b+=u)_.push([t[b].x,t[b].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const f=this.events[l];To.compare(e,f)>0&&(e=f)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class w_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class ok{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.poly)if(u.isExteriorRing())t.push(new w_(u));else{const f=u.enclosingRing();f.poly||t.push(new w_(f)),f.poly.addInterior(u)}}return t}}class sk{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qs.compare;this.queue=e,this.tree=new Up(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,f=l,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)f=this.tree.next(f),f===null?_=null:f.key.consumedBy===void 0&&(_=f.key);if(e.isLeft){let b=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(b=S),!a.isAnEndpoint(S))){const I=this._splitSafely(a,S);for(let P=0,D=I.length;P<D;P++)n.push(I[P])}}let k=null;if(_){const S=_.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!_.isAnEndpoint(S))){const I=this._splitSafely(_,S);for(let P=0,D=I.length;P<D;P++)n.push(I[P])}}if(b!==null||k!==null){let S=null;b===null?S=k:k===null?S=b:S=To.comparePoints(b,k)<=0?b:k,this.queue.remove(t.rightSE),n.push(t.rightSE);const I=t.split(S);for(let P=0,D=I.length;P<D;P++)n.push(I[P])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const b=a.getIntersection(_);if(b!==null){if(!a.isAnEndpoint(b)){const k=this._splitSafely(a,b);for(let S=0,I=k.length;S<I;S++)n.push(k[S])}if(!_.isAnEndpoint(b)){const k=this._splitSafely(_,b);for(let S=0,I=k.length;S<I;S++)n.push(k[S])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const l=e.split(t);return l.push(n),e.consumedBy===void 0&&this.tree.add(e),l}}const x_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ak=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class lk{run(e,t,n){Oo.type=e,Bu.reset();const l=[new b_(t,!0)];for(let k=0,S=n.length;k<S;k++)l.push(new b_(n[k],!1));if(Oo.numMultiPolys=l.length,Oo.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)yp(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if(Oo.type==="intersection")for(let k=0,S=l.length;k<S;k++){const I=l[k];for(let P=k+1,D=l.length;P<D;P++)if(yp(I.bbox,l[P].bbox)===null)return[]}const u=new Up(To.compare);for(let k=0,S=l.length;k<S;k++){const I=l[k].getSweepEvents();for(let P=0,D=I.length;P<D;P++)if(u.insert(I[P]),u.size>x_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const f=new sk(u);let a=u.size,_=u.pop();for(;_;){const k=_.key;if(u.size===a){const I=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${I.id} [${I.leftSE.point.x}, ${I.leftSE.point.y}] -> [${I.rightSE.point.x}, ${I.rightSE.point.y}] from queue.`)}if(u.size>x_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(f.segments.length>ak)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=f.process(k);for(let I=0,P=S.length;I<P;I++){const D=S[I];D.consumedBy===void 0&&u.insert(D)}a=u.size,_=u.pop()}Bu.reset();const b=kd.factory(f.segments);return new ok(b).getGeom()}}const Oo=new lk,ck=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("union",o,t)},uk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("intersection",o,t)},hk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("xor",o,t)},dk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("difference",o,t)};var B0={union:ck,intersection:uk,xor:hk,difference:dk};function F0(o,e,t){if(o!==null)for(var n,l,u,f,a,_,b,k=0,S=0,I,P=o.type,D=P==="FeatureCollection",B=P==="Feature",z=D?o.features.length:1,R=0;R<z;R++){b=D?o.features[R].geometry:B?o.geometry:o,I=b?b.type==="GeometryCollection":!1,a=I?b.geometries.length:1;for(var O=0;O<a;O++){var U=0,q=0;if(f=I?b.geometries[O]:b,f!==null){_=f.coordinates;var se=f.type;switch(k=0,se){case null:break;case"Point":if(e(_,S,R,U,q)===!1)return!1;S++,U++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,R,U,q)===!1)return!1;S++,se==="MultiPoint"&&U++}se==="LineString"&&U++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,R,U,q)===!1)return!1;S++}se==="MultiLineString"&&U++,se==="Polygon"&&q++}se==="Polygon"&&U++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(q=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,R,U,q)===!1)return!1;S++}q++}U++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(F0(f.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Vp(o,e){var t,n,l,u,f,a,_,b,k,S,I=0,P=o.type==="FeatureCollection",D=o.type==="Feature",B=P?o.features.length:1;for(t=0;t<B;t++){for(a=P?o.features[t].geometry:D?o.geometry:o,b=P?o.features[t].properties:D?o.properties:{},k=P?o.features[t].bbox:D?o.bbox:void 0,S=P?o.features[t].id:D?o.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,l=0;l<f;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,I,b,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,I,b,k,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],I,b,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function fk(o,e){Vp(o,function(t,n,l,u,f){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Du(t,l,{bbox:u,id:f}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var b=0;b<t.coordinates.length;b++){var k=t.coordinates[b],S={type:_,coordinates:k};if(e(Du(S,l),n,b)===!1)return!1}})}function pk(o,e={}){const t=[];if(Vp(o,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=B0.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?jp(n[0],e.properties):D0(n,e.properties)}var O0=pk;function mk(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return F0(o,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var k_=mk;function gk(o){const e=[];if(Vp(o,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=o.features[0].properties||{},n=B0.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?jp(n[0],t):D0(n,t)}var _k=gk;function yk(o){if(!o)throw new Error("geojson is required");var e=[];return fk(o,function(t){e.push(t)}),Ru(e)}var vk=yk;function S_(o,e){const t=_k(Ru([jp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),o]));if(!t)return;t.properties={isMask:!0};const n=wd(k_(o)),l=(n[2]-n[0])/360/1e3,u=n[0]<-180,f=n[2]>180,a=vk(o);if(a.features.length>1&&(u||f))for(const _ of a.features){const b=wd(k_(_));if(f&&b[0]<-180+l)for(const k of _.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&b[2]>180-l)for(const k of _.geometry.coordinates)for(const S of k)S[0]-=360-l}e(Ru([a.features.length<2?o:O0(a)??o,t]))}const T_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},id="mtlr-gc-full-geom",E_="mtlr-gc-full-geom-fill",C_="mtlr-gc-full-geom-line";function N0(o,e,t=!0,n=!0,l={},u={},f=T_){let a;const _=[];let b,k,S;function I(){if(!o.loaded){o.once("load",I);return}const z=f?f===!0?T_:f:void 0;if(!(z!=null&&z.fill)&&!(z!=null&&z.line))return;const R=o.getSource(id);if(R)R.setData(S??Ru([]));else if(S)o.addSource(id,{type:"geojson",data:S});else return;!o.getLayer(E_)&&z!=null&&z.fill&&o.addLayer({...z==null?void 0:z.fill,id:E_,type:"fill",source:id}),!o.getLayer(C_)&&z!=null&&z.line&&o.addLayer({...z==null?void 0:z.line,id:C_,type:"line",source:id})}function P(z){S=z,I()}o.on("styledata",()=>{setTimeout(()=>{S&&I()})});const D=z=>{a==null||a({type:"mapClick",coordinates:[z.lngLat.lng,z.lngLat.lat]})};function B(z=!1){if(!e)throw new Error;const R=document.createElement("div");return z&&R.classList.add("marker-interactive"),new p2({props:{displayIn:"maplibre"},target:R}),new e.Marker({element:R,offset:[1,-13]})}return{setEventHandler(z){z?(a=z,o.on("click",D)):(a=void 0,o.off("click",D))},flyTo(z,R){o.flyTo({center:z,...R?{zoom:R}:{},...l})},fitBounds(z,R,O){o.fitBounds([[z[0],z[1]],[z[2],z[3]]],{padding:R,...O?{maxZoom:O}:{},...u})},indicateReverse(z){o.getCanvasContainer().style.cursor=z?"crosshair":""},setReverseMarker(z){!e||!t||(k?z?k.setLngLat(z):(k.remove(),k=void 0):z&&(t instanceof Function?k=t(o)??void 0:(k=(typeof t=="object"?new e.Marker(t):B()).setLngLat(z).addTo(o),k.getElement().classList.add("marker-reverse"))))},setFeatures(z,R,O){for(const U of _)U.remove();if(_.length=0,P(void 0),!!e){if(R){let U=!1;if(R.geometry.type==="GeometryCollection"){const q=R.geometry.geometries.filter(se=>se.type==="Polygon"||se.type==="MultiPolygon");e:if(q.length>0){const se=O0(Ru(q.map(re=>Du(re))));if(!se)break e;S_({...R,geometry:se.geometry},P),U=!0}else{const se=R.geometry.geometries.filter(re=>re.type==="LineString"||re.type==="MultiLineString");se.length>0&&(P({...R,geometry:{type:"GeometryCollection",geometries:se}}),U=!0)}}if(!U){if(R.geometry.type==="Polygon"||R.geometry.type==="MultiPolygon")S_(R,P);else if(R.geometry.type==="LineString"||R.geometry.type==="MultiLineString"){P(R);return}}if(!O&&R.geometry.type!=="Point")return;if(t instanceof Function){const q=t(o,R);q&&_.push(q)}else t&&_.push(typeof t=="object"?new e.Marker(t):B().setLngLat(R.center).addTo(o))}if(n)for(const U of z??[]){if(U===R)continue;let q;if(n instanceof Function){if(q=n(o,U),!q)continue}else q=(typeof n=="object"?new e.Marker(n):B(!0)).setLngLat(U.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(U.place_type[0]==="reverse"?U.place_name:U.place_name.replace(/,.*/,""))).addTo(o);const se=q.getElement();se.addEventListener("click",re=>{re.stopPropagation(),a==null||a({type:"markerClick",id:U.id})}),se.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:U.id}),q.togglePopup()}),se.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:U.id}),q.togglePopup()}),_.push(q)}}},setSelectedMarker(z){b&&b.getElement().classList.toggle("marker-selected",!1),b=z>-1?_[z]:void 0,b==null||b.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const z=o.getCenter();return[o.getZoom(),z.lng,z.lat]}}}function bk(o,e,t){var n,l;class u{constructor(z,R){uo(this,"type"),uo(this,"target"),this.type=R,this.target=z}}class f extends u{constructor(z,R){super(z,"select"),uo(this,"feature"),Object.assign(this,R)}}class a extends u{constructor(z,R){super(z,"featureslisted"),uo(this,"features"),this.features=R}}class _ extends u{constructor(z,R){super(z,"featuresmarked"),uo(this,"features"),this.features=R}}class b extends u{constructor(z,R){super(z,"optionsvisibilitychange"),uo(this,"optionsVisible"),this.optionsVisible=R}}class k extends u{constructor(z,R){super(z,"pick"),uo(this,"feature"),this.feature=R}}class S extends u{constructor(z,R){super(z,"querychange"),uo(this,"query"),this.query=R}}class I extends u{constructor(z,R,O){super(z,"response"),uo(this,"url"),uo(this,"featureCollection"),this.url=R,this.featureCollection=O}}class P extends u{constructor(z,R){super(z,"reversetoggle"),uo(this,"reverse"),this.reverse=R}}class D extends o{constructor(z={}){super(),Zg(this,n),Zg(this,l),Gg(this,l,z)}onAddInt(z){const R=document.createElement("div");R.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:O,showResultMarkers:U,flyTo:q,fullGeometryStyle:se,...re}=Yn(this,l),H=typeof q=="boolean"?{}:q,ee={mapController:N0(z,e,O,U,H,H,se),flyTo:q===void 0?!0:!!q,apiKey:"",...t==null?void 0:t(z,R),...re};if(!ee.apiKey)throw new Error("no apiKey provided");return Gg(this,n,new O2({target:R,props:ee})),Yn(this,n).$on("select",ve=>{this.fire(new f(this,ve.detail))}),Yn(this,n).$on("pick",ve=>{this.fire(new k(this,ve.detail.feature))}),Yn(this,n).$on("featureslisted",ve=>{this.fire(new a(this,ve.detail.features))}),Yn(this,n).$on("featuresmarked",ve=>{this.fire(new _(this,ve.detail.features))}),Yn(this,n).$on("response",ve=>{this.fire(new I(this,ve.detail.url,ve.detail.featureCollection))}),Yn(this,n).$on("optionsvisibilitychange",ve=>{this.fire(new b(this,ve.detail.optionsVisible))}),Yn(this,n).$on("reversetoggle",ve=>{this.fire(new P(this,ve.detail.reverse))}),Yn(this,n).$on("querychange",ve=>{this.fire(new S(this,ve.detail.query))}),R}on(z,R){return super.on(z,R)}once(z,R){return super.once(z,R)}off(z,R){return super.off(z,R)}listens(z){return super.listens(z)}setOptions(z){var R;Object.assign(Yn(this,l),z);const{marker:O,showResultMarkers:U,flyTo:q,fullGeometryStyle:se,...re}=Yn(this,l);(R=Yn(this,n))==null||R.$set(re)}setQuery(z,R=!0){var O;(O=Yn(this,n))==null||O.setQuery(z,R)}clearMap(){var z;(z=Yn(this,n))==null||z.clearMap()}clearList(){var z;(z=Yn(this,n))==null||z.clearList()}setReverseMode(z){var R;(R=Yn(this,n))==null||R.$set({reverseActive:z})}focus(){var z;(z=Yn(this,n))==null||z.focus()}blur(){var z;(z=Yn(this,n))==null||z.blur()}onRemove(){var z;(z=Yn(this,n))==null||z.$destroy()}}return n=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:D,events:{SelectEvent:f,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:b,PickEvent:k,QueryChangeEvent:S,ResponseEvent:I,ReverseToggleEvent:P}}}const{MapLibreBasedGeocodingControl:yC,events:sa}=bk(Ts.Evented,mb);sa.SelectEvent;sa.FeaturesListedEvent;sa.FeaturesMarkedEvent;sa.OptionsVisibilityChangeEvent;sa.PickEvent;sa.QueryChangeEvent;sa.ResponseEvent;sa.ReverseToggleEvent;function wk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Te(e,"viewBox","0 0 14 14"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"class","svelte-en2qvf")},m(n,l){he(n,e,l),Y(e,t)},p:Pt,i:Pt,o:Pt,d(n){n&&ue(e)}}}class j0 extends Zt{constructor(e){super(),qt(this,e,null,wk,Ft,{})}}function xk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Te(e,"viewBox","0 0 30 30"),Te(e,"fill","none"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"class","svelte-d2loi5")},m(n,l){he(n,e,l),Y(e,t)},p:Pt,i:Pt,o:Pt,d(n){n&&ue(e)}}}class U0 extends Zt{constructor(e){super(),qt(this,e,null,xk,Ft,{})}}function kk(o){let e,t;return{c(){e=ce("img"),Tn(e.src,t=o[3]+"area.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!Tn(e.src,t=n[3]+"area.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Sk(o){let e,t;return{c(){e=ce("img"),Tn(e.src,t=o[3]+"reverse.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!Tn(e.src,t=n[3]+"reverse.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Tk(o){let e,t;return{c(){e=ce("img"),Tn(e.src,t=o[3]+"poi.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!Tn(e.src,t=n[3]+"poi.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Ek(o){let e,t;return{c(){e=ce("img"),Tn(e.src,t=o[3]+"postal_code.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!Tn(e.src,t=n[3]+"postal_code.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Ck(o){let e,t;return{c(){e=ce("img"),Tn(e.src,t=o[3]+"street.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!Tn(e.src,t=n[3]+"street.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Mk(o){let e,t;return{c(){e=ce("img"),Tn(e.src,t=o[3]+"road.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!Tn(e.src,t=n[3]+"road.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Ik(o){let e,t;return{c(){e=ce("img"),Tn(e.src,t=o[3]+"housenumber.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!Tn(e.src,t=n[3]+"housenumber.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Lk(o){let e,t,n,l;return{c(){e=ce("img"),Tn(e.src,t=o[5])||Te(e,"src",t),Te(e,"alt",o[4]),Te(e,"class","svelte-ltkwvy")},m(u,f){he(u,e,f),n||(l=Et(e,"error",o[14]),n=!0)},p(u,f){f&32&&!Tn(e.src,t=u[5])&&Te(e,"src",t),f&16&&Te(e,"alt",u[4])},d(u){u&&ue(e),n=!1,l()}}}function M_(o){let e,t;return{c(){e=ce("span"),t=Qe(o[6]),Te(e,"class","secondary svelte-ltkwvy")},m(n,l){he(n,e,l),Y(e,t)},p(n,l){l&64&&Ci(t,n[6])},d(n){n&&ue(e)}}}function Ak(o){let e,t,n,l,u,f,a,_,b,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,I,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],D,B,z=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",R,O,U;function q(ee,ve){return ve&1&&(t=null),ve&1&&(n=null),ve&1&&(l=null),ve&1&&(u=null),ee[5]?Lk:ee[0].address?Ik:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?Mk:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?Ck:(l==null&&(l=!!ee[0].id.startsWith("postal_code.")),l?Ek:(u==null&&(u=!!ee[0].id.startsWith("poi.")),u?Tk:ee[7]?Sk:kk))))}let se=q(o,-1),re=se(o),H=P&&M_(o);return{c(){e=ce("li"),re.c(),f=Re(),a=ce("span"),_=ce("span"),b=ce("span"),S=Qe(k),I=Re(),H&&H.c(),D=Re(),B=ce("span"),R=Qe(z),Te(b,"class","primary svelte-ltkwvy"),Te(_,"class","svelte-ltkwvy"),Te(B,"class","line2 svelte-ltkwvy"),Te(a,"class","texts svelte-ltkwvy"),Te(e,"tabindex","0"),Te(e,"data-selected",o[1]),Te(e,"class","svelte-ltkwvy"),ar(e,"selected",o[1])},m(ee,ve){he(ee,e,ve),re.m(e,null),Y(e,f),Y(e,a),Y(a,_),Y(_,b),Y(b,S),Y(_,I),H&&H.m(_,null),Y(a,D),Y(a,B),Y(B,R),O||(U=[Et(e,"mouseenter",o[12]),Et(e,"focus",o[13])],O=!0)},p(ee,[ve]){se===(se=q(ee,ve))&&re?re.p(ee,ve):(re.d(1),re=se(ee),re&&(re.c(),re.m(e,f))),ve&1&&k!==(k=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&Ci(S,k),ve&37&&(P=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),P?H?H.p(ee,ve):(H=M_(ee),H.c(),H.m(_,null)):H&&(H.d(1),H=null),ve&1&&z!==(z=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ci(R,z),ve&2&&Te(e,"data-selected",ee[1]),ve&2&&ar(e,"selected",ee[1])},i:Pt,o:Pt,d(ee){ee&&ue(e),re.d(),H&&H.d(),O=!1,an(U)}}}function Pk(o,e,t){var U;let n,l,{feature:u}=e,{selected:f=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:b}=e;const k=(U=u.properties)==null?void 0:U.categories;let S,I,P=0,D=u.place_type[0]==="reverse";function B(){I&&_.add(I),t(10,P++,P)}function z(q){ui.call(this,o,q)}function R(q){ui.call(this,o,q)}const O=()=>B();return o.$$set=q=>{"feature"in q&&t(0,u=q.feature),"selected"in q&&t(1,f=q.selected),"showPlaceType"in q&&t(2,a=q.showPlaceType),"missingIconsCache"in q&&t(9,_=q.missingIconsCache),"iconsBaseUrl"in q&&t(3,b=q.iconsBaseUrl)},o.$$.update=()=>{var q,se,re,H;if(o.$$.dirty&3640)do t(11,n--,n),t(4,S=k==null?void 0:k[n]),t(5,I=S?b+S.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!I||_.has(I)));o.$$.dirty&1&&t(6,l=((se=(q=u.properties)==null?void 0:q.categories)==null?void 0:se.join(", "))??((H=(re=u.properties)==null?void 0:re.place_type_name)==null?void 0:H[0])??u.place_type[0])},t(11,n=(k==null?void 0:k.length)??0),[u,f,a,b,S,I,l,D,B,_,P,n,z,R,O]}class zk extends Zt{constructor(e){super(),qt(this,e,Pk,Ak,Ft,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Dk(o){let e;return{c(){e=ce("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Te(e,"class","svelte-7cmwmc")},m(t,n){he(t,e,n)},p:Pt,i:Pt,o:Pt,d(t){t&&ue(e)}}}class Rk extends Zt{constructor(e){super(),qt(this,e,null,Dk,Ft,{})}}function Bk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Te(e,"viewBox","0 0 60.006 21.412"),Te(e,"width","14"),Te(e,"height","20"),Te(e,"class","svelte-en2qvf")},m(n,l){he(n,e,l),Y(e,t)},p:Pt,i:Pt,o:Pt,d(n){n&&ue(e)}}}class Fk extends Zt{constructor(e){super(),qt(this,e,null,Bk,Ft,{})}}function Ok(o){let e,t,n;return{c(){e=xs("svg"),t=xs("circle"),n=xs("path"),Te(t,"cx","4.789"),Te(t,"cy","4.787"),Te(t,"r","3.85"),Te(t,"class","svelte-1aq105l"),Te(n,"d","M12.063 12.063 7.635 7.635"),Te(n,"class","svelte-1aq105l"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"viewBox","0 0 13 13"),Te(e,"class","svelte-1aq105l")},m(l,u){he(l,e,u),Y(e,t),Y(e,n)},p:Pt,i:Pt,o:Pt,d(l){l&&ue(e)}}}class Nk extends Zt{constructor(e){super(),qt(this,e,null,Ok,Ft,{})}}function jk(o,e,t){const n=e[1],l=e[0],u=n-l;return o===n&&t?o:((o-l)%u+u)%u+l}function I_(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let cu;async function Uk(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(cu&&l.cachedLocationExpiry&&cu.time+l.cachedLocationExpiry>Date.now()){if(!cu.coords)break e;return cu.coords}let u;try{return u=await new Promise((f,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(b=>b.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(cu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const Vk=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,L_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,A_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,P_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,z_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,D_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function qk(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),f=t>0?"N":"S",a=n>0?"E":"W";let _;o=="DD"&&(_=`${l}° ${f}, ${u}° ${a}`);const b=Math.floor(l),k=Math.floor(u),S=(l-b)*60,I=(u-k)*60;if(o=="DM"){let P=R_(S,3).toFixed(3).padStart(6,"0"),D=R_(I,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&D.endsWith(".000")&&(P=P.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${b}° ${P}' ${f}, ${k}° ${D}' ${a}`}if(o=="DMS"){const P=Math.floor(S),D=Math.floor(I);let B=((S-P)*60).toFixed(1).padStart(4,"0"),z=((I-D)*60).toFixed(1).padStart(4,"0");const R=P.toString().padStart(2,"0"),O=D.toString().padStart(2,"0");B.endsWith(".0")&&z.endsWith(".0")&&(B=B.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),_=`${b}° ${R}' ${B}" ${f}, ${k}° ${O}' ${z}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function R_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function qp(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",f=null,a=[],_=!1;if(Vk.test(o))throw new Error("invalid coordinate value");if(L_.test(o))if(a=L_.exec(o),_=uu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),f="DM";else throw new Error("invalid coordinate format");else if(A_.test(o))if(a=A_.exec(o),_=uu(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),f="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(P_.test(o))if(a=P_.exec(o),_=uu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(z_.test(o))if(a=z_.exec(o),_=uu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6]/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(D_.test(o)){if(a=D_.exec(o),_=uu(a),a.filter(b=>b).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let b=/S|SOUTH/i;b.test(l)&&t>0&&(t=-1*t),b=/W|WEST/i,b.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,I;const P=/[,/;\u0020]/g,D=k.match(P);if(D==null){const R=Math.floor(o.length/2);S=k.substring(0,R).trim(),I=k.substring(R).trim()}else{let R;D.length%2==1?R=Math.floor(D.length/2):R=D.length/2-1;let O=0;if(R==0)O=k.indexOf(D[0]),S=k.substring(0,O).trim(),I=k.substring(O+1).trim();else{let U=0,q=0;for(;U<=R;)O=k.indexOf(D[U],q),q=O+1,U++;S=k.substring(0,O).trim(),I=k.substring(O+1).trim()}}const B=S.split(".");if(B.length==2&&B[1]==0&&B[1].length!=2)throw new Error("invalid coordinates format");const z=I.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(I))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:I,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:f,closeEnough:Zk,toCoordinateFormat:qk})}else throw new Error("coordinates pattern match failed")}function uu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const f=e[u],a=e[u+l],_=t.test(f)&&t.test(a),b=n.test(f)&&n.test(a),k=f==a;if(!(f==null&&a==null)){if(f==null||a==null)return!1;if(_||b||k)continue;return!1}}return!0}function B_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function Zk(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return B_(this.decimalLatitude,Number(e[0]))&&B_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Gk=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});qp.to=Gk;const Wk=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],$k={decimalLatitude:40.123,decimalLongitude:-74.123},Hk=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],Xk=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Kk(){const o=[];return Wk.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...$k})}),[...o,...Hk,...Xk]}const Jk=Kk();qp.formats=Jk.map(o=>o.verbatimCoordinates);const Yk=qp;function F_(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function O_(o){let e,t;return e=new Rk({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function N_(o){let e,t,n,l,u;return t=new Fk({}),{c(){e=ce("button"),Pe(t.$$.fragment),Te(e,"type","button"),Te(e,"title",o[9]),Te(e,"class","svelte-bz0zu3"),ar(e,"active",o[0])},m(f,a){he(f,e,a),Le(t,e,null),n=!0,l||(u=Et(e,"click",o[69]),l=!0)},p(f,a){(!n||a[0]&512)&&Te(e,"title",f[9]),(!n||a[0]&1)&&ar(e,"active",f[0])},i(f){n||(ie(t.$$.fragment,f),n=!0)},o(f){oe(t.$$.fragment,f),n=!1},d(f){f&&ue(e),Ae(t),l=!1,u()}}}function Qk(o){let e,t=[],n=new Map,l,u,f,a=Kn(o[14]);const _=b=>b[84].id+(b[84].address?","+b[84].address:"");for(let b=0;b<a.length;b+=1){let k=F_(o,a,b),S=_(k);n.set(S,t[b]=j_(S,k))}return{c(){e=ce("ul");for(let b=0;b<t.length;b+=1)t[b].c();Te(e,"class","options svelte-bz0zu3")},m(b,k){he(b,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(f=[Et(e,"mouseleave",o[73]),Et(e,"blur",o[74])],u=!0)},p(b,k){k[0]&17880064&&(a=Kn(b[14]),gi(),t=nb(t,k,_,1,b,a,n,e,ib,j_,null,F_),_i())},i(b){if(!l){for(let k=0;k<a.length;k+=1)ie(t[k]);l=!0}},o(b){for(let k=0;k<t.length;k+=1)oe(t[k]);l=!1},d(b){b&&ue(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,an(f)}}}function eS(o){let e,t,n,l,u,f;return t=new U0({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("div"),u=Qe(o[7]),Te(l,"class","svelte-bz0zu3"),Te(e,"class","no-results svelte-bz0zu3")},m(a,_){he(a,e,_),Le(t,e,null),Y(e,n),Y(e,l),Y(l,u),f=!0},p(a,_){(!f||_[0]&128)&&Ci(u,a[7])},i(a){f||(ie(t.$$.fragment,a),f=!0)},o(a){oe(t.$$.fragment,a),f=!1},d(a){a&&ue(e),Ae(t)}}}function tS(o){let e="",t;return{c(){t=Qe(e)},m(n,l){he(n,t,l)},p:Pt,i:Pt,o:Pt,d(n){n&&ue(t)}}}function iS(o){let e,t,n,l,u,f,a,_,b,k,S;return t=new U0({}),_=new j0({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("div"),u=Qe(o[6]),f=Re(),a=ce("button"),Pe(_.$$.fragment),Te(l,"class","svelte-bz0zu3"),Te(a,"class","svelte-bz0zu3"),Te(e,"class","error svelte-bz0zu3")},m(I,P){he(I,e,P),Le(t,e,null),Y(e,n),Y(e,l),Y(l,u),Y(e,f),Y(e,a),Le(_,a,null),b=!0,k||(S=Et(a,"click",o[70]),k=!0)},p(I,P){(!b||P[0]&64)&&Ci(u,I[6])},i(I){b||(ie(t.$$.fragment,I),ie(_.$$.fragment,I),b=!0)},o(I){oe(t.$$.fragment,I),oe(_.$$.fragment,I),b=!1},d(I){I&&ue(e),Ae(t),Ae(_),k=!1,S()}}}function j_(o,e){let t,n,l;function u(){return e[71](e[86])}function f(){return e[72](e[84])}return n=new zk({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",f),{key:o,first:null,c(){t=En(),Pe(n.$$.fragment),this.first=t},m(a,_){he(a,t,_),Le(n,a,_),l=!0},p(a,_){e=a;const b={};_[0]&16384&&(b.feature=e[84]),_[0]&1024&&(b.showPlaceType=e[10]),_[0]&49152&&(b.selected=e[15]===e[86]),_[0]&4096&&(b.iconsBaseUrl=e[12]),n.$set(b)},i(a){l||(ie(n.$$.fragment,a),l=!0)},o(a){oe(n.$$.fragment,a),l=!1},d(a){a&&ue(t),Ae(n,a)}}}function nS(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R,O,U,q,se,re=!1;u=new Nk({}),S=new j0({});let H=o[19]&&O_(),ee=o[5]==="button"&&N_(o);const ve=o[61].default,Oe=Bi(ve,o,o[60],null),ne=[iS,tS,eS,Qk],ye=[];function Ke(Ce,et){var bt,pt;return Ce[18]?0:Ce[16]?((bt=Ce[14])==null?void 0:bt.length)===0?2:Ce[16]&&((pt=Ce[14])!=null&&pt.length)?3:-1:1}return~(z=Ke(o))&&(R=ye[z]=ne[z](o)),{c(){e=Re(),t=ce("form"),n=ce("div"),l=ce("button"),Pe(u.$$.fragment),f=Re(),a=ce("input"),_=Re(),b=ce("div"),k=ce("button"),Pe(S.$$.fragment),I=Re(),H&&H.c(),P=Re(),ee&&ee.c(),D=Re(),Oe&&Oe.c(),B=Re(),R&&R.c(),Te(l,"class","search-button svelte-bz0zu3"),Te(l,"type","button"),Te(a,"placeholder",o[8]),Te(a,"aria-label",o[8]),Te(a,"class","svelte-bz0zu3"),Te(k,"type","button"),Te(k,"title",o[3]),Te(k,"class","svelte-bz0zu3"),Te(b,"class","clear-button-container svelte-bz0zu3"),ar(b,"displayable",o[1]!==""),Te(n,"class","input-group svelte-bz0zu3"),Te(t,"tabindex","0"),Te(t,"class",O=pd(o[2])+" svelte-bz0zu3"),ar(t,"can-collapse",o[4]&&o[1]==="")},m(Ce,et){he(Ce,e,et),he(Ce,t,et),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),o[63](a),Bn(a,o[1]),Y(n,_),Y(n,b),Y(b,k),Le(S,k,null),Y(b,I),H&&H.m(b,null),Y(n,P),ee&&ee.m(n,null),Y(n,D),Oe&&Oe.m(n,null),Y(t,B),~z&&ye[z].m(t,null),U=!0,q||(se=[Et(l,"click",o[62]),Et(a,"input",o[64]),Et(a,"focus",o[65]),Et(a,"blur",o[66]),Et(a,"keydown",o[22]),Et(a,"input",o[67]),Et(k,"click",o[68]),Et(t,"submit",Tp(o[21]))],q=!0)},p(Ce,et){(!U||et[0]&256)&&Te(a,"placeholder",Ce[8]),(!U||et[0]&256)&&Te(a,"aria-label",Ce[8]),et[0]&2&&a.value!==Ce[1]&&Bn(a,Ce[1]),(!U||et[0]&8)&&Te(k,"title",Ce[3]),Ce[19]?H?et[0]&524288&&ie(H,1):(H=O_(),H.c(),ie(H,1),H.m(b,null)):H&&(gi(),oe(H,1,1,()=>{H=null}),_i()),(!U||et[0]&2)&&ar(b,"displayable",Ce[1]!==""),Ce[5]==="button"?ee?(ee.p(Ce,et),et[0]&32&&ie(ee,1)):(ee=N_(Ce),ee.c(),ie(ee,1),ee.m(n,D)):ee&&(gi(),oe(ee,1,1,()=>{ee=null}),_i()),Oe&&Oe.p&&(!U||et[1]&536870912)&&Oi(Oe,ve,Ce,Ce[60],U?Fi(ve,Ce[60],et,null):Ni(Ce[60]),null);let bt=z;z=Ke(Ce),z===bt?~z&&ye[z].p(Ce,et):(R&&(gi(),oe(ye[bt],1,1,()=>{ye[bt]=null}),_i()),~z?(R=ye[z],R?R.p(Ce,et):(R=ye[z]=ne[z](Ce),R.c()),ie(R,1),R.m(t,null)):R=null),(!U||et[0]&4&&O!==(O=pd(Ce[2])+" svelte-bz0zu3"))&&Te(t,"class",O),(!U||et[0]&22)&&ar(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){U||(ie(re),ie(u.$$.fragment,Ce),ie(S.$$.fragment,Ce),ie(H),ie(ee),ie(Oe,Ce),ie(R),U=!0)},o(Ce){oe(re),oe(u.$$.fragment,Ce),oe(S.$$.fragment,Ce),oe(H),oe(ee),oe(Oe,Ce),oe(R),U=!1},d(Ce){Ce&&(ue(e),ue(t)),Ae(u),o[63](null),Ae(S),H&&H.d(),ee&&ee.d(),Oe&&Oe.d(Ce),~z&&ye[z].d(),q=!1,an(se)}}}function rS(o,e,t){let n,l,{$$slots:u={},$$scope:f}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:b}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:I=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:z="never"}=e,{errorMessage:R="Something went wrong…"}=e,{filter:O=()=>!0}=e,{flyTo:U=!0}=e,{fuzzyMatch:q=!0}=e,{language:se=void 0}=e,{limit:re=void 0}=e,{mapController:H=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:ve="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Oe="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:ye=z==="always"}=e,{reverseButtonTitle:Ke="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:bt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:st=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:ii=!0}=e,{types:Ot=void 0}=e,{exhaustiveReverseGeocoding:zt=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Mt=a}=e,{apiUrl:ei="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Vt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:xi=()=>{}}=e;function yi(){Ve.focus()}function Ai(){Ve.blur()}function ct(G,Ue=!0,qe=!1){t(1,Ce=G),Ue?(t(15,$e=-1),ut()):(Yt(!qe,qe),setTimeout(()=>{Ve.focus(),Ve.select()}))}function It(){t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1)}function Ne(){t(55,xt=[]),t(56,we=void 0)}let je=!1,rt,xt,we,di="",Ve,$e=-1,kt,vn=[],bn,Cn,er,tr;const Uo=new Set,Ki=ts();Qn(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function ut(G){if(Cn&&(clearTimeout(Cn),Cn=void 0),$e>-1&&rt)t(56,we=rt[$e]),t(1,Ce=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,kt=void 0),t(55,xt=void 0),t(15,$e=-1);else if(Ce){const Ue=G||!Hn(Ce);wn(Ce,{exact:!0}).then(()=>{t(55,xt=rt),t(56,we=void 0),Ue&&Lo()}).catch(qe=>t(18,kt=qe))}}function Hn(G){try{return Yk(G,6)}catch{return!1}}async function wn(G,{byId:Ue=!1,exact:qe=!1}={}){t(18,kt=void 0),bn==null||bn.abort();const Ge=new AbortController;t(19,bn=Ge);try{const Je=Hn(G),ht=new URLSearchParams;if(se!==void 0&&ht.set("language",Array.isArray(se)?se.join(","):se??""),Ot&&ht.set("types",Ot.join(",")),Jt&&ht.set("excludeTypes",String(Jt)),k&&ht.set("bbox",k.map(vi=>vi.toFixed(6)).join(",")),D&&ht.set("country",Array.isArray(D)?D.join(","):D),!Ue&&!Je){const vi=await Uk(H,ne,Ge);vi&&ht.set("proximity",vi),(qe||!pt)&&ht.set("autocomplete","false"),ht.set("fuzzyMatch",String(q))}re!==void 0&&(zt||!Je||(Ot==null?void 0:Ot.length)===1)&&ht.set("limit",String(re)),ht.set("key",b),xi(ht);const Rt=ei+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:G)+".json?"+ht.toString();if(Rt===di){Ue?(t(14,rt=void 0),t(56,we=vn[0])):t(14,rt=vn);return}di=Rt;const Xt=await fetch(Rt,{signal:Ge.signal,...Vt});if(!Xt.ok)throw new Error(await Xt.text());const ai=await Xt.json();Ki("response",{url:Rt,featureCollection:ai}),Ue?(t(14,rt=void 0),t(56,we=ai.features[0]),vn=[we]):(t(14,rt=ai.features.filter(O)),Je&&rt.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),vn=rt,Je&&Ve.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{Ge===bn&&t(19,bn=void 0)}}function Lo(){var Ge;if(!(xt!=null&&xt.length)||!U)return;const G=[180,90,-180,-90],Ue=!xt.some(Je=>!Je.matching_text);let qe;for(const Je of xt){const ht=Vi(Je);if(qe=qe===void 0?ht:ht===void 0?qe:Math.max(qe,ht),Ue||!Je.matching_text)for(const Rt of[0,1,2,3])G[Rt]=Math[Rt<2?"min":"max"](G[Rt],((Ge=Je.bbox)==null?void 0:Ge[Rt])??Je.center[Rt%2])}H&&xt.length>0&&(we&&G[0]===G[2]&&G[1]===G[3]?H.flyTo(we.center,Vi(we)):H.fitBounds(I_(G),50,qe))}function Vi(G){var qe;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Ue=G.id.replace(/\..*/,"");return(Array.isArray((qe=G.properties)==null?void 0:qe.categories)?G.properties.categories.reduce((Ge,Je)=>{const ht=Mt[Ue+"."+Je];return Ge===void 0?ht:ht===void 0?Ge:Math.max(Ge,ht)},void 0):void 0)??Mt[Ue]}function gt(G){t(0,ye=z==="always"),t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1),ct(G[1].toFixed(6)+", "+jk(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ni(G){if(!rt)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&($e===(st?0:-1)&&Ue===-1&&t(15,$e=rt.length),t(15,$e+=Ue),$e>=rt.length&&t(15,$e=-1),$e<0&&st&&t(15,$e=0),G.preventDefault())}function Yt(G=!0,Ue=!1){if(t(18,kt=void 0),pt||Ue){if(Cn&&clearTimeout(Cn),Ce.length<ee)return;const qe=Ce;Cn=window.setTimeout(()=>{wn(qe).catch(Ge=>t(18,kt=Ge))},G?B:0)}else t(14,rt=void 0),t(18,kt=void 0)}function qi(G){t(56,we=G),t(1,Ce=G.place_name),t(15,$e=-1)}const _r=()=>Ve.focus();function ti(G){Xi[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function eo(){Ce=this.value,t(1,Ce),t(13,je),t(28,I)}const ln=()=>t(13,je=!0),me=()=>t(13,je=!1),W=()=>Yt(),X=()=>{t(1,Ce=""),Ve.focus()},te=()=>t(0,ye=!ye),de=()=>t(18,kt=void 0),Me=G=>t(15,$e=G),Ie=G=>qi(G),Be=()=>{st||t(15,$e=-1)},ke=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,b=G.apiKey),"bbox"in G&&t(27,k=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,I=G.clearOnBlur),"collapsed"in G&&t(4,P=G.collapsed),"country"in G&&t(29,D=G.country),"debounceSearch"in G&&t(30,B=G.debounceSearch),"enableReverse"in G&&t(5,z=G.enableReverse),"errorMessage"in G&&t(6,R=G.errorMessage),"filter"in G&&t(31,O=G.filter),"flyTo"in G&&t(32,U=G.flyTo),"fuzzyMatch"in G&&t(33,q=G.fuzzyMatch),"language"in G&&t(34,se=G.language),"limit"in G&&t(35,re=G.limit),"mapController"in G&&t(36,H=G.mapController),"minLength"in G&&t(37,ee=G.minLength),"noResultsMessage"in G&&t(7,ve=G.noResultsMessage),"placeholder"in G&&t(8,Oe=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,ye=G.reverseActive),"reverseButtonTitle"in G&&t(9,Ke=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,bt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,st=G.selectFirst),"flyToSelected"in G&&t(41,Ht=G.flyToSelected),"markerOnSelected"in G&&t(42,ii=G.markerOnSelected),"types"in G&&t(43,Ot=G.types),"exhaustiveReverseGeocoding"in G&&t(44,zt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Mt=G.zoom),"apiUrl"in G&&t(47,ei=G.apiUrl),"fetchParameters"in G&&t(48,Vt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,xi=G.adjustUrlQuery),"$$scope"in G&&t(60,f=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ye=z==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,er=je),I&&!je&&t(1,Ce="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ce.length<ee&&(t(56,we=void 0),t(14,rt=void 0),t(18,kt=void 0),t(55,xt=rt)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&wn(we.id,{byId:!0}).catch(G=>t(18,kt=G)),o.$$.dirty[1]&100663330&&(H&&we&&we.id!==tr&&U&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?H.flyTo(we.center,Vi(we)):H.fitBounds(I_(we.bbox),50,Vi(we)),t(14,rt=void 0),t(55,xt=void 0),t(15,$e=-1)),t(57,tr=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&st&&rt!=null&&rt.length&&t(15,$e=0),o.$$.dirty[0]&2&&t(15,$e=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&xt!==rt&&t(55,xt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&H&&H.setEventHandler(G=>{switch(G.type){case"mapClick":ye&&gt(G.coordinates);break;case"markerClick":{const Ue=rt==null?void 0:rt.find(qe=>qe.id===G.id);Ue&&qi(Ue)}break;case"markerMouseEnter":xt&&t(15,$e=er?(rt==null?void 0:rt.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,$e=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=rt==null?void 0:rt[$e]),o.$$.dirty[1]&134218786&&H&&l&&U&&Ht&&H.flyTo(l.center,Vi(l)),o.$$.dirty[1]&256&&t(59,n=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ii||H==null||H.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&H&&ii&&!xt&&(H.setFeatures(l?[l]:void 0,void 0,n),H.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&H&&H.setFeatures(xt,we,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&xt&&H&&H.setSelectedMarker($e),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&H){const G=Hn(Ce);H.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ki("select",{feature:l}),o.$$.dirty[1]&33554432&&Ki("pick",{feature:we}),o.$$.dirty[0]&81920&&Ki("optionsvisibilitychange",{optionsVisible:er&&!!rt}),o.$$.dirty[0]&16384&&Ki("featureslisted",{features:rt}),o.$$.dirty[1]&16777216&&Ki("featuresmarked",{features:xt}),o.$$.dirty[0]&1&&Ki("reversetoggle",{reverse:ye}),o.$$.dirty[0]&2&&Ki("querychange",{query:Ce}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&H&&H.indicateReverse(ye)},[ye,Ce,_,S,P,z,R,ve,Oe,Ke,bt,st,hi,je,rt,$e,er,Ve,kt,bn,Uo,ut,ni,Yt,qi,a,b,k,I,D,B,O,U,q,se,re,H,ee,ne,et,pt,Ht,ii,Ot,zt,Jt,Mt,ei,Vt,xi,yi,Ai,ct,It,Ne,xt,we,tr,l,n,f,u,_r,ti,eo,ln,me,W,X,te,de,Me,Ie,Be,ke]}class oS extends Zt{constructor(e){super(),qt(this,e,rS,nS,Ft,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function U_(o){let e,t,n;return t=new oS({props:{mapController:o[2],apiKey:o[0],country:o[1],types:o[3],proximity:[{type:"map-center"}]}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"class","svelte-ixhnie")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const f={};u&4&&(f.mapController=l[2]),u&1&&(f.apiKey=l[0]),u&2&&(f.country=l[1]),t.$set(f)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function sS(o){let e,t,n=o[2]&&U_(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[2]?n?(n.p(l,u),u&4&&ie(n,1)):(n=U_(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function aS(o,e,t){let n,{apiKey:l}=e,{map:u}=e,{country:f}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(b){return b?N0(b,Qr,!0,!0,{duration:1e3},{duration:1e3}):null}return o.$$set=b=>{"apiKey"in b&&t(0,l=b.apiKey),"map"in b&&t(4,u=b.map),"country"in b&&t(1,f=b.country)},o.$$.update=()=>{o.$$.dirty&16&&t(2,n=_(u))},[l,f,n,a,u]}class lS extends Zt{constructor(e){super(),qt(this,e,aS,sS,Ft,{apiKey:0,map:4,country:1})}}const cS=Symbol.for("svelte-maplibre");function uS(){return Cd(cS)}function hS(o){return"layerType"in o&&o.layerType==="deckgl"}const dS=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),V_=o=>{var e;return{features:o[4],data:(e=o[4])==null?void 0:e[0],map:o[2],close:o[31]}};function q_(o){let e,t,n=(o[4]||o[3]instanceof Qr.Marker)&&Z_(o);return{c(){e=ce("div"),n&&n.c()},m(l,u){he(l,e,u),n&&n.m(e,null),o[32](e),t=!0},p(l,u){l[4]||l[3]instanceof Qr.Marker?n?(n.p(l,u),u[0]&24&&ie(n,1)):(n=Z_(l),n.c(),ie(n,1),n.m(e,null)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(),o[32](null)}}}function Z_(o){let e;const t=o[30].default,n=Bi(t,o,o[29],V_);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[0]&536870933)&&Oi(n,t,l,l[29],e?Fi(t,l[29],u,dS):Ni(l[29]),V_)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function fS(o){let e,t,n=o[9].default&&q_(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[9].default?n?(n.p(l,u),u[0]&512&&ie(n,1)):(n=q_(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function pS(o,e,t){let n,l,u,f,a,_,{$$slots:b={},$$scope:k}=e;const S=Jv(b);let{closeButton:I=void 0}=e,{closeOnClickOutside:P=!0}=e,{closeOnClickInside:D=!1}=e,{closeOnMove:B=!1}=e,{openOn:z="click"}=e,{openIfTopMost:R=!0}=e,{focusAfterOpen:O=!0}=e,{anchor:U=void 0}=e,{offset:q=void 0}=e,{popupClass:se=void 0}=e,{maxWidth:re=void 0}=e,{lngLat:H=void 0}=e,{html:ee=void 0}=e,{open:ve=!1}=e;const Oe=ts(),{map:ne,popupTarget:ye,layerEvent:Ke,layer:Ce,eventTopMost:et}=uS();dt(o,ne,je=>t(2,u=je)),dt(o,ye,je=>t(3,a=je)),dt(o,Ke,je=>t(28,f=je)),dt(o,Ce,je=>t(35,_=je));const bt=["click","dblclick","contextmenu"];let pt,st=!1,Ht;function ii(){if(!pt)return;let je=pt.getElement();!je||je===Ht||(Ht=je,z==="hover"&&(Ht.style.pointerEvents="none"),Ht.addEventListener("mouseenter",()=>{t(24,st=!0)},{passive:!0}),Ht.addEventListener("mouseleave",()=>{t(24,st=!1)},{passive:!0}),Ht.addEventListener("click",()=>{D&&t(0,ve=!1)},{passive:!0}))}Td(()=>{if(u)return u.on("click",Ai),u.on("contextmenu",Ai),typeof a=="string"&&(u.on("click",a,Mt),u.on("dblclick",a,Mt),u.on("contextmenu",a,Mt),u.on("mousemove",a,yi),u.on("mouseleave",a,xi),u.on("touchstart",a,Vt),u.on("touchend",a,hi)),()=>{u!=null&&u.loaded()&&(pt==null||pt.remove(),u.off("click",Ai),u.off("contextmenu",Ai),a instanceof Qr.Marker?a.getPopup()===pt&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Mt),u.off("dblclick",a,Mt),u.off("contextmenu",a,Mt),u.off("mousemove",a,yi),u.off("mouseleave",a,xi),u.off("touchstart",a,Vt),u.off("touchend",a,hi)))}});function Ot(je){return R?!("marker"in je)&&!hS(je)&&et(je)!==_:!1}let zt=null,Jt="normal";function Mt(je){je.type===z&&(Ot(je)||("layerType"in je?je.layerType==="deckgl"?(t(10,H=je.coordinate),t(4,zt=je.object?[je.object]:null)):(t(10,H=je.lngLat),t(4,zt=je.features??[])):(t(10,H=je.lngLat),t(4,zt=je.features??[])),setTimeout(()=>t(0,ve=!0))))}let ei=null;function Vt(je){ei=je.point}function hi(je){if(!ei||z!=="hover")return;let rt=ei.dist(je.point);ei=null,rt<3&&(t(10,H=je.lngLat),t(4,zt=je.features??[]),pt.isOpen()?t(25,Jt="justOpened"):(t(25,Jt="opening"),t(0,ve=!0)))}function xi(je){z!=="hover"||ei||Jt!=="normal"||(t(0,ve=!1),t(4,zt=null))}function yi(je){if(!(z!=="hover"||ei||Jt!=="normal")){if(Ot(je)){t(0,ve=!1),t(4,zt=null);return}t(0,ve=!0),t(4,zt=je.features??[]),t(10,H=je.lngLat)}}function Ai(je){if(Jt==="justOpened"){t(25,Jt="normal");return}if(!P)return;let rt=[Ht,a instanceof Qr.Marker?a==null?void 0:a.getElement():null];ve&&pt.isOpen()&&!rt.some(xt=>xt==null?void 0:xt.contains(je.originalEvent.target))&&(je.type==="contextmenu"&&z==="contextmenu"||je.type!=="contextmenu")&&t(0,ve=!1)}Qn(()=>{u&&(pt!=null&&pt.isOpen())&&pt.remove()});let ct;const It=()=>t(0,ve=!1);function Ne(je){Xi[je?"unshift":"push"](()=>{ct=je,t(1,ct)})}return o.$$set=je=>{"closeButton"in je&&t(11,I=je.closeButton),"closeOnClickOutside"in je&&t(12,P=je.closeOnClickOutside),"closeOnClickInside"in je&&t(13,D=je.closeOnClickInside),"closeOnMove"in je&&t(14,B=je.closeOnMove),"openOn"in je&&t(15,z=je.openOn),"openIfTopMost"in je&&t(16,R=je.openIfTopMost),"focusAfterOpen"in je&&t(17,O=je.focusAfterOpen),"anchor"in je&&t(18,U=je.anchor),"offset"in je&&t(19,q=je.offset),"popupClass"in je&&t(20,se=je.popupClass),"maxWidth"in je&&t(21,re=je.maxWidth),"lngLat"in je&&t(10,H=je.lngLat),"html"in je&&t(22,ee=je.html),"open"in je&&t(0,ve=je.open),"$$scope"in je&&t(29,k=je.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&t(27,n=I??(!P&&!D)),o.$$.dirty[0]&146685952&&(pt||(t(23,pt=new Qr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:B,focusAfterOpen:O,maxWidth:re,className:se,anchor:U,offset:q})),Ht=pt.getElement(),pt.on("open",()=>{t(0,ve=!0),ii(),Oe("open",pt)}),pt.on("close",()=>{t(0,ve=!1),Oe("close",pt)}),pt.on("hover",()=>{Oe("hover",pt)}))),o.$$.dirty[0]&8421384&&pt&&a instanceof Qr.Marker&&(z==="click"?a.setPopup(pt):a.getPopup()===pt&&a.setPopup(void 0)),o.$$.dirty[0]&268468224&&bt.includes(z)&&(f==null?void 0:f.type)===z&&(Mt(f),At(Ke,f=null,f)),o.$$.dirty[0]&268468224&&t(26,l=z==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),o.$$.dirty[0]&352354304&&z==="hover"&&Ke&&(l&&f&&(f.layerType==="deckgl"?(t(10,H=f.coordinate),t(4,zt=f.object?[f.object]:null)):(t(10,H=f.lngLat),t(4,zt=f.features??[]))),t(0,ve=(l||st)??!1)),o.$$.dirty[0]&12582914&&(ct?pt.setDOMContent(ct):ee&&pt.setHTML(ee)),o.$$.dirty[0]&8389632&&H&&pt.setLngLat(H),o.$$.dirty[0]&41943045&&u){let je=pt.isOpen();ve&&!je?(pt.addTo(u),Jt==="opening"&&t(25,Jt="justOpened")):!ve&&je&&pt.remove()}},[ve,ct,u,a,zt,ne,ye,Ke,Ce,S,H,I,P,D,B,z,R,O,U,q,se,re,ee,pt,st,Jt,l,n,f,k,b,It,Ne]}class mS extends Zt{constructor(e){super(),qt(this,e,pS,fS,Ft,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const gS=o=>({props:o&8}),G_=o=>({props:vS(o[3])});function _S(o){let e;const t=o[1].default,n=Bi(t,o,o[2],G_);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&12)&&Oi(n,t,l,l[2],e?Fi(t,l[2],u,gS):Ni(l[2]),G_)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function yS(o){let e,t;return e=new mS({props:{openOn:o[0],$$slots:{default:[_S,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.openOn=n[0]),l&12&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function vS(o){return o?o[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function bS(o,e,t){let{$$slots:n={},$$scope:l}=e,{openOn:u="hover"}=e;return o.$$set=f=>{"openOn"in f&&t(0,u=f.openOn),"$$scope"in f&&t(2,l=f.$$scope)},[u,n,l]}class is extends Zt{constructor(e){super(),qt(this,e,bS,yS,Ft,{openOn:0})}}const wS=["==",["geometry-type"],"Polygon"],xS=["==",["geometry-type"],"LineString"];function V0(o,e,t){let n=["match",o];for(let[l,u]of Object.entries(e))n.push(l),n.push(u);return n.push(t),n}function Xl(){return{type:"FeatureCollection",features:[]}}const kS=o=>({}),W_=o=>({}),SS=o=>({}),$_=o=>({}),TS=o=>({}),H_=o=>({});function ES(o){let e,t,n,l,u,f,a,_;const b=o[1].top,k=Bi(b,o,o[0],H_),S=o[1].left,I=Bi(S,o,o[0],$_),P=o[1].main,D=Bi(P,o,o[0],W_);return{c(){e=ce("div"),t=ce("div"),k&&k.c(),n=Re(),l=ce("div"),u=ce("div"),I&&I.c(),f=Re(),a=ce("div"),D&&D.c(),Te(t,"class","top svelte-29q570"),Te(u,"class","left svelte-29q570"),Te(a,"class","main svelte-29q570"),Te(l,"class","content svelte-29q570"),Te(e,"class","flex-container svelte-29q570")},m(B,z){he(B,e,z),Y(e,t),k&&k.m(t,null),Y(e,n),Y(e,l),Y(l,u),I&&I.m(u,null),Y(l,f),Y(l,a),D&&D.m(a,null),_=!0},p(B,[z]){k&&k.p&&(!_||z&1)&&Oi(k,b,B,B[0],_?Fi(b,B[0],z,TS):Ni(B[0]),H_),I&&I.p&&(!_||z&1)&&Oi(I,S,B,B[0],_?Fi(S,B[0],z,SS):Ni(B[0]),$_),D&&D.p&&(!_||z&1)&&Oi(D,P,B,B[0],_?Fi(P,B[0],z,kS):Ni(B[0]),W_)},i(B){_||(ie(k,B),ie(I,B),ie(D,B),_=!0)},o(B){oe(k,B),oe(I,B),oe(D,B),_=!1},d(B){B&&ue(e),k&&k.d(B),I&&I.d(B),D&&D.d(B)}}}function CS(o,e,t){let{$$slots:n={},$$scope:l}=e;return o.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,n]}class MS extends Zt{constructor(e){super(),qt(this,e,CS,ES,Ft,{})}}const IS=o=>({}),X_=o=>({}),LS=o=>({}),K_=o=>({}),AS=o=>({}),J_=o=>({});function PS(o){let e,t,n,l,u,f;const a=o[4].top,_=Bi(a,o,o[3],J_),b=o[4].sidebar,k=Bi(b,o,o[3],K_),S=o[4].map,I=Bi(S,o,o[3],X_);return{c(){e=ce("div"),_&&_.c(),t=Re(),n=ce("div"),k&&k.c(),l=Re(),u=ce("div"),I&&I.c()},m(P,D){he(P,e,D),_&&_.m(e,null),o[5](e),he(P,t,D),he(P,n,D),k&&k.m(n,null),o[6](n),he(P,l,D),he(P,u,D),I&&I.m(u,null),o[7](u),f=!0},p(P,[D]){_&&_.p&&(!f||D&8)&&Oi(_,a,P,P[3],f?Fi(a,P[3],D,AS):Ni(P[3]),J_),k&&k.p&&(!f||D&8)&&Oi(k,b,P,P[3],f?Fi(b,P[3],D,LS):Ni(P[3]),K_),I&&I.p&&(!f||D&8)&&Oi(I,S,P,P[3],f?Fi(S,P[3],D,IS):Ni(P[3]),X_)},i(P){f||(ie(_,P),ie(k,P),ie(I,P),f=!0)},o(P){oe(_,P),oe(k,P),oe(I,P),f=!1},d(P){P&&(ue(e),ue(t),ue(n),ue(l),ue(u)),_&&_.d(P),o[5](null),k&&k.d(P),o[6](null),I&&I.d(P),o[7](null)}}}function zS(o,e,t){let n,l,u;dt(o,vp,S=>t(0,n=S)),dt(o,bp,S=>t(1,l=S)),dt(o,wp,S=>t(2,u=S));let{$$slots:f={},$$scope:a}=e;function _(S){Xi[S?"unshift":"push"](()=>{n=S,vp.set(n)})}function b(S){Xi[S?"unshift":"push"](()=>{l=S,bp.set(l)})}function k(S){Xi[S?"unshift":"push"](()=>{u=S,wp.set(u)})}return o.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[n,l,u,a,f,_,b,k]}class ns extends Zt{constructor(e){super(),qt(this,e,zS,PS,Ft,{})}}let vp=wi(null),bp=wi(null),wp=wi(null);function DS(o){let e,t,n,l,u,f,a,_,b;return{c(){e=ce("label"),t=Qe(`Basemap:
  `),n=ce("select"),l=ce("option"),l.textContent="MapTiler Dataviz",u=ce("option"),u.textContent="MapTiler Streets",f=ce("option"),f.textContent="MapTiler Satellite",a=ce("option"),a.textContent="OS Open Zoomstack",l.__value="dataviz",Bn(l,l.__value),u.__value="streets-v2",Bn(u,u.__value),f.__value="hybrid",Bn(f,f.__value),a.__value="uk-openzoomstack-light",Bn(a,a.__value),o[0]===void 0&&Yl(()=>o[1].call(n))},m(k,S){he(k,e,S),Y(e,t),Y(e,n),Y(n,l),Y(n,u),Y(n,f),Y(n,a),Jl(n,o[0],!0),_||(b=Et(n,"change",o[1]),_=!0)},p(k,[S]){S&1&&Jl(n,k[0])},i:Pt,o:Pt,d(k){k&&ue(e),_=!1,b()}}}function RS(o,e,t){let n;dt(o,ap,u=>t(0,n=u));function l(){n=Cp(this),ap.set(n)}return[n,l]}class BS extends Zt{constructor(e){super(),qt(this,e,RS,DS,Ft,{})}}let dd=wi(!0);function FS(o){let e,t;return e=new Cs({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:o[0]?"none":"visible"}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.layout={visibility:n[0]?"none":"visible"}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function OS(o){let e,t;return e=new Lr({props:{data:o[1],$$slots:{default:[FS]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&5&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function NS(o,e,t){let n;return dt(o,dd,u=>t(0,n=u)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class jS extends Zt{constructor(e){super(),qt(this,e,NS,OS,Ft,{})}}function US(o){let e,t;return e=new Pd({props:{lngLat:o[0],$$slots:{default:[qS]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.lngLat=n[0]),l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function VS(o){let e,t,n;function l(f){o[3](f)}let u={draggable:!0,$$slots:{default:[ZS]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.lngLat=o[0]),e=new Pd({props:u}),Xi.push(()=>Wr(e,"lngLat",l)),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,a){const _={};a&16&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.lngLat=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function qS(o){let e,t;const n=o[2].default,l=Bi(n,o,o[4],null);return{c(){e=ce("span"),l&&l.c(),Te(e,"class","dot svelte-1gcxp27")},m(u,f){he(u,e,f),l&&l.m(e,null),t=!0},p(u,f){l&&l.p&&(!t||f&16)&&Oi(l,n,u,u[4],t?Fi(n,u[4],f,null):Ni(u[4]),null)},i(u){t||(ie(l,u),t=!0)},o(u){oe(l,u),t=!1},d(u){u&&ue(e),l&&l.d(u)}}}function ZS(o){let e,t;const n=o[2].default,l=Bi(n,o,o[4],null);return{c(){e=ce("span"),l&&l.c(),Te(e,"class","dot svelte-1gcxp27")},m(u,f){he(u,e,f),l&&l.m(e,null),t=!0},p(u,f){l&&l.p&&(!t||f&16)&&Oi(l,n,u,u[4],t?Fi(n,u[4],f,null):Ni(u[4]),null)},i(u){t||(ie(l,u),t=!0)},o(u){oe(l,u),t=!1},d(u){u&&ue(e),l&&l.d(u)}}}function GS(o){let e,t,n,l;const u=[VS,US],f=[];function a(_,b){return _[1]?0:1}return e=a(o),t=f[e]=u[e](o),{c(){t.c(),n=En()},m(_,b){f[e].m(_,b),he(_,n,b),l=!0},p(_,[b]){let k=e;e=a(_),e===k?f[e].p(_,b):(gi(),oe(f[k],1,1,()=>{f[k]=null}),_i(),t=f[e],t?t.p(_,b):(t=f[e]=u[e](_),t.c()),ie(t,1),t.m(n.parentNode,n))},i(_){l||(ie(t),l=!0)},o(_){oe(t),l=!1},d(_){_&&ue(n),f[e].d(_)}}}function WS(o,e,t){let{$$slots:n={},$$scope:l}=e,{lngLat:u}=e,{draggable:f=!1}=e;function a(_){u=_,t(0,u)}return o.$$set=_=>{"lngLat"in _&&t(0,u=_.lngLat),"draggable"in _&&t(1,f=_.draggable),"$$scope"in _&&t(4,l=_.$$scope)},[u,f,n,a,l]}class Fu extends Zt{constructor(e){super(),qt(this,e,WS,GS,Ft,{lngLat:0,draggable:1})}}const $S="/ltn/assets/help-d011708a.svg";function Y_(o){let e,t;return e=new Md({props:{$$slots:{default:[HS]},$$scope:{ctx:o}}}),e.$on("close",o[3]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function HS(o){let e,t,n;const l=o[1].default,u=Bi(l,o,o[4],null);return{c(){e=ce("h2"),e.textContent="Help",t=Re(),u&&u.c()},m(f,a){he(f,e,a),he(f,t,a),u&&u.m(f,a),n=!0},p(f,a){u&&u.p&&(!n||a&16)&&Oi(u,l,f,f[4],n?Fi(l,f[4],a,null):Ni(f[4]),null)},i(f){n||(ie(u,f),n=!0)},o(f){oe(u,f),n=!1},d(f){f&&(ue(e),ue(t)),u&&u.d(f)}}}function XS(o){let e,t,n,l,u,f,a=o[0]&&Y_(o);return{c(){e=ce("button"),e.innerHTML=`<img src="${$S}" title="Help" alt="Help"/>`,t=Re(),a&&a.c(),n=En(),Te(e,"class","svelte-gb6dzm")},m(_,b){he(_,e,b),he(_,t,b),a&&a.m(_,b),he(_,n,b),l=!0,u||(f=Et(e,"click",o[2]),u=!0)},p(_,[b]){_[0]?a?(a.p(_,b),b&1&&ie(a,1)):(a=Y_(_),a.c(),ie(a,1),a.m(n.parentNode,n)):a&&(gi(),oe(a,1,1,()=>{a=null}),_i())},i(_){l||(ie(a),l=!0)},o(_){oe(a),l=!1},d(_){_&&(ue(e),ue(t),ue(n)),a&&a.d(_),u=!1,f()}}}function KS(o,e,t){let{$$slots:n={},$$scope:l}=e,u=!1;const f=()=>t(0,u=!0),a=()=>t(0,u=!1);return o.$$set=_=>{"$$scope"in _&&t(4,l=_.$$scope)},[u,n,f,a,l]}class Zp extends Zt{constructor(e){super(),qt(this,e,KS,XS,Ft,{})}}function JS(o){let e,t,n,l;const u=o[1].default,f=Bi(u,o,o[0],null);return{c(){e=ce("a"),f&&f.c(),Te(e,"href","#")},m(a,_){he(a,e,_),f&&f.m(e,null),t=!0,n||(l=Et(e,"click",Tp(o[2])),n=!0)},p(a,[_]){f&&f.p&&(!t||_&1)&&Oi(f,u,a,a[0],t?Fi(u,a[0],_,null):Ni(a[0]),null)},i(a){t||(ie(f,a),t=!0)},o(a){oe(f,a),t=!1},d(a){a&&ue(e),f&&f.d(a),n=!1,l()}}}function YS(o,e,t){let{$$slots:n={},$$scope:l}=e;function u(f){ui.call(this,o,f)}return o.$$set=f=>{"$$scope"in f&&t(0,l=f.$$scope)},[l,n,u]}class Pi extends Zt{constructor(e){super(),qt(this,e,YS,JS,Ft,{})}}function QS(o,e){let t=new Set(o.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?o.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?o.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:e4}=Sd;function t4(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B;return P=Zy(o[8][0]),{c(){e=ce("button"),e.textContent="Stop StreetView",t=Re(),n=ce("fieldset"),l=ce("legend"),l.textContent="Source:",u=Re(),f=ce("label"),a=ce("input"),_=Qe(`
      Google Street View`),b=Re(),k=ce("label"),S=ce("input"),I=Qe(`
      Bing Streetside`),Te(e,"class","secondary"),Te(a,"type","radio"),a.__value="google",Bn(a,a.__value),Te(S,"type","radio"),S.__value="bing",Bn(S,S.__value),P.p(a,S)},m(z,R){he(z,e,R),he(z,t,R),he(z,n,R),Y(n,l),Y(n,u),Y(n,f),Y(f,a),a.checked=a.__value===o[0],Y(f,_),Y(n,b),Y(n,k),Y(k,S),S.checked=S.__value===o[0],Y(k,I),D||(B=[Et(e,"click",o[3]),Et(a,"change",o[7]),Et(S,"change",o[9])],D=!0)},p(z,R){R&1&&(a.checked=a.__value===z[0]),R&1&&(S.checked=S.__value===z[0])},d(z){z&&(ue(e),ue(t),ue(n)),P.r(),D=!1,an(B)}}}function i4(o){let e,t,n;return{c(){e=ce("button"),e.textContent="StreetView",Te(e,"class","secondary")},m(l,u){he(l,e,u),t||(n=Et(e,"click",o[2]),t=!0)},p:Pt,d(l){l&&ue(e),t=!1,n()}}}function n4(o){let e,t,n;function l(a,_){return a[1]?i4:t4}let u=l(o),f=u(o);return{c(){f.c(),e=En()},m(a,_){f.m(a,_),he(a,e,_),t||(n=Et(e4,"keydown",o[4]),t=!0)},p(a,[_]){u===(u=l(a))&&f?f.p(a,_):(f.d(1),f=u(a),f&&(f.c(),f.m(e.parentNode,e)))},i:Pt,o:Pt,d(a){a&&ue(e),f.d(a),t=!1,n()}}}function r4(o,e,t){let n;dt(o,dd,B=>t(1,n=B));let{map:l}=e,{maptilerBasemap:u}=e,f="google",a=[];function _(){At(dd,n=!1,n),l.on("click",k),l.getCanvas().style.cursor="crosshair";for(let B of QS(l,u))a.push([B,l.getPaintProperty(B,"line-color")]),l.setPaintProperty(B,"line-color","cyan")}function b(){At(dd,n=!0,n),l.off("click",k),l.getCanvas().style.cursor="inherit";for(let[B,z]of a)l.setPaintProperty(B,"line-color",z);a=[]}Qn(b);function k(B){let z=B.lngLat.lng,R=B.lngLat.lat;f=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${R},${z}&cbp=11,0,0,0,0`,"_blank"):f=="bing"&&window.open(`https://www.bing.com/maps?cp=${R}~${z}&style=x`,"_blank")}function S(B){!n&&B.key=="Escape"&&(B.stopPropagation(),b())}const I=[[]];function P(){f=this.__value,t(0,f)}function D(){f=this.__value,t(0,f)}return o.$$set=B=>{"map"in B&&t(5,l=B.map),"maptilerBasemap"in B&&t(6,u=B.maptilerBasemap)},[f,n,_,b,S,l,u,P,I,D]}class o4 extends Zt{constructor(e){super(),qt(this,e,r4,n4,Ft,{map:5,maptilerBasemap:6})}}function mn(o,e=!0){return{id:o,beforeId:s4(o),eventsIfTopMost:e}}function s4(o){let e=Ir(es);if(!e){console.warn(`getBeforeId(${o}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let l=Q_.length-1;l>=0;l--){let u=Q_[l];if(u==o){n=!0;break}e.getLayer(u)&&(t=u)}if(!n)throw new Error(`Layer ID ${o} not defined in layerZorder`);return t}let Jf=o=>o,Yf=o=>o;const Q_=[Jf(Yf("Background")),"neighbourhood-boundaries",Jf("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus",Yf("Building"),"draw-area-lines","draw-area-preview","one-ways",Yf("Road labels"),Jf("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function a4(o){return["interpolate",["linear"],["zoom"],5,.5+o,10,1+o,12,1.5+o,14,4+o,16,7+o,20,24+o]}function l4(o){let e;return{c(){e=Qe("Back")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function c4(o){let e,t,n,l;return e=new Pi({props:{$$slots:{default:[l4]},$$scope:{ctx:o}}}),e.$on("click",o[2]),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0,n||(l=Et(window,"keydown",o[1]),n=!0)},p(u,[f]){const a={};f&8&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function u4(o){let e=ts();function t(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class qu extends Zt{constructor(e){super(),qt(this,e,u4,c4,Ft,{})}}function xp(o,e,t){let n=new Set(o.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,t);if(!l)return null;if(n.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function h4(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function d4(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function f4(o){let e,t,n,l,u,f,a,_,b,k,S;return u=new Pi({props:{$$slots:{default:[h4]},$$scope:{ctx:o}}}),u.$on("click",o[10]),_=new Pi({props:{$$slots:{default:[d4]},$$scope:{ctx:o}}}),_.$on("click",o[11]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),Pe(_.$$.fragment),b=Re(),k=ce("li"),k.textContent="Use an auto-generated boundary",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(I,P){he(I,e,P),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Le(_,a,null),Y(n,b),Y(n,k),S=!0},p(I,P){const D={};P&32768&&(D.$$scope={dirty:P,ctx:I}),u.$set(D);const B={};P&32768&&(B.$$scope={dirty:P,ctx:I}),_.$set(B)},i(I){S||(ie(u.$$.fragment,I),ie(_.$$.fragment,I),S=!0)},o(I){oe(u.$$.fragment,I),oe(_.$$.fragment,I),S=!1},d(I){I&&ue(e),Ae(u),Ae(_)}}}function p4(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R;return t=new qu({}),t.$on("click",o[7]),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=Re(),f=ce("button"),f.textContent="Export to GeoJSON",a=Re(),_=ce("label"),b=Qe(`Minimum area (km²)
      `),k=ce("input"),S=Re(),I=ce("label"),P=ce("input"),D=Qe(`
      Remove areas not touching a big road`),Te(f,"class","secondary"),Te(k,"type","number"),Te(k,"min","0"),Te(k,"max","1"),Te(k,"step","0.01"),Te(P,"type","checkbox"),Te(e,"slot","sidebar")},m(O,U){he(O,e,U),Le(t,e,null),Y(e,n),Y(e,l),Y(e,u),Y(e,f),Y(e,a),Y(e,_),Y(_,b),Y(_,k),Bn(k,o[0]),Y(e,S),Y(e,I),Y(I,P),P.checked=o[1],Y(I,D),B=!0,z||(R=[Et(f,"click",o[5]),Et(k,"input",o[8]),Et(P,"change",o[9])],z=!0)},p(O,U){U&1&&Ep(k.value)!==O[0]&&Bn(k,O[0]),U&2&&(P.checked=O[1])},i(O){B||(ie(t.$$.fragment,O),B=!0)},o(O){oe(t.$$.fragment,O),B=!1},d(O){O&&ue(e),Ae(t),z=!1,an(R)}}}function m4(o){let e,t,n=o[14].area_km2.toFixed(1)+"",l,u,f,a,_,b=o[14].touches_big_road+"",k,S,I=o[14].touches_railway+"",P,D,B=o[14].touches_waterway+"",z;return{c(){e=ce("p"),t=Qe("Area: "),l=Qe(n),u=Qe(" km²"),f=Re(),a=ce("p"),_=Qe("Borders roads = "),k=Qe(b),S=Qe(", railway = "),P=Qe(I),D=Qe(`,
            water = `),z=Qe(B)},m(R,O){he(R,e,O),Y(e,t),Y(e,l),Y(e,u),he(R,f,O),he(R,a,O),Y(a,_),Y(a,k),Y(a,S),Y(a,P),Y(a,D),Y(a,z)},p(R,O){O&16384&&n!==(n=R[14].area_km2.toFixed(1)+"")&&Ci(l,n),O&16384&&b!==(b=R[14].touches_big_road+"")&&Ci(k,b),O&16384&&I!==(I=R[14].touches_railway+"")&&Ci(P,I),O&16384&&B!==(B=R[14].touches_waterway+"")&&Ci(z,B)},d(R){R&&(ue(e),ue(f),ue(a))}}}function g4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[m4,({props:n})=>({14:n}),({props:n})=>n?16384:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&49152&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function _4(o){let e,t,n,l;const u=[mn("auto-boundaries-areas"),{filter:o[6](o[0],o[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":Fa(.3,.7)}},{hoverCursor:"pointer"}];let f={$$slots:{default:[g4]},$$scope:{ctx:o}};for(let b=0;b<u.length;b+=1)f=sn(f,u[b]);e=new Cs({props:f}),e.$on("click",o[4]);const a=[mn("auto-boundaries-severances"),{filter:xS},{manageHoverState:!0},{paint:{"line-color":Fa("black","red"),"line-width":3}}];let _={};for(let b=0;b<a.length;b+=1)_=sn(_,a[b]);return n=new fo({props:_}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(b,k){Le(e,b,k),he(b,t,k),Le(n,b,k),l=!0},p(b,k){const S=k&67?Tu(u,[u[0],{filter:b[6](b[0],b[1])},u[2],u[3],u[4]]):{};k&32768&&(S.$$scope={dirty:k,ctx:b}),e.$set(S);const I={};n.$set(I)},i(b){l||(ie(e.$$.fragment,b),ie(n.$$.fragment,b),l=!0)},o(b){oe(e.$$.fragment,b),oe(n.$$.fragment,b),l=!1},d(b){b&&ue(t),Ae(e,b),Ae(n,b)}}}function y4(o){let e,t,n;return t=new Lr({props:{data:o[3],generateId:!0,$$slots:{default:[_4]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","map")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const f={};u&32771&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function v4(o){let e,t;return e=new ns({props:{$$slots:{map:[y4],sidebar:[p4],top:[f4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&32775&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function b4(o,e,t){let n,l,u;dt(o,ri,R=>t(2,n=R)),dt(o,Au,R=>t(12,l=R)),dt(o,$n,R=>t(13,u=R));let f=u.renderAutoBoundaries(),a=0,_=!0;function b(R){let O=xp(u,"What do you want to name the neighbourhood?","");if(O)try{let U={type:"Feature",properties:{},geometry:f.features[R.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(O,U),ec(),u.setCurrentNeighbourhood(O,l),At(ri,n={mode:"neighbourhood"},n)}catch(U){console.log(U),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function k(){md("auto_boundaries.geojson",JSON.stringify(f,null,"  "))}function S(R,O){let U=["all",wS,[">=",["get","area_km2"],R]];return O&&U.push(["get","touches_big_road"]),U}const I=()=>At(ri,n={mode:"network"},n);function P(){a=Ep(this.value),t(0,a)}function D(){_=this.checked,t(1,_)}return[a,_,n,f,b,k,S,I,P,D,()=>At(ri,n={mode:"title",firstLoad:!1},n),()=>At(ri,n={mode:"network"},n)]}class w4 extends Zt{constructor(e){super(),qt(this,e,b4,v4,Ft,{})}}function x4(o){let e,t,n,l,u,f;const a=[mn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:o[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let _={};for(let P=0;P<a.length;P+=1)_=sn(_,a[P]);e=new Cs({props:_});const b=[mn("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let k={};for(let P=0;P<b.length;P+=1)k=sn(k,b[P]);n=new Cs({props:k});const S=[mn("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let I={};for(let P=0;P<S.length;P+=1)I=sn(I,S[P]);return u=new fo({props:I}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment)},m(P,D){Le(e,P,D),he(P,t,D),Le(n,P,D),he(P,l,D),Le(u,P,D),f=!0},p(P,[D]){const B=D&1?Tu(a,[a[0],a[1],{layout:{visibility:P[0]=="cells"?"none":"visible"}},a[3]]):{};e.$set(B);const z={};n.$set(z);const R={};u.$set(R)},i(P){f||(ie(e.$$.fragment,P),ie(n.$$.fragment,P),ie(u.$$.fragment,P),f=!0)},o(P){oe(e.$$.fragment,P),oe(n.$$.fragment,P),oe(u.$$.fragment,P),f=!1},d(P){P&&(ue(t),ue(l)),Ae(e,P),Ae(n,P),Ae(u,P)}}}function k4(o,e,t){let n;return dt(o,bd,l=>t(0,n=l)),[n]}class Dd extends Zt{constructor(e){super(),qt(this,e,k4,x4,Ft,{})}}function S4(o){let e,t;const n=[mn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new Cs({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,[f]){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}class Rd extends Zt{constructor(e){super(),qt(this,e,null,S4,Ft,{})}}const T4=o=>({}),ey=o=>({});function ty(o){let e;const t=o[7]["line-popup"],n=Bi(t,o,o[9],ey);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&512)&&Oi(n,t,l,l[9],e?Fi(t,l[9],u,T4):Ni(l[9]),ey)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function E4(o){let e,t,n=o[0]&&ty(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=ty(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function C4(o){let e,t,n,l;const u=[mn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[2],o[4].maxShortcuts,0),"line-color":"black"}}];let f={};for(let b=0;b<u.length;b+=1)f=sn(f,u[b]);e=new fo({props:f});const a=[mn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[2],o[4].maxShortcuts,0),"line-color":o[5](o[3],o[4].maxShortcuts),"line-opacity":Fa(1,.5)}},{manageHoverState:o[0]},{hoverCursor:o[0]?"pointer":void 0}];let _={$$slots:{default:[E4]},$$scope:{ctx:o}};for(let b=0;b<a.length;b+=1)_=sn(_,a[b]);return n=new fo({props:_}),n.$on("click",o[8]),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(b,k){Le(e,b,k),he(b,t,k),Le(n,b,k),l=!0},p(b,[k]){const S=k&84?Tu(u,[u[0],u[1],{paint:{"line-width":b[6](b[2],b[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(S);const I=k&125?Tu(a,[a[0],a[1],k&124&&{paint:{"line-width":b[6](b[2],b[4].maxShortcuts,0),"line-color":b[5](b[3],b[4].maxShortcuts),"line-opacity":Fa(1,.5)}},k&1&&{manageHoverState:b[0]},k&1&&{hoverCursor:b[0]?"pointer":void 0}]):{};k&513&&(I.$$scope={dirty:k,ctx:b}),n.$set(I)},i(b){l||(ie(e.$$.fragment,b),ie(n.$$.fragment,b),l=!0)},o(b){oe(e.$$.fragment,b),oe(n.$$.fragment,b),l=!1},d(b){b&&ue(t),Ae(e,b),Ae(n,b)}}}function M4(o,e,t){let n,l;dt(o,cp,P=>t(2,n=P)),dt(o,bd,P=>t(3,l=P));let{$$slots:u={},$$scope:f}=e,a=Cd("neighbourhoodGj"),{interactive:_=!0}=e,{onClickLine:b=(P,D)=>{}}=e;function k(P,D){return P=="cells"?["get","color"]:P=="edits"?["case",["get","edited"],"grey","white"]:D<=2?Fa("white","blue"):Fa(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",D,"#A32015"],"blue")}function S(P,D,B){return!P||D<=2?a4(B):["interpolate",["linear"],["get","shortcuts"],0,5+B,D,25+B]}const I=P=>_&&b(P.detail.features[0],P.detail.event.lngLat);return o.$$set=P=>{"interactive"in P&&t(0,_=P.interactive),"onClickLine"in P&&t(1,b=P.onClickLine),"$$scope"in P&&t(9,f=P.$$scope)},[_,b,n,l,a,k,S,u,I,f]}class Zu extends Zt{constructor(e){super(),qt(this,e,M4,C4,Ft,{interactive:0,onClickLine:1})}}function I4(o){let e;const t=o[3].default,n=Bi(t,o,o[5],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&32)&&Oi(n,t,l,l[5],e?Fi(t,l[5],u,null):Ni(l[5]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function L4(o){let e,t;const n=[mn("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let l={$$slots:{default:[I4]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new S0({props:l}),e.$on("click",o[4]),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};f&32&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function A4(o){let e,t;return e=new Lr({props:{data:o[0],generateId:!0,$$slots:{default:[L4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&32&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function P4(o,e,t){let n,l,u;dt(o,$n,b=>t(1,l=b)),dt(o,vs,b=>t(2,u=b));let{$$slots:f={},$$scope:a}=e;function _(b){ui.call(this,o,b)}return o.$$set=b=>{"$$scope"in b&&t(5,a=b.$$scope)},o.$$.update=()=>{o.$$.dirty&6&&t(0,n=u>0?l.renderModalFilters():Xl())},[n,l,u,f,_,a]}class Gu extends Zt{constructor(e){super(),qt(this,e,P4,A4,Ft,{})}}function z4(o){let e,t;const n=[mn("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new S0({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,[f]){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}class Bd extends Zt{constructor(e){super(),qt(this,e,null,z4,Ft,{})}}function D4(o){let e;const t=o[3].default,n=Bi(t,o,o[4],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16)&&Oi(n,t,l,l[4],e?Fi(t,l[4],u,null):Ni(l[4]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function R4(o){let e,t;return e=new Lr({props:{data:o[0],generateId:!0,$$slots:{default:[D4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function B4(o,e,t){let n,l;dt(o,$n,_=>t(2,l=_));let{$$slots:u={},$$scope:f}=e,{input:a=null}=e;return o.$$set=_=>{"input"in _&&t(1,a=_.input),"$$scope"in _&&t(4,f=_.$$scope)},o.$$.update=()=>{o.$$.dirty&6&&t(0,n=a||l.renderNeighbourhood()),o.$$.dirty&1&&Ed("neighbourhoodGj",n)},[n,a,l,u,f]}class Wu extends Zt{constructor(e){super(),qt(this,e,B4,R4,Ft,{input:1})}}function F4(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function O4(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function N4(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function j4(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D;return u=new Pi({props:{$$slots:{default:[F4]},$$scope:{ctx:o}}}),u.$on("click",o[4]),_=new Pi({props:{$$slots:{default:[O4]},$$scope:{ctx:o}}}),_.$on("click",o[5]),S=new Pi({props:{$$slots:{default:[N4]},$$scope:{ctx:o}}}),S.$on("click",o[6]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),Pe(_.$$.fragment),b=Re(),k=ce("li"),Pe(S.$$.fragment),I=Re(),P=ce("li"),P.textContent="Debug mode",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(B,z){he(B,e,z),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Le(_,a,null),Y(n,b),Y(n,k),Le(S,k,null),Y(n,I),Y(n,P),D=!0},p(B,z){const R={};z&256&&(R.$$scope={dirty:z,ctx:B}),u.$set(R);const O={};z&256&&(O.$$scope={dirty:z,ctx:B}),_.$set(O);const U={};z&256&&(U.$$scope={dirty:z,ctx:B}),S.$set(U)},i(B){D||(ie(u.$$.fragment,B),ie(_.$$.fragment,B),ie(S.$$.fragment,B),D=!0)},o(B){oe(u.$$.fragment,B),oe(_.$$.fragment,B),oe(S.$$.fragment,B),D=!1},d(B){B&&ue(e),Ae(u),Ae(_),Ae(S)}}}function U4(o){let e,t,n;return t=new qu({}),t.$on("click",o[3]),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","sidebar")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p:Pt,i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function V4(o){let e,t;return e=new Id({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function q4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[V4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function Z4(o){let e,t;return e=new Id({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function G4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[Z4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function W4(o){let e,t;return e=new Id({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function $4(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[W4,({props:l})=>({7:l}),({props:l})=>l?128:0]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const f={};u&384&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function H4(o){let e,t,n,l,u,f,a,_,b,k,S,I;e=new Rd({}),n=new Dd({}),u=new Bd({});const P=[mn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let D={$$slots:{default:[q4]},$$scope:{ctx:o}};for(let R=0;R<P.length;R+=1)D=sn(D,P[R]);a=new Fp({props:D});const B=[mn("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let z={$$slots:{default:[G4]},$$scope:{ctx:o}};for(let R=0;R<B.length;R+=1)z=sn(z,B[R]);return b=new fo({props:z}),S=new Zu({props:{interactive:!0,onClickLine:o[2],$$slots:{"line-popup":[$4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),Pe(a.$$.fragment),_=Re(),Pe(b.$$.fragment),k=Re(),Pe(S.$$.fragment)},m(R,O){Le(e,R,O),he(R,t,O),Le(n,R,O),he(R,l,O),Le(u,R,O),he(R,f,O),Le(a,R,O),he(R,_,O),Le(b,R,O),he(R,k,O),Le(S,R,O),I=!0},p(R,O){const U={};O&256&&(U.$$scope={dirty:O,ctx:R}),a.$set(U);const q={};O&256&&(q.$$scope={dirty:O,ctx:R}),b.$set(q);const se={};O&256&&(se.$$scope={dirty:O,ctx:R}),S.$set(se)},i(R){I||(ie(e.$$.fragment,R),ie(n.$$.fragment,R),ie(u.$$.fragment,R),ie(a.$$.fragment,R),ie(b.$$.fragment,R),ie(S.$$.fragment,R),I=!0)},o(R){oe(e.$$.fragment,R),oe(n.$$.fragment,R),oe(u.$$.fragment,R),oe(a.$$.fragment,R),oe(b.$$.fragment,R),oe(S.$$.fragment,R),I=!1},d(R){R&&(ue(t),ue(l),ue(f),ue(_),ue(k)),Ae(e,R),Ae(n,R),Ae(u,R),Ae(a,R),Ae(b,R),Ae(S,R)}}}function X4(o){let e,t;return e=new Id({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function K4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[X4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function J4(o){let e,t;const n=[mn("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let l={$$slots:{default:[K4]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new Fp({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};f&256&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function Y4(o){let e,t,n,l,u;return t=new Wu({props:{$$slots:{default:[H4]},$$scope:{ctx:o}}}),l=new Lr({props:{data:gr(o[0]).renderModalFilters(),generateId:!0,$$slots:{default:[J4]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),Te(e,"slot","map")},m(f,a){he(f,e,a),Le(t,e,null),Y(e,n),Le(l,e,null),u=!0},p(f,a){const _={};a&256&&(_.$$scope={dirty:a,ctx:f}),t.$set(_);const b={};a&1&&(b.data=gr(f[0]).renderModalFilters()),a&256&&(b.$$scope={dirty:a,ctx:f}),l.$set(b)},i(f){u||(ie(t.$$.fragment,f),ie(l.$$.fragment,f),u=!0)},o(f){oe(t.$$.fragment,f),oe(l.$$.fragment,f),u=!1},d(f){f&&ue(e),Ae(t),Ae(l)}}}function Q4(o){let e,t;return e=new ns({props:{$$slots:{map:[Y4],sidebar:[U4],top:[j4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&259&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function e3(o,e,t){let n,l;return dt(o,$n,k=>t(0,n=k)),dt(o,ri,k=>t(1,l=k)),[n,l,(k,S)=>window.open(gr(k.properties).way,"_blank"),()=>At(ri,l={mode:"neighbourhood"},l),()=>At(ri,l={mode:"title",firstLoad:!1},l),()=>At(ri,l={mode:"network"},l),()=>At(ri,l={mode:"neighbourhood"},l)]}class t3 extends Zt{constructor(e){super(),qt(this,e,e3,Q4,Ft,{})}}var co=63710088e-1,q0={centimeters:co*100,centimetres:co*100,degrees:360/(2*Math.PI),feet:co*3.28084,inches:co*39.37,kilometers:co/1e3,kilometres:co/1e3,meters:co,metres:co,miles:co/1609.344,millimeters:co*1e3,millimetres:co*1e3,nauticalmiles:co/1852,radians:1,yards:co*1.0936};function i3(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function kp(o,e,t={}){if(!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!iy(o[0])||!iy(o[1]))throw new Error("coordinates must contain numbers");return i3({type:"Point",coordinates:o},e,t)}function n3(o,e="kilometers"){const t=q0[e];if(!t)throw new Error(e+" units is invalid");return o*t}function r3(o,e="kilometers"){const t=q0[e];if(!t)throw new Error(e+" units is invalid");return o/t}function Sp(o){return o%(2*Math.PI)*180/Math.PI}function No(o){return o%360*Math.PI/180}function iy(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Ou(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return[...o.geometry.coordinates];if(o.type==="Point")return[...o.coordinates]}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return[...o];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function o3(o){return o.type==="Feature"?o.geometry:o}function Z0(o,e,t={}){if(t.final===!0)return s3(o,e);const n=Ou(o),l=Ou(e),u=No(n[0]),f=No(l[0]),a=No(n[1]),_=No(l[1]),b=Math.sin(f-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(f-u);return Sp(Math.atan2(b,k))}function s3(o,e){let t=Z0(e,o);return t=(t+180)%360,t}function a3(o,e,t,n={}){const l=Ou(o),u=No(l[0]),f=No(l[1]),a=No(t),_=r3(e,n.units),b=Math.asin(Math.sin(f)*Math.cos(_)+Math.cos(f)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(f),Math.cos(_)-Math.sin(f)*Math.sin(b)),S=Sp(k),I=Sp(b);return kp([S,I],n.properties)}function l3(o,e,t={}){var n=Ou(o),l=Ou(e),u=No(l[1]-n[1]),f=No(l[0]-n[0]),a=No(n[1]),_=No(l[1]),b=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(a)*Math.cos(_);return n3(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)),t.units)}function c3(o,e,t={}){const l=o3(o).coordinates;let u=0;for(let f=0;f<l.length&&!(e>=u&&f===l.length-1);f++)if(u>=e){const a=e-u;if(a){const _=Z0(l[f],l[f-1])-180;return a3(l[f],a,_,t)}else return kp(l[f])}else u+=l3(l[f],l[f+1],t);return kp(l[l.length-1])}var u3=c3;function h3(o){let e,t;const n=[mn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new Fp({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function d3(o){let e,t;return e=new Lr({props:{data:o[0],$$slots:{default:[h3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&1024&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}let f3=50,p3=100,m3=.01;function g3(o,e,t){let{paths:n}=e,l=_(),u=b(),f=S(),a=setInterval(I,p3);Qn(()=>clearInterval(a));function _(){return n.features.map(P=>1/P.properties.directness).reduce((P,D)=>P+D,0)}function b(){return n.features.length==0?[]:Array.from({length:f3},k)}function k(){let P=Math.random()*l,D=0;for(let[B,z]of n.features.entries())if(D+=1/z.properties.directness,P<D)return{idx:B,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function S(){return{type:"FeatureCollection",features:u.map(({idx:P,distance:D})=>u3(n.features[P],D,{units:"kilometers"}))}}function I(){for(let[P,D]of u.entries())D.distance+=m3,D.distance>=n.features[D.idx].properties.length_meters/1e3&&(u[P]=k());t(0,f=S())}return o.$$set=P=>{"paths"in P&&t(1,n=P.paths)},o.$$.update=()=>{o.$$.dirty&2&&n&&(l=_(),u=b())},[f,n]}class _3 extends Zt{constructor(e){super(),qt(this,e,g3,d3,Ft,{paths:1})}}function ny(o,e,t){const n=o.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function ry(o){let e,t,n,l,u,f,a=o[8]+"",_,b,k,S,I;function P(){return o[3](o[7])}return{c(){e=ce("button"),t=ce("img"),l=Re(),u=ce("br"),f=Re(),_=Qe(a),b=Re(),Tn(t.src,n=`/ltn//filters/${o[7]}_icon.gif`)||Te(t,"src",n),Te(t,"width","80"),Te(t,"alt",o[8]),Te(e,"class","outline"),fn(e,"width","100%"),e.disabled=k=o[0]==o[7]},m(D,B){he(D,e,B),Y(e,t),Y(e,l),Y(e,u),Y(e,f),Y(e,_),Y(e,b),S||(I=Et(e,"click",P),S=!0)},p(D,B){o=D,B&1&&k!==(k=o[0]==o[7])&&(e.disabled=k)},d(D){D&&ue(e),S=!1,I()}}}function y3(o){let e,t,n,l,u,f,a,_,b,k,S,I,P=o[1][2]+"",D,B,z,R,O,U,q=Kn(o[2]),se=[];for(let H=0;H<q.length;H+=1)se[H]=ry(ny(o,q,H));function re(){return o[4](o[6])}return{c(){e=ce("h3"),e.textContent="Choose a modal filter to place on streets",t=Re(),n=ce("table"),l=ce("tr"),u=ce("td");for(let H=0;H<se.length;H+=1)se[H].c();f=Re(),a=ce("td"),_=ce("img"),S=Re(),I=ce("p"),D=Qe(P),B=Re(),z=ce("center"),R=ce("button"),R.textContent="Confirm",Tn(_.src,b=`/ltn//filters/${o[0]}.gif`)||Te(_,"src",b),Te(_,"height","300"),Te(_,"alt",k=o[1][1])},m(H,ee){he(H,e,ee),he(H,t,ee),he(H,n,ee),Y(n,l),Y(l,u);for(let ve=0;ve<se.length;ve+=1)se[ve]&&se[ve].m(u,null);Y(l,f),Y(l,a),Y(a,_),Y(a,S),Y(a,I),Y(I,D),he(H,B,ee),he(H,z,ee),Y(z,R),O||(U=Et(R,"click",re),O=!0)},p(H,ee){if(o=H,ee&5){q=Kn(o[2]);let ve;for(ve=0;ve<q.length;ve+=1){const Oe=ny(o,q,ve);se[ve]?se[ve].p(Oe,ee):(se[ve]=ry(Oe),se[ve].c(),se[ve].m(u,null))}for(;ve<se.length;ve+=1)se[ve].d(1);se.length=q.length}ee&1&&!Tn(_.src,b=`/ltn//filters/${o[0]}.gif`)&&Te(_,"src",b),ee&2&&k!==(k=o[1][1])&&Te(_,"alt",k),ee&2&&P!==(P=o[1][2]+"")&&Ci(D,P)},d(H){H&&(ue(e),ue(t),ue(n),ue(B),ue(z)),Ss(se,H),O=!1,U()}}}function v3(o){let e,t;return e=new Md({props:{$$slots:{default:[y3,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:o}}}),e.$on("close",o[5]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&4163&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function b3(o,e,t){let n,l;dt(o,lp,b=>t(0,l=b));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const f=b=>At(lp,l=b,l),a=b=>gr(b).close();function _(b){ui.call(this,o,b)}return o.$$.update=()=>{o.$$.dirty&1&&t(1,n=u.find(b=>b[0]==l))},[l,n,u,f,a,_]}class w3 extends Zt{constructor(e){super(),qt(this,e,b3,v3,Ft,{})}}function oy(o){let e,t;return e=new Lr({props:{data:o[0],$$slots:{default:[x3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[0]),l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function x3(o){let e,t;const n=[mn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function k3(o){let e,t,n=o[0]&&oy(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=oy(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function S3(o,e,t){let{map:n}=e,l=null;const u=ts();n.on("dragstart",f),n.on("mousemove",a),n.on("mouseup",_),Qn(()=>{n.dragPan.enable(),n.off("dragstart",f),n.off("mousemove",a),n.off("mouseup",_)});function f(){n.dragPan.disable(),t(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(b){l&&(l.geometry.coordinates.push(b.lngLat.toArray()),t(0,l))}function _(){l&&(u("done",l),t(0,l=null))}return o.$$set=b=>{"map"in b&&t(1,n=b.map)},[l,n]}class T3 extends Zt{constructor(e){super(),qt(this,e,S3,k3,Ft,{map:1})}}function E3(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function C3(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function M3(o){let e;return{c(){e=ce("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function I3(o){let e;return{c(){e=Qe("View shortcuts")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function L3(o){let e;return{c(){e=Qe("Route")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function A3(o){let e;return{c(){e=Qe("Impact routing to one destination")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function P3(o){let e;return{c(){e=Qe("Change this boundary")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function z3(o){let e;return{c(){e=Qe("Debug")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function D3(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R,O,U,q,se,re,H,ee,ve,Oe,ne,ye,Ke,Ce;return u=new Pi({props:{$$slots:{default:[E3]},$$scope:{ctx:o}}}),u.$on("click",o[28]),_=new Pi({props:{$$slots:{default:[C3]},$$scope:{ctx:o}}}),_.$on("click",o[29]),I=new Zp({props:{$$slots:{default:[M3]},$$scope:{ctx:o}}}),R=new Pi({props:{$$slots:{default:[I3]},$$scope:{ctx:o}}}),R.$on("click",o[30]),q=new Pi({props:{$$slots:{default:[L3]},$$scope:{ctx:o}}}),q.$on("click",o[31]),H=new Pi({props:{$$slots:{default:[A3]},$$scope:{ctx:o}}}),H.$on("click",o[32]),Oe=new Pi({props:{$$slots:{default:[P3]},$$scope:{ctx:o}}}),Oe.$on("click",o[33]),Ke=new Pi({props:{$$slots:{default:[z3]},$$scope:{ctx:o}}}),Ke.$on("click",o[34]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),Pe(_.$$.fragment),b=Re(),k=ce("li"),S=Qe(`Editing
          `),Pe(I.$$.fragment),P=Re(),D=ce("nav"),B=ce("ul"),z=ce("li"),Pe(R.$$.fragment),O=Re(),U=ce("li"),Pe(q.$$.fragment),se=Re(),re=ce("li"),Pe(H.$$.fragment),ee=Re(),ve=ce("li"),Pe(Oe.$$.fragment),ne=Re(),ye=ce("li"),Pe(Ke.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),fn(e,"display","flex"),fn(e,"justify-content","space-between")},m(et,bt){he(et,e,bt),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Le(_,a,null),Y(n,b),Y(n,k),Y(k,S),Le(I,k,null),Y(e,P),Y(e,D),Y(D,B),Y(B,z),Le(R,z,null),Y(B,O),Y(B,U),Le(q,U,null),Y(B,se),Y(B,re),Le(H,re,null),Y(B,ee),Y(B,ve),Le(Oe,ve,null),Y(B,ne),Y(B,ye),Le(Ke,ye,null),Ce=!0},p(et,bt){const pt={};bt[1]&128&&(pt.$$scope={dirty:bt,ctx:et}),u.$set(pt);const st={};bt[1]&128&&(st.$$scope={dirty:bt,ctx:et}),_.$set(st);const Ht={};bt[1]&128&&(Ht.$$scope={dirty:bt,ctx:et}),I.$set(Ht);const ii={};bt[1]&128&&(ii.$$scope={dirty:bt,ctx:et}),R.$set(ii);const Ot={};bt[1]&128&&(Ot.$$scope={dirty:bt,ctx:et}),q.$set(Ot);const zt={};bt[1]&128&&(zt.$$scope={dirty:bt,ctx:et}),H.$set(zt);const Jt={};bt[1]&128&&(Jt.$$scope={dirty:bt,ctx:et}),Oe.$set(Jt);const Mt={};bt[1]&128&&(Mt.$$scope={dirty:bt,ctx:et}),Ke.$set(Mt)},i(et){Ce||(ie(u.$$.fragment,et),ie(_.$$.fragment,et),ie(I.$$.fragment,et),ie(R.$$.fragment,et),ie(q.$$.fragment,et),ie(H.$$.fragment,et),ie(Oe.$$.fragment,et),ie(Ke.$$.fragment,et),Ce=!0)},o(et){oe(u.$$.fragment,et),oe(_.$$.fragment,et),oe(I.$$.fragment,et),oe(R.$$.fragment,et),oe(q.$$.fragment,et),oe(H.$$.fragment,et),oe(Oe.$$.fragment,et),oe(Ke.$$.fragment,et),Ce=!1},d(et){et&&ue(e),Ae(u),Ae(_),Ae(I),Ae(R),Ae(q),Ae(H),Ae(Oe),Ae(Ke)}}}function sy(o){let e;return{c(){e=ce("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function R3(o){let e,t,n;return{c(){e=Qe("Undo ("),t=Qe(o[4]),n=Qe(")")},m(l,u){he(l,e,u),he(l,t,u),he(l,n,u)},p(l,u){u[0]&16&&Ci(t,l[4])},d(l){l&&(ue(e),ue(t),ue(n))}}}function B3(o){let e;return{c(){e=Qe("Undo")},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function F3(o){let e,t,n;return{c(){e=Qe("Redo ("),t=Qe(o[5]),n=Qe(")")},m(l,u){he(l,e,u),he(l,t,u),he(l,n,u)},p(l,u){u[0]&32&&Ci(t,l[5])},d(l){l&&(ue(e),ue(t),ue(n))}}}function O3(o){let e;return{c(){e=Qe("Redo")},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function ay(o){let e,t;return e=new w3({}),e.$on("close",o[27]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function N3(o){let e,t,n,l,u=gr(o[6]).properties.name+"",f,a,_=o[1].area_km2.toFixed(1)+"",b,k,S,I,P,D,B,z,R,O,U,q,se,re,H,ee,ve,Oe,ne,ye,Ke,Ce,et,bt,pt,st,Ht,ii,Ot,zt,Jt,Mt,ei,Vt,hi,xi,yi,Ai,ct,It=o[8]>0&&sy();function Ne($e,kt){return $e[4]==0?B3:R3}let je=Ne(o),rt=je(o);function xt($e,kt){return $e[5]==0?O3:F3}let we=xt(o),di=we(o),Ve=o[3]&&ay(o);return{c(){e=ce("div"),t=ce("p"),n=Qe("Editing neighbourhood "),l=ce("u"),f=Qe(u),a=Qe(`
      , with an area of `),b=Qe(_),k=Qe(" km²"),S=Re(),It&&It.c(),I=Re(),P=ce("div"),D=ce("button"),B=ce("img"),R=Qe(`
        Add a modal filter`),U=Re(),q=ce("button"),se=Qe("Add many modal filters along line"),H=Re(),ee=ce("button"),ve=Qe("Reverse directions"),ne=Re(),ye=ce("button"),ye.textContent="Change modal filter type",Ke=Re(),Ce=ce("label"),et=ce("input"),bt=Qe(`
      Animate shortcuts`),pt=Re(),st=ce("label"),Ht=ce("input"),ii=Qe(`
      Include perimeter roads`),Ot=Re(),zt=ce("div"),Jt=ce("button"),rt.c(),ei=Re(),Vt=ce("button"),di.c(),xi=Re(),Ve&&Ve.c(),Tn(B.src,z=`/ltn//filters/${o[9]}_icon.gif`)||Te(B,"src",z),Te(B,"width","30"),Te(B,"alt","Add a modal filter"),D.disabled=O=o[0]=="filter",Te(D,"data-tooltip","hotkey 1"),q.disabled=re=o[0]=="freehand-filters",Te(q,"data-tooltip","hotkey 2"),ee.disabled=Oe=o[0]=="oneway",Te(ee,"data-tooltip","hotkey 3"),fn(P,"display","flex"),fn(P,"justify-content","space-between"),Te(et,"type","checkbox"),Te(Ht,"type","checkbox"),Jt.disabled=Mt=o[4]==0,Te(Jt,"data-tooltip","Ctrl+Z"),Vt.disabled=hi=o[5]==0,Te(Vt,"data-tooltip","Ctrl+Y"),fn(zt,"display","flex"),fn(zt,"justify-content","space-between"),Te(e,"slot","sidebar")},m($e,kt){he($e,e,kt),Y(e,t),Y(t,n),Y(t,l),Y(l,f),Y(t,a),Y(t,b),Y(t,k),Y(e,S),It&&It.m(e,null),Y(e,I),Y(e,P),Y(P,D),Y(D,B),Y(D,R),Y(P,U),Y(P,q),Y(q,se),Y(P,H),Y(P,ee),Y(ee,ve),Y(e,ne),Y(e,ye),Y(e,Ke),Y(e,Ce),Y(Ce,et),et.checked=o[11],Y(Ce,bt),Y(e,pt),Y(e,st),Y(st,Ht),Ht.checked=o[10],Y(st,ii),Y(e,Ot),Y(e,zt),Y(zt,Jt),rt.m(Jt,null),Y(zt,ei),Y(zt,Vt),di.m(Vt,null),Y(e,xi),Ve&&Ve.m(e,null),yi=!0,Ai||(ct=[Et(D,"click",o[21]),Et(q,"click",o[22]),Et(ee,"click",o[23]),Et(ye,"click",o[24]),Et(et,"change",o[25]),Et(Ht,"change",o[26]),Et(Ht,"change",o[13]),Et(Jt,"click",o[17]),Et(Vt,"click",o[18])],Ai=!0)},p($e,kt){(!yi||kt[0]&64)&&u!==(u=gr($e[6]).properties.name+"")&&Ci(f,u),(!yi||kt[0]&2)&&_!==(_=$e[1].area_km2.toFixed(1)+"")&&Ci(b,_),$e[8]>0?It||(It=sy(),It.c(),It.m(e,I)):It&&(It.d(1),It=null),(!yi||kt[0]&512&&!Tn(B.src,z=`/ltn//filters/${$e[9]}_icon.gif`))&&Te(B,"src",z),(!yi||kt[0]&1&&O!==(O=$e[0]=="filter"))&&(D.disabled=O),(!yi||kt[0]&1&&re!==(re=$e[0]=="freehand-filters"))&&(q.disabled=re),(!yi||kt[0]&1&&Oe!==(Oe=$e[0]=="oneway"))&&(ee.disabled=Oe),kt[0]&2048&&(et.checked=$e[11]),kt[0]&1024&&(Ht.checked=$e[10]),je===(je=Ne($e))&&rt?rt.p($e,kt):(rt.d(1),rt=je($e),rt&&(rt.c(),rt.m(Jt,null))),(!yi||kt[0]&16&&Mt!==(Mt=$e[4]==0))&&(Jt.disabled=Mt),we===(we=xt($e))&&di?di.p($e,kt):(di.d(1),di=we($e),di&&(di.c(),di.m(Vt,null))),(!yi||kt[0]&32&&hi!==(hi=$e[5]==0))&&(Vt.disabled=hi),$e[3]?Ve?(Ve.p($e,kt),kt[0]&8&&ie(Ve,1)):(Ve=ay($e),Ve.c(),ie(Ve,1),Ve.m(e,null)):Ve&&(gi(),oe(Ve,1,1,()=>{Ve=null}),_i())},i($e){yi||(ie(Ve),yi=!0)},o($e){oe(Ve),yi=!1},d($e){$e&&ue(e),It&&It.d(),rt.d(),di.d(),Ve&&Ve.d(),Ai=!1,an(ct)}}}function ly(o){let e,t=Math.round(o[37].speed_mph)+"",n,l;return{c(){e=Qe("("),n=Qe(t),l=Qe(" mph)")},m(u,f){he(u,e,f),he(u,n,f),he(u,l,f)},p(u,f){f[1]&64&&t!==(t=Math.round(u[37].speed_mph)+"")&&Ci(n,t)},d(u){u&&(ue(e),ue(n),ue(l))}}}function j3(o){let e;return{c(){e=ce("p"),e.textContent="Click to change direction"},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function U3(o){let e,t,n,l;return{c(){e=ce("div"),t=ce("img"),l=Qe(`
                Click to add modal filter`),Tn(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)||Te(t,"src",n),Te(t,"width","20"),Te(t,"alt","Add modal filter")},m(u,f){he(u,e,f),Y(e,t),Y(e,l)},p(u,f){f[0]&512&&!Tn(t.src,n=`/ltn//filters/${u[9]}_icon.gif`)&&Te(t,"src",n)},d(u){u&&ue(e)}}}function V3(o){let e,t=o[37].shortcuts+"",n,l,u=(o[37].name??"unnamed road")+"",f,a,_,b,k=o[37].speed_mph&&ly(o);function S(D,B){return D[0]=="filter"?U3:j3}let I=S(o),P=I(o);return{c(){e=ce("p"),n=Qe(t),l=Qe(" shortcuts through "),f=Qe(u),a=Re(),k&&k.c(),_=Re(),P.c(),b=En()},m(D,B){he(D,e,B),Y(e,n),Y(e,l),Y(e,f),Y(e,a),k&&k.m(e,null),he(D,_,B),P.m(D,B),he(D,b,B)},p(D,B){B[1]&64&&t!==(t=D[37].shortcuts+"")&&Ci(n,t),B[1]&64&&u!==(u=(D[37].name??"unnamed road")+"")&&Ci(f,u),D[37].speed_mph?k?k.p(D,B):(k=ly(D),k.c(),k.m(e,null)):k&&(k.d(1),k=null),I===(I=S(D))&&P?P.p(D,B):(P.d(1),P=I(D),P&&(P.c(),P.m(b.parentNode,b)))},d(D){D&&(ue(e),ue(_),ue(b)),k&&k.d(),P.d(D)}}}function q3(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[V3,({props:l})=>({37:l}),({props:l})=>[0,l?64:0]]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const f={};u[0]&513|u[1]&192&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function Z3(o){let e,t,n,l,u,f,a,_;return e=new Rd({}),n=new Dd({}),u=new Bd({}),a=new Zu({props:{interactive:o[0]=="filter"||o[0]=="oneway",onClickLine:o[14],$$slots:{"line-popup":[q3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),Pe(a.$$.fragment)},m(b,k){Le(e,b,k),he(b,t,k),Le(n,b,k),he(b,l,k),Le(u,b,k),he(b,f,k),Le(a,b,k),_=!0},p(b,k){const S={};k[0]&1&&(S.interactive=b[0]=="filter"||b[0]=="oneway"),k[0]&513|k[1]&128&&(S.$$scope={dirty:k,ctx:b}),a.$set(S)},i(b){_||(ie(e.$$.fragment,b),ie(n.$$.fragment,b),ie(u.$$.fragment,b),ie(a.$$.fragment,b),_=!0)},o(b){oe(e.$$.fragment,b),oe(n.$$.fragment,b),oe(u.$$.fragment,b),oe(a.$$.fragment,b),_=!1},d(b){b&&(ue(t),ue(l),ue(f)),Ae(e,b),Ae(n,b),Ae(u,b),Ae(a,b)}}}function cy(o){let e,t;return e=new _3({props:{paths:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l[0]&128&&(u.paths=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function G3(o){let e;return{c(){e=Qe("Click to delete")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function W3(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[G3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l[1]&128&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function uy(o){let e,t;return e=new T3({props:{map:gr(o[2])}}),e.$on("done",o[19]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l[0]&4&&(u.map=gr(n[2])),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function $3(o){let e,t,n,l,u,f,a;t=new Wu({props:{input:o[1],$$slots:{default:[Z3]},$$scope:{ctx:o}}});let _=o[11]&&cy(o);u=new Gu({props:{$$slots:{default:[W3]},$$scope:{ctx:o}}}),u.$on("click",o[15]);let b=o[0]=="freehand-filters"&&uy(o);return{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),_&&_.c(),l=Re(),Pe(u.$$.fragment),f=Re(),b&&b.c(),Te(e,"slot","map")},m(k,S){he(k,e,S),Le(t,e,null),Y(e,n),_&&_.m(e,null),Y(e,l),Le(u,e,null),Y(e,f),b&&b.m(e,null),a=!0},p(k,S){const I={};S[0]&2&&(I.input=k[1]),S[0]&513|S[1]&128&&(I.$$scope={dirty:S,ctx:k}),t.$set(I),k[11]?_?(_.p(k,S),S[0]&2048&&ie(_,1)):(_=cy(k),_.c(),ie(_,1),_.m(e,l)):_&&(gi(),oe(_,1,1,()=>{_=null}),_i());const P={};S[1]&128&&(P.$$scope={dirty:S,ctx:k}),u.$set(P),k[0]=="freehand-filters"?b?(b.p(k,S),S[0]&1&&ie(b,1)):(b=uy(k),b.c(),ie(b,1),b.m(e,null)):b&&(gi(),oe(b,1,1,()=>{b=null}),_i())},i(k){a||(ie(t.$$.fragment,k),ie(_),ie(u.$$.fragment,k),ie(b),a=!0)},o(k){oe(t.$$.fragment,k),oe(_),oe(u.$$.fragment,k),oe(b),a=!1},d(k){k&&ue(e),Ae(t),_&&_.d(),Ae(u),b&&b.d()}}}function H3(o){let e,t,n,l;return e=new ns({props:{$$slots:{map:[$3],sidebar:[N3],top:[D3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0,n||(l=Et(window,"keydown",o[16]),n=!0)},p(u,f){const a={};f[0]&8191|f[1]&128&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function X3(o,e,t){let n,l,u,f,a,_,b,k;dt(o,vs,Mt=>t(20,l=Mt)),dt(o,lp,Mt=>t(9,u=Mt)),dt(o,$n,Mt=>t(35,f=Mt)),dt(o,Au,Mt=>t(10,a=Mt)),dt(o,es,Mt=>t(2,_=Mt)),dt(o,Ag,Mt=>t(11,b=Mt)),dt(o,ri,Mt=>t(12,k=Mt));let S="filter",I=!1,P=0,D=0,B,z,R=f.getAllShortcuts();Qn(()=>{_.doubleClickZoom.enable()});function O(Mt){t(1,z=f.renderNeighbourhood()),t(6,B=z.features.find(ei=>ei.properties.kind=="boundary")),t(4,P=z.undo_length),t(5,D=z.redo_length),t(7,R=f.getAllShortcuts()),ec()}function U(){f.setCurrentNeighbourhood(B.properties.name,a),At(vs,l++,l)}function q(Mt,ei){S=="filter"?(f.addModalFilter(ei,u),At(vs,l++,l)):S=="oneway"&&(f.toggleDirection(Mt.properties.road),At(vs,l++,l))}function se(Mt){let ei=Mt.detail.features[0];f.deleteModalFilter(ei.properties.road),At(vs,l++,l)}function re(Mt){Mt.target.tagName!="INPUT"&&(Mt.ctrlKey&&Mt.key=="z"&&H(),Mt.ctrlKey&&Mt.key=="y"&&ee(),Mt.key=="1"&&t(0,S="filter"),Mt.key=="2"&&t(0,S="freehand-filters"),Mt.key=="3"&&t(0,S="oneway"))}function H(){f.undo(),At(vs,l++,l)}function ee(){f.redo(),At(vs,l++,l)}function ve(Mt){let ei=Mt.detail;ei&&(f.addManyModalFilters(ei,u),At(vs,l++,l)),t(0,S="filter")}const Oe=()=>t(0,S="filter"),ne=()=>t(0,S="freehand-filters"),ye=()=>t(0,S="oneway"),Ke=()=>t(3,I=!0);function Ce(){b=this.checked,Ag.set(b)}function et(){a=this.checked,Au.set(a)}const bt=()=>t(3,I=!1),pt=()=>At(ri,k={mode:"title",firstLoad:!1},k),st=()=>At(ri,k={mode:"network"},k),Ht=()=>At(ri,k={mode:"view-shortcuts"},k),ii=()=>At(ri,k={mode:"route",prevMode:"neighbourhood"},k),Ot=()=>At(ri,k={mode:"impact-one-destination"},k),zt=()=>At(ri,k={mode:"set-boundary",name:gr(B).properties.name,existing:B},k),Jt=()=>At(ri,k={mode:"debug"},k);return o.$$.update=()=>{o.$$.dirty[0]&5&&(S=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),o.$$.dirty[0]&1048576&&O(),o.$$.dirty[0]&2&&t(8,n=z.features.filter(Mt=>Mt.properties.kind=="cell"&&Mt.properties.cell_color=="disconnected").length)},[S,z,_,I,P,D,B,R,n,u,a,b,k,U,q,se,re,H,ee,ve,l,Oe,ne,ye,Ke,Ce,et,bt,pt,st,Ht,ii,Ot,zt,Jt]}class K3 extends Zt{constructor(e){super(),qt(this,e,X3,H3,Ft,{},null,[-1,-1])}}function J3(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function Y3(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function Q3(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function eT(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D;return u=new Pi({props:{$$slots:{default:[J3]},$$scope:{ctx:o}}}),u.$on("click",o[12]),_=new Pi({props:{$$slots:{default:[Y3]},$$scope:{ctx:o}}}),_.$on("click",o[13]),S=new Pi({props:{$$slots:{default:[Q3]},$$scope:{ctx:o}}}),S.$on("click",o[5]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),Pe(_.$$.fragment),b=Re(),k=ce("li"),Pe(S.$$.fragment),I=Re(),P=ce("li"),P.textContent="Impact routing to one destination",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(B,z){he(B,e,z),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Le(_,a,null),Y(n,b),Y(n,k),Le(S,k,null),Y(n,I),Y(n,P),D=!0},p(B,z){const R={};z&262144&&(R.$$scope={dirty:z,ctx:B}),u.$set(R);const O={};z&262144&&(O.$$scope={dirty:z,ctx:B}),_.$set(O);const U={};z&262144&&(U.$$scope={dirty:z,ctx:B}),S.$set(U)},i(B){D||(ie(u.$$.fragment,B),ie(_.$$.fragment,B),ie(S.$$.fragment,B),D=!0)},o(B){oe(u.$$.fragment,B),oe(_.$$.fragment,B),oe(S.$$.fragment,B),D=!1},d(B){B&&ue(e),Ae(u),Ae(_),Ae(S)}}}function tT(o){let e,t,n,l,u,f,a,_,b,k=o[3].highest_ratio.toFixed(1)+"",S,I;return t=new qu({}),t.$on("click",o[5]),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin aroun to change that destination.`,u=Re(),f=ce("p"),f.textContent="TODO: It's just distance right now, not time",a=Re(),_=ce("p"),b=Qe("Highest ratio is "),S=Qe(k),Te(e,"slot","sidebar")},m(P,D){he(P,e,D),Le(t,e,null),Y(e,n),Y(e,l),Y(e,u),Y(e,f),Y(e,a),Y(e,_),Y(_,b),Y(_,S),I=!0},p(P,D){(!I||D&8)&&k!==(k=P[3].highest_ratio.toFixed(1)+"")&&Ci(S,k)},i(P){I||(ie(t.$$.fragment,P),I=!0)},o(P){oe(t.$$.fragment,P),I=!1},d(P){P&&ue(e),Ae(t)}}}function iT(o){let e,t;const n=[mn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new Cs({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function nT(o){let e,t=(o[17].distance_after/o[17].distance_before).toFixed(1)+"",n;return{c(){e=Qe("Ratio "),n=Qe(t)},m(l,u){he(l,e,u),he(l,n,u)},p(l,u){u&131072&&t!==(t=(l[17].distance_after/l[17].distance_before).toFixed(1)+"")&&Ci(n,t)},d(l){l&&(ue(e),ue(n))}}}function rT(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[nT,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&393216&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function oT(o){let e,t,n;const l=[mn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",Math.max(o[3].highest_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function u(a){o[9](a)}let f={$$slots:{default:[rT]},$$scope:{ctx:o}};for(let a=0;a<l.length;a+=1)f=sn(f,l[a]);return o[0]!==void 0&&(f.hovered=o[0]),e=new fo({props:f}),Xi.push(()=>Wr(e,"hovered",u)),e.$on("click",o[10]),{c(){Pe(e.$$.fragment)},m(a,_){Le(e,a,_),n=!0},p(a,_){const b=_&8?Tu(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",Math.max(a[3].highest_ratio,1.1),"red"],"line-width":5}},l[2]]):{};_&262144&&(b.$$scope={dirty:_,ctx:a}),!t&&_&1&&(t=!0,b.hovered=a[0],Gr(()=>t=!1)),e.$set(b)},i(a){n||(ie(e.$$.fragment,a),n=!0)},o(a){oe(e.$$.fragment,a),n=!1},d(a){Ae(e,a)}}}function sT(o){let e,t;const n=[mn("compare-route"),{paint:{"line-width":10,"line-color":V0(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function aT(o){let e;return{c(){e=Qe("X")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function lT(o){let e,t,n,l,u,f,a,_,b,k,S,I;t=new Wu({props:{$$slots:{default:[iT]},$$scope:{ctx:o}}}),l=new Lr({props:{data:o[3],generateId:!0,$$slots:{default:[oT]},$$scope:{ctx:o}}}),f=new Lr({props:{data:o[2],$$slots:{default:[sT]},$$scope:{ctx:o}}}),_=new Gu({});function P(B){o[11](B)}let D={draggable:!0,$$slots:{default:[aT]},$$scope:{ctx:o}};return o[1]!==void 0&&(D.lngLat=o[1]),k=new Fu({props:D}),Xi.push(()=>Wr(k,"lngLat",P)),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),u=Re(),Pe(f.$$.fragment),a=Re(),Pe(_.$$.fragment),b=Re(),Pe(k.$$.fragment),Te(e,"slot","map")},m(B,z){he(B,e,z),Le(t,e,null),Y(e,n),Le(l,e,null),Y(e,u),Le(f,e,null),Y(e,a),Le(_,e,null),Y(e,b),Le(k,e,null),I=!0},p(B,z){const R={};z&262144&&(R.$$scope={dirty:z,ctx:B}),t.$set(R);const O={};z&8&&(O.data=B[3]),z&262153&&(O.$$scope={dirty:z,ctx:B}),l.$set(O);const U={};z&4&&(U.data=B[2]),z&262144&&(U.$$scope={dirty:z,ctx:B}),f.$set(U);const q={};z&262144&&(q.$$scope={dirty:z,ctx:B}),!S&&z&2&&(S=!0,q.lngLat=B[1],Gr(()=>S=!1)),k.$set(q)},i(B){I||(ie(t.$$.fragment,B),ie(l.$$.fragment,B),ie(f.$$.fragment,B),ie(_.$$.fragment,B),ie(k.$$.fragment,B),I=!0)},o(B){oe(t.$$.fragment,B),oe(l.$$.fragment,B),oe(f.$$.fragment,B),oe(_.$$.fragment,B),oe(k.$$.fragment,B),I=!1},d(B){B&&ue(e),Ae(t),Ae(l),Ae(f),Ae(_),Ae(k)}}}function cT(o){let e,t,n,l;return e=new y0({}),e.$on("contextmenu",o[7]),n=new ns({props:{$$slots:{map:[lT],sidebar:[tT],top:[eT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,f){Le(e,u,f),he(u,t,f),Le(n,u,f),l=!0},p(u,[f]){const a={};f&262175&&(a.$$scope={dirty:f,ctx:u}),n.$set(a)},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){oe(e.$$.fragment,u),oe(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function uT(o,e,t){let n,l,u,f,a,_,b;dt(o,sd,q=>t(1,u=q)),dt(o,ri,q=>t(4,f=q)),dt(o,Lu,q=>t(14,a=q)),dt(o,Iu,q=>t(15,_=q)),dt(o,$n,q=>t(8,b=q));function k(){At(ri,f={mode:"neighbourhood"},f)}let S=null;function I(q){return q?b.compareRoute(new Ts.LngLat(q.properties.pt1_x,q.properties.pt1_y),u,1):Xl()}function P(q){At(Iu,_=new Ts.LngLat(q.properties.pt1_x,q.properties.pt1_y),_),At(Lu,a=u,a),At(ri,f={mode:"route",prevMode:"impact-one-destination"},f)}function D(q){At(sd,u=q.detail.lngLat,u)}function B(q){S=q,t(0,S)}const z=q=>P(q.detail.features[0]);function R(q){u=q,sd.set(u)}const O=()=>At(ri,f={mode:"title",firstLoad:!1},f),U=()=>At(ri,f={mode:"network"},f);return o.$$.update=()=>{o.$$.dirty&258&&t(3,n=b.impactToOneDestination(u)),o.$$.dirty&1&&t(2,l=I(S))},[S,u,l,n,f,k,P,D,b,B,z,R,O,U]}class hT extends Zt{constructor(e){super(),qt(this,e,uT,cT,Ft,{})}}const G0="/ltn/assets/delete-ec75e756.svg",W0="/ltn/assets/edit-f3f51206.svg";function hy(o,e,t){const n=o.slice();return n[20]=e[t],n}function dT(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function fT(o){let e;return{c(){e=ce("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function pT(o){let e;return{c(){e=Qe("Route")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function mT(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B;return u=new Pi({props:{$$slots:{default:[dT]},$$scope:{ctx:o}}}),u.$on("click",o[16]),b=new Zp({props:{$$slots:{default:[fT]},$$scope:{ctx:o}}}),D=new Pi({props:{$$slots:{default:[pT]},$$scope:{ctx:o}}}),D.$on("click",o[17]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),_=Qe(`Pick neighbourhood
          `),Pe(b.$$.fragment),k=Re(),S=ce("nav"),I=ce("ul"),P=ce("li"),Pe(D.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),fn(e,"display","flex"),fn(e,"justify-content","space-between")},m(z,R){he(z,e,R),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Y(a,_),Le(b,a,null),Y(e,k),Y(e,S),Y(S,I),Y(I,P),Le(D,P,null),B=!0},p(z,R){const O={};R&8388608&&(O.$$scope={dirty:R,ctx:z}),u.$set(O);const U={};R&8388608&&(U.$$scope={dirty:R,ctx:z}),b.$set(U);const q={};R&8388608&&(q.$$scope={dirty:R,ctx:z}),D.$set(q)},i(z){B||(ie(u.$$.fragment,z),ie(b.$$.fragment,z),ie(D.$$.fragment,z),B=!0)},o(z){oe(u.$$.fragment,z),oe(b.$$.fragment,z),oe(D.$$.fragment,z),B=!1},d(z){z&&ue(e),Ae(u),Ae(b),Ae(D)}}}function gT(o){let e;return{c(){e=Qe("Draw a new boundary")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function _T(o){let e;return{c(){e=Qe("Use an auto-generated boundary")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function yT(o){let e=o[20]+"",t;return{c(){t=Qe(e)},m(n,l){he(n,t,l)},p(n,l){l&2&&e!==(e=n[20]+"")&&Ci(t,e)},d(n){n&&ue(t)}}}function dy(o){let e,t,n,l,u,f,a,_,b,k,S;function I(){return o[13](o[20])}n=new Pi({props:{$$slots:{default:[yT]},$$scope:{ctx:o}}}),n.$on("click",I);function P(){return o[14](o[20])}function D(){return o[15](o[20])}return{c(){e=ce("li"),t=ce("span"),Pe(n.$$.fragment),l=Re(),u=ce("button"),u.innerHTML=`<img src="${W0}" alt="Rename neighbourhood"/>`,f=Re(),a=ce("button"),a.innerHTML=`<img src="${G0}" alt="Delete neighbourhood"/>`,_=Re(),Te(u,"class","secondary"),Te(a,"class","secondary"),fn(t,"display","flex"),fn(t,"justify-content","space-between")},m(B,z){he(B,e,z),Y(e,t),Le(n,t,null),Y(t,l),Y(t,u),Y(t,f),Y(t,a),Y(e,_),b=!0,k||(S=[Et(u,"click",P),Et(a,"click",D)],k=!0)},p(B,z){o=B;const R={};z&8388610&&(R.$$scope={dirty:z,ctx:o}),n.$set(R)},i(B){b||(ie(n.$$.fragment,B),b=!0)},o(B){oe(n.$$.fragment,B),b=!1},d(B){B&&ue(e),Ae(n),k=!1,an(S)}}}function vT(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R,O,U,q,se;n=new Pi({props:{$$slots:{default:[gT]},$$scope:{ctx:o}}}),n.$on("click",o[7]),f=new Pi({props:{$$slots:{default:[_T]},$$scope:{ctx:o}}}),f.$on("click",o[12]);let re=Kn(o[1]),H=[];for(let ve=0;ve<re.length;ve+=1)H[ve]=dy(hy(o,re,ve));const ee=ve=>oe(H[ve],1,1,()=>{H[ve]=null});return{c(){e=ce("div"),t=ce("div"),Pe(n.$$.fragment),l=Re(),u=ce("div"),Pe(f.$$.fragment),a=Re(),_=ce("ul");for(let ve=0;ve<H.length;ve+=1)H[ve].c();b=Re(),k=ce("hr"),S=Re(),I=ce("p"),P=Qe("Current project: "),D=Qe(o[2]),B=Re(),z=ce("button"),z.textContent="Export project to GeoJSON",R=Re(),O=ce("button"),O.textContent="Debug route-snapper",Te(O,"class","secondary"),Te(e,"slot","sidebar")},m(ve,Oe){he(ve,e,Oe),Y(e,t),Le(n,t,null),Y(e,l),Y(e,u),Le(f,u,null),Y(e,a),Y(e,_);for(let ne=0;ne<H.length;ne+=1)H[ne]&&H[ne].m(_,null);Y(e,b),Y(e,k),Y(e,S),Y(e,I),Y(I,P),Y(I,D),Y(e,B),Y(e,z),Y(e,R),Y(e,O),U=!0,q||(se=[Et(z,"click",o[8]),Et(O,"click",o[9])],q=!0)},p(ve,Oe){const ne={};Oe&8388608&&(ne.$$scope={dirty:Oe,ctx:ve}),n.$set(ne);const ye={};if(Oe&8388608&&(ye.$$scope={dirty:Oe,ctx:ve}),f.$set(ye),Oe&114){re=Kn(ve[1]);let Ke;for(Ke=0;Ke<re.length;Ke+=1){const Ce=hy(ve,re,Ke);H[Ke]?(H[Ke].p(Ce,Oe),ie(H[Ke],1)):(H[Ke]=dy(Ce),H[Ke].c(),ie(H[Ke],1),H[Ke].m(_,null))}for(gi(),Ke=re.length;Ke<H.length;Ke+=1)ee(Ke);_i()}(!U||Oe&4)&&Ci(D,ve[2])},i(ve){if(!U){ie(n.$$.fragment,ve),ie(f.$$.fragment,ve);for(let Oe=0;Oe<re.length;Oe+=1)ie(H[Oe]);U=!0}},o(ve){oe(n.$$.fragment,ve),oe(f.$$.fragment,ve),H=H.filter(Boolean);for(let Oe=0;Oe<H.length;Oe+=1)oe(H[Oe]);U=!1},d(ve){ve&&ue(e),Ae(n),Ae(f),Ss(H,ve),q=!1,an(se)}}}function bT(o){let e,t=o[19].name+"",n;return{c(){e=ce("p"),n=Qe(t)},m(l,u){he(l,e,u),Y(e,n)},p(l,u){u&524288&&t!==(t=l[19].name+"")&&Ci(n,t)},d(l){l&&ue(e)}}}function wT(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[bT,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&8912896&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function xT(o){let e,t;const n=[mn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":Fa(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[wT]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new Cs({props:l}),e.$on("click",o[11]),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};f&8388608&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function kT(o){let e,t,n,l,u;return t=new Lr({props:{data:o[0],generateId:!0,$$slots:{default:[xT]},$$scope:{ctx:o}}}),l=new Gu({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),Te(e,"slot","map")},m(f,a){he(f,e,a),Le(t,e,null),Y(e,n),Le(l,e,null),u=!0},p(f,a){const _={};a&1&&(_.data=f[0]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),t.$set(_)},i(f){u||(ie(t.$$.fragment,f),ie(l.$$.fragment,f),u=!0)},o(f){oe(t.$$.fragment,f),oe(l.$$.fragment,f),u=!1},d(f){f&&ue(e),Ae(t),Ae(l)}}}function ST(o){let e,t;return e=new ns({props:{$$slots:{map:[kT],sidebar:[vT],top:[mT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&8388623&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function TT(o,e,t){let n,l,u,f,a,_;dt(o,$n,re=>t(10,u=re)),dt(o,Es,re=>t(2,f=re)),dt(o,ri,re=>t(3,a=re)),dt(o,Au,re=>t(18,_=re));function b(re){u.setCurrentNeighbourhood(re,_),At(ri,a={mode:"neighbourhood"},a)}function k(re){window.confirm(`Really delete neighbourhood ${re}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(re),ec(),t(0,n=u.toSavefile()))}function S(re){let H=xp(u,`Rename neighbourhood ${re} to what?`,re);H&&(u.renameNeighbourhoodBoundary(re,H),ec(),t(0,n=u.toSavefile()))}function I(){let re=xp(u,"What do you want to name the neighbourhood?","");re&&At(ri,a={mode:"set-boundary",name:re,existing:null},a)}function P(){md(f+".geojson",JSON.stringify(u.toSavefile()))}function D(){md("debug_route_snapper.geojson",u.toRouteSnapperGj())}const B=re=>b(gr(re.detail.features[0].properties).name),z=()=>At(ri,a={mode:"auto-boundaries"},a),R=re=>b(re),O=re=>S(re),U=re=>k(re),q=()=>At(ri,a={mode:"title",firstLoad:!1},a),se=()=>At(ri,a={mode:"route",prevMode:"network"},a);return o.$$.update=()=>{o.$$.dirty&1024&&t(0,n=u.toSavefile()),o.$$.dirty&1&&t(1,l=n.features.filter(re=>re.properties.kind=="boundary").map(re=>re.properties.name))},[n,l,f,a,b,k,S,I,P,D,u,B,z,R,O,U,q,se]}class ET extends Zt{constructor(e){super(),qt(this,e,TT,ST,Ft,{})}}function CT(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function MT(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function fy(o){let e,t,n;return t=new Pi({props:{$$slots:{default:[IT]},$$scope:{ctx:o}}}),t.$on("click",o[13]),{c(){e=ce("li"),Pe(t.$$.fragment)},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const f={};u&16384&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function IT(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function LT(o){let e,t,n,l,u,f,a,_,b,k,S,I;u=new Pi({props:{$$slots:{default:[CT]},$$scope:{ctx:o}}}),u.$on("click",o[11]),_=new Pi({props:{$$slots:{default:[MT]},$$scope:{ctx:o}}}),_.$on("click",o[12]);let P=o[0]=="neighbourhood"&&fy(o);return{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),Pe(_.$$.fragment),b=Re(),P&&P.c(),k=Re(),S=ce("li"),S.textContent="Routing",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(D,B){he(D,e,B),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Le(_,a,null),Y(n,b),P&&P.m(n,null),Y(n,k),Y(n,S),I=!0},p(D,B){const z={};B&16384&&(z.$$scope={dirty:B,ctx:D}),u.$set(z);const R={};B&16384&&(R.$$scope={dirty:B,ctx:D}),_.$set(R),D[0]=="neighbourhood"?P?(P.p(D,B),B&1&&ie(P,1)):(P=fy(D),P.c(),ie(P,1),P.m(n,k)):P&&(gi(),oe(P,1,1,()=>{P=null}),_i())},i(D){I||(ie(u.$$.fragment,D),ie(_.$$.fragment,D),ie(P),I=!0)},o(D){oe(u.$$.fragment,D),oe(_.$$.fragment,D),oe(P),I=!1},d(D){D&&ue(e),Ae(u),Ae(_),P&&P.d()}}}function AT(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R;return t=new qu({}),t.$on("click",o[6]),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent="Drag markers for a route",u=Re(),f=ce("p"),f.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,a=Re(),_=ce("label"),b=Qe("Slow-down factor for main roads: "),k=Qe(o[1]),S=Re(),I=ce("input"),P=Re(),D=ce("i"),D.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Te(I,"type","range"),Te(I,"min","1.0"),Te(I,"max","5.0"),Te(I,"step","0.1"),Te(e,"slot","sidebar")},m(O,U){he(O,e,U),Le(t,e,null),Y(e,n),Y(e,l),Y(e,u),Y(e,f),Y(e,a),Y(e,_),Y(_,b),Y(_,k),Y(_,S),Y(_,I),Bn(I,o[1]),Y(e,P),Y(e,D),B=!0,z||(R=[Et(I,"change",o[10]),Et(I,"input",o[10])],z=!0)},p(O,U){(!B||U&2)&&Ci(k,O[1]),U&2&&Bn(I,O[1])},i(O){B||(ie(t.$$.fragment,O),B=!0)},o(O){oe(t.$$.fragment,O),B=!1},d(O){O&&ue(e),Ae(t),z=!1,an(R)}}}function py(o){let e,t;return e=new Wu({props:{$$slots:{default:[PT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function PT(o){let e,t,n,l,u,f,a,_;return e=new Rd({}),n=new Dd({}),u=new Bd({}),a=new Zu({props:{interactive:!1}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),Pe(a.$$.fragment)},m(b,k){Le(e,b,k),he(b,t,k),Le(n,b,k),he(b,l,k),Le(u,b,k),he(b,f,k),Le(a,b,k),_=!0},p:Pt,i(b){_||(ie(e.$$.fragment,b),ie(n.$$.fragment,b),ie(u.$$.fragment,b),ie(a.$$.fragment,b),_=!0)},o(b){oe(e.$$.fragment,b),oe(n.$$.fragment,b),oe(u.$$.fragment,b),oe(a.$$.fragment,b),_=!1},d(b){b&&(ue(t),ue(l),ue(f)),Ae(e,b),Ae(n,b),Ae(u,b),Ae(a,b)}}}function zT(o){let e,t;const n=[mn("compare-route"),{paint:{"line-width":10,"line-color":V0(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function DT(o){let e;return{c(){e=Qe("A")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function RT(o){let e;return{c(){e=Qe("B")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function BT(o){let e,t,n,l,u,f,a,_,b,k,S,I,P=o[0]=="neighbourhood"&&py(o);n=new Gu({}),u=new Lr({props:{data:o[4],$$slots:{default:[zT]},$$scope:{ctx:o}}});function D(O){o[8](O)}let B={draggable:!0,$$slots:{default:[DT]},$$scope:{ctx:o}};o[3]!==void 0&&(B.lngLat=o[3]),a=new Fu({props:B}),Xi.push(()=>Wr(a,"lngLat",D));function z(O){o[9](O)}let R={draggable:!0,$$slots:{default:[RT]},$$scope:{ctx:o}};return o[2]!==void 0&&(R.lngLat=o[2]),k=new Fu({props:R}),Xi.push(()=>Wr(k,"lngLat",z)),{c(){e=ce("div"),P&&P.c(),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),Pe(a.$$.fragment),b=Re(),Pe(k.$$.fragment),Te(e,"slot","map")},m(O,U){he(O,e,U),P&&P.m(e,null),Y(e,t),Le(n,e,null),Y(e,l),Le(u,e,null),Y(e,f),Le(a,e,null),Y(e,b),Le(k,e,null),I=!0},p(O,U){O[0]=="neighbourhood"?P?U&1&&ie(P,1):(P=py(O),P.c(),ie(P,1),P.m(e,t)):P&&(gi(),oe(P,1,1,()=>{P=null}),_i());const q={};U&16&&(q.data=O[4]),U&16384&&(q.$$scope={dirty:U,ctx:O}),u.$set(q);const se={};U&16384&&(se.$$scope={dirty:U,ctx:O}),!_&&U&8&&(_=!0,se.lngLat=O[3],Gr(()=>_=!1)),a.$set(se);const re={};U&16384&&(re.$$scope={dirty:U,ctx:O}),!S&&U&4&&(S=!0,re.lngLat=O[2],Gr(()=>S=!1)),k.$set(re)},i(O){I||(ie(P),ie(n.$$.fragment,O),ie(u.$$.fragment,O),ie(a.$$.fragment,O),ie(k.$$.fragment,O),I=!0)},o(O){oe(P),oe(n.$$.fragment,O),oe(u.$$.fragment,O),oe(a.$$.fragment,O),oe(k.$$.fragment,O),I=!1},d(O){O&&ue(e),P&&P.d(),Ae(n),Ae(u),Ae(a),Ae(k)}}}function FT(o){let e,t;return e=new ns({props:{$$slots:{map:[BT],sidebar:[AT],top:[LT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&16447&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function OT(o,e,t){let n,l,u,f,a,_;dt(o,ri,R=>t(5,l=R)),dt(o,Lg,R=>t(1,u=R)),dt(o,Lu,R=>t(2,f=R)),dt(o,Iu,R=>t(3,a=R)),dt(o,$n,R=>t(7,_=R));let{prevMode:b}=e;function k(){At(ri,l={mode:b},l)}function S(R){a=R,Iu.set(a)}function I(R){f=R,Lu.set(f)}function P(){u=Ep(this.value),Lg.set(u)}const D=()=>At(ri,l={mode:"title",firstLoad:!1},l),B=()=>At(ri,l={mode:"network"},l),z=()=>At(ri,l={mode:"neighbourhood"},l);return o.$$set=R=>{"prevMode"in R&&t(0,b=R.prevMode)},o.$$.update=()=>{o.$$.dirty&142&&t(4,n=_.compareRoute(a,f,u))},[b,u,f,a,n,l,k,_,S,I,P,D,B,z]}class NT extends Zt{constructor(e){super(),qt(this,e,OT,FT,Ft,{prevMode:0})}}let tc=wi(null);const ko=wi([]);function $0(o){if(o.length<3)return JSON.parse(Ir(tc).inner.calculateRoute(o));let e=JSON.parse(JSON.stringify(o));e.push(e[0]);let t=JSON.parse(Ir(tc).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:jT}=Sd,UT=o=>({}),my=o=>({}),VT=o=>({}),gy=o=>({});function _y(o,e,t){const n=o.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function yy(o,e,t){const n=o.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function qT(o){let e,t;const n=o[24]["extra-top"],l=Bi(n,o,o[38],my);return{c(){e=ce("div"),l&&l.c(),Te(e,"slot","top")},m(u,f){he(u,e,f),l&&l.m(e,null),t=!0},p(u,f){l&&l.p&&(!t||f[1]&128)&&Oi(l,n,u,u[38],t?Fi(n,u[38],f,UT):Ni(u[38]),my)},i(u){t||(ie(l,u),t=!0)},o(u){oe(l,u),t=!1},d(u){u&&ue(e),l&&l.d(u)}}}function ZT(o){let e,t,n,l,u;return{c(){e=ce("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=Re(),n=ce("p"),n.textContent="Keyboard shortcuts:",l=Re(),u=ce("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(f,a){he(f,e,a),he(f,t,a),he(f,n,a),he(f,l,a),he(f,u,a)},p:Pt,d(f){f&&(ue(e),ue(t),ue(n),ue(l),ue(u))}}}function GT(o){let e,t=o[8].length+"",n,l;return{c(){e=Qe("Undo ("),n=Qe(t),l=Qe(")")},m(u,f){he(u,e,f),he(u,n,f),he(u,l,f)},p(u,f){f[0]&256&&t!==(t=u[8].length+"")&&Ci(n,t)},d(u){u&&(ue(e),ue(n),ue(l))}}}function WT(o){let e;return{c(){e=Qe("Undo")},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function $T(o){let e;return{c(){e=ce("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function HT(o){let e,t,n,l,u,f,a,_,b,k,S,I,P;return S=Zy(o[36][0]),{c(){e=ce("fieldset"),t=ce("label"),n=ce("input"),l=Qe(`
          Snap to roads`),u=Re(),f=ce("label"),a=ce("input"),_=Qe(`
          Draw anywhere`),b=Re(),k=ce("p"),k.textContent="Click to add at least 3 points",Te(n,"type","radio"),n.__value="snap",Bn(n,n.__value),Te(a,"type","radio"),a.__value="free",Bn(a,a.__value),S.p(n,a)},m(D,B){he(D,e,B),Y(e,t),Y(t,n),n.checked=n.__value===o[7],Y(t,l),Y(e,u),Y(e,f),Y(f,a),a.checked=a.__value===o[7],Y(f,_),he(D,b,B),he(D,k,B),I||(P=[Et(n,"change",o[35]),Et(a,"change",o[37])],I=!0)},p(D,B){B[0]&128&&(n.checked=n.__value===D[7]),B[0]&128&&(a.checked=a.__value===D[7])},d(D){D&&(ue(e),ue(b),ue(k)),S.r(),I=!1,an(P)}}}function XT(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R;const O=o[24]["extra-sidebar"],U=Bi(O,o,o[38],gy);k=new Zp({props:{$$slots:{default:[ZT]},$$scope:{ctx:o}}});function q(Oe,ne){return Oe[8].length==0?WT:GT}let se=q(o),re=se(o);function H(Oe,ne){return Oe[5].length<3?HT:$T}let ee=H(o),ve=ee(o);return{c(){e=ce("div"),U&&U.c(),t=Re(),n=ce("div"),l=ce("button"),u=Qe("Finish"),a=Re(),_=ce("button"),_.textContent="Cancel",b=Re(),Pe(k.$$.fragment),S=Re(),I=ce("button"),re.c(),D=Re(),ve.c(),l.disabled=f=o[5].length<3,Te(_,"class","secondary"),fn(n,"display","flex"),Te(I,"class","secondary"),I.disabled=P=o[8].length==0,Te(e,"slot","sidebar")},m(Oe,ne){he(Oe,e,ne),U&&U.m(e,null),Y(e,t),Y(e,n),Y(n,l),Y(l,u),Y(n,a),Y(n,_),Y(n,b),Le(k,n,null),Y(e,S),Y(e,I),re.m(I,null),Y(e,D),ve.m(e,null),B=!0,z||(R=[Et(l,"click",function(){Kl(o[0])&&o[0].apply(this,arguments)}),Et(_,"click",function(){Kl(o[1])&&o[1].apply(this,arguments)}),Et(I,"click",o[11])],z=!0)},p(Oe,ne){o=Oe,U&&U.p&&(!B||ne[1]&128)&&Oi(U,O,o,o[38],B?Fi(O,o[38],ne,VT):Ni(o[38]),gy),(!B||ne[0]&32&&f!==(f=o[5].length<3))&&(l.disabled=f);const ye={};ne[1]&128&&(ye.$$scope={dirty:ne,ctx:o}),k.$set(ye),se===(se=q(o))&&re?re.p(o,ne):(re.d(1),re=se(o),re&&(re.c(),re.m(I,null))),(!B||ne[0]&256&&P!==(P=o[8].length==0))&&(I.disabled=P),ee===(ee=H(o))&&ve?ve.p(o,ne):(ve.d(1),ve=ee(o),ve&&(ve.c(),ve.m(e,null)))},i(Oe){B||(ie(U,Oe),ie(k.$$.fragment,Oe),B=!0)},o(Oe){oe(U,Oe),oe(k.$$.fragment,Oe),B=!1},d(Oe){Oe&&ue(e),U&&U.d(Oe),Ae(k),re.d(),ve.d(),z=!1,an(R)}}}function KT(o){let e;return{c(){e=ce("span"),Te(e,"class","dot svelte-1cj4rwq"),ar(e,"snapped-node",o[47].snapped),ar(e,"free-node",!o[47].snapped),ar(e,"hide",o[4])},m(t,n){he(t,e,n)},p(t,n){n[0]&512&&ar(e,"snapped-node",t[47].snapped),n[0]&512&&ar(e,"free-node",!t[47].snapped),n[0]&16&&ar(e,"hide",t[4])},d(t){t&&ue(e)}}}function vy(o){let e,t,n;function l(b){o[25](b,o[47])}function u(){return o[26](o[47])}function f(){return o[27](o[47])}function a(){return o[28](o[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[KT]},$$scope:{ctx:o}};return o[47].point!==void 0&&(_.lngLat=o[47].point),e=new Pd({props:_}),Xi.push(()=>Wr(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",f),e.$on("dragend",o[19]),e.$on("click",a),{c(){Pe(e.$$.fragment)},m(b,k){Le(e,b,k),n=!0},p(b,k){o=b;const S={};k[0]&528|k[1]&128&&(S.$$scope={dirty:k,ctx:o}),!t&&k[0]&512&&(t=!0,S.lngLat=o[47].point,Gr(()=>t=!1)),e.$set(S)},i(b){n||(ie(e.$$.fragment,b),n=!0)},o(b){oe(e.$$.fragment,b),n=!1},d(b){Ae(e,b)}}}function JT(o){let e;return{c(){e=ce("span"),e.textContent=`${o[46]+1}`,Te(e,"class","dot svelte-1cj4rwq"),ar(e,"snapped",o[44].snapped)},m(t,n){he(t,e,n)},p(t,n){n[0]&32&&ar(e,"snapped",t[44].snapped)},d(t){t&&ue(e)}}}function by(o){let e,t,n;function l(_){o[29](_,o[44])}function u(){return o[30](o[46])}function f(){return o[31](o[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[JT]},$$scope:{ctx:o}};return o[44].point!==void 0&&(a.lngLat=o[44].point),e=new Pd({props:a}),Xi.push(()=>Wr(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",f),e.$on("mouseenter",o[32]),e.$on("mouseleave",o[33]),e.$on("dragstart",o[21]),e.$on("dragend",o[34]),{c(){Pe(e.$$.fragment)},m(_,b){Le(e,_,b),n=!0},p(_,b){o=_;const k={};b[0]&32|b[1]&128&&(k.$$scope={dirty:b,ctx:o}),!t&&b[0]&32&&(t=!0,k.lngLat=o[44].point,Gr(()=>t=!1)),e.$set(k)},i(_){n||(ie(e.$$.fragment,_),n=!0)},o(_){oe(e.$$.fragment,_),n=!1},d(_){Ae(e,_)}}}function YT(o){let e,t,n,l;const u=[mn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let f={};for(let b=0;b<u.length;b+=1)f=sn(f,u[b]);e=new fo({props:f});const a=[mn("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let b=0;b<a.length;b+=1)_=sn(_,a[b]);return n=new Cs({props:_}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(b,k){Le(e,b,k),he(b,t,k),Le(n,b,k),l=!0},p(b,k){const S={};e.$set(S);const I={};n.$set(I)},i(b){l||(ie(e.$$.fragment,b),ie(n.$$.fragment,b),l=!0)},o(b){oe(e.$$.fragment,b),oe(n.$$.fragment,b),l=!1},d(b){b&&ue(t),Ae(e,b),Ae(n,b)}}}function QT(o){let e,t;return e=new fo({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function e5(o){let e,t,n,l,u,f,a,_,b;t=new y0({}),t.$on("click",o[12]),t.$on("mousemove",o[13]);let k=Kn(o[9]),S=[];for(let z=0;z<k.length;z+=1)S[z]=vy(yy(o,k,z));const I=z=>oe(S[z],1,1,()=>{S[z]=null});let P=Kn(o[5]),D=[];for(let z=0;z<P.length;z+=1)D[z]=by(_y(o,P,z));const B=z=>oe(D[z],1,1,()=>{D[z]=null});return f=new Lr({props:{data:o[16](o[6],o[5]),generateId:!0,$$slots:{default:[YT]},$$scope:{ctx:o}}}),_=new Lr({props:{data:o[10],$$slots:{default:[QT]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re();for(let z=0;z<S.length;z+=1)S[z].c();l=Re();for(let z=0;z<D.length;z+=1)D[z].c();u=Re(),Pe(f.$$.fragment),a=Re(),Pe(_.$$.fragment),Te(e,"slot","map")},m(z,R){he(z,e,R),Le(t,e,null),Y(e,n);for(let O=0;O<S.length;O+=1)S[O]&&S[O].m(e,null);Y(e,l);for(let O=0;O<D.length;O+=1)D[O]&&D[O].m(e,null);Y(e,u),Le(f,e,null),Y(e,a),Le(_,e,null),b=!0},p(z,R){if(R[0]&918032){k=Kn(z[9]);let q;for(q=0;q<k.length;q+=1){const se=yy(z,k,q);S[q]?(S[q].p(se,R),ie(S[q],1)):(S[q]=vy(se),S[q].c(),ie(S[q],1),S[q].m(e,l))}for(gi(),q=k.length;q<S.length;q+=1)I(q);_i()}if(R[0]&2146348){P=Kn(z[5]);let q;for(q=0;q<P.length;q+=1){const se=_y(z,P,q);D[q]?(D[q].p(se,R),ie(D[q],1)):(D[q]=by(se),D[q].c(),ie(D[q],1),D[q].m(e,u))}for(gi(),q=P.length;q<D.length;q+=1)B(q);_i()}const O={};R[0]&96&&(O.data=z[16](z[6],z[5])),R[1]&128&&(O.$$scope={dirty:R,ctx:z}),f.$set(O);const U={};R[0]&1024&&(U.data=z[10]),R[1]&128&&(U.$$scope={dirty:R,ctx:z}),_.$set(U)},i(z){if(!b){ie(t.$$.fragment,z);for(let R=0;R<k.length;R+=1)ie(S[R]);for(let R=0;R<P.length;R+=1)ie(D[R]);ie(f.$$.fragment,z),ie(_.$$.fragment,z),b=!0}},o(z){oe(t.$$.fragment,z),S=S.filter(Boolean);for(let R=0;R<S.length;R+=1)oe(S[R]);D=D.filter(Boolean);for(let R=0;R<D.length;R+=1)oe(D[R]);oe(f.$$.fragment,z),oe(_.$$.fragment,z),b=!1},d(z){z&&ue(e),Ae(t),Ss(S,z),Ss(D,z),Ae(f),Ae(_)}}}function t5(o){let e,t,n,l;return e=new ns({props:{$$slots:{map:[e5],sidebar:[XT],top:[qT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0,n||(l=Et(jT,"keydown",o[20]),n=!0)},p(u,f){const a={};f[0]&2047|f[1]&128&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function i5(o,e,t){let n,l,u;dt(o,ko,ct=>t(5,l=ct)),dt(o,tc,ct=>t(6,u=ct));let{$$slots:f={},$$scope:a}=e,{map:_}=e,{finish:b}=e,{cancel:k}=e;Qn(()=>{At(ko,l=[],l),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let S="snap",I=[],P=[],D=null,B=!1,z=!1,R=!1;function O(ct){let It=ct.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=It}function U(){let ct=I.pop();t(8,I),ct&&At(ko,l=ct,l)}function q(){I.length==100&&I.shift(),t(8,I=[...I,JSON.parse(JSON.stringify(l))])}function se(){t(7,S=S=="snap"?"free":"snap"),D&&t(23,D.snapped=S=="snap",D)}function re(ct){l.length>=3||(q(),ko.update(It=>(It.push({point:ct.detail.lngLat.toArray(),snapped:S=="snap"}),It)))}function H(ct){t(23,D={point:ct.detail.lngLat.toArray(),snapped:S=="snap"})}function ee(ct){q(),ko.update(It=>(It[ct].snapped=!It[ct].snapped,It))}function ve(ct){q(),ko.update(It=>(It.splice(ct,1),It)),t(2,B=!1)}function Oe(ct,It){try{if(ct)return $0(It)}catch{}return Xl()}function ne(ct,It,Ne,je){if(je||It.length>=3)return Xl();try{if(ct&&It.length>0&&Ne)return JSON.parse(ct.inner.calculateRoute([It[It.length-1],Ne]))}catch{}return Xl()}function ye(ct,It,Ne){if(Ne)return;if(!ct||It.length<3){t(9,P=[]);return}let je=[],rt=1,xt=JSON.parse(JSON.stringify(It));xt.push(xt[0]);for(let we=0;we<xt.length-1;we++){let di=JSON.parse(ct.inner.getExtraNodes(xt[we],xt[we+1]));for(let[Ve,$e,kt]of di)je.push({point:[Ve,$e],snapped:kt,insertIdx:rt});rt++}t(9,P=je)}function Ke(ct){q(),ko.update(It=>(It.splice(ct.insertIdx,0,{point:ct.point,snapped:ct.snapped}),It)),t(4,R=!0)}function Ce(ct){ko.update(It=>(It[ct.insertIdx].point=ct.point,It))}function et(){t(4,R=!1)}function bt(ct){let It=ct.target.tagName,Ne=It=="INPUT"||It=="TEXTAREA";ct.key=="Enter"&&!Ne||ct.key=="Escape"?(ct.stopPropagation(),l.length>=3?b():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ct.key=="s"&&!Ne?se():ct.key=="z"&&ct.ctrlKey&&(ct.stopPropagation(),U())}function pt(){q(),t(3,z=!0)}const st=[[]];function Ht(ct,It){o.$$.not_equal(It.point,ct)&&(It.point=ct,t(9,P))}const ii=ct=>Ke(ct),Ot=ct=>Ce(ct),zt=ct=>{Ke(ct),t(4,R=!1)};function Jt(ct,It){o.$$.not_equal(It.point,ct)&&(It.point=ct,ko.set(l))}const Mt=ct=>ee(ct),ei=ct=>ve(ct),Vt=()=>t(2,B=!0),hi=()=>t(2,B=!1),xi=()=>t(3,z=!1);function yi(){S=this.__value,t(7,S)}function Ai(){S=this.__value,t(7,S)}return o.$$set=ct=>{"map"in ct&&t(22,_=ct.map),"finish"in ct&&t(0,b=ct.finish),"cancel"in ct&&t(1,k=ct.cancel),"$$scope"in ct&&t(38,a=ct.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&112&&ye(u,l,R),o.$$.dirty[0]&8388716&&t(10,n=ne(u,l,D,B||z)),o.$$.dirty[0]&32&&O(l)},[b,k,B,z,R,l,u,S,I,P,n,U,re,H,ee,ve,Oe,Ke,Ce,et,bt,pt,_,D,f,Ht,ii,Ot,zt,Jt,Mt,ei,Vt,hi,xi,yi,st,Ai,a]}class n5 extends Zt{constructor(e){super(),qt(this,e,i5,t5,Ft,{map:22,finish:0,cancel:1},null,[-1,-1])}}function r5(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function o5(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function s5(o){let e;return{c(){e=ce("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){he(t,e,n)},p:Pt,i:Pt,o:Pt,d(t){t&&ue(e)}}}function a5(o){let e,t,n,l,u;return t=new Pi({props:{$$slots:{default:[l5]},$$scope:{ctx:o}}}),t.$on("click",o[8]),{c(){e=ce("li"),Pe(t.$$.fragment),n=Re(),l=ce("li"),l.textContent="Changing neighbourhood boundary"},m(f,a){he(f,e,a),Le(t,e,null),he(f,n,a),he(f,l,a),u=!0},p(f,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:f}),t.$set(_)},i(f){u||(ie(t.$$.fragment,f),u=!0)},o(f){oe(t.$$.fragment,f),u=!1},d(f){f&&(ue(e),ue(n),ue(l)),Ae(t)}}}function l5(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function c5(o){let e,t,n,l,u,f,a,_,b,k,S,I;u=new Pi({props:{$$slots:{default:[r5]},$$scope:{ctx:o}}}),u.$on("click",o[6]),_=new Pi({props:{$$slots:{default:[o5]},$$scope:{ctx:o}}}),_.$on("click",o[7]);const P=[a5,s5],D=[];function B(z,R){return z[1]?0:1}return k=B(o),S=D[k]=P[k](o),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),Pe(_.$$.fragment),b=Re(),S.c(),Te(t,"aria-label","breadcrumb"),Te(e,"slot","extra-top")},m(z,R){he(z,e,R),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Le(_,a,null),Y(n,b),D[k].m(n,null),I=!0},p(z,R){const O={};R&4096&&(O.$$scope={dirty:R,ctx:z}),u.$set(O);const U={};R&4096&&(U.$$scope={dirty:R,ctx:z}),_.$set(U);let q=k;k=B(z),k===q?D[k].p(z,R):(gi(),oe(D[q],1,1,()=>{D[q]=null}),_i(),S=D[k],S?S.p(z,R):(S=D[k]=P[k](z),S.c()),ie(S,1),S.m(n,null))},i(z){I||(ie(u.$$.fragment,z),ie(_.$$.fragment,z),ie(S),I=!0)},o(z){oe(u.$$.fragment,z),oe(_.$$.fragment,z),oe(S),I=!1},d(z){z&&ue(e),Ae(u),Ae(_),D[k].d()}}}function u5(o){let e,t,n,l;return{c(){e=ce("div"),t=ce("h1"),n=Qe("Draw your neighbourhood boundary for "),l=Qe(o[0]),Te(e,"slot","extra-sidebar")},m(u,f){he(u,e,f),Y(e,t),Y(t,n),Y(t,l)},p(u,f){f&1&&Ci(l,u[0])},d(u){u&&ue(e)}}}function h5(o){let e,t;return e=new n5({props:{map:gr(o[3]),finish:o[4],cancel:o[5],$$slots:{"extra-sidebar":[u5],"extra-top":[c5]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&8&&(u.map=gr(n[3])),l&4103&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function d5(o,e,t){let n,l,u,f,a;dt(o,ri,B=>t(2,n=B)),dt(o,Au,B=>t(9,l=B)),dt(o,$n,B=>t(10,u=B)),dt(o,ko,B=>t(11,f=B)),dt(o,es,B=>t(3,a=B));let{name:_}=e,{existing:b}=e;b&&(b.properties.waypoints?At(ko,f=b.properties.waypoints.map(B=>({point:[B.lon,B.lat],snapped:B.snapped})),f):At(ko,f=b.geometry.coordinates[0].slice(1).map(B=>({point:B,snapped:!1})),f));function k(){if(f.length>=3)try{let B=$0(f);u.setNeighbourhoodBoundary(_,B),ec(),u.setCurrentNeighbourhood(_,l),At(ri,n={mode:"neighbourhood"},n)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),S()}}function S(){b?At(ri,n={mode:"neighbourhood"},n):At(ri,n={mode:"network"},n)}const I=()=>At(ri,n={mode:"title",firstLoad:!1},n),P=()=>At(ri,n={mode:"network"},n),D=()=>At(ri,n={mode:"neighbourhood"},n);return o.$$set=B=>{"name"in B&&t(0,_=B.name),"existing"in B&&t(1,b=B.existing)},[_,b,n,a,k,S,I,P,D]}class f5 extends Zt{constructor(e){super(),qt(this,e,d5,h5,Ft,{name:0,existing:1})}}const p5="/ltn/assets/settings-342fb430.svg";function wy(o){let e,t;return e=new Md({props:{$$slots:{default:[m5]},$$scope:{ctx:o}}}),e.$on("close",o[7]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&263&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function m5(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D,B,z,R,O,U,q;return n=new BS({}),{c(){e=ce("h1"),e.textContent="Settings",t=Re(),Pe(n.$$.fragment),l=Re(),u=ce("label"),f=Qe(`Style for roads in a neighbourhood:
      `),a=ce("select"),_=ce("option"),_.textContent="Show worst shortcuts",b=ce("option"),b.textContent="Show the cell",k=ce("option"),k.textContent="Show edited roads (either filter or direction)",S=Re(),I=ce("label"),P=ce("input"),D=Qe(`
      Road thickness depends on shortcuts`),B=Re(),z=ce("center"),R=ce("button"),R.textContent="Confirm",_.__value="shortcuts",Bn(_,_.__value),b.__value="cells",Bn(b,b.__value),k.__value="edits",Bn(k,k.__value),o[1]===void 0&&Yl(()=>o[4].call(a)),Te(P,"type","checkbox")},m(se,re){he(se,e,re),he(se,t,re),Le(n,se,re),he(se,l,re),he(se,u,re),Y(u,f),Y(u,a),Y(a,_),Y(a,b),Y(a,k),Jl(a,o[1],!0),he(se,S,re),he(se,I,re),Y(I,P),P.checked=o[2],Y(I,D),he(se,B,re),he(se,z,re),Y(z,R),O=!0,U||(q=[Et(a,"change",o[4]),Et(P,"change",o[5]),Et(R,"click",o[6])],U=!0)},p(se,re){re&2&&Jl(a,se[1]),re&4&&(P.checked=se[2])},i(se){O||(ie(n.$$.fragment,se),O=!0)},o(se){oe(n.$$.fragment,se),O=!1},d(se){se&&(ue(e),ue(t),ue(l),ue(u),ue(S),ue(I),ue(B),ue(z)),Ae(n,se),U=!1,an(q)}}}function g5(o){let e,t,n,l,u,f,a=o[0]&&wy(o);return{c(){e=ce("button"),e.innerHTML=`<img src="${p5}" alt="Settings"/>`,t=Re(),a&&a.c(),n=En(),Te(e,"class","outline")},m(_,b){he(_,e,b),he(_,t,b),a&&a.m(_,b),he(_,n,b),l=!0,u||(f=Et(e,"click",o[3]),u=!0)},p(_,[b]){_[0]?a?(a.p(_,b),b&1&&ie(a,1)):(a=wy(_),a.c(),ie(a,1),a.m(n.parentNode,n)):a&&(gi(),oe(a,1,1,()=>{a=null}),_i())},i(_){l||(ie(a),l=!0)},o(_){oe(a),l=!1},d(_){_&&(ue(e),ue(t),ue(n)),a&&a.d(_),u=!1,f()}}}function _5(o,e,t){let n,l;dt(o,bd,S=>t(1,n=S)),dt(o,cp,S=>t(2,l=S));let u=!1;const f=()=>t(0,u=!0);function a(){n=Cp(this),bd.set(n)}function _(){l=this.checked,cp.set(l)}return[u,n,l,f,a,_,()=>t(0,u=!1),()=>t(0,u=!1)]}class y5 extends Zt{constructor(e){super(),qt(this,e,_5,g5,Ft,{})}}const v5=["==",["geometry-type"],"Polygon"],b5=["==",["geometry-type"],"LineString"],w5=["==",["geometry-type"],"Point"];function H0(){return{type:"FeatureCollection",features:[]}}function Qf(o){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:X0(o)}}}function X0(o){return[Math.round(o[0]*1e7)/1e7,Math.round(o[1]*1e7)/1e7]}const K0=wi(H0()),J0=wi(0),x5=100;class k5{constructor(e){Dn(this,"map");Dn(this,"active");Dn(this,"eventListenersSuccess");Dn(this,"eventListenersUpdated");Dn(this,"eventListenersFailure");Dn(this,"points");Dn(this,"cursor");Dn(this,"hover");Dn(this,"dragFrom");Dn(this,"previousStates");Dn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=t,l[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Dn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(xy(this.points).forEach((n,l)=>{t.push([l+1,lw(n,this.cursor).properties.dist])}),t.sort((n,l)=>n[1]-l[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Dn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Qf(e.lngLat.toArray()),this.onClick(e),this.finish())});Dn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Dn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Dn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Dn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=H0();this.points.forEach((l,u)=>{let f=Qf(l);f.properties.hover=this.hover==u,f.properties.idx=u,e.features.push(f)}),e.features=e.features.concat(xy(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),K0.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,J0.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Qf(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(X0),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>x5&&this.previousStates.shift()}}function xy(o){let e=[];for(let t=0;t<o.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[t],o[t+1]]},properties:{}});return o.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[o.length-1],o[0]]},properties:{}}),e}function S5(o){let e,t,n;return{c(){e=Qe("Undo ("),t=Qe(o[1]),n=Qe(")")},m(l,u){he(l,e,u),he(l,t,u),he(l,n,u)},p(l,u){u&2&&Ci(t,l[1])},d(l){l&&(ue(e),ue(t),ue(n))}}}function T5(o){let e;return{c(){e=Qe("Undo")},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function E5(o){let e,t,n,l,u,f,a,_,b,k,S;function I(B,z){return B[1]==0?T5:S5}let P=I(o),D=P(o);return{c(){e=ce("div"),t=ce("button"),t.textContent="Finish",n=Re(),l=ce("button"),l.textContent="Cancel",u=Re(),f=ce("button"),D.c(),_=Re(),b=ce("ul"),b.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,f.disabled=a=o[1]==0,fn(e,"display","flex"),fn(e,"justify-content","space-between")},m(B,z){he(B,e,z),Y(e,t),Y(e,n),Y(e,l),Y(e,u),Y(e,f),D.m(f,null),he(B,_,z),he(B,b,z),k||(S=[Et(t,"click",o[2]),Et(l,"click",o[3]),Et(f,"click",o[4])],k=!0)},p(B,[z]){P===(P=I(B))&&D?D.p(B,z):(D.d(1),D=P(B),D&&(D.c(),D.m(f,null))),z&2&&a!==(a=B[1]==0)&&(f.disabled=a)},i:Pt,o:Pt,d(B){B&&(ue(e),ue(_),ue(b)),D.d(),k=!1,an(S)}}}function C5(o,e,t){let n;dt(o,J0,_=>t(1,n=_));let{polygonTool:l}=e;const u=()=>l.finish(),f=()=>l.cancel(),a=()=>l.undo();return o.$$set=_=>{"polygonTool"in _&&t(0,l=_.polygonTool)},[l,n,u,f,a]}class M5 extends Zt{constructor(e){super(),qt(this,e,C5,E5,Ft,{polygonTool:0})}}let I5=Date.now();function $u(o){return`${o}-${I5++}`}const Y0=Symbol.for("svelte-maplibre");function L5(){return Cd(Y0)}function ky(o){return{subscribe:o.subscribe}}function Q0({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=L5(),u=wi(null),f=ky(u),a={...l,[o]:ky(u)};if(e&&(a.popupTarget=f),n){let _=wi(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=wi()),Ed(Y0,a),{...l,self:u}}function A5(){return Q0({key:"source",setCluster:!0})}function P5(o=!0){return Q0({key:"layer",setPopupTarget:o,setMouseEvent:o})}function Sy(o){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&o(n,u,l)}else if(e)for(let n in e)o(n,void 0,e[n]);e=t}}function z5(o,...e){let t=[o];for(let n of e)if(n)Array.isArray(n)&&n[0]===o?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function D5(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function Ty(o){let e=o[0],t,n,l=Ey(o);return{c(){l.c(),t=En()},m(u,f){l.m(u,f),he(u,t,f),n=!0},p(u,f){f[0]&1&&Ft(e,e=u[0])?(gi(),oe(l,1,1,Pt),_i(),l=Ey(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(ie(l),n=!0)},o(u){oe(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function Ey(o){let e;const t=o[36].default,n=Bi(t,o,o[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Oi(n,t,l,l[35],e?Fi(t,l[35],u,null):Ni(l[35]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function R5(o){let e,t,n=o[0]&&Ty(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&ie(n,1)):(n=Ty(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function B5(o,e,t){let n,l,u,f,a,_,b,k,S,I,P,D,{$$slots:B={},$$scope:z}=e,{id:R=$u("layer")}=e,{source:O=void 0}=e,{sourceLayer:U=void 0}=e,{beforeId:q=void 0}=e,{beforeLayerType:se=void 0}=e,{type:re}=e,{paint:H=void 0}=e,{layout:ee=void 0}=e,{filter:ve=void 0}=e,{applyToClusters:Oe=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Ce=null}=e,{interactive:et=!0}=e,{hoverCursor:bt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const st=ts(),{map:Ht,source:ii,self:Ot,minzoom:zt,maxzoom:Jt,eventTopMost:Mt,layerInfo:ei}=P5();dt(o,Ht,Ne=>t(31,S=Ne)),dt(o,ii,Ne=>t(32,I=Ne)),dt(o,Ot,Ne=>t(0,k=Ne)),dt(o,zt,Ne=>t(34,D=Ne)),dt(o,Jt,Ne=>t(33,P=Ne)),Qn(()=>{k&&S&&(ei.delete(k),S==null||S.removeLayer(k))});let Vt;function hi(Ne){var we,di;if(!et||!k||!S||pt&&Mt(Ne)!==k)return;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt={event:Ne,map:S,clusterId:rt,layer:k,source:a,features:je};st(Ne.type,xt)}function xi(Ne){var we,di;if(!et||!k||!S||pt&&Mt(Ne)!==k)return;bt&&(S.getCanvas().style.cursor=bt);let je=Ne.features??[];t(6,Ce=je[0]??null);let rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;st("mouseenter",{event:Ne,map:S,clusterId:rt,layer:k,source:a,features:je})}function yi(Ne){var we,di,Ve;if(!et||!S)return;if(pt&&Mt(Ne)!==k){t(6,Ce=null),Ke&&Vt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:U,id:Vt},{hover:!1}),Vt=void 0);return}S.getCanvas().style.cursor=bt;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt=(Ve=je[0])==null?void 0:Ve.id;xt!==Vt&&(Ke&&(Vt!==void 0&&(S==null||S.setFeatureState({source:a,id:Vt,sourceLayer:U},{hover:!1})),S==null||S.setFeatureState({source:a,id:xt,sourceLayer:U},{hover:!0})),Vt=xt,t(6,Ce=je[0]??null)),st("mousemove",{event:Ne,map:S,clusterId:rt,layer:k,source:a,features:je})}function Ai(Ne){if(!(!et||!k||!S)){if(bt&&(S.getCanvas().style.cursor=""),t(6,Ce=null),Ke&&Vt!==void 0){const je={source:a,id:Vt,sourceLayer:U};S==null||S.setFeatureState(je,{hover:!1}),Vt=void 0}st("mouseleave",{map:S,layer:k,source:a})}}let ct=!0;function It(Ne){S&&(S.off("click",Ne,hi),S.off("dblclick",Ne,hi),S.off("contextmenu",Ne,hi),S.off("mouseenter",Ne,xi),S.off("mousemove",Ne,yi),S.off("mouseleave",Ne,Ai))}return Qn(()=>{S&&k&&It(k)}),o.$$set=Ne=>{"id"in Ne&&t(7,R=Ne.id),"source"in Ne&&t(8,O=Ne.source),"sourceLayer"in Ne&&t(9,U=Ne.sourceLayer),"beforeId"in Ne&&t(10,q=Ne.beforeId),"beforeLayerType"in Ne&&t(11,se=Ne.beforeLayerType),"type"in Ne&&t(12,re=Ne.type),"paint"in Ne&&t(13,H=Ne.paint),"layout"in Ne&&t(14,ee=Ne.layout),"filter"in Ne&&t(15,ve=Ne.filter),"applyToClusters"in Ne&&t(16,Oe=Ne.applyToClusters),"minzoom"in Ne&&t(17,ne=Ne.minzoom),"maxzoom"in Ne&&t(18,ye=Ne.maxzoom),"manageHoverState"in Ne&&t(19,Ke=Ne.manageHoverState),"hovered"in Ne&&t(6,Ce=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,bt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,pt=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,z=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,n=D5(Oe)),o.$$.dirty[0]&1073774592&&t(24,l=z5("all",n,ve)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ne??D),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,f=ye??P),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=O||I),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&S&&k!==R&&a){k&&(It(k),ei.delete(k));let Ne=q;if(!q&&se){let je=S.getStyle().layers,rt=typeof se=="function"?se:we=>we.type===se,xt=je==null?void 0:je.find(rt);xt&&(Ne=xt.id)}At(Ot,k=R,k),S.addLayer(Oa({id:k,type:re,source:a,"source-layer":U,filter:l,paint:H,layout:ee,minzoom:u,maxzoom:f}),Ne),t(23,ct=!0),S.on("click",k,hi),S.on("dblclick",k,hi),S.on("contextmenu",k,hi),S.on("mouseenter",k,xi),S.on("mousemove",k,yi),S.on("mouseleave",k,Ai)}o.$$.dirty[0]&1048577&&k&&ei.set(k,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=k?Sy((Ne,je)=>S==null?void 0:S.setPaintProperty(k,Ne,je)):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,b=k?Sy((Ne,je)=>S==null?void 0:S.setLayoutProperty(k,Ne,je)):void 0),o.$$.dirty[0]&268443648&&(_==null||_(H)),o.$$.dirty[0]&134234112&&(b==null||b(ee)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,f)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&k&&(ct?t(23,ct=!1):S==null||S.setFilter(k,l))},[k,Ht,ii,Ot,zt,Jt,Ce,R,O,U,q,se,re,H,ee,ve,Oe,ne,ye,Ke,et,bt,pt,ct,l,f,u,b,_,a,n,S,I,P,D,z,B]}class Gp extends Zt{constructor(e){super(),qt(this,e,B5,R5,Ft,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function F5(o){let e;const t=o[16].default,n=Bi(t,o,o[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Oi(n,t,l,l[24],e?Fi(t,l[24],u,null):Ni(l[24]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function O5(o){let e,t,n;function l(f){o[17](f)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[F5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Gp({props:u}),Xi.push(()=>Wr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function N5(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=$u("circle")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:I=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:B=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:R=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:q=!0}=e;function se(ye){O=ye,t(0,O)}function re(ye){ui.call(this,o,ye)}function H(ye){ui.call(this,o,ye)}function ee(ye){ui.call(this,o,ye)}function ve(ye){ui.call(this,o,ye)}function Oe(ye){ui.call(this,o,ye)}function ne(ye){ui.call(this,o,ye)}return o.$$set=ye=>{"id"in ye&&t(1,u=ye.id),"source"in ye&&t(2,f=ye.source),"sourceLayer"in ye&&t(3,a=ye.sourceLayer),"beforeId"in ye&&t(4,_=ye.beforeId),"beforeLayerType"in ye&&t(5,b=ye.beforeLayerType),"paint"in ye&&t(6,k=ye.paint),"layout"in ye&&t(7,S=ye.layout),"filter"in ye&&t(8,I=ye.filter),"applyToClusters"in ye&&t(9,P=ye.applyToClusters),"minzoom"in ye&&t(10,D=ye.minzoom),"maxzoom"in ye&&t(11,B=ye.maxzoom),"hoverCursor"in ye&&t(12,z=ye.hoverCursor),"manageHoverState"in ye&&t(13,R=ye.manageHoverState),"hovered"in ye&&t(0,O=ye.hovered),"eventsIfTopMost"in ye&&t(14,U=ye.eventsIfTopMost),"interactive"in ye&&t(15,q=ye.interactive),"$$scope"in ye&&t(24,l=ye.$$scope)},[O,u,f,a,_,b,k,S,I,P,D,B,z,R,U,q,n,se,re,H,ee,ve,Oe,ne,l]}class j5 extends Zt{constructor(e){super(),qt(this,e,N5,O5,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function U5(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function V5(o){let e,t,n;function l(f){o[16](f)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[U5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Gp({props:u}),Xi.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function q5(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=$u("fill")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:z=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:U=!0}=e;function q(ne){R=ne,t(0,R)}function se(ne){ui.call(this,o,ne)}function re(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function ve(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,b=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,I=ne.filter),"minzoom"in ne&&t(9,P=ne.minzoom),"maxzoom"in ne&&t(10,D=ne.maxzoom),"hoverCursor"in ne&&t(11,B=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,R=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,U=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[R,u,f,a,_,b,k,S,I,P,D,B,z,O,U,n,q,se,re,H,ee,ve,Oe,l]}class Z5 extends Zt{constructor(e){super(),qt(this,e,q5,V5,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function G5(o,e,t,n,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const f=()=>{n(e)&&(o.addSource(e,t),l())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):f())};a()}else f()}function W5(o,e,t){$y().then(()=>{let n=Ir(o);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Cy(o){let e=o[0],t,n,l=My(o);return{c(){l.c(),t=En()},m(u,f){l.m(u,f),he(u,t,f),n=!0},p(u,f){f&1&&Ft(e,e=u[0])?(gi(),oe(l,1,1,Pt),_i(),l=My(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(ie(l),n=!0)},o(u){oe(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function My(o){let e;const t=o[15].default,n=Bi(t,o,o[14],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16384)&&Oi(n,t,l,l[14],e?Fi(t,l[14],u,null):Ni(l[14]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function $5(o){let e,t,n=o[0]&&Cy(o);return{c(){n&&n.c(),e=En()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=Cy(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(gi(),oe(n,1,1,()=>{n=null}),_i())},i(l){t||(ie(n),t=!0)},o(l){oe(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function H5(o,e,t){let n,l,u,{$$slots:f={},$$scope:a}=e,{id:_=$u("geojson")}=e,{data:b}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:I=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:D=void 0}=e;const{map:B,cluster:z,self:R}=A5();dt(o,B,q=>t(13,l=q)),dt(o,z,q=>t(16,u=q)),dt(o,R,q=>t(0,n=q));let O,U=!0;return Qn(()=>{n&&O&&l&&(W5(B,n,O),At(R,n=null,n),t(11,O=void 0))}),o.$$set=q=>{"id"in q&&t(4,_=q.id),"data"in q&&t(5,b=q.data),"generateId"in q&&t(6,k=q.generateId),"promoteId"in q&&t(7,S=q.promoteId),"filter"in q&&t(8,I=q.filter),"lineMetrics"in q&&t(9,P=q.lineMetrics),"cluster"in q&&t(10,D=q.cluster),"$$scope"in q&&t(14,a=q.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&At(z,u=D,u),o.$$.dirty&12273&&l&&n!==_&&(At(R,n=_,n),G5(l,n,Oa({type:"geojson",data:b,filter:I,lineMetrics:P,generateId:k,promoteId:S,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties}),q=>l&&q===n,()=>{n&&(t(11,O=l==null?void 0:l.getSource(n)),t(12,U=!0))})),o.$$.dirty&8208&&(l==null||l.on("style.load",()=>{t(11,O=l==null?void 0:l.getSource(_))})),o.$$.dirty&6176&&O&&(U?t(12,U=!1):O.setData(b)),o.$$.dirty&3072&&(O==null||O.setClusterOptions(Oa({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[n,B,z,R,_,b,k,S,I,P,D,O,U,l,a,f]}class X5 extends Zt{constructor(e){super(),qt(this,e,H5,$5,Ft,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function K5(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){oe(n,l),e=!1},d(l){n&&n.d(l)}}}function J5(o){let e,t,n;function l(f){o[16](f)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[K5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Gp({props:u}),Xi.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(f,a){Le(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(ie(e.$$.fragment,f),n=!0)},o(f){oe(e.$$.fragment,f),n=!1},d(f){Ae(e,f)}}}function Y5(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=$u("line")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:z=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:U=!0}=e;function q(ne){R=ne,t(0,R)}function se(ne){ui.call(this,o,ne)}function re(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function ve(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,b=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,I=ne.filter),"minzoom"in ne&&t(9,P=ne.minzoom),"maxzoom"in ne&&t(10,D=ne.maxzoom),"hoverCursor"in ne&&t(11,B=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,R=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,U=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[R,u,f,a,_,b,k,S,I,P,D,B,z,O,U,n,q,se,re,H,ee,ve,Oe,l]}class Q5 extends Zt{constructor(e){super(),qt(this,e,Y5,J5,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function eE(o){let e,t,n,l,u,f;return e=new Z5({props:{id:"edit-polygon-fill",filter:v5,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new Q5({props:{id:"edit-polygon-lines",filter:b5,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new j5({props:{id:"edit-polygon-vertices",filter:w5,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment)},m(a,_){Le(e,a,_),he(a,t,_),Le(n,a,_),he(a,l,_),Le(u,a,_),f=!0},p:Pt,i(a){f||(ie(e.$$.fragment,a),ie(n.$$.fragment,a),ie(u.$$.fragment,a),f=!0)},o(a){oe(e.$$.fragment,a),oe(n.$$.fragment,a),oe(u.$$.fragment,a),f=!1},d(a){a&&(ue(t),ue(l)),Ae(e,a),Ae(n,a),Ae(u,a)}}}function tE(o){let e,t;return e=new X5({props:{data:o[0],$$slots:{default:[eE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&2&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function iE(o,e,t){let n;return dt(o,K0,l=>t(0,n=l)),[n]}class nE extends Zt{constructor(e){super(),qt(this,e,iE,tE,Ft,{})}}function rE(o){let e,t,n,l,u,f,a;return{c(){e=ce("button"),e.textContent="Import current view",t=Re(),n=ce("i"),n.textContent="or...",l=Re(),u=ce("button"),u.textContent="Draw an area to import on the map",Te(e,"type","button"),Te(u,"type","button")},m(_,b){he(_,e,b),he(_,t,b),he(_,n,b),he(_,l,b),he(_,u,b),f||(a=[Et(e,"click",o[2]),Et(u,"click",o[3])],f=!0)},p:Pt,i:Pt,o:Pt,d(_){_&&(ue(e),ue(t),ue(n),ue(l),ue(u)),f=!1,an(a)}}}function oE(o){let e,t;return e=new M5({props:{polygonTool:o[0]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.polygonTool=n[0]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function sE(o){let e,t,n,l,u,f,a,_,b;const k=[oE,rE],S=[];function I(P,D){return P[0]?0:1}return e=I(o),t=S[e]=k[e](o),{c(){t.c(),n=Re(),l=ce("label"),u=ce("input"),f=Qe(`Save a copy of the osm.xml
  after importing`),Te(u,"type","checkbox")},m(P,D){S[e].m(P,D),he(P,n,D),he(P,l,D),Y(l,u),u.checked=o[1],Y(l,f),a=!0,_||(b=Et(u,"change",o[5]),_=!0)},p(P,[D]){let B=e;e=I(P),e===B?S[e].p(P,D):(gi(),oe(S[B],1,1,()=>{S[B]=null}),_i(),t=S[e],t?t.p(P,D):(t=S[e]=k[e](P),t.c()),ie(t,1),t.m(n.parentNode,n)),D&2&&(u.checked=P[1])},i(P){a||(ie(t),a=!0)},o(P){oe(t),a=!1},d(P){P&&(ue(n),ue(l)),S[e].d(P),_=!1,b()}}}function hu(o){return[o.lng,o.lat]}function aE(o,e,t){let{map:n}=e;const l=ts();let u=null,f=!1;async function a(I){try{l("loading","Loading from Overpass");let D=await(await fetch(e1(I))).text();f&&md("osm.xml",D),l("gotXml",{xml:D,boundary:I})}catch(P){l("error",P.toString())}}function _(){let I=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[hu(I.getSouthWest()),hu(I.getNorthWest()),hu(I.getNorthEast()),hu(I.getSouthEast()),hu(I.getSouthWest())]],type:"Polygon"}}}async function b(){if(n){if(n.getZoom()<13){l("error","Zoom in more to import");return}await a(_())}}function k(){n&&(t(0,u=new k5(n)),u.startNew(),u.addEventListenerSuccess(async I=>{t(0,u=null),await a(I)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function S(){f=this.checked,t(1,f)}return o.$$set=I=>{"map"in I&&t(4,n=I.map)},[u,f,b,k,n,S]}class lE extends Zt{constructor(e){super(),qt(this,e,aE,sE,Ft,{map:4})}}function e1(o){let e='poly:"';for(let[n,l]of o.geometry.coordinates[0])e+=`${l} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class t1{constructor(e,t,n){Dn(this,"inner");this.inner=new ww(e,t,n)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=cE(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}toggleDirection(e){this.inner.toggleDirection(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}}function cE(o){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of o.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return o}async function fd(o){Es.set(o);try{let e=JSON.parse(window.localStorage.getItem(o));console.time("get OSM input");let[t,n]=await uE(e);console.timeEnd("get OSM input"),console.time("load"),$n.set(new t1(new Uint8Array(t),n,e.study_area_name||void 0)),Ir($n).loadSavefile(e),console.timeEnd("load"),i1()}catch(e){window.alert(`Couldn't open project: ${e}`),Es.set("")}}async function uE(o){if(o.study_area_name){let e=Ir(Mu)?`/osm/${o.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${o.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let n=await(await fetch(e)).arrayBuffer(),l=Ir(Mu)?`/boundaries/${o.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${o.study_area_name}.geojson`,f=await(await fetch(l)).json();return[n,f]}else{console.log("Grabbing from Overpass");let e=o.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await fetch(e1(e))).arrayBuffer(),e]}}function i1(){ri.set({mode:"network"}),tc.set(new uw(Ir(es),Ir($n).toRouteSnapper(),wi(Xl()),wi(!0),wi(0))),Ir(es).fitBounds(Ir($n).getBounds(),{animate:!1}),Iu.set(ep()),Lu.set(ep()),sd.set(ep());let o=new URL(window.location.href);o.searchParams.set("project",Ir(Es)),window.history.replaceState(null,"",o.toString())}function ep(){let o=Ir($n).getBounds(),e=o[0]+Math.random()*(o[2]-o[0]),t=o[1]+Math.random()*(o[3]-o[1]);return new Ts.LngLat(e,t)}function Iy(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function Ly(o,e,t){const n=o.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function hE(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function dE(o){let e,t,n,l,u,f,a,_;return u=new Pi({props:{$$slots:{default:[hE]},$$scope:{ctx:o}}}),u.$on("click",o[13]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),a.textContent="New project",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(b,k){he(b,e,k),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),_=!0},p(b,k){const S={};k&33554432&&(S.$$scope={dirty:k,ctx:b}),u.$set(S)},i(b){_||(ie(u.$$.fragment,b),_=!0)},o(b){oe(u.$$.fragment,b),_=!1},d(b){b&&ue(e),Ae(u)}}}function Ay(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D;e=new Xy({props:{loading:o[4]}});let B=Kn(o[3]),z=[];for(let R=0;R<B.length;R+=1)z[R]=zy(Iy(o,B,R));return S=new lE({props:{map:o[5]}}),S.$on("gotXml",o[7]),S.$on("loading",o[11]),S.$on("error",o[12]),{c(){Pe(e.$$.fragment),t=Re(),n=ce("label"),l=Qe(`Load a built-in area:
        `),u=ce("select"),f=ce("option");for(let R=0;R<z.length;R+=1)z[R].c();a=Re(),_=ce("i"),_.textContent="or...",b=Re(),k=ce("div"),Pe(S.$$.fragment),f.__value="",Bn(f,f.__value),o[2]===void 0&&Yl(()=>o[9].call(u))},m(R,O){Le(e,R,O),he(R,t,O),he(R,n,O),Y(n,l),Y(n,u),Y(u,f);for(let U=0;U<z.length;U+=1)z[U]&&z[U].m(u,null);Jl(u,o[2],!0),he(R,a,O),he(R,_,O),he(R,b,O),he(R,k,O),Le(S,k,null),I=!0,P||(D=[Et(u,"change",o[9]),Et(u,"change",o[10])],P=!0)},p(R,O){const U={};if(O&16&&(U.loading=R[4]),e.$set(U),O&8){B=Kn(R[3]);let se;for(se=0;se<B.length;se+=1){const re=Iy(R,B,se);z[se]?z[se].p(re,O):(z[se]=zy(re),z[se].c(),z[se].m(u,null))}for(;se<z.length;se+=1)z[se].d(1);z.length=B.length}O&12&&Jl(u,R[2]);const q={};O&32&&(q.map=R[5]),S.$set(q)},i(R){I||(ie(e.$$.fragment,R),ie(S.$$.fragment,R),I=!0)},o(R){oe(e.$$.fragment,R),oe(S.$$.fragment,R),I=!1},d(R){R&&(ue(t),ue(n),ue(a),ue(_),ue(b),ue(k)),Ae(e,R),Ss(z,R),Ae(S),P=!1,an(D)}}}function Py(o){let e,t=o[22]+"",n,l;return{c(){e=ce("option"),n=Qe(t),e.__value=l=o[21],Bn(e,e.__value)},m(u,f){he(u,e,f),Y(e,n)},p(u,f){f&8&&t!==(t=u[22]+"")&&Ci(n,t),f&8&&l!==(l=u[21])&&(e.__value=l,Bn(e,e.__value))},d(u){u&&ue(e)}}}function zy(o){let e,t,n=Kn(o[18]),l=[];for(let u=0;u<n.length;u+=1)l[u]=Py(Ly(o,n,u));return{c(){e=ce("optgroup");for(let u=0;u<l.length;u+=1)l[u].c();Te(e,"label",t=o[17])},m(u,f){he(u,e,f);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(u,f){if(f&8){n=Kn(u[18]);let a;for(a=0;a<n.length;a+=1){const _=Ly(u,n,a);l[a]?l[a].p(_,f):(l[a]=Py(_),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}f&8&&t!==(t=u[17])&&Te(e,"label",t)},d(u){u&&ue(e),Ss(l,u)}}}function fE(o){let e,t,n,l,u,f,a,_,b,k=o[1]&&Ay(o);return{c(){e=ce("div"),t=ce("div"),n=ce("label"),l=Qe(`Project name:
        `),u=ce("input"),f=Re(),k&&k.c(),Te(u,"type","text"),Te(e,"slot","sidebar")},m(S,I){he(S,e,I),Y(e,t),Y(t,n),Y(n,l),Y(n,u),Bn(u,o[1]),Y(e,f),k&&k.m(e,null),a=!0,_||(b=Et(u,"input",o[8]),_=!0)},p(S,I){I&2&&u.value!==S[1]&&Bn(u,S[1]),S[1]?k?(k.p(S,I),I&2&&ie(k,1)):(k=Ay(S),k.c(),ie(k,1),k.m(e,null)):k&&(gi(),oe(k,1,1,()=>{k=null}),_i())},i(S){a||(ie(k),a=!0)},o(S){oe(k),a=!1},d(S){S&&ue(e),k&&k.d(),_=!1,b()}}}function pE(o){let e,t,n;return t=new nE({}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","map")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p:Pt,i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function mE(o){let e,t;return e=new ns({props:{$$slots:{map:[pE],sidebar:[fE],top:[dE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&33554558&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function gE(o,e,t){let n,l,u,f,a;dt(o,Es,q=>t(14,n=q)),dt(o,$n,q=>t(15,l=q)),dt(o,Mu,q=>t(16,u=q)),dt(o,es,q=>t(5,f=q)),dt(o,ri,q=>t(6,a=q));let _="",b="",k=[],S="";Td(async()=>{let q=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,k=await q.json())});function I(q){t(4,S="Loading OSM");try{At($n,l=new t1(new TextEncoder().encode(q.detail.xml),q.detail.boundary,void 0),l),At(Es,n=`ltn_${_}`,n),i1(),ec()}catch(se){window.alert(`Couldn't import from Overpass: ${se}`)}t(4,S="")}async function P(){if(b=="")return;let q=`ltn_${_}`;window.localStorage.setItem(q,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:b})),t(4,S=`Loading pre-clipped OSM area ${b}`),await fd(q),t(4,S="")}function D(){_=this.value,t(1,_)}function B(){b=Cp(this),t(2,b),t(3,k)}return[P,_,b,k,S,f,a,I,D,B,()=>P(),q=>t(4,S=q.detail),q=>window.alert(q.detail),()=>At(ri,a={mode:"title",firstLoad:!1},a)]}class _E extends Zt{constructor(e){super(),qt(this,e,gE,mE,Ft,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Dy(o,e,t){const n=o.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function Ry(o,e,t){const n=o.slice();return n[23]=e[t],n}function yE(o){let e;return{c(){e=ce("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',Te(e,"slot","top")},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function vE(o){let e;return{c(){e=ce("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){he(t,e,n)},p:Pt,i:Pt,o:Pt,d(t){t&&ue(e)}}}function bE(o){let e,t,n,l,u,f,a,_,b,k,S,I,P;t=new Pi({props:{$$slots:{default:[wE]},$$scope:{ctx:o}}}),t.$on("click",o[11]);let D=Kn(o[2]),B=[];for(let R=0;R<D.length;R+=1)B[R]=Fy(Dy(o,D,R));const z=R=>oe(B[R],1,1,()=>{B[R]=null});return{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent="Load a saved project:",u=Re(),f=ce("ul");for(let R=0;R<B.length;R+=1)B[R].c();a=Re(),_=ce("label"),b=Qe(`Load a project from a file
        `),k=ce("input"),Te(k,"type","file")},m(R,O){he(R,e,O),Le(t,e,null),he(R,n,O),he(R,l,O),he(R,u,O),he(R,f,O);for(let U=0;U<B.length;U+=1)B[U]&&B[U].m(f,null);he(R,a,O),he(R,_,O),Y(_,b),Y(_,k),o[15](k),S=!0,I||(P=Et(k,"change",o[6]),I=!0)},p(R,O){const U={};if(O&67108864&&(U.$$scope={dirty:O,ctx:R}),t.$set(U),O&900){D=Kn(R[2]);let q;for(q=0;q<D.length;q+=1){const se=Dy(R,D,q);B[q]?(B[q].p(se,O),ie(B[q],1)):(B[q]=Fy(se),B[q].c(),ie(B[q],1),B[q].m(f,null))}for(gi(),q=D.length;q<B.length;q+=1)z(q);_i()}},i(R){if(!S){ie(t.$$.fragment,R);for(let O=0;O<D.length;O+=1)ie(B[O]);S=!0}},o(R){oe(t.$$.fragment,R),B=B.filter(Boolean);for(let O=0;O<B.length;O+=1)oe(B[O]);S=!1},d(R){R&&(ue(e),ue(n),ue(l),ue(u),ue(f),ue(a),ue(_)),Ae(t),Ss(B,R),o[15](null),I=!1,P()}}}function wE(o){let e;return{c(){e=Qe("New project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function xE(o){let e=o[23].slice(4)+"",t;return{c(){t=Qe(e)},m(n,l){he(n,t,l)},p(n,l){l&4&&e!==(e=n[23].slice(4)+"")&&Ci(t,e)},d(n){n&&ue(t)}}}function By(o){let e,t,n,l,u,f,a,_,b,k,S;function I(){return o[12](o[23])}n=new Pi({props:{$$slots:{default:[xE]},$$scope:{ctx:o}}}),n.$on("click",I);function P(){return o[13](o[23])}function D(){return o[14](o[23])}return{c(){e=ce("li"),t=ce("span"),Pe(n.$$.fragment),l=Re(),u=ce("button"),u.innerHTML=`<img src="${W0}" alt="Rename project"/>`,f=Re(),a=ce("button"),a.innerHTML=`<img src="${G0}" alt="Delete project"/>`,_=Re(),Te(u,"class","secondary"),Te(a,"class","secondary"),fn(t,"display","flex"),fn(t,"justify-content","space-between")},m(B,z){he(B,e,z),Y(e,t),Le(n,t,null),Y(t,l),Y(t,u),Y(t,f),Y(t,a),Y(e,_),b=!0,k||(S=[Et(u,"click",P),Et(a,"click",D)],k=!0)},p(B,z){o=B;const R={};z&67108868&&(R.$$scope={dirty:z,ctx:o}),n.$set(R)},i(B){b||(ie(n.$$.fragment,B),b=!0)},o(B){oe(n.$$.fragment,B),b=!1},d(B){B&&ue(e),Ae(n),k=!1,an(S)}}}function Fy(o){let e,t=(o[19]??"custom area")+"",n,l,u,f,a=Kn(o[20]),_=[];for(let k=0;k<a.length;k+=1)_[k]=By(Ry(o,a,k));const b=k=>oe(_[k],1,1,()=>{_[k]=null});return{c(){e=ce("u"),n=Qe(t),l=Re();for(let k=0;k<_.length;k+=1)_[k].c();u=En()},m(k,S){he(k,e,S),Y(e,n),he(k,l,S);for(let I=0;I<_.length;I+=1)_[I]&&_[I].m(k,S);he(k,u,S),f=!0},p(k,S){if((!f||S&4)&&t!==(t=(k[19]??"custom area")+"")&&Ci(n,t),S&900){a=Kn(k[20]);let I;for(I=0;I<a.length;I+=1){const P=Ry(k,a,I);_[I]?(_[I].p(P,S),ie(_[I],1)):(_[I]=By(P),_[I].c(),ie(_[I],1),_[I].m(u.parentNode,u))}for(gi(),I=a.length;I<_.length;I+=1)b(I);_i()}},i(k){if(!f){for(let S=0;S<a.length;S+=1)ie(_[S]);f=!0}},o(k){_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)oe(_[S]);f=!1},d(k){k&&(ue(e),ue(l),ue(u)),Ss(_,k)}}}function kE(o){let e,t,n,l;const u=[bE,vE],f=[];function a(_,b){return _[4]&&_[0]?0:1}return t=a(o),n=f[t]=u[t](o),{c(){e=ce("div"),n.c(),Te(e,"slot","sidebar")},m(_,b){he(_,e,b),f[t].m(e,null),l=!0},p(_,b){let k=t;t=a(_),t===k?f[t].p(_,b):(gi(),oe(f[k],1,1,()=>{f[k]=null}),_i(),n=f[t],n?n.p(_,b):(n=f[t]=u[t](_),n.c()),ie(n,1),n.m(e,null))},i(_){l||(ie(n),l=!0)},o(_){oe(n),l=!1},d(_){_&&ue(e),f[t].d()}}}function SE(o){let e,t,n,l;return e=new Xy({props:{loading:o[1]}}),n=new ns({props:{$$slots:{sidebar:[kE],top:[yE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,f){Le(e,u,f),he(u,t,f),Le(n,u,f),l=!0},p(u,[f]){const a={};f&2&&(a.loading=u[1]),e.$set(a);const _={};f&67108925&&(_.$$scope={dirty:f,ctx:u}),n.$set(_)},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){oe(e.$$.fragment,u),oe(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function nd(){let o=new Map,e=[];for(let n=0;n<window.localStorage.length;n++){let l=window.localStorage.key(n);if(l.startsWith("ltn_")){let u="";try{u=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}u&&u.length>0?(o.has(u)||o.set(u,[]),o.get(u).push(l)):e.push(l)}}let t=[...o.entries()];return t.sort((n,l)=>n[0].localeCompare(l[0])),t.push(["custom",e]),t}function TE(o,e,t){let n,l,u,f,a;dt(o,Es,re=>t(16,n=re)),dt(o,tc,re=>t(17,l=re)),dt(o,$n,re=>t(18,u=re)),dt(o,es,re=>t(4,f=re)),dt(o,ri,re=>t(5,a=re));let{wasmReady:_}=e,{firstLoad:b}=e,k="";if(At($n,u=null,u),At(tc,l=null,l),At(Es,n="",n),b){let H=new URLSearchParams(window.location.search).get("project");H&&fd(H)}else{let re=new URL(window.location.href);re.searchParams.delete("project"),window.history.replaceState(null,"",re.toString())}let S=nd(),I;async function P(re){let H="ltn_"+I.files[0].name;t(1,k=`Loading from file ${H}`),window.localStorage.setItem(H,await I.files[0].text()),t(2,S=nd()),await fd(H),t(1,k="")}function D(re){window.confirm(`Really delete project ${re}? You can't undo this.`)&&(window.localStorage.removeItem(re),t(2,S=nd()))}function B(re){let H=window.prompt(`Rename project ${re} to what?`,re);if(H){H.startsWith("ltn_")||(H=`ltn_${H}`);let ee=window.localStorage.getItem(re);window.localStorage.setItem(H,ee),window.localStorage.removeItem(re),t(2,S=nd())}}async function z(re){t(1,k=`Loading project ${re}`),await fd(re),t(1,k="")}const R=()=>At(ri,a={mode:"new-project"},a),O=re=>z(re),U=re=>B(re),q=re=>D(re);function se(re){Xi[re?"unshift":"push"](()=>{I=re,t(3,I)})}return o.$$set=re=>{"wasmReady"in re&&t(0,_=re.wasmReady),"firstLoad"in re&&t(10,b=re.firstLoad)},[_,k,S,I,f,a,P,D,B,z,b,R,O,U,q,se]}class EE extends Zt{constructor(e){super(),qt(this,e,TE,SE,Ft,{wasmReady:0,firstLoad:10})}}const{window:CE}=Sd;function ME(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function IE(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function LE(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function AE(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D;return u=new Pi({props:{$$slots:{default:[ME]},$$scope:{ctx:o}}}),u.$on("click",o[8]),_=new Pi({props:{$$slots:{default:[IE]},$$scope:{ctx:o}}}),_.$on("click",o[9]),S=new Pi({props:{$$slots:{default:[LE]},$$scope:{ctx:o}}}),S.$on("click",o[4]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),f=Re(),a=ce("li"),Pe(_.$$.fragment),b=Re(),k=ce("li"),Pe(S.$$.fragment),I=Re(),P=ce("li"),P.textContent="Viewing shortcuts",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(B,z){he(B,e,z),Y(e,t),Y(t,n),Y(n,l),Le(u,l,null),Y(n,f),Y(n,a),Le(_,a,null),Y(n,b),Y(n,k),Le(S,k,null),Y(n,I),Y(n,P),D=!0},p(B,z){const R={};z&8192&&(R.$$scope={dirty:z,ctx:B}),u.$set(R);const O={};z&8192&&(O.$$scope={dirty:z,ctx:B}),_.$set(O);const U={};z&8192&&(U.$$scope={dirty:z,ctx:B}),S.$set(U)},i(B){D||(ie(u.$$.fragment,B),ie(_.$$.fragment,B),ie(S.$$.fragment,B),D=!0)},o(B){oe(u.$$.fragment,B),oe(_.$$.fragment,B),oe(S.$$.fragment,B),D=!1},d(B){B&&ue(e),Ae(u),Ae(_),Ae(S)}}}function PE(o){let e,t,n,l,u,f,a,_,b,k=o[0].shortcutIndex+1+"",S,I,P=o[0].gj.features.length+"",D,B,z,R,O,U,q,se,re,H=gr(o[0].gj.features[o[0].shortcutIndex].properties).directness.toFixed(1)+"",ee,ve,Oe,ne,ye;return{c(){e=ce("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=Re(),n=ce("button"),n.textContent="Pick a different road",l=Re(),u=ce("div"),f=ce("button"),a=Qe("Previous"),b=Re(),S=Qe(k),I=Qe(" / "),D=Qe(P),B=Re(),z=ce("button"),R=Qe("Next"),U=Re(),q=ce("p"),se=Qe("This shortcut is "),re=ce("b"),ee=Qe(H),ve=Qe("x"),Oe=Qe(`
        the length of the shortest route using all roads, not just this neighbourhood`),f.disabled=_=o[0].shortcutIndex==0,Te(f,"data-tooltip","Left"),z.disabled=O=o[0].shortcutIndex==o[0].gj.features.length-1,Te(z,"data-tooltip","Right"),fn(u,"display","flex"),fn(u,"justify-content","space-between")},m(Ke,Ce){he(Ke,e,Ce),he(Ke,t,Ce),he(Ke,n,Ce),he(Ke,l,Ce),he(Ke,u,Ce),Y(u,f),Y(f,a),Y(u,b),Y(u,S),Y(u,I),Y(u,D),Y(u,B),Y(u,z),Y(z,R),he(Ke,U,Ce),he(Ke,q,Ce),Y(q,se),Y(q,re),Y(re,ee),Y(re,ve),Y(q,Oe),ne||(ye=[Et(n,"click",o[7]),Et(f,"click",o[5]),Et(z,"click",o[6])],ne=!0)},p(Ke,Ce){Ce&1&&_!==(_=Ke[0].shortcutIndex==0)&&(f.disabled=_),Ce&1&&k!==(k=Ke[0].shortcutIndex+1+"")&&Ci(S,k),Ce&1&&P!==(P=Ke[0].gj.features.length+"")&&Ci(D,P),Ce&1&&O!==(O=Ke[0].shortcutIndex==Ke[0].gj.features.length-1)&&(z.disabled=O),Ce&1&&H!==(H=gr(Ke[0].gj.features[Ke[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Ci(ee,H)},d(Ke){Ke&&(ue(e),ue(t),ue(n),ue(l),ue(u),ue(U),ue(q)),ne=!1,an(ye)}}}function zE(o){let e;return{c(){e=ce("p"),e.textContent="Click a road to see shortcuts"},m(t,n){he(t,e,n)},p:Pt,d(t){t&&ue(e)}}}function DE(o){let e,t,n,l;t=new qu({}),t.$on("click",o[4]);function u(_,b){if(_[0].state=="neutral")return zE;if(_[0].state=="chose-road")return PE}let f=u(o),a=f&&f(o);return{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),a&&a.c(),Te(e,"slot","sidebar")},m(_,b){he(_,e,b),Le(t,e,null),Y(e,n),a&&a.m(e,null),l=!0},p(_,b){f===(f=u(_))&&a?a.p(_,b):(a&&a.d(1),a=f&&f(_),a&&(a.c(),a.m(e,null)))},i(_){l||(ie(t.$$.fragment,_),l=!0)},o(_){oe(t.$$.fragment,_),l=!1},d(_){_&&ue(e),Ae(t),a&&a.d()}}}function RE(o){let e,t;return e=new Zu({props:{interactive:!1}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function BE(o){let e,t;return e=new Zu({props:{onClickLine:o[2],$$slots:{"line-popup":[OE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&8192&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function FE(o){let e,t=o[12].shortcuts+"",n,l,u=(o[12].name??"unnamed road")+"",f;return{c(){e=ce("p"),n=Qe(t),l=Qe(" shortcuts through "),f=Qe(u)},m(a,_){he(a,e,_),Y(e,n),Y(e,l),Y(e,f)},p(a,_){_&4096&&t!==(t=a[12].shortcuts+"")&&Ci(n,t),_&4096&&u!==(u=(a[12].name??"unnamed road")+"")&&Ci(f,u)},d(a){a&&ue(e)}}}function OE(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[FE,({props:l})=>({12:l}),({props:l})=>l?4096:0]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const f={};u&12288&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){oe(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function NE(o){let e,t,n,l,u,f,a,_,b,k;e=new Rd({}),n=new Dd({}),u=new Bd({});const S=[BE,RE],I=[];function P(D,B){return D[0].state=="neutral"?0:D[0].state=="chose-road"?1:-1}return~(a=P(o))&&(_=I[a]=S[a](o)),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),_&&_.c(),b=En()},m(D,B){Le(e,D,B),he(D,t,B),Le(n,D,B),he(D,l,B),Le(u,D,B),he(D,f,B),~a&&I[a].m(D,B),he(D,b,B),k=!0},p(D,B){let z=a;a=P(D),a===z?~a&&I[a].p(D,B):(_&&(gi(),oe(I[z],1,1,()=>{I[z]=null}),_i()),~a?(_=I[a],_?_.p(D,B):(_=I[a]=S[a](D),_.c()),ie(_,1),_.m(b.parentNode,b)):_=null)},i(D){k||(ie(e.$$.fragment,D),ie(n.$$.fragment,D),ie(u.$$.fragment,D),ie(_),k=!0)},o(D){oe(e.$$.fragment,D),oe(n.$$.fragment,D),oe(u.$$.fragment,D),oe(_),k=!1},d(D){D&&(ue(t),ue(l),ue(f),ue(b)),Ae(e,D),Ae(n,D),Ae(u,D),~a&&I[a].d(D)}}}function Oy(o){let e,t,n,l,u,f,a,_;return e=new Lr({props:{data:o[0].gj.features[o[0].shortcutIndex],$$slots:{default:[jE]},$$scope:{ctx:o}}}),n=new Lr({props:{data:o[0].roadGj,$$slots:{default:[UE]},$$scope:{ctx:o}}}),u=new Fu({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[VE]},$$scope:{ctx:o}}}),a=new Fu({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[o[0].gj.features[o[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[qE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),Pe(a.$$.fragment)},m(b,k){Le(e,b,k),he(b,t,k),Le(n,b,k),he(b,l,k),Le(u,b,k),he(b,f,k),Le(a,b,k),_=!0},p(b,k){const S={};k&1&&(S.data=b[0].gj.features[b[0].shortcutIndex]),k&8192&&(S.$$scope={dirty:k,ctx:b}),e.$set(S);const I={};k&1&&(I.data=b[0].roadGj),k&8192&&(I.$$scope={dirty:k,ctx:b}),n.$set(I);const P={};k&1&&(P.lngLat=b[0].gj.features[b[0].shortcutIndex].geometry.coordinates[0]),k&8192&&(P.$$scope={dirty:k,ctx:b}),u.$set(P);const D={};k&1&&(D.lngLat=b[0].gj.features[b[0].shortcutIndex].geometry.coordinates[b[0].gj.features[b[0].shortcutIndex].geometry.coordinates.length-1]),k&8192&&(D.$$scope={dirty:k,ctx:b}),a.$set(D)},i(b){_||(ie(e.$$.fragment,b),ie(n.$$.fragment,b),ie(u.$$.fragment,b),ie(a.$$.fragment,b),_=!0)},o(b){oe(e.$$.fragment,b),oe(n.$$.fragment,b),oe(u.$$.fragment,b),oe(a.$$.fragment,b),_=!1},d(b){b&&(ue(t),ue(l),ue(f)),Ae(e,b),Ae(n,b),Ae(u,b),Ae(a,b)}}}function jE(o){let e,t;const n=[mn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function UE(o){let e,t;const n=[mn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function VE(o){let e;return{c(){e=Qe("A")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function qE(o){let e;return{c(){e=Qe("B")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function ZE(o){let e,t,n,l,u,f;t=new Wu({props:{$$slots:{default:[NE]},$$scope:{ctx:o}}});let a=o[0].state=="chose-road"&&Oy(o);return u=new Gu({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),a&&a.c(),l=Re(),Pe(u.$$.fragment),Te(e,"slot","map")},m(_,b){he(_,e,b),Le(t,e,null),Y(e,n),a&&a.m(e,null),Y(e,l),Le(u,e,null),f=!0},p(_,b){const k={};b&8193&&(k.$$scope={dirty:b,ctx:_}),t.$set(k),_[0].state=="chose-road"?a?(a.p(_,b),b&1&&ie(a,1)):(a=Oy(_),a.c(),ie(a,1),a.m(e,l)):a&&(gi(),oe(a,1,1,()=>{a=null}),_i())},i(_){f||(ie(t.$$.fragment,_),ie(a),ie(u.$$.fragment,_),f=!0)},o(_){oe(t.$$.fragment,_),oe(a),oe(u.$$.fragment,_),f=!1},d(_){_&&ue(e),Ae(t),a&&a.d(),Ae(u)}}}function GE(o){let e,t,n,l;return e=new ns({props:{$$slots:{map:[ZE],sidebar:[DE],top:[AE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0,n||(l=Et(CE,"keydown",o[3]),n=!0)},p(u,[f]){const a={};f&8195&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function WE(o,e,t){let n,l,u;dt(o,ri,B=>t(1,n=B)),dt(o,es,B=>t(10,l=B)),dt(o,$n,B=>t(11,u=B));let f={state:"neutral"};function a(B,z){let R=u.getShortcutsCrossingRoad(B.properties.id);if(R.features.length==0){window.alert("No shortcuts here");return}t(0,f={state:"chose-road",roadGj:B,gj:R,shortcutIndex:0})}Td(()=>{l==null||l.keyboard.disable()}),Qn(()=>{l==null||l.keyboard.enable()});function _(B){f.state=="chose-road"&&(B.key=="ArrowLeft"&&f.shortcutIndex>0&&(B.stopPropagation(),t(0,f.shortcutIndex--,f)),B.key=="ArrowRight"&&(B.stopPropagation(),f.shortcutIndex!=f.gj.features.length-1&&t(0,f.shortcutIndex++,f)))}function b(){At(ri,n={mode:"neighbourhood"},n)}function k(){f.state=="chose-road"&&t(0,f.shortcutIndex--,f)}function S(){f.state=="chose-road"&&t(0,f.shortcutIndex++,f)}return[f,n,a,_,b,k,S,()=>t(0,f={state:"neutral"}),()=>At(ri,n={mode:"title",firstLoad:!1},n),()=>At(ri,n={mode:"network"},n)]}class $E extends Zt{constructor(e){super(),qt(this,e,WE,GE,Ft,{})}}function HE(o){let e,t,n,l,u,f,a,_,b;return l=new y5({}),{c(){e=ce("div"),t=ce("button"),t.innerHTML=`<img src="${ab}" style="height: 6vh;" alt="A/B Street logo"/>`,n=Re(),Pe(l.$$.fragment),u=Re(),f=ce("span"),Te(t,"class","outline"),fn(f,"width","100%"),Te(e,"slot","top"),fn(e,"display","flex")},m(k,S){he(k,e,S),Y(e,t),Y(e,n),Le(l,e,null),Y(e,u),Y(e,f),o[19](f),a=!0,_||(b=Et(t,"click",o[18]),_=!0)},p:Pt,i(k){a||(ie(l.$$.fragment,k),a=!0)},o(k){oe(l.$$.fragment,k),a=!1},d(k){k&&ue(e),Ae(l),o[19](null),_=!1,b()}}}function Ny(o){let e,t,n,l,u,f;return n=new o4({props:{map:gr(o[6]),maptilerBasemap:o[7]}}),{c(){e=ce("button"),e.textContent="Zoom to fit study area",t=Re(),Pe(n.$$.fragment),Te(e,"class","secondary")},m(a,_){he(a,e,_),he(a,t,_),Le(n,a,_),l=!0,u||(f=Et(e,"click",o[10]),u=!0)},p(a,_){const b={};_&64&&(b.map=gr(a[6])),_&128&&(b.maptilerBasemap=a[7]),n.$set(b)},i(a){l||(ie(n.$$.fragment,a),l=!0)},o(a){oe(n.$$.fragment,a),l=!1},d(a){a&&(ue(e),ue(t)),Ae(n,a),u=!1,f()}}}function XE(o){let e,t,n,l,u,f,a=o[5]&&Ny(o);return{c(){e=ce("div"),t=ce("div"),n=Re(),l=ce("hr"),u=Re(),a&&a.c(),Te(e,"slot","left")},m(_,b){he(_,e,b),Y(e,t),o[17](t),Y(e,n),Y(e,l),Y(e,u),a&&a.m(e,null),f=!0},p(_,b){_[5]?a?(a.p(_,b),b&32&&ie(a,1)):(a=Ny(_),a.c(),ie(a,1),a.m(e,null)):a&&(gi(),oe(a,1,1,()=>{a=null}),_i())},i(_){f||(ie(a),f=!0)},o(_){oe(a),f=!1},d(_){_&&ue(e),o[17](null),a&&a.d()}}}function KE(o){let e,t;return e=new _E({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function JE(o){let e,t;return e=new EE({props:{wasmReady:o[4],firstLoad:o[8].firstLoad}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.wasmReady=n[4]),l&256&&(u.firstLoad=n[8].firstLoad),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function jy(o){let e,t,n,l,u,f;e=new Lr({props:{data:o[5].getInvertedBoundary(),$$slots:{default:[YE]},$$scope:{ctx:o}}});const a=[sC,oC,rC,nC,iC,tC,eC,QE],_=[];function b(k,S){return k[8].mode=="network"?0:k[8].mode=="set-boundary"?1:k[8].mode=="auto-boundaries"?2:k[8].mode=="neighbourhood"?3:k[8].mode=="view-shortcuts"?4:k[8].mode=="impact-one-destination"?5:k[8].mode=="route"?6:k[8].mode=="debug"?7:-1}return~(n=b(o))&&(l=_[n]=a[n](o)),{c(){Pe(e.$$.fragment),t=Re(),l&&l.c(),u=En()},m(k,S){Le(e,k,S),he(k,t,S),~n&&_[n].m(k,S),he(k,u,S),f=!0},p(k,S){const I={};S&32&&(I.data=k[5].getInvertedBoundary()),S&2097152&&(I.$$scope={dirty:S,ctx:k}),e.$set(I);let P=n;n=b(k),n===P?~n&&_[n].p(k,S):(l&&(gi(),oe(_[P],1,1,()=>{_[P]=null}),_i()),~n?(l=_[n],l?l.p(k,S):(l=_[n]=a[n](k),l.c()),ie(l,1),l.m(u.parentNode,u)):l=null)},i(k){f||(ie(e.$$.fragment,k),ie(l),f=!0)},o(k){oe(e.$$.fragment,k),oe(l),f=!1},d(k){k&&(ue(t),ue(u)),Ae(e,k),~n&&_[n].d(k)}}}function YE(o){let e,t;const n=[mn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=sn(l,n[u]);return e=new Cs({props:l}),{c(){Pe(e.$$.fragment)},m(u,f){Le(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){oe(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function QE(o){let e,t;return e=new t3({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function eC(o){let e,t;return e=new NT({props:{prevMode:o[8].prevMode}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.prevMode=n[8].prevMode),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function tC(o){let e,t;return e=new hT({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function iC(o){let e,t;return e=new $E({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function nC(o){let e,t;return e=new K3({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function rC(o){let e,t;return e=new w4({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function oC(o){let e,t;return e=new f5({props:{name:o[8].name,existing:o[8].existing}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.name=n[8].name),l&256&&(u.existing=n[8].existing),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function sC(o){let e,t;return e=new ET({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Pt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function aC(o){let e,t,n,l,u,f,a,_,b,k,S,I,P,D;e=new v0({}),n=new b0({}),u=new lS({props:{map:o[0],apiKey:sp,country:void 0}});const B=[JE,KE],z=[];function R(U,q){return U[8].mode=="title"?0:U[8].mode=="new-project"?1:-1}~(b=R(o))&&(k=z[b]=B[b](o));let O=o[5]&&jy(o);return P=new jS({}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),f=Re(),a=ce("div"),_=Re(),k&&k.c(),S=Re(),O&&O.c(),I=Re(),Pe(P.$$.fragment)},m(U,q){Le(e,U,q),he(U,t,q),Le(n,U,q),he(U,l,q),Le(u,U,q),he(U,f,q),he(U,a,q),o[14](a),he(U,_,q),~b&&z[b].m(U,q),he(U,S,q),O&&O.m(U,q),he(U,I,q),Le(P,U,q),D=!0},p(U,q){const se={};q&1&&(se.map=U[0]),u.$set(se);let re=b;b=R(U),b===re?~b&&z[b].p(U,q):(k&&(gi(),oe(z[re],1,1,()=>{z[re]=null}),_i()),~b?(k=z[b],k?k.p(U,q):(k=z[b]=B[b](U),k.c()),ie(k,1),k.m(S.parentNode,S)):k=null),U[5]?O?(O.p(U,q),q&32&&ie(O,1)):(O=jy(U),O.c(),ie(O,1),O.m(I.parentNode,I)):O&&(gi(),oe(O,1,1,()=>{O=null}),_i())},i(U){D||(ie(e.$$.fragment,U),ie(n.$$.fragment,U),ie(u.$$.fragment,U),ie(k),ie(O),ie(P.$$.fragment,U),D=!0)},o(U){oe(e.$$.fragment,U),oe(n.$$.fragment,U),oe(u.$$.fragment,U),oe(k),oe(O),oe(P.$$.fragment,U),D=!1},d(U){U&&(ue(t),ue(l),ue(f),ue(a),ue(_),ue(S),ue(I)),Ae(e,U),Ae(n,U),Ae(u,U),o[14](null),~b&&z[b].d(U),O&&O.d(U),Ae(P,U)}}}function lC(o){let e,t,n,l;function u(a){o[15](a)}let f={style:`https://api.maptiler.com/maps/${o[7]}/style.json?key=${sp}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:sb}],$$slots:{default:[aC]},$$scope:{ctx:o}};return o[0]!==void 0&&(f.map=o[0]),t=new hx({props:f}),Xi.push(()=>Wr(t,"map",u)),t.$on("error",o[16]),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","main"),fn(e,"position","relative"),fn(e,"width","100%"),fn(e,"height","100%")},m(a,_){he(a,e,_),Le(t,e,null),l=!0},p(a,_){const b={};_&128&&(b.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${sp}`),_&2097465&&(b.$$scope={dirty:_,ctx:a}),!n&&_&1&&(n=!0,b.map=a[0],Gr(()=>n=!1)),t.$set(b)},i(a){l||(ie(t.$$.fragment,a),l=!0)},o(a){oe(t.$$.fragment,a),l=!1},d(a){a&&ue(e),Ae(t)}}}function cC(o){let e,t,n,l;return e=new pw({}),n=new MS({props:{$$slots:{main:[lC],left:[XE],top:[HE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,f){Le(e,u,f),he(u,t,f),Le(n,u,f),l=!0},p(u,[f]){const a={};f&2098175&&(a.$$scope={dirty:f,ctx:u}),n.$set(a)},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){oe(e.$$.fragment,u),oe(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function uC(o,e,t){let n,l,u,f,a,_,b,k,S;dt(o,wp,ee=>t(11,n=ee)),dt(o,bp,ee=>t(12,l=ee)),dt(o,vp,ee=>t(13,u=ee)),dt(o,$n,ee=>t(5,f=ee)),dt(o,es,ee=>t(6,a=ee)),dt(o,Mu,ee=>t(20,_=ee)),dt(o,ap,ee=>t(7,b=ee)),dt(o,ri,ee=>t(8,k=ee)),dt(o,vd,ee=>t(9,S=ee));let I=!1;Td(async()=>{await _0(),await t0(),t(4,I=!0);try{(await fetch("/osm/areas.json")).ok&&(At(Mu,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let P=null;function D(){a.fitBounds(f.getBounds(),{animate:!1})}let B,z,R;function O(ee){Xi[ee?"unshift":"push"](()=>{R=ee,t(3,R),t(11,n)})}function U(ee){P=ee,t(0,P)}const q=ee=>{console.log(ee.detail.error)};function se(ee){Xi[ee?"unshift":"push"](()=>{z=ee,t(2,z),t(12,l)})}const re=()=>At(vd,S=!0,S);function H(ee){Xi[ee?"unshift":"push"](()=>{B=ee,t(1,B),t(13,u)})}return o.$$.update=()=>{o.$$.dirty&1&&P&&es.set(P),o.$$.dirty&8194&&B&&u&&(t(1,B.innerHTML="",B),B.appendChild(u)),o.$$.dirty&4100&&z&&l&&(t(2,z.innerHTML="",z),z.appendChild(l)),o.$$.dirty&2056&&R&&n&&(t(3,R.innerHTML="",R),R.appendChild(n))},[P,B,z,R,I,f,a,b,k,S,D,n,l,u,O,U,q,se,re,H]}class hC extends Zt{constructor(e){super(),qt(this,e,uC,cC,Ft,{})}}new hC({target:document.getElementById("app")});
