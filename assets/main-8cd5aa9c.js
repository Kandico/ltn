var qs=Object.defineProperty;var Js=(r,e,n)=>e in r?qs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var mt=(r,e,n)=>(Js(r,typeof e!="symbol"?e+"":e,n),n);import{S as se,i as ae,s as oe,e as Ze,a as w,n as Q,d as $,b as k,t as j,c as M,f as N,g as p,h as re,j as le,k as Be,l as V,u as Re,m as De,o as Ue,p as b,q as L,r as lt,v as je,w as He,x as Me,y as st,z as Zs,A as so,B as Ys,C as he,D as be,E as X,F as _r,G as T,H as A,I as F,J as te,L as Di,K as ut,M as ct,N as ao,O as pt,P as fo,Q as Tt,R as Ks,T as _n,U as ko,V as Or,W as Ui,X as qr,Y as Xs,Z as Xt,_ as Vs,$ as $r,a0 as Qs,a1 as xs,a2 as ea,a3 as ta,a4 as mr,a5 as na,a6 as qe,a7 as an,a8 as wt,a9 as Jr,aa as fn,ab as Mt,ac as Ve,ad as $t,ae as _e,af as qt,ag as pr,ah as So,ai as Vt,aj as Qt,ak as Hi,al as Gi,am as Gt,an as Ct,ao as tt,ap as Ke,aq as Lo,ar as ra,as as oa,at as la,au as ia,av as gt,aw as at,ax as Ce,ay as Zt,az as ce,aA as qn,aB as xe,aC as uo,aD as Mn,aE as gr,aF as Zr,aG as co,aH as Nt,aI as Wi,aJ as Yr,aK as Co,aL as sr,aM as Jn,aN as Zn,aO as Kr,aP as Mo,aQ as sa,aR as Xr,aS as aa,aT as To,aU as fa,aV as ua}from"./pico.conditional.jade.min-f16f9f44.js";function ze(r,e){const n={},t={},o={$$scope:1};let l=r.length;for(;l--;){const i=r[l],s=e[l];if(s){for(const a in i)a in s||(t[a]=1);for(const a in s)o[a]||(n[a]=s[a],o[a]=1);r[l]=s}else for(const a in i)o[a]=1}for(const i in t)i in n||(n[i]=void 0);return n}function kr(r){return typeof r=="object"&&r!==null?r:{}}const ca="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",da="/ltn/assets/logo-97f2d067.svg",qi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function Ao(r){let e,n,t,o=r[1]!=null&&Fo(r);return{c(){e=k("div"),n=j(r[0]),t=M(),o&&o.c(),N(e,"class","cover svelte-1w7hi45")},m(l,i){w(l,e,i),p(e,n),p(e,t),o&&o.m(e,null)},p(l,i){i&1&&re(n,l[0]),l[1]!=null?o?o.p(l,i):(o=Fo(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&$(e),o&&o.d()}}}function Fo(r){let e,n;return{c(){e=k("div"),n=k("progress"),n.value=r[1],le(n,"width","100%")},m(t,o){w(t,e,o),p(e,n)},p(t,o){o&2&&(n.value=t[1])},d(t){t&&$(e)}}}function _a(r){let e,n=r[0]&&Ao(r);return{c(){n&&n.c(),e=Ze()},m(t,o){n&&n.m(t,o),w(t,e,o)},p(t,[o]){t[0]?n?n.p(t,o):(n=Ao(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Q,o:Q,d(t){t&&$(e),n&&n.d(t)}}}function ma(r,e,n){let{loading:t}=e,{progress:o=null}=e;return r.$$set=l=>{"loading"in l&&n(0,t=l.loading),"progress"in l&&n(1,o=l.progress)},[t,o]}class Ji extends se{constructor(e){super(),ae(this,e,ma,_a,oe,{loading:0,progress:1})}}const pa=r=>({dialog:r&1}),Po=r=>({dialog:r[0]});function ga(r){let e,n,t,o,l;const i=r[4].default,s=Be(i,r,r[3],Po);return{c(){e=k("dialog"),n=k("article"),s&&s.c(),e.open=!0},m(a,f){w(a,e,f),p(e,n),s&&s.m(n,null),r[6](e),t=!0,o||(l=[V(window,"click",r[1]),V(window,"keydown",r[2]),V(e,"close",r[5])],o=!0)},p(a,[f]){s&&s.p&&(!t||f&9)&&Re(s,i,a,a[3],t?Ue(i,a[3],f,pa):De(a[3]),Po)},i(a){t||(b(s,a),t=!0)},o(a){L(s,a),t=!1},d(a){a&&$(e),s&&s.d(a),r[6](null),o=!1,lt(l)}}}function ha(r,e,n){let{$$slots:t={},$$scope:o}=e,l;function i(u){l.open&&u.target==l&&l.close()}function s(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),l.close())}function a(u){je.call(this,r,u)}function f(u){He[u?"unshift":"push"](()=>{l=u,n(0,l)})}return r.$$set=u=>{"$$scope"in u&&n(3,o=u.$$scope)},[l,i,s,o,t,a,f]}class Sr extends se{constructor(e){super(),ae(this,e,ha,ga,oe,{})}}function Io(r,e,n){const t=r.slice();return t[1]=e[n][0],t[2]=e[n][1],t}function Eo(r){let e,n,t=r[1]+"",o,l,i,s=r[2]+"",a,f;return{c(){e=k("tr"),n=k("td"),o=j(t),l=M(),i=k("td"),a=j(s),f=M()},m(u,c){w(u,e,c),p(e,n),p(n,o),p(e,l),p(e,i),p(i,a),p(e,f)},p(u,c){c&1&&t!==(t=u[1]+"")&&re(o,t),c&1&&s!==(s=u[2]+"")&&re(a,s)},d(u){u&&$(e)}}}function ba(r){let e,n,t=Me(Object.entries(r[0])),o=[];for(let l=0;l<t.length;l+=1)o[l]=Eo(Io(r,t,l));return{c(){e=k("table"),n=k("tbody");for(let l=0;l<o.length;l+=1)o[l].c();N(e,"class","svelte-lh2o9l")},m(l,i){w(l,e,i),p(e,n);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(n,null)},p(l,[i]){if(i&1){t=Me(Object.entries(l[0]));let s;for(s=0;s<t.length;s+=1){const a=Io(l,t,s);o[s]?o[s].p(a,i):(o[s]=Eo(a),o[s].c(),o[s].m(n,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},i:Q,o:Q,d(l){l&&$(e),st(o,l)}}}function va(r,e,n){let{properties:t}=e;return r.$$set=o=>{"properties"in o&&n(0,t=o.properties)},[t]}class Vn extends se{constructor(e){super(),ae(this,e,va,ba,oe,{properties:0})}}function No(r,e,n){const t=r.slice();return t[2]=e[n][0],t[6]=e[n][1],t}function jo(r,e,n){const t=r.slice();return t[2]=e[n][0],t[3]=e[n][1],t}function zo(r,e,n){const t=r.slice();return t[3]=e[n][0],t[6]=e[n][1],t}function ya(r){let e,n=Me(Object.entries(r[0])),t=[];for(let o=0;o<n.length;o+=1)t[o]=Oo(No(r,n,o));return{c(){for(let o=0;o<t.length;o+=1)t[o].c();e=Ze()},m(o,l){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(o,l);w(o,e,l)},p(o,l){if(l&1){n=Me(Object.entries(o[0]));let i;for(i=0;i<n.length;i+=1){const s=No(o,n,i);t[i]?t[i].p(s,l):(t[i]=Oo(s),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(o){o&&$(e),st(t,o)}}}function wa(r){let e,n,t,o=Me(Object.entries(r[0])),l=[];for(let a=0;a<o.length;a+=1)l[a]=Bo(zo(r,o,a));let i=Me(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=Ro(jo(r,i,a));return{c(){e=k("div");for(let a=0;a<l.length;a+=1)l[a].c();n=M(),t=k("div");for(let a=0;a<s.length;a+=1)s[a].c();le(e,"display","flex"),le(t,"display","flex"),le(t,"justify-content","space-between")},m(a,f){w(a,e,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);w(a,n,f),w(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,f){if(f&1){o=Me(Object.entries(a[0]));let u;for(u=0;u<o.length;u+=1){const c=zo(a,o,u);l[u]?l[u].p(c,f):(l[u]=Bo(c),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(f&1){i=Me(Object.entries(a[0]));let u;for(u=0;u<i.length;u+=1){const c=jo(a,i,u);s[u]?s[u].p(c,f):(s[u]=Ro(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},d(a){a&&($(e),$(n),$(t)),st(l,a),st(s,a)}}}function Oo(r){let e,n,t,o=r[2]+"",l,i;return{c(){e=k("div"),n=k("span"),t=M(),l=j(o),i=M(),N(n,"class","vertical-block svelte-rl95zk"),le(n,"background",r[6])},m(s,a){w(s,e,a),p(e,n),p(e,t),p(e,l),p(e,i)},p(s,a){a&1&&le(n,"background",s[6]),a&1&&o!==(o=s[2]+"")&&re(l,o)},d(s){s&&$(e)}}}function Bo(r){let e,n;return{c(){e=k("span"),n=j(` 
      `),le(e,"background",r[6]),le(e,"width","100%"),le(e,"border","1px solid black")},m(t,o){w(t,e,o),p(e,n)},p(t,o){o&1&&le(e,"background",t[6])},d(t){t&&$(e)}}}function Ro(r){let e,n=r[2]+"",t;return{c(){e=k("span"),t=j(n)},m(o,l){w(o,e,l),p(e,t)},p(o,l){l&1&&n!==(n=o[2]+"")&&re(t,n)},d(o){o&&$(e)}}}function $a(r){let e;function n(l,i){return l[1]?wa:ya}let t=n(r),o=t(r);return{c(){o.c(),e=Ze()},m(l,i){o.m(l,i),w(l,e,i)},p(l,[i]){t===(t=n(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},i:Q,o:Q,d(l){l&&$(e),o.d(l)}}}function ka(r,e,n){let{colors:t}=e,{horiz:o=!1}=e;return r.$$set=l=>{"colors"in l&&n(0,t=l.colors),"horiz"in l&&n(1,o=l.horiz)},[t,o]}class _o extends se{constructor(e){super(),ae(this,e,ka,$a,oe,{colors:0,horiz:1})}}function Do(r,e,n){const t=r.slice();return t[3]=e[n],t}function Uo(r,e,n){const t=r.slice();return t[6]=e[n],t}function Ho(r){let e,n;return{c(){e=k("span"),n=j(` 
    `),le(e,"background",r[6]),le(e,"width","100%"),le(e,"border","1px solid black")},m(t,o){w(t,e,o),p(e,n)},p(t,o){o&1&&le(e,"background",t[6])},d(t){t&&$(e)}}}function Sa(r){let e,n=r[3]+"",t;return{c(){e=k("span"),t=j(n)},m(o,l){w(o,e,l),p(e,t)},p(o,l){l&2&&n!==(n=o[3]+"")&&re(t,n)},d(o){o&&$(e)}}}function La(r){let e,n=r[3].toFixed(r[2])+"",t;return{c(){e=k("span"),t=j(n)},m(o,l){w(o,e,l),p(e,t)},p(o,l){l&6&&n!==(n=o[3].toFixed(o[2])+"")&&re(t,n)},d(o){o&&$(e)}}}function Go(r){let e;function n(l,i){return l[2]>0?La:Sa}let t=n(r),o=t(r);return{c(){o.c(),e=Ze()},m(l,i){o.m(l,i),w(l,e,i)},p(l,i){t===(t=n(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&$(e),o.d(l)}}}function Ca(r){let e,n,t,o=Me(r[0]),l=[];for(let a=0;a<o.length;a+=1)l[a]=Ho(Uo(r,o,a));let i=Me(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Go(Do(r,i,a));return{c(){e=k("div");for(let a=0;a<l.length;a+=1)l[a].c();n=M(),t=k("div");for(let a=0;a<s.length;a+=1)s[a].c();le(e,"display","flex"),le(t,"display","flex"),le(t,"justify-content","space-between")},m(a,f){w(a,e,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);w(a,n,f),w(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,[f]){if(f&1){o=Me(a[0]);let u;for(u=0;u<o.length;u+=1){const c=Uo(a,o,u);l[u]?l[u].p(c,f):(l[u]=Ho(c),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(f&6){i=Me(a[1]);let u;for(u=0;u<i.length;u+=1){const c=Do(a,i,u);s[u]?s[u].p(c,f):(s[u]=Go(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},i:Q,o:Q,d(a){a&&($(e),$(n),$(t)),st(l,a),st(s,a)}}}function Ma(r,e,n){let{colorScale:t}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return r.$$set=i=>{"colorScale"in i&&n(0,t=i.colorScale),"limits"in i&&n(1,o=i.limits),"decimalPlaces"in i&&n(2,l=i.decimalPlaces)},[t,o,l]}class $n extends se{constructor(e){super(),ae(this,e,Ma,Ca,oe,{colorScale:0,limits:1,decimalPlaces:2})}}function hr(r,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ft(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let de;const Zi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Zi.decode();let jn=null;function Hn(){return(jn===null||jn.byteLength===0)&&(jn=new Uint8Array(de.memory.buffer)),jn}function zt(r,e){return r=r>>>0,Zi.decode(Hn().subarray(r,r+e))}const tn=new Array(128).fill(void 0);tn.push(void 0,null,!0,!1);let Gn=tn.length;function ot(r){Gn===tn.length&&tn.push(tn.length+1);const e=Gn;return Gn=tn[e],tn[e]=r,e}function Ae(r){return tn[r]}function Ta(r){r<132||(tn[r]=Gn,Gn=r)}function Sn(r){const e=Ae(r);return Ta(r),e}function Br(r){return r==null}let zn=null;function Aa(){return(zn===null||zn.byteLength===0)&&(zn=new Float64Array(de.memory.buffer)),zn}let On=null;function Ee(){return(On===null||On.byteLength===0)&&(On=new Int32Array(de.memory.buffer)),On}let un=0;const ar=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Fa=typeof ar.encodeInto=="function"?function(r,e){return ar.encodeInto(r,e)}:function(r,e){const n=ar.encode(r);return e.set(n),{read:r.length,written:n.length}};function lr(r,e,n){if(n===void 0){const s=ar.encode(r),a=e(s.length,1)>>>0;return Hn().subarray(a,a+s.length).set(s),un=s.length,a}let t=r.length,o=e(t,1)>>>0;const l=Hn();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),o=n(o,t,t=i+r.length*3,1)>>>0;const s=Hn().subarray(o+i,o+t),a=Fa(r,s);i+=a.written}return un=i,o}function Vr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=Vr(r[0]));for(let i=1;i<o;i++)l+=", "+Vr(r[i]);return l+="]",l}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function Pa(r,e){const n=e(r.length*1,1)>>>0;return Hn().set(r,n/1),un=r.length,n}function Rr(r,e){try{return r.apply(this,e)}catch(n){de.__wbindgen_exn_store(ot(n))}}class br{static __wrap(e){e=e>>>0;const n=Object.create(br.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();de.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=de.__wbindgen_add_to_stack_pointer(-16),i=Pa(e,de.__wbindgen_malloc),s=un;de.jsroutesnapper_new(l,i,s);var n=Ee()[l/4+0],t=Ee()[l/4+1],o=Ee()[l/4+2];if(o)throw Sn(t);return br.__wrap(n)}finally{de.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){de.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ot(e))}setAreaMode(){de.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getConfig(l,this.__wbg_ptr);var t=Ee()[l/4+0],o=Ee()[l/4+1];return e=t,n=o,zt(t,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const t=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=Ee()[t/4+0],n=Ee()[t/4+1];let o;return e!==0&&(o=zt(e,n).slice(),de.__wbindgen_free(e,n*1)),o}finally{de.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var t=Ee()[l/4+0],o=Ee()[l/4+1];return e=t,n=o,zt(t,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}toggleSnapMode(){de.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,t){return de.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,t)!==0}onClick(){de.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return de.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return de.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){de.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_editExisting(o,this.__wbg_ptr,ot(e));var n=Ee()[o/4+0],t=Ee()[o/4+1];if(t)throw Sn(n)}finally{de.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var t=Ee()[l/4+0],o=Ee()[l/4+1];return e=t,n=o,zt(t,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var t=Ee()[l/4+0],o=Ee()[l/4+1];return e=t,n=o,zt(t,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,t;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,ot(e));var o=Ee()[u/4+0],l=Ee()[u/4+1],i=Ee()[u/4+2],s=Ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Sn(i);return n=a,t=f,zt(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(n,t,1)}}addSnappedWaypoint(e,n){de.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){de.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,t;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,ot(e));var o=Ee()[u/4+0],l=Ee()[u/4+1],i=Ee()[u/4+2],s=Ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Sn(i);return n=a,t=f,zt(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(n,t,1)}}getExtraNodes(e,n){let t,o;try{const c=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,ot(e),ot(n));var l=Ee()[c/4+0],i=Ee()[c/4+1],s=Ee()[c/4+2],a=Ee()[c/4+3],f=l,u=i;if(a)throw f=0,u=0,Sn(s);return t=f,o=u,zt(f,u)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(t,o,1)}}}async function Ia(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Ea(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,n){const t=zt(e,n);return ot(t)},r.wbg.__wbindgen_object_drop_ref=function(e){Sn(e)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(zt(e,n));return ot(t)},r.wbg.__wbindgen_number_get=function(e,n){const t=Ae(n),o=typeof t=="number"?t:void 0;Aa()[e/8+1]=Br(o)?0:o,Ee()[e/4+0]=!Br(o)},r.wbg.__wbindgen_is_object=function(e){const n=Ae(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return Ae(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return Ae(e)in Ae(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=Ae(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Ae(e)==Ae(n)},r.wbg.__wbindgen_string_get=function(e,n){const t=Ae(n),o=typeof t=="string"?t:void 0;var l=Br(o)?0:lr(o,de.__wbindgen_malloc,de.__wbindgen_realloc),i=un;Ee()[e/4+1]=i,Ee()[e/4+0]=l},r.wbg.__wbg_String_4370c5505c674d30=function(e,n){const t=String(Ae(n)),o=lr(t,de.__wbindgen_malloc,de.__wbindgen_realloc),l=un;Ee()[e/4+1]=l,Ee()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Ae(e);return ot(n)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const t=Ae(e)[Ae(n)];return ot(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ot(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Ae(n).stack,o=lr(t,de.__wbindgen_malloc,de.__wbindgen_realloc),l=un;Ee()[e/4+1]=l,Ee()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,o;try{t=e,o=n,console.error(zt(e,n))}finally{de.__wbindgen_free(t,o,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ae(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ae(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ae(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ae(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ae(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,n){const t=Ae(e)[n>>>0];return ot(t)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ae(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ae(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const n=Ae(e).next;return ot(n)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Rr(function(e){const n=Ae(e).next();return ot(n)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ae(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const n=Ae(e).value;return ot(n)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ot(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Rr(function(e,n){const t=Reflect.get(Ae(e),Ae(n));return ot(t)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Rr(function(e,n){const t=Ae(e).call(Ae(n));return ot(t)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ae(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Ae(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Ae(e).buffer;return ot(n)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Ae(e));return ot(n)},r.wbg.__wbg_set_5cf90238115182c3=function(e,n,t){Ae(e).set(Ae(n),t>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ae(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Ae(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const t=Vr(Ae(n)),o=lr(t,de.__wbindgen_malloc,de.__wbindgen_realloc),l=un;Ee()[e/4+1]=l,Ee()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,n){throw new Error(zt(e,n))},r.wbg.__wbindgen_memory=function(){const e=de.memory;return ot(e)},r}function Na(r,e){return de=r.exports,Yi.__wbindgen_wasm_module=e,zn=null,On=null,jn=null,de}async function Yi(r){if(de!==void 0)return de;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Ea();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Ia(await r,e);return Na(n,t)}var vt=63710088e-1,mo={centimeters:vt*100,centimetres:vt*100,degrees:vt/111325,feet:vt*3.28084,inches:vt*39.37,kilometers:vt/1e3,kilometres:vt/1e3,meters:vt,metres:vt,miles:vt/1609.344,millimeters:vt*1e3,millimetres:vt*1e3,nauticalmiles:vt/1852,radians:1,yards:vt*1.0936},ja={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/vt,yards:1.0936133},Qr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Rt(r,e,n){n===void 0&&(n={});var t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function za(r,e,n){switch(r){case"Point":return Lt(e).geometry;case"LineString":return Ot(e).geometry;case"Polygon":return po(e).geometry;case"MultiPoint":return Xi(e).geometry;case"MultiLineString":return Ki(e).geometry;case"MultiPolygon":return Vi(e).geometry;default:throw new Error(r+" is invalid")}}function Lt(r,e,n){if(n===void 0&&(n={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vr(r[0])||!vr(r[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:r};return Rt(t,e,n)}function Oa(r,e,n){return n===void 0&&(n={}),yn(r.map(function(t){return Lt(t,e)}),n)}function po(r,e,n){n===void 0&&(n={});for(var t=0,o=r;t<o.length;t++){var l=o[t];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<l[l.length-1].length;i++)if(l[l.length-1][i]!==l[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return Rt(s,e,n)}function Ba(r,e,n){return n===void 0&&(n={}),yn(r.map(function(t){return po(t,e)}),n)}function Ot(r,e,n){if(n===void 0&&(n={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:r};return Rt(t,e,n)}function Ra(r,e,n){return n===void 0&&(n={}),yn(r.map(function(t){return Ot(t,e)}),n)}function yn(r,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function Ki(r,e,n){n===void 0&&(n={});var t={type:"MultiLineString",coordinates:r};return Rt(t,e,n)}function Xi(r,e,n){n===void 0&&(n={});var t={type:"MultiPoint",coordinates:r};return Rt(t,e,n)}function Vi(r,e,n){n===void 0&&(n={});var t={type:"MultiPolygon",coordinates:r};return Rt(t,e,n)}function Da(r,e,n){n===void 0&&(n={});var t={type:"GeometryCollection",geometries:r};return Rt(t,e,n)}function Ua(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(r*n)/n}function go(r,e){e===void 0&&(e="kilometers");var n=mo[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Lr(r,e){e===void 0&&(e="kilometers");var n=mo[e];if(!n)throw new Error(e+" units is invalid");return r/n}function Ha(r,e){return Yn(Lr(r,e))}function Ga(r){var e=r%360;return e<0&&(e+=360),e}function Yn(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Bt(r){var e=r%360;return e*Math.PI/180}function Wa(r,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("length must be a positive number");return go(Lr(r,e),n)}function qa(r,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("area must be a positive number");var t=Qr[e];if(!t)throw new Error("invalid original units");var o=Qr[n];if(!o)throw new Error("invalid final units");return r/t*o}function vr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function ho(r){return!!r&&r.constructor===Object}function Ja(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!vr(e))throw new Error("bbox must only contain numbers")})}function Za(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Ya=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Qr,bearingToAzimuth:Ga,convertArea:qa,convertLength:Wa,degreesToRadians:Bt,earthRadius:vt,factors:mo,feature:Rt,featureCollection:yn,geometry:za,geometryCollection:Da,isNumber:vr,isObject:ho,lengthToDegrees:Ha,lengthToRadians:Lr,lineString:Ot,lineStrings:Ra,multiLineString:Ki,multiPoint:Xi,multiPolygon:Vi,point:Lt,points:Oa,polygon:po,polygons:Ba,radiansToDegrees:Yn,radiansToLength:go,round:Ua,unitsFactors:ja,validateBBox:Ja,validateId:Za},Symbol.toStringTag,{value:"Module"}));function Kn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Tn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function In(r,e,n){n===void 0&&(n={});var t=Kn(r),o=Kn(e),l=Bt(o[1]-t[1]),i=Bt(o[0]-t[0]),s=Bt(t[1]),a=Bt(o[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return go(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function Qn(r,e,n){if(r!==null)for(var t,o,l,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",y=m?r.features.length:1,h=0;h<y;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var v=0;v<s;v++){var S=0,C=0;if(i=_?f.geometries[v]:f,i!==null){a=i.coordinates;var I=i.type;switch(u=n&&(I==="Polygon"||I==="MultiPolygon")?1:0,I){case null:break;case"Point":if(e(a,c,h,S,C)===!1)return!1;c++,S++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,S,C)===!1)return!1;c++,I==="MultiPoint"&&S++}I==="LineString"&&S++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(o=0;o<a[t].length-u;o++){if(e(a[t][o],c,h,S,C)===!1)return!1;c++}I==="MultiLineString"&&S++,I==="Polygon"&&C++}I==="Polygon"&&S++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(C=0,o=0;o<a[t].length;o++){for(l=0;l<a[t][o].length-u;l++){if(e(a[t][o][l],c,h,S,C)===!1)return!1;c++}C++}S++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(Qn(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ka(r,e,n,t){var o=n;return Qn(r,function(l,i,s,a,f){i===0&&n===void 0?o=l:o=e(o,l,i,s,a,f)},t),o}function Qi(r,e){var n;switch(r.type){case"FeatureCollection":for(n=0;n<r.features.length&&e(r.features[n].properties,n)!==!1;n++);break;case"Feature":e(r.properties,0);break}}function Xa(r,e,n){var t=n;return Qi(r,function(o,l){l===0&&n===void 0?t=o:t=e(t,o,l)}),t}function yr(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var n=0;n<r.features.length&&e(r.features[n],n)!==!1;n++);}function Va(r,e,n){var t=n;return yr(r,function(o,l){l===0&&n===void 0?t=o:t=e(t,o,l)}),t}function Qa(r){var e=[];return Qn(r,function(n){e.push(n)}),e}function bo(r,e){var n,t,o,l,i,s,a,f,u,c,_=0,d=r.type==="FeatureCollection",m=r.type==="Feature",g=d?r.features.length:1;for(n=0;n<g;n++){for(s=d?r.features[n].geometry:m?r.geometry:r,f=d?r.features[n].properties:m?r.properties:{},u=d?r.features[n].bbox:m?r.bbox:void 0,c=d?r.features[n].id:m?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,o=0;o<i;o++){if(l=a?s.geometries[o]:s,l===null){if(e(null,_,f,u,c)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,_,f,u,c)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<l.geometries.length;t++)if(e(l.geometries[t],_,f,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function xa(r,e,n){var t=n;return bo(r,function(o,l,i,s,a){l===0&&n===void 0?t=o:t=e(t,o,l,i,s,a)}),t}function Fn(r,e){bo(r,function(n,t,o,l,i){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Rt(n,o,{bbox:l,id:i}),t,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var f=0;f<n.coordinates.length;f++){var u=n.coordinates[f],c={type:a,coordinates:u};if(e(Rt(c,o),t,f)===!1)return!1}})}function ef(r,e,n){var t=n;return Fn(r,function(o,l,i){l===0&&i===0&&n===void 0?t=o:t=e(t,o,l,i)}),t}function xi(r,e){Fn(r,function(n,t,o){var l=0;if(n.geometry){var i=n.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,f=0,u=0;if(Qn(n,function(c,_,d,m,g){if(s===void 0||t>a||m>f||g>u){s=c,a=t,f=m,u=g,l=0;return}var y=Ot([s,c],n.properties);if(e(y,t,o,g,l)===!1)return!1;l++,s=c})===!1)return!1}}})}function tf(r,e,n){var t=n,o=!1;return xi(r,function(l,i,s,a,f){o===!1&&n===void 0?t=l:t=e(t,l,i,s,a,f),o=!0}),t}function es(r,e){if(!r)throw new Error("geojson is required");Fn(r,function(n,t,o){if(n.geometry!==null){var l=n.geometry.type,i=n.geometry.coordinates;switch(l){case"LineString":if(e(n,t,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Ot(i[s],n.properties),t,o,s)===!1)return!1;break}}})}function nf(r,e,n){var t=n;return es(r,function(o,l,i,s){l===0&&n===void 0?t=o:t=e(t,o,l,i,s)}),t}function rf(r,e){if(e=e||{},!ho(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=a.length+l-1),Ot([a[l],a[l+1]],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l-1),Ot([a[o][l],a[o][l+1]],i,e);case"MultiLineString":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l-1),Ot([a[t][l],a[t][l+1]],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),l<0&&(l=a[t][o].length-l-1),Ot([a[t][o][l],a[t][o][l+1]],i,e)}throw new Error("geojson is invalid")}function of(r,e){if(e=e||{},!ho(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return Lt(a,i,e);case"MultiPoint":return t<0&&(t=a.length+t),Lt(a[t],i,e);case"LineString":return l<0&&(l=a.length+l),Lt(a[l],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l),Lt(a[o][l],i,e);case"MultiLineString":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l),Lt(a[t][l],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),l<0&&(l=a[t][o].length-l),Lt(a[t][o][l],i,e)}throw new Error("geojson is invalid")}const lf=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Qa,coordEach:Qn,coordReduce:Ka,featureEach:yr,featureReduce:Va,findPoint:of,findSegment:rf,flattenEach:Fn,flattenReduce:ef,geomEach:bo,geomReduce:xa,lineEach:es,lineReduce:nf,propEach:Qi,propReduce:Xa,segmentEach:xi,segmentReduce:tf},Symbol.toStringTag,{value:"Module"}));function ts(r,e,n){if(n===void 0&&(n={}),n.final===!0)return sf(r,e);var t=Kn(r),o=Kn(e),l=Bt(t[0]),i=Bt(o[0]),s=Bt(t[1]),a=Bt(o[1]),f=Math.sin(i-l)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return Yn(Math.atan2(f,u))}function sf(r,e){var n=ts(e,r);return n=(n+180)%360,n}function Wo(r,e,n,t){t===void 0&&(t={});var o=Kn(r),l=Bt(o[0]),i=Bt(o[1]),s=Bt(n),a=Lr(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=Yn(u),_=Yn(f);return Lt([c,_],t.properties)}function qo(r){if(!r)throw new Error("geojson is required");var e=[];return Fn(r,function(n){af(n,e)}),yn(e)}function af(r,e){var n=[],t=r.geometry;if(t!==null){switch(t.type){case"Polygon":n=Tn(t);break;case"LineString":n=[Tn(t)]}n.forEach(function(o){var l=ff(o,r.properties);l.forEach(function(i){i.id=e.length,e.push(i)})})}}function ff(r,e){var n=[];return r.reduce(function(t,o){var l=Ot([t,o],e);return l.bbox=uf(t,o),n.push(l),o}),n}function uf(r,e){var n=r[0],t=r[1],o=e[0],l=e[1],i=n<o?n:o,s=t<l?t:l,a=n>o?n:o,f=t>l?t:l;return[i,s,a,f]}var vo={exports:{}},ns={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(Zs,function(){function n(v,S,C,I,E){(function P(O,B,U,R,z){for(;R>U;){if(R-U>600){var H=R-U+1,G=B-U+1,Y=Math.log(H),Z=.5*Math.exp(2*Y/3),ie=.5*Math.sqrt(Y*Z*(H-Z)/H)*(G-H/2<0?-1:1),D=Math.max(U,Math.floor(B-G*Z/H+ie)),ye=Math.min(R,Math.floor(B+(H-G)*Z/H+ie));P(O,B,D,ye,z)}var ge=O[B],fe=U,we=R;for(t(O,U,B),z(O[R],ge)>0&&t(O,U,R);fe<we;){for(t(O,fe,we),fe++,we--;z(O[fe],ge)<0;)fe++;for(;z(O[we],ge)>0;)we--}z(O[U],ge)===0?t(O,U,we):t(O,++we,R),we<=B&&(U=we+1),B<=we&&(R=we-1)}})(v,S,C||0,I||v.length-1,E||o)}function t(v,S,C){var I=v[S];v[S]=v[C],v[C]=I}function o(v,S){return v<S?-1:v>S?1:0}var l=function(v){v===void 0&&(v=9),this._maxEntries=Math.max(4,v),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(v,S,C){if(!C)return S.indexOf(v);for(var I=0;I<S.length;I++)if(C(v,S[I]))return I;return-1}function s(v,S){a(v,0,v.children.length,S,v)}function a(v,S,C,I,E){E||(E=y(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var P=S;P<C;P++){var O=v.children[P];f(E,v.leaf?I(O):O)}return E}function f(v,S){return v.minX=Math.min(v.minX,S.minX),v.minY=Math.min(v.minY,S.minY),v.maxX=Math.max(v.maxX,S.maxX),v.maxY=Math.max(v.maxY,S.maxY),v}function u(v,S){return v.minX-S.minX}function c(v,S){return v.minY-S.minY}function _(v){return(v.maxX-v.minX)*(v.maxY-v.minY)}function d(v){return v.maxX-v.minX+(v.maxY-v.minY)}function m(v,S){return v.minX<=S.minX&&v.minY<=S.minY&&S.maxX<=v.maxX&&S.maxY<=v.maxY}function g(v,S){return S.minX<=v.maxX&&S.minY<=v.maxY&&S.maxX>=v.minX&&S.maxY>=v.minY}function y(v){return{children:v,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function h(v,S,C,I,E){for(var P=[S,C];P.length;)if(!((C=P.pop())-(S=P.pop())<=I)){var O=S+Math.ceil((C-S)/I/2)*I;n(v,O,S,C,E),P.push(S,O,O,C)}}return l.prototype.all=function(){return this._all(this.data,[])},l.prototype.search=function(v){var S=this.data,C=[];if(!g(v,S))return C;for(var I=this.toBBox,E=[];S;){for(var P=0;P<S.children.length;P++){var O=S.children[P],B=S.leaf?I(O):O;g(v,B)&&(S.leaf?C.push(O):m(v,B)?this._all(O,C):E.push(O))}S=E.pop()}return C},l.prototype.collides=function(v){var S=this.data;if(!g(v,S))return!1;for(var C=[];S;){for(var I=0;I<S.children.length;I++){var E=S.children[I],P=S.leaf?this.toBBox(E):E;if(g(v,P)){if(S.leaf||m(v,P))return!0;C.push(E)}}S=C.pop()}return!1},l.prototype.load=function(v){if(!v||!v.length)return this;if(v.length<this._minEntries){for(var S=0;S<v.length;S++)this.insert(v[S]);return this}var C=this._build(v.slice(),0,v.length-1,0);if(this.data.children.length)if(this.data.height===C.height)this._splitRoot(this.data,C);else{if(this.data.height<C.height){var I=this.data;this.data=C,C=I}this._insert(C,this.data.height-C.height-1,!0)}else this.data=C;return this},l.prototype.insert=function(v){return v&&this._insert(v,this.data.height-1),this},l.prototype.clear=function(){return this.data=y([]),this},l.prototype.remove=function(v,S){if(!v)return this;for(var C,I,E,P=this.data,O=this.toBBox(v),B=[],U=[];P||B.length;){if(P||(P=B.pop(),I=B[B.length-1],C=U.pop(),E=!0),P.leaf){var R=i(v,P.children,S);if(R!==-1)return P.children.splice(R,1),B.push(P),this._condense(B),this}E||P.leaf||!m(P,O)?I?(C++,P=I.children[C],E=!1):P=null:(B.push(P),U.push(C),C=0,I=P,P=P.children[0])}return this},l.prototype.toBBox=function(v){return v},l.prototype.compareMinX=function(v,S){return v.minX-S.minX},l.prototype.compareMinY=function(v,S){return v.minY-S.minY},l.prototype.toJSON=function(){return this.data},l.prototype.fromJSON=function(v){return this.data=v,this},l.prototype._all=function(v,S){for(var C=[];v;)v.leaf?S.push.apply(S,v.children):C.push.apply(C,v.children),v=C.pop();return S},l.prototype._build=function(v,S,C,I){var E,P=C-S+1,O=this._maxEntries;if(P<=O)return s(E=y(v.slice(S,C+1)),this.toBBox),E;I||(I=Math.ceil(Math.log(P)/Math.log(O)),O=Math.ceil(P/Math.pow(O,I-1))),(E=y([])).leaf=!1,E.height=I;var B=Math.ceil(P/O),U=B*Math.ceil(Math.sqrt(O));h(v,S,C,U,this.compareMinX);for(var R=S;R<=C;R+=U){var z=Math.min(R+U-1,C);h(v,R,z,B,this.compareMinY);for(var H=R;H<=z;H+=B){var G=Math.min(H+B-1,z);E.children.push(this._build(v,H,G,I-1))}}return s(E,this.toBBox),E},l.prototype._chooseSubtree=function(v,S,C,I){for(;I.push(S),!S.leaf&&I.length-1!==C;){for(var E=1/0,P=1/0,O=void 0,B=0;B<S.children.length;B++){var U=S.children[B],R=_(U),z=(H=v,G=U,(Math.max(G.maxX,H.maxX)-Math.min(G.minX,H.minX))*(Math.max(G.maxY,H.maxY)-Math.min(G.minY,H.minY))-R);z<P?(P=z,E=R<E?R:E,O=U):z===P&&R<E&&(E=R,O=U)}S=O||S.children[0]}var H,G;return S},l.prototype._insert=function(v,S,C){var I=C?v:this.toBBox(v),E=[],P=this._chooseSubtree(I,this.data,S,E);for(P.children.push(v),f(P,I);S>=0&&E[S].children.length>this._maxEntries;)this._split(E,S),S--;this._adjustParentBBoxes(I,E,S)},l.prototype._split=function(v,S){var C=v[S],I=C.children.length,E=this._minEntries;this._chooseSplitAxis(C,E,I);var P=this._chooseSplitIndex(C,E,I),O=y(C.children.splice(P,C.children.length-P));O.height=C.height,O.leaf=C.leaf,s(C,this.toBBox),s(O,this.toBBox),S?v[S-1].children.push(O):this._splitRoot(C,O)},l.prototype._splitRoot=function(v,S){this.data=y([v,S]),this.data.height=v.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},l.prototype._chooseSplitIndex=function(v,S,C){for(var I,E,P,O,B,U,R,z=1/0,H=1/0,G=S;G<=C-S;G++){var Y=a(v,0,G,this.toBBox),Z=a(v,G,C,this.toBBox),ie=(E=Y,P=Z,O=void 0,B=void 0,U=void 0,R=void 0,O=Math.max(E.minX,P.minX),B=Math.max(E.minY,P.minY),U=Math.min(E.maxX,P.maxX),R=Math.min(E.maxY,P.maxY),Math.max(0,U-O)*Math.max(0,R-B)),D=_(Y)+_(Z);ie<z?(z=ie,I=G,H=D<H?D:H):ie===z&&D<H&&(H=D,I=G)}return I||C-S},l.prototype._chooseSplitAxis=function(v,S,C){var I=v.leaf?this.compareMinX:u,E=v.leaf?this.compareMinY:c;this._allDistMargin(v,S,C,I)<this._allDistMargin(v,S,C,E)&&v.children.sort(I)},l.prototype._allDistMargin=function(v,S,C,I){v.children.sort(I);for(var E=this.toBBox,P=a(v,0,S,E),O=a(v,C-S,C,E),B=d(P)+d(O),U=S;U<C-S;U++){var R=v.children[U];f(P,v.leaf?E(R):R),B+=d(P)}for(var z=C-S-1;z>=S;z--){var H=v.children[z];f(O,v.leaf?E(H):H),B+=d(O)}return B},l.prototype._adjustParentBBoxes=function(v,S,C){for(var I=C;I>=0;I--)f(S[I],v)},l.prototype._condense=function(v){for(var S=v.length-1,C=void 0;S>=0;S--)v[S].children.length===0?S>0?(C=v[S-1].children).splice(C.indexOf(v[S]),1):this.clear():s(v[S],this.toBBox)},l})})(ns);var cf=ns.exports;const df=so(Ya),_f=so(lf);function rs(r,e,n){if(r!==null)for(var t,o,l,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",y=m?r.features.length:1,h=0;h<y;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var v=0;v<s;v++){var S=0,C=0;if(i=_?f.geometries[v]:f,i!==null){a=i.coordinates;var I=i.type;switch(u=n&&(I==="Polygon"||I==="MultiPolygon")?1:0,I){case null:break;case"Point":if(e(a,c,h,S,C)===!1)return!1;c++,S++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,S,C)===!1)return!1;c++,I==="MultiPoint"&&S++}I==="LineString"&&S++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(o=0;o<a[t].length-u;o++){if(e(a[t][o],c,h,S,C)===!1)return!1;c++}I==="MultiLineString"&&S++,I==="Polygon"&&C++}I==="Polygon"&&S++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(C=0,o=0;o<a[t].length;o++){for(l=0;l<a[t][o].length-u;l++){if(e(a[t][o][l],c,h,S,C)===!1)return!1;c++}C++}S++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(rs(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function os(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return rs(r,t=>{n[0]>t[0]&&(n[0]=t[0]),n[1]>t[1]&&(n[1]=t[1]),n[2]<t[0]&&(n[2]=t[0]),n[3]<t[1]&&(n[3]=t[1])}),n}var mf=os;const pf=Object.freeze(Object.defineProperty({__proto__:null,bbox:os,default:mf},Symbol.toStringTag,{value:"Module"})),gf=so(pf);var Kt=cf,ls=df,is=_f,kn=gf.default,hf=is.featureEach;is.coordEach;ls.polygon;var Jo=ls.featureCollection;function ss(r){var e=new Kt(r);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:kn(n),Kt.prototype.insert.call(this,n)},e.load=function(n){var t=[];return Array.isArray(n)?n.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:kn(o),t.push(o)}):hf(n,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:kn(o),t.push(o)}),Kt.prototype.load.call(this,t)},e.remove=function(n,t){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:kn(n),Kt.prototype.remove.call(this,n,t)},e.clear=function(){return Kt.prototype.clear.call(this)},e.search=function(n){var t=Kt.prototype.search.call(this,this.toBBox(n));return Jo(t)},e.collides=function(n){return Kt.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=Kt.prototype.all.call(this);return Jo(n)},e.toJSON=function(){return Kt.prototype.toJSON.call(this)},e.fromJSON=function(n){return Kt.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var t;if(n.bbox)t=n.bbox;else if(Array.isArray(n)&&n.length===4)t=n;else if(Array.isArray(n)&&n.length===6)t=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")t=kn(n);else if(n.type==="FeatureCollection")t=kn(n);else throw new Error("invalid geojson");return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},e}vo.exports=ss;vo.exports.default=ss;var bf=vo.exports;const vf=Ys(bf);function yf(r,e){var n={},t=[];if(r.type==="LineString"&&(r=Rt(r)),e.type==="LineString"&&(e=Rt(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=Zo(r,e);return o&&t.push(o),yn(t)}var l=vf();return l.load(qo(e)),yr(qo(r),function(i){yr(l.search(i),function(s){var a=Zo(i,s);if(a){var f=Tn(a).join(",");n[f]||(n[f]=!0,t.push(a))}})}),yn(t)}function Zo(r,e){var n=Tn(r),t=Tn(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(t.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=n[0][0],l=n[0][1],i=n[1][0],s=n[1][1],a=t[0][0],f=t[0][1],u=t[1][0],c=t[1][1],_=(c-f)*(i-o)-(u-a)*(s-l),d=(u-a)*(l-f)-(c-f)*(o-a),m=(i-o)*(l-f)-(s-l)*(o-a);if(_===0)return null;var g=d/_,y=m/_;if(g>=0&&g<=1&&y>=0&&y<=1){var h=o+g*(i-o),v=l+g*(s-l);return Lt([h,v])}return null}function wf(r,e,n){n===void 0&&(n={});var t=Lt([1/0,1/0],{dist:1/0}),o=0;return Fn(r,function(l){for(var i=Tn(l),s=0;s<i.length-1;s++){var a=Lt(i[s]);a.properties.dist=In(e,a,n);var f=Lt(i[s+1]);f.properties.dist=In(e,f,n);var u=In(a,f,n),c=Math.max(a.properties.dist,f.properties.dist),_=ts(a,f),d=Wo(e,c,_+90,n),m=Wo(e,c,_-90,n),g=yf(Ot([d.geometry.coordinates,m.geometry.coordinates]),Ot([a.geometry.coordinates,f.geometry.coordinates])),y=null;g.features.length>0&&(y=g.features[0],y.properties.dist=In(e,y,n),y.properties.location=o+In(a,y,n)),a.properties.dist<t.properties.dist&&(t=a,t.properties.index=s,t.properties.location=o),f.properties.dist<t.properties.dist&&(t=f,t.properties.index=s+1,t.properties.location=o+u),y&&y.properties.dist<t.properties.dist&&(t=y,t.properties.index=s),o+=u}}),t}const $f=30;class kf{constructor(e,n,t,o,l){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-$f,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new br(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}function Yo(r){let e,n;return e=new Sr({props:{$$slots:{default:[Sf,({dialog:t})=>({3:t}),({dialog:t})=>t?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Sf(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;function g(){return r[1](r[3])}return{c(){e=k("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",n=M(),t=k("p"),t.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,o=M(),l=k("p"),l.textContent="To use this tool, you need to:",i=M(),s=k("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,a=M(),f=k("p"),f.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,u=M(),c=k("center"),_=k("button"),_.textContent="Start!"},m(y,h){w(y,e,h),w(y,n,h),w(y,t,h),w(y,o,h),w(y,l,h),w(y,i,h),w(y,s,h),w(y,a,h),w(y,f,h),w(y,u,h),w(y,c,h),p(c,_),d||(m=V(_,"click",g),d=!0)},p(y,h){r=y},d(y){y&&($(e),$(n),$(t),$(o),$(l),$(i),$(s),$(a),$(f),$(u),$(c)),d=!1,m()}}}function Lf(r){let e,n,t=r[0]&&Yo(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&b(t,1)):(t=Yo(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function Cf(r,e,n){let t;return X(r,_r,i=>n(0,t=i)),[t,i=>ft(i).close(),()=>te(_r,t=!1,t)]}class Mf extends se{constructor(e){super(),ae(this,e,Cf,Lf,oe,{})}}function Tf(r){let e;const n=r[16].default,t=Be(n,r,r[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Re(t,n,o,o[24],e?Ue(n,o[24],l,null):De(o[24]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function Af(r){let e,n,t;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Tf]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Di({props:l}),He.push(()=>ut(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function Ff(r,e,n){let{$$slots:t={},$$scope:o}=e,{id:l=ao("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:S=!1}=e,{interactive:C=!0}=e;function I(z){v=z,n(0,v)}function E(z){je.call(this,r,z)}function P(z){je.call(this,r,z)}function O(z){je.call(this,r,z)}function B(z){je.call(this,r,z)}function U(z){je.call(this,r,z)}function R(z){je.call(this,r,z)}return r.$$set=z=>{"id"in z&&n(1,l=z.id),"source"in z&&n(2,i=z.source),"sourceLayer"in z&&n(3,s=z.sourceLayer),"beforeId"in z&&n(4,a=z.beforeId),"beforeLayerType"in z&&n(5,f=z.beforeLayerType),"paint"in z&&n(6,u=z.paint),"layout"in z&&n(7,c=z.layout),"filter"in z&&n(8,_=z.filter),"applyToClusters"in z&&n(9,d=z.applyToClusters),"minzoom"in z&&n(10,m=z.minzoom),"maxzoom"in z&&n(11,g=z.maxzoom),"hoverCursor"in z&&n(12,y=z.hoverCursor),"manageHoverState"in z&&n(13,h=z.manageHoverState),"hovered"in z&&n(0,v=z.hovered),"eventsIfTopMost"in z&&n(14,S=z.eventsIfTopMost),"interactive"in z&&n(15,C=z.interactive),"$$scope"in z&&n(24,o=z.$$scope)},[v,l,i,s,a,f,u,c,_,d,m,g,y,h,S,C,t,I,E,P,O,B,U,R,o]}let mn=class extends se{constructor(e){super(),ae(this,e,Ff,Af,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Pf(r){let e,n;const t=r[7].default,o=Be(t,r,r[6],null);return{c(){e=k("div"),o&&o.c(),N(e,"class",r[1]),pt(e,"maplibregl-ctrl",r[0])},m(l,i){w(l,e,i),o&&o.m(e,null),r[8](e),n=!0},p(l,[i]){o&&o.p&&(!n||i&64)&&Re(o,t,l,l[6],n?Ue(t,l[6],i,null):De(l[6]),null),(!n||i&2)&&N(e,"class",l[1]),(!n||i&3)&&pt(e,"maplibregl-ctrl",l[0])},i(l){n||(b(o,l),n=!0)},o(l){L(o,l),n=!1},d(l){l&&$(e),o&&o.d(l),r[8](null)}}}function If(r,e,n){let t,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:f}=fo();X(r,f,d=>n(5,t=d));let u,c={onAdd(){return u},onRemove(){var d;(d=u==null?void 0:u.parentNode)==null||d.removeChild(u)}};Tt(()=>{t==null||t.removeControl(c)});function _(d){He[d?"unshift":"push"](()=>{u=d,n(2,u)})}return r.$$set=d=>{"defaultStyling"in d&&n(0,i=d.defaultStyling),"position"in d&&n(4,s=d.position),"class"in d&&n(1,a=d.class),"$$scope"in d&&n(6,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&t&&u&&t.addControl(c,s)},[i,a,u,f,s,t,l,o,_]}class Ef extends se{constructor(e){super(),ae(this,e,If,Pf,oe,{defaultStyling:0,position:4,class:1})}}function Nf(r,e,n){let t,o,{data:l}=e,{idCol:i}=e,{sourceLayer:s=void 0}=e,a=new Set;const{map:f,source:u}=Ks();return X(r,f,c=>n(6,t=c)),X(r,u,c=>n(7,o=c)),r.$$set=c=>{"data"in c&&n(2,l=c.data),"idCol"in c&&n(3,i=c.idCol),"sourceLayer"in c&&n(4,s=c.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&l&&t&&o){let c=new Set;for(const _ of l){const d=_[i];if(!d)continue;a.delete(d),c.add(d);const m={id:d,source:o,sourceLayer:s},g=t.getFeatureState(m);let y=!1;for(const h of Object.keys(_))if(g[h]!==_[h]){y=!0;break}y&&t.setFeatureState(m,_)}for(const _ of a){const d={id:_,source:o,sourceLayer:s},m=t.getFeatureState(d);for(const g of Object.keys(m))t.removeFeatureState(d,g)}n(5,a=c)}},[f,u,l,i,s,a,t,o]}class jf extends se{constructor(e){super(),ae(this,e,Nf,null,oe,{data:2,idCol:3,sourceLayer:4})}}function zf(r,e,n){let t;const o=_n();let{layer:l=void 0}=e;const{map:i}=fo();X(r,i,u=>n(2,t=u));function s(u){o(u.type,{...u,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Tt(()=>{if(t)if(l)for(const u of a)t.off(u,l,s);else for(const u of f)t.off(u,s)}),r.$$set=u=>{"layer"in u&&n(1,l=u.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&t)if(l)for(const u of a)t.on(u,l,s);else for(const u of f)t.on(u,s)},[i,l,t]}class as extends se{constructor(e){super(),ae(this,e,zf,null,oe,{layer:1})}}const Of=r=>({marker:r&8}),Ko=r=>({marker:r[3]});function Bf(r){let e,n,t,o,l,i,s;const a=r[19].default,f=Be(a,r,r[18],Ko);return{c(){e=k("div"),f&&f.c(),N(e,"tabindex",n=r[1]?0:void 0),N(e,"role",t=r[1]?"button":void 0),le(e,"z-index",r[2])},m(u,c){w(u,e,c),f&&f.m(e,null),l=!0,i||(s=[ko(r[7].call(null,e)),ko(o=Rf.call(null,e,r[0])),V(e,"click",Or(r[20])),V(e,"dblclick",Or(r[21])),V(e,"contextmenu",Or(Ui(r[22]))),V(e,"mouseenter",r[23]),V(e,"mouseleave",r[24]),V(e,"mousemove",r[25]),V(e,"keydown",r[8])],i=!0)},p(u,[c]){f&&f.p&&(!l||c&262152)&&Re(f,a,u,u[18],l?Ue(a,u[18],c,Of):De(u[18]),Ko),(!l||c&2&&n!==(n=u[1]?0:void 0))&&N(e,"tabindex",n),(!l||c&2&&t!==(t=u[1]?"button":void 0))&&N(e,"role",t),o&&qr(o.update)&&c&1&&o.update.call(null,u[0]),c&4&&le(e,"z-index",u[2])},i(u){l||(b(f,u),l=!0)},o(u){L(f,u),l=!1},d(u){u&&$(e),f&&f.d(u),i=!1,lt(s)}}}function Rf(r,e){const n=r.className;function t(o){o?r.className=`${n} ${o}`:r.className=n}return t(e),{update:t}}function Df(r,e,n){let t,o,l,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:f}=e,{class:u=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:m=null}=e,{offset:g=void 0}=e,{zIndex:y=void 0}=e,{rotation:h=0}=e,{opacity:v=1}=e;const S=_n(),{map:C,layerEvent:I,self:E,markerClickManager:P}=Xs();X(r,C,D=>n(27,l=D)),X(r,I,D=>n(26,t=D)),X(r,E,D=>n(3,o=D));function O(D){te(E,o=new Xt.Marker({element:D,rotation:h,draggable:d,offset:g,opacity:v.toString()}).setLngLat(f).addTo(l),o),n(11,a=o);const ye=()=>R("dragstart"),ge=()=>{B(),R("drag")},fe=()=>{B(),R("dragend")};return d&&(o.on("dragstart",ye),o.on("drag",ge),o.on("dragend",fe)),{destroy(){d&&(o==null||o.off("dragstart",ye),o==null||o.off("drag",ge),o==null||o.off("dragend",fe)),n(11,a=void 0),o==null||o.remove()}}}function B(){let D=o==null?void 0:o.getLngLat();D&&(Array.isArray(f)?n(10,f=[D.lng,D.lat]):f&&"lon"in f?n(10,f={lon:D.lng,lat:D.lat}):n(10,f=D))}function U(D){D.key===" "&&(D.preventDefault(),D.stopPropagation(),R("click"))}function R(D){if(!c)return;let ye=o==null?void 0:o.getLngLat();if(!ye)return;const ge=[ye.lng,ye.lat];let fe={map:l,marker:o,lngLat:ge,features:[{type:"Feature",properties:(m==null?void 0:m.properties)??{},geometry:{type:"Point",coordinates:ge}}]};(D==="click"||D==="contextmenu")&&P.handleClick(fe),te(I,t={...fe,layerType:"marker",type:D},t),S(D,fe)}const z=()=>R("click"),H=()=>R("dblclick"),G=()=>{R("contextmenu")},Y=()=>{R("mouseenter")},Z=()=>{R("mouseleave")},ie=()=>R("mousemove");return r.$$set=D=>{"marker"in D&&n(11,a=D.marker),"lngLat"in D&&n(10,f=D.lngLat),"class"in D&&n(0,u=D.class),"interactive"in D&&n(12,c=D.interactive),"asButton"in D&&n(1,_=D.asButton),"draggable"in D&&n(13,d=D.draggable),"feature"in D&&n(14,m=D.feature),"offset"in D&&n(15,g=D.offset),"zIndex"in D&&n(2,y=D.zIndex),"rotation"in D&&n(16,h=D.rotation),"opacity"in D&&n(17,v=D.opacity),"$$scope"in D&&n(18,s=D.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(o==null||o.setLngLat(f)),r.$$.dirty&32776&&(o==null||o.setOffset(g??[0,0])),r.$$.dirty&65544&&(o==null||o.setRotation(h)),r.$$.dirty&131080&&(o==null||o.setOpacity(v.toString()))},[u,_,y,o,C,I,E,O,U,R,f,a,c,d,m,g,h,v,s,i,z,H,G,Y,Z,ie]}class Cr extends se{constructor(e){super(),ae(this,e,Df,Bf,oe,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Uf=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Xo=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function Vo(r){var o;let e,n,t=(((o=r[4])==null?void 0:o.length)||r[3]instanceof Xt.Marker)&&Qo(r);return{c(){e=k("div"),t&&t.c()},m(l,i){w(l,e,i),t&&t.m(e,null),r[32](e),n=!0},p(l,i){var s;(s=l[4])!=null&&s.length||l[3]instanceof Xt.Marker?t?(t.p(l,i),i[0]&24&&b(t,1)):(t=Qo(l),t.c(),b(t,1),t.m(e,null)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){L(t),n=!1},d(l){l&&$(e),t&&t.d(),r[32](null)}}}function Qo(r){let e;const n=r[30].default,t=Be(n,r,r[29],Xo);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l[0]&536870933)&&Re(t,n,o,o[29],e?Ue(n,o[29],l,Uf):De(o[29]),Xo)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function Hf(r){let e,n,t=r[9].default&&Vo(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,l){o[9].default?t?(t.p(o,l),l[0]&512&&b(t,1)):(t=Vo(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function Gf(r,e,n){let t,o,l,i,s,a,{$$slots:f={},$$scope:u}=e;const c=Vs(f);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:m=!1}=e,{closeOnMove:g=!1}=e,{openOn:y="click"}=e,{openIfTopMost:h=!0}=e,{focusAfterOpen:v=!0}=e,{anchor:S=void 0}=e,{offset:C=void 0}=e,{popupClass:I=void 0}=e,{maxWidth:E=void 0}=e,{lngLat:P=void 0}=e,{html:O=void 0}=e,{open:B=!1}=e;const U=_n(),{map:R,popupTarget:z,layerEvent:H,layer:G,eventTopMost:Y,markerClickManager:Z}=fo();X(r,R,W=>n(2,l=W)),X(r,z,W=>n(3,s=W)),X(r,H,W=>n(28,i=W)),X(r,G,W=>n(35,a=W));const ie=["click","dblclick","contextmenu"];let D,ye=!1,ge;function fe(){if(!D)return;let W=D.getElement();!W||W===ge||(ge=W,y==="hover"&&(ge.style.pointerEvents="none"),ge.addEventListener("mouseenter",()=>{n(24,ye=!0)},{passive:!0}),ge.addEventListener("mouseleave",()=>{n(24,ye=!1)},{passive:!0}),ge.addEventListener("click",()=>{m&&n(0,B=!1)},{passive:!0}))}$r(()=>{if(l)return l.on("click",me),l.on("contextmenu",me),Z.add(x),typeof s=="string"&&(l.on("click",s,Te),l.on("dblclick",s,Te),l.on("contextmenu",s,Te),l.on("mousemove",s,K),l.on("mouseleave",s,ke),l.on("touchstart",s,Je),l.on("touchend",s,Ne)),()=>{l!=null&&l.loaded()&&(D==null||D.remove(),l.off("click",me),l.off("contextmenu",me),Z.remove(x),s instanceof Xt.Marker?s.getPopup()===D&&s.setPopup(void 0):typeof s=="string"&&(l.off("click",s,Te),l.off("dblclick",s,Te),l.off("contextmenu",s,Te),l.off("mousemove",s,K),l.off("mouseleave",s,ke),l.off("touchstart",s,Je),l.off("touchend",s,Ne)))}});function we(W){return h?!("marker"in W)&&!Qs(W)&&Y(W)!==a:!1}let ue=null,Fe="normal";function Ye(W){"layerType"in W&&W.layerType==="deckgl"?(n(10,P=W.coordinate),n(4,ue=W.object?[W.object]:null)):(n(10,P=W.lngLat),n(4,ue=W.features??[]))}function Te(W){W.type!==y||we(W)||(Ye(W),setTimeout(()=>n(0,B=!0)))}let ne=null;function Je(W){ne=W.point}function Ne(W){if(!ne||y!=="hover")return;let dt=ne.dist(W.point);ne=null,dt<3&&(n(10,P=W.lngLat),n(4,ue=W.features??[]),D.isOpen()?n(25,Fe="justOpened"):(n(25,Fe="opening"),n(0,B=!0)))}function ke(W){y!=="hover"||ne||Fe!=="normal"||(n(0,B=!1),n(4,ue=null))}function K(W){if(!(y!=="hover"||ne||Fe!=="normal")){if(we(W)){n(0,B=!1),n(4,ue=null);return}n(0,B=!0),n(4,ue=W.features??[]),n(10,P=W.lngLat)}}function me(W){if(Fe==="justOpened"){n(25,Fe="normal");return}if(!d)return;let dt=[ge,s instanceof Xt.Marker?s==null?void 0:s.getElement():null];B&&D.isOpen()&&!dt.some(Oe=>Oe==null?void 0:Oe.contains(W.originalEvent.target))&&(W.type==="contextmenu"&&y==="contextmenu"||W.type!=="contextmenu")&&n(0,B=!1)}function x(W){d&&B&&D.isOpen()&&W.marker!==s&&n(0,B=!1)}Tt(()=>{l&&(D!=null&&D.isOpen())&&D.remove()});let pe;const ve=()=>n(0,B=!1);function Se(W){He[W?"unshift":"push"](()=>{pe=W,n(1,pe)})}return r.$$set=W=>{"closeButton"in W&&n(11,_=W.closeButton),"closeOnClickOutside"in W&&n(12,d=W.closeOnClickOutside),"closeOnClickInside"in W&&n(13,m=W.closeOnClickInside),"closeOnMove"in W&&n(14,g=W.closeOnMove),"openOn"in W&&n(15,y=W.openOn),"openIfTopMost"in W&&n(16,h=W.openIfTopMost),"focusAfterOpen"in W&&n(17,v=W.focusAfterOpen),"anchor"in W&&n(18,S=W.anchor),"offset"in W&&n(19,C=W.offset),"popupClass"in W&&n(20,I=W.popupClass),"maxWidth"in W&&n(21,E=W.maxWidth),"lngLat"in W&&n(10,P=W.lngLat),"html"in W&&n(22,O=W.html),"open"in W&&n(0,B=W.open),"$$scope"in W&&n(29,u=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(27,t=_??(!d&&!m)),r.$$.dirty[0]&146685952&&(D||(n(23,D=new Xt.Popup({closeButton:t,closeOnClick:!1,closeOnMove:g,focusAfterOpen:v,maxWidth:E,className:I,anchor:S,offset:C})),ge=D.getElement(),D.on("open",()=>{n(0,B=!0),fe(),U("open",D)}),D.on("close",()=>{n(0,B=!1),U("close",D)}),D.on("hover",()=>{U("hover",D)}))),r.$$.dirty[0]&8421384&&D&&s instanceof Xt.Marker&&(y==="click"?s.setPopup(D):s.getPopup()===D&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&ie.includes(y)&&(i==null?void 0:i.type)===y&&(Te(i),te(H,i=null,i)),r.$$.dirty[0]&268468224&&n(26,o=y==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&y==="hover"&&H&&(o&&i&&Ye(i),n(0,B=(o||ye)??!1)),r.$$.dirty[0]&12582914&&(pe?D.setDOMContent(pe):O&&D.setHTML(O)),r.$$.dirty[0]&8389632&&P&&D.setLngLat(P),r.$$.dirty[0]&41943045&&l){let W=D.isOpen();B&&!W?(D.addTo(l),Fe==="opening"&&n(25,Fe="justOpened")):!B&&W&&D.remove()}},[B,pe,l,s,ue,R,z,H,G,c,P,_,d,m,g,y,h,v,S,C,I,E,O,D,ye,Fe,o,t,i,u,f,ve,Se]}class Wf extends se{constructor(e){super(),ae(this,e,Gf,Hf,oe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function qf(r){let e;const n=r[16].default,t=Be(n,r,r[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Re(t,n,o,o[24],e?Ue(n,o[24],l,null):De(o[24]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function Jf(r){let e,n,t;function o(i){r[17](i)}let l={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[qf]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Di({props:l}),He.push(()=>ut(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function Zf(r,e,n){let{$$slots:t={},$$scope:o}=e,{id:l=ao("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:S=!1}=e,{interactive:C=!0}=e;function I(z){v=z,n(0,v)}function E(z){je.call(this,r,z)}function P(z){je.call(this,r,z)}function O(z){je.call(this,r,z)}function B(z){je.call(this,r,z)}function U(z){je.call(this,r,z)}function R(z){je.call(this,r,z)}return r.$$set=z=>{"id"in z&&n(1,l=z.id),"source"in z&&n(2,i=z.source),"sourceLayer"in z&&n(3,s=z.sourceLayer),"beforeId"in z&&n(4,a=z.beforeId),"beforeLayerType"in z&&n(5,f=z.beforeLayerType),"paint"in z&&n(6,u=z.paint),"layout"in z&&n(7,c=z.layout),"filter"in z&&n(8,_=z.filter),"applyToClusters"in z&&n(9,d=z.applyToClusters),"minzoom"in z&&n(10,m=z.minzoom),"maxzoom"in z&&n(11,g=z.maxzoom),"hoverCursor"in z&&n(12,y=z.hoverCursor),"manageHoverState"in z&&n(13,h=z.manageHoverState),"hovered"in z&&n(0,v=z.hovered),"eventsIfTopMost"in z&&n(14,S=z.eventsIfTopMost),"interactive"in z&&n(15,C=z.interactive),"$$scope"in z&&n(24,o=z.$$scope)},[v,l,i,s,a,f,u,c,_,d,m,g,y,h,S,C,t,I,E,P,O,B,U,R,o]}class wr extends se{constructor(e){super(),ae(this,e,Zf,Jf,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function xo(r){let e=r[0],n,t,o=el(r);return{c(){o.c(),n=Ze()},m(l,i){o.m(l,i),w(l,n,i),t=!0},p(l,i){i&1&&oe(e,e=l[0])?(he(),L(o,1,1,Q),be(),o=el(l),o.c(),b(o,1),o.m(n.parentNode,n)):o.p(l,i)},i(l){t||(b(o),t=!0)},o(l){L(o),t=!1},d(l){l&&$(n),o.d(l)}}}function el(r){let e;const n=r[15].default,t=Be(n,r,r[14],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16384)&&Re(t,n,o,o[14],e?Ue(n,o[14],l,null):De(o[14]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function Yf(r){let e,n,t=r[0]&&xo(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&b(t,1)):(t=xo(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function Kf(r,e,n){let t,o,{$$slots:l={},$$scope:i}=e,{id:s=ao("vector")}=e,{url:a=null}=e,{tiles:f=null}=e,{promoteId:u=null}=e,{bounds:c=null}=e,{scheme:_=null}=e,{attribution:d=null}=e,{minzoom:m=null}=e,{maxzoom:g=null}=e,{volatile:y=null}=e;if(a&&a.includes("pmtiles://")&&!Xt.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let C=new na;Xt.addProtocol("pmtiles",C.tile)}const{map:h,self:v}=xs();X(r,h,C=>n(13,o=C)),X(r,v,C=>n(0,t=C));let S;return Tt(()=>{t&&o&&(ea(h,t,S),te(v,t=null,t),S=void 0)}),r.$$set=C=>{"id"in C&&n(3,s=C.id),"url"in C&&n(4,a=C.url),"tiles"in C&&n(5,f=C.tiles),"promoteId"in C&&n(6,u=C.promoteId),"bounds"in C&&n(7,c=C.bounds),"scheme"in C&&n(8,_=C.scheme),"attribution"in C&&n(9,d=C.attribution),"minzoom"in C&&n(10,m=C.minzoom),"maxzoom"in C&&n(11,g=C.maxzoom),"volatile"in C&&n(12,y=C.volatile),"$$scope"in C&&n(14,i=C.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&o&&t!==s&&(te(v,t=s,t),ta(o,t,mr({type:"vector",url:a,tiles:f,promoteId:u,bounds:c,scheme:_,attribution:d,minzoom:m,maxzoom:g,volatile:y}),C=>o&&C===t,()=>{t&&(S=o==null?void 0:o.getSource(t))})),r.$$.dirty&8200&&(o==null||o.on("style.load",()=>{S=o==null?void 0:o.getSource(s)}))},[t,h,v,s,a,f,u,c,_,d,m,g,y,o,i,l]}class Mr extends se{constructor(e){super(),ae(this,e,Kf,Yf,oe,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Xf="/ltn/assets/layers-03647595.svg";function Vf(r){let e,n,t,o,l,i,s,a,f;return{c(){e=k("label"),n=j(`Basemap:
  `),t=k("select"),o=k("option"),o.textContent="MapTiler Dataviz",l=k("option"),l.textContent="MapTiler Streets",i=k("option"),i.textContent="MapTiler Satellite",s=k("option"),s.textContent="OS Open Zoomstack",o.__value="dataviz",qe(o,o.__value),l.__value="streets-v2",qe(l,l.__value),i.__value="hybrid",qe(i,i.__value),s.__value="uk-openzoomstack-light",qe(s,s.__value),r[0]===void 0&&an(()=>r[1].call(t))},m(u,c){w(u,e,c),p(e,n),p(e,t),p(t,o),p(t,l),p(t,i),p(t,s),wt(t,r[0],!0),a||(f=V(t,"change",r[1]),a=!0)},p(u,[c]){c&1&&wt(t,u[0])},i:Q,o:Q,d(u){u&&$(e),a=!1,f()}}}function Qf(r,e,n){let t;X(r,Jr,l=>n(0,t=l));function o(){t=fn(this),Jr.set(t)}return[t,o]}class xf extends se{constructor(e){super(),ae(this,e,Qf,Vf,oe,{})}}let fr=Mt(!0);function eu(r){let e,n;return e=new $t({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.layout={visibility:t[0]?"none":"visible"}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function tu(r){let e,n;return e=new Ve({props:{data:r[1],$$slots:{default:[eu]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function nu(r,e,n){let t;return X(r,fr,l=>n(0,t=l)),[t,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class ru extends se{constructor(e){super(),ae(this,e,nu,tu,oe,{})}}function ou(r){let e,n;return e=new Cr({props:{lngLat:r[0],$$slots:{default:[iu]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.lngLat=t[0]),o&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function lu(r){let e,n,t;function o(i){r[3](i)}let l={draggable:!0,$$slots:{default:[su]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.lngLat=r[0]),e=new Cr({props:l}),He.push(()=>ut(e,"lngLat",o)),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.lngLat=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function iu(r){let e,n;const t=r[2].default,o=Be(t,r,r[4],null);return{c(){e=k("span"),o&&o.c(),N(e,"class","dot svelte-1gcxp27")},m(l,i){w(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&16)&&Re(o,t,l,l[4],n?Ue(t,l[4],i,null):De(l[4]),null)},i(l){n||(b(o,l),n=!0)},o(l){L(o,l),n=!1},d(l){l&&$(e),o&&o.d(l)}}}function su(r){let e,n;const t=r[2].default,o=Be(t,r,r[4],null);return{c(){e=k("span"),o&&o.c(),N(e,"class","dot svelte-1gcxp27")},m(l,i){w(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&16)&&Re(o,t,l,l[4],n?Ue(t,l[4],i,null):De(l[4]),null)},i(l){n||(b(o,l),n=!0)},o(l){L(o,l),n=!1},d(l){l&&$(e),o&&o.d(l)}}}function au(r){let e,n,t,o;const l=[lu,ou],i=[];function s(a,f){return a[1]?0:1}return e=s(r),n=i[e]=l[e](r),{c(){n.c(),t=Ze()},m(a,f){i[e].m(a,f),w(a,t,f),o=!0},p(a,[f]){let u=e;e=s(a),e===u?i[e].p(a,f):(he(),L(i[u],1,1,()=>{i[u]=null}),be(),n=i[e],n?n.p(a,f):(n=i[e]=l[e](a),n.c()),b(n,1),n.m(t.parentNode,t))},i(a){o||(b(n),o=!0)},o(a){L(n),o=!1},d(a){a&&$(t),i[e].d(a)}}}function fu(r,e,n){let{$$slots:t={},$$scope:o}=e,{lngLat:l}=e,{draggable:i=!1}=e;function s(a){l=a,n(0,l)}return r.$$set=a=>{"lngLat"in a&&n(0,l=a.lngLat),"draggable"in a&&n(1,i=a.draggable),"$$scope"in a&&n(4,o=a.$$scope)},[l,i,t,s,o]}class wn extends se{constructor(e){super(),ae(this,e,fu,au,oe,{lngLat:0,draggable:1})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const uu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},tl=uu;function nl(r,e,n){const t=r.slice();return t[11]=e[n][0],t[12]=e[n][1],t}function Dr(r){let e,n=[r[12]],t={};for(let o=0;o<n.length;o+=1)t=_e(t,n[o]);return{c(){e=qt(r[11]),pr(e,t)},m(o,l){w(o,e,l)},p(o,l){pr(e,t=ze(n,[l&32&&o[12]]))},d(o){o&&$(e)}}}function rl(r){let e=r[11],n,t=r[11]&&Dr(r);return{c(){t&&t.c(),n=Ze()},m(o,l){t&&t.m(o,l),w(o,n,l)},p(o,l){o[11]?e?oe(e,o[11])?(t.d(1),t=Dr(o),e=o[11],t.c(),t.m(n.parentNode,n)):t.p(o,l):(t=Dr(o),e=o[11],t.c(),t.m(n.parentNode,n)):e&&(t.d(1),t=null,e=o[11])},d(o){o&&$(n),t&&t.d(o)}}}function cu(r){let e,n,t,o,l,i=Me(r[5]),s=[];for(let _=0;_<i.length;_+=1)s[_]=rl(nl(r,i,_));const a=r[10].default,f=Be(a,r,r[9],null);let u=[tl,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":t=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:o=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],c={};for(let _=0;_<u.length;_+=1)c=_e(c,u[_]);return{c(){e=qt("svg");for(let _=0;_<s.length;_+=1)s[_].c();n=Ze(),f&&f.c(),pr(e,c)},m(_,d){w(_,e,d);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null);p(e,n),f&&f.m(e,null),l=!0},p(_,[d]){if(d&32){i=Me(_[5]);let m;for(m=0;m<i.length;m+=1){const g=nl(_,i,m);s[m]?s[m].p(g,d):(s[m]=rl(g),s[m].c(),s[m].m(e,n))}for(;m<s.length;m+=1)s[m].d(1);s.length=i.length}f&&f.p&&(!l||d&512)&&Re(f,a,_,_[9],l?Ue(a,_[9],d,null):De(_[9]),null),pr(e,c=ze(u,[tl,d&128&&_[7],(!l||d&4)&&{width:_[2]},(!l||d&4)&&{height:_[2]},(!l||d&2)&&{stroke:_[1]},(!l||d&28&&t!==(t=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":t},(!l||d&257&&o!==(o=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:o}]))},i(_){l||(b(f,_),l=!0)},o(_){L(f,_),l=!1},d(_){_&&$(e),st(s,_),f&&f.d(_)}}}function du(r,e,n){const t=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let o=So(e,t),{$$slots:l={},$$scope:i}=e,{name:s=void 0}=e,{color:a="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:c=!1}=e,{iconNode:_=[]}=e;const d=(...m)=>m.filter((g,y,h)=>!!g&&h.indexOf(g)===y).join(" ");return r.$$set=m=>{n(8,e=_e(_e({},e),Vt(m))),n(7,o=So(e,t)),"name"in m&&n(0,s=m.name),"color"in m&&n(1,a=m.color),"size"in m&&n(2,f=m.size),"strokeWidth"in m&&n(3,u=m.strokeWidth),"absoluteStrokeWidth"in m&&n(4,c=m.absoluteStrokeWidth),"iconNode"in m&&n(5,_=m.iconNode),"$$scope"in m&&n(9,i=m.$$scope)},e=Vt(e),[s,a,f,u,c,_,d,o,e,i,l]}class _u extends se{constructor(e){super(),ae(this,e,du,cu,oe,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Tr=_u;function mu(r){let e;const n=r[2].default,t=Be(n,r,r[3],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&8)&&Re(t,n,o,o[3],e?Ue(n,o[3],l,null):De(o[3]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function pu(r){let e,n;const t=[{name:"circle-help"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[mu]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new Tr({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,[i]){const s=i&3?ze(t,[t[0],i&2&&kr(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function gu(r,e,n){let{$$slots:t={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,o=i.$$scope)},e=Vt(e),[l,e,t,o]}class hu extends se{constructor(e){super(),ae(this,e,gu,pu,oe,{})}}const bu=hu;function vu(r){let e;const n=r[2].default,t=Be(n,r,r[3],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&8)&&Re(t,n,o,o[3],e?Ue(n,o[3],l,null):De(o[3]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function yu(r){let e,n;const t=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[vu]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new Tr({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,[i]){const s=i&3?ze(t,[t[0],i&2&&kr(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function wu(r,e,n){let{$$slots:t={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,o=i.$$scope)},e=Vt(e),[l,e,t,o]}class $u extends se{constructor(e){super(),ae(this,e,wu,yu,oe,{})}}const ku=$u;function Su(r){let e;const n=r[2].default,t=Be(n,r,r[3],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&8)&&Re(t,n,o,o[3],e?Ue(n,o[3],l,null):De(o[3]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function Lu(r){let e,n;const t=[{name:"pencil"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[Su]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new Tr({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,[i]){const s=i&3?ze(t,[t[0],i&2&&kr(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Cu(r,e,n){let{$$slots:t={},$$scope:o}=e;const l=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,o=i.$$scope)},e=Vt(e),[l,e,t,o]}class Mu extends se{constructor(e){super(),ae(this,e,Cu,Lu,oe,{})}}const yo=Mu;function Tu(r){let e;const n=r[2].default,t=Be(n,r,r[3],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&8)&&Re(t,n,o,o[3],e?Ue(n,o[3],l,null):De(o[3]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function Au(r){let e,n;const t=[{name:"trash-2"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[Tu]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new Tr({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,[i]){const s=i&3?ze(t,[t[0],i&2&&kr(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Fu(r,e,n){let{$$slots:t={},$$scope:o}=e;const l=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,o=i.$$scope)},e=Vt(e),[l,e,t,o]}class Pu extends se{constructor(e){super(),ae(this,e,Fu,Au,oe,{})}}const fs=Pu;function ol(r){let e,n;return e=new Sr({props:{$$slots:{default:[Iu]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Iu(r){let e,n,t;const o=r[1].default,l=Be(o,r,r[4],null);return{c(){e=k("h2"),e.textContent="Help",n=M(),l&&l.c()},m(i,s){w(i,e,s),w(i,n,s),l&&l.m(i,s),t=!0},p(i,s){l&&l.p&&(!t||s&16)&&Re(l,o,i,i[4],t?Ue(o,i[4],s,null):De(i[4]),null)},i(i){t||(b(l,i),t=!0)},o(i){L(l,i),t=!1},d(i){i&&($(e),$(n)),l&&l.d(i)}}}function Eu(r){let e,n,t,o,l,i,s;n=new bu({props:{color:"black"}});let a=r[0]&&ol(r);return{c(){e=k("button"),T(n.$$.fragment),t=M(),a&&a.c(),o=Ze(),N(e,"class","icon-btn help svelte-my65h"),N(e,"aria-label","Help")},m(f,u){w(f,e,u),A(n,e,null),w(f,t,u),a&&a.m(f,u),w(f,o,u),l=!0,i||(s=V(e,"click",r[2]),i=!0)},p(f,[u]){f[0]?a?(a.p(f,u),u&1&&b(a,1)):(a=ol(f),a.c(),b(a,1),a.m(o.parentNode,o)):a&&(he(),L(a,1,1,()=>{a=null}),be())},i(f){l||(b(n.$$.fragment,f),b(a),l=!0)},o(f){L(n.$$.fragment,f),L(a),l=!1},d(f){f&&($(e),$(t),$(o)),F(n),a&&a.d(f),i=!1,s()}}}function Nu(r,e,n){let{$$slots:t={},$$scope:o}=e,l=!1;const i=()=>n(0,l=!0),s=()=>n(0,l=!1);return r.$$set=a=>{"$$scope"in a&&n(4,o=a.$$scope)},[l,t,i,s,o]}class Dt extends se{constructor(e){super(),ae(this,e,Nu,Eu,oe,{})}}function ju(r){let e,n,t,o,l,i=r[0]+1+"",s,a,f=r[1].length+"",u,c,_,d,m,g,y;return{c(){e=k("div"),n=k("button"),t=j("Previous"),l=M(),s=j(i),a=j(" / "),u=j(f),c=M(),_=k("button"),d=j("Next"),n.disabled=o=r[0]==0,N(n,"data-tooltip","Left"),_.disabled=m=r[0]==r[1].length-1,N(_,"data-tooltip","Right"),le(e,"display","flex"),le(e,"justify-content","space-between"),le(e,"align-items","center")},m(h,v){w(h,e,v),p(e,n),p(n,t),p(e,l),p(e,s),p(e,a),p(e,u),p(e,c),p(e,_),p(_,d),g||(y=[V(window,"keydown",r[2]),V(n,"click",r[3]),V(_,"click",r[4])],g=!0)},p(h,[v]){v&1&&o!==(o=h[0]==0)&&(n.disabled=o),v&1&&i!==(i=h[0]+1+"")&&re(s,i),v&2&&f!==(f=h[1].length+"")&&re(u,f),v&3&&m!==(m=h[0]==h[1].length-1)&&(_.disabled=m)},i:Q,o:Q,d(h){h&&$(e),g=!1,lt(y)}}}function zu(r,e,n){let t;X(r,Qt,f=>n(5,t=f));let{list:o}=e,{idx:l=0}=e;$r(()=>{t==null||t.keyboard.disable()}),Tt(()=>{t==null||t.keyboard.enable()});function i(f){f.key=="ArrowLeft"&&(f.stopPropagation(),s()),f.key=="ArrowRight"&&(f.stopPropagation(),a())}function s(){l!=0&&n(0,l--,l)}function a(){l!=o.length-1&&n(0,l++,l)}return r.$$set=f=>{"list"in f&&n(1,o=f.list),"idx"in f&&n(0,l=f.idx)},[l,o,i,s,a]}class Ar extends se{constructor(e){super(),ae(this,e,zu,ju,oe,{list:1,idx:0})}}function Ou(r,e){let n=new Set(r.getStyle().layers.filter(t=>t.type=="line").map(t=>t.id));return e=="dataviz"?["Road network","Path"].filter(t=>n.has(t)):e=="hybrid"?["Path","Road","Tunnel"].filter(t=>n.has(t)):e=="streets-v2"?r.getStyle().layers.filter(t=>t["source-layer"]=="transportation"&&t.type=="line").map(t=>t.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(t=>t["source-layer"]=="roads"&&t.type=="line").map(t=>t.id):[]}const{window:Bu}=Hi;function Ru(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g;return d=Gi(r[8][0]),{c(){e=k("button"),e.textContent="Stop StreetView",n=M(),t=k("fieldset"),o=k("legend"),o.textContent="Source:",l=M(),i=k("label"),s=k("input"),a=j(`
      Google Street View`),f=M(),u=k("label"),c=k("input"),_=j(`
      Bing Streetside`),N(e,"class","secondary"),N(s,"type","radio"),s.__value="google",qe(s,s.__value),N(c,"type","radio"),c.__value="bing",qe(c,c.__value),d.p(s,c)},m(y,h){w(y,e,h),w(y,n,h),w(y,t,h),p(t,o),p(t,l),p(t,i),p(i,s),s.checked=s.__value===r[0],p(i,a),p(t,f),p(t,u),p(u,c),c.checked=c.__value===r[0],p(u,_),m||(g=[V(e,"click",r[3]),V(s,"change",r[7]),V(c,"change",r[9])],m=!0)},p(y,h){h&1&&(s.checked=s.__value===y[0]),h&1&&(c.checked=c.__value===y[0])},d(y){y&&($(e),$(n),$(t)),d.r(),m=!1,lt(g)}}}function Du(r){let e,n,t;return{c(){e=k("button"),e.textContent="StreetView",N(e,"class","secondary")},m(o,l){w(o,e,l),n||(t=V(e,"click",r[2]),n=!0)},p:Q,d(o){o&&$(e),n=!1,t()}}}function Uu(r){let e,n,t;function o(s,a){return s[1]?Du:Ru}let l=o(r),i=l(r);return{c(){i.c(),e=Ze()},m(s,a){i.m(s,a),w(s,e,a),n||(t=V(Bu,"keydown",r[4]),n=!0)},p(s,[a]){l===(l=o(s))&&i?i.p(s,a):(i.d(1),i=l(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Q,o:Q,d(s){s&&$(e),i.d(s),n=!1,t()}}}function Hu(r,e,n){let t;X(r,fr,g=>n(1,t=g));let{map:o}=e,{maptilerBasemap:l}=e,i="google",s=[];function a(){te(fr,t=!1,t),o.on("click",u),o.getCanvas().style.cursor="crosshair";for(let g of Ou(o,l))s.push([g,o.getPaintProperty(g,"line-color")]),o.setPaintProperty(g,"line-color","cyan")}function f(){te(fr,t=!0,t),o.off("click",u),o.getCanvas().style.cursor="inherit";for(let[g,y]of s)o.setPaintProperty(g,"line-color",y);s=[]}Tt(f);function u(g){let y=g.lngLat.lng,h=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${h},${y}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${h}~${y}&style=x`,"_blank")}function c(g){!t&&g.key=="Escape"&&(g.stopPropagation(),f())}const _=[[]];function d(){i=this.__value,n(0,i)}function m(){i=this.__value,n(0,i)}return r.$$set=g=>{"map"in g&&n(5,o=g.map),"maptilerBasemap"in g&&n(6,l=g.maptilerBasemap)},[i,t,a,f,c,o,l,d,_,m]}class Gu extends se{constructor(e){super(),ae(this,e,Hu,Uu,oe,{map:5,maptilerBasemap:6})}}function $e(r,e=!0){return{id:r,beforeId:Wu(r),eventsIfTopMost:e}}function Wu(r){let e=Gt(Qt);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let n,t=!1;for(let o=ll.length-1;o>=0;o--){let l=ll[o];if(l==r){t=!0;break}e.getLayer(l)&&(n=l)}if(!t)throw new Error(`Layer ID ${r} not defined in layerZorder`);return n}let Ur=r=>r,Hr=r=>r;const ll=[Ur(Hr("Background")),"neighbourhood-boundaries","neighbourhood-prioritization-simd","neighbourhood-prioritization-area",Ur("Ferry line"),"neighbourhood-boundaries-outline","debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",Hr("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-gp-practices","context-hospitals","context-schools","context-railway-stations",Hr("Road labels"),Ur("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function sn(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function cn(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function dn(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),n=Math.round(r-e*60);return`${e}m${n}s`}function xr(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function bn(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function il(r){return r.reduce((e,n)=>e+n,0)}function sl(r){let e,n;return e=new Dt({props:{$$slots:{default:[qu]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function qu(r){let e;return{c(){e=k("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
      according to OpenStreetMap.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function Ju(r){let e,n;const t=[$e("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":sn(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s=i&1?ze(t,[t[0],t[1],t[2],{layout:{visibility:l[0]?"visible":"none"}}]):{};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Zu(r){let e,n,t,o,l,i,s,a=r[0]&&sl(r);return o=new Mr({props:{url:`pmtiles://${Ct("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[Ju]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Bus routes",n=M(),a&&a.c(),t=M(),T(o.$$.fragment),N(e,"class","secondary")},m(f,u){w(f,e,u),w(f,n,u),a&&a.m(f,u),w(f,t,u),A(o,f,u),l=!0,i||(s=V(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&b(a,1):(a=sl(f),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(he(),L(a,1,1,()=>{a=null}),be());const c={};u&5&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){l||(b(a),b(o.$$.fragment,f),l=!0)},o(f){L(a),L(o.$$.fragment,f),l=!1},d(f){f&&($(e),$(n),$(t)),a&&a.d(f),F(o,f),i=!1,s()}}}function Yu(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class Ku extends se{constructor(e){super(),ae(this,e,Yu,Zu,oe,{})}}function Xu(r){let e,n;return{c(){e=qt("svg"),n=qt("path"),N(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),N(e,"viewBox","0 0 14 14"),N(e,"width","13"),N(e,"height","13"),N(e,"class","svelte-en2qvf")},m(t,o){w(t,e,o),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&$(e)}}}class us extends se{constructor(e){super(),ae(this,e,null,Xu,oe,{})}}function Vu(r){let e,n;return{c(){e=qt("svg"),n=qt("path"),N(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),N(e,"viewBox","0 0 30 30"),N(e,"fill","none"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"class","svelte-d2loi5")},m(t,o){w(t,e,o),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&$(e)}}}class cs extends se{constructor(e){super(),ae(this,e,null,Vu,oe,{})}}function Qu(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"area.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,o){w(t,e,o)},p(t,o){o&8&&!Ke(e.src,n=t[3]+"area.svg")&&N(e,"src",n),o&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function xu(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"reverse.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,o){w(t,e,o)},p(t,o){o&8&&!Ke(e.src,n=t[3]+"reverse.svg")&&N(e,"src",n),o&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function ec(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"poi.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,o){w(t,e,o)},p(t,o){o&8&&!Ke(e.src,n=t[3]+"poi.svg")&&N(e,"src",n),o&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function tc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"postal_code.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,o){w(t,e,o)},p(t,o){o&8&&!Ke(e.src,n=t[3]+"postal_code.svg")&&N(e,"src",n),o&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function nc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"street.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,o){w(t,e,o)},p(t,o){o&8&&!Ke(e.src,n=t[3]+"street.svg")&&N(e,"src",n),o&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function rc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"road.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,o){w(t,e,o)},p(t,o){o&8&&!Ke(e.src,n=t[3]+"road.svg")&&N(e,"src",n),o&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function oc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"housenumber.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,o){w(t,e,o)},p(t,o){o&8&&!Ke(e.src,n=t[3]+"housenumber.svg")&&N(e,"src",n),o&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function lc(r){let e,n,t,o;return{c(){e=k("img"),Ke(e.src,n=r[5])||N(e,"src",n),N(e,"alt",r[4]),N(e,"class","svelte-ltkwvy")},m(l,i){w(l,e,i),t||(o=V(e,"error",r[14]),t=!0)},p(l,i){i&32&&!Ke(e.src,n=l[5])&&N(e,"src",n),i&16&&N(e,"alt",l[4])},d(l){l&&$(e),t=!1,o()}}}function al(r){let e,n;return{c(){e=k("span"),n=j(r[6]),N(e,"class","secondary svelte-ltkwvy")},m(t,o){w(t,e,o),p(e,n)},p(t,o){o&64&&re(n,t[6])},d(t){t&&$(e)}}}function ic(r){let e,n,t,o,l,i,s,a,f,u=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],m,g,y=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",h,v,S;function C(O,B){return B&1&&(n=null),B&1&&(t=null),B&1&&(o=null),B&1&&(l=null),O[5]?lc:O[0].address?oc:(n==null&&(n=!!O[0].id.startsWith("road.")),n?rc:(t==null&&(t=!!O[0].id.startsWith("address.")),t?nc:(o==null&&(o=!!O[0].id.startsWith("postal_code.")),o?tc:(l==null&&(l=!!O[0].id.startsWith("poi.")),l?ec:O[7]?xu:Qu))))}let I=C(r,-1),E=I(r),P=d&&al(r);return{c(){e=k("li"),E.c(),i=M(),s=k("span"),a=k("span"),f=k("span"),c=j(u),_=M(),P&&P.c(),m=M(),g=k("span"),h=j(y),N(f,"class","primary svelte-ltkwvy"),N(a,"class","svelte-ltkwvy"),N(g,"class","line2 svelte-ltkwvy"),N(s,"class","texts svelte-ltkwvy"),N(e,"tabindex","0"),N(e,"data-selected",r[1]),N(e,"class","svelte-ltkwvy"),pt(e,"selected",r[1])},m(O,B){w(O,e,B),E.m(e,null),p(e,i),p(e,s),p(s,a),p(a,f),p(f,c),p(a,_),P&&P.m(a,null),p(s,m),p(s,g),p(g,h),v||(S=[V(e,"mouseenter",r[12]),V(e,"focus",r[13])],v=!0)},p(O,[B]){I===(I=C(O,B))&&E?E.p(O,B):(E.d(1),E=I(O),E&&(E.c(),E.m(e,i))),B&1&&u!==(u=(O[7]?O[0].place_name:O[0].place_name.replace(/,.*/,""))+"")&&re(c,u),B&37&&(d=O[2]==="always"||O[2]!=="never"&&!O[0].address&&!O[0].id.startsWith("road.")&&!O[0].id.startsWith("address.")&&!O[0].id.startsWith("postal_code.")&&(!O[0].id.startsWith("poi.")||!O[5])&&!O[7]),d?P?P.p(O,B):(P=al(O),P.c(),P.m(a,null)):P&&(P.d(1),P=null),B&1&&y!==(y=(O[7]?"":O[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&re(h,y),B&2&&N(e,"data-selected",O[1]),B&2&&pt(e,"selected",O[1])},i:Q,o:Q,d(O){O&&$(e),E.d(),P&&P.d(),v=!1,lt(S)}}}function sc(r,e,n){var S;let t,o,{feature:l}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:f}=e;const u=(S=l.properties)==null?void 0:S.categories;let c,_,d=0,m=l.place_type[0]==="reverse";function g(){_&&a.add(_),n(10,d++,d)}function y(C){je.call(this,r,C)}function h(C){je.call(this,r,C)}const v=()=>g();return r.$$set=C=>{"feature"in C&&n(0,l=C.feature),"selected"in C&&n(1,i=C.selected),"showPlaceType"in C&&n(2,s=C.showPlaceType),"missingIconsCache"in C&&n(9,a=C.missingIconsCache),"iconsBaseUrl"in C&&n(3,f=C.iconsBaseUrl)},r.$$.update=()=>{var C,I,E,P;if(r.$$.dirty&3640)do n(11,t--,t),n(4,c=u==null?void 0:u[t]),n(5,_=c?f+c.replace(/ /g,"_")+".svg":void 0);while(t>-1&&(!_||a.has(_)));r.$$.dirty&1&&n(6,o=((I=(C=l.properties)==null?void 0:C.categories)==null?void 0:I.join(", "))??((P=(E=l.properties)==null?void 0:E.place_type_name)==null?void 0:P[0])??l.place_type[0])},n(11,t=(u==null?void 0:u.length)??0),[l,i,s,f,c,_,o,m,g,a,d,t,y,h,v]}class ac extends se{constructor(e){super(),ae(this,e,sc,ic,oe,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function fc(r){let e;return{c(){e=k("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',N(e,"class","svelte-7cmwmc")},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}class uc extends se{constructor(e){super(),ae(this,e,null,fc,oe,{})}}function cc(r){let e,n;return{c(){e=qt("svg"),n=qt("path"),N(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),N(e,"viewBox","0 0 60.006 21.412"),N(e,"width","14"),N(e,"height","20"),N(e,"class","svelte-en2qvf")},m(t,o){w(t,e,o),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&$(e)}}}class dc extends se{constructor(e){super(),ae(this,e,null,cc,oe,{})}}function _c(r){let e,n,t;return{c(){e=qt("svg"),n=qt("circle"),t=qt("path"),N(n,"cx","4.789"),N(n,"cy","4.787"),N(n,"r","3.85"),N(n,"class","svelte-1aq105l"),N(t,"d","M12.063 12.063 7.635 7.635"),N(t,"class","svelte-1aq105l"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"width","13"),N(e,"height","13"),N(e,"viewBox","0 0 13 13"),N(e,"class","svelte-1aq105l")},m(o,l){w(o,e,l),p(e,n),p(e,t)},p:Q,i:Q,o:Q,d(o){o&&$(e)}}}class mc extends se{constructor(e){super(),ae(this,e,null,_c,oe,{})}}function pc(r,e,n){const t=e[1],o=e[0],l=t-o;return r===t&&n?r:((r-o)%l+l)%l+o}function fl(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let En;async function gc(r,e,n){const t=r==null?void 0:r.getCenterAndZoom();for(const o of e??[])if(!(t&&(o.minZoom!=null&&o.minZoom>t[0]||o.maxZoom!=null&&o.maxZoom<t[0]))){if(o.type==="fixed")return o.coordinates.join(",");e:if(o.type==="client-geolocation"){if(En&&o.cachedLocationExpiry&&En.time+o.cachedLocationExpiry>Date.now()){if(!En.coords)break e;return En.coords}let l;try{return l=await new Promise((i,s)=>{n.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(f=>f.toFixed(6)).join(","))},a=>{s(a)},o)}),l}catch{}finally{o.cachedLocationExpiry&&(En={time:Date.now(),coords:l})}if(n.signal.aborted)return}if(o.type==="server-geolocation")return"ip";if(t&&o.type==="map-center")return t[1].toFixed(6)+","+t[2].toFixed(6)}}function ul(r,e,n){const t=r.slice();return t[84]=e[n],t[86]=n,t}function cl(r){let e,n;return e=new uc({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function dl(r){let e,n,t,o,l;return n=new dc({}),{c(){e=k("button"),T(n.$$.fragment),N(e,"type","button"),N(e,"title",r[9]),N(e,"class","svelte-bz0zu3"),pt(e,"active",r[0])},m(i,s){w(i,e,s),A(n,e,null),t=!0,o||(l=V(e,"click",r[69]),o=!0)},p(i,s){(!t||s[0]&512)&&N(e,"title",i[9]),(!t||s[0]&1)&&pt(e,"active",i[0])},i(i){t||(b(n.$$.fragment,i),t=!0)},o(i){L(n.$$.fragment,i),t=!1},d(i){i&&$(e),F(n),o=!1,l()}}}function hc(r){let e,n=[],t=new Map,o,l,i,s=Me(r[14]);const a=f=>f[84].id+(f[84].address?","+f[84].address:"");for(let f=0;f<s.length;f+=1){let u=ul(r,s,f),c=a(u);t.set(c,n[f]=_l(c,u))}return{c(){e=k("ul");for(let f=0;f<n.length;f+=1)n[f].c();N(e,"class","options svelte-bz0zu3")},m(f,u){w(f,e,u);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);o=!0,l||(i=[V(e,"mouseleave",r[73]),V(e,"blur",r[74])],l=!0)},p(f,u){u[0]&17880064&&(s=Me(f[14]),he(),n=oa(n,u,a,1,f,s,t,e,la,_l,null,ul),be())},i(f){if(!o){for(let u=0;u<s.length;u+=1)b(n[u]);o=!0}},o(f){for(let u=0;u<n.length;u+=1)L(n[u]);o=!1},d(f){f&&$(e);for(let u=0;u<n.length;u+=1)n[u].d();l=!1,lt(i)}}}function bc(r){let e,n,t,o,l,i;return n=new cs({}),{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("div"),l=j(r[7]),N(o,"class","svelte-bz0zu3"),N(e,"class","no-results svelte-bz0zu3")},m(s,a){w(s,e,a),A(n,e,null),p(e,t),p(e,o),p(o,l),i=!0},p(s,a){(!i||a[0]&128)&&re(l,s[7])},i(s){i||(b(n.$$.fragment,s),i=!0)},o(s){L(n.$$.fragment,s),i=!1},d(s){s&&$(e),F(n)}}}function vc(r){let e="",n;return{c(){n=j(e)},m(t,o){w(t,n,o)},p:Q,i:Q,o:Q,d(t){t&&$(n)}}}function yc(r){let e,n,t,o,l,i,s,a,f,u,c;return n=new cs({}),a=new us({}),{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("div"),l=j(r[6]),i=M(),s=k("button"),T(a.$$.fragment),N(o,"class","svelte-bz0zu3"),N(s,"class","svelte-bz0zu3"),N(e,"class","error svelte-bz0zu3")},m(_,d){w(_,e,d),A(n,e,null),p(e,t),p(e,o),p(o,l),p(e,i),p(e,s),A(a,s,null),f=!0,u||(c=V(s,"click",r[70]),u=!0)},p(_,d){(!f||d[0]&64)&&re(l,_[6])},i(_){f||(b(n.$$.fragment,_),b(a.$$.fragment,_),f=!0)},o(_){L(n.$$.fragment,_),L(a.$$.fragment,_),f=!1},d(_){_&&$(e),F(n),F(a),u=!1,c()}}}function _l(r,e){let n,t,o;function l(){return e[71](e[86])}function i(){return e[72](e[84])}return t=new ac({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),t.$on("mouseenter",l),t.$on("focus",i),{key:r,first:null,c(){n=Ze(),T(t.$$.fragment),this.first=n},m(s,a){w(s,n,a),A(t,s,a),o=!0},p(s,a){e=s;const f={};a[0]&16384&&(f.feature=e[84]),a[0]&1024&&(f.showPlaceType=e[10]),a[0]&49152&&(f.selected=e[15]===e[86]),a[0]&4096&&(f.iconsBaseUrl=e[12]),t.$set(f)},i(s){o||(b(t.$$.fragment,s),o=!0)},o(s){L(t.$$.fragment,s),o=!1},d(s){s&&$(n),F(t,s)}}}function wc(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g,y,h,v,S,C,I,E=!1;l=new mc({}),c=new us({});let P=r[19]&&cl(),O=r[5]==="button"&&dl(r);const B=r[61].default,U=Be(B,r,r[60],null),R=[yc,vc,bc,hc],z=[];function H(G,Y){var Z,ie;return G[18]?0:G[16]?((Z=G[14])==null?void 0:Z.length)===0?2:G[16]&&((ie=G[14])!=null&&ie.length)?3:-1:1}return~(y=H(r))&&(h=z[y]=R[y](r)),{c(){e=M(),n=k("form"),t=k("div"),o=k("button"),T(l.$$.fragment),i=M(),s=k("input"),a=M(),f=k("div"),u=k("button"),T(c.$$.fragment),_=M(),P&&P.c(),d=M(),O&&O.c(),m=M(),U&&U.c(),g=M(),h&&h.c(),N(o,"class","search-button svelte-bz0zu3"),N(o,"type","button"),N(s,"placeholder",r[8]),N(s,"aria-label",r[8]),N(s,"class","svelte-bz0zu3"),N(u,"type","button"),N(u,"title",r[3]),N(u,"class","svelte-bz0zu3"),N(f,"class","clear-button-container svelte-bz0zu3"),pt(f,"displayable",r[1]!==""),N(t,"class","input-group svelte-bz0zu3"),N(n,"tabindex","0"),N(n,"class",v=Lo(r[2])+" svelte-bz0zu3"),pt(n,"can-collapse",r[4]&&r[1]==="")},m(G,Y){w(G,e,Y),w(G,n,Y),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),r[63](s),qe(s,r[1]),p(t,a),p(t,f),p(f,u),A(c,u,null),p(f,_),P&&P.m(f,null),p(t,d),O&&O.m(t,null),p(t,m),U&&U.m(t,null),p(n,g),~y&&z[y].m(n,null),S=!0,C||(I=[V(o,"click",r[62]),V(s,"input",r[64]),V(s,"focus",r[65]),V(s,"blur",r[66]),V(s,"keydown",r[22]),V(s,"input",r[67]),V(u,"click",r[68]),V(n,"submit",Ui(r[21]))],C=!0)},p(G,Y){(!S||Y[0]&256)&&N(s,"placeholder",G[8]),(!S||Y[0]&256)&&N(s,"aria-label",G[8]),Y[0]&2&&s.value!==G[1]&&qe(s,G[1]),(!S||Y[0]&8)&&N(u,"title",G[3]),G[19]?P?Y[0]&524288&&b(P,1):(P=cl(),P.c(),b(P,1),P.m(f,null)):P&&(he(),L(P,1,1,()=>{P=null}),be()),(!S||Y[0]&2)&&pt(f,"displayable",G[1]!==""),G[5]==="button"?O?(O.p(G,Y),Y[0]&32&&b(O,1)):(O=dl(G),O.c(),b(O,1),O.m(t,m)):O&&(he(),L(O,1,1,()=>{O=null}),be()),U&&U.p&&(!S||Y[1]&536870912)&&Re(U,B,G,G[60],S?Ue(B,G[60],Y,null):De(G[60]),null);let Z=y;y=H(G),y===Z?~y&&z[y].p(G,Y):(h&&(he(),L(z[Z],1,1,()=>{z[Z]=null}),be()),~y?(h=z[y],h?h.p(G,Y):(h=z[y]=R[y](G),h.c()),b(h,1),h.m(n,null)):h=null),(!S||Y[0]&4&&v!==(v=Lo(G[2])+" svelte-bz0zu3"))&&N(n,"class",v),(!S||Y[0]&22)&&pt(n,"can-collapse",G[4]&&G[1]==="")},i(G){S||(b(E),b(l.$$.fragment,G),b(c.$$.fragment,G),b(P),b(O),b(U,G),b(h),S=!0)},o(G){L(E),L(l.$$.fragment,G),L(c.$$.fragment,G),L(P),L(O),L(U,G),L(h),S=!1},d(G){G&&($(e),$(n)),F(l),r[63](null),F(c),P&&P.d(),O&&O.d(),U&&U.d(G),~y&&z[y].d(),C=!1,lt(I)}}}function $c(r,e,n){let t,o,{$$slots:l={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:f}=e,{bbox:u=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:m=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:y="never"}=e,{errorMessage:h="Something went wrong…"}=e,{filter:v=()=>!0}=e,{flyTo:S=!0}=e,{fuzzyMatch:C=!0}=e,{language:I=void 0}=e,{limit:E=void 0}=e,{mapController:P=void 0}=e,{minLength:O=2}=e,{noResultsMessage:B="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:U="Search"}=e,{proximity:R=[{type:"server-geolocation"}]}=e,{reverseActive:z=y==="always"}=e,{reverseButtonTitle:H="toggle reverse geocoding"}=e,{searchValue:G=""}=e,{pickedResultStyle:Y="full-geometry"}=e,{showPlaceType:Z="if-needed"}=e,{showResultsWhileTyping:ie=!0}=e,{selectFirst:D=!0}=e,{flyToSelected:ye=!1}=e,{markerOnSelected:ge=!0}=e,{types:fe=void 0}=e,{exhaustiveReverseGeocoding:we=!1}=e,{excludeTypes:ue=!1}=e,{zoom:Fe=s}=e,{apiUrl:Ye="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Te={}}=e,{iconsBaseUrl:ne="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Je=()=>{}}=e;function Ne(){Oe.focus()}function ke(){Oe.blur()}function K(J,et=!0,ht=!1){n(1,G=J),et?(n(15,Ge=-1),Pt()):(Er(!ht,ht),setTimeout(()=>{Oe.focus(),Oe.select()}))}function me(){n(14,ve=void 0),n(56,W=void 0),n(15,Ge=-1)}function x(){n(55,Se=[]),n(56,W=void 0)}let pe=!1,ve,Se,W,dt="",Oe,Ge=-1,kt,bt=[],Qe,xt,en,St;const rr=new Set,Ft=_n();Tt(()=>{P&&(P.setEventHandler(void 0),P.indicateReverse(!1),P.setSelectedMarker(-1),P.setFeatures(void 0,void 0,!1))});function Pt(J){if(xt&&(clearTimeout(xt),xt=void 0),Ge>-1&&ve)n(56,W=ve[Ge]),n(1,G=W.place_type[0]==="reverse"?W.place_name:W.place_name.replace(/,.*/,"")),n(18,kt=void 0),n(55,Se=void 0),n(15,Ge=-1);else if(G){const et=J||!nt(G);Pe(G,{exact:!0}).then(()=>{n(55,Se=ve),n(56,W=void 0),et&&rt()}).catch(ht=>n(18,kt=ht))}}function nt(J){try{return ra(J,6)}catch{return!1}}async function Pe(J,{byId:et=!1,exact:ht=!1}={}){n(18,kt=void 0),Qe==null||Qe.abort();const It=new AbortController;n(19,Qe=It);try{const Ie=nt(J),_t=new URLSearchParams;if(I!==void 0&&_t.set("language",Array.isArray(I)?I.join(","):I??""),fe&&_t.set("types",fe.join(",")),ue&&_t.set("excludeTypes",String(ue)),u&&_t.set("bbox",u.map(or=>or.toFixed(6)).join(",")),m&&_t.set("country",Array.isArray(m)?m.join(","):m),!et&&!Ie){const or=await gc(P,R,It);or&&_t.set("proximity",or),(ht||!ie)&&_t.set("autocomplete","false"),_t.set("fuzzyMatch",String(C))}E!==void 0&&(we||!Ie||(fe==null?void 0:fe.length)===1)&&_t.set("limit",String(E)),_t.set("key",f),Je(_t);const Yt=Ye+"/"+encodeURIComponent(Ie?Ie.decimalLongitude+","+Ie.decimalLatitude:J)+".json?"+_t.toString();if(Yt===dt){et?(n(14,ve=void 0),n(56,W=bt[0])):n(14,ve=bt);return}dt=Yt;const jr=await fetch(Yt,{signal:It.signal,...Te});if(!jr.ok)throw new Error(await jr.text());const zr=await jr.json();Ft("response",{url:Yt,featureCollection:zr}),et?(n(14,ve=void 0),n(56,W=zr.features[0]),bt=[W]):(n(14,ve=zr.features.filter(v)),Ie&&ve.unshift({type:"Feature",properties:{},id:"reverse_"+Ie.decimalLongitude+"_"+Ie.decimalLatitude,text:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_name:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_type:["reverse"],center:[Ie.decimalLongitude,Ie.decimalLatitude],bbox:[Ie.decimalLongitude,Ie.decimalLatitude,Ie.decimalLongitude,Ie.decimalLatitude],geometry:{type:"Point",coordinates:[Ie.decimalLongitude,Ie.decimalLatitude]}}),bt=ve,Ie&&Oe.focus())}catch(Ie){if(Ie&&typeof Ie=="object"&&"name"in Ie&&Ie.name==="AbortError")return;throw Ie}finally{It===Qe&&n(19,Qe=void 0)}}function rt(){var It;if(!(Se!=null&&Se.length)||!S)return;const J=[180,90,-180,-90],et=!Se.some(Ie=>!Ie.matching_text);let ht;for(const Ie of Se){const _t=Pn(Ie);if(ht=ht===void 0?_t:_t===void 0?ht:Math.max(ht,_t),et||!Ie.matching_text)for(const Yt of[0,1,2,3])J[Yt]=Math[Yt<2?"min":"max"](J[Yt],((It=Ie.bbox)==null?void 0:It[Yt])??Ie.center[Yt%2])}P&&Se.length>0&&(W&&J[0]===J[2]&&J[1]===J[3]?P.flyTo(W.center,Pn(W)):P.fitBounds(fl(J),50,ht))}function Pn(J){var ht;if(!J.bbox||J.bbox[0]!==J.bbox[2]&&J.bbox[1]!==J.bbox[3])return;const et=J.id.replace(/\..*/,"");return(Array.isArray((ht=J.properties)==null?void 0:ht.categories)?J.properties.categories.reduce((It,Ie)=>{const _t=Fe[et+"."+Ie];return It===void 0?_t:_t===void 0?It:Math.max(It,_t)},void 0):void 0)??Fe[et]}function Fs(J){n(0,z=y==="always"),n(14,ve=void 0),n(56,W=void 0),n(15,Ge=-1),K(J[1].toFixed(6)+", "+pc(J[0],[-180,180],!0).toFixed(6),!1,!0)}function Ps(J){if(!ve)return;let et=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;et&&(Ge===(D?0:-1)&&et===-1&&n(15,Ge=ve.length),n(15,Ge+=et),Ge>=ve.length&&n(15,Ge=-1),Ge<0&&D&&n(15,Ge=0),J.preventDefault())}function Er(J=!0,et=!1){if(n(18,kt=void 0),ie||et){if(xt&&clearTimeout(xt),G.length<O)return;const ht=G;xt=window.setTimeout(()=>{Pe(ht).catch(It=>n(18,kt=It))},J?g:0)}else n(14,ve=void 0),n(18,kt=void 0)}function Nr(J){n(56,W=J),n(1,G=J.place_name),n(15,Ge=-1)}const Is=()=>Oe.focus();function Es(J){He[J?"unshift":"push"](()=>{Oe=J,n(17,Oe)})}function Ns(){G=this.value,n(1,G),n(13,pe),n(28,_)}const js=()=>n(13,pe=!0),zs=()=>n(13,pe=!1),Os=()=>Er(),Bs=()=>{n(1,G=""),Oe.focus()},Rs=()=>n(0,z=!z),Ds=()=>n(18,kt=void 0),Us=J=>n(15,Ge=J),Hs=J=>Nr(J),Gs=()=>{D||n(15,Ge=-1)},Ws=()=>{};return r.$$set=J=>{"class"in J&&n(2,a=J.class),"apiKey"in J&&n(26,f=J.apiKey),"bbox"in J&&n(27,u=J.bbox),"clearButtonTitle"in J&&n(3,c=J.clearButtonTitle),"clearOnBlur"in J&&n(28,_=J.clearOnBlur),"collapsed"in J&&n(4,d=J.collapsed),"country"in J&&n(29,m=J.country),"debounceSearch"in J&&n(30,g=J.debounceSearch),"enableReverse"in J&&n(5,y=J.enableReverse),"errorMessage"in J&&n(6,h=J.errorMessage),"filter"in J&&n(31,v=J.filter),"flyTo"in J&&n(32,S=J.flyTo),"fuzzyMatch"in J&&n(33,C=J.fuzzyMatch),"language"in J&&n(34,I=J.language),"limit"in J&&n(35,E=J.limit),"mapController"in J&&n(36,P=J.mapController),"minLength"in J&&n(37,O=J.minLength),"noResultsMessage"in J&&n(7,B=J.noResultsMessage),"placeholder"in J&&n(8,U=J.placeholder),"proximity"in J&&n(38,R=J.proximity),"reverseActive"in J&&n(0,z=J.reverseActive),"reverseButtonTitle"in J&&n(9,H=J.reverseButtonTitle),"searchValue"in J&&n(1,G=J.searchValue),"pickedResultStyle"in J&&n(39,Y=J.pickedResultStyle),"showPlaceType"in J&&n(10,Z=J.showPlaceType),"showResultsWhileTyping"in J&&n(40,ie=J.showResultsWhileTyping),"selectFirst"in J&&n(11,D=J.selectFirst),"flyToSelected"in J&&n(41,ye=J.flyToSelected),"markerOnSelected"in J&&n(42,ge=J.markerOnSelected),"types"in J&&n(43,fe=J.types),"exhaustiveReverseGeocoding"in J&&n(44,we=J.exhaustiveReverseGeocoding),"excludeTypes"in J&&n(45,ue=J.excludeTypes),"zoom"in J&&n(46,Fe=J.zoom),"apiUrl"in J&&n(47,Ye=J.apiUrl),"fetchParameters"in J&&n(48,Te=J.fetchParameters),"iconsBaseUrl"in J&&n(12,ne=J.iconsBaseUrl),"adjustUrlQuery"in J&&n(49,Je=J.adjustUrlQuery),"$$scope"in J&&n(60,i=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&n(0,z=y==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{n(16,en=pe),_&&!pe&&n(1,G="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&G.length<O&&(n(56,W=void 0),n(14,ve=void 0),n(18,kt=void 0),n(55,Se=ve)),r.$$.dirty[1]&33554688&&Y!=="marker-only"&&W&&!W.address&&W.geometry.type==="Point"&&W.place_type[0]!=="reverse"&&Pe(W.id,{byId:!0}).catch(J=>n(18,kt=J)),r.$$.dirty[1]&100663330&&(P&&W&&W.id!==St&&S&&(!W.bbox||W.bbox[0]===W.bbox[2]&&W.bbox[1]===W.bbox[3]?P.flyTo(W.center,Pn(W)):P.fitBounds(fl(W.bbox),50,Pn(W)),n(14,ve=void 0),n(55,Se=void 0),n(15,Ge=-1)),n(57,St=W==null?void 0:W.id)),r.$$.dirty[0]&18432&&D&&ve!=null&&ve.length&&n(15,Ge=0),r.$$.dirty[0]&2&&n(15,Ge=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Se!==ve&&n(55,Se=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&P&&P.setEventHandler(J=>{switch(J.type){case"mapClick":z&&Fs(J.coordinates);break;case"markerClick":{const et=ve==null?void 0:ve.find(ht=>ht.id===J.id);et&&Nr(et)}break;case"markerMouseEnter":Se&&n(15,Ge=en?(ve==null?void 0:ve.findIndex(et=>et.id===J.id))??-1:-1);break;case"markerMouseLeave":Se&&n(15,Ge=-1);break}}),r.$$.dirty[0]&49152&&n(58,o=ve==null?void 0:ve[Ge]),r.$$.dirty[1]&134218786&&P&&o&&S&&ye&&P.flyTo(o.center,Pn(o)),r.$$.dirty[1]&256&&n(59,t=Y==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ge||P==null||P.setFeatures(void 0,void 0,t)),r.$$.dirty[1]&419432480&&P&&ge&&!Se&&(P.setFeatures(o?[o]:void 0,void 0,t),P.setSelectedMarker(o?0:-1)),r.$$.dirty[1]&318767136&&P&&P.setFeatures(Se,W,t),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Se&&P&&P.setSelectedMarker(Ge),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&P){const J=nt(G);P.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Ft("select",{feature:o}),r.$$.dirty[1]&33554432&&Ft("pick",{feature:W}),r.$$.dirty[0]&81920&&Ft("optionsvisibilitychange",{optionsVisible:en&&!!ve}),r.$$.dirty[0]&16384&&Ft("featureslisted",{features:ve}),r.$$.dirty[1]&16777216&&Ft("featuresmarked",{features:Se}),r.$$.dirty[0]&1&&Ft("reversetoggle",{reverse:z}),r.$$.dirty[0]&2&&Ft("querychange",{query:G}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&P&&P.indicateReverse(z)},[z,G,a,c,d,y,h,B,U,H,Z,D,ne,pe,ve,Ge,en,Oe,kt,Qe,rr,Pt,Ps,Er,Nr,s,f,u,_,m,g,v,S,C,I,E,P,O,R,Y,ie,ye,ge,fe,we,ue,Fe,Ye,Te,Je,Ne,ke,K,me,x,Se,W,St,o,t,i,l,Is,Es,Ns,js,zs,Os,Bs,Rs,Ds,Us,Hs,Gs,Ws]}class kc extends se{constructor(e){super(),ae(this,e,$c,wc,oe,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function ml(r){let e,n,t;return n=new kc({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=k("div"),T(n.$$.fragment),N(e,"class","svelte-ixhnie")},m(o,l){w(o,e,l),A(n,e,null),t=!0},p(o,l){const i={};l&4&&(i.mapController=o[2]),l&1&&(i.apiKey=o[0]),l&2&&(i.country=o[1]),n.$set(i)},i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function Sc(r){let e,n,t=r[2]&&ml(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,[l]){o[2]?t?(t.p(o,l),l&4&&b(t,1)):(t=ml(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function Lc(r,e,n){let t,{apiKey:o}=e,{map:l}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(f){return f?ia(f,Xt,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=f=>{"apiKey"in f&&n(0,o=f.apiKey),"map"in f&&n(4,l=f.map),"country"in f&&n(1,i=f.country)},r.$$.update=()=>{r.$$.dirty&16&&n(2,t=a(l))},[o,i,t,s,l]}class Cc extends se{constructor(e){super(),ae(this,e,Lc,Sc,oe,{apiKey:0,map:4,country:1})}}function Ht(r,e,n){let t=["match",r];for(let[o,l]of Object.entries(e))t.push(o),t.push(l);return t.push(n),t}function Jt(r,e,n){let t=["step",r];for(let o=1;o<e.length;o++)t.push(n[o-1]),t.push(e[o]);return t.push(n[n.length-1]),t}function rn(){return{type:"FeatureCollection",features:[]}}function pl(r){let e,n,t,o,l;return n=new $n({props:{colorScale:r[3].colorScale,limits:r[3].limits}}),o=new Dt({props:{$$slots:{default:[Mc]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(o,e,null),l=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&$(e),F(n),F(o)}}}function Mc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function gl(r){let e,n,t,o,l;return n=new _o({props:{colors:r[4],horiz:!0}}),o=new Dt({props:{$$slots:{default:[Tc]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(o,e,null),l=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&$(e),F(n),F(o)}}}function Tc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function hl(r){let e,n,t,o,l;return n=new _o({props:{colors:r[5],horiz:!0}}),o=new Dt({props:{$$slots:{default:[Ac]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(o,e,null),l=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&$(e),F(n),F(o)}}}function Ac(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function Fc(r){let e,n,t,o,l,i;const s=[$e("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Ht(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":sn(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new tt({props:a});const f=[$e("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Ht(["get","Level of Service"],r[4],"cyan"),"line-width":sn(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new tt({props:u});const c=[$e("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Ht(["get","Infrastructure type"],r[5],"cyan"),"line-width":sn(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return l=new tt({props:_}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,o,m),A(l,d,m),i=!0},p(d,m){const g=m&9?ze(s,[s[0],s[1],s[2],m&8&&{paint:{"line-color":Ht(["get","Traffic volume category"],{"0 to 1999":d[3].colorScale[0],"2000 to 3999":d[3].colorScale[1],"4000+":d[3].colorScale[2]},"cyan"),"line-width":sn(0)}},m&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};e.$set(g);const y=m&18?ze(f,[f[0],f[1],m&16&&{paint:{"line-color":Ht(["get","Level of Service"],d[4],"cyan"),"line-width":sn(1)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};t.$set(y);const h=m&36?ze(c,[c[0],c[1],c[2],m&32&&{paint:{"line-color":Ht(["get","Infrastructure type"],d[5],"cyan"),"line-width":sn(1)}},m&4&&{layout:{visibility:d[2]?"visible":"none"}}]):{};l.$set(h)},i(d){i||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){L(e.$$.fragment,d),L(t.$$.fragment,d),L(l.$$.fragment,d),i=!1},d(d){d&&($(n),$(o)),F(e,d),F(t,d),F(l,d)}}}function Pc(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m=r[0]&&pl(r),g=r[1]&&gl(r),y=r[2]&&hl(r);return u=new Mr({props:{url:`pmtiles://${Ct("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[Fc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Traffic",n=M(),m&&m.c(),t=M(),o=k("button"),o.textContent="Level of Service",l=M(),g&&g.c(),i=M(),s=k("button"),s.textContent="Existing cycle infrastructure",a=M(),y&&y.c(),f=M(),T(u.$$.fragment),N(e,"class","secondary"),N(o,"class","secondary"),N(s,"class","secondary")},m(h,v){w(h,e,v),w(h,n,v),m&&m.m(h,v),w(h,t,v),w(h,o,v),w(h,l,v),g&&g.m(h,v),w(h,i,v),w(h,s,v),w(h,a,v),y&&y.m(h,v),w(h,f,v),A(u,h,v),c=!0,_||(d=[V(e,"click",r[6]),V(o,"click",r[7]),V(s,"click",r[8])],_=!0)},p(h,[v]){h[0]?m?(m.p(h,v),v&1&&b(m,1)):(m=pl(h),m.c(),b(m,1),m.m(t.parentNode,t)):m&&(he(),L(m,1,1,()=>{m=null}),be()),h[1]?g?(g.p(h,v),v&2&&b(g,1)):(g=gl(h),g.c(),b(g,1),g.m(i.parentNode,i)):g&&(he(),L(g,1,1,()=>{g=null}),be()),h[2]?y?(y.p(h,v),v&4&&b(y,1)):(y=hl(h),y.c(),b(y,1),y.m(f.parentNode,f)):y&&(he(),L(y,1,1,()=>{y=null}),be());const S={};v&519&&(S.$$scope={dirty:v,ctx:h}),u.$set(S)},i(h){c||(b(m),b(g),b(y),b(u.$$.fragment,h),c=!0)},o(h){L(m),L(g),L(y),L(u.$$.fragment,h),c=!1},d(h){h&&($(e),$(n),$(t),$(o),$(l),$(i),$(s),$(a),$(f)),m&&m.d(h),g&&g.d(h),y&&y.d(h),F(u,h),_=!1,lt(d)}}}function Ic(r,e,n){let t=!1,o=!1,l=!1;return[t,o,l,{colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},{High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"},()=>n(0,t=!t),()=>n(1,o=!o),()=>n(2,l=!l)]}class Ec extends se{constructor(e){super(),ae(this,e,Ic,Pc,oe,{})}}function bl(r){let e,n,t,o,l;return n=new _o({props:{colors:r[1],horiz:!0}}),o=new Dt({props:{$$slots:{default:[Nc]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(o,e,null),l=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&$(e),F(n),F(o)}}}function Nc(r){let e;return{c(){e=k("p"),e.innerHTML=`See Scottish data sources for <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
        ,
        <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
        , and
        <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
        .`},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function jc(r){let e=r[3].name+"",n;return{c(){n=j(e)},m(t,o){w(t,n,o)},p(t,o){o&8&&e!==(e=t[3].name+"")&&re(n,e)},d(t){t&&$(n)}}}function zc(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[jc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Oc(r){let e,n;const t=[$e("context-gp-practices"),{paint:{"circle-color":r[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[zc]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new mn({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s=i&3?ze(t,[t[0],i&2&&{paint:{"circle-color":l[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Bc(r){let e=r[3].name+"",n;return{c(){n=j(e)},m(t,o){w(t,n,o)},p(t,o){o&8&&e!==(e=t[3].name+"")&&re(n,e)},d(t){t&&$(n)}}}function Rc(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[Bc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Dc(r){let e,n;const t=[$e("context-hospitals"),{paint:{"circle-color":r[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[Rc]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new mn({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s=i&3?ze(t,[t[0],i&2&&{paint:{"circle-color":l[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Uc(r){let e=r[3].name+"",n,t,o=r[3].pupils+"",l,i;return{c(){n=j(e),t=j(" with "),l=j(o),i=j(" pupils")},m(s,a){w(s,n,a),w(s,t,a),w(s,l,a),w(s,i,a)},p(s,a){a&8&&e!==(e=s[3].name+"")&&re(n,e),a&8&&o!==(o=s[3].pupils+"")&&re(l,o)},d(s){s&&($(n),$(t),$(l),$(i))}}}function Hc(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[Uc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Gc(r){let e,n;const t=[$e("context-schools"),{paint:{"circle-color":r[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[Hc]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new mn({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s=i&3?ze(t,[t[0],i&2&&{paint:{"circle-color":l[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Wc(r){let e,n,t,o,l,i,s,a,f,u,c,_=r[0]&&bl(r);return o=new Ve({props:{data:Ct("cnt_layers/gp_practices.geojson"),generateId:!0,$$slots:{default:[Oc]},$$scope:{ctx:r}}}),i=new Ve({props:{data:Ct("cnt_layers/hospitals.geojson"),generateId:!0,$$slots:{default:[Dc]},$$scope:{ctx:r}}}),a=new Ve({props:{data:Ct("cnt_layers/schools.geojson"),generateId:!0,$$slots:{default:[Gc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="POIs",n=M(),_&&_.c(),t=M(),T(o.$$.fragment),l=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),N(e,"class","secondary")},m(d,m){w(d,e,m),w(d,n,m),_&&_.m(d,m),w(d,t,m),A(o,d,m),w(d,l,m),A(i,d,m),w(d,s,m),A(a,d,m),f=!0,u||(c=V(e,"click",r[2]),u=!0)},p(d,[m]){d[0]?_?(_.p(d,m),m&1&&b(_,1)):(_=bl(d),_.c(),b(_,1),_.m(t.parentNode,t)):_&&(he(),L(_,1,1,()=>{_=null}),be());const g={};m&17&&(g.$$scope={dirty:m,ctx:d}),o.$set(g);const y={};m&17&&(y.$$scope={dirty:m,ctx:d}),i.$set(y);const h={};m&17&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){f||(b(_),b(o.$$.fragment,d),b(i.$$.fragment,d),b(a.$$.fragment,d),f=!0)},o(d){L(_),L(o.$$.fragment,d),L(i.$$.fragment,d),L(a.$$.fragment,d),f=!1},d(d){d&&($(e),$(n),$(t),$(l),$(s)),_&&_.d(d),F(o,d),F(i,d),F(a,d),u=!1,c()}}}function qc(r,e,n){let t=!1;return[t,{Schools:"#7fc97f",GPs:"#beaed4",Hospitals:"#fdc086"},()=>n(0,t=!t)]}class Jc extends se{constructor(e){super(),ae(this,e,qc,Wc,oe,{})}}let ds=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],_s=[20,30,40,50,60,70],on=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],xn=[0,20,40,60,80,100];const vn={mapFeature:{hover:{backgroundColor:"blue"}}};let ur=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],wo=[0,.3,.6,1,1.5,2];function vl(r){let e,n,t,o,l,i;return e=new $n({props:{colorScale:on,limits:xn}}),l=new Dt({props:{$$slots:{default:[Zc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),t=k("p"),t.textContent="Darker colours are more deprived",o=M(),T(l.$$.fragment)},m(s,a){A(e,s,a),w(s,n,a),w(s,t,a),w(s,o,a),A(l,s,a),i=!0},i(s){i||(b(e.$$.fragment,s),b(l.$$.fragment,s),i=!0)},o(s){L(e.$$.fragment,s),L(l.$$.fragment,s),i=!1},d(s){s&&($(n),$(t),$(o)),F(e,s),F(l,s)}}}function Zc(r){let e;return{c(){e=k("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      . SIMD combines different domains: income; employment; health; education, skills
      and training; geographic access to services; crime; and housing.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function yl(r){let e,n,t,o,l,i;return e=new $n({props:{colorScale:r[2],limits:r[3]}}),l=new Dt({props:{$$slots:{default:[Yc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),t=k("p"),t.textContent="Darker colours are denser",o=M(),T(l.$$.fragment)},m(s,a){A(e,s,a),w(s,n,a),w(s,t,a),w(s,o,a),A(l,s,a),i=!0},p(s,a){const f={};a&128&&(f.$$scope={dirty:a,ctx:s}),l.$set(f)},i(s){i||(b(e.$$.fragment,s),b(l.$$.fragment,s),i=!0)},o(s){L(e.$$.fragment,s),L(l.$$.fragment,s),i=!1},d(s){s&&($(n),$(t),$(o)),F(e,s),F(l,s)}}}function Yc(r){let e;return{c(){e=k("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      .`},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function Kc(r){let e,n,t=r[6].id+"",o,l,i=r[6].population.toLocaleString()+"",s,a,f=r[6].imd_rank+"",u,c,_=r[6].imd_percentile+"",d,m;return{c(){e=k("p"),n=j("Data zone "),o=j(t),l=j(`
        has `),s=j(i),a=j(`
        people, and a SIMD rank of `),u=j(f),c=j(", putting it in the "),d=j(_),m=j(`
        percentile.`)},m(g,y){w(g,e,y),p(e,n),p(e,o),p(e,l),p(e,s),p(e,a),p(e,u),p(e,c),p(e,d),p(e,m)},p(g,y){y&64&&t!==(t=g[6].id+"")&&re(o,t),y&64&&i!==(i=g[6].population.toLocaleString()+"")&&re(s,i),y&64&&f!==(f=g[6].imd_rank+"")&&re(u,f),y&64&&_!==(_=g[6].imd_percentile+"")&&re(d,_)},d(g){g&&$(e)}}}function Xc(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[Kc,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Vc(r){let e,n,t=r[6].id+"",o,l,i=r[6].population.toLocaleString()+"",s,a,f=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",u,c;return{c(){e=k("p"),n=j("Data zone "),o=j(t),l=j(`
        has `),s=j(i),a=j(`
        people, with a density of `),u=j(f),c=j(" people per square kilometer")},m(_,d){w(_,e,d),p(e,n),p(e,o),p(e,l),p(e,s),p(e,a),p(e,u),p(e,c)},p(_,d){d&64&&t!==(t=_[6].id+"")&&re(o,t),d&64&&i!==(i=_[6].population.toLocaleString()+"")&&re(s,i),d&64&&f!==(f=Math.round(_[6].population/(_[6].area/1e6)).toLocaleString()+"")&&re(u,f)},d(_){_&&$(e)}}}function Qc(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[Vc,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function xc(r){let e,n,t,o,l,i;const s=[$e("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Jt(["get","imd_percentile"],xn,on),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={$$slots:{default:[Xc]},$$scope:{ctx:r}};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new $t({props:a});const f=[$e("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Jt(["/",["get","population"],["/",["get","area"],1e6]],r[3],r[2]),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={$$slots:{default:[Qc]},$$scope:{ctx:r}};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new $t({props:u});const c=[$e("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return l=new tt({props:_}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,o,m),A(l,d,m),i=!0},p(d,m){const g=m&1?ze(s,[s[0],s[1],s[2],s[3],{layout:{visibility:d[0]?"visible":"none"}}]):{};m&128&&(g.$$scope={dirty:m,ctx:d}),e.$set(g);const y=m&14?ze(f,[f[0],f[1],f[2],m&12&&{paint:{"fill-color":Jt(["/",["get","population"],["/",["get","area"],1e6]],d[3],d[2]),"fill-opacity":at(.7,.9)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};m&128&&(y.$$scope={dirty:m,ctx:d}),t.$set(y);const h=m&3?ze(c,[c[0],c[1],c[2],{layout:{visibility:d[0]||d[1]?"visible":"none"}}]):{};l.$set(h)},i(d){i||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){L(e.$$.fragment,d),L(t.$$.fragment,d),L(l.$$.fragment,d),i=!1},d(d){d&&($(n),$(o)),F(e,d),F(t,d),F(l,d)}}}function ed(r){let e,n,t,o,l,i,s,a,f,u,c=r[0]&&vl(r),_=r[1]&&yl(r);return s=new Mr({props:{url:`pmtiles://${Ct("cnt_layers/population.pmtiles")}`,$$slots:{default:[xc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="SIMD",n=M(),c&&c.c(),t=M(),o=k("button"),o.textContent="Population density",l=M(),_&&_.c(),i=M(),T(s.$$.fragment),N(e,"class","secondary"),N(o,"class","secondary")},m(d,m){w(d,e,m),w(d,n,m),c&&c.m(d,m),w(d,t,m),w(d,o,m),w(d,l,m),_&&_.m(d,m),w(d,i,m),A(s,d,m),a=!0,f||(u=[V(e,"click",r[4]),V(o,"click",r[5])],f=!0)},p(d,[m]){d[0]?c?m&1&&b(c,1):(c=vl(d),c.c(),b(c,1),c.m(t.parentNode,t)):c&&(he(),L(c,1,1,()=>{c=null}),be()),d[1]?_?(_.p(d,m),m&2&&b(_,1)):(_=yl(d),_.c(),b(_,1),_.m(i.parentNode,i)):_&&(he(),L(_,1,1,()=>{_=null}),be());const g={};m&131&&(g.$$scope={dirty:m,ctx:d}),s.$set(g)},i(d){a||(b(c),b(_),b(s.$$.fragment,d),a=!0)},o(d){L(c),L(_),L(s.$$.fragment,d),a=!1},d(d){d&&($(e),$(n),$(t),$(o),$(l),$(i)),c&&c.d(d),_&&_.d(d),F(s,d),f=!1,lt(u)}}}function td(r,e,n){let t=!1,o=!1,l=on.toReversed();return[t,o,l,[0,4700,13e3,33e3,94e3,198e4],()=>n(0,t=!t),()=>n(1,o=!o)]}class nd extends se{constructor(e){super(),ae(this,e,td,ed,oe,{})}}function wl(r){let e,n,t,o,l,i;return l=new Dt({props:{$$slots:{default:[rd]},$$scope:{ctx:r}}}),{c(){e=k("div"),n=k("img"),o=M(),T(l.$$.fragment),Ke(n.src,t=qi)||N(n,"src",t),N(n,"alt","National Rail logo")},m(s,a){w(s,e,a),p(e,n),p(e,o),A(l,e,null),i=!0},i(s){i||(b(l.$$.fragment,s),i=!0)},o(s){L(l.$$.fragment,s),i=!1},d(s){s&&$(e),F(l)}}}function rd(r){let e;return{c(){e=k("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
        according to OpenStreetMap.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function od(r){let e,n=(r[2].name??"Unnamed railway station")+"",t;return{c(){e=k("p"),t=j(n)},m(o,l){w(o,e,l),p(e,t)},p(o,l){l&4&&n!==(n=(o[2].name??"Unnamed railway station")+"")&&re(t,n)},d(o){o&&$(e)}}}function ld(r){let e,n;return e=new gt({props:{$$slots:{default:[od,({props:t})=>({2:t}),({props:t})=>t?4:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&12&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function id(r){let e,n;const t=[$e("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[ld]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new wr({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s=i&1?ze(t,[t[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:l[0]?"visible":"none"}}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function sd(r){let e,n,t,o,l,i,s,a=r[0]&&wl(r);return o=new Ve({props:{data:Ct("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[id]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Railway stations",n=M(),a&&a.c(),t=M(),T(o.$$.fragment),N(e,"class","secondary")},m(f,u){w(f,e,u),w(f,n,u),a&&a.m(f,u),w(f,t,u),A(o,f,u),l=!0,i||(s=V(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&b(a,1):(a=wl(f),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(he(),L(a,1,1,()=>{a=null}),be());const c={};u&9&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){l||(b(a),b(o.$$.fragment,f),l=!0)},o(f){L(a),L(o.$$.fragment,f),l=!1},d(f){f&&($(e),$(n),$(t)),a&&a.d(f),F(o,f),i=!1,s()}}}function ad(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class fd extends se{constructor(e){super(),ae(this,e,ad,sd,oe,{})}}function $l(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function kl(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Sl(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Ll(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Cl(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Ml(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Tl(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g,y,h,v,S,C;e=new Dt({props:{$$slots:{default:[ud]},$$scope:{ctx:r}}});let I=Me(r[7]),E=[];for(let H=0;H<I.length;H+=1)E[H]=Al(Ml(r,I,H));let P=Me(r[8]),O=[];for(let H=0;H<P.length;H+=1)O[H]=Fl(Cl(r,P,H));let B=Me(r[9]),U=[];for(let H=0;H<B.length;H+=1)U[H]=Pl(Ll(r,B,H));let R=Me(r[10]),z=[];for(let H=0;H<R.length;H+=1)z[H]=Il(Sl(r,R,H));return{c(){T(e.$$.fragment),n=M(),t=k("label"),o=j(`Trip purpose:
    `),l=k("select");for(let H=0;H<E.length;H+=1)E[H].c();i=M(),s=k("label"),a=j(`Scenario:
    `),f=k("select");for(let H=0;H<O.length;H+=1)O[H].c();u=M(),c=k("label"),_=j(`Network type:
    `),d=k("select");for(let H=0;H<U.length;H+=1)U[H].c();m=M(),g=k("label"),y=j(`Color by:
    `),h=k("select");for(let H=0;H<z.length;H+=1)z[H].c();r[0]===void 0&&an(()=>r[12].call(l)),r[1]===void 0&&an(()=>r[13].call(f)),r[2]===void 0&&an(()=>r[14].call(d)),r[3]===void 0&&an(()=>r[15].call(h))},m(H,G){A(e,H,G),w(H,n,G),w(H,t,G),p(t,o),p(t,l);for(let Y=0;Y<E.length;Y+=1)E[Y]&&E[Y].m(l,null);wt(l,r[0],!0),w(H,i,G),w(H,s,G),p(s,a),p(s,f);for(let Y=0;Y<O.length;Y+=1)O[Y]&&O[Y].m(f,null);wt(f,r[1],!0),w(H,u,G),w(H,c,G),p(c,_),p(c,d);for(let Y=0;Y<U.length;Y+=1)U[Y]&&U[Y].m(d,null);wt(d,r[2],!0),w(H,m,G),w(H,g,G),p(g,y),p(g,h);for(let Y=0;Y<z.length;Y+=1)z[Y]&&z[Y].m(h,null);wt(h,r[3],!0),v=!0,S||(C=[V(l,"change",r[12]),V(f,"change",r[13]),V(d,"change",r[14]),V(h,"change",r[15])],S=!0)},p(H,G){const Y={};if(G[1]&2&&(Y.$$scope={dirty:G,ctx:H}),e.$set(Y),G[0]&128){I=Me(H[7]);let Z;for(Z=0;Z<I.length;Z+=1){const ie=Ml(H,I,Z);E[Z]?E[Z].p(ie,G):(E[Z]=Al(ie),E[Z].c(),E[Z].m(l,null))}for(;Z<E.length;Z+=1)E[Z].d(1);E.length=I.length}if(G[0]&129&&wt(l,H[0]),G[0]&256){P=Me(H[8]);let Z;for(Z=0;Z<P.length;Z+=1){const ie=Cl(H,P,Z);O[Z]?O[Z].p(ie,G):(O[Z]=Fl(ie),O[Z].c(),O[Z].m(f,null))}for(;Z<O.length;Z+=1)O[Z].d(1);O.length=P.length}if(G[0]&258&&wt(f,H[1]),G[0]&512){B=Me(H[9]);let Z;for(Z=0;Z<B.length;Z+=1){const ie=Ll(H,B,Z);U[Z]?U[Z].p(ie,G):(U[Z]=Pl(ie),U[Z].c(),U[Z].m(d,null))}for(;Z<U.length;Z+=1)U[Z].d(1);U.length=B.length}if(G[0]&516&&wt(d,H[2]),G[0]&1024){R=Me(H[10]);let Z;for(Z=0;Z<R.length;Z+=1){const ie=Sl(H,R,Z);z[Z]?z[Z].p(ie,G):(z[Z]=Il(ie),z[Z].c(),z[Z].m(h,null))}for(;Z<z.length;Z+=1)z[Z].d(1);z.length=R.length}G[0]&1032&&wt(h,H[3])},i(H){v||(b(e.$$.fragment,H),v=!0)},o(H){L(e.$$.fragment,H),v=!1},d(H){H&&($(n),$(t),$(i),$(s),$(u),$(c),$(m),$(g)),F(e,H),st(E,H),st(O,H),st(U,H),st(z,H),S=!1,lt(C)}}}function ud(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#routenetwork"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function Al(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(o,l){w(o,e,l),p(e,t)},p:Q,d(o){o&&$(e)}}}function Fl(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(o,l){w(o,e,l),p(e,t)},p:Q,d(o){o&&$(e)}}}function Pl(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(o,l){w(o,e,l),p(e,t)},p:Q,d(o){o&&$(e)}}}function Il(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(o,l){w(o,e,l),p(e,t)},p:Q,d(o){o&&$(e)}}}function El(r){let e,n,t,o,l=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=k("tr"),n=k("th"),n.textContent=`${r[19]}`,t=M(),o=k("td"),i=j(l),s=M(),a=k("td"),u=j(f),c=M(),_=k("td"),m=j(d),g=M()},m(y,h){w(y,e,h),p(e,n),p(e,t),p(e,o),p(o,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(y,h){h[0]&131072&&l!==(l=y[17][`${y[18]}_fastest_bicycle`].toLocaleString()+"")&&re(i,l),h[0]&131072&&f!==(f=y[17][`${y[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&re(u,f),h[0]&131072&&d!==(d=y[17][`${y[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&re(m,d)},d(y){y&&$(e)}}}function Nl(r){let e,n,t,o,l=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=k("tr"),n=k("th"),n.textContent=`${r[19]}`,t=M(),o=k("td"),i=j(l),s=M(),a=k("td"),u=j(f),c=M(),_=k("td"),m=j(d),g=M()},m(y,h){w(y,e,h),p(e,n),p(e,t),p(e,o),p(o,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(y,h){h[0]&131072&&l!==(l=y[17][`${y[18]}_quietest_bicycle`].toLocaleString()+"")&&re(i,l),h[0]&131072&&f!==(f=y[17][`${y[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&re(u,f),h[0]&131072&&d!==(d=y[17][`${y[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&re(m,d)},d(y){y&&$(e)}}}function cd(r){let e,n,t,o=r[17][r[4]].toLocaleString()+"",l,i,s,a,f=r[17].gradient+"",u,c,_,d,m,g=r[17].quietness+"",y,h,v,S,C,I,E,P,O,B,U,R,z,H,G,Y,Z,ie=Me(r[7]),D=[];for(let fe=0;fe<ie.length;fe+=1)D[fe]=El(kl(r,ie,fe));let ye=Me(r[7]),ge=[];for(let fe=0;fe<ye.length;fe+=1)ge[fe]=Nl($l(r,ye,fe));return{c(){e=k("div"),n=k("p"),t=j("Cyclists: "),l=j(o),i=M(),s=k("p"),a=j("Gradient: "),u=j(f),c=j("%"),_=M(),d=k("p"),m=j("Cycle-friendliness: "),y=j(g),h=j("%"),v=M(),S=k("details"),C=k("summary"),C.textContent="All network details",I=M(),E=k("p"),E.textContent="Fast/Direct network",P=M(),O=k("table"),B=k("tr"),B.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",U=M();for(let fe=0;fe<D.length;fe+=1)D[fe].c();R=M(),z=k("p"),z.textContent="Quiet/Indirect network",H=M(),G=k("table"),Y=k("tr"),Y.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Z=M();for(let fe=0;fe<ge.length;fe+=1)ge[fe].c();le(e,"max-width","30vw"),le(e,"max-height","60vh"),le(e,"overflow","auto")},m(fe,we){w(fe,e,we),p(e,n),p(n,t),p(n,l),p(e,i),p(e,s),p(s,a),p(s,u),p(s,c),p(e,_),p(e,d),p(d,m),p(d,y),p(d,h),p(e,v),p(e,S),p(S,C),p(S,I),p(S,E),p(S,P),p(S,O),p(O,B),p(O,U);for(let ue=0;ue<D.length;ue+=1)D[ue]&&D[ue].m(O,null);p(S,R),p(S,z),p(S,H),p(S,G),p(G,Y),p(G,Z);for(let ue=0;ue<ge.length;ue+=1)ge[ue]&&ge[ue].m(G,null)},p(fe,we){if(we[0]&131088&&o!==(o=fe[17][fe[4]].toLocaleString()+"")&&re(l,o),we[0]&131072&&f!==(f=fe[17].gradient+"")&&re(u,f),we[0]&131072&&g!==(g=fe[17].quietness+"")&&re(y,g),we[0]&131200){ie=Me(fe[7]);let ue;for(ue=0;ue<ie.length;ue+=1){const Fe=kl(fe,ie,ue);D[ue]?D[ue].p(Fe,we):(D[ue]=El(Fe),D[ue].c(),D[ue].m(O,null))}for(;ue<D.length;ue+=1)D[ue].d(1);D.length=ie.length}if(we[0]&131200){ye=Me(fe[7]);let ue;for(ue=0;ue<ye.length;ue+=1){const Fe=$l(fe,ye,ue);ge[ue]?ge[ue].p(Fe,we):(ge[ue]=Nl(Fe),ge[ue].c(),ge[ue].m(G,null))}for(;ue<ge.length;ue+=1)ge[ue].d(1);ge.length=ye.length}},d(fe){fe&&$(e),st(D,fe),st(ge,fe)}}}function dd(r){let e,n;return e=new gt({props:{openOn:"click",$$slots:{default:[cd,({props:t})=>({17:t}),({props:t})=>[t?131072:0]]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o[0]&131088|o[1]&2&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function _d(r){let e,n;const t=[$e("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":jl(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let o={$$slots:{default:[dd]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s=i[0]&112?ze(t,[t[0],t[1],i[0]&80&&{paint:{"line-color":l[6],"line-width":jl(["get",l[4]])}},i[0]&32&&{layout:{visibility:l[5]?"visible":"none"}},t[4]]):{};i[0]&16|i[1]&2&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function md(r){let e,n,t,o,l,i,s,a=r[5]&&Tl(r);return o=new Mr({props:{url:`pmtiles://${Ct("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[_d]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Route network",n=M(),a&&a.c(),t=M(),T(o.$$.fragment),N(e,"class","secondary")},m(f,u){w(f,e,u),w(f,n,u),a&&a.m(f,u),w(f,t,u),A(o,f,u),l=!0,i||(s=V(e,"click",r[11]),i=!0)},p(f,u){f[5]?a?(a.p(f,u),u[0]&32&&b(a,1)):(a=Tl(f),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(he(),L(a,1,1,()=>{a=null}),be());const c={};u[0]&112|u[1]&2&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){l||(b(a),b(o.$$.fragment,f),l=!0)},o(f){L(a),L(o.$$.fragment,f),l=!1},d(f){f&&($(e),$(n),$(t)),a&&a.d(f),F(o,f),i=!1,s()}}}function jl(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function pd(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function gd(r,e,n){let t,o,l=!1,i="all",s="bicycle_go_dutch",a="fastest",f="flow",u=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],c=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],_=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],d=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],m={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};const g=()=>n(5,l=!l);function y(){i=fn(this),n(0,i),n(7,u)}function h(){s=fn(this),n(1,s),n(8,c)}function v(){a=fn(this),n(2,a),n(9,_)}function S(){f=fn(this),n(3,f),n(10,d)}return r.$$.update=()=>{r.$$.dirty[0]&7&&n(4,t=`${i}_${a}_${s}`),r.$$.dirty[0]&24&&n(6,o={none:"#304ce7",flow:pd(["get",t]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Jt(["abs",["get","gradient"]],m.limits,m.colorScale)}[f])},[i,s,a,f,t,l,o,u,c,_,d,g,y,h,v,S]}class hd extends se{constructor(e){super(),ae(this,e,gd,md,oe,{},null,[-1,-1])}}function bd(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g,y,h,v;return l=new Jc({}),s=new nd({}),f=new fd({}),c=new Ku({}),d=new Ec({}),g=new hd({}),{c(){e=k("div"),n=k("button"),n.innerHTML=`<img src="${Xf}" title="Layers" alt="Layers"/>`,t=M(),o=k("div"),T(l.$$.fragment),i=M(),T(s.$$.fragment),a=M(),T(f.$$.fragment),u=M(),T(c.$$.fragment),_=M(),T(d.$$.fragment),m=M(),T(g.$$.fragment),le(o,"display","flex"),le(o,"flex-direction","column"),le(o,"visibility",r[0]?"visible":"collapse"),N(e,"class","pico"),le(e,"display","flex"),le(e,"flex-direction","column"),le(e,"background","grey")},m(S,C){w(S,e,C),p(e,n),p(e,t),p(e,o),A(l,o,null),p(o,i),A(s,o,null),p(o,a),A(f,o,null),p(o,u),A(c,o,null),p(o,_),A(d,o,null),p(o,m),A(g,o,null),y=!0,h||(v=V(n,"click",r[1]),h=!0)},p(S,C){C&1&&le(o,"visibility",S[0]?"visible":"collapse")},i(S){y||(b(l.$$.fragment,S),b(s.$$.fragment,S),b(f.$$.fragment,S),b(c.$$.fragment,S),b(d.$$.fragment,S),b(g.$$.fragment,S),y=!0)},o(S){L(l.$$.fragment,S),L(s.$$.fragment,S),L(f.$$.fragment,S),L(c.$$.fragment,S),L(d.$$.fragment,S),L(g.$$.fragment,S),y=!1},d(S){S&&$(e),F(l),F(s),F(f),F(c),F(d),F(g),h=!1,v()}}}function vd(r){let e,n;return e=new Ef({props:{defaultStyling:!0,$$slots:{default:[bd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function yd(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class wd extends se{constructor(e){super(),ae(this,e,yd,vd,oe,{})}}let q;const nn=new Array(128).fill(void 0);nn.push(void 0,null,!0,!1);function Le(r){return nn[r]}let Wn=nn.length;function $d(r){r<132||(nn[r]=Wn,Wn=r)}function Xe(r){const e=Le(r);return $d(r),e}let yt=0,Bn=null;function Cn(){return(Bn===null||Bn.byteLength===0)&&(Bn=new Uint8Array(q.memory.buffer)),Bn}const cr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},kd=typeof cr.encodeInto=="function"?function(r,e){return cr.encodeInto(r,e)}:function(r,e){const n=cr.encode(r);return e.set(n),{read:r.length,written:n.length}};function Ut(r,e,n){if(n===void 0){const s=cr.encode(r),a=e(s.length,1)>>>0;return Cn().subarray(a,a+s.length).set(s),yt=s.length,a}let t=r.length,o=e(t,1)>>>0;const l=Cn();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),o=n(o,t,t=i+r.length*3,1)>>>0;const s=Cn().subarray(o+i,o+t),a=kd(r,s);i+=a.written}return yt=i,o}function Ln(r){return r==null}let Rn=null;function ee(){return(Rn===null||Rn.byteLength===0)&&(Rn=new Int32Array(q.memory.buffer)),Rn}let Dn=null;function ms(){return(Dn===null||Dn.byteLength===0)&&(Dn=new Float64Array(q.memory.buffer)),Dn}function We(r){Wn===nn.length&&nn.push(nn.length+1);const e=Wn;return Wn=nn[e],nn[e]=r,e}const ps=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ps.decode();function it(r,e){return r=r>>>0,ps.decode(Cn().subarray(r,r+e))}let Un=null;function Sd(){return(Un===null||Un.byteLength===0)&&(Un=new BigInt64Array(q.memory.buffer)),Un}function eo(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=eo(r[0]));for(let i=1;i<o;i++)l+=", "+eo(r[i]);return l+="]",l}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function zl(r,e){const n=e(r.length*1,1)>>>0;return Cn().set(r,n/1),yt=r.length,n}function Ld(r,e){return r=r>>>0,ms().subarray(r/8,r/8+e)}function Cd(r,e){return r=r>>>0,Cn().subarray(r/1,r/1+e)}function hn(r,e){try{return r.apply(this,e)}catch(n){q.__wbindgen_exn_store(We(n))}}class Md{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();q.__wbg_ltn_free(e)}constructor(e,n,t,o){try{const u=q.__wbindgen_add_to_stack_pointer(-16),c=zl(e,q.__wbindgen_malloc),_=yt,d=zl(n,q.__wbindgen_malloc),m=yt;var l=Ln(o)?0:Ut(o,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;q.ltn_new(u,c,_,d,m,We(t),l,i);var s=ee()[u/4+0],a=ee()[u/4+1],f=ee()[u/4+2];if(f)throw Xe(a);return this.__wbg_ptr=s>>>0,this}finally{q.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getInvertedBoundary(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getBounds(){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getBounds(o,this.__wbg_ptr);var e=ee()[o/4+0],n=ee()[o/4+1],t=Ld(e,n).slice();return q.__wbindgen_free(e,n*8,8),t}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapper(o,this.__wbg_ptr);var e=ee()[o/4+0],n=ee()[o/4+1],t=Cd(e,n).slice();return q.__wbindgen_free(e,n*1,1),t}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapperGj(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderModalFilters(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderModalFilters(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderNeighbourhood(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderNeighbourhood(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderAutoBoundaries(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderAutoBoundaries(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}setNeighbourhoodBoundary(e,n){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_setNeighbourhoodBoundary(l,this.__wbg_ptr,i,s,We(n));var t=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const n=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),t=yt;q.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,t)}renameNeighbourhoodBoundary(e,n){const t=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),o=yt,l=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;q.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,t,o,l,i)}setCurrentNeighbourhood(e,n){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_setCurrentNeighbourhood(l,this.__wbg_ptr,i,s,n);var t=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,n){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_addModalFilter(l,this.__wbg_ptr,We(e),i,s);var t=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,n){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_addManyModalFilters(l,this.__wbg_ptr,We(e),i,s);var t=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){q.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_addDiagonalFilter(o,this.__wbg_ptr,e);var n=ee()[o/4+0],t=ee()[o/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_rotateDiagonalFilter(o,this.__wbg_ptr,e);var n=ee()[o/4+0],t=ee()[o/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_deleteDiagonalFilter(o,this.__wbg_ptr,e);var n=ee()[o/4+0],t=ee()[o/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}toggleTravelFlow(e){q.ltn_toggleTravelFlow(this.__wbg_ptr,e)}undo(){q.ltn_undo(this.__wbg_ptr)}redo(){q.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getShortcutsCrossingRoad(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,it(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getAllShortcuts(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllShortcuts(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toSavefile(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_loadSavefile(o,this.__wbg_ptr,We(e));var n=ee()[o/4+0],t=ee()[o/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,n,t,o,l){let i,s;try{const m=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_compareRoute(m,this.__wbg_ptr,e,n,t,o,l);var a=ee()[m/4+0],f=ee()[m/4+1],u=ee()[m/4+2],c=ee()[m/4+3],_=a,d=f;if(c)throw _=0,d=0,Xe(u);return i=_,s=d,it(_,d)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(i,s,1)}}impactToOneDestination(e,n){let t,o;try{const c=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_impactToOneDestination(c,this.__wbg_ptr,e,n);var l=ee()[c/4+0],i=ee()[c/4+1],s=ee()[c/4+2],a=ee()[c/4+3],f=l,u=i;if(a)throw f=0,u=0,Xe(s);return t=f,o=u,it(f,u)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(t,o,1)}}predictImpact(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_predictImpact(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getImpactsOnRoad(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getImpactsOnRoad(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,it(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getAllNeighbourhoods(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllNeighbourhoods(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getAllIntersections(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllIntersections(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getMovements(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getMovements(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,it(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getDemandModel(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getDemandModel(f,this.__wbg_ptr);var t=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=t,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}}async function Td(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Ad(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Xe(e)},r.wbg.__wbindgen_string_get=function(e,n){const t=Le(n),o=typeof t=="string"?t:void 0;var l=Ln(o)?0:Ut(o,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;ee()[e/4+1]=i,ee()[e/4+0]=l},r.wbg.__wbindgen_boolean_get=function(e){const n=Le(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Le(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,n){const t=Le(n),o=typeof t=="number"?t:void 0;ms()[e/8+1]=Ln(o)?0:o,ee()[e/4+0]=!Ln(o)},r.wbg.__wbindgen_is_object=function(e){const n=Le(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_in=function(e,n){return Le(e)in Le(n)},r.wbg.__wbindgen_bigint_from_i64=function(e){return We(e)},r.wbg.__wbindgen_jsval_eq=function(e,n){return Le(e)===Le(n)},r.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return We(n)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(it(e,n));return We(t)},r.wbg.__wbindgen_is_undefined=function(e){return Le(e)===void 0},r.wbg.__wbindgen_string_new=function(e,n){const t=it(e,n);return We(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Le(e)==Le(n)},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Le(e);return We(n)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,n){const t=Le(e)[Le(n)];return We(t)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Le(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Le(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Le(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Le(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Le(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return We(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Le(n).stack,o=Ut(t,q.__wbindgen_malloc,q.__wbindgen_realloc),l=yt;ee()[e/4+1]=l,ee()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,o;try{t=e,o=n,console.error(it(e,n))}finally{q.__wbindgen_free(t,o,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const n=Le(e).performance;return We(n)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Le(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,n){const t=Le(e)[n>>>0];return We(t)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Le(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Le(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,n){const t=new Function(it(e,n));return We(t)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const n=Le(e).next;return We(n)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return hn(function(e){const n=Le(e).next();return We(n)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Le(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const n=Le(e).value;return We(n)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return We(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return hn(function(e,n){const t=Reflect.get(Le(e),Le(n));return We(t)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return hn(function(e,n){const t=Le(e).call(Le(n));return We(t)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return hn(function(){const e=self.self;return We(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return hn(function(){const e=window.window;return We(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return hn(function(){const e=globalThis.globalThis;return We(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return hn(function(){const e=global.global;return We(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Le(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let n;try{n=Le(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Le(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const n=Object.entries(Le(e));return We(n)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const n=Le(e).buffer;return We(n)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const n=new Uint8Array(Le(e));return We(n)},r.wbg.__wbg_set_2357bf09366ee480=function(e,n,t){Le(e).set(Le(n),t>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Le(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let n;try{n=Le(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const t=Le(n),o=typeof t=="bigint"?t:void 0;Sd()[e/8+1]=Ln(o)?BigInt(0):o,ee()[e/4+0]=!Ln(o)},r.wbg.__wbindgen_debug_string=function(e,n){const t=eo(Le(n)),o=Ut(t,q.__wbindgen_malloc,q.__wbindgen_realloc),l=yt;ee()[e/4+1]=l,ee()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,n){throw new Error(it(e,n))},r.wbg.__wbindgen_memory=function(){const e=q.memory;return We(e)},r}function Fd(r,e){return q=r.exports,gs.__wbindgen_wasm_module=e,Un=null,Dn=null,Rn=null,Bn=null,q}async function gs(r){if(q!==void 0)return q;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=Ad();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Td(await r,e);return Fd(n,t)}const Pd=r=>({}),Ol=r=>({}),Id=r=>({}),Bl=r=>({}),Ed=r=>({}),Rl=r=>({});function Nd(r){let e,n,t,o,l,i,s,a;const f=r[1].top,u=Be(f,r,r[0],Rl),c=r[1].left,_=Be(c,r,r[0],Bl),d=r[1].main,m=Be(d,r,r[0],Ol);return{c(){e=k("div"),n=k("div"),u&&u.c(),t=M(),o=k("div"),l=k("div"),_&&_.c(),i=M(),s=k("div"),m&&m.c(),N(n,"class","top svelte-29q570"),N(l,"class","left svelte-29q570"),N(s,"class","main svelte-29q570"),N(o,"class","content svelte-29q570"),N(e,"class","flex-container svelte-29q570")},m(g,y){w(g,e,y),p(e,n),u&&u.m(n,null),p(e,t),p(e,o),p(o,l),_&&_.m(l,null),p(o,i),p(o,s),m&&m.m(s,null),a=!0},p(g,[y]){u&&u.p&&(!a||y&1)&&Re(u,f,g,g[0],a?Ue(f,g[0],y,Ed):De(g[0]),Rl),_&&_.p&&(!a||y&1)&&Re(_,c,g,g[0],a?Ue(c,g[0],y,Id):De(g[0]),Bl),m&&m.p&&(!a||y&1)&&Re(m,d,g,g[0],a?Ue(d,g[0],y,Pd):De(g[0]),Ol)},i(g){a||(b(u,g),b(_,g),b(m,g),a=!0)},o(g){L(u,g),L(_,g),L(m,g),a=!1},d(g){g&&$(e),u&&u.d(g),_&&_.d(g),m&&m.d(g)}}}function jd(r,e,n){let{$$slots:t={},$$scope:o}=e;return r.$$set=l=>{"$$scope"in l&&n(0,o=l.$$scope)},[o,t]}class zd extends se{constructor(e){super(),ae(this,e,jd,Nd,oe,{})}}const Od=r=>({}),Dl=r=>({}),Bd=r=>({}),Ul=r=>({}),Rd=r=>({}),Hl=r=>({});function Dd(r){let e,n,t,o,l,i;const s=r[4].top,a=Be(s,r,r[3],Hl),f=r[4].sidebar,u=Be(f,r,r[3],Ul),c=r[4].map,_=Be(c,r,r[3],Dl);return{c(){e=k("div"),a&&a.c(),n=M(),t=k("div"),u&&u.c(),o=M(),l=k("div"),_&&_.c()},m(d,m){w(d,e,m),a&&a.m(e,null),r[5](e),w(d,n,m),w(d,t,m),u&&u.m(t,null),r[6](t),w(d,o,m),w(d,l,m),_&&_.m(l,null),r[7](l),i=!0},p(d,[m]){a&&a.p&&(!i||m&8)&&Re(a,s,d,d[3],i?Ue(s,d[3],m,Rd):De(d[3]),Hl),u&&u.p&&(!i||m&8)&&Re(u,f,d,d[3],i?Ue(f,d[3],m,Bd):De(d[3]),Ul),_&&_.p&&(!i||m&8)&&Re(_,c,d,d[3],i?Ue(c,d[3],m,Od):De(d[3]),Dl)},i(d){i||(b(a,d),b(u,d),b(_,d),i=!0)},o(d){L(a,d),L(u,d),L(_,d),i=!1},d(d){d&&($(e),$(n),$(t),$(o),$(l)),a&&a.d(d),r[5](null),u&&u.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function Ud(r,e,n){let t,o,l;X(r,to,c=>n(0,t=c)),X(r,no,c=>n(1,o=c)),X(r,ro,c=>n(2,l=c));let{$$slots:i={},$$scope:s}=e;function a(c){He[c?"unshift":"push"](()=>{t=c,to.set(t)})}function f(c){He[c?"unshift":"push"](()=>{o=c,no.set(o)})}function u(c){He[c?"unshift":"push"](()=>{l=c,ro.set(l)})}return r.$$set=c=>{"$$scope"in c&&n(3,s=c.$$scope)},[t,o,l,s,i,a,f,u]}class At extends se{constructor(e){super(),ae(this,e,Ud,Dd,oe,{})}}let to=Mt(null),no=Mt(null),ro=Mt(null);function Hd(r){let e;return{c(){e=j("Back")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Gd(r){let e,n,t,o;return e=new Ce({props:{$$slots:{default:[Hd]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0,t||(o=V(window,"keydown",r[1]),t=!0)},p(l,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l),t=!1,o()}}}function Wd(r){let e=_n();function n(o){o.key=="Escape"&&(o.stopPropagation(),e("click"))}return[e,n,()=>e("click")]}class pn extends se{constructor(e){super(),ae(this,e,Wd,Gd,oe,{})}}function oo(r,e,n){let t=new Set(r.toSavefile().features.filter(o=>o.properties.kind=="boundary").map(o=>o.properties.name));for(;;){let o=window.prompt(e,n);if(!o)return null;if(t.has(o))window.alert(`There is already a neighbourhood called ${o}; please pick another name`);else return o}}function qd(r){let e,n;return e=new $n({props:{colorScale:on,limits:wo}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Jd(r){let e,n;return e=new $n({props:{colorScale:on,limits:xn}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Zd(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;const g=[Jd,qd],y=[];function h(v,S){return v[0]=="simd"?0:v[0]=="area"?1:-1}return~(f=h(r))&&(u=y[f]=g[f](r)),{c(){e=k("div"),n=k("label"),n.textContent="Metric",t=M(),o=k("select"),l=k("option"),l.textContent="None",i=k("option"),i.textContent="Area (km²)",s=k("option"),s.textContent="Fake SIMD (percentile)",a=M(),u&&u.c(),c=Ze(),N(n,"for","prioritization-selection"),l.__value="none",qe(l,l.__value),i.__value="area",qe(i,i.__value),s.__value="simd",qe(s,s.__value),N(o,"id","prioritization-selection"),r[0]===void 0&&an(()=>r[1].call(o)),le(e,"display","flex"),le(e,"gap","16px"),le(e,"align-items","center")},m(v,S){w(v,e,S),p(e,n),p(e,t),p(e,o),p(o,l),p(o,i),p(o,s),wt(o,r[0],!0),w(v,a,S),~f&&y[f].m(v,S),w(v,c,S),_=!0,d||(m=V(o,"change",r[1]),d=!0)},p(v,[S]){S&1&&wt(o,v[0]);let C=f;f=h(v),f!==C&&(u&&(he(),L(y[C],1,1,()=>{y[C]=null}),be()),~f?(u=y[f],u||(u=y[f]=g[f](v),u.c()),b(u,1),u.m(c.parentNode,c)):u=null)},i(v){_||(b(u),_=!0)},o(v){L(u),_=!1},d(v){v&&($(e),$(a),$(c)),~f&&y[f].d(v),d=!1,m()}}}function Yd(r,e,n){let t;X(r,Zt,s=>n(2,t=s));let{selectedPrioritization:o}=e;function l(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="area"?n(0,o="area"):s=="simd"&&n(0,o="simd")}t.startsWith("ltn_cnt/")?l():o="none";function i(){o=fn(this),n(0,o)}return r.$$set=s=>{"selectedPrioritization"in s&&n(0,o=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);o=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",o),history.replaceState({},"",s)}},[o,i]}class hs extends se{constructor(e){super(),ae(this,e,Yd,Zd,oe,{selectedPrioritization:0})}}function Kd(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Xd(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Vd(r){let e,n,t,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[Kd]},$$scope:{ctx:r}}}),l.$on("click",r[12]),a=new Ce({props:{$$slots:{default:[Xd]},$$scope:{ctx:r}}}),a.$on("click",r[13]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),u.textContent="Use an auto-generated boundary",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&131072&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&131072&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){L(l.$$.fragment,_),L(a.$$.fragment,_),c=!1},d(_){_&&$(e),F(l),F(a)}}}function Gl(r){let e,n,t,o,l,i,s;function a(u){r[9](u)}let f={};return r[2]!==void 0&&(f.selectedPrioritization=r[2]),l=new hs({props:f}),He.push(()=>ut(l,"selectedPrioritization",a)),{c(){e=k("h3"),e.textContent="Prioritization",n=M(),t=k("p"),t.textContent="Compare metrics across candidate neighbourhoods.",o=M(),T(l.$$.fragment)},m(u,c){w(u,e,c),w(u,n,c),w(u,t,c),w(u,o,c),A(l,u,c),s=!0},p(u,c){const _={};!i&&c&4&&(i=!0,_.selectedPrioritization=u[2],ct(()=>i=!1)),l.$set(_)},i(u){s||(b(l.$$.fragment,u),s=!0)},o(u){L(l.$$.fragment,u),s=!1},d(u){u&&($(e),$(n),$(t),$(o)),F(l,u)}}}function Wl(r){let e;return{c(){e=k("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Qd(r){let e,n,t,o,l,i=r[4].startsWith("ltn_cnt/"),s,a,f,u,c,_,d,m,g,y,h,v,S,C;n=new pn({}),n.$on("click",r[8]);let I=i&&Gl(r),E=r[2]=="none"&&Wl();return{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("p"),o.textContent=`Click an area to use it as the boundary for your neighbourhood. These
      particular boundaries are suggested by finding roads, railways, and water
      that form severances.`,l=M(),I&&I.c(),s=M(),E&&E.c(),a=M(),f=k("button"),f.textContent="Export to GeoJSON",u=M(),c=k("label"),_=j(`Minimum area (km²)
      `),d=k("input"),m=M(),g=k("label"),y=k("input"),h=j(`
      Remove areas not touching a big road`),N(f,"class","secondary"),N(d,"type","number"),N(d,"min","0"),N(d,"max","1"),N(d,"step","0.01"),N(y,"type","checkbox"),N(e,"slot","sidebar")},m(P,O){w(P,e,O),A(n,e,null),p(e,t),p(e,o),p(e,l),I&&I.m(e,null),p(e,s),E&&E.m(e,null),p(e,a),p(e,f),p(e,u),p(e,c),p(c,_),p(c,d),qe(d,r[0]),p(e,m),p(e,g),p(g,y),y.checked=r[1],p(g,h),v=!0,S||(C=[V(f,"click",r[7]),V(d,"input",r[10]),V(y,"change",r[11])],S=!0)},p(P,O){O&16&&(i=P[4].startsWith("ltn_cnt/")),i?I?(I.p(P,O),O&16&&b(I,1)):(I=Gl(P),I.c(),b(I,1),I.m(e,s)):I&&(he(),L(I,1,1,()=>{I=null}),be()),P[2]=="none"?E||(E=Wl(),E.c(),E.m(e,a)):E&&(E.d(1),E=null),O&1&&uo(d.value)!==P[0]&&qe(d,P[0]),O&2&&(y.checked=P[1])},i(P){v||(b(n.$$.fragment,P),b(I),v=!0)},o(P){L(n.$$.fragment,P),L(I),v=!1},d(P){P&&$(e),F(n),I&&I.d(),E&&E.d(),S=!1,lt(C)}}}function xd(r){let e,n,t=r[16].area_km2.toFixed(1)+"",o,l,i;return{c(){e=k("b"),e.textContent="Area:",n=M(),o=j(t),l=j(` km²
          `),i=k("br")},m(s,a){w(s,e,a),w(s,n,a),w(s,o,a),w(s,l,a),w(s,i,a)},p(s,a){a&65536&&t!==(t=s[16].area_km2.toFixed(1)+"")&&re(o,t)},d(s){s&&($(e),$(n),$(o),$(l),$(i))}}}function e_(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[xd,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&196608&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function t_(r){let e,n,t=r[16].simd.toFixed(1)+"",o;return{c(){e=k("b"),e.textContent="SIMD:",n=M(),o=j(t)},m(l,i){w(l,e,i),w(l,n,i),w(l,o,i)},p(l,i){i&65536&&t!==(t=l[16].simd.toFixed(1)+"")&&re(o,t)},d(l){l&&($(e),$(n),$(o))}}}function n_(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[t_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&196608&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function r_(r){let e,n,t=r[16].area_km2.toFixed(1)+"",o,l;return{c(){e=k("b"),e.textContent="Area:",n=M(),o=j(t),l=j(" km²")},m(i,s){w(i,e,s),w(i,n,s),w(i,o,s),w(i,l,s)},p(i,s){s&65536&&t!==(t=i[16].area_km2.toFixed(1)+"")&&re(o,t)},d(i){i&&($(e),$(n),$(o),$(l))}}}function o_(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[r_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&196608&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function l_(r){let e,n,t,o,l,i,s,a;const f=[$e("neighbourhood-boundaries",!1),{filter:ln(r[0],r[1])},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":at(.2,.4)}},{layout:{visibility:r[2]=="none"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[e_]},$$scope:{ctx:r}};for(let h=0;h<f.length;h+=1)u=_e(u,f[h]);e=new $t({props:u}),e.$on("click",r[6]);const c=[$e("neighbourhood-prioritization-simd"),{filter:ln(r[0],r[1])},{paint:{"fill-color":Jt(["get","simd"],xn,on),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[2]=="simd"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let _={$$slots:{default:[n_]},$$scope:{ctx:r}};for(let h=0;h<c.length;h+=1)_=_e(_,c[h]);t=new $t({props:_}),t.$on("click",r[6]);const d=[$e("neighbourhood-prioritization-area"),{filter:ln(r[0],r[1])},{paint:{"fill-color":Jt(["get","area_km2"],wo,on),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[2]=="area"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let m={$$slots:{default:[o_]},$$scope:{ctx:r}};for(let h=0;h<d.length;h+=1)m=_e(m,d[h]);l=new $t({props:m}),l.$on("click",r[6]);const g=[$e("neighbourhood-boundaries-outline",!1),{filter:ln(r[0],r[1])},{paint:{"line-color":"black","line-width":1}}];let y={};for(let h=0;h<g.length;h+=1)y=_e(y,g[h]);return s=new tt({props:y}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),T(s.$$.fragment)},m(h,v){A(e,h,v),w(h,n,v),A(t,h,v),w(h,o,v),A(l,h,v),w(h,i,v),A(s,h,v),a=!0},p(h,v){const S=v&7?ze(f,[f[0],v&3&&{filter:ln(h[0],h[1])},f[2],v&4&&{layout:{visibility:h[2]=="none"?"visible":"none"}},f[4],f[5]]):{};v&131072&&(S.$$scope={dirty:v,ctx:h}),e.$set(S);const C=v&7?ze(c,[c[0],v&3&&{filter:ln(h[0],h[1])},c[2],v&4&&{layout:{visibility:h[2]=="simd"?"visible":"none"}},c[4],c[5]]):{};v&131072&&(C.$$scope={dirty:v,ctx:h}),t.$set(C);const I=v&7?ze(d,[d[0],v&3&&{filter:ln(h[0],h[1])},d[2],v&4&&{layout:{visibility:h[2]=="area"?"visible":"none"}},d[4],d[5]]):{};v&131072&&(I.$$scope={dirty:v,ctx:h}),l.$set(I);const E=v&3?ze(g,[g[0],{filter:ln(h[0],h[1])},g[2]]):{};s.$set(E)},i(h){a||(b(e.$$.fragment,h),b(t.$$.fragment,h),b(l.$$.fragment,h),b(s.$$.fragment,h),a=!0)},o(h){L(e.$$.fragment,h),L(t.$$.fragment,h),L(l.$$.fragment,h),L(s.$$.fragment,h),a=!1},d(h){h&&($(n),$(o),$(i)),F(e,h),F(t,h),F(l,h),F(s,h)}}}function i_(r){let e,n,t;return n=new Ve({props:{data:r[5],generateId:!0,$$slots:{default:[l_]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),N(e,"slot","map")},m(o,l){w(o,e,l),A(n,e,null),t=!0},p(o,l){const i={};l&131079&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function s_(r){let e,n;return e=new At({props:{$$slots:{map:[i_],sidebar:[Qd],top:[Vd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&131103&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ln(r,e){let n=["all",[">=",["get","area_km2"],r]];return e&&n.push(["get","touches_big_road"]),n}function a_(r,e,n){let t,o,l,i;X(r,ce,S=>n(3,t=S)),X(r,qn,S=>n(14,o=S)),X(r,xe,S=>n(15,l=S)),X(r,Zt,S=>n(4,i=S));let s=l.renderAutoBoundaries(),a=0,f=!0,u="none";function c(S){let C=oo(l,"What do you want to name the neighbourhood?","");if(C)try{let I={type:"Feature",properties:{},geometry:s.features[S.detail.features[0].id].geometry};l.setNeighbourhoodBoundary(C,I),Mn(),l.setCurrentNeighbourhood(C,o),te(ce,t={mode:"neighbourhood"},t)}catch(I){console.log("error when setting auto-generated neighborhood",I),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working.")}}function _(){hr("auto_boundaries.geojson",JSON.stringify(s,null,"  "))}const d=()=>te(ce,t={mode:"pick-neighbourhood"},t);function m(S){u=S,n(2,u)}function g(){a=uo(this.value),n(0,a)}function y(){f=this.checked,n(1,f)}return[a,f,u,t,i,s,c,_,d,m,g,y,()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class f_ extends se{constructor(e){super(),ae(this,e,a_,s_,oe,{})}}function u_(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function c_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function d_(r){let e,n,t,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[u_]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Ce({props:{$$slots:{default:[c_]},$$scope:{ctx:r}}}),a.$on("click",r[12]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),u.textContent="Debug demand model",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&65536&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&65536&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){L(l.$$.fragment,_),L(a.$$.fragment,_),c=!1},d(_){_&&$(e),F(l),F(a)}}}function __(r){let e;return{c(){e=k("p"),e.textContent="Hover on a zone"},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function m_(r){let e,n=r[6].properties.name+"",t,o,l,i,s=r[6].properties.sum_from.toLocaleString()+"",a,f,u,c,_=r[6].properties.sum_to.toLocaleString()+"",d,m,g,y,h=r[6].properties.counts_from[r[3]]+"",v;return{c(){e=k("u"),t=j(n),o=M(),l=k("p"),i=j("Total trips from here: "),a=j(s),f=M(),u=k("p"),c=j("Total trips to here: "),d=j(_),m=M(),g=k("p"),y=j("Total intra-zonal trips starting and ending here: "),v=j(h)},m(S,C){w(S,e,C),p(e,t),w(S,o,C),w(S,l,C),p(l,i),p(l,a),w(S,f,C),w(S,u,C),p(u,c),p(u,d),w(S,m,C),w(S,g,C),p(g,y),p(g,v)},p(S,C){C&64&&n!==(n=S[6].properties.name+"")&&re(t,n),C&64&&s!==(s=S[6].properties.sum_from.toLocaleString()+"")&&re(a,s),C&64&&_!==(_=S[6].properties.sum_to.toLocaleString()+"")&&re(d,_),C&72&&h!==(h=S[6].properties.counts_from[S[3]]+"")&&re(v,h)},d(S){S&&($(e),$(o),$(l),$(f),$(u),$(m),$(g))}}}function p_(r){let e,n,t,o,l=r[0].features.length.toLocaleString()+"",i,s,a,f,u,c,_,d,m,g,y=r[1]?"from":"to",h,v,S=r[3]==null?"each zone":"this zone",C,I,E,P,O,B,U,R,z,H;n=new pn({}),n.$on("click",r[9]),P=new $n({props:{colorScale:ur,limits:r[5]}});function G(ie,D){return ie[6]&&ie[3]!=null?m_:__}let Y=G(r),Z=Y(r);return{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("p"),i=j(l),s=j(" zones"),a=M(),f=k("label"),u=j(`Trips from
      `),c=k("input"),_=j(`
      Trips to`),d=M(),m=k("p"),g=j("Trips "),h=j(y),v=M(),C=j(S),I=j(":"),E=M(),T(P.$$.fragment),O=M(),B=k("hr"),U=M(),Z.c(),N(c,"type","checkbox"),N(c,"role","switch"),N(e,"slot","sidebar")},m(ie,D){w(ie,e,D),A(n,e,null),p(e,t),p(e,o),p(o,i),p(o,s),p(e,a),p(e,f),p(f,u),p(f,c),c.checked=r[1],p(f,_),p(e,d),p(e,m),p(m,g),p(m,h),p(m,v),p(m,C),p(m,I),p(e,E),A(P,e,null),p(e,O),p(e,B),p(e,U),Z.m(e,null),R=!0,z||(H=V(c,"change",r[10]),z=!0)},p(ie,D){(!R||D&1)&&l!==(l=ie[0].features.length.toLocaleString()+"")&&re(i,l),D&2&&(c.checked=ie[1]),(!R||D&2)&&y!==(y=ie[1]?"from":"to")&&re(h,y),(!R||D&8)&&S!==(S=ie[3]==null?"each zone":"this zone")&&re(C,S);const ye={};D&32&&(ye.limits=ie[5]),P.$set(ye),Y===(Y=G(ie))&&Z?Z.p(ie,D):(Z.d(1),Z=Y(ie),Z&&(Z.c(),Z.m(e,null)))},i(ie){R||(b(n.$$.fragment,ie),b(P.$$.fragment,ie),R=!0)},o(ie){L(n.$$.fragment,ie),L(P.$$.fragment,ie),R=!1},d(ie){ie&&$(e),F(n),F(P),Z.d(),z=!1,H()}}}function g_(r){let e,n,t,o,l;const i=[$e("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":at(.5,.1)}},{manageHoverState:!0}];function s(c){r[8](c)}let a={};for(let c=0;c<i.length;c+=1)a=_e(a,i[c]);r[2]!==void 0&&(a.hovered=r[2]),e=new $t({props:a}),He.push(()=>ut(e,"hovered",s));const f=[$e("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let u={};for(let c=0;c<f.length;c+=1)u=_e(u,f[c]);return o=new tt({props:u}),{c(){T(e.$$.fragment),t=M(),T(o.$$.fragment)},m(c,_){A(e,c,_),w(c,t,_),A(o,c,_),l=!0},p(c,_){const d=_&16?ze(i,[i[0],{paint:{"fill-color":c[4],"fill-opacity":at(.5,.1)}},i[2]]):{};!n&&_&4&&(n=!0,d.hovered=c[2],ct(()=>n=!1)),e.$set(d);const m={};o.$set(m)},i(c){l||(b(e.$$.fragment,c),b(o.$$.fragment,c),l=!0)},o(c){L(e.$$.fragment,c),L(o.$$.fragment,c),l=!1},d(c){c&&$(t),F(e,c),F(o,c)}}}function h_(r){let e,n,t;return n=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[g_]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),N(e,"slot","map")},m(o,l){w(o,e,l),A(n,e,null),t=!0},p(o,l){const i={};l&1&&(i.data=o[0]),l&65556&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function b_(r){let e,n;return e=new At({props:{$$slots:{map:[h_],sidebar:[p_],top:[d_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&65791&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function v_(r,e,n){let t,o,l,i,s,a;X(r,ce,S=>n(7,s=S)),X(r,xe,S=>n(13,a=S));let f=rn();try{f=a.getDemandModel()}catch{window.alert("No demand model for this area"),te(ce,s={mode:"pick-neighbourhood"},s)}let u=!1,c=null;function _(S,C){if(S==null){let I=C?"sum_to":"sum_from",E=Math.max(...f.features.map(O=>O.properties[I])),P=d(E);return[P.map(O=>O.toLocaleString()),Jt(["get",I],P,ur)]}else{let I=C?"counts_to":"counts_from",E=[...f.features.map(B=>B.properties[I][S])],P=Math.max(...E),O=d(P);return[O.map(B=>B.toLocaleString()),Jt(["at",["id"],["literal",E]],O,ur)]}}function d(S){let C=ur.length+1;return Array.from(Array(C).keys()).map(I=>Math.round(S/(C-1)*I))}function m(S){c=S,n(2,c)}const g=()=>te(ce,s={mode:"pick-neighbourhood"},s);function y(){u=this.checked,n(1,u)}const h=()=>te(ce,s={mode:"title",firstLoad:!1},s),v=()=>te(ce,s={mode:"pick-neighbourhood"},s);return r.$$.update=()=>{r.$$.dirty&4&&n(3,t=c==null?null:c.id),r.$$.dirty&9&&n(6,o=t!=null?f.features[t]:null),r.$$.dirty&10&&n(5,[l,i]=_(t,u),l,(n(4,i),n(3,t),n(1,u),n(2,c)))},[f,u,c,t,i,l,o,s,m,g,y,h,v]}class y_ extends se{constructor(e){super(),ae(this,e,v_,b_,oe,{})}}function w_(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function $_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function k_(r){let e,n,t,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[w_]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new Ce({props:{$$slots:{default:[$_]},$$scope:{ctx:r}}}),a.$on("click",r[9]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),u.textContent="Debug intersections",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){L(l.$$.fragment,_),L(a.$$.fragment,_),c=!1},d(_){_&&$(e),F(l),F(a)}}}function ql(r){let e,n,t,o,l,i,s;function a(u){r[7](u)}let f={list:r[0].features};return r[1]!==void 0&&(f.idx=r[1]),t=new Ar({props:f}),He.push(()=>ut(t,"idx",a)),{c(){e=k("button"),e.textContent="Pick another intersection",n=M(),T(t.$$.fragment),N(e,"class","secondary")},m(u,c){w(u,e,c),w(u,n,c),A(t,u,c),l=!0,i||(s=V(e,"click",r[6]),i=!0)},p(u,c){const _={};c&1&&(_.list=u[0].features),!o&&c&2&&(o=!0,_.idx=u[1],ct(()=>o=!1)),t.$set(_)},i(u){l||(b(t.$$.fragment,u),l=!0)},o(u){L(t.$$.fragment,u),l=!1},d(u){u&&($(e),$(n)),F(t,u),i=!1,s()}}}function S_(r){let e,n,t,o,l,i;n=new pn({}),n.$on("click",r[5]);let s=r[0].features.length>0&&ql(r);return{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("p"),o.textContent="Purple intersections have some kind of turn restriction.",l=M(),s&&s.c(),N(e,"slot","sidebar")},m(a,f){w(a,e,f),A(n,e,null),p(e,t),p(e,o),p(e,l),s&&s.m(e,null),i=!0},p(a,f){a[0].features.length>0?s?(s.p(a,f),f&1&&b(s,1)):(s=ql(a),s.c(),b(s,1),s.m(e,null)):s&&(he(),L(s,1,1,()=>{s=null}),be())},i(a){i||(b(n.$$.fragment,a),b(s),i=!0)},o(a){L(n.$$.fragment,a),L(s),i=!1},d(a){a&&$(e),F(n),s&&s.d()}}}function L_(r){let e,n;const t=[$e("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new mn({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function C_(r){let e,n,t,o;const l=[$e("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<l.length;f+=1)i=_e(i,l[f]);e=new tt({props:i});const s=[$e("debug-movements-fill"),{filter:["==",["id"],r[1]]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new $t({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),o=!0},p(f,u){const c={};e.$set(c);const _=u&2?ze(s,[s[0],{filter:["==",["id"],f[1]]},s[2]]):{};t.$set(_)},i(f){o||(b(e.$$.fragment,f),b(t.$$.fragment,f),o=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),o=!1},d(f){f&&$(n),F(e,f),F(t,f)}}}function M_(r){let e,n,t,o,l;return n=new Ve({props:{data:ft(r[2]).getAllIntersections(),generateId:!0,$$slots:{default:[L_]},$$scope:{ctx:r}}}),o=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[C_]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),N(e,"slot","map")},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(o,e,null),l=!0},p(i,s){const a={};s&4&&(a.data=ft(i[2]).getAllIntersections()),s&1024&&(a.$$scope={dirty:s,ctx:i}),n.$set(a);const f={};s&1&&(f.data=i[0]),s&1026&&(f.$$scope={dirty:s,ctx:i}),o.$set(f)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&$(e),F(n),F(o)}}}function T_(r){let e,n;return e=new At({props:{$$slots:{map:[M_],sidebar:[S_],top:[k_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1039&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function A_(r,e,n){let t,o;X(r,xe,d=>n(2,t=d)),X(r,ce,d=>n(3,o=d));let l=rn(),i=0;function s(d){n(0,l=t.getMovements(d.detail.features[0].id)),n(1,i=0)}const a=()=>te(ce,o={mode:"pick-neighbourhood"},o),f=()=>n(0,l=rn());function u(d){i=d,n(1,i)}return[l,i,t,o,s,a,f,u,()=>te(ce,o={mode:"title",firstLoad:!1},o),()=>te(ce,o={mode:"pick-neighbourhood"},o)]}class F_ extends se{constructor(e){super(),ae(this,e,A_,T_,oe,{})}}function P_(r){let e,n,t,o,l,i;const s=[$e("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new $t({props:a});const f=[$e("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let u={};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new $t({props:u});const c=[$e("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return l=new tt({props:_}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,o,m),A(l,d,m),i=!0},p(d,[m]){const g=m&1?ze(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const y={};t.$set(y);const h={};l.$set(h)},i(d){i||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){L(e.$$.fragment,d),L(t.$$.fragment,d),L(l.$$.fragment,d),i=!1},d(d){d&&($(n),$(o)),F(e,d),F(t,d),F(l,d)}}}function I_(r,e,n){let t;return X(r,gr,o=>n(0,t=o)),[t]}class Fr extends se{constructor(e){super(),ae(this,e,I_,P_,oe,{})}}function E_(r){let e,n;const t=[$e("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new $t({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,[i]){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}class Pr extends se{constructor(e){super(),ae(this,e,null,E_,oe,{})}}const N_=r=>({}),Jl=r=>({});function Zl(r){let e;const n=r[7]["line-popup"],t=Be(n,r,r[9],Jl);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&512)&&Re(t,n,o,o[9],e?Ue(n,o[9],l,N_):De(o[9]),Jl)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function j_(r){let e,n,t=r[0]&&Zl(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,l){o[0]?t?(t.p(o,l),l&1&&b(t,1)):(t=Zl(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function z_(r){let e,n,t,o;const l=[$e("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let f=0;f<l.length;f+=1)i=_e(i,l[f]);e=new tt({props:i});const s=[$e("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":at(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[j_]},$$scope:{ctx:r}};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new tt({props:a}),t.$on("click",r[8]),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),o=!0},p(f,[u]){const c=u&84?ze(l,[l[0],l[1],{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=u&125?ze(s,[s[0],s[1],u&124&&{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":f[5](f[3],f[4].maxShortcuts),"line-opacity":at(1,.5)}},u&1&&{manageHoverState:f[0]},u&1&&{hoverCursor:f[0]?"pointer":void 0}]):{};u&513&&(_.$$scope={dirty:u,ctx:f}),t.$set(_)},i(f){o||(b(e.$$.fragment,f),b(t.$$.fragment,f),o=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),o=!1},d(f){f&&$(n),F(e,f),F(t,f)}}}function O_(r,e,n){let t,o;X(r,Zr,d=>n(2,t=d)),X(r,gr,d=>n(3,o=d));let{$$slots:l={},$$scope:i}=e,s=co("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:f=(d,m)=>{}}=e;function u(d,m){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?Jt(["get","speed_mph"],_s,ds):m<=2?at("white","blue"):at(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",m,"#A32015"],vn.mapFeature.hover.backgroundColor)}function c(d,m,g){return!d||m<=2?sn(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,m,25+g]}const _=d=>a&&f(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&n(0,a=d.interactive),"onClickLine"in d&&n(1,f=d.onClickLine),"$$scope"in d&&n(9,i=d.$$scope)},[a,f,t,o,s,u,c,l,_,i]}class er extends se{constructor(e){super(),ae(this,e,O_,z_,oe,{interactive:0,onClickLine:1})}}function B_(r){let e;const n=r[3].default,t=Be(n,r,r[5],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&32)&&Re(t,n,o,o[5],e?Ue(n,o[5],l,null):De(o[5]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function R_(r){let e,n,t,o;const l=[$e("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[B_]},$$scope:{ctx:r}};for(let f=0;f<l.length;f+=1)i=_e(i,l[f]);e=new wr({props:i}),e.$on("click",r[4]);const s=[$e("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new wr({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),o=!0},p(f,u){const c={};u&32&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};t.$set(_)},i(f){o||(b(e.$$.fragment,f),b(t.$$.fragment,f),o=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),o=!1},d(f){f&&$(n),F(e,f),F(t,f)}}}function D_(r){let e,n;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[R_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1&&(l.data=t[0]),o&32&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function U_(r,e,n){let t,o,l;X(r,xe,f=>n(1,o=f)),X(r,Nt,f=>n(2,l=f));let{$$slots:i={},$$scope:s}=e;function a(f){je.call(this,r,f)}return r.$$set=f=>{"$$scope"in f&&n(5,s=f.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=l>0?o.renderModalFilters():rn())},[t,o,l,i,a,s]}class gn extends se{constructor(e){super(),ae(this,e,U_,D_,oe,{})}}function H_(r){let e,n;const t=[$e("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new wr({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,[i]){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}class Ir extends se{constructor(e){super(),ae(this,e,null,H_,oe,{})}}function G_(r){let e;const n=r[3].default,t=Be(n,r,r[4],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16)&&Re(t,n,o,o[4],e?Ue(n,o[4],l,null):De(o[4]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function W_(r){let e,n;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[G_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1&&(l.data=t[0]),o&16&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function q_(r,e,n){let t,o;X(r,xe,a=>n(2,o=a));let{$$slots:l={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&n(1,s=a.input),"$$scope"in a&&n(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=s||o.renderNeighbourhood()),r.$$.dirty&1&&Wi("neighbourhoodGj",t)},[t,s,o,l,i]}class tr extends se{constructor(e){super(),ae(this,e,q_,W_,oe,{input:1})}}function J_(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Z_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Y_(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function K_(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;return l=new Ce({props:{$$slots:{default:[J_]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new Ce({props:{$$slots:{default:[Z_]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new Ce({props:{$$slots:{default:[Y_]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),T(c.$$.fragment),_=M(),d=k("li"),d.textContent="Debug mode",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){w(g,e,y),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),A(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&4096&&(h.$$scope={dirty:y,ctx:g}),l.$set(h);const v={};y&4096&&(v.$$scope={dirty:y,ctx:g}),a.$set(v);const S={};y&4096&&(S.$$scope={dirty:y,ctx:g}),c.$set(S)},i(g){m||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){L(l.$$.fragment,g),L(a.$$.fragment,g),L(c.$$.fragment,g),m=!1},d(g){g&&$(e),F(l),F(a),F(c)}}}function Yl(r){let e,n,t;return{c(){e=k("button"),e.textContent="Ⓧ",N(e,"class","close-btn svelte-khnvno")},m(o,l){w(o,e,l),n||(t=V(e,"click",r[6]),n=!0)},p:Q,d(o){o&&$(e),n=!1,t()}}}function X_(r){let e;return{c(){e=k("p"),e.textContent="Click an intersection to inspect its movements."},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function V_(r){let e,n,t,o,l,i,s;e=new Vn({props:{properties:r[0].feature.properties}});function a(u){r[7](u)}let f={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(f.idx=r[0].movementIdx),l=new Ar({props:f}),He.push(()=>ut(l,"idx",a)),{c(){T(e.$$.fragment),n=M(),t=k("h5"),t.textContent="Turn restrictions:",o=M(),T(l.$$.fragment)},m(u,c){A(e,u,c),w(u,n,c),w(u,t,c),w(u,o,c),A(l,u,c),s=!0},p(u,c){const _={};c&1&&(_.properties=u[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=u[0].movements.features),!i&&c&1&&(i=!0,d.idx=u[0].movementIdx,ct(()=>i=!1)),l.$set(d)},i(u){s||(b(e.$$.fragment,u),b(l.$$.fragment,u),s=!0)},o(u){L(e.$$.fragment,u),L(l.$$.fragment,u),s=!1},d(u){u&&($(n),$(t),$(o)),F(e,u),F(l,u)}}}function Q_(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;n=new pn({}),n.$on("click",r[5]);let g=r[0]&&Yl(r);const y=[V_,X_],h=[];function v(S,C){return S[0]?0:1}return _=v(r),d=h[_]=y[_](r),{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("h4"),o.textContent="Roads",l=M(),i=k("p"),i.textContent="Click a road to visit its OSM object.",s=M(),a=k("div"),f=k("h4"),f.textContent="Intersections",u=M(),g&&g.c(),c=M(),d.c(),le(a,"display","flex"),le(a,"align-items","start"),le(a,"justify-content","space-between"),N(e,"slot","sidebar")},m(S,C){w(S,e,C),A(n,e,null),p(e,t),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),p(a,f),p(a,u),g&&g.m(a,null),p(e,c),h[_].m(e,null),m=!0},p(S,C){S[0]?g?g.p(S,C):(g=Yl(S),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let I=_;_=v(S),_===I?h[_].p(S,C):(he(),L(h[I],1,1,()=>{h[I]=null}),be(),d=h[_],d?d.p(S,C):(d=h[_]=y[_](S),d.c()),b(d,1),d.m(e,null))},i(S){m||(b(n.$$.fragment,S),b(d),m=!0)},o(S){L(n.$$.fragment,S),L(d),m=!1},d(S){S&&$(e),F(n),g&&g.d(),h[_].d()}}}function x_(r){let e,n;return e=new Vn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&2048&&(l.properties=t[11]),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function em(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[x_,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function tm(r){let e,n;return e=new Vn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&2048&&(l.properties=t[11]),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function nm(r){let e,n,t;return n=new gt({props:{openOn:"hover",$$slots:{default:[tm,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),N(e,"slot","line-popup")},m(o,l){w(o,e,l),A(n,e,null),t=!0},p(o,l){const i={};l&6144&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function rm(r){let e,n,t,o,l,i,s,a,f,u;e=new Pr({}),t=new Fr({}),l=new Ir({});const c=[$e("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[em]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return s=new mn({props:_}),f=new er({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[nm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),T(s.$$.fragment),a=M(),T(f.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,o,m),A(l,d,m),w(d,i,m),A(s,d,m),w(d,a,m),A(f,d,m),u=!0},p(d,m){const g={};m&4096&&(g.$$scope={dirty:m,ctx:d}),s.$set(g);const y={};m&4096&&(y.$$scope={dirty:m,ctx:d}),f.$set(y)},i(d){u||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(l.$$.fragment,d),b(s.$$.fragment,d),b(f.$$.fragment,d),u=!0)},o(d){L(e.$$.fragment,d),L(t.$$.fragment,d),L(l.$$.fragment,d),L(s.$$.fragment,d),L(f.$$.fragment,d),u=!1},d(d){d&&($(n),$(o),$(i),$(a)),F(e,d),F(t,d),F(l,d),F(s,d),F(f,d)}}}function om(r){let e,n;return e=new Vn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&2048&&(l.properties=t[11]),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function lm(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[om,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function im(r){let e,n;return e=new Vn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&2048&&(l.properties=t[11]),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function sm(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[im,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function am(r){var l,i,s;let e,n;const t=[$e("debug-intersections"),{paint:{"circle-radius":xr(30),"circle-color":vn.mapFeature.hover.backgroundColor,"circle-stroke-color":vn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(l=r[0])==null?void 0:l.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,at(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[sm]},$$scope:{ctx:r}};for(let a=0;a<t.length;a+=1)o=_e(o,t[a]);return e=new mn({props:o}),e.$on("click",r[3]),{c(){T(e.$$.fragment)},m(a,f){A(e,a,f),n=!0},p(a,f){var c,_,d;const u=f&1?ze(t,[t[0],{paint:{"circle-radius":xr(30),"circle-color":vn.mapFeature.hover.backgroundColor,"circle-stroke-color":vn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,at(0,.5)]}},t[2],t[3]]):{};f&4096&&(u.$$scope={dirty:f,ctx:a}),e.$set(u)},i(a){n||(b(e.$$.fragment,a),n=!0)},o(a){L(e.$$.fragment,a),n=!1},d(a){F(e,a)}}}function Kl(r){let e,n;return e=new Ve({props:{data:r[0].movements,generateId:!0,$$slots:{default:[fm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.data=t[0].movements),o&4097&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function fm(r){let e,n,t,o;const l=[$e("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<l.length;f+=1)i=_e(i,l[f]);e=new tt({props:i});const s=[$e("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new $t({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),o=!0},p(f,u){const c={};e.$set(c);const _=u&1?ze(s,[s[0],{filter:["==",["id"],f[0].movementIdx]},s[2]]):{};t.$set(_)},i(f){o||(b(e.$$.fragment,f),b(t.$$.fragment,f),o=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),o=!1},d(f){f&&$(n),F(e,f),F(t,f)}}}function um(r){let e,n,t,o,l,i,s,a;n=new tr({props:{$$slots:{default:[rm]},$$scope:{ctx:r}}}),o=new gn({props:{$$slots:{default:[lm]},$$scope:{ctx:r}}}),i=new Ve({props:{data:ft(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[am]},$$scope:{ctx:r}}});let f=r[0]&&Kl(r);return{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),l=M(),T(i.$$.fragment),s=M(),f&&f.c(),N(e,"slot","map")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),A(o,e,null),p(e,l),A(i,e,null),p(e,s),f&&f.m(e,null),a=!0},p(u,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:u}),o.$set(d);const m={};c&2&&(m.data=ft(u[1]).getAllIntersections()),c&4097&&(m.$$scope={dirty:c,ctx:u}),i.$set(m),u[0]?f?(f.p(u,c),c&1&&b(f,1)):(f=Kl(u),f.c(),b(f,1),f.m(e,null)):f&&(he(),L(f,1,1,()=>{f=null}),be())},i(u){a||(b(n.$$.fragment,u),b(o.$$.fragment,u),b(i.$$.fragment,u),b(f),a=!0)},o(u){L(n.$$.fragment,u),L(o.$$.fragment,u),L(i.$$.fragment,u),L(f),a=!1},d(u){u&&$(e),F(n),F(o),F(i),f&&f.d()}}}function cm(r){let e,n;return e=new At({props:{$$slots:{map:[um],sidebar:[Q_],top:[K_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&4103&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function dm(r,e,n){let t,o;X(r,xe,m=>n(1,t=m)),X(r,ce,m=>n(2,o=m));let l=null;function i(m){let g=m.detail.features[0],y=t.getMovements(g.properties.intersection_id);n(0,l={feature:g,movements:y,movementIdx:0})}const s=(m,g)=>window.open(ft(m.properties).way,"_blank"),a=()=>te(ce,o={mode:"neighbourhood"},o),f=()=>n(0,l=null);function u(m){r.$$.not_equal(l.movementIdx,m)&&(l.movementIdx=m,n(0,l))}return[l,t,o,i,s,a,f,u,()=>te(ce,o={mode:"title",firstLoad:!1},o),()=>te(ce,o={mode:"pick-neighbourhood"},o),()=>te(ce,o={mode:"neighbourhood"},o)]}class _m extends se{constructor(e){super(),ae(this,e,dm,cm,oe,{})}}var Et=63710088e-1,bs={centimeters:Et*100,centimetres:Et*100,degrees:360/(2*Math.PI),feet:Et*3.28084,inches:Et*39.37,kilometers:Et/1e3,kilometres:Et/1e3,meters:Et,metres:Et,miles:Et/1609.344,millimeters:Et*1e3,millimetres:Et*1e3,nauticalmiles:Et/1852,radians:1,yards:Et*1.0936};function mm(r,e,n={}){const t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function lo(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xl(r[0])||!Xl(r[1]))throw new Error("coordinates must contain numbers");return mm({type:"Point",coordinates:r},e,n)}function pm(r,e="kilometers"){const n=bs[e];if(!n)throw new Error(e+" units is invalid");return r*n}function gm(r,e="kilometers"){const n=bs[e];if(!n)throw new Error(e+" units is invalid");return r/n}function io(r){return r%(2*Math.PI)*180/Math.PI}function Wt(r){return r%360*Math.PI/180}function Xl(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Xn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function hm(r){return r.type==="Feature"?r.geometry:r}function vs(r,e,n={}){if(n.final===!0)return bm(r,e);const t=Xn(r),o=Xn(e),l=Wt(t[0]),i=Wt(o[0]),s=Wt(t[1]),a=Wt(o[1]),f=Math.sin(i-l)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return io(Math.atan2(f,u))}function bm(r,e){let n=vs(e,r);return n=(n+180)%360,n}function vm(r,e,n,t={}){const o=Xn(r),l=Wt(o[0]),i=Wt(o[1]),s=Wt(n),a=gm(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=io(u),_=io(f);return lo([c,_],t.properties)}function ym(r,e,n={}){var t=Xn(r),o=Xn(e),l=Wt(o[1]-t[1]),i=Wt(o[0]-t[0]),s=Wt(t[1]),a=Wt(o[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return pm(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function wm(r,e,n={}){const o=hm(r).coordinates;let l=0;for(let i=0;i<o.length&&!(e>=l&&i===o.length-1);i++)if(l>=e){const s=e-l;if(s){const a=vs(o[i],o[i-1])-180;return vm(o[i],s,a,n)}else return lo(o[i])}else l+=ym(o[i],o[i+1],n);return lo(o[o.length-1])}var $m=wm;function km(r){let e,n;const t=[$e("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new mn({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Sm(r){let e,n;return e=new Ve({props:{data:r[0],$$slots:{default:[km]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1&&(l.data=t[0]),o&1024&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}let Lm=50,Cm=100,Mm=.01;function Tm(r,e,n){let{paths:t}=e,o=a(),l=f(),i=c(),s=setInterval(_,Cm);Tt(()=>clearInterval(s));function a(){return t.features.map(d=>1/d.properties.directness).reduce((d,m)=>d+m,0)}function f(){return t.features.length==0?[]:Array.from({length:Lm},u)}function u(){let d=Math.random()*o,m=0;for(let[g,y]of t.features.entries())if(m+=1/y.properties.directness,d<m)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${o}`)}function c(){return{type:"FeatureCollection",features:l.map(({idx:d,distance:m})=>$m(t.features[d],m,{units:"kilometers"}))}}function _(){for(let[d,m]of l.entries())m.distance+=Mm,m.distance>=t.features[m.idx].properties.length_meters/1e3&&(l[d]=u());n(0,i=c())}return r.$$set=d=>{"paths"in d&&n(1,t=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&t&&(o=a(),l=f())},[i,t]}class Am extends se{constructor(e){super(),ae(this,e,Tm,Sm,oe,{paths:1})}}class Fm{constructor(e){mt(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function Pm(r){let e,n,t,o,l;return{c(){e=k("div"),e.textContent="+",n=M(),t=k("img"),l=j(`
    Add diagonal filter`),le(e,"font-size","200%"),le(e,"margin-top","-12px"),N(e,"class","icon"),Ke(t.src,o="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",o),N(t,"alt","Add diagonal filter"),le(t,"transform","rotate(135deg)"),N(t,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,l,s)},p:Q,d(i){i&&($(e),$(n),$(t),$(l))}}}function Im(r){let e;function n(l,i){return l[0].hasRotatedFilter?Nm:Em}let t=n(r),o=t(r);return{c(){o.c(),e=Ze()},m(l,i){o.m(l,i),w(l,e,i)},p(l,i){t!==(t=n(l))&&(o.d(1),o=t(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&$(e),o.d(l)}}}function Em(r){let e,n,t,o,l;return{c(){e=k("div"),e.textContent="↻",n=M(),t=k("img"),l=j(`
      Rotate diagonal filter`),le(e,"font-size","200%"),le(e,"padding-bottom","4px"),N(e,"class","icon"),Ke(t.src,o="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",o),N(t,"alt","Rotate diagonal filter"),le(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,l,s)},d(i){i&&($(e),$(n),$(t),$(l))}}}function Nm(r){let e,n,t,o,l;return{c(){e=k("div"),e.textContent="❌",n=M(),t=k("img"),l=j(`
      Delete diagonal filter`),N(e,"class","icon"),Ke(t.src,o="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",o),N(t,"alt","Remove diagonal filter"),le(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,l,s)},d(i){i&&($(e),$(n),$(t),$(l))}}}function jm(r){let e;function n(l,i){return l[0].filter?Im:Pm}let t=n(r),o=t(r);return{c(){e=k("div"),o.c(),le(e,"display","flex"),le(e,"align-items","center")},m(l,i){w(l,e,i),o.m(e,null)},p(l,[i]){t===(t=n(l))&&o?o.p(l,i):(o.d(1),o=t(l),o&&(o.c(),o.m(e,null)))},i:Q,o:Q,d(l){l&&$(e),o.d()}}}function zm(r,e,n){let{intersection:t}=e;return r.$$set=o=>{"intersection"in o&&n(0,t=o.intersection)},[t]}class Om extends se{constructor(e){super(),ae(this,e,zm,jm,oe,{intersection:0})}}function Bm(r){let e,n;return e=new Om({props:{intersection:r[2](r[6])}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&64&&(l.intersection=t[2](t[6])),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Rm(r){let e,n;return e=new Wf({props:{openOn:"hover",$$slots:{default:[Bm,({features:t})=>({6:t}),({features:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Dm(r){let e,n;const t=[$e("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":xr(30),"circle-color":vn.mapFeature.hover.backgroundColor,"circle-opacity":at(0,.5),"circle-stroke-color":vn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[Rm]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new mn({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,[i]){const s=i&2?ze(t,[t[0],t[1],t[2],{interactive:l[1]},t[4],t[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Um(r,e,n){let{neighbourhood:t=co("neighbourhoodGj")}=e,{onClickIntersection:o=f=>{}}=e,{interactive:l=!1}=e;function i(f){let u=t.features[f];return new Fm(u)}function s(f){return i(f[0].id)}const a=f=>o(s(f.detail.features));return r.$$set=f=>{"neighbourhood"in f&&n(3,t=f.neighbourhood),"onClickIntersection"in f&&n(0,o=f.onClickIntersection),"interactive"in f&&n(1,l=f.interactive)},[o,l,s,t,a]}class Hm extends se{constructor(e){super(),ae(this,e,Um,Dm,oe,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function Vl(r,e,n){const t=r.slice();return t[7]=e[n][0],t[8]=e[n][1],t[9]=e[n][2],t}function Ql(r){let e,n,t,o,l,i,s=r[8]+"",a,f,u,c,_;function d(){return r[3](r[7])}return{c(){e=k("button"),n=k("img"),o=M(),l=k("br"),i=M(),a=j(s),f=M(),Ke(n.src,t=`/ltn//filters/${r[7]}_icon.gif`)||N(n,"src",t),N(n,"width","80"),N(n,"alt",r[8]),N(e,"class","outline"),le(e,"width","100%"),e.disabled=u=r[0]==r[7]},m(m,g){w(m,e,g),p(e,n),p(e,o),p(e,l),p(e,i),p(e,a),p(e,f),c||(_=V(e,"click",d),c=!0)},p(m,g){r=m,g&1&&u!==(u=r[0]==r[7])&&(e.disabled=u)},d(m){m&&$(e),c=!1,_()}}}function Gm(r){let e,n,t,o,l,i,s,a,f,u,c,_,d=r[1][2]+"",m,g,y,h,v,S,C=Me(r[2]),I=[];for(let P=0;P<C.length;P+=1)I[P]=Ql(Vl(r,C,P));function E(){return r[4](r[6])}return{c(){e=k("h3"),e.textContent="Choose a modal filter to place on streets",n=M(),t=k("table"),o=k("tr"),l=k("td");for(let P=0;P<I.length;P+=1)I[P].c();i=M(),s=k("td"),a=k("img"),c=M(),_=k("p"),m=j(d),g=M(),y=k("center"),h=k("button"),h.textContent="Confirm",Ke(a.src,f=`/ltn//filters/${r[0]}.gif`)||N(a,"src",f),N(a,"height","300"),N(a,"alt",u=r[1][1])},m(P,O){w(P,e,O),w(P,n,O),w(P,t,O),p(t,o),p(o,l);for(let B=0;B<I.length;B+=1)I[B]&&I[B].m(l,null);p(o,i),p(o,s),p(s,a),p(s,c),p(s,_),p(_,m),w(P,g,O),w(P,y,O),p(y,h),v||(S=V(h,"click",E),v=!0)},p(P,O){if(r=P,O&5){C=Me(r[2]);let B;for(B=0;B<C.length;B+=1){const U=Vl(r,C,B);I[B]?I[B].p(U,O):(I[B]=Ql(U),I[B].c(),I[B].m(l,null))}for(;B<I.length;B+=1)I[B].d(1);I.length=C.length}O&1&&!Ke(a.src,f=`/ltn//filters/${r[0]}.gif`)&&N(a,"src",f),O&2&&u!==(u=r[1][1])&&N(a,"alt",u),O&2&&d!==(d=r[1][2]+"")&&re(m,d)},d(P){P&&($(e),$(n),$(t),$(g),$(y)),st(I,P),v=!1,S()}}}function Wm(r){let e,n;return e=new Sr({props:{$$slots:{default:[Gm,({dialog:t})=>({6:t}),({dialog:t})=>t?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&4163&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function qm(r,e,n){let t,o;X(r,Yr,f=>n(0,o=f));let l=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const i=f=>te(Yr,o=f,o),s=f=>ft(f).close();function a(f){je.call(this,r,f)}return r.$$.update=()=>{r.$$.dirty&1&&n(1,t=l.find(f=>f[0]==o))},[o,t,l,i,s,a]}class Jm extends se{constructor(e){super(),ae(this,e,qm,Wm,oe,{})}}function xl(r){let e,n;return e=new Ve({props:{data:r[0],$$slots:{default:[Zm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.data=t[0]),o&64&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Zm(r){let e,n;const t=[$e("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Ym(r){let e,n,t=r[0]&&xl(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&b(t,1)):(t=xl(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function Km(r,e,n){let{map:t}=e,o=null;const l=_n();t.on("dragstart",i),t.on("mousemove",s),t.on("mouseup",a),Tt(()=>{t.dragPan.enable(),t.off("dragstart",i),t.off("mousemove",s),t.off("mouseup",a)});function i(){t.dragPan.disable(),n(0,o={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(f){o&&(o.geometry.coordinates.push(f.lngLat.toArray()),n(0,o))}function a(){o&&(l("done",o),n(0,o=null))}return r.$$set=f=>{"map"in f&&n(1,t=f.map)},[o,t]}class Xm extends se{constructor(e){super(),ae(this,e,Km,Ym,oe,{map:1})}}function Vm(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Qm(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function xm(r){let e;return{c(){e=k("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function ep(r){let e;return{c(){e=j("View shortcuts")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function tp(r){let e;return{c(){e=j("Route")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function np(r){let e;return{c(){e=j("Impact routing to one destination")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function rp(r){let e;return{c(){e=j("Change this boundary")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function op(r){let e;return{c(){e=j("Debug")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function lp(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g,y,h,v,S,C,I,E,P,O,B,U,R,z,H,G;return l=new Ce({props:{$$slots:{default:[Vm]},$$scope:{ctx:r}}}),l.$on("click",r[31]),a=new Ce({props:{$$slots:{default:[Qm]},$$scope:{ctx:r}}}),a.$on("click",r[32]),_=new Dt({props:{$$slots:{default:[xm]},$$scope:{ctx:r}}}),h=new Ce({props:{$$slots:{default:[ep]},$$scope:{ctx:r}}}),h.$on("click",r[33]),C=new Ce({props:{$$slots:{default:[tp]},$$scope:{ctx:r}}}),C.$on("click",r[34]),P=new Ce({props:{$$slots:{default:[np]},$$scope:{ctx:r}}}),P.$on("click",r[35]),U=new Ce({props:{$$slots:{default:[rp]},$$scope:{ctx:r}}}),U.$on("click",r[36]),H=new Ce({props:{$$slots:{default:[op]},$$scope:{ctx:r}}}),H.$on("click",r[37]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),c=j(`Editing
          `),T(_.$$.fragment),d=M(),m=k("nav"),g=k("ul"),y=k("li"),T(h.$$.fragment),v=M(),S=k("li"),T(C.$$.fragment),I=M(),E=k("li"),T(P.$$.fragment),O=M(),B=k("li"),T(U.$$.fragment),R=M(),z=k("li"),T(H.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),le(e,"display","flex"),le(e,"justify-content","space-between")},m(Y,Z){w(Y,e,Z),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),p(u,c),A(_,u,null),p(e,d),p(e,m),p(m,g),p(g,y),A(h,y,null),p(g,v),p(g,S),A(C,S,null),p(g,I),p(g,E),A(P,E,null),p(g,O),p(g,B),A(U,B,null),p(g,R),p(g,z),A(H,z,null),G=!0},p(Y,Z){const ie={};Z[1]&1024&&(ie.$$scope={dirty:Z,ctx:Y}),l.$set(ie);const D={};Z[1]&1024&&(D.$$scope={dirty:Z,ctx:Y}),a.$set(D);const ye={};Z[1]&1024&&(ye.$$scope={dirty:Z,ctx:Y}),_.$set(ye);const ge={};Z[1]&1024&&(ge.$$scope={dirty:Z,ctx:Y}),h.$set(ge);const fe={};Z[1]&1024&&(fe.$$scope={dirty:Z,ctx:Y}),C.$set(fe);const we={};Z[1]&1024&&(we.$$scope={dirty:Z,ctx:Y}),P.$set(we);const ue={};Z[1]&1024&&(ue.$$scope={dirty:Z,ctx:Y}),U.$set(ue);const Fe={};Z[1]&1024&&(Fe.$$scope={dirty:Z,ctx:Y}),H.$set(Fe)},i(Y){G||(b(l.$$.fragment,Y),b(a.$$.fragment,Y),b(_.$$.fragment,Y),b(h.$$.fragment,Y),b(C.$$.fragment,Y),b(P.$$.fragment,Y),b(U.$$.fragment,Y),b(H.$$.fragment,Y),G=!0)},o(Y){L(l.$$.fragment,Y),L(a.$$.fragment,Y),L(_.$$.fragment,Y),L(h.$$.fragment,Y),L(C.$$.fragment,Y),L(P.$$.fragment,Y),L(U.$$.fragment,Y),L(H.$$.fragment,Y),G=!1},d(Y){Y&&$(e),F(l),F(a),F(_),F(h),F(C),F(P),F(U),F(H)}}}function ei(r){let e;return{c(){e=k("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function ti(r){let e,n;return e=new $n({props:{colorScale:ds,limits:_s}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ip(r){let e,n,t;return{c(){e=j("Undo ("),n=j(r[4]),t=j(")")},m(o,l){w(o,e,l),w(o,n,l),w(o,t,l)},p(o,l){l[0]&16&&re(n,o[4])},d(o){o&&($(e),$(n),$(t))}}}function sp(r){let e;return{c(){e=j("Undo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function ap(r){let e,n,t;return{c(){e=j("Redo ("),n=j(r[5]),t=j(")")},m(o,l){w(o,e,l),w(o,n,l),w(o,t,l)},p(o,l){l[0]&32&&re(n,o[5])},d(o){o&&($(e),$(n),$(t))}}}function fp(r){let e;return{c(){e=j("Redo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function ni(r){let e,n;return e=new Jm({}),e.$on("close",r[30]),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function up(r){let e,n,t,o,l=ft(r[6]).properties.name+"",i,s,a=ft(r[6]).properties.area_km2.toFixed(1)+"",f,u,c,_,d,m,g,y,h,v,S,C,I,E,P,O,B,U,R,z,H,G,Y,Z,ie,D,ye,ge,fe,we,ue,Fe,Ye,Te,ne,Je,Ne,ke,K,me,x,pe,ve,Se,W,dt,Oe,Ge,kt,bt=r[8]>0&&ei(),Qe=r[12]=="speeds"&&ti();function xt(Pe,rt){return Pe[4]==0?sp:ip}let en=xt(r),St=en(r);function rr(Pe,rt){return Pe[5]==0?fp:ap}let Ft=rr(r),Pt=Ft(r),nt=r[3]&&ni(r);return{c(){e=k("div"),n=k("p"),t=j("Editing neighbourhood "),o=k("u"),i=j(l),s=j(`
      , with an area of `),f=j(a),u=j(" km²"),c=M(),bt&&bt.c(),_=M(),d=k("div"),m=k("button"),g=k("img"),h=j(`
        Add a modal filter`),S=M(),C=k("button"),I=j("Add many modal filters along line"),P=M(),O=k("button"),B=j("Reverse directions"),R=M(),z=k("button"),z.textContent="Change modal filter type",H=M(),G=k("label"),Y=k("input"),Z=j(`
      Animate shortcuts`),ie=M(),D=k("label"),ye=k("input"),ge=j(`
      Include perimeter roads`),fe=M(),we=k("div"),ue=k("label"),Fe=j(`Draw roads:
        `),Ye=k("select"),Te=k("option"),Te.textContent="Worst shortcuts",ne=k("option"),ne.textContent="Cell",Je=k("option"),Je.textContent="Edits (either filter or direction)",Ne=k("option"),Ne.textContent="Speed limit",ke=M(),Qe&&Qe.c(),K=M(),me=k("div"),x=k("button"),St.c(),ve=M(),Se=k("button"),Pt.c(),dt=M(),nt&&nt.c(),Ke(g.src,y=`/ltn//filters/${r[9]}_icon.gif`)||N(g,"src",y),N(g,"width","30"),N(g,"alt","Add a modal filter"),m.disabled=v=r[0]=="filter",N(m,"data-tooltip","hotkey 1"),C.disabled=E=r[0]=="freehand-filters",N(C,"data-tooltip","hotkey 2"),O.disabled=U=r[0]=="oneway",N(O,"data-tooltip","hotkey 3"),le(d,"display","flex"),le(d,"justify-content","space-between"),N(Y,"type","checkbox"),N(ye,"type","checkbox"),Te.__value="shortcuts",qe(Te,Te.__value),ne.__value="cells",qe(ne,ne.__value),Je.__value="edits",qe(Je,Je.__value),Ne.__value="speeds",qe(Ne,Ne.__value),r[12]===void 0&&an(()=>r[29].call(Ye)),le(we,"border","1px solid black"),le(we,"padding","4px"),x.disabled=pe=r[4]==0,N(x,"data-tooltip","Ctrl+Z"),Se.disabled=W=r[5]==0,N(Se,"data-tooltip","Ctrl+Y"),le(me,"display","flex"),le(me,"justify-content","space-between"),N(e,"slot","sidebar")},m(Pe,rt){w(Pe,e,rt),p(e,n),p(n,t),p(n,o),p(o,i),p(n,s),p(n,f),p(n,u),p(e,c),bt&&bt.m(e,null),p(e,_),p(e,d),p(d,m),p(m,g),p(m,h),p(d,S),p(d,C),p(C,I),p(d,P),p(d,O),p(O,B),p(e,R),p(e,z),p(e,H),p(e,G),p(G,Y),Y.checked=r[11],p(G,Z),p(e,ie),p(e,D),p(D,ye),ye.checked=r[10],p(D,ge),p(e,fe),p(e,we),p(we,ue),p(ue,Fe),p(ue,Ye),p(Ye,Te),p(Ye,ne),p(Ye,Je),p(Ye,Ne),wt(Ye,r[12],!0),p(we,ke),Qe&&Qe.m(we,null),p(e,K),p(e,me),p(me,x),St.m(x,null),p(me,ve),p(me,Se),Pt.m(Se,null),p(e,dt),nt&&nt.m(e,null),Oe=!0,Ge||(kt=[V(m,"click",r[23]),V(C,"click",r[24]),V(O,"click",r[25]),V(z,"click",r[26]),V(Y,"change",r[27]),V(ye,"change",r[28]),V(ye,"change",r[14]),V(Ye,"change",r[29]),V(x,"click",r[19]),V(Se,"click",r[20])],Ge=!0)},p(Pe,rt){(!Oe||rt[0]&64)&&l!==(l=ft(Pe[6]).properties.name+"")&&re(i,l),(!Oe||rt[0]&64)&&a!==(a=ft(Pe[6]).properties.area_km2.toFixed(1)+"")&&re(f,a),Pe[8]>0?bt||(bt=ei(),bt.c(),bt.m(e,_)):bt&&(bt.d(1),bt=null),(!Oe||rt[0]&512&&!Ke(g.src,y=`/ltn//filters/${Pe[9]}_icon.gif`))&&N(g,"src",y),(!Oe||rt[0]&1&&v!==(v=Pe[0]=="filter"))&&(m.disabled=v),(!Oe||rt[0]&1&&E!==(E=Pe[0]=="freehand-filters"))&&(C.disabled=E),(!Oe||rt[0]&1&&U!==(U=Pe[0]=="oneway"))&&(O.disabled=U),rt[0]&2048&&(Y.checked=Pe[11]),rt[0]&1024&&(ye.checked=Pe[10]),rt[0]&4096&&wt(Ye,Pe[12]),Pe[12]=="speeds"?Qe?rt[0]&4096&&b(Qe,1):(Qe=ti(),Qe.c(),b(Qe,1),Qe.m(we,null)):Qe&&(he(),L(Qe,1,1,()=>{Qe=null}),be()),en===(en=xt(Pe))&&St?St.p(Pe,rt):(St.d(1),St=en(Pe),St&&(St.c(),St.m(x,null))),(!Oe||rt[0]&16&&pe!==(pe=Pe[4]==0))&&(x.disabled=pe),Ft===(Ft=rr(Pe))&&Pt?Pt.p(Pe,rt):(Pt.d(1),Pt=Ft(Pe),Pt&&(Pt.c(),Pt.m(Se,null))),(!Oe||rt[0]&32&&W!==(W=Pe[5]==0))&&(Se.disabled=W),Pe[3]?nt?(nt.p(Pe,rt),rt[0]&8&&b(nt,1)):(nt=ni(Pe),nt.c(),b(nt,1),nt.m(e,null)):nt&&(he(),L(nt,1,1,()=>{nt=null}),be())},i(Pe){Oe||(b(Qe),b(nt),Oe=!0)},o(Pe){L(Qe),L(nt),Oe=!1},d(Pe){Pe&&$(e),bt&&bt.d(),Qe&&Qe.d(),St.d(),Pt.d(),nt&&nt.d(),Ge=!1,lt(kt)}}}function cp(r){let e;return{c(){e=k("p"),e.textContent="Click to change direction"},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function dp(r){let e,n,t,o;return{c(){e=k("div"),n=k("img"),o=j(`
                Click to add modal filter`),Ke(n.src,t=`/ltn//filters/${r[9]}_icon.gif`)||N(n,"src",t),N(n,"width","20"),N(n,"alt","Add modal filter")},m(l,i){w(l,e,i),p(e,n),p(e,o)},p(l,i){i[0]&512&&!Ke(n.src,t=`/ltn//filters/${l[9]}_icon.gif`)&&N(n,"src",t)},d(l){l&&$(e)}}}function _p(r){let e,n=r[40].shortcuts+"",t,o,l=(r[40].name??"unnamed road")+"",i,s,a=Math.round(r[40].speed_mph)+"",f,u,c,_;function d(y,h){return y[0]=="filter"?dp:cp}let m=d(r),g=m(r);return{c(){e=k("p"),t=j(n),o=j(" shortcuts through "),i=j(l),s=j(`
              (`),f=j(a),u=j(" mph)"),c=M(),g.c(),_=Ze()},m(y,h){w(y,e,h),p(e,t),p(e,o),p(e,i),p(e,s),p(e,f),p(e,u),w(y,c,h),g.m(y,h),w(y,_,h)},p(y,h){h[1]&512&&n!==(n=y[40].shortcuts+"")&&re(t,n),h[1]&512&&l!==(l=(y[40].name??"unnamed road")+"")&&re(i,l),h[1]&512&&a!==(a=Math.round(y[40].speed_mph)+"")&&re(f,a),m===(m=d(y))&&g?g.p(y,h):(g.d(1),g=m(y),g&&(g.c(),g.m(_.parentNode,_)))},d(y){y&&($(e),$(c),$(_)),g.d(y)}}}function mp(r){let e,n,t;return n=new gt({props:{openOn:"hover",$$slots:{default:[_p,({props:o})=>({40:o}),({props:o})=>[0,o?512:0]]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),N(e,"slot","line-popup")},m(o,l){w(o,e,l),A(n,e,null),t=!0},p(o,l){const i={};l[0]&513|l[1]&1536&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function pp(r){let e,n,t,o,l,i,s,a,f,u;return e=new Pr({}),t=new Fr({}),l=new Ir({}),s=new er({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[mp]},$$scope:{ctx:r}}}),f=new Hm({props:{interactive:r[0]=="filter",neighbourhood:r[1],onClickIntersection:r[17]}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),T(s.$$.fragment),a=M(),T(f.$$.fragment)},m(c,_){A(e,c,_),w(c,n,_),A(t,c,_),w(c,o,_),A(l,c,_),w(c,i,_),A(s,c,_),w(c,a,_),A(f,c,_),u=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0]=="filter"||c[0]=="oneway"),_[0]&513|_[1]&1024&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const m={};_[0]&1&&(m.interactive=c[0]=="filter"),_[0]&2&&(m.neighbourhood=c[1]),f.$set(m)},i(c){u||(b(e.$$.fragment,c),b(t.$$.fragment,c),b(l.$$.fragment,c),b(s.$$.fragment,c),b(f.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(t.$$.fragment,c),L(l.$$.fragment,c),L(s.$$.fragment,c),L(f.$$.fragment,c),u=!1},d(c){c&&($(n),$(o),$(i),$(a)),F(e,c),F(t,c),F(l,c),F(s,c),F(f,c)}}}function ri(r){let e,n;return e=new Am({props:{paths:r[7]}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o[0]&128&&(l.paths=t[7]),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function gp(r){let e;return{c(){e=j("Click to delete")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function hp(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[gp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o[1]&1024&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function oi(r){let e,n;return e=new Xm({props:{map:ft(r[2])}}),e.$on("done",r[21]),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o[0]&4&&(l.map=ft(t[2])),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function bp(r){let e,n,t,o,l,i,s;n=new tr({props:{input:r[1],$$slots:{default:[pp]},$$scope:{ctx:r}}});let a=r[11]&&ri(r);l=new gn({props:{$$slots:{default:[hp]},$$scope:{ctx:r}}}),l.$on("click",r[16]);let f=r[0]=="freehand-filters"&&oi(r);return{c(){e=k("div"),T(n.$$.fragment),t=M(),a&&a.c(),o=M(),T(l.$$.fragment),i=M(),f&&f.c(),N(e,"slot","map")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),a&&a.m(e,null),p(e,o),A(l,e,null),p(e,i),f&&f.m(e,null),s=!0},p(u,c){const _={};c[0]&2&&(_.input=u[1]),c[0]&515|c[1]&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_),u[11]?a?(a.p(u,c),c[0]&2048&&b(a,1)):(a=ri(u),a.c(),b(a,1),a.m(e,o)):a&&(he(),L(a,1,1,()=>{a=null}),be());const d={};c[1]&1024&&(d.$$scope={dirty:c,ctx:u}),l.$set(d),u[0]=="freehand-filters"?f?(f.p(u,c),c[0]&1&&b(f,1)):(f=oi(u),f.c(),b(f,1),f.m(e,null)):f&&(he(),L(f,1,1,()=>{f=null}),be())},i(u){s||(b(n.$$.fragment,u),b(a),b(l.$$.fragment,u),b(f),s=!0)},o(u){L(n.$$.fragment,u),L(a),L(l.$$.fragment,u),L(f),s=!1},d(u){u&&$(e),F(n),a&&a.d(),F(l),f&&f.d()}}}function vp(r){let e,n,t,o;return e=new At({props:{$$slots:{map:[bp],sidebar:[up],top:[lp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0,t||(o=V(window,"keydown",r[18]),t=!0)},p(l,i){const s={};i[0]&16383|i[1]&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l),t=!1,o()}}}function yp(r,e,n){let t,o,l,i,s,a,f,u,c;X(r,Nt,ne=>n(22,o=ne)),X(r,Yr,ne=>n(9,l=ne)),X(r,xe,ne=>n(38,i=ne)),X(r,qn,ne=>n(10,s=ne)),X(r,Qt,ne=>n(2,a=ne)),X(r,Co,ne=>n(11,f=ne)),X(r,gr,ne=>n(12,u=ne)),X(r,ce,ne=>n(13,c=ne));let _="filter",d=!1,m=0,g=0,y,h,v=i.getAllShortcuts();Tt(()=>{a.doubleClickZoom.enable()});function S(ne){n(1,h=i.renderNeighbourhood()),n(6,y=h.features.find(Je=>Je.properties.kind=="boundary")),n(4,m=h.undo_length),n(5,g=h.redo_length),n(7,v=i.getAllShortcuts()),Mn()}function C(){i.setCurrentNeighbourhood(y.properties.name,s),te(Nt,o++,o)}function I(ne,Je){_=="filter"?(i.addModalFilter(Je,l),te(Nt,o++,o)):_=="oneway"&&(i.toggleTravelFlow(ne.properties.road),te(Nt,o++,o))}function E(ne){let Je=ne.detail.features[0];i.deleteModalFilter(Je.properties.road),te(Nt,o++,o)}function P(ne){if(_!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${_}`);return}ne.hasRotatedFilter?(i.deleteDiagonalFilter(ne),te(Nt,o++,o)):ne.filter?(i.rotateDiagonalFilter(ne),te(Nt,o++,o)):(i.addDiagonalFilter(ne),te(Nt,o++,o))}function O(ne){ne.target.tagName!="INPUT"&&(ne.ctrlKey&&ne.key=="z"&&B(),ne.ctrlKey&&ne.key=="y"&&U(),ne.key=="1"&&n(0,_="filter"),ne.key=="2"&&n(0,_="freehand-filters"),ne.key=="3"&&n(0,_="oneway"))}function B(){i.undo(),te(Nt,o++,o)}function U(){i.redo(),te(Nt,o++,o)}function R(ne){let Je=ne.detail;Je&&(i.addManyModalFilters(Je,l),te(Nt,o++,o)),n(0,_="filter")}const z=()=>n(0,_="filter"),H=()=>n(0,_="freehand-filters"),G=()=>n(0,_="oneway"),Y=()=>n(3,d=!0);function Z(){f=this.checked,Co.set(f)}function ie(){s=this.checked,qn.set(s)}function D(){u=fn(this),gr.set(u)}const ye=()=>n(3,d=!1),ge=()=>te(ce,c={mode:"title",firstLoad:!1},c),fe=()=>te(ce,c={mode:"pick-neighbourhood"},c),we=()=>te(ce,c={mode:"view-shortcuts"},c),ue=()=>te(ce,c={mode:"route",prevMode:"neighbourhood"},c),Fe=()=>te(ce,c={mode:"impact-one-destination"},c),Ye=()=>te(ce,c={mode:"set-boundary",name:ft(y).properties.name,existing:y},c),Te=()=>te(ce,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(_=="oneway"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&4194304&&S(),r.$$.dirty[0]&2&&n(8,t=h.features.filter(ne=>ne.properties.kind=="cell"&&ne.properties.cell_color=="disconnected").length)},[_,h,a,d,m,g,y,v,t,l,s,f,u,c,C,I,E,P,O,B,U,R,o,z,H,G,Y,Z,ie,D,ye,ge,fe,we,ue,Fe,Ye,Te]}class wp extends se{constructor(e){super(),ae(this,e,yp,vp,oe,{},null,[-1,-1])}}function $p(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function kp(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Sp(r){let e,n,t,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[$p]},$$scope:{ctx:r}}}),l.$on("click",r[7]),a=new Ce({props:{$$slots:{default:[kp]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){L(l.$$.fragment,_),L(a.$$.fragment,_),c=!1},d(_){_&&$(e),F(l),F(a)}}}function Lp(r){let e;return{c(){e=j("Pick a different road")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Cp(r){let e,n,t,o,l,i,s,a;n=new Ce({props:{$$slots:{default:[Lp]},$$scope:{ctx:r}}}),n.$on("click",r[5]);function f(c){r[6](c)}let u={list:r[2]};return r[0]!==void 0&&(u.idx=r[0]),o=new Ar({props:u}),He.push(()=>ut(o,"idx",f)),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),i=M(),s=k("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,N(e,"slot","sidebar")},m(c,_){w(c,e,_),A(n,e,null),p(e,t),A(o,e,null),p(e,i),p(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),n.$set(d);const m={};!l&&_&1&&(l=!0,m.idx=c[0],ct(()=>l=!1)),o.$set(m)},i(c){a||(b(n.$$.fragment,c),b(o.$$.fragment,c),a=!0)},o(c){L(n.$$.fragment,c),L(o.$$.fragment,c),a=!1},d(c){c&&$(e),F(n),F(o)}}}function Mp(r){let e,n;const t=[$e("predict-impact"),{paint:{"line-width":Ht(["get","kind"],{focus:8},5),"line-color":Ht(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Ht(["get","kind"],{focus:1},.5)}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Tp(r){let e;return{c(){e=j("A")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Ap(r){let e;return{c(){e=j("B")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Fp(r){let e,n,t,o,l,i,s,a,f;return n=new Ve({props:{data:r[3](r[0]),$$slots:{default:[Mp]},$$scope:{ctx:r}}}),o=new wn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[Tp]},$$scope:{ctx:r}}}),i=new wn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[Ap]},$$scope:{ctx:r}}}),a=new gn({}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),l=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),N(e,"slot","map")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),A(o,e,null),p(e,l),A(i,e,null),p(e,s),A(a,e,null),f=!0},p(u,c){const _={};c&1&&(_.data=u[3](u[0])),c&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&1&&(d.lngLat=u[2][u[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:u}),o.$set(d);const m={};c&1&&(m.lngLat=u[2][u[0]][0].geometry.coordinates[u[2][u[0]][0].geometry.coordinates.length-1]),c&1024&&(m.$$scope={dirty:c,ctx:u}),i.$set(m)},i(u){f||(b(n.$$.fragment,u),b(o.$$.fragment,u),b(i.$$.fragment,u),b(a.$$.fragment,u),f=!0)},o(u){L(n.$$.fragment,u),L(o.$$.fragment,u),L(i.$$.fragment,u),L(a.$$.fragment,u),f=!1},d(u){u&&$(e),F(n),F(o),F(i),F(a)}}}function Pp(r){let e,n;return e=new At({props:{$$slots:{map:[Fp],sidebar:[Cp],top:[Sp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ip(r,e,n){let t,o;X(r,xe,d=>n(9,t=d)),X(r,ce,d=>n(1,o=d));let{road:l}=e;l.properties.kind="focus";let i=t.getImpactsOnRoad(l.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],l]}}const f=()=>te(ce,o={mode:"predict-impact"},o);function u(d){s=d,n(0,s)}const c=()=>te(ce,o={mode:"title",firstLoad:!1},o),_=()=>te(ce,o={mode:"pick-neighbourhood"},o);return r.$$set=d=>{"road"in d&&n(4,l=d.road)},[s,o,i,a,l,f,u,c,_]}class Ep extends se{constructor(e){super(),ae(this,e,Ip,Pp,oe,{road:4})}}function Np(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function jp(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function zp(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Op(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;return l=new Ce({props:{$$slots:{default:[Np]},$$scope:{ctx:r}}}),l.$on("click",r[12]),a=new Ce({props:{$$slots:{default:[jp]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new Ce({props:{$$slots:{default:[zp]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),T(c.$$.fragment),_=M(),d=k("li"),d.textContent="Impact routing to one destination",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){w(g,e,y),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),A(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&262144&&(h.$$scope={dirty:y,ctx:g}),l.$set(h);const v={};y&262144&&(v.$$scope={dirty:y,ctx:g}),a.$set(v);const S={};y&262144&&(S.$$scope={dirty:y,ctx:g}),c.$set(S)},i(g){m||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){L(l.$$.fragment,g),L(a.$$.fragment,g),L(c.$$.fragment,g),m=!1},d(g){g&&$(e),F(l),F(a),F(c)}}}function Bp(r){let e,n,t,o,l,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",f,u;return n=new pn({}),n.$on("click",r[5]),{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("p"),o.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,l=M(),i=k("p"),s=j("Highest ratio is "),f=j(a),N(e,"slot","sidebar")},m(c,_){w(c,e,_),A(n,e,null),p(e,t),p(e,o),p(e,l),p(e,i),p(i,s),p(i,f),u=!0},p(c,_){(!u||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&re(f,a)},i(c){u||(b(n.$$.fragment,c),u=!0)},o(c){L(n.$$.fragment,c),u=!1},d(c){c&&$(e),F(n)}}}function Rp(r){let e,n;const t=[$e("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new $t({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Dp(r){let e,n=cn(r[17].distance_before)+"",t,o,l=dn(r[17].time_before)+"",i,s,a,f,u=cn(r[17].distance_after)+"",c,_,d=dn(r[17].time_after)+"",m,g,y,h,v,S=(r[17].time_after/r[17].time_before).toFixed(1)+"",C;return{c(){e=k("p"),t=j(n),o=j(", "),i=j(l),s=j(" before"),a=M(),f=k("p"),c=j(u),_=j(", "),m=j(d),g=j(" after"),y=M(),h=k("p"),v=j("Time ratio: "),C=j(S)},m(I,E){w(I,e,E),p(e,t),p(e,o),p(e,i),p(e,s),w(I,a,E),w(I,f,E),p(f,c),p(f,_),p(f,m),p(f,g),w(I,y,E),w(I,h,E),p(h,v),p(h,C)},p(I,E){E&131072&&n!==(n=cn(I[17].distance_before)+"")&&re(t,n),E&131072&&l!==(l=dn(I[17].time_before)+"")&&re(i,l),E&131072&&u!==(u=cn(I[17].distance_after)+"")&&re(c,u),E&131072&&d!==(d=dn(I[17].time_after)+"")&&re(m,d),E&131072&&S!==(S=(I[17].time_after/I[17].time_before).toFixed(1)+"")&&re(C,S)},d(I){I&&($(e),$(a),$(f),$(y),$(h))}}}function Up(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[Dp,({props:t})=>({17:t}),({props:t})=>t?131072:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&393216&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Hp(r){let e,n,t;const o=[$e("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function l(s){r[9](s)}let i={$$slots:{default:[Up]},$$scope:{ctx:r}};for(let s=0;s<o.length;s+=1)i=_e(i,o[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new tt({props:i}),He.push(()=>ut(e,"hovered",l)),e.$on("click",r[10]),{c(){T(e.$$.fragment)},m(s,a){A(e,s,a),t=!0},p(s,a){const f=a&8?ze(o,[o[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},o[2]]):{};a&262144&&(f.$$scope={dirty:a,ctx:s}),!n&&a&1&&(n=!0,f.hovered=s[0],ct(()=>n=!1)),e.$set(f)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Gp(r){let e,n;const t=[$e("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Ht(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Wp(r){let e;return{c(){e=j("X")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function qp(r){let e,n,t,o,l,i,s,a,f,u,c,_;n=new tr({props:{$$slots:{default:[Rp]},$$scope:{ctx:r}}}),o=new Ve({props:{data:r[3],generateId:!0,$$slots:{default:[Hp]},$$scope:{ctx:r}}}),i=new Ve({props:{data:r[2],$$slots:{default:[Gp]},$$scope:{ctx:r}}}),a=new gn({});function d(g){r[11](g)}let m={draggable:!0,$$slots:{default:[Wp]},$$scope:{ctx:r}};return r[1]!==void 0&&(m.lngLat=r[1]),u=new wn({props:m}),He.push(()=>ut(u,"lngLat",d)),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),l=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),f=M(),T(u.$$.fragment),N(e,"slot","map")},m(g,y){w(g,e,y),A(n,e,null),p(e,t),A(o,e,null),p(e,l),A(i,e,null),p(e,s),A(a,e,null),p(e,f),A(u,e,null),_=!0},p(g,y){const h={};y&262144&&(h.$$scope={dirty:y,ctx:g}),n.$set(h);const v={};y&8&&(v.data=g[3]),y&262153&&(v.$$scope={dirty:y,ctx:g}),o.$set(v);const S={};y&4&&(S.data=g[2]),y&262144&&(S.$$scope={dirty:y,ctx:g}),i.$set(S);const C={};y&262144&&(C.$$scope={dirty:y,ctx:g}),!c&&y&2&&(c=!0,C.lngLat=g[1],ct(()=>c=!1)),u.$set(C)},i(g){_||(b(n.$$.fragment,g),b(o.$$.fragment,g),b(i.$$.fragment,g),b(a.$$.fragment,g),b(u.$$.fragment,g),_=!0)},o(g){L(n.$$.fragment,g),L(o.$$.fragment,g),L(i.$$.fragment,g),L(a.$$.fragment,g),L(u.$$.fragment,g),_=!1},d(g){g&&$(e),F(n),F(o),F(i),F(a),F(u)}}}function Jp(r){let e,n,t,o;return e=new as({}),e.$on("contextmenu",r[7]),t=new At({props:{$$slots:{map:[qp],sidebar:[Bp],top:[Op]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(l,i){A(e,l,i),w(l,n,i),A(t,l,i),o=!0},p(l,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:l}),t.$set(s)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){L(e.$$.fragment,l),L(t.$$.fragment,l),o=!1},d(l){l&&$(n),F(e,l),F(t,l)}}}function Zp(r,e,n){let t,o,l,i,s,a,f;X(r,sr,C=>n(1,l=C)),X(r,ce,C=>n(4,i=C)),X(r,Jn,C=>n(14,s=C)),X(r,Zn,C=>n(15,a=C)),X(r,xe,C=>n(8,f=C));function u(){te(ce,i={mode:"neighbourhood"},i)}let c=null;function _(C){return C?f.compareRoute(new Kr.LngLat(C.properties.pt1_x,C.properties.pt1_y),l,1):rn()}function d(C){te(Zn,a=new Kr.LngLat(C.properties.pt1_x,C.properties.pt1_y),a),te(Jn,s=l,s),te(ce,i={mode:"route",prevMode:"impact-one-destination"},i)}function m(C){te(sr,l=C.detail.lngLat,l)}function g(C){c=C,n(0,c)}const y=C=>d(C.detail.features[0]);function h(C){l=C,sr.set(l)}const v=()=>te(ce,i={mode:"title",firstLoad:!1},i),S=()=>te(ce,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&n(3,t=f.impactToOneDestination(l)),r.$$.dirty&1&&n(2,o=_(c))},[c,l,o,t,i,u,d,m,f,g,y,h,v,S]}class Yp extends se{constructor(e){super(),ae(this,e,Zp,Jp,oe,{})}}function li(r,e,n){const t=r.slice();return t[32]=e[n].properties.name,t[33]=e[n].properties.area_km2,t[34]=e[n].properties.simd,t}function Kp(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Xp(r){let e;return{c(){e=k("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function Vp(r){let e;return{c(){e=j("Route")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Qp(r){let e;return{c(){e=j("Predict impact")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function xp(r){let e;return{c(){e=j("Debug intersections")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function eg(r){let e;return{c(){e=j("Debug demand")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function tg(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g,y,h,v,S,C,I,E,P,O;return l=new Ce({props:{$$slots:{default:[Kp]},$$scope:{ctx:r}}}),l.$on("click",r[25]),f=new Dt({props:{$$slots:{default:[Xp]},$$scope:{ctx:r}}}),m=new Ce({props:{$$slots:{default:[Vp]},$$scope:{ctx:r}}}),m.$on("click",r[26]),h=new Ce({props:{$$slots:{default:[Qp]},$$scope:{ctx:r}}}),h.$on("click",r[27]),C=new Ce({props:{$$slots:{default:[xp]},$$scope:{ctx:r}}}),C.$on("click",r[28]),P=new Ce({props:{$$slots:{default:[eg]},$$scope:{ctx:r}}}),P.$on("click",r[29]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),a=j(`Pick neighbourhood
          `),T(f.$$.fragment),u=M(),c=k("nav"),_=k("ul"),d=k("li"),T(m.$$.fragment),g=M(),y=k("li"),T(h.$$.fragment),v=M(),S=k("li"),T(C.$$.fragment),I=M(),E=k("li"),T(P.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),le(e,"display","flex"),le(e,"justify-content","space-between")},m(B,U){w(B,e,U),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),p(s,a),A(f,s,null),p(e,u),p(e,c),p(c,_),p(_,d),A(m,d,null),p(_,g),p(_,y),A(h,y,null),p(_,v),p(_,S),A(C,S,null),p(_,I),p(_,E),A(P,E,null),O=!0},p(B,U){const R={};U[1]&64&&(R.$$scope={dirty:U,ctx:B}),l.$set(R);const z={};U[1]&64&&(z.$$scope={dirty:U,ctx:B}),f.$set(z);const H={};U[1]&64&&(H.$$scope={dirty:U,ctx:B}),m.$set(H);const G={};U[1]&64&&(G.$$scope={dirty:U,ctx:B}),h.$set(G);const Y={};U[1]&64&&(Y.$$scope={dirty:U,ctx:B}),C.$set(Y);const Z={};U[1]&64&&(Z.$$scope={dirty:U,ctx:B}),P.$set(Z)},i(B){O||(b(l.$$.fragment,B),b(f.$$.fragment,B),b(m.$$.fragment,B),b(h.$$.fragment,B),b(C.$$.fragment,B),b(P.$$.fragment,B),O=!0)},o(B){L(l.$$.fragment,B),L(f.$$.fragment,B),L(m.$$.fragment,B),L(h.$$.fragment,B),L(C.$$.fragment,B),L(P.$$.fragment,B),O=!1},d(B){B&&$(e),F(l),F(f),F(m),F(h),F(C),F(P)}}}function ng(r){let e=r[32]+"",n;return{c(){n=j(e)},m(t,o){w(t,n,o)},p(t,o){o[0]&1&&e!==(e=t[32]+"")&&re(n,e)},d(t){t&&$(n)}}}function rg(r){let e,n,t,o=r[34].toFixed(1)+"",l;return{c(){e=k("span"),n=k("b"),n.textContent="SIMD (percentile):",t=M(),l=j(o)},m(i,s){w(i,e,s),p(e,n),p(e,t),p(e,l)},p(i,s){s[0]&1&&o!==(o=i[34].toFixed(1)+"")&&re(l,o)},d(i){i&&$(e)}}}function og(r){let e,n,t,o=r[33].toFixed(1)+"",l,i;return{c(){e=k("span"),n=k("b"),n.textContent="Area:",t=M(),l=j(o),i=j(" km²")},m(s,a){w(s,e,a),p(e,n),p(e,t),p(e,l),p(e,i)},p(s,a){a[0]&1&&o!==(o=s[33].toFixed(1)+"")&&re(l,o)},d(s){s&&$(e)}}}function ii(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g;function y(){return r[18](r[32])}o=new Ce({props:{$$slots:{default:[ng]},$$scope:{ctx:r}}}),o.$on("click",y),a=new yo({props:{color:"black"}});function h(){return r[19](r[32])}c=new fs({props:{color:"white"}});function v(){return r[20](r[32])}function S(P,O){if(P[1]=="area")return og;if(P[1]=="simd")return rg}let C=S(r),I=C&&C(r);function E(){return r[21](r[32])}return{c(){var P;e=k("li"),n=k("span"),t=k("span"),T(o.$$.fragment),l=M(),i=k("span"),s=k("button"),T(a.$$.fragment),f=M(),u=k("button"),T(c.$$.fragment),_=M(),I&&I.c(),N(t,"class","neighbourhood-name svelte-v2avug"),N(s,"class","outline icon-btn"),N(s,"aria-label","Rename neighbourhood"),N(u,"class","icon-btn destructive"),N(u,"aria-label","Delete neighbourhood"),le(i,"display","flex"),le(i,"gap","16px"),le(n,"display","flex"),le(n,"justify-content","space-between"),N(e,"class","svelte-v2avug"),pt(e,"highlighted",((P=r[3])==null?void 0:P.properties.name)==r[32])},m(P,O){w(P,e,O),p(e,n),p(n,t),A(o,t,null),p(n,l),p(n,i),p(i,s),A(a,s,null),p(i,f),p(i,u),A(c,u,null),p(e,_),I&&I.m(e,null),d=!0,m||(g=[V(s,"click",h),V(u,"click",v),V(e,"mouseenter",E),V(e,"mouseleave",r[22])],m=!0)},p(P,O){var U;r=P;const B={};O[0]&1|O[1]&64&&(B.$$scope={dirty:O,ctx:r}),o.$set(B),C===(C=S(r))&&I?I.p(r,O):(I&&I.d(1),I=C&&C(r),I&&(I.c(),I.m(e,null))),(!d||O[0]&9)&&pt(e,"highlighted",((U=r[3])==null?void 0:U.properties.name)==r[32])},i(P){d||(b(o.$$.fragment,P),b(a.$$.fragment,P),b(c.$$.fragment,P),d=!0)},o(P){L(o.$$.fragment,P),L(a.$$.fragment,P),L(c.$$.fragment,P),d=!1},d(P){P&&$(e),F(o),F(a),F(c),I&&I.d(),m=!1,lt(g)}}}function lg(r){let e,n,t;return e=new yo({}),{c(){T(e.$$.fragment),n=j(`
              Draw a new boundary`)},m(o,l){A(e,o,l),w(o,n,l),t=!0},i(o){t||(b(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){o&&$(n),F(e,o)}}}function ig(r){let e,n,t;return e=new ku({}),{c(){T(e.$$.fragment),n=j(`
              Use a generated boundary`)},m(o,l){A(e,o,l),w(o,n,l),t=!0},i(o){t||(b(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){o&&$(n),F(e,o)}}}function si(r){let e,n,t,o,l,i,s,a,f;function u(_){r[24](_)}let c={};return r[1]!==void 0&&(c.selectedPrioritization=r[1]),l=new hs({props:c}),He.push(()=>ut(l,"selectedPrioritization",u)),{c(){e=k("h3"),e.textContent="Prioritization",n=M(),t=k("p"),t.textContent="Compare metrics across your neighbourhoods.",o=M(),T(l.$$.fragment),s=M(),a=k("hr")},m(_,d){w(_,e,d),w(_,n,d),w(_,t,d),w(_,o,d),A(l,_,d),w(_,s,d),w(_,a,d),f=!0},p(_,d){const m={};!i&&d[0]&2&&(i=!0,m.selectedPrioritization=_[1],ct(()=>i=!1)),l.$set(m)},i(_){f||(b(l.$$.fragment,_),f=!0)},o(_){L(l.$$.fragment,_),f=!1},d(_){_&&($(e),$(n),$(t),$(o),$(s),$(a)),F(l,_)}}}function sg(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g=r[5].startsWith("ltn_cnt/"),y,h,v,S,C,I,E=r[4].modalFilters+"",P,O,B,U,R=r[4].deletedModalFilters+"",z,H,G,Y,Z=r[4].travelFlows+"",ie,D,ye,ge,fe,we,ue,Fe,Ye,Te=Me(r[0].features),ne=[];for(let ke=0;ke<Te.length;ke+=1)ne[ke]=ii(li(r,Te,ke));const Je=ke=>L(ne[ke],1,1,()=>{ne[ke]=null});u=new Ce({props:{$$slots:{default:[lg]},$$scope:{ctx:r}}}),u.$on("click",r[10]),d=new Ce({props:{$$slots:{default:[ig]},$$scope:{ctx:r}}}),d.$on("click",r[23]);let Ne=g&&si(r);return{c(){e=k("div"),n=k("h3"),n.textContent="Neighbourhoods",t=M(),o=k("ul");for(let ke=0;ke<ne.length;ke+=1)ne[ke].c();l=M(),i=k("li"),s=j(`Add a new neighbourhood:
        `),a=k("ul"),f=k("li"),T(u.$$.fragment),c=M(),_=k("li"),T(d.$$.fragment),m=M(),Ne&&Ne.c(),y=M(),h=k("p"),v=j("Current project: "),S=j(r[5]),C=M(),I=k("p"),P=j(E),O=j(" new modal filter(s) added"),B=M(),U=k("p"),z=j(R),H=j(`
      existing modal filter(s) removed`),G=M(),Y=k("p"),ie=j(Z),D=j(" road segment direction(s) changed"),ye=M(),ge=k("button"),ge.textContent="Export project to GeoJSON",fe=M(),we=k("button"),we.textContent="Debug route-snapper",le(n,"padding","4px 8px"),le(n,"margin-bottom","0"),le(f,"list-style","none"),le(_,"list-style","none"),le(a,"margin-bottom","0"),le(a,"padding","0"),N(i,"class","svelte-v2avug"),N(o,"class","neighbourhood-list svelte-v2avug"),N(we,"class","secondary"),N(e,"slot","sidebar")},m(ke,K){w(ke,e,K),p(e,n),p(e,t),p(e,o);for(let me=0;me<ne.length;me+=1)ne[me]&&ne[me].m(o,null);p(o,l),p(o,i),p(i,s),p(i,a),p(a,f),A(u,f,null),p(a,c),p(a,_),A(d,_,null),p(e,m),Ne&&Ne.m(e,null),p(e,y),p(e,h),p(h,v),p(h,S),p(e,C),p(e,I),p(I,P),p(I,O),p(e,B),p(e,U),p(U,z),p(U,H),p(e,G),p(e,Y),p(Y,ie),p(Y,D),p(e,ye),p(e,ge),p(e,fe),p(e,we),ue=!0,Fe||(Ye=[V(ge,"click",r[11]),V(we,"click",r[12])],Fe=!0)},p(ke,K){if(K[0]&911){Te=Me(ke[0].features);let pe;for(pe=0;pe<Te.length;pe+=1){const ve=li(ke,Te,pe);ne[pe]?(ne[pe].p(ve,K),b(ne[pe],1)):(ne[pe]=ii(ve),ne[pe].c(),b(ne[pe],1),ne[pe].m(o,l))}for(he(),pe=Te.length;pe<ne.length;pe+=1)Je(pe);be()}const me={};K[1]&64&&(me.$$scope={dirty:K,ctx:ke}),u.$set(me);const x={};K[1]&64&&(x.$$scope={dirty:K,ctx:ke}),d.$set(x),K[0]&32&&(g=ke[5].startsWith("ltn_cnt/")),g?Ne?(Ne.p(ke,K),K[0]&32&&b(Ne,1)):(Ne=si(ke),Ne.c(),b(Ne,1),Ne.m(e,y)):Ne&&(he(),L(Ne,1,1,()=>{Ne=null}),be()),(!ue||K[0]&32)&&re(S,ke[5]),(!ue||K[0]&16)&&E!==(E=ke[4].modalFilters+"")&&re(P,E),(!ue||K[0]&16)&&R!==(R=ke[4].deletedModalFilters+"")&&re(z,R),(!ue||K[0]&16)&&Z!==(Z=ke[4].travelFlows+"")&&re(ie,Z)},i(ke){if(!ue){for(let K=0;K<Te.length;K+=1)b(ne[K]);b(u.$$.fragment,ke),b(d.$$.fragment,ke),b(Ne),ue=!0}},o(ke){ne=ne.filter(Boolean);for(let K=0;K<ne.length;K+=1)L(ne[K]);L(u.$$.fragment,ke),L(d.$$.fragment,ke),L(Ne),ue=!1},d(ke){ke&&$(e),st(ne,ke),F(u),F(d),Ne&&Ne.d(),Fe=!1,lt(Ye)}}}function ag(r){let e,n,t=r[31].simd.toFixed(1)+"",o;return{c(){e=k("b"),e.textContent="Fake SIMD:",n=M(),o=j(t)},m(l,i){w(l,e,i),w(l,n,i),w(l,o,i)},p(l,i){i[1]&1&&t!==(t=l[31].simd.toFixed(1)+"")&&re(o,t)},d(l){l&&($(e),$(n),$(o))}}}function fg(r){let e,n,t=r[31].area_km2.toFixed(1)+"",o,l;return{c(){e=k("b"),e.textContent="Area:",n=M(),o=j(t),l=j(" km²")},m(i,s){w(i,e,s),w(i,n,s),w(i,o,s),w(i,l,s)},p(i,s){s[1]&1&&t!==(t=i[31].area_km2.toFixed(1)+"")&&re(o,t)},d(i){i&&($(e),$(n),$(o),$(l))}}}function ug(r){let e,n=r[31].name+"",t,o,l;function i(f,u){if(f[1]=="none"||f[1]=="area")return fg;if(f[1]=="simd")return ag}let s=i(r),a=s&&s(r);return{c(){e=k("h2"),t=j(n),o=M(),a&&a.c(),l=Ze()},m(f,u){w(f,e,u),p(e,t),w(f,o,u),a&&a.m(f,u),w(f,l,u)},p(f,u){u[1]&1&&n!==(n=f[31].name+"")&&re(t,n),s===(s=i(f))&&a?a.p(f,u):(a&&a.d(1),a=s&&s(f),a&&(a.c(),a.m(l.parentNode,l)))},d(f){f&&($(e),$(o),$(l)),a&&a.d(f)}}}function cg(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[ug,({props:t})=>({31:t}),({props:t})=>[0,t?1:0]]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o[0]&2|o[1]&65&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function dg(r){let e,n,t,o,l;e=new jf({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const i=[$e("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function s(f){r[16](f)}let a={$$slots:{default:[cg]},$$scope:{ctx:r}};for(let f=0;f<i.length;f+=1)a=_e(a,i[f]);return r[3]!==void 0&&(a.hovered=r[3]),t=new $t({props:a}),He.push(()=>ut(t,"hovered",s)),t.$on("click",r[17]),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),l=!0},p(f,u){const c={};u[0]&4&&(c.data=f[2]?[{name:f[2],highlight:"yes"}]:[]),e.$set(c);const _=u[0]&24578?ze(i,[i[0],i[1],{paint:{"fill-color":f[13](f[1]),"fill-opacity":f[14](f[1])}},i[3],i[4]]):{};u[0]&2|u[1]&64&&(_.$$scope={dirty:u,ctx:f}),!o&&u[0]&8&&(o=!0,_.hovered=f[3],ct(()=>o=!1)),t.$set(_)},i(f){l||(b(e.$$.fragment,f),b(t.$$.fragment,f),l=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),l=!1},d(f){f&&$(n),F(e,f),F(t,f)}}}function _g(r){let e,n,t,o,l;return n=new Ve({props:{data:r[0],promoteId:"name",$$slots:{default:[dg]},$$scope:{ctx:r}}}),o=new gn({}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),N(e,"slot","map")},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(o,e,null),l=!0},p(i,s){const a={};s[0]&1&&(a.data=i[0]),s[0]&14|s[1]&64&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&$(e),F(n),F(o)}}}function mg(r){let e,n;return e=new At({props:{$$slots:{map:[_g],sidebar:[sg],top:[tg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o[0]&127|o[1]&64&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function pg(r){let e=0,n=0,t=0;for(let o of r.features)o.properties.kind=="modal_filter"?e++:o.properties.kind=="deleted_existing_modal_filter"?n++:o.properties.kind=="travel_flow"&&t++;return{modalFilters:e,deletedModalFilters:n,travelFlows:t}}function gg(r,e,n){let t,o,l,i,s,a;X(r,xe,D=>n(15,l=D)),X(r,Zt,D=>n(5,i=D)),X(r,ce,D=>n(6,s=D)),X(r,qn,D=>n(30,a=D));let f="none",u=null,c=null;function _(D){l.setCurrentNeighbourhood(D,a),te(ce,s={mode:"neighbourhood"},s)}function d(D){window.confirm(`Really delete neighbourhood ${D}? You can't undo this.`)&&(l.deleteNeighbourhoodBoundary(D),Mn(),n(0,t=l.getAllNeighbourhoods()))}function m(D){let ye=oo(l,`Rename neighbourhood ${D} to what?`,D);ye&&(l.renameNeighbourhoodBoundary(D,ye),Mn(),n(0,t=l.getAllNeighbourhoods()))}function g(){let D=oo(l,"What do you want to name the neighbourhood?","");D&&te(ce,s={mode:"set-boundary",name:D,existing:null},s)}function y(){hr(i+".geojson",JSON.stringify(l.toSavefile()))}function h(){hr("debug_route_snapper.geojson",l.toRouteSnapperGj())}function v(D){let ye={none:"black",simd:Jt(["get","simd"],xn,on),area:Jt(["get","area_km2"],wo,on)}[D];return["case",["==",["feature-state","highlight"],"yes"],"yellow",ye]}function S(D){return{none:at(.3,.5),simd:at(.7,.9),area:at(.7,.9)}[D]}function C(D){c=D,n(3,c)}const I=D=>_(ft(D.detail.features[0].properties).name),E=D=>_(D),P=D=>m(D),O=D=>d(D),B=D=>n(2,u=D),U=()=>n(2,u=null),R=()=>te(ce,s={mode:"auto-boundaries"},s);function z(D){f=D,n(1,f)}const H=()=>te(ce,s={mode:"title",firstLoad:!1},s),G=()=>te(ce,s={mode:"route",prevMode:"pick-neighbourhood"},s),Y=()=>te(ce,s={mode:"predict-impact"},s),Z=()=>te(ce,s={mode:"debug-intersections"},s),ie=()=>te(ce,s={mode:"debug-demand"},s);return r.$$.update=()=>{r.$$.dirty[0]&32768&&n(0,t=l.getAllNeighbourhoods()),r.$$.dirty[0]&1&&n(4,o=pg(t))},[t,f,u,c,o,i,s,_,d,m,g,y,h,v,S,l,C,I,E,P,O,B,U,R,z,H,G,Y,Z,ie]}class hg extends se{constructor(e){super(),ae(this,e,gg,mg,oe,{},null,[-1,-1])}}function bg(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function vg(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function yg(r){let e,n,t,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[bg]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[vg]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){L(l.$$.fragment,_),L(a.$$.fragment,_),c=!1},d(_){_&&$(e),F(l),F(a)}}}function wg(r){let e,n,t,o,l,i,s,a,f;return n=new pn({}),n.$on("click",r[5]),{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("p"),o.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,l=M(),i=k("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=M(),a=k("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,N(e,"slot","sidebar")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),f=!0},p:Q,i(u){f||(b(n.$$.fragment,u),f=!0)},o(u){L(n.$$.fragment,u),f=!1},d(u){u&&$(e),F(n)}}}function $g(r){let e,n=r[9].before.toLocaleString()+"",t,o,l=r[9].after.toLocaleString()+"",i,s,a,f,u=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=k("p"),t=j(n),o=j(" before, "),i=j(l),s=j(`
            after`),a=M(),f=k("p"),c=j(u),_=j("%")},m(d,m){w(d,e,m),p(e,t),p(e,o),p(e,i),p(e,s),w(d,a,m),w(d,f,m),p(f,c),p(f,_)},p(d,m){m&512&&n!==(n=d[9].before.toLocaleString()+"")&&re(t,n),m&512&&l!==(l=d[9].after.toLocaleString()+"")&&re(i,l),m&512&&u!==(u=Math.round(100*d[9].after/d[9].before)+"")&&re(c,u)},d(d){d&&($(e),$(a),$(f))}}}function kg(r){let e,n;return e=new gt({props:{openOn:"hover",$$slots:{default:[$g,({props:t})=>({9:t}),({props:t})=>t?512:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&1536&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Sg(r){let e,n;const t=[$e("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,ai,r[2].max_count,fi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[kg]},$$scope:{ctx:r}};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s=i&6?ze(t,[t[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,ai,l[2].max_count,fi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,l[1][0],50,l[1][1],100,l[1][2],150,l[1][3],200,l[1][4]]]}},t[2],t[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Lg(r){let e,n,t,o,l;return n=new Ve({props:{data:r[2],generateId:!0,$$slots:{default:[Sg]},$$scope:{ctx:r}}}),o=new gn({}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),N(e,"slot","map")},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(o,e,null),l=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&$(e),F(n),F(o)}}}function Cg(r){let e,n;return e=new At({props:{$$slots:{map:[Lg],sidebar:[wg],top:[yg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1025&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}let ai=3,fi=10;function Mg(r,e,n){let t,o;X(r,ce,_=>n(0,t=_)),X(r,xe,_=>n(8,o=_));let l=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=o.predictImpact();function s(_){te(ce,t={mode:"impact-detail",road:_},t)}return[t,l,i,s,_=>s(_.detail.features[0]),()=>te(ce,t={mode:"pick-neighbourhood"},t),()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class Tg extends se{constructor(e){super(),ae(this,e,Mg,Cg,oe,{})}}function Ag(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Fg(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function ui(r){let e,n,t;return n=new Ce({props:{$$slots:{default:[Pg]},$$scope:{ctx:r}}}),n.$on("click",r[13]),{c(){e=k("li"),T(n.$$.fragment)},m(o,l){w(o,e,l),A(n,e,null),t=!0},p(o,l){const i={};l&16384&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function Pg(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Ig(r){let e,n,t,o,l,i,s,a,f,u,c,_;l=new Ce({props:{$$slots:{default:[Ag]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Ce({props:{$$slots:{default:[Fg]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&ui(r);return{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),d&&d.c(),u=M(),c=k("li"),c.textContent="Routing",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(m,g){w(m,e,g),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),d&&d.m(t,null),p(t,u),p(t,c),_=!0},p(m,g){const y={};g&16384&&(y.$$scope={dirty:g,ctx:m}),l.$set(y);const h={};g&16384&&(h.$$scope={dirty:g,ctx:m}),a.$set(h),m[0]=="neighbourhood"?d?(d.p(m,g),g&1&&b(d,1)):(d=ui(m),d.c(),b(d,1),d.m(t,u)):d&&(he(),L(d,1,1,()=>{d=null}),be())},i(m){_||(b(l.$$.fragment,m),b(a.$$.fragment,m),b(d),_=!0)},o(m){L(l.$$.fragment,m),L(a.$$.fragment,m),L(d),_=!1},d(m){m&&$(e),F(l),F(a),d&&d.d()}}}function ci(r){let e,n,t,o=cn(r[4].features[0].properties.distance)+"",l,i,s=dn(r[4].features[0].properties.time)+"",a,f,u,c,_,d=cn(r[4].features[1].properties.distance)+"",m,g,y=dn(r[4].features[1].properties.time)+"",h;return{c(){e=k("p"),n=k("span"),n.textContent="Route before",t=j(`
        : `),l=j(o),i=j(", "),a=j(s),f=M(),u=k("p"),c=k("span"),c.textContent="Route after",_=j(`
        : `),m=j(d),g=j(", "),h=j(y),le(n,"color","red"),le(c,"color","blue")},m(v,S){w(v,e,S),p(e,n),p(e,t),p(e,l),p(e,i),p(e,a),w(v,f,S),w(v,u,S),p(u,c),p(u,_),p(u,m),p(u,g),p(u,h)},p(v,S){S&16&&o!==(o=cn(v[4].features[0].properties.distance)+"")&&re(l,o),S&16&&s!==(s=dn(v[4].features[0].properties.time)+"")&&re(a,s),S&16&&d!==(d=cn(v[4].features[1].properties.distance)+"")&&re(m,d),S&16&&y!==(y=dn(v[4].features[1].properties.time)+"")&&re(h,y)},d(v){v&&($(e),$(f),$(u))}}}function Eg(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g,y;n=new pn({}),n.$on("click",r[6]);let h=r[4].features.length==2&&ci(r);return{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("p"),o.textContent="Drag markers for a route",l=M(),h&&h.c(),i=M(),s=k("label"),a=j("Slow-down factor for main roads: "),f=j(r[1]),u=M(),c=k("input"),_=M(),d=k("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,N(c,"type","range"),N(c,"min","1.0"),N(c,"max","5.0"),N(c,"step","0.1"),N(e,"slot","sidebar")},m(v,S){w(v,e,S),A(n,e,null),p(e,t),p(e,o),p(e,l),h&&h.m(e,null),p(e,i),p(e,s),p(s,a),p(s,f),p(s,u),p(s,c),qe(c,r[1]),p(e,_),p(e,d),m=!0,g||(y=[V(c,"change",r[10]),V(c,"input",r[10])],g=!0)},p(v,S){v[4].features.length==2?h?h.p(v,S):(h=ci(v),h.c(),h.m(e,i)):h&&(h.d(1),h=null),(!m||S&2)&&re(f,v[1]),S&2&&qe(c,v[1])},i(v){m||(b(n.$$.fragment,v),m=!0)},o(v){L(n.$$.fragment,v),m=!1},d(v){v&&$(e),F(n),h&&h.d(),g=!1,lt(y)}}}function di(r){let e,n;return e=new tr({props:{$$slots:{default:[Ng]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ng(r){let e,n,t,o,l,i,s,a;return e=new Pr({}),t=new Fr({}),l=new Ir({}),s=new er({props:{interactive:!1}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),T(s.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),w(f,o,u),A(l,f,u),w(f,i,u),A(s,f,u),a=!0},p:Q,i(f){a||(b(e.$$.fragment,f),b(t.$$.fragment,f),b(l.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),L(l.$$.fragment,f),L(s.$$.fragment,f),a=!1},d(f){f&&($(n),$(o),$(i)),F(e,f),F(t,f),F(l,f),F(s,f)}}}function jg(r){let e,n;const t=[$e("compare-route"),{paint:{"line-width":10,"line-color":Ht(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function zg(r){let e;return{c(){e=j("A")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Og(r){let e;return{c(){e=j("B")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Bg(r){let e,n,t,o,l,i,s,a,f,u,c,_,d=r[0]=="neighbourhood"&&di(r);t=new gn({}),l=new Ve({props:{data:r[4],$$slots:{default:[jg]},$$scope:{ctx:r}}});function m(v){r[8](v)}let g={draggable:!0,$$slots:{default:[zg]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new wn({props:g}),He.push(()=>ut(s,"lngLat",m));function y(v){r[9](v)}let h={draggable:!0,$$slots:{default:[Og]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.lngLat=r[2]),u=new wn({props:h}),He.push(()=>ut(u,"lngLat",y)),{c(){e=k("div"),d&&d.c(),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),T(s.$$.fragment),f=M(),T(u.$$.fragment),N(e,"slot","map")},m(v,S){w(v,e,S),d&&d.m(e,null),p(e,n),A(t,e,null),p(e,o),A(l,e,null),p(e,i),A(s,e,null),p(e,f),A(u,e,null),_=!0},p(v,S){v[0]=="neighbourhood"?d?S&1&&b(d,1):(d=di(v),d.c(),b(d,1),d.m(e,n)):d&&(he(),L(d,1,1,()=>{d=null}),be());const C={};S&16&&(C.data=v[4]),S&16384&&(C.$$scope={dirty:S,ctx:v}),l.$set(C);const I={};S&16384&&(I.$$scope={dirty:S,ctx:v}),!a&&S&8&&(a=!0,I.lngLat=v[3],ct(()=>a=!1)),s.$set(I);const E={};S&16384&&(E.$$scope={dirty:S,ctx:v}),!c&&S&4&&(c=!0,E.lngLat=v[2],ct(()=>c=!1)),u.$set(E)},i(v){_||(b(d),b(t.$$.fragment,v),b(l.$$.fragment,v),b(s.$$.fragment,v),b(u.$$.fragment,v),_=!0)},o(v){L(d),L(t.$$.fragment,v),L(l.$$.fragment,v),L(s.$$.fragment,v),L(u.$$.fragment,v),_=!1},d(v){v&&$(e),d&&d.d(),F(t),F(l),F(s),F(u)}}}function Rg(r){let e,n;return e=new At({props:{$$slots:{map:[Bg],sidebar:[Eg],top:[Ig]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&16447&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Dg(r,e,n){let t,o,l,i,s,a;X(r,ce,h=>n(5,o=h)),X(r,Mo,h=>n(1,l=h)),X(r,Jn,h=>n(2,i=h)),X(r,Zn,h=>n(3,s=h)),X(r,xe,h=>n(7,a=h));let{prevMode:f}=e;function u(){te(ce,o={mode:f},o)}function c(h){s=h,Zn.set(s)}function _(h){i=h,Jn.set(i)}function d(){l=uo(this.value),Mo.set(l)}const m=()=>te(ce,o={mode:"title",firstLoad:!1},o),g=()=>te(ce,o={mode:"pick-neighbourhood"},o),y=()=>te(ce,o={mode:"neighbourhood"},o);return r.$$set=h=>{"prevMode"in h&&n(0,f=h.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&n(4,t=a.compareRoute(s,i,l))},[f,l,i,s,t,o,u,a,c,_,d,m,g,y]}class Ug extends se{constructor(e){super(),ae(this,e,Dg,Rg,oe,{prevMode:0})}}let An=Mt(null);const jt=Mt([]);function ys(r){if(r.length<3)return JSON.parse(Gt(An).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let n=JSON.parse(Gt(An).inner.calculateRoute(e));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}const{window:Hg}=Hi,Gg=r=>({}),_i=r=>({}),Wg=r=>({}),mi=r=>({});function pi(r,e,n){const t=r.slice();return t[44]=e[n],t[45]=e,t[46]=n,t}function gi(r,e,n){const t=r.slice();return t[47]=e[n],t[48]=e,t[49]=n,t}function qg(r){let e,n;const t=r[24]["extra-top"],o=Be(t,r,r[38],_i);return{c(){e=k("div"),o&&o.c(),N(e,"slot","top")},m(l,i){w(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i[1]&128)&&Re(o,t,l,l[38],n?Ue(t,l[38],i,Gg):De(l[38]),_i)},i(l){n||(b(o,l),n=!0)},o(l){L(o,l),n=!1},d(l){l&&$(e),o&&o.d(l)}}}function Jg(r){let e,n,t,o,l;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,n=M(),t=k("p"),t.textContent="Keyboard shortcuts:",o=M(),l=k("ul"),l.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,o,s),w(i,l,s)},p:Q,d(i){i&&($(e),$(n),$(t),$(o),$(l))}}}function Zg(r){let e,n=r[8].length+"",t,o;return{c(){e=j("Undo ("),t=j(n),o=j(")")},m(l,i){w(l,e,i),w(l,t,i),w(l,o,i)},p(l,i){i[0]&256&&n!==(n=l[8].length+"")&&re(t,n)},d(l){l&&($(e),$(t),$(o))}}}function Yg(r){let e;return{c(){e=j("Undo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function Kg(r){let e;return{c(){e=k("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function Xg(r){let e,n,t,o,l,i,s,a,f,u,c,_,d;return c=Gi(r[36][0]),{c(){e=k("fieldset"),n=k("label"),t=k("input"),o=j(`
          Snap to roads`),l=M(),i=k("label"),s=k("input"),a=j(`
          Draw anywhere`),f=M(),u=k("p"),u.textContent="Click to add at least 3 points",N(t,"type","radio"),t.__value="snap",qe(t,t.__value),N(s,"type","radio"),s.__value="free",qe(s,s.__value),c.p(t,s)},m(m,g){w(m,e,g),p(e,n),p(n,t),t.checked=t.__value===r[7],p(n,o),p(e,l),p(e,i),p(i,s),s.checked=s.__value===r[7],p(i,a),w(m,f,g),w(m,u,g),_||(d=[V(t,"change",r[35]),V(s,"change",r[37])],_=!0)},p(m,g){g[0]&128&&(t.checked=t.__value===m[7]),g[0]&128&&(s.checked=s.__value===m[7])},d(m){m&&($(e),$(f),$(u)),c.r(),_=!1,lt(d)}}}function Vg(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m,g,y,h;const v=r[24]["extra-sidebar"],S=Be(v,r,r[38],mi);u=new Dt({props:{$$slots:{default:[Jg]},$$scope:{ctx:r}}});function C(U,R){return U[8].length==0?Yg:Zg}let I=C(r),E=I(r);function P(U,R){return U[5].length<3?Xg:Kg}let O=P(r),B=O(r);return{c(){e=k("div"),S&&S.c(),n=M(),t=k("div"),o=k("button"),l=j("Finish"),s=M(),a=k("button"),a.textContent="Cancel",f=M(),T(u.$$.fragment),c=M(),_=k("button"),E.c(),m=M(),B.c(),o.disabled=i=r[5].length<3,N(a,"class","secondary"),le(t,"display","flex"),N(_,"class","secondary"),_.disabled=d=r[8].length==0,N(e,"slot","sidebar")},m(U,R){w(U,e,R),S&&S.m(e,null),p(e,n),p(e,t),p(t,o),p(o,l),p(t,s),p(t,a),p(t,f),A(u,t,null),p(e,c),p(e,_),E.m(_,null),p(e,m),B.m(e,null),g=!0,y||(h=[V(o,"click",function(){qr(r[0])&&r[0].apply(this,arguments)}),V(a,"click",function(){qr(r[1])&&r[1].apply(this,arguments)}),V(_,"click",r[11])],y=!0)},p(U,R){r=U,S&&S.p&&(!g||R[1]&128)&&Re(S,v,r,r[38],g?Ue(v,r[38],R,Wg):De(r[38]),mi),(!g||R[0]&32&&i!==(i=r[5].length<3))&&(o.disabled=i);const z={};R[1]&128&&(z.$$scope={dirty:R,ctx:r}),u.$set(z),I===(I=C(r))&&E?E.p(r,R):(E.d(1),E=I(r),E&&(E.c(),E.m(_,null))),(!g||R[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),O===(O=P(r))&&B?B.p(r,R):(B.d(1),B=O(r),B&&(B.c(),B.m(e,null)))},i(U){g||(b(S,U),b(u.$$.fragment,U),g=!0)},o(U){L(S,U),L(u.$$.fragment,U),g=!1},d(U){U&&$(e),S&&S.d(U),F(u),E.d(),B.d(),y=!1,lt(h)}}}function Qg(r){let e;return{c(){e=k("span"),N(e,"class","dot svelte-1cj4rwq"),pt(e,"snapped-node",r[47].snapped),pt(e,"free-node",!r[47].snapped),pt(e,"hide",r[4])},m(n,t){w(n,e,t)},p(n,t){t[0]&512&&pt(e,"snapped-node",n[47].snapped),t[0]&512&&pt(e,"free-node",!n[47].snapped),t[0]&16&&pt(e,"hide",n[4])},d(n){n&&$(e)}}}function hi(r){let e,n,t;function o(f){r[25](f,r[47])}function l(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[Qg]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new Cr({props:a}),He.push(()=>ut(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){T(e.$$.fragment)},m(f,u){A(e,f,u),t=!0},p(f,u){r=f;const c={};u[0]&528|u[1]&128&&(c.$$scope={dirty:u,ctx:r}),!n&&u[0]&512&&(n=!0,c.lngLat=r[47].point,ct(()=>n=!1)),e.$set(c)},i(f){t||(b(e.$$.fragment,f),t=!0)},o(f){L(e.$$.fragment,f),t=!1},d(f){F(e,f)}}}function xg(r){let e;return{c(){e=k("span"),e.textContent=`${r[46]+1}`,N(e,"class","dot svelte-1cj4rwq"),pt(e,"snapped",r[44].snapped)},m(n,t){w(n,e,t)},p(n,t){t[0]&32&&pt(e,"snapped",n[44].snapped)},d(n){n&&$(e)}}}function bi(r){let e,n,t;function o(a){r[29](a,r[44])}function l(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[xg]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new Cr({props:s}),He.push(()=>ut(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){T(e.$$.fragment)},m(a,f){A(e,a,f),t=!0},p(a,f){r=a;const u={};f[0]&32|f[1]&128&&(u.$$scope={dirty:f,ctx:r}),!n&&f[0]&32&&(n=!0,u.lngLat=r[44].point,ct(()=>n=!1)),e.$set(u)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){L(e.$$.fragment,a),t=!1},d(a){F(e,a)}}}function e1(r){let e,n,t,o;const l=[$e("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let f=0;f<l.length;f+=1)i=_e(i,l[f]);e=new tt({props:i});const s=[$e("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new $t({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),o=!0},p(f,u){const c={};e.$set(c);const _={};t.$set(_)},i(f){o||(b(e.$$.fragment,f),b(t.$$.fragment,f),o=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),o=!1},d(f){f&&$(n),F(e,f),F(t,f)}}}function t1(r){let e,n;return e=new tt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function n1(r){let e,n,t,o,l,i,s,a,f;n=new as({}),n.$on("click",r[12]),n.$on("mousemove",r[13]);let u=Me(r[9]),c=[];for(let y=0;y<u.length;y+=1)c[y]=hi(gi(r,u,y));const _=y=>L(c[y],1,1,()=>{c[y]=null});let d=Me(r[5]),m=[];for(let y=0;y<d.length;y+=1)m[y]=bi(pi(r,d,y));const g=y=>L(m[y],1,1,()=>{m[y]=null});return i=new Ve({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[e1]},$$scope:{ctx:r}}}),a=new Ve({props:{data:r[10],$$slots:{default:[t1]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),t=M();for(let y=0;y<c.length;y+=1)c[y].c();o=M();for(let y=0;y<m.length;y+=1)m[y].c();l=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),N(e,"slot","map")},m(y,h){w(y,e,h),A(n,e,null),p(e,t);for(let v=0;v<c.length;v+=1)c[v]&&c[v].m(e,null);p(e,o);for(let v=0;v<m.length;v+=1)m[v]&&m[v].m(e,null);p(e,l),A(i,e,null),p(e,s),A(a,e,null),f=!0},p(y,h){if(h[0]&918032){u=Me(y[9]);let C;for(C=0;C<u.length;C+=1){const I=gi(y,u,C);c[C]?(c[C].p(I,h),b(c[C],1)):(c[C]=hi(I),c[C].c(),b(c[C],1),c[C].m(e,o))}for(he(),C=u.length;C<c.length;C+=1)_(C);be()}if(h[0]&2146348){d=Me(y[5]);let C;for(C=0;C<d.length;C+=1){const I=pi(y,d,C);m[C]?(m[C].p(I,h),b(m[C],1)):(m[C]=bi(I),m[C].c(),b(m[C],1),m[C].m(e,l))}for(he(),C=d.length;C<m.length;C+=1)g(C);be()}const v={};h[0]&96&&(v.data=y[16](y[6],y[5])),h[1]&128&&(v.$$scope={dirty:h,ctx:y}),i.$set(v);const S={};h[0]&1024&&(S.data=y[10]),h[1]&128&&(S.$$scope={dirty:h,ctx:y}),a.$set(S)},i(y){if(!f){b(n.$$.fragment,y);for(let h=0;h<u.length;h+=1)b(c[h]);for(let h=0;h<d.length;h+=1)b(m[h]);b(i.$$.fragment,y),b(a.$$.fragment,y),f=!0}},o(y){L(n.$$.fragment,y),c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)L(c[h]);m=m.filter(Boolean);for(let h=0;h<m.length;h+=1)L(m[h]);L(i.$$.fragment,y),L(a.$$.fragment,y),f=!1},d(y){y&&$(e),F(n),st(c,y),st(m,y),F(i),F(a)}}}function r1(r){let e,n,t,o;return e=new At({props:{$$slots:{map:[n1],sidebar:[Vg],top:[qg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0,t||(o=V(Hg,"keydown",r[20]),t=!0)},p(l,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l),t=!1,o()}}}function o1(r,e,n){let t,o,l;X(r,jt,K=>n(5,o=K)),X(r,An,K=>n(6,l=K));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:f}=e,{cancel:u}=e;Tt(()=>{te(jt,o=[],o),l==null||l.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],m=null,g=!1,y=!1,h=!1;function v(K){let me=K.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=me}function S(){let K=_.pop();n(8,_),K&&te(jt,o=K,o)}function C(){_.length==100&&_.shift(),n(8,_=[..._,JSON.parse(JSON.stringify(o))])}function I(){n(7,c=c=="snap"?"free":"snap"),m&&n(23,m.snapped=c=="snap",m)}function E(K){o.length>=3||(C(),jt.update(me=>(me.push({point:K.detail.lngLat.toArray(),snapped:c=="snap"}),me)))}function P(K){n(23,m={point:K.detail.lngLat.toArray(),snapped:c=="snap"})}function O(K){C(),jt.update(me=>(me[K].snapped=!me[K].snapped,me))}function B(K){C(),jt.update(me=>(me.splice(K,1),me)),n(2,g=!1)}function U(K,me){try{if(K)return ys(me)}catch{}return rn()}function R(K,me,x,pe){if(pe||me.length>=3)return rn();try{if(K&&me.length>0&&x)return JSON.parse(K.inner.calculateRoute([me[me.length-1],x]))}catch{}return rn()}function z(K,me,x){if(x)return;if(!K||me.length<3){n(9,d=[]);return}let pe=[],ve=1,Se=JSON.parse(JSON.stringify(me));Se.push(Se[0]);for(let W=0;W<Se.length-1;W++){let dt=JSON.parse(K.inner.getExtraNodes(Se[W],Se[W+1]));for(let[Oe,Ge,kt]of dt)pe.push({point:[Oe,Ge],snapped:kt,insertIdx:ve});ve++}n(9,d=pe)}function H(K){C(),jt.update(me=>(me.splice(K.insertIdx,0,{point:K.point,snapped:K.snapped}),me)),n(4,h=!0)}function G(K){jt.update(me=>(me[K.insertIdx].point=K.point,me))}function Y(){n(4,h=!1)}function Z(K){let me=K.target.tagName,x=me=="INPUT"||me=="TEXTAREA";K.key=="Enter"&&!x||K.key=="Escape"?(K.stopPropagation(),o.length>=3?f():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):K.key=="s"&&!x?I():K.key=="z"&&K.ctrlKey&&(K.stopPropagation(),S())}function ie(){C(),n(3,y=!0)}const D=[[]];function ye(K,me){r.$$.not_equal(me.point,K)&&(me.point=K,n(9,d))}const ge=K=>H(K),fe=K=>G(K),we=K=>{H(K),n(4,h=!1)};function ue(K,me){r.$$.not_equal(me.point,K)&&(me.point=K,jt.set(o))}const Fe=K=>O(K),Ye=K=>B(K),Te=()=>n(2,g=!0),ne=()=>n(2,g=!1),Je=()=>n(3,y=!1);function Ne(){c=this.__value,n(7,c)}function ke(){c=this.__value,n(7,c)}return r.$$set=K=>{"map"in K&&n(22,a=K.map),"finish"in K&&n(0,f=K.finish),"cancel"in K&&n(1,u=K.cancel),"$$scope"in K&&n(38,s=K.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&z(l,o,h),r.$$.dirty[0]&8388716&&n(10,t=R(l,o,m,g||y)),r.$$.dirty[0]&32&&v(o)},[f,u,g,y,h,o,l,c,_,d,t,S,E,P,O,B,U,H,G,Y,Z,ie,a,m,i,ye,ge,fe,we,ue,Fe,Ye,Te,ne,Je,Ne,D,ke,s]}class l1 extends se{constructor(e){super(),ae(this,e,o1,r1,oe,{map:22,finish:0,cancel:1},null,[-1,-1])}}function i1(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function s1(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function a1(r){let e;return{c(){e=k("li"),e.textContent="Creating new neighbourhood boundary"},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function f1(r){let e,n,t,o,l;return n=new Ce({props:{$$slots:{default:[u1]},$$scope:{ctx:r}}}),n.$on("click",r[8]),{c(){e=k("li"),T(n.$$.fragment),t=M(),o=k("li"),o.textContent="Changing neighbourhood boundary"},m(i,s){w(i,e,s),A(n,e,null),w(i,t,s),w(i,o,s),l=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){l||(b(n.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),l=!1},d(i){i&&($(e),$(t),$(o)),F(n)}}}function u1(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function c1(r){let e,n,t,o,l,i,s,a,f,u,c,_;l=new Ce({props:{$$slots:{default:[i1]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[s1]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[f1,a1],m=[];function g(y,h){return y[1]?0:1}return u=g(r),c=m[u]=d[u](r),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),c.c(),N(n,"aria-label","breadcrumb"),N(e,"slot","extra-top")},m(y,h){w(y,e,h),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),m[u].m(t,null),_=!0},p(y,h){const v={};h&4096&&(v.$$scope={dirty:h,ctx:y}),l.$set(v);const S={};h&4096&&(S.$$scope={dirty:h,ctx:y}),a.$set(S);let C=u;u=g(y),u===C?m[u].p(y,h):(he(),L(m[C],1,1,()=>{m[C]=null}),be(),c=m[u],c?c.p(y,h):(c=m[u]=d[u](y),c.c()),b(c,1),c.m(t,null))},i(y){_||(b(l.$$.fragment,y),b(a.$$.fragment,y),b(c),_=!0)},o(y){L(l.$$.fragment,y),L(a.$$.fragment,y),L(c),_=!1},d(y){y&&$(e),F(l),F(a),m[u].d()}}}function d1(r){let e,n,t,o;return{c(){e=k("div"),n=k("h1"),t=j("Draw your neighbourhood boundary for "),o=j(r[0]),N(e,"slot","extra-sidebar")},m(l,i){w(l,e,i),p(e,n),p(n,t),p(n,o)},p(l,i){i&1&&re(o,l[0])},d(l){l&&$(e)}}}function _1(r){let e,n;return e=new l1({props:{map:ft(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[d1],"extra-top":[c1]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&8&&(l.map=ft(t[3])),o&4103&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function m1(r,e,n){let t,o,l,i,s;X(r,ce,g=>n(2,t=g)),X(r,qn,g=>n(9,o=g)),X(r,xe,g=>n(10,l=g)),X(r,jt,g=>n(11,i=g)),X(r,Qt,g=>n(3,s=g));let{name:a}=e,{existing:f}=e;f&&(f.properties.waypoints?te(jt,i=f.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):te(jt,i=f.geometry.coordinates[1].slice(1).map(g=>({point:g,snapped:!1})),i));function u(){if(i.length>=3)try{let g=ys(i);l.setNeighbourhoodBoundary(a,g),Mn(),l.setCurrentNeighbourhood(a,o),te(ce,t={mode:"neighbourhood"},t)}catch(g){console.log("error when setting hand drawn neighborhood",g),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working."),c()}}function c(){f?te(ce,t={mode:"neighbourhood"},t):te(ce,t={mode:"pick-neighbourhood"},t)}const _=()=>te(ce,t={mode:"title",firstLoad:!1},t),d=()=>te(ce,t={mode:"pick-neighbourhood"},t),m=()=>te(ce,t={mode:"neighbourhood"},t);return r.$$set=g=>{"name"in g&&n(0,a=g.name),"existing"in g&&n(1,f=g.existing)},[a,f,t,s,u,c,_,d,m]}class p1 extends se{constructor(e){super(),ae(this,e,m1,_1,oe,{name:0,existing:1})}}const g1="/ltn/assets/settings-342fb430.svg";function vi(r){let e,n;return e=new Sr({props:{$$slots:{default:[h1]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&67&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function h1(r){let e,n,t,o,l,i,s,a,f,u,c,_,d;return t=new xf({}),{c(){e=k("h1"),e.textContent="Settings",n=M(),T(t.$$.fragment),o=M(),l=k("label"),i=k("input"),s=j(`
      Road thickness depends on shortcuts`),a=M(),f=k("center"),u=k("button"),u.textContent="Confirm",N(i,"type","checkbox")},m(m,g){w(m,e,g),w(m,n,g),A(t,m,g),w(m,o,g),w(m,l,g),p(l,i),i.checked=r[1],p(l,s),w(m,a,g),w(m,f,g),p(f,u),c=!0,_||(d=[V(i,"change",r[3]),V(u,"click",r[4])],_=!0)},p(m,g){g&2&&(i.checked=m[1])},i(m){c||(b(t.$$.fragment,m),c=!0)},o(m){L(t.$$.fragment,m),c=!1},d(m){m&&($(e),$(n),$(o),$(l),$(a),$(f)),F(t,m),_=!1,lt(d)}}}function b1(r){let e,n,t,o,l,i,s=r[0]&&vi(r);return{c(){e=k("button"),e.innerHTML=`<img src="${g1}" alt="Settings"/>`,n=M(),s&&s.c(),t=Ze(),N(e,"class","outline")},m(a,f){w(a,e,f),w(a,n,f),s&&s.m(a,f),w(a,t,f),o=!0,l||(i=V(e,"click",r[2]),l=!0)},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&b(s,1)):(s=vi(a),s.c(),b(s,1),s.m(t.parentNode,t)):s&&(he(),L(s,1,1,()=>{s=null}),be())},i(a){o||(b(s),o=!0)},o(a){L(s),o=!1},d(a){a&&($(e),$(n),$(t)),s&&s.d(a),l=!1,i()}}}function v1(r,e,n){let t;X(r,Zr,f=>n(1,t=f));let o=!1;const l=()=>n(0,o=!0);function i(){t=this.checked,Zr.set(t)}return[o,t,l,i,()=>n(0,o=!1),()=>n(0,o=!1)]}class y1 extends se{constructor(e){super(),ae(this,e,v1,b1,oe,{})}}const w1=["==",["geometry-type"],"Polygon"],$1=["==",["geometry-type"],"LineString"],k1=["==",["geometry-type"],"Point"];function ws(){return{type:"FeatureCollection",features:[]}}function Gr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:$s(r)}}}function $s(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const ks=Mt(ws()),Ss=Mt(0),S1=100;class L1{constructor(e){mt(this,"map");mt(this,"active");mt(this,"eventListenersSuccess");mt(this,"eventListenersUpdated");mt(this,"eventListenersFailure");mt(this,"points");mt(this,"cursor");mt(this,"hover");mt(this,"dragFrom");mt(this,"previousStates");mt(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,t=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=n,o[1]-=t}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});mt(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(yi(this.points).forEach((t,o)=>{n.push([o+1,wf(t,this.cursor).properties.dist])}),n.sort((t,o)=>t[1]-o[1]),n.length>0){let t=n[0][0];this.points.splice(t,0,this.cursor.geometry.coordinates),this.hover=t}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});mt(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Gr(e.lngLat.toArray()),this.onClick(e),this.finish())});mt(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});mt(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});mt(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});mt(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=ws();this.points.forEach((o,l)=>{let i=Gr(o);i.properties.hover=this.hover==l,i.properties.idx=l,e.features.push(i)}),e.features=e.features.concat(yi(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),ks.set(e);let t="crosshair";this.hover!=null&&(t=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=t,Ss.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Gr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map($s),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>S1&&this.previousStates.shift()}}function yi(r){let e=[];for(let n=0;n<r.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[n],r[n+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function C1(r){let e,n,t;return{c(){e=j("Undo ("),n=j(r[1]),t=j(")")},m(o,l){w(o,e,l),w(o,n,l),w(o,t,l)},p(o,l){l&2&&re(n,o[1])},d(o){o&&($(e),$(n),$(t))}}}function M1(r){let e;return{c(){e=j("Undo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function T1(r){let e,n,t,o,l,i,s,a,f,u,c;function _(g,y){return g[1]==0?M1:C1}let d=_(r),m=d(r);return{c(){e=k("div"),n=k("button"),n.textContent="Finish",t=M(),o=k("button"),o.textContent="Cancel",l=M(),i=k("button"),m.c(),a=M(),f=k("ul"),f.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,le(e,"display","flex"),le(e,"justify-content","space-between")},m(g,y){w(g,e,y),p(e,n),p(e,t),p(e,o),p(e,l),p(e,i),m.m(i,null),w(g,a,y),w(g,f,y),u||(c=[V(n,"click",r[2]),V(o,"click",r[3]),V(i,"click",r[4])],u=!0)},p(g,[y]){d===(d=_(g))&&m?m.p(g,y):(m.d(1),m=d(g),m&&(m.c(),m.m(i,null))),y&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Q,o:Q,d(g){g&&($(e),$(a),$(f)),m.d(),u=!1,lt(c)}}}function A1(r,e,n){let t;X(r,Ss,a=>n(1,t=a));let{polygonTool:o}=e;const l=()=>o.finish(),i=()=>o.cancel(),s=()=>o.undo();return r.$$set=a=>{"polygonTool"in a&&n(0,o=a.polygonTool)},[o,t,l,i,s]}class F1 extends se{constructor(e){super(),ae(this,e,A1,T1,oe,{polygonTool:0})}}let P1=Date.now();function nr(r){return`${r}-${P1++}`}const Ls=Symbol.for("svelte-maplibre");function I1(){return co(Ls)}function wi(r){return{subscribe:r.subscribe}}function Cs({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:t=!1}){let o=I1(),l=Mt(null),i=wi(l),s={...o,[r]:wi(l)};if(e&&(s.popupTarget=i),t){let a=Mt(null);s.layerEvent=a,o.layerEvent=a}return n&&(s.cluster=Mt()),Wi(Ls,s),{...o,self:l}}function E1(){return Cs({key:"source",setCluster:!0})}function N1(r=!0){return Cs({key:"layer",setPopupTarget:r,setMouseEvent:r})}function $i(r){let e;return n=>{if(n)for(let t in n){let o=e==null?void 0:e[t],l=n[t];o!==l&&r(t,l,o)}else if(e)for(let t in e)r(t,void 0,e[t]);e=n}}function j1(r,...e){let n=[r];for(let t of e)if(t)Array.isArray(t)&&t[0]===r?n.push(...t.slice(1)):n.push(t);else continue;if(n.length!==1)return n.length===2?n[1]:n}function z1(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function ki(r){let e=r[0],n,t,o=Si(r);return{c(){o.c(),n=Ze()},m(l,i){o.m(l,i),w(l,n,i),t=!0},p(l,i){i[0]&1&&oe(e,e=l[0])?(he(),L(o,1,1,Q),be(),o=Si(l),o.c(),b(o,1),o.m(n.parentNode,n)):o.p(l,i)},i(l){t||(b(o),t=!0)},o(l){L(o),t=!1},d(l){l&&$(n),o.d(l)}}}function Si(r){let e;const n=r[36].default,t=Be(n,r,r[35],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l[1]&16)&&Re(t,n,o,o[35],e?Ue(n,o[35],l,null):De(o[35]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function O1(r){let e,n,t=r[0]&&ki(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,l){o[0]?t?(t.p(o,l),l[0]&1&&b(t,1)):(t=ki(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function B1(r,e,n){let t,o,l,i,s,a,f,u,c,_,d,m,{$$slots:g={},$$scope:y}=e,{id:h=nr("layer")}=e,{source:v=void 0}=e,{sourceLayer:S=void 0}=e,{beforeId:C=void 0}=e,{beforeLayerType:I=void 0}=e,{type:E}=e,{paint:P=void 0}=e,{layout:O=void 0}=e,{filter:B=void 0}=e,{applyToClusters:U=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:z=void 0}=e,{manageHoverState:H=!1}=e,{hovered:G=null}=e,{interactive:Y=!0}=e,{hoverCursor:Z=void 0}=e,{eventsIfTopMost:ie=!1}=e;const D=_n(),{map:ye,source:ge,self:fe,minzoom:we,maxzoom:ue,eventTopMost:Fe,layerInfo:Ye}=N1();X(r,ye,x=>n(31,c=x)),X(r,ge,x=>n(32,_=x)),X(r,fe,x=>n(0,u=x)),X(r,we,x=>n(34,m=x)),X(r,ue,x=>n(33,d=x)),Tt(()=>{u&&c&&(Ye.delete(u),c==null||c.removeLayer(u))});let Te;function ne(x){var W,dt;if(!Y||!u||!c||ie&&Fe(x)!==u)return;let pe=x.features??[],ve=(dt=(W=pe[0])==null?void 0:W.properties)==null?void 0:dt.cluster_id,Se={event:x,map:c,clusterId:ve,layer:u,source:s,features:pe};D(x.type,Se)}function Je(x){var W,dt;if(!Y||!u||!c||ie&&Fe(x)!==u)return;Z&&(c.getCanvas().style.cursor=Z);let pe=x.features??[];n(6,G=pe[0]??null);let ve=(dt=(W=pe[0])==null?void 0:W.properties)==null?void 0:dt.cluster_id;D("mouseenter",{event:x,map:c,clusterId:ve,layer:u,source:s,features:pe})}function Ne(x){var W,dt,Oe;if(!Y||!c)return;if(ie&&Fe(x)!==u){n(6,G=null),H&&Te!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:S,id:Te},{hover:!1}),Te=void 0);return}c.getCanvas().style.cursor=Z;let pe=x.features??[],ve=(dt=(W=pe[0])==null?void 0:W.properties)==null?void 0:dt.cluster_id,Se=(Oe=pe[0])==null?void 0:Oe.id;Se!==Te&&(H&&(Te!==void 0&&(c==null||c.setFeatureState({source:s,id:Te,sourceLayer:S},{hover:!1})),c==null||c.setFeatureState({source:s,id:Se,sourceLayer:S},{hover:!0})),Te=Se,n(6,G=pe[0]??null)),D("mousemove",{event:x,map:c,clusterId:ve,layer:u,source:s,features:pe})}function ke(x){if(!(!Y||!u||!c)){if(Z&&(c.getCanvas().style.cursor=""),n(6,G=null),H&&Te!==void 0){const pe={source:s,id:Te,sourceLayer:S};c==null||c.setFeatureState(pe,{hover:!1}),Te=void 0}D("mouseleave",{map:c,layer:u,source:s})}}let K=!0;function me(x){c&&(c.off("click",x,ne),c.off("dblclick",x,ne),c.off("contextmenu",x,ne),c.off("mouseenter",x,Je),c.off("mousemove",x,Ne),c.off("mouseleave",x,ke))}return Tt(()=>{c&&u&&me(u)}),r.$$set=x=>{"id"in x&&n(7,h=x.id),"source"in x&&n(8,v=x.source),"sourceLayer"in x&&n(9,S=x.sourceLayer),"beforeId"in x&&n(10,C=x.beforeId),"beforeLayerType"in x&&n(11,I=x.beforeLayerType),"type"in x&&n(12,E=x.type),"paint"in x&&n(13,P=x.paint),"layout"in x&&n(14,O=x.layout),"filter"in x&&n(15,B=x.filter),"applyToClusters"in x&&n(16,U=x.applyToClusters),"minzoom"in x&&n(17,R=x.minzoom),"maxzoom"in x&&n(18,z=x.maxzoom),"manageHoverState"in x&&n(19,H=x.manageHoverState),"hovered"in x&&n(6,G=x.hovered),"interactive"in x&&n(20,Y=x.interactive),"hoverCursor"in x&&n(21,Z=x.hoverCursor),"eventsIfTopMost"in x&&n(22,ie=x.eventsIfTopMost),"$$scope"in x&&n(35,y=x.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,t=z1(U)),r.$$.dirty[0]&1073774592&&n(24,o=j1("all",t,B)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,l=R??m),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,i=z??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,s=v||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&u!==h&&s){u&&(me(u),Ye.delete(u));let x=C;if(!C&&I){let pe=c.getStyle().layers,ve=typeof I=="function"?I:W=>W.type===I,Se=pe==null?void 0:pe.find(ve);Se&&(x=Se.id)}te(fe,u=h,u),c.addLayer(mr({id:u,type:E,source:s,"source-layer":S,filter:o,paint:P,layout:O,minzoom:l,maxzoom:i}),x),n(23,K=!0),c.on("click",u,ne),c.on("dblclick",u,ne),c.on("contextmenu",u,ne),c.on("mouseenter",u,Je),c.on("mousemove",u,Ne),c.on("mouseleave",u,ke)}r.$$.dirty[0]&1048577&&u&&Ye.set(u,{interactive:Y}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,a=u?$i((x,pe)=>c==null?void 0:c.setPaintProperty(u,x,pe)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,f=u?$i((x,pe)=>c==null?void 0:c.setLayoutProperty(u,x,pe)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(P)),r.$$.dirty[0]&134234112&&(f==null||f(O)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&u&&(c==null||c.setLayerZoomRange(u,l,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&u&&(K?n(23,K=!1):c==null||c.setFilter(u,o))},[u,ye,ge,fe,we,ue,G,h,v,S,C,I,E,P,O,B,U,R,z,H,Y,Z,ie,K,o,i,l,f,a,s,t,c,_,d,m,y,g]}class $o extends se{constructor(e){super(),ae(this,e,B1,O1,oe,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function R1(r){let e;const n=r[16].default,t=Be(n,r,r[24],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16777216)&&Re(t,n,o,o[24],e?Ue(n,o[24],l,null):De(o[24]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function D1(r){let e,n,t;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[R1]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new $o({props:l}),He.push(()=>ut(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function U1(r,e,n){let{$$slots:t={},$$scope:o}=e,{id:l=nr("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:S=!1}=e,{interactive:C=!0}=e;function I(z){v=z,n(0,v)}function E(z){je.call(this,r,z)}function P(z){je.call(this,r,z)}function O(z){je.call(this,r,z)}function B(z){je.call(this,r,z)}function U(z){je.call(this,r,z)}function R(z){je.call(this,r,z)}return r.$$set=z=>{"id"in z&&n(1,l=z.id),"source"in z&&n(2,i=z.source),"sourceLayer"in z&&n(3,s=z.sourceLayer),"beforeId"in z&&n(4,a=z.beforeId),"beforeLayerType"in z&&n(5,f=z.beforeLayerType),"paint"in z&&n(6,u=z.paint),"layout"in z&&n(7,c=z.layout),"filter"in z&&n(8,_=z.filter),"applyToClusters"in z&&n(9,d=z.applyToClusters),"minzoom"in z&&n(10,m=z.minzoom),"maxzoom"in z&&n(11,g=z.maxzoom),"hoverCursor"in z&&n(12,y=z.hoverCursor),"manageHoverState"in z&&n(13,h=z.manageHoverState),"hovered"in z&&n(0,v=z.hovered),"eventsIfTopMost"in z&&n(14,S=z.eventsIfTopMost),"interactive"in z&&n(15,C=z.interactive),"$$scope"in z&&n(24,o=z.$$scope)},[v,l,i,s,a,f,u,c,_,d,m,g,y,h,S,C,t,I,E,P,O,B,U,R,o]}class H1 extends se{constructor(e){super(),ae(this,e,U1,D1,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function G1(r){let e;const n=r[15].default,t=Be(n,r,r[23],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&8388608)&&Re(t,n,o,o[23],e?Ue(n,o[23],l,null):De(o[23]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function W1(r){let e,n,t;function o(i){r[16](i)}let l={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[G1]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new $o({props:l}),He.push(()=>ut(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function q1(r,e,n){let{$$slots:t={},$$scope:o}=e,{id:l=nr("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:y=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:S=!0}=e;function C(R){h=R,n(0,h)}function I(R){je.call(this,r,R)}function E(R){je.call(this,r,R)}function P(R){je.call(this,r,R)}function O(R){je.call(this,r,R)}function B(R){je.call(this,r,R)}function U(R){je.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,l=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,y=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,v=R.eventsIfTopMost),"interactive"in R&&n(14,S=R.interactive),"$$scope"in R&&n(23,o=R.$$scope)},[h,l,i,s,a,f,u,c,_,d,m,g,y,v,S,t,C,I,E,P,O,B,U,o]}class J1 extends se{constructor(e){super(),ae(this,e,q1,W1,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Z1(r,e,n,t,o){let l=!1;r.getSource(e)&&(l=!0,r.removeSource(e));const i=()=>{t(e)&&(r.addSource(e,n),o())};if(l){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function Y1(r,e,n){sa().then(()=>{let t=Gt(r);if(!t)return;t.getSource(e)===n&&t.removeSource(e)})}function Li(r){let e=r[0],n,t,o=Ci(r);return{c(){o.c(),n=Ze()},m(l,i){o.m(l,i),w(l,n,i),t=!0},p(l,i){i&1&&oe(e,e=l[0])?(he(),L(o,1,1,Q),be(),o=Ci(l),o.c(),b(o,1),o.m(n.parentNode,n)):o.p(l,i)},i(l){t||(b(o),t=!0)},o(l){L(o),t=!1},d(l){l&&$(n),o.d(l)}}}function Ci(r){let e;const n=r[15].default,t=Be(n,r,r[14],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&16384)&&Re(t,n,o,o[14],e?Ue(n,o[14],l,null):De(o[14]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function K1(r){let e,n,t=r[0]&&Li(r);return{c(){t&&t.c(),e=Ze()},m(o,l){t&&t.m(o,l),w(o,e,l),n=!0},p(o,[l]){o[0]?t?(t.p(o,l),l&1&&b(t,1)):(t=Li(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),L(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){L(t),n=!1},d(o){o&&$(e),t&&t.d(o)}}}function X1(r,e,n){let t,o,l,{$$slots:i={},$$scope:s}=e,{id:a=nr("geojson")}=e,{data:f}=e,{generateId:u=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:m=void 0}=e;const{map:g,cluster:y,self:h}=E1();X(r,g,C=>n(13,o=C)),X(r,y,C=>n(16,l=C)),X(r,h,C=>n(0,t=C));let v,S=!0;return Tt(()=>{t&&v&&o&&(Y1(g,t,v),te(h,t=null,t),n(11,v=void 0))}),r.$$set=C=>{"id"in C&&n(4,a=C.id),"data"in C&&n(5,f=C.data),"generateId"in C&&n(6,u=C.generateId),"promoteId"in C&&n(7,c=C.promoteId),"filter"in C&&n(8,_=C.filter),"lineMetrics"in C&&n(9,d=C.lineMetrics),"cluster"in C&&n(10,m=C.cluster),"$$scope"in C&&n(14,s=C.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&te(y,l=m,l),r.$$.dirty&12273&&o&&t!==a&&(te(h,t=a,t),Z1(o,t,mr({type:"geojson",data:f,filter:_,lineMetrics:d,generateId:u,promoteId:c,cluster:!!m,clusterMinPoints:m==null?void 0:m.minPoints,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius,clusterProperties:m==null?void 0:m.properties}),C=>o&&C===t,()=>{t&&(n(11,v=o==null?void 0:o.getSource(t)),n(12,S=!0))})),r.$$.dirty&8208&&(o==null||o.on("style.load",()=>{n(11,v=o==null?void 0:o.getSource(a))})),r.$$.dirty&6176&&v&&(S?n(12,S=!1):v.setData(f)),r.$$.dirty&3072&&(v==null||v.setClusterOptions(mr({cluster:!!m,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius})))},[t,g,y,h,a,f,u,c,_,d,m,v,S,o,s,i]}class V1 extends se{constructor(e){super(),ae(this,e,X1,K1,oe,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function Q1(r){let e;const n=r[15].default,t=Be(n,r,r[23],null);return{c(){t&&t.c()},m(o,l){t&&t.m(o,l),e=!0},p(o,l){t&&t.p&&(!e||l&8388608)&&Re(t,n,o,o[23],e?Ue(n,o[23],l,null):De(o[23]),null)},i(o){e||(b(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function x1(r){let e,n,t;function o(i){r[16](i)}let l={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[Q1]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new $o({props:l}),He.push(()=>ut(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function eh(r,e,n){let{$$slots:t={},$$scope:o}=e,{id:l=nr("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:y=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:S=!0}=e;function C(R){h=R,n(0,h)}function I(R){je.call(this,r,R)}function E(R){je.call(this,r,R)}function P(R){je.call(this,r,R)}function O(R){je.call(this,r,R)}function B(R){je.call(this,r,R)}function U(R){je.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,l=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,y=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,v=R.eventsIfTopMost),"interactive"in R&&n(14,S=R.interactive),"$$scope"in R&&n(23,o=R.$$scope)},[h,l,i,s,a,f,u,c,_,d,m,g,y,v,S,t,C,I,E,P,O,B,U,o]}class th extends se{constructor(e){super(),ae(this,e,eh,x1,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function nh(r){let e,n,t,o,l,i;return e=new J1({props:{id:"edit-polygon-fill",filter:w1,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),t=new th({props:{id:"edit-polygon-lines",filter:$1,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),l=new H1({props:{id:"edit-polygon-vertices",filter:k1,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment)},m(s,a){A(e,s,a),w(s,n,a),A(t,s,a),w(s,o,a),A(l,s,a),i=!0},p:Q,i(s){i||(b(e.$$.fragment,s),b(t.$$.fragment,s),b(l.$$.fragment,s),i=!0)},o(s){L(e.$$.fragment,s),L(t.$$.fragment,s),L(l.$$.fragment,s),i=!1},d(s){s&&($(n),$(o)),F(e,s),F(t,s),F(l,s)}}}function rh(r){let e,n;return e=new V1({props:{data:r[0],$$slots:{default:[nh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1&&(l.data=t[0]),o&2&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function oh(r,e,n){let t;return X(r,ks,o=>n(0,t=o)),[t]}class lh extends se{constructor(e){super(),ae(this,e,oh,rh,oe,{})}}function ih(r){let e,n,t,o,l,i,s;return{c(){e=k("button"),e.textContent="Import current view",n=M(),t=k("i"),t.textContent="or...",o=M(),l=k("button"),l.textContent="Draw an area to import on the map",N(e,"type","button"),N(l,"type","button")},m(a,f){w(a,e,f),w(a,n,f),w(a,t,f),w(a,o,f),w(a,l,f),i||(s=[V(e,"click",r[2]),V(l,"click",r[3])],i=!0)},p:Q,i:Q,o:Q,d(a){a&&($(e),$(n),$(t),$(o),$(l)),i=!1,lt(s)}}}function sh(r){let e,n;return e=new F1({props:{polygonTool:r[0]}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&1&&(l.polygonTool=t[0]),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ah(r){let e,n,t,o,l,i,s,a,f;const u=[sh,ih],c=[];function _(d,m){return d[0]?0:1}return e=_(r),n=c[e]=u[e](r),{c(){n.c(),t=M(),o=k("label"),l=k("input"),i=j(`Save a copy of the osm.xml
  after importing`),N(l,"type","checkbox")},m(d,m){c[e].m(d,m),w(d,t,m),w(d,o,m),p(o,l),l.checked=r[1],p(o,i),s=!0,a||(f=V(l,"change",r[5]),a=!0)},p(d,[m]){let g=e;e=_(d),e===g?c[e].p(d,m):(he(),L(c[g],1,1,()=>{c[g]=null}),be(),n=c[e],n?n.p(d,m):(n=c[e]=u[e](d),n.c()),b(n,1),n.m(t.parentNode,t)),m&2&&(l.checked=d[1])},i(d){s||(b(n),s=!0)},o(d){L(n),s=!1},d(d){d&&($(t),$(o)),c[e].d(d),a=!1,f()}}}function Nn(r){return[r.lng,r.lat]}function fh(r,e,n){let{map:t}=e;const o=_n();let l=null,i=!1;async function s(_){try{o("loading","Loading from Overpass");let m=await(await fetch(Ms(_))).text();i&&hr("osm.xml",m),o("gotXml",{xml:m,boundary:_})}catch(d){o("error",d.toString())}}function a(){let _=t.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Nn(_.getSouthWest()),Nn(_.getNorthWest()),Nn(_.getNorthEast()),Nn(_.getSouthEast()),Nn(_.getSouthWest())]],type:"Polygon"}}}async function f(){if(t){if(t.getZoom()<13){o("error","Zoom in more to import");return}await s(a())}}function u(){t&&(n(0,l=new L1(t)),l.startNew(),l.addEventListenerSuccess(async _=>{n(0,l=null),await s(_)}),l.addEventListenerFailure(()=>{n(0,l=null)}))}function c(){i=this.checked,n(1,i)}return r.$$set=_=>{"map"in _&&n(4,t=_.map)},[l,i,f,u,t,c]}class uh extends se{constructor(e){super(),ae(this,e,fh,ah,oe,{map:4})}}function Ms(r){let e='poly:"';for(let[t,o]of r.geometry.coordinates[0])e+=`${o} ${t} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Ts{constructor(e,n,t,o){mt(this,"inner");this.inner=new Md(e,n||new Uint8Array,t,o)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=ch(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(n=>n.properties.kind=="interior_road"?n.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,n){this.inner.setNeighbourhoodBoundary(e,n)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,n){this.inner.renameNeighbourhoodBoundary(e,n)}setCurrentNeighbourhood(e,n){this.inner.setCurrentNeighbourhood(e,n)}addModalFilter(e,n){this.inner.addModalFilter(e,n)}addManyModalFilters(e,n){this.inner.addManyModalFilters(e,n)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,n,t){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,n.lng,n.lat,t))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let n of e.features)n.properties.sum_from=il(n.properties.counts_from),n.properties.sum_to=il(n.properties.counts_to);return e}}function ch(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of r.features)n.properties.kind!="cell"&&n.properties.kind!="border_arrow"&&n.properties.kind!="interior_road"||(n.properties.cell_color=="disconnected"?n.properties.color="red":n.properties.color=e[n.properties.cell_color%e.length]);return r}async function dr(r){Zt.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let[n,t,o]=await dh(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),xe.set(new Ts(new Uint8Array(n),t?new Uint8Array(t):void 0,o,e.study_area_name||void 0)),Gt(xe).loadSavefile(e),console.timeEnd("load"),As()}catch(e){window.alert(`Couldn't open project: ${e}`),Zt.set("")}}async function dh(r,e){if(e){let n=Ct(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${n}`);let o=await(await bn(n)).arrayBuffer(),l=Ct(`cnt_boundaries/${r.study_area_name}.geojson`),s=await(await bn(l)).json(),a=Ct(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let f=null;try{f=await(await bn(a)).arrayBuffer()}catch(u){console.log(`No demand model: ${u}`)}return[o,f,s]}else if(r.study_area_name){let n=Ct(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${n}`);let o=await(await bn(n)).arrayBuffer(),l=Ct(`boundaries/${r.study_area_name}.geojson`),s=await(await bn(l)).json();return[o,null,s]}else{console.log("Grabbing from Overpass");let n=r.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await bn(Ms(n))).arrayBuffer(),null,n]}}function As(){ce.set({mode:"pick-neighbourhood"}),An.set(new kf(Gt(Qt),Gt(xe).toRouteSnapper(),Mt(rn()),Mt(!0),Mt(0))),Gt(Qt).fitBounds(Gt(xe).getBounds(),{animate:!1}),Zn.set(Wr()),Jn.set(Wr()),sr.set(Wr());let r=new URL(window.location.href);r.searchParams.set("project",Gt(Zt)),window.history.replaceState(null,"",r.toString())}function Wr(){let r=Gt(xe).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),n=r[1]+Math.random()*(r[3]-r[1]);return new Kr.LngLat(e,n)}function Mi(r,e,n){const t=r.slice();return t[16]=e[n][0],t[17]=e[n][1],t}function Ti(r,e,n){const t=r.slice();return t[20]=e[n][0],t[21]=e[n][1],t}function _h(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function mh(r){let e,n,t,o,l,i,s,a;return l=new Ce({props:{$$slots:{default:[_h]},$$scope:{ctx:r}}}),l.$on("click",r[13]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),s.textContent="New project",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(f,u){w(f,e,u),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),a=!0},p(f,u){const c={};u&16777216&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){a||(b(l.$$.fragment,f),a=!0)},o(f){L(l.$$.fragment,f),a=!1},d(f){f&&$(e),F(l)}}}function Ai(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;e=new Ji({props:{loading:r[4]}});let g=Me(r[3]),y=[];for(let h=0;h<g.length;h+=1)y[h]=Pi(Mi(r,g,h));return c=new uh({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){T(e.$$.fragment),n=M(),t=k("label"),o=j(`Load a built-in area:
        `),l=k("select"),i=k("option");for(let h=0;h<y.length;h+=1)y[h].c();s=M(),a=k("i"),a.textContent="or...",f=M(),u=k("div"),T(c.$$.fragment),i.__value="",qe(i,i.__value),r[2]===void 0&&an(()=>r[9].call(l))},m(h,v){A(e,h,v),w(h,n,v),w(h,t,v),p(t,o),p(t,l),p(l,i);for(let S=0;S<y.length;S+=1)y[S]&&y[S].m(l,null);wt(l,r[2],!0),w(h,s,v),w(h,a,v),w(h,f,v),w(h,u,v),A(c,u,null),_=!0,d||(m=[V(l,"change",r[9]),V(l,"change",r[10])],d=!0)},p(h,v){const S={};if(v&16&&(S.loading=h[4]),e.$set(S),v&8){g=Me(h[3]);let I;for(I=0;I<g.length;I+=1){const E=Mi(h,g,I);y[I]?y[I].p(E,v):(y[I]=Pi(E),y[I].c(),y[I].m(l,null))}for(;I<y.length;I+=1)y[I].d(1);y.length=g.length}v&12&&wt(l,h[2]);const C={};v&32&&(C.map=h[5]),c.$set(C)},i(h){_||(b(e.$$.fragment,h),b(c.$$.fragment,h),_=!0)},o(h){L(e.$$.fragment,h),L(c.$$.fragment,h),_=!1},d(h){h&&($(n),$(t),$(s),$(a),$(f),$(u)),F(e,h),st(y,h),F(c),d=!1,lt(m)}}}function Fi(r){let e,n=r[21]+"",t,o;return{c(){e=k("option"),t=j(n),e.__value=o=r[20],qe(e,e.__value)},m(l,i){w(l,e,i),p(e,t)},p(l,i){i&8&&n!==(n=l[21]+"")&&re(t,n),i&8&&o!==(o=l[20])&&(e.__value=o,qe(e,e.__value))},d(l){l&&$(e)}}}function Pi(r){let e,n,t=Me(r[17]),o=[];for(let l=0;l<t.length;l+=1)o[l]=Fi(Ti(r,t,l));return{c(){e=k("optgroup");for(let l=0;l<o.length;l+=1)o[l].c();N(e,"label",n=r[16])},m(l,i){w(l,e,i);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(l,i){if(i&8){t=Me(l[17]);let s;for(s=0;s<t.length;s+=1){const a=Ti(l,t,s);o[s]?o[s].p(a,i):(o[s]=Fi(a),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}i&8&&n!==(n=l[16])&&N(e,"label",n)},d(l){l&&$(e),st(o,l)}}}function ph(r){let e,n,t,o,l,i,s,a,f,u=r[1]&&Ai(r);return{c(){e=k("div"),n=k("div"),t=k("label"),o=j(`Project name:
        `),l=k("input"),i=M(),u&&u.c(),N(l,"type","text"),N(e,"slot","sidebar")},m(c,_){w(c,e,_),p(e,n),p(n,t),p(t,o),p(t,l),qe(l,r[1]),p(e,i),u&&u.m(e,null),s=!0,a||(f=V(l,"input",r[8]),a=!0)},p(c,_){_&2&&l.value!==c[1]&&qe(l,c[1]),c[1]?u?(u.p(c,_),_&2&&b(u,1)):(u=Ai(c),u.c(),b(u,1),u.m(e,null)):u&&(he(),L(u,1,1,()=>{u=null}),be())},i(c){s||(b(u),s=!0)},o(c){L(u),s=!1},d(c){c&&$(e),u&&u.d(),a=!1,f()}}}function gh(r){let e,n,t;return n=new lh({}),{c(){e=k("div"),T(n.$$.fragment),N(e,"slot","map")},m(o,l){w(o,e,l),A(n,e,null),t=!0},p:Q,i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function hh(r){let e,n;return e=new At({props:{$$slots:{map:[gh],sidebar:[ph],top:[mh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&16777342&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function bh(r,e,n){let t,o,l,i;X(r,Zt,S=>n(14,t=S)),X(r,xe,S=>n(15,o=S)),X(r,Qt,S=>n(5,l=S)),X(r,ce,S=>n(6,i=S));let s="",a="",f=[],u="";$r(async()=>{let S=await bn(Ct("severance_pbfs/areas.json"));n(3,f=await S.json())});function c(S){n(4,u="Loading OSM");try{te(xe,o=new Ts(new TextEncoder().encode(S.detail.xml),void 0,S.detail.boundary,void 0),o),te(Zt,t=`ltn_${s}`,t),As(),Mn()}catch(C){window.alert(`Couldn't import from Overpass: ${C}`)}n(4,u="")}async function _(){if(a=="")return;let S=`ltn_${s}`;window.localStorage.setItem(S,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:a})),n(4,u=`Loading pre-clipped OSM area ${a}`),await dr(S),n(4,u="")}function d(){s=this.value,n(1,s)}function m(){a=fn(this),n(2,a),n(3,f)}return[_,s,a,f,u,l,i,c,d,m,()=>_(),S=>n(4,u=S.detail),S=>window.alert(S.detail),()=>te(ce,i={mode:"title",firstLoad:!1},i)]}class vh extends se{constructor(e){super(),ae(this,e,bh,hh,oe,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Ii(r,e,n){const t=r.slice();return t[19]=e[n][0],t[20]=e[n][1],t}function Ei(r,e,n){const t=r.slice();return t[23]=e[n],t}function yh(r){let e;return{c(){e=k("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',N(e,"slot","top")},m(n,t){w(n,e,t)},p:Q,d(n){n&&$(e)}}}function wh(r){let e;return{c(){e=k("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function $h(r){let e,n,t,o,l,i,s,a,f,u,c,_,d;n=new Ce({props:{$$slots:{default:[kh]},$$scope:{ctx:r}}}),n.$on("click",r[11]);let m=Me(r[2]),g=[];for(let h=0;h<m.length;h+=1)g[h]=ji(Ii(r,m,h));const y=h=>L(g[h],1,1,()=>{g[h]=null});return{c(){e=k("div"),T(n.$$.fragment),t=M(),o=k("p"),o.textContent="Load a saved project:",l=M(),i=k("ul");for(let h=0;h<g.length;h+=1)g[h].c();s=M(),a=k("label"),f=j(`Load a project from a file
        `),u=k("input"),N(u,"type","file")},m(h,v){w(h,e,v),A(n,e,null),w(h,t,v),w(h,o,v),w(h,l,v),w(h,i,v);for(let S=0;S<g.length;S+=1)g[S]&&g[S].m(i,null);w(h,s,v),w(h,a,v),p(a,f),p(a,u),r[15](u),c=!0,_||(d=V(u,"change",r[6]),_=!0)},p(h,v){const S={};if(v&67108864&&(S.$$scope={dirty:v,ctx:h}),n.$set(S),v&900){m=Me(h[2]);let C;for(C=0;C<m.length;C+=1){const I=Ii(h,m,C);g[C]?(g[C].p(I,v),b(g[C],1)):(g[C]=ji(I),g[C].c(),b(g[C],1),g[C].m(i,null))}for(he(),C=m.length;C<g.length;C+=1)y(C);be()}},i(h){if(!c){b(n.$$.fragment,h);for(let v=0;v<m.length;v+=1)b(g[v]);c=!0}},o(h){L(n.$$.fragment,h),g=g.filter(Boolean);for(let v=0;v<g.length;v+=1)L(g[v]);c=!1},d(h){h&&($(e),$(t),$(o),$(l),$(i),$(s),$(a)),F(n),st(g,h),r[15](null),_=!1,d()}}}function kh(r){let e;return{c(){e=j("New project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Sh(r){let e=r[23].slice(4)+"",n;return{c(){n=j(e)},m(t,o){w(t,n,o)},p(t,o){o&4&&e!==(e=t[23].slice(4)+"")&&re(n,e)},d(t){t&&$(n)}}}function Ni(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;function g(){return r[12](r[23])}t=new Ce({props:{$$slots:{default:[Sh]},$$scope:{ctx:r}}}),t.$on("click",g),s=new yo({props:{color:"black"}});function y(){return r[13](r[23])}u=new fs({props:{color:"white"}});function h(){return r[14](r[23])}return{c(){e=k("li"),n=k("span"),T(t.$$.fragment),o=M(),l=k("span"),i=k("button"),T(s.$$.fragment),a=M(),f=k("button"),T(u.$$.fragment),c=M(),N(i,"class","outline icon-btn"),N(i,"aria-label","Rename project"),N(f,"class","icon-btn destructive"),N(f,"aria-label","Delete project"),le(l,"display","flex"),le(l,"gap","16px"),le(n,"display","flex"),le(n,"justify-content","space-between")},m(v,S){w(v,e,S),p(e,n),A(t,n,null),p(n,o),p(n,l),p(l,i),A(s,i,null),p(l,a),p(l,f),A(u,f,null),p(e,c),_=!0,d||(m=[V(i,"click",y),V(f,"click",h)],d=!0)},p(v,S){r=v;const C={};S&67108868&&(C.$$scope={dirty:S,ctx:r}),t.$set(C)},i(v){_||(b(t.$$.fragment,v),b(s.$$.fragment,v),b(u.$$.fragment,v),_=!0)},o(v){L(t.$$.fragment,v),L(s.$$.fragment,v),L(u.$$.fragment,v),_=!1},d(v){v&&$(e),F(t),F(s),F(u),d=!1,lt(m)}}}function ji(r){let e,n=(r[19]??"custom area")+"",t,o,l,i,s=Me(r[20]),a=[];for(let u=0;u<s.length;u+=1)a[u]=Ni(Ei(r,s,u));const f=u=>L(a[u],1,1,()=>{a[u]=null});return{c(){e=k("u"),t=j(n),o=M();for(let u=0;u<a.length;u+=1)a[u].c();l=Ze()},m(u,c){w(u,e,c),p(e,t),w(u,o,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(u,c);w(u,l,c),i=!0},p(u,c){if((!i||c&4)&&n!==(n=(u[19]??"custom area")+"")&&re(t,n),c&900){s=Me(u[20]);let _;for(_=0;_<s.length;_+=1){const d=Ei(u,s,_);a[_]?(a[_].p(d,c),b(a[_],1)):(a[_]=Ni(d),a[_].c(),b(a[_],1),a[_].m(l.parentNode,l))}for(he(),_=s.length;_<a.length;_+=1)f(_);be()}},i(u){if(!i){for(let c=0;c<s.length;c+=1)b(a[c]);i=!0}},o(u){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)L(a[c]);i=!1},d(u){u&&($(e),$(o),$(l)),st(a,u)}}}function Lh(r){let e,n,t,o;const l=[$h,wh],i=[];function s(a,f){return a[4]&&a[0]?0:1}return n=s(r),t=i[n]=l[n](r),{c(){e=k("div"),t.c(),N(e,"slot","sidebar")},m(a,f){w(a,e,f),i[n].m(e,null),o=!0},p(a,f){let u=n;n=s(a),n===u?i[n].p(a,f):(he(),L(i[u],1,1,()=>{i[u]=null}),be(),t=i[n],t?t.p(a,f):(t=i[n]=l[n](a),t.c()),b(t,1),t.m(e,null))},i(a){o||(b(t),o=!0)},o(a){L(t),o=!1},d(a){a&&$(e),i[n].d()}}}function Ch(r){let e,n,t,o;return e=new Ji({props:{loading:r[1]}}),t=new At({props:{$$slots:{sidebar:[Lh],top:[yh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(l,i){A(e,l,i),w(l,n,i),A(t,l,i),o=!0},p(l,[i]){const s={};i&2&&(s.loading=l[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:l}),t.$set(a)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){L(e.$$.fragment,l),L(t.$$.fragment,l),o=!1},d(l){l&&$(n),F(e,l),F(t,l)}}}function ir(){let r=new Map,e=[];for(let t=0;t<window.localStorage.length;t++){let o=window.localStorage.key(t);if(o.startsWith("ltn_")){let l="";try{l=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch{}l&&l.length>0?(r.has(l)||r.set(l,[]),r.get(l).push(o)):e.push(o)}}let n=[...r.entries()];return n.sort((t,o)=>t[0].localeCompare(o[0])),n.push(["custom",e]),n}function Mh(r,e,n){let t,o,l,i,s;X(r,Zt,E=>n(16,t=E)),X(r,An,E=>n(17,o=E)),X(r,xe,E=>n(18,l=E)),X(r,Qt,E=>n(4,i=E)),X(r,ce,E=>n(5,s=E));let{wasmReady:a}=e,{firstLoad:f}=e,u="";if(te(xe,l=null,l),te(An,o=null,o),te(Zt,t="",t),f){let P=new URLSearchParams(window.location.search).get("project");P&&(u=`Loading project ${P}`,dr(P))}else{let E=new URL(window.location.href);E.searchParams.delete("project"),window.history.replaceState(null,"",E.toString())}let c=ir(),_;async function d(E){let P="ltn_"+_.files[0].name;n(1,u=`Loading from file ${P}`),window.localStorage.setItem(P,await _.files[0].text()),n(2,c=ir()),await dr(P),n(1,u="")}function m(E){window.confirm(`Really delete project ${E}? You can't undo this.`)&&(window.localStorage.removeItem(E),n(2,c=ir()))}function g(E){let P=window.prompt(`Rename project ${E} to what?`,E);if(P){P.startsWith("ltn_")||(P=`ltn_${P}`);let O=window.localStorage.getItem(E);window.localStorage.setItem(P,O),window.localStorage.removeItem(E),n(2,c=ir())}}async function y(E){n(1,u=`Loading project ${E}`),await dr(E),n(1,u="")}const h=()=>te(ce,s={mode:"new-project"},s),v=E=>y(E),S=E=>g(E),C=E=>m(E);function I(E){He[E?"unshift":"push"](()=>{_=E,n(3,_)})}return r.$$set=E=>{"wasmReady"in E&&n(0,a=E.wasmReady),"firstLoad"in E&&n(10,f=E.firstLoad)},[a,u,c,_,i,s,d,m,g,y,f,h,v,S,C,I]}class Th extends se{constructor(e){super(),ae(this,e,Mh,Ch,oe,{wasmReady:0,firstLoad:10})}}function Ah(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Fh(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Ph(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Ih(r){let e,n,t,o,l,i,s,a,f,u,c,_,d,m;return l=new Ce({props:{$$slots:{default:[Ah]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[Fh]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new Ce({props:{$$slots:{default:[Ph]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=k("div"),n=k("nav"),t=k("ul"),o=k("li"),T(l.$$.fragment),i=M(),s=k("li"),T(a.$$.fragment),f=M(),u=k("li"),T(c.$$.fragment),_=M(),d=k("li"),d.textContent="Viewing shortcuts",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){w(g,e,y),p(e,n),p(n,t),p(t,o),A(l,o,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),A(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&1024&&(h.$$scope={dirty:y,ctx:g}),l.$set(h);const v={};y&1024&&(v.$$scope={dirty:y,ctx:g}),a.$set(v);const S={};y&1024&&(S.$$scope={dirty:y,ctx:g}),c.$set(S)},i(g){m||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){L(l.$$.fragment,g),L(a.$$.fragment,g),L(c.$$.fragment,g),m=!1},d(g){g&&$(e),F(l),F(a),F(c)}}}function Eh(r){let e,n,t,o,l,i,s,a,f,u,c=ft(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,m,g,y,h;function v(C){r[5](C)}let S={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(S.idx=r[0].shortcutIndex),l=new Ar({props:S}),He.push(()=>ut(l,"idx",v)),{c(){e=k("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=M(),t=k("button"),t.textContent="Pick a different road",o=M(),T(l.$$.fragment),s=M(),a=k("p"),f=j("This shortcut is "),u=k("b"),_=j(c),d=j("x"),m=j(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(C,I){w(C,e,I),w(C,n,I),w(C,t,I),w(C,o,I),A(l,C,I),w(C,s,I),w(C,a,I),p(a,f),p(a,u),p(u,_),p(u,d),p(a,m),g=!0,y||(h=V(t,"click",r[4]),y=!0)},p(C,I){const E={};I&1&&(E.list=C[0].gj.features),!i&&I&1&&(i=!0,E.idx=C[0].shortcutIndex,ct(()=>i=!1)),l.$set(E),(!g||I&1)&&c!==(c=ft(C[0].gj.features[C[0].shortcutIndex].properties).directness.toFixed(1)+"")&&re(_,c)},i(C){g||(b(l.$$.fragment,C),g=!0)},o(C){L(l.$$.fragment,C),g=!1},d(C){C&&($(e),$(n),$(t),$(o),$(s),$(a)),F(l,C),y=!1,h()}}}function Nh(r){let e;return{c(){e=k("p"),e.textContent="Click a road to see shortcuts"},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function jh(r){let e,n,t,o,l,i;n=new pn({}),n.$on("click",r[3]);const s=[Nh,Eh],a=[];function f(u,c){return u[0].state=="neutral"?0:u[0].state=="chose-road"?1:-1}return~(o=f(r))&&(l=a[o]=s[o](r)),{c(){e=k("div"),T(n.$$.fragment),t=M(),l&&l.c(),N(e,"slot","sidebar")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),~o&&a[o].m(e,null),i=!0},p(u,c){let _=o;o=f(u),o===_?~o&&a[o].p(u,c):(l&&(he(),L(a[_],1,1,()=>{a[_]=null}),be()),~o?(l=a[o],l?l.p(u,c):(l=a[o]=s[o](u),l.c()),b(l,1),l.m(e,null)):l=null)},i(u){i||(b(n.$$.fragment,u),b(l),i=!0)},o(u){L(n.$$.fragment,u),L(l),i=!1},d(u){u&&$(e),F(n),~o&&a[o].d()}}}function zh(r){let e,n;return e=new er({props:{interactive:!1}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Oh(r){let e,n;return e=new er({props:{onClickLine:r[2],$$slots:{"line-popup":[Rh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Bh(r){let e,n=r[9].shortcuts+"",t,o,l=(r[9].name??"unnamed road")+"",i;return{c(){e=k("p"),t=j(n),o=j(" shortcuts through "),i=j(l)},m(s,a){w(s,e,a),p(e,t),p(e,o),p(e,i)},p(s,a){a&512&&n!==(n=s[9].shortcuts+"")&&re(t,n),a&512&&l!==(l=(s[9].name??"unnamed road")+"")&&re(i,l)},d(s){s&&$(e)}}}function Rh(r){let e,n,t;return n=new gt({props:{openOn:"hover",$$slots:{default:[Bh,({props:o})=>({9:o}),({props:o})=>o?512:0]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),N(e,"slot","line-popup")},m(o,l){w(o,e,l),A(n,e,null),t=!0},p(o,l){const i={};l&1536&&(i.$$scope={dirty:l,ctx:o}),n.$set(i)},i(o){t||(b(n.$$.fragment,o),t=!0)},o(o){L(n.$$.fragment,o),t=!1},d(o){o&&$(e),F(n)}}}function Dh(r){let e,n,t,o,l,i,s,a,f,u;e=new Pr({}),t=new Fr({}),l=new Ir({});const c=[Oh,zh],_=[];function d(m,g){return m[0].state=="neutral"?0:m[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),a&&a.c(),f=Ze()},m(m,g){A(e,m,g),w(m,n,g),A(t,m,g),w(m,o,g),A(l,m,g),w(m,i,g),~s&&_[s].m(m,g),w(m,f,g),u=!0},p(m,g){let y=s;s=d(m),s===y?~s&&_[s].p(m,g):(a&&(he(),L(_[y],1,1,()=>{_[y]=null}),be()),~s?(a=_[s],a?a.p(m,g):(a=_[s]=c[s](m),a.c()),b(a,1),a.m(f.parentNode,f)):a=null)},i(m){u||(b(e.$$.fragment,m),b(t.$$.fragment,m),b(l.$$.fragment,m),b(a),u=!0)},o(m){L(e.$$.fragment,m),L(t.$$.fragment,m),L(l.$$.fragment,m),L(a),u=!1},d(m){m&&($(n),$(o),$(i),$(f)),F(e,m),F(t,m),F(l,m),~s&&_[s].d(m)}}}function zi(r){let e,n,t,o,l,i,s,a;return e=new Ve({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[Uh]},$$scope:{ctx:r}}}),t=new Ve({props:{data:r[0].roadGj,$$slots:{default:[Hh]},$$scope:{ctx:r}}}),l=new wn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[Gh]},$$scope:{ctx:r}}}),s=new wn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[Wh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),T(s.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),w(f,o,u),A(l,f,u),w(f,i,u),A(s,f,u),a=!0},p(f,u){const c={};u&1&&(c.data=f[0].gj.features[f[0].shortcutIndex]),u&1024&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};u&1&&(_.data=f[0].roadGj),u&1024&&(_.$$scope={dirty:u,ctx:f}),t.$set(_);const d={};u&1&&(d.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[0]),u&1024&&(d.$$scope={dirty:u,ctx:f}),l.$set(d);const m={};u&1&&(m.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[f[0].gj.features[f[0].shortcutIndex].geometry.coordinates.length-1]),u&1024&&(m.$$scope={dirty:u,ctx:f}),s.$set(m)},i(f){a||(b(e.$$.fragment,f),b(t.$$.fragment,f),b(l.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){L(e.$$.fragment,f),L(t.$$.fragment,f),L(l.$$.fragment,f),L(s.$$.fragment,f),a=!1},d(f){f&&($(n),$(o),$(i)),F(e,f),F(t,f),F(l,f),F(s,f)}}}function Uh(r){let e,n;const t=[$e("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Hh(r){let e,n;const t=[$e("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new tt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Gh(r){let e;return{c(){e=j("A")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function Wh(r){let e;return{c(){e=j("B")},m(n,t){w(n,e,t)},d(n){n&&$(e)}}}function qh(r){let e,n,t,o,l,i;n=new tr({props:{$$slots:{default:[Dh]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&zi(r);return l=new gn({}),{c(){e=k("div"),T(n.$$.fragment),t=M(),s&&s.c(),o=M(),T(l.$$.fragment),N(e,"slot","map")},m(a,f){w(a,e,f),A(n,e,null),p(e,t),s&&s.m(e,null),p(e,o),A(l,e,null),i=!0},p(a,f){const u={};f&1025&&(u.$$scope={dirty:f,ctx:a}),n.$set(u),a[0].state=="chose-road"?s?(s.p(a,f),f&1&&b(s,1)):(s=zi(a),s.c(),b(s,1),s.m(e,o)):s&&(he(),L(s,1,1,()=>{s=null}),be())},i(a){i||(b(n.$$.fragment,a),b(s),b(l.$$.fragment,a),i=!0)},o(a){L(n.$$.fragment,a),L(s),L(l.$$.fragment,a),i=!1},d(a){a&&$(e),F(n),s&&s.d(),F(l)}}}function Jh(r){let e,n;return e=new At({props:{$$slots:{map:[qh],sidebar:[jh],top:[Ih]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:t}),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Zh(r,e,n){let t,o;X(r,ce,_=>n(1,t=_)),X(r,xe,_=>n(8,o=_));let l={state:"neutral"};function i(_,d){let m=o.getShortcutsCrossingRoad(_.properties.id);if(m.features.length==0){window.alert("No shortcuts here");return}n(0,l={state:"chose-road",roadGj:_,gj:m,shortcutIndex:0})}function s(){te(ce,t={mode:"neighbourhood"},t)}const a=()=>n(0,l={state:"neutral"});function f(_){r.$$.not_equal(l.shortcutIndex,_)&&(l.shortcutIndex=_,n(0,l))}return[l,t,i,s,a,f,()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class Yh extends se{constructor(e){super(),ae(this,e,Zh,Jh,oe,{})}}function Kh(r){let e,n,t,o,l,i,s,a,f;return o=new y1({}),{c(){e=k("div"),n=k("button"),n.innerHTML=`<img src="${da}" style="height: 6vh;" alt="A/B Street logo"/>`,t=M(),T(o.$$.fragment),l=M(),i=k("span"),N(n,"class","outline"),le(i,"width","100%"),N(e,"slot","top"),N(e,"class","pico"),le(e,"display","flex")},m(u,c){w(u,e,c),p(e,n),p(e,t),A(o,e,null),p(e,l),p(e,i),r[20](i),s=!0,a||(f=V(n,"click",r[19]),a=!0)},p:Q,i(u){s||(b(o.$$.fragment,u),s=!0)},o(u){L(o.$$.fragment,u),s=!1},d(u){u&&$(e),F(o),r[20](null),a=!1,f()}}}function Oi(r){let e,n,t,o,l,i;return t=new Gu({props:{map:ft(r[6]),maptilerBasemap:r[7]}}),{c(){e=k("button"),e.textContent="Zoom to fit study area",n=M(),T(t.$$.fragment),N(e,"class","secondary")},m(s,a){w(s,e,a),w(s,n,a),A(t,s,a),o=!0,l||(i=V(e,"click",r[11]),l=!0)},p(s,a){const f={};a&64&&(f.map=ft(s[6])),a&128&&(f.maptilerBasemap=s[7]),t.$set(f)},i(s){o||(b(t.$$.fragment,s),o=!0)},o(s){L(t.$$.fragment,s),o=!1},d(s){s&&($(e),$(n)),F(t,s),l=!1,i()}}}function Xh(r){let e,n,t,o,l,i,s=r[5]&&Oi(r);return{c(){e=k("div"),n=k("div"),t=M(),o=k("hr"),l=M(),s&&s.c(),N(e,"class","pico"),N(e,"slot","left")},m(a,f){w(a,e,f),p(e,n),r[18](n),p(e,t),p(e,o),p(e,l),s&&s.m(e,null),i=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&b(s,1)):(s=Oi(a),s.c(),b(s,1),s.m(e,null)):s&&(he(),L(s,1,1,()=>{s=null}),be())},i(a){i||(b(s),i=!0)},o(a){L(s),i=!1},d(a){a&&$(e),r[18](null),s&&s.d()}}}function Bi(r){let e,n;return e=new wd({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Vh(r){let e,n;return e=new vh({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Qh(r){let e,n;return e=new Th({props:{wasmReady:r[4],firstLoad:r[9].firstLoad}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&16&&(l.wasmReady=t[4]),o&512&&(l.firstLoad=t[9].firstLoad),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ri(r){let e,n,t,o,l,i;e=new Ve({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[xh]},$$scope:{ctx:r}}});const s=[c0,u0,f0,a0,s0,i0,l0,o0,r0,n0,t0,e0],a=[];function f(u,c){return u[9].mode=="pick-neighbourhood"?0:u[9].mode=="set-boundary"?1:u[9].mode=="auto-boundaries"?2:u[9].mode=="neighbourhood"?3:u[9].mode=="view-shortcuts"?4:u[9].mode=="impact-one-destination"?5:u[9].mode=="route"?6:u[9].mode=="predict-impact"?7:u[9].mode=="impact-detail"?8:u[9].mode=="debug-neighbourhood"?9:u[9].mode=="debug-intersections"?10:u[9].mode=="debug-demand"?11:-1}return~(t=f(r))&&(o=a[t]=s[t](r)),{c(){T(e.$$.fragment),n=M(),o&&o.c(),l=Ze()},m(u,c){A(e,u,c),w(u,n,c),~t&&a[t].m(u,c),w(u,l,c),i=!0},p(u,c){const _={};c&32&&(_.data=u[5].getInvertedBoundary()),c&4194304&&(_.$$scope={dirty:c,ctx:u}),e.$set(_);let d=t;t=f(u),t===d?~t&&a[t].p(u,c):(o&&(he(),L(a[d],1,1,()=>{a[d]=null}),be()),~t?(o=a[t],o?o.p(u,c):(o=a[t]=s[t](u),o.c()),b(o,1),o.m(l.parentNode,l)):o=null)},i(u){i||(b(e.$$.fragment,u),b(o),i=!0)},o(u){L(e.$$.fragment,u),L(o),i=!1},d(u){u&&($(n),$(l)),F(e,u),~t&&a[t].d(u)}}}function xh(r){let e,n;const t=[$e("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<t.length;l+=1)o=_e(o,t[l]);return e=new $t({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),n=!0},p(l,i){const s={};e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){L(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function e0(r){let e,n;return e=new y_({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function t0(r){let e,n;return e=new F_({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function n0(r){let e,n;return e=new _m({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function r0(r){let e,n;return e=new Ep({props:{road:r[9].road}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&512&&(l.road=t[9].road),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function o0(r){let e,n;return e=new Tg({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function l0(r){let e,n;return e=new Ug({props:{prevMode:r[9].prevMode}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&512&&(l.prevMode=t[9].prevMode),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function i0(r){let e,n;return e=new Yp({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function s0(r){let e,n;return e=new Yh({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function a0(r){let e,n;return e=new wp({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function f0(r){let e,n;return e=new f_({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function u0(r){let e,n;return e=new p1({props:{name:r[9].name,existing:r[9].existing}}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p(t,o){const l={};o&512&&(l.name=t[9].name),o&512&&(l.existing=t[9].existing),e.$set(l)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function c0(r){let e,n;return e=new hg({}),{c(){T(e.$$.fragment)},m(t,o){A(e,t,o),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function d0(r){let e,n,t,o,l,i,s=r[8].startsWith("ltn_cnt/"),a,f,u,c,_,d,m,g,y;e=new fa({}),t=new ua({}),l=new Cc({props:{map:r[0],apiKey:Xr,country:void 0}});let h=s&&Bi();const v=[Qh,Vh],S=[];function C(E,P){return E[9].mode=="title"?0:E[9].mode=="new-project"?1:-1}~(c=C(r))&&(_=S[c]=v[c](r));let I=r[5]&&Ri(r);return g=new ru({}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),o=M(),T(l.$$.fragment),i=M(),h&&h.c(),a=M(),f=k("div"),u=M(),_&&_.c(),d=M(),I&&I.c(),m=M(),T(g.$$.fragment)},m(E,P){A(e,E,P),w(E,n,P),A(t,E,P),w(E,o,P),A(l,E,P),w(E,i,P),h&&h.m(E,P),w(E,a,P),w(E,f,P),r[15](f),w(E,u,P),~c&&S[c].m(E,P),w(E,d,P),I&&I.m(E,P),w(E,m,P),A(g,E,P),y=!0},p(E,P){const O={};P&1&&(O.map=E[0]),l.$set(O),P&256&&(s=E[8].startsWith("ltn_cnt/")),s?h?P&256&&b(h,1):(h=Bi(),h.c(),b(h,1),h.m(a.parentNode,a)):h&&(he(),L(h,1,1,()=>{h=null}),be());let B=c;c=C(E),c===B?~c&&S[c].p(E,P):(_&&(he(),L(S[B],1,1,()=>{S[B]=null}),be()),~c?(_=S[c],_?_.p(E,P):(_=S[c]=v[c](E),_.c()),b(_,1),_.m(d.parentNode,d)):_=null),E[5]?I?(I.p(E,P),P&32&&b(I,1)):(I=Ri(E),I.c(),b(I,1),I.m(m.parentNode,m)):I&&(he(),L(I,1,1,()=>{I=null}),be())},i(E){y||(b(e.$$.fragment,E),b(t.$$.fragment,E),b(l.$$.fragment,E),b(h),b(_),b(I),b(g.$$.fragment,E),y=!0)},o(E){L(e.$$.fragment,E),L(t.$$.fragment,E),L(l.$$.fragment,E),L(h),L(_),L(I),L(g.$$.fragment,E),y=!1},d(E){E&&($(n),$(o),$(i),$(a),$(f),$(u),$(d),$(m)),F(e,E),F(t,E),F(l,E),h&&h.d(E),r[15](null),~c&&S[c].d(E),I&&I.d(E),F(g,E)}}}function _0(r){let e,n,t,o;function l(s){r[16](s)}let i={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${Xr}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"oneway_arrow",url:ca},{id:"national_rail",url:qi}],$$slots:{default:[d0]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.map=r[0]),n=new aa({props:i}),He.push(()=>ut(n,"map",l)),n.$on("error",r[17]),{c(){e=k("div"),T(n.$$.fragment),N(e,"slot","main"),le(e,"position","relative"),le(e,"width","100%"),le(e,"height","100%")},m(s,a){w(s,e,a),A(n,e,null),o=!0},p(s,a){const f={};a&128&&(f.style=`https://api.maptiler.com/maps/${s[7]}/style.json?key=${Xr}`),a&4195129&&(f.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,f.map=s[0],ct(()=>t=!1)),n.$set(f)},i(s){o||(b(n.$$.fragment,s),o=!0)},o(s){L(n.$$.fragment,s),o=!1},d(s){s&&$(e),F(n)}}}function m0(r){let e,n,t,o,l;return n=new Mf({}),o=new zd({props:{$$slots:{main:[_0],left:[Xh],top:[Kh]},$$scope:{ctx:r}}}),{c(){e=k("div"),T(n.$$.fragment),t=M(),T(o.$$.fragment),N(e,"class","pico")},m(i,s){w(i,e,s),A(n,e,null),w(i,t,s),A(o,i,s),l=!0},p(i,[s]){const a={};s&4196351&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(n.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){L(n.$$.fragment,i),L(o.$$.fragment,i),l=!1},d(i){i&&($(e),$(t)),F(n),F(o,i)}}}function p0(r,e,n){let t,o,l,i,s,a,f,u,c,_;X(r,ro,B=>n(12,t=B)),X(r,no,B=>n(13,o=B)),X(r,to,B=>n(14,l=B)),X(r,xe,B=>n(5,i=B)),X(r,Qt,B=>n(6,s=B)),X(r,To,B=>n(21,a=B)),X(r,Jr,B=>n(7,f=B)),X(r,Zt,B=>n(8,u=B)),X(r,ce,B=>n(9,c=B)),X(r,_r,B=>n(10,_=B));let d=!1;$r(async()=>{await gs(),await Yi(),n(4,d=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(te(To,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let m=null;function g(){s.fitBounds(i.getBounds(),{animate:!1})}let y,h,v;function S(B){He[B?"unshift":"push"](()=>{v=B,n(3,v),n(12,t)})}function C(B){m=B,n(0,m)}const I=B=>{console.log(B.detail.error)};function E(B){He[B?"unshift":"push"](()=>{h=B,n(2,h),n(13,o)})}const P=()=>te(_r,_=!0,_);function O(B){He[B?"unshift":"push"](()=>{y=B,n(1,y),n(14,l)})}return r.$$.update=()=>{r.$$.dirty&1&&m&&Qt.set(m),r.$$.dirty&16386&&y&&l&&(n(1,y.innerHTML="",y),y.appendChild(l)),r.$$.dirty&8196&&h&&o&&(n(2,h.innerHTML="",h),h.appendChild(o)),r.$$.dirty&4104&&v&&t&&(n(3,v.innerHTML="",v),v.appendChild(t))},[m,y,h,v,d,i,s,f,u,c,_,g,t,o,l,S,C,I,E,P,O]}class g0 extends se{constructor(e){super(),ae(this,e,p0,m0,oe,{})}}new g0({target:document.getElementById("app")});
