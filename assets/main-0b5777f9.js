var Ws=Object.defineProperty;var qs=(r,e,n)=>e in r?Ws(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var pt=(r,e,n)=>(qs(r,typeof e!="symbol"?e+"":e,n),n);import{S as ae,i as fe,s as oe,e as Ye,a as w,n as Q,d as k,b as S,t as j,c as M,f as N,g as p,h as le,j as ie,k as Re,l as X,u as De,m as Ue,o as He,p as $,q as C,r as ft,v as je,w as ze,x as Me,y as dt,z as Js,A as il,B as Zs,C as he,D as be,E as V,F as dr,G as T,H as A,I as F,J as ne,L as Ri,K as nt,M as rt,N as sl,O as gt,P as al,Q as Tt,R as dn,T as yl,U as zr,V as Di,W as Wr,X as Ys,Y as Xt,Z as Ks,_ as yr,$ as Xs,a0 as Vs,a1 as Qs,a2 as xs,a3 as _r,a4 as ea,a5 as qe,a6 as sn,a7 as wt,a8 as qr,a9 as an,aa as Mt,ab as Ve,ac as $t,ad as me,ae as qt,af as mr,ag as wl,ah as Vt,ai as Qt,aj as Ui,ak as Hi,al as Gt,am as Ct,an as lt,ao as Ke,ap as kl,aq as ta,ar as na,as as ra,at as la,au as ut,av as at,aw as Ce,ax as Zt,ay as de,az as Wn,aA as xe,aB as fl,aC as Cn,aD as pr,aE as Jr,aF as ul,aG as Nt,aH as Gi,aI as Zr,aJ as Sl,aK as ir,aL as qn,aM as Jn,aN as Yr,aO as Ll,aP as oa,aQ as Kr,aR as ia,aS as Cl,aT as sa,aU as aa}from"./pico.conditional.jade.min-3f1b3b01.js";function Oe(r,e){const n={},t={},l={$$scope:1};let o=r.length;for(;o--;){const i=r[o],s=e[o];if(s){for(const a in i)a in s||(t[a]=1);for(const a in s)l[a]||(n[a]=s[a],l[a]=1);r[o]=s}else for(const a in i)l[a]=1}for(const i in t)i in n||(n[i]=void 0);return n}function wr(r){return typeof r=="object"&&r!==null?r:{}}const fa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",ua="/ltn/assets/logo-97f2d067.svg",Wi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function Ml(r){let e,n,t,l=r[1]!=null&&Tl(r);return{c(){e=S("div"),n=j(r[0]),t=M(),l&&l.c(),N(e,"class","cover svelte-1w7hi45")},m(o,i){w(o,e,i),p(e,n),p(e,t),l&&l.m(e,null)},p(o,i){i&1&&le(n,o[0]),o[1]!=null?l?l.p(o,i):(l=Tl(o),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(o){o&&k(e),l&&l.d()}}}function Tl(r){let e,n;return{c(){e=S("div"),n=S("progress"),n.value=r[1],ie(n,"width","100%")},m(t,l){w(t,e,l),p(e,n)},p(t,l){l&2&&(n.value=t[1])},d(t){t&&k(e)}}}function ca(r){let e,n=r[0]&&Ml(r);return{c(){n&&n.c(),e=Ye()},m(t,l){n&&n.m(t,l),w(t,e,l)},p(t,[l]){t[0]?n?n.p(t,l):(n=Ml(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Q,o:Q,d(t){t&&k(e),n&&n.d(t)}}}function da(r,e,n){let{loading:t}=e,{progress:l=null}=e;return r.$$set=o=>{"loading"in o&&n(0,t=o.loading),"progress"in o&&n(1,l=o.progress)},[t,l]}class qi extends ae{constructor(e){super(),fe(this,e,da,ca,oe,{loading:0,progress:1})}}const _a=r=>({dialog:r&1}),Al=r=>({dialog:r[0]});function ma(r){let e,n,t,l,o;const i=r[4].default,s=Re(i,r,r[3],Al);return{c(){e=S("dialog"),n=S("article"),s&&s.c(),e.open=!0},m(a,f){w(a,e,f),p(e,n),s&&s.m(n,null),r[6](e),t=!0,l||(o=[X(window,"click",r[1]),X(window,"keydown",r[2]),X(e,"close",r[5])],l=!0)},p(a,[f]){s&&s.p&&(!t||f&9)&&De(s,i,a,a[3],t?He(i,a[3],f,_a):Ue(a[3]),Al)},i(a){t||($(s,a),t=!0)},o(a){C(s,a),t=!1},d(a){a&&k(e),s&&s.d(a),r[6](null),l=!1,ft(o)}}}function pa(r,e,n){let{$$slots:t={},$$scope:l}=e,o;function i(u){o.open&&u.target==o&&o.close()}function s(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),o.close())}function a(u){je.call(this,r,u)}function f(u){ze[u?"unshift":"push"](()=>{o=u,n(0,o)})}return r.$$set=u=>{"$$scope"in u&&n(3,l=u.$$scope)},[o,i,s,l,t,a,f]}class kr extends ae{constructor(e){super(),fe(this,e,pa,ma,oe,{})}}function Fl(r,e,n){const t=r.slice();return t[1]=e[n][0],t[2]=e[n][1],t}function Pl(r){let e,n,t=r[1]+"",l,o,i,s=r[2]+"",a,f;return{c(){e=S("tr"),n=S("td"),l=j(t),o=M(),i=S("td"),a=j(s),f=M()},m(u,c){w(u,e,c),p(e,n),p(n,l),p(e,o),p(e,i),p(i,a),p(e,f)},p(u,c){c&1&&t!==(t=u[1]+"")&&le(l,t),c&1&&s!==(s=u[2]+"")&&le(a,s)},d(u){u&&k(e)}}}function ga(r){let e,n,t=Me(Object.entries(r[0])),l=[];for(let o=0;o<t.length;o+=1)l[o]=Pl(Fl(r,t,o));return{c(){e=S("table"),n=S("tbody");for(let o=0;o<l.length;o+=1)l[o].c();N(e,"class","svelte-lh2o9l")},m(o,i){w(o,e,i),p(e,n);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(n,null)},p(o,[i]){if(i&1){t=Me(Object.entries(o[0]));let s;for(s=0;s<t.length;s+=1){const a=Fl(o,t,s);l[s]?l[s].p(a,i):(l[s]=Pl(a),l[s].c(),l[s].m(n,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}},i:Q,o:Q,d(o){o&&k(e),dt(l,o)}}}function ha(r,e,n){let{properties:t}=e;return r.$$set=l=>{"properties"in l&&n(0,t=l.properties)},[t]}class Xn extends ae{constructor(e){super(),fe(this,e,ha,ga,oe,{properties:0})}}function El(r,e,n){const t=r.slice();return t[2]=e[n][0],t[6]=e[n][1],t}function Il(r,e,n){const t=r.slice();return t[2]=e[n][0],t[3]=e[n][1],t}function Nl(r,e,n){const t=r.slice();return t[3]=e[n][0],t[6]=e[n][1],t}function ba(r){let e,n=Me(Object.entries(r[0])),t=[];for(let l=0;l<n.length;l+=1)t[l]=jl(El(r,n,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=Ye()},m(l,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(l,o);w(l,e,o)},p(l,o){if(o&1){n=Me(Object.entries(l[0]));let i;for(i=0;i<n.length;i+=1){const s=El(l,n,i);t[i]?t[i].p(s,o):(t[i]=jl(s),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(l){l&&k(e),dt(t,l)}}}function $a(r){let e,n,t,l=Me(Object.entries(r[0])),o=[];for(let a=0;a<l.length;a+=1)o[a]=zl(Nl(r,l,a));let i=Me(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=Ol(Il(r,i,a));return{c(){e=S("div");for(let a=0;a<o.length;a+=1)o[a].c();n=M(),t=S("div");for(let a=0;a<s.length;a+=1)s[a].c();ie(e,"display","flex"),ie(t,"display","flex"),ie(t,"justify-content","space-between")},m(a,f){w(a,e,f);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);w(a,n,f),w(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,f){if(f&1){l=Me(Object.entries(a[0]));let u;for(u=0;u<l.length;u+=1){const c=Nl(a,l,u);o[u]?o[u].p(c,f):(o[u]=zl(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=l.length}if(f&1){i=Me(Object.entries(a[0]));let u;for(u=0;u<i.length;u+=1){const c=Il(a,i,u);s[u]?s[u].p(c,f):(s[u]=Ol(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},d(a){a&&(k(e),k(n),k(t)),dt(o,a),dt(s,a)}}}function jl(r){let e,n,t,l=r[2]+"",o,i;return{c(){e=S("div"),n=S("span"),t=M(),o=j(l),i=M(),N(n,"class","vertical-block svelte-rl95zk"),ie(n,"background",r[6])},m(s,a){w(s,e,a),p(e,n),p(e,t),p(e,o),p(e,i)},p(s,a){a&1&&ie(n,"background",s[6]),a&1&&l!==(l=s[2]+"")&&le(o,l)},d(s){s&&k(e)}}}function zl(r){let e,n;return{c(){e=S("span"),n=j(` 
      `),ie(e,"background",r[6]),ie(e,"width","100%"),ie(e,"border","1px solid black")},m(t,l){w(t,e,l),p(e,n)},p(t,l){l&1&&ie(e,"background",t[6])},d(t){t&&k(e)}}}function Ol(r){let e,n=r[2]+"",t;return{c(){e=S("span"),t=j(n)},m(l,o){w(l,e,o),p(e,t)},p(l,o){o&1&&n!==(n=l[2]+"")&&le(t,n)},d(l){l&&k(e)}}}function va(r){let e;function n(o,i){return o[1]?$a:ba}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),w(o,e,i)},p(o,[i]){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},i:Q,o:Q,d(o){o&&k(e),l.d(o)}}}function ya(r,e,n){let{colors:t}=e,{horiz:l=!1}=e;return r.$$set=o=>{"colors"in o&&n(0,t=o.colors),"horiz"in o&&n(1,l=o.horiz)},[t,l]}class cl extends ae{constructor(e){super(),fe(this,e,ya,va,oe,{colors:0,horiz:1})}}function Bl(r,e,n){const t=r.slice();return t[3]=e[n],t}function Rl(r,e,n){const t=r.slice();return t[6]=e[n],t}function Dl(r){let e,n;return{c(){e=S("span"),n=j(` 
    `),ie(e,"background",r[6]),ie(e,"width","100%"),ie(e,"border","1px solid black")},m(t,l){w(t,e,l),p(e,n)},p(t,l){l&1&&ie(e,"background",t[6])},d(t){t&&k(e)}}}function wa(r){let e,n=r[3]+"",t;return{c(){e=S("span"),t=j(n)},m(l,o){w(l,e,o),p(e,t)},p(l,o){o&2&&n!==(n=l[3]+"")&&le(t,n)},d(l){l&&k(e)}}}function ka(r){let e,n=r[3].toFixed(r[2])+"",t;return{c(){e=S("span"),t=j(n)},m(l,o){w(l,e,o),p(e,t)},p(l,o){o&6&&n!==(n=l[3].toFixed(l[2])+"")&&le(t,n)},d(l){l&&k(e)}}}function Ul(r){let e;function n(o,i){return o[2]>0?ka:wa}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),w(o,e,i)},p(o,i){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},d(o){o&&k(e),l.d(o)}}}function Sa(r){let e,n,t,l=Me(r[0]),o=[];for(let a=0;a<l.length;a+=1)o[a]=Dl(Rl(r,l,a));let i=Me(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Ul(Bl(r,i,a));return{c(){e=S("div");for(let a=0;a<o.length;a+=1)o[a].c();n=M(),t=S("div");for(let a=0;a<s.length;a+=1)s[a].c();ie(e,"display","flex"),ie(t,"display","flex"),ie(t,"justify-content","space-between")},m(a,f){w(a,e,f);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);w(a,n,f),w(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,[f]){if(f&1){l=Me(a[0]);let u;for(u=0;u<l.length;u+=1){const c=Rl(a,l,u);o[u]?o[u].p(c,f):(o[u]=Dl(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=l.length}if(f&6){i=Me(a[1]);let u;for(u=0;u<i.length;u+=1){const c=Bl(a,i,u);s[u]?s[u].p(c,f):(s[u]=Ul(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},i:Q,o:Q,d(a){a&&(k(e),k(n),k(t)),dt(o,a),dt(s,a)}}}function La(r,e,n){let{colorScale:t}=e,{limits:l}=e,{decimalPlaces:o=0}=e;return r.$$set=i=>{"colorScale"in i&&n(0,t=i.colorScale),"limits"in i&&n(1,l=i.limits),"decimalPlaces"in i&&n(2,o=i.decimalPlaces)},[t,l,o]}class yn extends ae{constructor(e){super(),fe(this,e,La,Sa,oe,{colorScale:0,limits:1,decimalPlaces:2})}}function gr(r,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function tt(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let _e;const Ji=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ji.decode();let Nn=null;function Un(){return(Nn===null||Nn.byteLength===0)&&(Nn=new Uint8Array(_e.memory.buffer)),Nn}function zt(r,e){return r=r>>>0,Ji.decode(Un().subarray(r,r+e))}const tn=new Array(128).fill(void 0);tn.push(void 0,null,!0,!1);let Hn=tn.length;function st(r){Hn===tn.length&&tn.push(tn.length+1);const e=Hn;return Hn=tn[e],tn[e]=r,e}function Ae(r){return tn[r]}function Ca(r){r<132||(tn[r]=Hn,Hn=r)}function kn(r){const e=Ae(r);return Ca(r),e}function Or(r){return r==null}let jn=null;function Ma(){return(jn===null||jn.byteLength===0)&&(jn=new Float64Array(_e.memory.buffer)),jn}let zn=null;function Ie(){return(zn===null||zn.byteLength===0)&&(zn=new Int32Array(_e.memory.buffer)),zn}let fn=0;const sr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ta=typeof sr.encodeInto=="function"?function(r,e){return sr.encodeInto(r,e)}:function(r,e){const n=sr.encode(r);return e.set(n),{read:r.length,written:n.length}};function lr(r,e,n){if(n===void 0){const s=sr.encode(r),a=e(s.length,1)>>>0;return Un().subarray(a,a+s.length).set(s),fn=s.length,a}let t=r.length,l=e(t,1)>>>0;const o=Un();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;o[l+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),l=n(l,t,t=i+r.length*3,1)>>>0;const s=Un().subarray(l+i,l+t),a=Ta(r,s);i+=a.written}return fn=i,l}function Xr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let o="[";l>0&&(o+=Xr(r[0]));for(let i=1;i<l;i++)o+=", "+Xr(r[i]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function Aa(r,e){const n=e(r.length*1,1)>>>0;return Un().set(r,n/1),fn=r.length,n}function Br(r,e){try{return r.apply(this,e)}catch(n){_e.__wbindgen_exn_store(st(n))}}class hr{static __wrap(e){e=e>>>0;const n=Object.create(hr.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();_e.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=_e.__wbindgen_add_to_stack_pointer(-16),i=Aa(e,_e.__wbindgen_malloc),s=fn;_e.jsroutesnapper_new(o,i,s);var n=Ie()[o/4+0],t=Ie()[o/4+1],l=Ie()[o/4+2];if(l)throw kn(t);return hr.__wrap(n)}finally{_e.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){_e.jsroutesnapper_setRouteConfig(this.__wbg_ptr,st(e))}setAreaMode(){_e.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const o=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_getConfig(o,this.__wbg_ptr);var t=Ie()[o/4+0],l=Ie()[o/4+1];return e=t,n=l,zt(t,l)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const t=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=Ie()[t/4+0],n=Ie()[t/4+1];let l;return e!==0&&(l=zt(e,n).slice(),_e.__wbindgen_free(e,n*1)),l}finally{_e.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const o=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var t=Ie()[o/4+0],l=Ie()[o/4+1];return e=t,n=l,zt(t,l)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,n,1)}}toggleSnapMode(){_e.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,t){return _e.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,t)!==0}onClick(){_e.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return _e.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return _e.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){_e.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_editExisting(l,this.__wbg_ptr,st(e));var n=Ie()[l/4+0],t=Ie()[l/4+1];if(t)throw kn(n)}finally{_e.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const o=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var t=Ie()[o/4+0],l=Ie()[o/4+1];return e=t,n=l,zt(t,l)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const o=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var t=Ie()[o/4+0],l=Ie()[o/4+1];return e=t,n=l,zt(t,l)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,t;try{const u=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,st(e));var l=Ie()[u/4+0],o=Ie()[u/4+1],i=Ie()[u/4+2],s=Ie()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,kn(i);return n=a,t=f,zt(a,f)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(n,t,1)}}addSnappedWaypoint(e,n){_e.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){_e.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,t;try{const u=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,st(e));var l=Ie()[u/4+0],o=Ie()[u/4+1],i=Ie()[u/4+2],s=Ie()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,kn(i);return n=a,t=f,zt(a,f)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(n,t,1)}}getExtraNodes(e,n){let t,l;try{const c=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,st(e),st(n));var o=Ie()[c/4+0],i=Ie()[c/4+1],s=Ie()[c/4+2],a=Ie()[c/4+3],f=o,u=i;if(a)throw f=0,u=0,kn(s);return t=f,l=u,zt(f,u)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(t,l,1)}}}async function Fa(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Pa(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,n){const t=zt(e,n);return st(t)},r.wbg.__wbindgen_object_drop_ref=function(e){kn(e)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(zt(e,n));return st(t)},r.wbg.__wbindgen_number_get=function(e,n){const t=Ae(n),l=typeof t=="number"?t:void 0;Ma()[e/8+1]=Or(l)?0:l,Ie()[e/4+0]=!Or(l)},r.wbg.__wbindgen_is_object=function(e){const n=Ae(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return Ae(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return Ae(e)in Ae(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=Ae(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Ae(e)==Ae(n)},r.wbg.__wbindgen_string_get=function(e,n){const t=Ae(n),l=typeof t=="string"?t:void 0;var o=Or(l)?0:lr(l,_e.__wbindgen_malloc,_e.__wbindgen_realloc),i=fn;Ie()[e/4+1]=i,Ie()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,n){const t=String(Ae(n)),l=lr(t,_e.__wbindgen_malloc,_e.__wbindgen_realloc),o=fn;Ie()[e/4+1]=o,Ie()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Ae(e);return st(n)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const t=Ae(e)[Ae(n)];return st(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return st(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Ae(n).stack,l=lr(t,_e.__wbindgen_malloc,_e.__wbindgen_realloc),o=fn;Ie()[e/4+1]=o,Ie()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,l;try{t=e,l=n,console.error(zt(e,n))}finally{_e.__wbindgen_free(t,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ae(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ae(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ae(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ae(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ae(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,n){const t=Ae(e)[n>>>0];return st(t)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ae(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ae(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const n=Ae(e).next;return st(n)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Br(function(e){const n=Ae(e).next();return st(n)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ae(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const n=Ae(e).value;return st(n)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return st(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Br(function(e,n){const t=Reflect.get(Ae(e),Ae(n));return st(t)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Br(function(e,n){const t=Ae(e).call(Ae(n));return st(t)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ae(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Ae(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Ae(e).buffer;return st(n)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Ae(e));return st(n)},r.wbg.__wbg_set_5cf90238115182c3=function(e,n,t){Ae(e).set(Ae(n),t>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ae(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Ae(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const t=Xr(Ae(n)),l=lr(t,_e.__wbindgen_malloc,_e.__wbindgen_realloc),o=fn;Ie()[e/4+1]=o,Ie()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,n){throw new Error(zt(e,n))},r.wbg.__wbindgen_memory=function(){const e=_e.memory;return st(e)},r}function Ea(r,e){return _e=r.exports,Zi.__wbindgen_wasm_module=e,jn=null,zn=null,Nn=null,_e}async function Zi(r){if(_e!==void 0)return _e;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Pa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Fa(await r,e);return Ea(n,t)}var vt=63710088e-1,dl={centimeters:vt*100,centimetres:vt*100,degrees:vt/111325,feet:vt*3.28084,inches:vt*39.37,kilometers:vt/1e3,kilometres:vt/1e3,meters:vt,metres:vt,miles:vt/1609.344,millimeters:vt*1e3,millimetres:vt*1e3,nauticalmiles:vt/1852,radians:1,yards:vt*1.0936},Ia={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/vt,yards:1.0936133},Vr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Rt(r,e,n){n===void 0&&(n={});var t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function Na(r,e,n){switch(r){case"Point":return Lt(e).geometry;case"LineString":return Ot(e).geometry;case"Polygon":return _l(e).geometry;case"MultiPoint":return Ki(e).geometry;case"MultiLineString":return Yi(e).geometry;case"MultiPolygon":return Xi(e).geometry;default:throw new Error(r+" is invalid")}}function Lt(r,e,n){if(n===void 0&&(n={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!br(r[0])||!br(r[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:r};return Rt(t,e,n)}function ja(r,e,n){return n===void 0&&(n={}),$n(r.map(function(t){return Lt(t,e)}),n)}function _l(r,e,n){n===void 0&&(n={});for(var t=0,l=r;t<l.length;t++){var o=l[t];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return Rt(s,e,n)}function za(r,e,n){return n===void 0&&(n={}),$n(r.map(function(t){return _l(t,e)}),n)}function Ot(r,e,n){if(n===void 0&&(n={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:r};return Rt(t,e,n)}function Oa(r,e,n){return n===void 0&&(n={}),$n(r.map(function(t){return Ot(t,e)}),n)}function $n(r,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function Yi(r,e,n){n===void 0&&(n={});var t={type:"MultiLineString",coordinates:r};return Rt(t,e,n)}function Ki(r,e,n){n===void 0&&(n={});var t={type:"MultiPoint",coordinates:r};return Rt(t,e,n)}function Xi(r,e,n){n===void 0&&(n={});var t={type:"MultiPolygon",coordinates:r};return Rt(t,e,n)}function Ba(r,e,n){n===void 0&&(n={});var t={type:"GeometryCollection",geometries:r};return Rt(t,e,n)}function Ra(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(r*n)/n}function ml(r,e){e===void 0&&(e="kilometers");var n=dl[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Sr(r,e){e===void 0&&(e="kilometers");var n=dl[e];if(!n)throw new Error(e+" units is invalid");return r/n}function Da(r,e){return Zn(Sr(r,e))}function Ua(r){var e=r%360;return e<0&&(e+=360),e}function Zn(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Bt(r){var e=r%360;return e*Math.PI/180}function Ha(r,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("length must be a positive number");return ml(Sr(r,e),n)}function Ga(r,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("area must be a positive number");var t=Vr[e];if(!t)throw new Error("invalid original units");var l=Vr[n];if(!l)throw new Error("invalid final units");return r/t*l}function br(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function pl(r){return!!r&&r.constructor===Object}function Wa(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!br(e))throw new Error("bbox must only contain numbers")})}function qa(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Ja=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Vr,bearingToAzimuth:Ua,convertArea:Ga,convertLength:Ha,degreesToRadians:Bt,earthRadius:vt,factors:dl,feature:Rt,featureCollection:$n,geometry:Na,geometryCollection:Ba,isNumber:br,isObject:pl,lengthToDegrees:Da,lengthToRadians:Sr,lineString:Ot,lineStrings:Oa,multiLineString:Yi,multiPoint:Ki,multiPolygon:Xi,point:Lt,points:ja,polygon:_l,polygons:za,radiansToDegrees:Zn,radiansToLength:ml,round:Ra,unitsFactors:Ia,validateBBox:Wa,validateId:qa},Symbol.toStringTag,{value:"Module"}));function Yn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Pn(r,e,n){n===void 0&&(n={});var t=Yn(r),l=Yn(e),o=Bt(l[1]-t[1]),i=Bt(l[0]-t[0]),s=Bt(t[1]),a=Bt(l[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return ml(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function Vn(r,e,n){if(r!==null)for(var t,l,o,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",y=m?r.features.length:1,h=0;h<y;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var v=0;v<s;v++){var b=0,L=0;if(i=_?f.geometries[v]:f,i!==null){a=i.coordinates;var I=i.type;switch(u=n&&(I==="Polygon"||I==="MultiPolygon")?1:0,I){case null:break;case"Point":if(e(a,c,h,b,L)===!1)return!1;c++,b++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,b,L)===!1)return!1;c++,I==="MultiPoint"&&b++}I==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(l=0;l<a[t].length-u;l++){if(e(a[t][l],c,h,b,L)===!1)return!1;c++}I==="MultiLineString"&&b++,I==="Polygon"&&L++}I==="Polygon"&&b++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(L=0,l=0;l<a[t].length;l++){for(o=0;o<a[t][l].length-u;o++){if(e(a[t][l][o],c,h,b,L)===!1)return!1;c++}L++}b++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(Vn(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Za(r,e,n,t){var l=n;return Vn(r,function(o,i,s,a,f){i===0&&n===void 0?l=o:l=e(l,o,i,s,a,f)},t),l}function Vi(r,e){var n;switch(r.type){case"FeatureCollection":for(n=0;n<r.features.length&&e(r.features[n].properties,n)!==!1;n++);break;case"Feature":e(r.properties,0);break}}function Ya(r,e,n){var t=n;return Vi(r,function(l,o){o===0&&n===void 0?t=l:t=e(t,l,o)}),t}function $r(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var n=0;n<r.features.length&&e(r.features[n],n)!==!1;n++);}function Ka(r,e,n){var t=n;return $r(r,function(l,o){o===0&&n===void 0?t=l:t=e(t,l,o)}),t}function Xa(r){var e=[];return Vn(r,function(n){e.push(n)}),e}function gl(r,e){var n,t,l,o,i,s,a,f,u,c,_=0,d=r.type==="FeatureCollection",m=r.type==="Feature",g=d?r.features.length:1;for(n=0;n<g;n++){for(s=d?r.features[n].geometry:m?r.geometry:r,f=d?r.features[n].properties:m?r.properties:{},u=d?r.features[n].bbox:m?r.bbox:void 0,c=d?r.features[n].id:m?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,l=0;l<i;l++){if(o=a?s.geometries[l]:s,o===null){if(e(null,_,f,u,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,_,f,u,c)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<o.geometries.length;t++)if(e(o.geometries[t],_,f,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function Va(r,e,n){var t=n;return gl(r,function(l,o,i,s,a){o===0&&n===void 0?t=l:t=e(t,l,o,i,s,a)}),t}function An(r,e){gl(r,function(n,t,l,o,i){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Rt(n,l,{bbox:o,id:i}),t,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var f=0;f<n.coordinates.length;f++){var u=n.coordinates[f],c={type:a,coordinates:u};if(e(Rt(c,l),t,f)===!1)return!1}})}function Qa(r,e,n){var t=n;return An(r,function(l,o,i){o===0&&i===0&&n===void 0?t=l:t=e(t,l,o,i)}),t}function Qi(r,e){An(r,function(n,t,l){var o=0;if(n.geometry){var i=n.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,f=0,u=0;if(Vn(n,function(c,_,d,m,g){if(s===void 0||t>a||m>f||g>u){s=c,a=t,f=m,u=g,o=0;return}var y=Ot([s,c],n.properties);if(e(y,t,l,g,o)===!1)return!1;o++,s=c})===!1)return!1}}})}function xa(r,e,n){var t=n,l=!1;return Qi(r,function(o,i,s,a,f){l===!1&&n===void 0?t=o:t=e(t,o,i,s,a,f),l=!0}),t}function xi(r,e){if(!r)throw new Error("geojson is required");An(r,function(n,t,l){if(n.geometry!==null){var o=n.geometry.type,i=n.geometry.coordinates;switch(o){case"LineString":if(e(n,t,l,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Ot(i[s],n.properties),t,l,s)===!1)return!1;break}}})}function ef(r,e,n){var t=n;return xi(r,function(l,o,i,s){o===0&&n===void 0?t=l:t=e(t,l,o,i,s)}),t}function tf(r,e){if(e=e||{},!pl(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,l=e.geometryIndex||0,o=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=a.length+o-1),Ot([a[o],a[o+1]],i,e);case"Polygon":return l<0&&(l=a.length+l),o<0&&(o=a[l].length+o-1),Ot([a[l][o],a[l][o+1]],i,e);case"MultiLineString":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o-1),Ot([a[t][o],a[t][o+1]],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l),o<0&&(o=a[t][l].length-o-1),Ot([a[t][l][o],a[t][l][o+1]],i,e)}throw new Error("geojson is invalid")}function nf(r,e){if(e=e||{},!pl(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,l=e.geometryIndex||0,o=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return Lt(a,i,e);case"MultiPoint":return t<0&&(t=a.length+t),Lt(a[t],i,e);case"LineString":return o<0&&(o=a.length+o),Lt(a[o],i,e);case"Polygon":return l<0&&(l=a.length+l),o<0&&(o=a[l].length+o),Lt(a[l][o],i,e);case"MultiLineString":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),Lt(a[t][o],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l),o<0&&(o=a[t][l].length-o),Lt(a[t][l][o],i,e)}throw new Error("geojson is invalid")}const rf=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Xa,coordEach:Vn,coordReduce:Za,featureEach:$r,featureReduce:Ka,findPoint:nf,findSegment:tf,flattenEach:An,flattenReduce:Qa,geomEach:gl,geomReduce:Va,lineEach:xi,lineReduce:ef,propEach:Vi,propReduce:Ya,segmentEach:Qi,segmentReduce:xa},Symbol.toStringTag,{value:"Module"}));function es(r,e,n){if(n===void 0&&(n={}),n.final===!0)return lf(r,e);var t=Yn(r),l=Yn(e),o=Bt(t[0]),i=Bt(l[0]),s=Bt(t[1]),a=Bt(l[1]),f=Math.sin(i-o)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-o);return Zn(Math.atan2(f,u))}function lf(r,e){var n=es(e,r);return n=(n+180)%360,n}function Hl(r,e,n,t){t===void 0&&(t={});var l=Yn(r),o=Bt(l[0]),i=Bt(l[1]),s=Bt(n),a=Sr(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=Zn(u),_=Zn(f);return Lt([c,_],t.properties)}function Gl(r){if(!r)throw new Error("geojson is required");var e=[];return An(r,function(n){of(n,e)}),$n(e)}function of(r,e){var n=[],t=r.geometry;if(t!==null){switch(t.type){case"Polygon":n=Mn(t);break;case"LineString":n=[Mn(t)]}n.forEach(function(l){var o=sf(l,r.properties);o.forEach(function(i){i.id=e.length,e.push(i)})})}}function sf(r,e){var n=[];return r.reduce(function(t,l){var o=Ot([t,l],e);return o.bbox=af(t,l),n.push(o),l}),n}function af(r,e){var n=r[0],t=r[1],l=e[0],o=e[1],i=n<l?n:l,s=t<o?t:o,a=n>l?n:l,f=t>o?t:o;return[i,s,a,f]}var hl={exports:{}},ts={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(Js,function(){function n(v,b,L,I,E){(function P(O,B,D,R,z){for(;R>D;){if(R-D>600){var U=R-D+1,H=B-D+1,Y=Math.log(U),Z=.5*Math.exp(2*Y/3),se=.5*Math.sqrt(Y*Z*(U-Z)/U)*(H-U/2<0?-1:1),G=Math.max(D,Math.floor(B-H*Z/U+se)),we=Math.min(R,Math.floor(B+(U-H)*Z/U+se));P(O,B,G,we,z)}var x=O[B],ue=D,ve=R;for(t(O,D,B),z(O[R],x)>0&&t(O,D,R);ue<ve;){for(t(O,ue,ve),ue++,ve--;z(O[ue],x)<0;)ue++;for(;z(O[ve],x)>0;)ve--}z(O[D],x)===0?t(O,D,ve):t(O,++ve,R),ve<=B&&(D=ve+1),B<=ve&&(R=ve-1)}})(v,b,L||0,I||v.length-1,E||l)}function t(v,b,L){var I=v[b];v[b]=v[L],v[L]=I}function l(v,b){return v<b?-1:v>b?1:0}var o=function(v){v===void 0&&(v=9),this._maxEntries=Math.max(4,v),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(v,b,L){if(!L)return b.indexOf(v);for(var I=0;I<b.length;I++)if(L(v,b[I]))return I;return-1}function s(v,b){a(v,0,v.children.length,b,v)}function a(v,b,L,I,E){E||(E=y(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var P=b;P<L;P++){var O=v.children[P];f(E,v.leaf?I(O):O)}return E}function f(v,b){return v.minX=Math.min(v.minX,b.minX),v.minY=Math.min(v.minY,b.minY),v.maxX=Math.max(v.maxX,b.maxX),v.maxY=Math.max(v.maxY,b.maxY),v}function u(v,b){return v.minX-b.minX}function c(v,b){return v.minY-b.minY}function _(v){return(v.maxX-v.minX)*(v.maxY-v.minY)}function d(v){return v.maxX-v.minX+(v.maxY-v.minY)}function m(v,b){return v.minX<=b.minX&&v.minY<=b.minY&&b.maxX<=v.maxX&&b.maxY<=v.maxY}function g(v,b){return b.minX<=v.maxX&&b.minY<=v.maxY&&b.maxX>=v.minX&&b.maxY>=v.minY}function y(v){return{children:v,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function h(v,b,L,I,E){for(var P=[b,L];P.length;)if(!((L=P.pop())-(b=P.pop())<=I)){var O=b+Math.ceil((L-b)/I/2)*I;n(v,O,b,L,E),P.push(b,O,O,L)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(v){var b=this.data,L=[];if(!g(v,b))return L;for(var I=this.toBBox,E=[];b;){for(var P=0;P<b.children.length;P++){var O=b.children[P],B=b.leaf?I(O):O;g(v,B)&&(b.leaf?L.push(O):m(v,B)?this._all(O,L):E.push(O))}b=E.pop()}return L},o.prototype.collides=function(v){var b=this.data;if(!g(v,b))return!1;for(var L=[];b;){for(var I=0;I<b.children.length;I++){var E=b.children[I],P=b.leaf?this.toBBox(E):E;if(g(v,P)){if(b.leaf||m(v,P))return!0;L.push(E)}}b=L.pop()}return!1},o.prototype.load=function(v){if(!v||!v.length)return this;if(v.length<this._minEntries){for(var b=0;b<v.length;b++)this.insert(v[b]);return this}var L=this._build(v.slice(),0,v.length-1,0);if(this.data.children.length)if(this.data.height===L.height)this._splitRoot(this.data,L);else{if(this.data.height<L.height){var I=this.data;this.data=L,L=I}this._insert(L,this.data.height-L.height-1,!0)}else this.data=L;return this},o.prototype.insert=function(v){return v&&this._insert(v,this.data.height-1),this},o.prototype.clear=function(){return this.data=y([]),this},o.prototype.remove=function(v,b){if(!v)return this;for(var L,I,E,P=this.data,O=this.toBBox(v),B=[],D=[];P||B.length;){if(P||(P=B.pop(),I=B[B.length-1],L=D.pop(),E=!0),P.leaf){var R=i(v,P.children,b);if(R!==-1)return P.children.splice(R,1),B.push(P),this._condense(B),this}E||P.leaf||!m(P,O)?I?(L++,P=I.children[L],E=!1):P=null:(B.push(P),D.push(L),L=0,I=P,P=P.children[0])}return this},o.prototype.toBBox=function(v){return v},o.prototype.compareMinX=function(v,b){return v.minX-b.minX},o.prototype.compareMinY=function(v,b){return v.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(v){return this.data=v,this},o.prototype._all=function(v,b){for(var L=[];v;)v.leaf?b.push.apply(b,v.children):L.push.apply(L,v.children),v=L.pop();return b},o.prototype._build=function(v,b,L,I){var E,P=L-b+1,O=this._maxEntries;if(P<=O)return s(E=y(v.slice(b,L+1)),this.toBBox),E;I||(I=Math.ceil(Math.log(P)/Math.log(O)),O=Math.ceil(P/Math.pow(O,I-1))),(E=y([])).leaf=!1,E.height=I;var B=Math.ceil(P/O),D=B*Math.ceil(Math.sqrt(O));h(v,b,L,D,this.compareMinX);for(var R=b;R<=L;R+=D){var z=Math.min(R+D-1,L);h(v,R,z,B,this.compareMinY);for(var U=R;U<=z;U+=B){var H=Math.min(U+B-1,z);E.children.push(this._build(v,U,H,I-1))}}return s(E,this.toBBox),E},o.prototype._chooseSubtree=function(v,b,L,I){for(;I.push(b),!b.leaf&&I.length-1!==L;){for(var E=1/0,P=1/0,O=void 0,B=0;B<b.children.length;B++){var D=b.children[B],R=_(D),z=(U=v,H=D,(Math.max(H.maxX,U.maxX)-Math.min(H.minX,U.minX))*(Math.max(H.maxY,U.maxY)-Math.min(H.minY,U.minY))-R);z<P?(P=z,E=R<E?R:E,O=D):z===P&&R<E&&(E=R,O=D)}b=O||b.children[0]}var U,H;return b},o.prototype._insert=function(v,b,L){var I=L?v:this.toBBox(v),E=[],P=this._chooseSubtree(I,this.data,b,E);for(P.children.push(v),f(P,I);b>=0&&E[b].children.length>this._maxEntries;)this._split(E,b),b--;this._adjustParentBBoxes(I,E,b)},o.prototype._split=function(v,b){var L=v[b],I=L.children.length,E=this._minEntries;this._chooseSplitAxis(L,E,I);var P=this._chooseSplitIndex(L,E,I),O=y(L.children.splice(P,L.children.length-P));O.height=L.height,O.leaf=L.leaf,s(L,this.toBBox),s(O,this.toBBox),b?v[b-1].children.push(O):this._splitRoot(L,O)},o.prototype._splitRoot=function(v,b){this.data=y([v,b]),this.data.height=v.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(v,b,L){for(var I,E,P,O,B,D,R,z=1/0,U=1/0,H=b;H<=L-b;H++){var Y=a(v,0,H,this.toBBox),Z=a(v,H,L,this.toBBox),se=(E=Y,P=Z,O=void 0,B=void 0,D=void 0,R=void 0,O=Math.max(E.minX,P.minX),B=Math.max(E.minY,P.minY),D=Math.min(E.maxX,P.maxX),R=Math.min(E.maxY,P.maxY),Math.max(0,D-O)*Math.max(0,R-B)),G=_(Y)+_(Z);se<z?(z=se,I=H,U=G<U?G:U):se===z&&G<U&&(U=G,I=H)}return I||L-b},o.prototype._chooseSplitAxis=function(v,b,L){var I=v.leaf?this.compareMinX:u,E=v.leaf?this.compareMinY:c;this._allDistMargin(v,b,L,I)<this._allDistMargin(v,b,L,E)&&v.children.sort(I)},o.prototype._allDistMargin=function(v,b,L,I){v.children.sort(I);for(var E=this.toBBox,P=a(v,0,b,E),O=a(v,L-b,L,E),B=d(P)+d(O),D=b;D<L-b;D++){var R=v.children[D];f(P,v.leaf?E(R):R),B+=d(P)}for(var z=L-b-1;z>=b;z--){var U=v.children[z];f(O,v.leaf?E(U):U),B+=d(O)}return B},o.prototype._adjustParentBBoxes=function(v,b,L){for(var I=L;I>=0;I--)f(b[I],v)},o.prototype._condense=function(v){for(var b=v.length-1,L=void 0;b>=0;b--)v[b].children.length===0?b>0?(L=v[b-1].children).splice(L.indexOf(v[b]),1):this.clear():s(v[b],this.toBBox)},o})})(ts);var ff=ts.exports;const uf=il(Ja),cf=il(rf);function ns(r,e,n){if(r!==null)for(var t,l,o,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",y=m?r.features.length:1,h=0;h<y;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var v=0;v<s;v++){var b=0,L=0;if(i=_?f.geometries[v]:f,i!==null){a=i.coordinates;var I=i.type;switch(u=n&&(I==="Polygon"||I==="MultiPolygon")?1:0,I){case null:break;case"Point":if(e(a,c,h,b,L)===!1)return!1;c++,b++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,b,L)===!1)return!1;c++,I==="MultiPoint"&&b++}I==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(l=0;l<a[t].length-u;l++){if(e(a[t][l],c,h,b,L)===!1)return!1;c++}I==="MultiLineString"&&b++,I==="Polygon"&&L++}I==="Polygon"&&b++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(L=0,l=0;l<a[t].length;l++){for(o=0;o<a[t][l].length-u;o++){if(e(a[t][l][o],c,h,b,L)===!1)return!1;c++}L++}b++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(ns(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function rs(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return ns(r,t=>{n[0]>t[0]&&(n[0]=t[0]),n[1]>t[1]&&(n[1]=t[1]),n[2]<t[0]&&(n[2]=t[0]),n[3]<t[1]&&(n[3]=t[1])}),n}var df=rs;const _f=Object.freeze(Object.defineProperty({__proto__:null,bbox:rs,default:df},Symbol.toStringTag,{value:"Module"})),mf=il(_f);var Kt=ff,ls=uf,os=cf,wn=mf.default,pf=os.featureEach;os.coordEach;ls.polygon;var Wl=ls.featureCollection;function is(r){var e=new Kt(r);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:wn(n),Kt.prototype.insert.call(this,n)},e.load=function(n){var t=[];return Array.isArray(n)?n.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:wn(l),t.push(l)}):pf(n,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:wn(l),t.push(l)}),Kt.prototype.load.call(this,t)},e.remove=function(n,t){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:wn(n),Kt.prototype.remove.call(this,n,t)},e.clear=function(){return Kt.prototype.clear.call(this)},e.search=function(n){var t=Kt.prototype.search.call(this,this.toBBox(n));return Wl(t)},e.collides=function(n){return Kt.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=Kt.prototype.all.call(this);return Wl(n)},e.toJSON=function(){return Kt.prototype.toJSON.call(this)},e.fromJSON=function(n){return Kt.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var t;if(n.bbox)t=n.bbox;else if(Array.isArray(n)&&n.length===4)t=n;else if(Array.isArray(n)&&n.length===6)t=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")t=wn(n);else if(n.type==="FeatureCollection")t=wn(n);else throw new Error("invalid geojson");return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},e}hl.exports=is;hl.exports.default=is;var gf=hl.exports;const hf=Zs(gf);function bf(r,e){var n={},t=[];if(r.type==="LineString"&&(r=Rt(r)),e.type==="LineString"&&(e=Rt(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=ql(r,e);return l&&t.push(l),$n(t)}var o=hf();return o.load(Gl(e)),$r(Gl(r),function(i){$r(o.search(i),function(s){var a=ql(i,s);if(a){var f=Mn(a).join(",");n[f]||(n[f]=!0,t.push(a))}})}),$n(t)}function ql(r,e){var n=Mn(r),t=Mn(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(t.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=n[0][0],o=n[0][1],i=n[1][0],s=n[1][1],a=t[0][0],f=t[0][1],u=t[1][0],c=t[1][1],_=(c-f)*(i-l)-(u-a)*(s-o),d=(u-a)*(o-f)-(c-f)*(l-a),m=(i-l)*(o-f)-(s-o)*(l-a);if(_===0)return null;var g=d/_,y=m/_;if(g>=0&&g<=1&&y>=0&&y<=1){var h=l+g*(i-l),v=o+g*(s-o);return Lt([h,v])}return null}function $f(r,e,n){n===void 0&&(n={});var t=Lt([1/0,1/0],{dist:1/0}),l=0;return An(r,function(o){for(var i=Mn(o),s=0;s<i.length-1;s++){var a=Lt(i[s]);a.properties.dist=Pn(e,a,n);var f=Lt(i[s+1]);f.properties.dist=Pn(e,f,n);var u=Pn(a,f,n),c=Math.max(a.properties.dist,f.properties.dist),_=es(a,f),d=Hl(e,c,_+90,n),m=Hl(e,c,_-90,n),g=bf(Ot([d.geometry.coordinates,m.geometry.coordinates]),Ot([a.geometry.coordinates,f.geometry.coordinates])),y=null;g.features.length>0&&(y=g.features[0],y.properties.dist=Pn(e,y,n),y.properties.location=l+Pn(a,y,n)),a.properties.dist<t.properties.dist&&(t=a,t.properties.index=s,t.properties.location=l),f.properties.dist<t.properties.dist&&(t=f,t.properties.index=s+1,t.properties.location=l+u),y&&y.properties.dist<t.properties.dist&&(t=y,t.properties.index=s),l+=u}}),t}const vf=30;class yf{constructor(e,n,t,l,o){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-vf,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new hr(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=l,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}function Jl(r){let e,n;return e=new kr({props:{$$slots:{default:[wf,({dialog:t})=>({3:t}),({dialog:t})=>t?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function wf(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;function g(){return r[1](r[3])}return{c(){e=S("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",n=M(),t=S("p"),t.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=M(),o=S("p"),o.textContent="To use this tool, you need to:",i=M(),s=S("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,a=M(),f=S("p"),f.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,u=M(),c=S("center"),_=S("button"),_.textContent="Start!"},m(y,h){w(y,e,h),w(y,n,h),w(y,t,h),w(y,l,h),w(y,o,h),w(y,i,h),w(y,s,h),w(y,a,h),w(y,f,h),w(y,u,h),w(y,c,h),p(c,_),d||(m=X(_,"click",g),d=!0)},p(y,h){r=y},d(y){y&&(k(e),k(n),k(t),k(l),k(o),k(i),k(s),k(a),k(f),k(u),k(c)),d=!1,m()}}}function kf(r){let e,n,t=r[0]&&Jl(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&$(t,1)):(t=Jl(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function Sf(r,e,n){let t;return V(r,dr,i=>n(0,t=i)),[t,i=>tt(i).close(),()=>ne(dr,t=!1,t)]}class Lf extends ae{constructor(e){super(),fe(this,e,Sf,kf,oe,{})}}function Cf(r){let e;const n=r[16].default,t=Re(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&De(t,n,l,l[24],e?He(n,l[24],o,null):Ue(l[24]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function Mf(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Cf]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Ri({props:o}),ze.push(()=>nt(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],rt(()=>n=!1)),e.$set(a)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function Tf(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=sl("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:L=!0}=e;function I(z){v=z,n(0,v)}function E(z){je.call(this,r,z)}function P(z){je.call(this,r,z)}function O(z){je.call(this,r,z)}function B(z){je.call(this,r,z)}function D(z){je.call(this,r,z)}function R(z){je.call(this,r,z)}return r.$$set=z=>{"id"in z&&n(1,o=z.id),"source"in z&&n(2,i=z.source),"sourceLayer"in z&&n(3,s=z.sourceLayer),"beforeId"in z&&n(4,a=z.beforeId),"beforeLayerType"in z&&n(5,f=z.beforeLayerType),"paint"in z&&n(6,u=z.paint),"layout"in z&&n(7,c=z.layout),"filter"in z&&n(8,_=z.filter),"applyToClusters"in z&&n(9,d=z.applyToClusters),"minzoom"in z&&n(10,m=z.minzoom),"maxzoom"in z&&n(11,g=z.maxzoom),"hoverCursor"in z&&n(12,y=z.hoverCursor),"manageHoverState"in z&&n(13,h=z.manageHoverState),"hovered"in z&&n(0,v=z.hovered),"eventsIfTopMost"in z&&n(14,b=z.eventsIfTopMost),"interactive"in z&&n(15,L=z.interactive),"$$scope"in z&&n(24,l=z.$$scope)},[v,o,i,s,a,f,u,c,_,d,m,g,y,h,b,L,t,I,E,P,O,B,D,R,l]}let _n=class extends ae{constructor(e){super(),fe(this,e,Tf,Mf,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Af(r){let e,n;const t=r[7].default,l=Re(t,r,r[6],null);return{c(){e=S("div"),l&&l.c(),N(e,"class",r[1]),gt(e,"maplibregl-ctrl",r[0])},m(o,i){w(o,e,i),l&&l.m(e,null),r[8](e),n=!0},p(o,[i]){l&&l.p&&(!n||i&64)&&De(l,t,o,o[6],n?He(t,o[6],i,null):Ue(o[6]),null),(!n||i&2)&&N(e,"class",o[1]),(!n||i&3)&&gt(e,"maplibregl-ctrl",o[0])},i(o){n||($(l,o),n=!0)},o(o){C(l,o),n=!1},d(o){o&&k(e),l&&l.d(o),r[8](null)}}}function Ff(r,e,n){let t,{$$slots:l={},$$scope:o}=e,{defaultStyling:i=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:f}=al();V(r,f,d=>n(5,t=d));let u,c={onAdd(){return u},onRemove(){var d;(d=u==null?void 0:u.parentNode)==null||d.removeChild(u)}};Tt(()=>{t==null||t.removeControl(c)});function _(d){ze[d?"unshift":"push"](()=>{u=d,n(2,u)})}return r.$$set=d=>{"defaultStyling"in d&&n(0,i=d.defaultStyling),"position"in d&&n(4,s=d.position),"class"in d&&n(1,a=d.class),"$$scope"in d&&n(6,o=d.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&t&&u&&t.addControl(c,s)},[i,a,u,f,s,t,o,l,_]}class Pf extends ae{constructor(e){super(),fe(this,e,Ff,Af,oe,{defaultStyling:0,position:4,class:1})}}function Ef(r,e,n){let t;const l=dn();let{layer:o=void 0}=e;const{map:i}=al();V(r,i,u=>n(2,t=u));function s(u){l(u.type,{...u,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Tt(()=>{if(t)if(o)for(const u of a)t.off(u,o,s);else for(const u of f)t.off(u,s)}),r.$$set=u=>{"layer"in u&&n(1,o=u.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&t)if(o)for(const u of a)t.on(u,o,s);else for(const u of f)t.on(u,s)},[i,o,t]}class ss extends ae{constructor(e){super(),fe(this,e,Ef,null,oe,{layer:1})}}const If=r=>({marker:r&8}),Zl=r=>({marker:r[3]});function Nf(r){let e,n,t,l,o,i,s;const a=r[19].default,f=Re(a,r,r[18],Zl);return{c(){e=S("div"),f&&f.c(),N(e,"tabindex",n=r[1]?0:void 0),N(e,"role",t=r[1]?"button":void 0),ie(e,"z-index",r[2])},m(u,c){w(u,e,c),f&&f.m(e,null),o=!0,i||(s=[yl(r[7].call(null,e)),yl(l=jf.call(null,e,r[0])),X(e,"click",zr(r[20])),X(e,"dblclick",zr(r[21])),X(e,"contextmenu",zr(Di(r[22]))),X(e,"mouseenter",r[23]),X(e,"mouseleave",r[24]),X(e,"mousemove",r[25]),X(e,"keydown",r[8])],i=!0)},p(u,[c]){f&&f.p&&(!o||c&262152)&&De(f,a,u,u[18],o?He(a,u[18],c,If):Ue(u[18]),Zl),(!o||c&2&&n!==(n=u[1]?0:void 0))&&N(e,"tabindex",n),(!o||c&2&&t!==(t=u[1]?"button":void 0))&&N(e,"role",t),l&&Wr(l.update)&&c&1&&l.update.call(null,u[0]),c&4&&ie(e,"z-index",u[2])},i(u){o||($(f,u),o=!0)},o(u){C(f,u),o=!1},d(u){u&&k(e),f&&f.d(u),i=!1,ft(s)}}}function jf(r,e){const n=r.className;function t(l){l?r.className=`${n} ${l}`:r.className=n}return t(e),{update:t}}function zf(r,e,n){let t,l,o,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:f}=e,{class:u=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:m=null}=e,{offset:g=void 0}=e,{zIndex:y=void 0}=e,{rotation:h=0}=e,{opacity:v=1}=e;const b=dn(),{map:L,layerEvent:I,self:E,markerClickManager:P}=Ys();V(r,L,G=>n(27,o=G)),V(r,I,G=>n(26,t=G)),V(r,E,G=>n(3,l=G));function O(G){ne(E,l=new Xt.Marker({element:G,rotation:h,draggable:d,offset:g,opacity:v.toString()}).setLngLat(f).addTo(o),l),n(11,a=l);const we=()=>R("dragstart"),x=()=>{B(),R("drag")},ue=()=>{B(),R("dragend")};return d&&(l.on("dragstart",we),l.on("drag",x),l.on("dragend",ue)),{destroy(){d&&(l==null||l.off("dragstart",we),l==null||l.off("drag",x),l==null||l.off("dragend",ue)),n(11,a=void 0),l==null||l.remove()}}}function B(){let G=l==null?void 0:l.getLngLat();G&&(Array.isArray(f)?n(10,f=[G.lng,G.lat]):f&&"lon"in f?n(10,f={lon:G.lng,lat:G.lat}):n(10,f=G))}function D(G){G.key===" "&&(G.preventDefault(),G.stopPropagation(),R("click"))}function R(G){if(!c)return;let we=l==null?void 0:l.getLngLat();if(!we)return;const x=[we.lng,we.lat];let ue={map:o,marker:l,lngLat:x,features:[{type:"Feature",properties:(m==null?void 0:m.properties)??{},geometry:{type:"Point",coordinates:x}}]};(G==="click"||G==="contextmenu")&&P.handleClick(ue),ne(I,t={...ue,layerType:"marker",type:G},t),b(G,ue)}const z=()=>R("click"),U=()=>R("dblclick"),H=()=>{R("contextmenu")},Y=()=>{R("mouseenter")},Z=()=>{R("mouseleave")},se=()=>R("mousemove");return r.$$set=G=>{"marker"in G&&n(11,a=G.marker),"lngLat"in G&&n(10,f=G.lngLat),"class"in G&&n(0,u=G.class),"interactive"in G&&n(12,c=G.interactive),"asButton"in G&&n(1,_=G.asButton),"draggable"in G&&n(13,d=G.draggable),"feature"in G&&n(14,m=G.feature),"offset"in G&&n(15,g=G.offset),"zIndex"in G&&n(2,y=G.zIndex),"rotation"in G&&n(16,h=G.rotation),"opacity"in G&&n(17,v=G.opacity),"$$scope"in G&&n(18,s=G.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(f)),r.$$.dirty&32776&&(l==null||l.setOffset(g??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(h)),r.$$.dirty&131080&&(l==null||l.setOpacity(v.toString()))},[u,_,y,l,L,I,E,O,D,R,f,a,c,d,m,g,h,v,s,i,z,U,H,Y,Z,se]}class Lr extends ae{constructor(e){super(),fe(this,e,zf,Nf,oe,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Of=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Yl=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function Kl(r){var l;let e,n,t=(((l=r[4])==null?void 0:l.length)||r[3]instanceof Xt.Marker)&&Xl(r);return{c(){e=S("div"),t&&t.c()},m(o,i){w(o,e,i),t&&t.m(e,null),r[32](e),n=!0},p(o,i){var s;(s=o[4])!=null&&s.length||o[3]instanceof Xt.Marker?t?(t.p(o,i),i[0]&24&&$(t,1)):(t=Xl(o),t.c(),$(t,1),t.m(e,null)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(o){n||($(t),n=!0)},o(o){C(t),n=!1},d(o){o&&k(e),t&&t.d(),r[32](null)}}}function Xl(r){let e;const n=r[30].default,t=Re(n,r,r[29],Yl);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o[0]&536870933)&&De(t,n,l,l[29],e?He(n,l[29],o,Of):Ue(l[29]),Yl)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function Bf(r){let e,n,t=r[9].default&&Kl(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,o){l[9].default?t?(t.p(l,o),o[0]&512&&$(t,1)):(t=Kl(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function Rf(r,e,n){let t,l,o,i,s,a,{$$slots:f={},$$scope:u}=e;const c=Ks(f);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:m=!1}=e,{closeOnMove:g=!1}=e,{openOn:y="click"}=e,{openIfTopMost:h=!0}=e,{focusAfterOpen:v=!0}=e,{anchor:b=void 0}=e,{offset:L=void 0}=e,{popupClass:I=void 0}=e,{maxWidth:E=void 0}=e,{lngLat:P=void 0}=e,{html:O=void 0}=e,{open:B=!1}=e;const D=dn(),{map:R,popupTarget:z,layerEvent:U,layer:H,eventTopMost:Y,markerClickManager:Z}=al();V(r,R,W=>n(2,o=W)),V(r,z,W=>n(3,s=W)),V(r,U,W=>n(28,i=W)),V(r,H,W=>n(35,a=W));const se=["click","dblclick","contextmenu"];let G,we=!1,x;function ue(){if(!G)return;let W=G.getElement();!W||W===x||(x=W,y==="hover"&&(x.style.pointerEvents="none"),x.addEventListener("mouseenter",()=>{n(24,we=!0)},{passive:!0}),x.addEventListener("mouseleave",()=>{n(24,we=!1)},{passive:!0}),x.addEventListener("click",()=>{m&&n(0,B=!1)},{passive:!0}))}yr(()=>{if(o)return o.on("click",pe),o.on("contextmenu",pe),Z.add(ee),typeof s=="string"&&(o.on("click",s,Te),o.on("dblclick",s,Te),o.on("contextmenu",s,Te),o.on("mousemove",s,K),o.on("mouseleave",s,ke),o.on("touchstart",s,Je),o.on("touchend",s,Ne)),()=>{o!=null&&o.loaded()&&(G==null||G.remove(),o.off("click",pe),o.off("contextmenu",pe),Z.remove(ee),s instanceof Xt.Marker?s.getPopup()===G&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Te),o.off("dblclick",s,Te),o.off("contextmenu",s,Te),o.off("mousemove",s,K),o.off("mouseleave",s,ke),o.off("touchstart",s,Je),o.off("touchend",s,Ne)))}});function ve(W){return h?!("marker"in W)&&!Xs(W)&&Y(W)!==a:!1}let ce=null,Fe="normal";function Ze(W){"layerType"in W&&W.layerType==="deckgl"?(n(10,P=W.coordinate),n(4,ce=W.object?[W.object]:null)):(n(10,P=W.lngLat),n(4,ce=W.features??[]))}function Te(W){W.type!==y||ve(W)||(Ze(W),setTimeout(()=>n(0,B=!0)))}let re=null;function Je(W){re=W.point}function Ne(W){if(!re||y!=="hover")return;let _t=re.dist(W.point);re=null,_t<3&&(n(10,P=W.lngLat),n(4,ce=W.features??[]),G.isOpen()?n(25,Fe="justOpened"):(n(25,Fe="opening"),n(0,B=!0)))}function ke(W){y!=="hover"||re||Fe!=="normal"||(n(0,B=!1),n(4,ce=null))}function K(W){if(!(y!=="hover"||re||Fe!=="normal")){if(ve(W)){n(0,B=!1),n(4,ce=null);return}n(0,B=!0),n(4,ce=W.features??[]),n(10,P=W.lngLat)}}function pe(W){if(Fe==="justOpened"){n(25,Fe="normal");return}if(!d)return;let _t=[x,s instanceof Xt.Marker?s==null?void 0:s.getElement():null];B&&G.isOpen()&&!_t.some(Be=>Be==null?void 0:Be.contains(W.originalEvent.target))&&(W.type==="contextmenu"&&y==="contextmenu"||W.type!=="contextmenu")&&n(0,B=!1)}function ee(W){d&&B&&G.isOpen()&&W.marker!==s&&n(0,B=!1)}Tt(()=>{o&&(G!=null&&G.isOpen())&&G.remove()});let ge;const $e=()=>n(0,B=!1);function Se(W){ze[W?"unshift":"push"](()=>{ge=W,n(1,ge)})}return r.$$set=W=>{"closeButton"in W&&n(11,_=W.closeButton),"closeOnClickOutside"in W&&n(12,d=W.closeOnClickOutside),"closeOnClickInside"in W&&n(13,m=W.closeOnClickInside),"closeOnMove"in W&&n(14,g=W.closeOnMove),"openOn"in W&&n(15,y=W.openOn),"openIfTopMost"in W&&n(16,h=W.openIfTopMost),"focusAfterOpen"in W&&n(17,v=W.focusAfterOpen),"anchor"in W&&n(18,b=W.anchor),"offset"in W&&n(19,L=W.offset),"popupClass"in W&&n(20,I=W.popupClass),"maxWidth"in W&&n(21,E=W.maxWidth),"lngLat"in W&&n(10,P=W.lngLat),"html"in W&&n(22,O=W.html),"open"in W&&n(0,B=W.open),"$$scope"in W&&n(29,u=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(27,t=_??(!d&&!m)),r.$$.dirty[0]&146685952&&(G||(n(23,G=new Xt.Popup({closeButton:t,closeOnClick:!1,closeOnMove:g,focusAfterOpen:v,maxWidth:E,className:I,anchor:b,offset:L})),x=G.getElement(),G.on("open",()=>{n(0,B=!0),ue(),D("open",G)}),G.on("close",()=>{n(0,B=!1),D("close",G)}),G.on("hover",()=>{D("hover",G)}))),r.$$.dirty[0]&8421384&&G&&s instanceof Xt.Marker&&(y==="click"?s.setPopup(G):s.getPopup()===G&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&se.includes(y)&&(i==null?void 0:i.type)===y&&(Te(i),ne(U,i=null,i)),r.$$.dirty[0]&268468224&&n(26,l=y==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&y==="hover"&&U&&(l&&i&&Ze(i),n(0,B=(l||we)??!1)),r.$$.dirty[0]&12582914&&(ge?G.setDOMContent(ge):O&&G.setHTML(O)),r.$$.dirty[0]&8389632&&P&&G.setLngLat(P),r.$$.dirty[0]&41943045&&o){let W=G.isOpen();B&&!W?(G.addTo(o),Fe==="opening"&&n(25,Fe="justOpened")):!B&&W&&G.remove()}},[B,ge,o,s,ce,R,z,U,H,c,P,_,d,m,g,y,h,v,b,L,I,E,O,G,we,Fe,l,t,i,u,f,$e,Se]}class Df extends ae{constructor(e){super(),fe(this,e,Rf,Bf,oe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Uf(r){let e;const n=r[16].default,t=Re(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&De(t,n,l,l[24],e?He(n,l[24],o,null):Ue(l[24]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function Hf(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Uf]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Ri({props:o}),ze.push(()=>nt(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],rt(()=>n=!1)),e.$set(a)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function Gf(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=sl("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:L=!0}=e;function I(z){v=z,n(0,v)}function E(z){je.call(this,r,z)}function P(z){je.call(this,r,z)}function O(z){je.call(this,r,z)}function B(z){je.call(this,r,z)}function D(z){je.call(this,r,z)}function R(z){je.call(this,r,z)}return r.$$set=z=>{"id"in z&&n(1,o=z.id),"source"in z&&n(2,i=z.source),"sourceLayer"in z&&n(3,s=z.sourceLayer),"beforeId"in z&&n(4,a=z.beforeId),"beforeLayerType"in z&&n(5,f=z.beforeLayerType),"paint"in z&&n(6,u=z.paint),"layout"in z&&n(7,c=z.layout),"filter"in z&&n(8,_=z.filter),"applyToClusters"in z&&n(9,d=z.applyToClusters),"minzoom"in z&&n(10,m=z.minzoom),"maxzoom"in z&&n(11,g=z.maxzoom),"hoverCursor"in z&&n(12,y=z.hoverCursor),"manageHoverState"in z&&n(13,h=z.manageHoverState),"hovered"in z&&n(0,v=z.hovered),"eventsIfTopMost"in z&&n(14,b=z.eventsIfTopMost),"interactive"in z&&n(15,L=z.interactive),"$$scope"in z&&n(24,l=z.$$scope)},[v,o,i,s,a,f,u,c,_,d,m,g,y,h,b,L,t,I,E,P,O,B,D,R,l]}class vr extends ae{constructor(e){super(),fe(this,e,Gf,Hf,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Vl(r){let e=r[0],n,t,l=Ql(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),w(o,n,i),t=!0},p(o,i){i&1&&oe(e,e=o[0])?(he(),C(l,1,1,Q),be(),l=Ql(o),l.c(),$(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||($(l),t=!0)},o(o){C(l),t=!1},d(o){o&&k(n),l.d(o)}}}function Ql(r){let e;const n=r[15].default,t=Re(n,r,r[14],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16384)&&De(t,n,l,l[14],e?He(n,l[14],o,null):Ue(l[14]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function Wf(r){let e,n,t=r[0]&&Vl(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&$(t,1)):(t=Vl(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function qf(r,e,n){let t,l,{$$slots:o={},$$scope:i}=e,{id:s=sl("vector")}=e,{url:a=null}=e,{tiles:f=null}=e,{promoteId:u=null}=e,{bounds:c=null}=e,{scheme:_=null}=e,{attribution:d=null}=e,{minzoom:m=null}=e,{maxzoom:g=null}=e,{volatile:y=null}=e;if(a&&a.includes("pmtiles://")&&!Xt.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let L=new ea;Xt.addProtocol("pmtiles",L.tile)}const{map:h,self:v}=Vs();V(r,h,L=>n(13,l=L)),V(r,v,L=>n(0,t=L));let b;return Tt(()=>{t&&l&&(Qs(h,t,b),ne(v,t=null,t),b=void 0)}),r.$$set=L=>{"id"in L&&n(3,s=L.id),"url"in L&&n(4,a=L.url),"tiles"in L&&n(5,f=L.tiles),"promoteId"in L&&n(6,u=L.promoteId),"bounds"in L&&n(7,c=L.bounds),"scheme"in L&&n(8,_=L.scheme),"attribution"in L&&n(9,d=L.attribution),"minzoom"in L&&n(10,m=L.minzoom),"maxzoom"in L&&n(11,g=L.maxzoom),"volatile"in L&&n(12,y=L.volatile),"$$scope"in L&&n(14,i=L.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&l&&t!==s&&(ne(v,t=s,t),xs(l,t,_r({type:"vector",url:a,tiles:f,promoteId:u,bounds:c,scheme:_,attribution:d,minzoom:m,maxzoom:g,volatile:y}),L=>l&&L===t,()=>{t&&(b=l==null?void 0:l.getSource(t))})),r.$$.dirty&8200&&(l==null||l.on("style.load",()=>{b=l==null?void 0:l.getSource(s)}))},[t,h,v,s,a,f,u,c,_,d,m,g,y,l,i,o]}class Cr extends ae{constructor(e){super(),fe(this,e,qf,Wf,oe,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const Jf="/ltn/assets/layers-03647595.svg";function Zf(r){let e,n,t,l,o,i,s,a,f;return{c(){e=S("label"),n=j(`Basemap:
  `),t=S("select"),l=S("option"),l.textContent="MapTiler Dataviz",o=S("option"),o.textContent="MapTiler Streets",i=S("option"),i.textContent="MapTiler Satellite",s=S("option"),s.textContent="OS Open Zoomstack",l.__value="dataviz",qe(l,l.__value),o.__value="streets-v2",qe(o,o.__value),i.__value="hybrid",qe(i,i.__value),s.__value="uk-openzoomstack-light",qe(s,s.__value),r[0]===void 0&&sn(()=>r[1].call(t))},m(u,c){w(u,e,c),p(e,n),p(e,t),p(t,l),p(t,o),p(t,i),p(t,s),wt(t,r[0],!0),a||(f=X(t,"change",r[1]),a=!0)},p(u,[c]){c&1&&wt(t,u[0])},i:Q,o:Q,d(u){u&&k(e),a=!1,f()}}}function Yf(r,e,n){let t;V(r,qr,o=>n(0,t=o));function l(){t=an(this),qr.set(t)}return[t,l]}class Kf extends ae{constructor(e){super(),fe(this,e,Yf,Zf,oe,{})}}let ar=Mt(!0);function Xf(r){let e,n;return e=new $t({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.layout={visibility:t[0]?"none":"visible"}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Vf(r){let e,n;return e=new Ve({props:{data:r[1],$$slots:{default:[Xf]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&5&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Qf(r,e,n){let t;return V(r,ar,o=>n(0,t=o)),[t,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class xf extends ae{constructor(e){super(),fe(this,e,Qf,Vf,oe,{})}}function eu(r){let e,n;return e=new Lr({props:{lngLat:r[0],$$slots:{default:[nu]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.lngLat=t[0]),l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function tu(r){let e,n,t;function l(i){r[3](i)}let o={draggable:!0,$$slots:{default:[ru]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new Lr({props:o}),ze.push(()=>nt(e,"lngLat",l)),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.lngLat=i[0],rt(()=>n=!1)),e.$set(a)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function nu(r){let e,n;const t=r[2].default,l=Re(t,r,r[4],null);return{c(){e=S("span"),l&&l.c(),N(e,"class","dot svelte-1gcxp27")},m(o,i){w(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i&16)&&De(l,t,o,o[4],n?He(t,o[4],i,null):Ue(o[4]),null)},i(o){n||($(l,o),n=!0)},o(o){C(l,o),n=!1},d(o){o&&k(e),l&&l.d(o)}}}function ru(r){let e,n;const t=r[2].default,l=Re(t,r,r[4],null);return{c(){e=S("span"),l&&l.c(),N(e,"class","dot svelte-1gcxp27")},m(o,i){w(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i&16)&&De(l,t,o,o[4],n?He(t,o[4],i,null):Ue(o[4]),null)},i(o){n||($(l,o),n=!0)},o(o){C(l,o),n=!1},d(o){o&&k(e),l&&l.d(o)}}}function lu(r){let e,n,t,l;const o=[tu,eu],i=[];function s(a,f){return a[1]?0:1}return e=s(r),n=i[e]=o[e](r),{c(){n.c(),t=Ye()},m(a,f){i[e].m(a,f),w(a,t,f),l=!0},p(a,[f]){let u=e;e=s(a),e===u?i[e].p(a,f):(he(),C(i[u],1,1,()=>{i[u]=null}),be(),n=i[e],n?n.p(a,f):(n=i[e]=o[e](a),n.c()),$(n,1),n.m(t.parentNode,t))},i(a){l||($(n),l=!0)},o(a){C(n),l=!1},d(a){a&&k(t),i[e].d(a)}}}function ou(r,e,n){let{$$slots:t={},$$scope:l}=e,{lngLat:o}=e,{draggable:i=!1}=e;function s(a){o=a,n(0,o)}return r.$$set=a=>{"lngLat"in a&&n(0,o=a.lngLat),"draggable"in a&&n(1,i=a.draggable),"$$scope"in a&&n(4,l=a.$$scope)},[o,i,t,s,l]}class vn extends ae{constructor(e){super(),fe(this,e,ou,lu,oe,{lngLat:0,draggable:1})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const iu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},xl=iu;function eo(r,e,n){const t=r.slice();return t[11]=e[n][0],t[12]=e[n][1],t}function Rr(r){let e,n=[r[12]],t={};for(let l=0;l<n.length;l+=1)t=me(t,n[l]);return{c(){e=qt(r[11]),mr(e,t)},m(l,o){w(l,e,o)},p(l,o){mr(e,t=Oe(n,[o&32&&l[12]]))},d(l){l&&k(e)}}}function to(r){let e=r[11],n,t=r[11]&&Rr(r);return{c(){t&&t.c(),n=Ye()},m(l,o){t&&t.m(l,o),w(l,n,o)},p(l,o){l[11]?e?oe(e,l[11])?(t.d(1),t=Rr(l),e=l[11],t.c(),t.m(n.parentNode,n)):t.p(l,o):(t=Rr(l),e=l[11],t.c(),t.m(n.parentNode,n)):e&&(t.d(1),t=null,e=l[11])},d(l){l&&k(n),t&&t.d(l)}}}function su(r){let e,n,t,l,o,i=Me(r[5]),s=[];for(let _=0;_<i.length;_+=1)s[_]=to(eo(r,i,_));const a=r[10].default,f=Re(a,r,r[9],null);let u=[xl,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":t=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:l=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],c={};for(let _=0;_<u.length;_+=1)c=me(c,u[_]);return{c(){e=qt("svg");for(let _=0;_<s.length;_+=1)s[_].c();n=Ye(),f&&f.c(),mr(e,c)},m(_,d){w(_,e,d);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null);p(e,n),f&&f.m(e,null),o=!0},p(_,[d]){if(d&32){i=Me(_[5]);let m;for(m=0;m<i.length;m+=1){const g=eo(_,i,m);s[m]?s[m].p(g,d):(s[m]=to(g),s[m].c(),s[m].m(e,n))}for(;m<s.length;m+=1)s[m].d(1);s.length=i.length}f&&f.p&&(!o||d&512)&&De(f,a,_,_[9],o?He(a,_[9],d,null):Ue(_[9]),null),mr(e,c=Oe(u,[xl,d&128&&_[7],(!o||d&4)&&{width:_[2]},(!o||d&4)&&{height:_[2]},(!o||d&2)&&{stroke:_[1]},(!o||d&28&&t!==(t=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":t},(!o||d&257&&l!==(l=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:l}]))},i(_){o||($(f,_),o=!0)},o(_){C(f,_),o=!1},d(_){_&&k(e),dt(s,_),f&&f.d(_)}}}function au(r,e,n){const t=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let l=wl(e,t),{$$slots:o={},$$scope:i}=e,{name:s=void 0}=e,{color:a="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:c=!1}=e,{iconNode:_=[]}=e;const d=(...m)=>m.filter((g,y,h)=>!!g&&h.indexOf(g)===y).join(" ");return r.$$set=m=>{n(8,e=me(me({},e),Vt(m))),n(7,l=wl(e,t)),"name"in m&&n(0,s=m.name),"color"in m&&n(1,a=m.color),"size"in m&&n(2,f=m.size),"strokeWidth"in m&&n(3,u=m.strokeWidth),"absoluteStrokeWidth"in m&&n(4,c=m.absoluteStrokeWidth),"iconNode"in m&&n(5,_=m.iconNode),"$$scope"in m&&n(9,i=m.$$scope)},e=Vt(e),[s,a,f,u,c,_,d,l,e,i,o]}class fu extends ae{constructor(e){super(),fe(this,e,au,su,oe,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Mr=fu;function uu(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function cu(r){let e,n;const t=[{name:"circle-help"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[uu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new Mr({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&wr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function du(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=i=>{n(1,e=me(me({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class _u extends ae{constructor(e){super(),fe(this,e,du,cu,oe,{})}}const mu=_u;function pu(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function gu(r){let e,n;const t=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[pu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new Mr({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&wr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function hu(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=i=>{n(1,e=me(me({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class bu extends ae{constructor(e){super(),fe(this,e,hu,gu,oe,{})}}const $u=bu;function vu(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function yu(r){let e,n;const t=[{name:"pencil"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[vu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new Mr({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&wr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function wu(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=i=>{n(1,e=me(me({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class ku extends ae{constructor(e){super(),fe(this,e,wu,yu,oe,{})}}const bl=ku;function Su(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function Lu(r){let e,n;const t=[{name:"trash-2"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[Su]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new Mr({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&wr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Cu(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=i=>{n(1,e=me(me({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class Mu extends ae{constructor(e){super(),fe(this,e,Cu,Lu,oe,{})}}const as=Mu;function no(r){let e,n;return e=new kr({props:{$$slots:{default:[Tu]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Tu(r){let e,n,t;const l=r[1].default,o=Re(l,r,r[4],null);return{c(){e=S("h2"),e.textContent="Help",n=M(),o&&o.c()},m(i,s){w(i,e,s),w(i,n,s),o&&o.m(i,s),t=!0},p(i,s){o&&o.p&&(!t||s&16)&&De(o,l,i,i[4],t?He(l,i[4],s,null):Ue(i[4]),null)},i(i){t||($(o,i),t=!0)},o(i){C(o,i),t=!1},d(i){i&&(k(e),k(n)),o&&o.d(i)}}}function Au(r){let e,n,t,l,o,i,s;n=new mu({props:{color:"black"}});let a=r[0]&&no(r);return{c(){e=S("button"),T(n.$$.fragment),t=M(),a&&a.c(),l=Ye(),N(e,"class","icon-btn help svelte-my65h"),N(e,"aria-label","Help")},m(f,u){w(f,e,u),A(n,e,null),w(f,t,u),a&&a.m(f,u),w(f,l,u),o=!0,i||(s=X(e,"click",r[2]),i=!0)},p(f,[u]){f[0]?a?(a.p(f,u),u&1&&$(a,1)):(a=no(f),a.c(),$(a,1),a.m(l.parentNode,l)):a&&(he(),C(a,1,1,()=>{a=null}),be())},i(f){o||($(n.$$.fragment,f),$(a),o=!0)},o(f){C(n.$$.fragment,f),C(a),o=!1},d(f){f&&(k(e),k(t),k(l)),F(n),a&&a.d(f),i=!1,s()}}}function Fu(r,e,n){let{$$slots:t={},$$scope:l}=e,o=!1;const i=()=>n(0,o=!0),s=()=>n(0,o=!1);return r.$$set=a=>{"$$scope"in a&&n(4,l=a.$$scope)},[o,t,i,s,l]}class Dt extends ae{constructor(e){super(),fe(this,e,Fu,Au,oe,{})}}function Pu(r){let e,n,t,l,o,i=r[0]+1+"",s,a,f=r[1].length+"",u,c,_,d,m,g,y;return{c(){e=S("div"),n=S("button"),t=j("Previous"),o=M(),s=j(i),a=j(" / "),u=j(f),c=M(),_=S("button"),d=j("Next"),n.disabled=l=r[0]==0,N(n,"data-tooltip","Left"),_.disabled=m=r[0]==r[1].length-1,N(_,"data-tooltip","Right"),ie(e,"display","flex"),ie(e,"justify-content","space-between"),ie(e,"align-items","center")},m(h,v){w(h,e,v),p(e,n),p(n,t),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c),p(e,_),p(_,d),g||(y=[X(window,"keydown",r[2]),X(n,"click",r[3]),X(_,"click",r[4])],g=!0)},p(h,[v]){v&1&&l!==(l=h[0]==0)&&(n.disabled=l),v&1&&i!==(i=h[0]+1+"")&&le(s,i),v&2&&f!==(f=h[1].length+"")&&le(u,f),v&3&&m!==(m=h[0]==h[1].length-1)&&(_.disabled=m)},i:Q,o:Q,d(h){h&&k(e),g=!1,ft(y)}}}function Eu(r,e,n){let t;V(r,Qt,f=>n(5,t=f));let{list:l}=e,{idx:o=0}=e;yr(()=>{t==null||t.keyboard.disable()}),Tt(()=>{t==null||t.keyboard.enable()});function i(f){f.key=="ArrowLeft"&&(f.stopPropagation(),s()),f.key=="ArrowRight"&&(f.stopPropagation(),a())}function s(){o!=0&&n(0,o--,o)}function a(){o!=l.length-1&&n(0,o++,o)}return r.$$set=f=>{"list"in f&&n(1,l=f.list),"idx"in f&&n(0,o=f.idx)},[o,l,i,s,a]}class Tr extends ae{constructor(e){super(),fe(this,e,Eu,Pu,oe,{list:1,idx:0})}}function Iu(r,e){let n=new Set(r.getStyle().layers.filter(t=>t.type=="line").map(t=>t.id));return e=="dataviz"?["Road network","Path"].filter(t=>n.has(t)):e=="hybrid"?["Path","Road","Tunnel"].filter(t=>n.has(t)):e=="streets-v2"?r.getStyle().layers.filter(t=>t["source-layer"]=="transportation"&&t.type=="line").map(t=>t.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(t=>t["source-layer"]=="roads"&&t.type=="line").map(t=>t.id):[]}const{window:Nu}=Ui;function ju(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g;return d=Hi(r[8][0]),{c(){e=S("button"),e.textContent="Stop StreetView",n=M(),t=S("fieldset"),l=S("legend"),l.textContent="Source:",o=M(),i=S("label"),s=S("input"),a=j(`
      Google Street View`),f=M(),u=S("label"),c=S("input"),_=j(`
      Bing Streetside`),N(e,"class","secondary"),N(s,"type","radio"),s.__value="google",qe(s,s.__value),N(c,"type","radio"),c.__value="bing",qe(c,c.__value),d.p(s,c)},m(y,h){w(y,e,h),w(y,n,h),w(y,t,h),p(t,l),p(t,o),p(t,i),p(i,s),s.checked=s.__value===r[0],p(i,a),p(t,f),p(t,u),p(u,c),c.checked=c.__value===r[0],p(u,_),m||(g=[X(e,"click",r[3]),X(s,"change",r[7]),X(c,"change",r[9])],m=!0)},p(y,h){h&1&&(s.checked=s.__value===y[0]),h&1&&(c.checked=c.__value===y[0])},d(y){y&&(k(e),k(n),k(t)),d.r(),m=!1,ft(g)}}}function zu(r){let e,n,t;return{c(){e=S("button"),e.textContent="StreetView",N(e,"class","secondary")},m(l,o){w(l,e,o),n||(t=X(e,"click",r[2]),n=!0)},p:Q,d(l){l&&k(e),n=!1,t()}}}function Ou(r){let e,n,t;function l(s,a){return s[1]?zu:ju}let o=l(r),i=o(r);return{c(){i.c(),e=Ye()},m(s,a){i.m(s,a),w(s,e,a),n||(t=X(Nu,"keydown",r[4]),n=!0)},p(s,[a]){o===(o=l(s))&&i?i.p(s,a):(i.d(1),i=o(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Q,o:Q,d(s){s&&k(e),i.d(s),n=!1,t()}}}function Bu(r,e,n){let t;V(r,ar,g=>n(1,t=g));let{map:l}=e,{maptilerBasemap:o}=e,i="google",s=[];function a(){ne(ar,t=!1,t),l.on("click",u),l.getCanvas().style.cursor="crosshair";for(let g of Iu(l,o))s.push([g,l.getPaintProperty(g,"line-color")]),l.setPaintProperty(g,"line-color","cyan")}function f(){ne(ar,t=!0,t),l.off("click",u),l.getCanvas().style.cursor="inherit";for(let[g,y]of s)l.setPaintProperty(g,"line-color",y);s=[]}Tt(f);function u(g){let y=g.lngLat.lng,h=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${h},${y}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${h}~${y}&style=x`,"_blank")}function c(g){!t&&g.key=="Escape"&&(g.stopPropagation(),f())}const _=[[]];function d(){i=this.__value,n(0,i)}function m(){i=this.__value,n(0,i)}return r.$$set=g=>{"map"in g&&n(5,l=g.map),"maptilerBasemap"in g&&n(6,o=g.maptilerBasemap)},[i,t,a,f,c,l,o,d,_,m]}class Ru extends ae{constructor(e){super(),fe(this,e,Bu,Ou,oe,{map:5,maptilerBasemap:6})}}function ye(r,e=!0){return{id:r,beforeId:Du(r),eventsIfTopMost:e}}function Du(r){let e=Gt(Qt);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let n,t=!1;for(let l=ro.length-1;l>=0;l--){let o=ro[l];if(o==r){t=!0;break}e.getLayer(o)&&(n=o)}if(!t)throw new Error(`Layer ID ${r} not defined in layerZorder`);return n}let Dr=r=>r,Ur=r=>r;const ro=[Dr(Ur("Background")),"neighbourhood-boundaries","neighbourhood-prioritization-simd","neighbourhood-prioritization-area",Dr("Ferry line"),"debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",Ur("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-gp-practices","context-hospitals","context-schools","context-railway-stations",Ur("Road labels"),Dr("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function on(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function un(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function cn(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),n=Math.round(r-e*60);return`${e}m${n}s`}function Qr(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function hn(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function lo(r){return r.reduce((e,n)=>e+n,0)}function oo(r){let e,n;return e=new Dt({props:{$$slots:{default:[Uu]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Uu(r){let e;return{c(){e=S("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
      according to OpenStreetMap.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Hu(r){let e,n;const t=[ye("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":on(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s=i&1?Oe(t,[t[0],t[1],t[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Gu(r){let e,n,t,l,o,i,s,a=r[0]&&oo(r);return l=new Cr({props:{url:`pmtiles://${Ct("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[Hu]},$$scope:{ctx:r}}}),{c(){e=S("button"),e.textContent="Bus routes",n=M(),a&&a.c(),t=M(),T(l.$$.fragment),N(e,"class","secondary")},m(f,u){w(f,e,u),w(f,n,u),a&&a.m(f,u),w(f,t,u),A(l,f,u),o=!0,i||(s=X(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&$(a,1):(a=oo(f),a.c(),$(a,1),a.m(t.parentNode,t)):a&&(he(),C(a,1,1,()=>{a=null}),be());const c={};u&5&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||($(a),$(l.$$.fragment,f),o=!0)},o(f){C(a),C(l.$$.fragment,f),o=!1},d(f){f&&(k(e),k(n),k(t)),a&&a.d(f),F(l,f),i=!1,s()}}}function Wu(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class qu extends ae{constructor(e){super(),fe(this,e,Wu,Gu,oe,{})}}function Ju(r){let e,n;return{c(){e=qt("svg"),n=qt("path"),N(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),N(e,"viewBox","0 0 14 14"),N(e,"width","13"),N(e,"height","13"),N(e,"class","svelte-en2qvf")},m(t,l){w(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&k(e)}}}class fs extends ae{constructor(e){super(),fe(this,e,null,Ju,oe,{})}}function Zu(r){let e,n;return{c(){e=qt("svg"),n=qt("path"),N(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),N(e,"viewBox","0 0 30 30"),N(e,"fill","none"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"class","svelte-d2loi5")},m(t,l){w(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&k(e)}}}class us extends ae{constructor(e){super(),fe(this,e,null,Zu,oe,{})}}function Yu(r){let e,n;return{c(){e=S("img"),Ke(e.src,n=r[3]+"area.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){w(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"area.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&k(e)}}}function Ku(r){let e,n;return{c(){e=S("img"),Ke(e.src,n=r[3]+"reverse.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){w(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"reverse.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&k(e)}}}function Xu(r){let e,n;return{c(){e=S("img"),Ke(e.src,n=r[3]+"poi.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){w(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"poi.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&k(e)}}}function Vu(r){let e,n;return{c(){e=S("img"),Ke(e.src,n=r[3]+"postal_code.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){w(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"postal_code.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&k(e)}}}function Qu(r){let e,n;return{c(){e=S("img"),Ke(e.src,n=r[3]+"street.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){w(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"street.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&k(e)}}}function xu(r){let e,n;return{c(){e=S("img"),Ke(e.src,n=r[3]+"road.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){w(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"road.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&k(e)}}}function ec(r){let e,n;return{c(){e=S("img"),Ke(e.src,n=r[3]+"housenumber.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){w(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"housenumber.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&k(e)}}}function tc(r){let e,n,t,l;return{c(){e=S("img"),Ke(e.src,n=r[5])||N(e,"src",n),N(e,"alt",r[4]),N(e,"class","svelte-ltkwvy")},m(o,i){w(o,e,i),t||(l=X(e,"error",r[14]),t=!0)},p(o,i){i&32&&!Ke(e.src,n=o[5])&&N(e,"src",n),i&16&&N(e,"alt",o[4])},d(o){o&&k(e),t=!1,l()}}}function io(r){let e,n;return{c(){e=S("span"),n=j(r[6]),N(e,"class","secondary svelte-ltkwvy")},m(t,l){w(t,e,l),p(e,n)},p(t,l){l&64&&le(n,t[6])},d(t){t&&k(e)}}}function nc(r){let e,n,t,l,o,i,s,a,f,u=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],m,g,y=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",h,v,b;function L(O,B){return B&1&&(n=null),B&1&&(t=null),B&1&&(l=null),B&1&&(o=null),O[5]?tc:O[0].address?ec:(n==null&&(n=!!O[0].id.startsWith("road.")),n?xu:(t==null&&(t=!!O[0].id.startsWith("address.")),t?Qu:(l==null&&(l=!!O[0].id.startsWith("postal_code.")),l?Vu:(o==null&&(o=!!O[0].id.startsWith("poi.")),o?Xu:O[7]?Ku:Yu))))}let I=L(r,-1),E=I(r),P=d&&io(r);return{c(){e=S("li"),E.c(),i=M(),s=S("span"),a=S("span"),f=S("span"),c=j(u),_=M(),P&&P.c(),m=M(),g=S("span"),h=j(y),N(f,"class","primary svelte-ltkwvy"),N(a,"class","svelte-ltkwvy"),N(g,"class","line2 svelte-ltkwvy"),N(s,"class","texts svelte-ltkwvy"),N(e,"tabindex","0"),N(e,"data-selected",r[1]),N(e,"class","svelte-ltkwvy"),gt(e,"selected",r[1])},m(O,B){w(O,e,B),E.m(e,null),p(e,i),p(e,s),p(s,a),p(a,f),p(f,c),p(a,_),P&&P.m(a,null),p(s,m),p(s,g),p(g,h),v||(b=[X(e,"mouseenter",r[12]),X(e,"focus",r[13])],v=!0)},p(O,[B]){I===(I=L(O,B))&&E?E.p(O,B):(E.d(1),E=I(O),E&&(E.c(),E.m(e,i))),B&1&&u!==(u=(O[7]?O[0].place_name:O[0].place_name.replace(/,.*/,""))+"")&&le(c,u),B&37&&(d=O[2]==="always"||O[2]!=="never"&&!O[0].address&&!O[0].id.startsWith("road.")&&!O[0].id.startsWith("address.")&&!O[0].id.startsWith("postal_code.")&&(!O[0].id.startsWith("poi.")||!O[5])&&!O[7]),d?P?P.p(O,B):(P=io(O),P.c(),P.m(a,null)):P&&(P.d(1),P=null),B&1&&y!==(y=(O[7]?"":O[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&le(h,y),B&2&&N(e,"data-selected",O[1]),B&2&&gt(e,"selected",O[1])},i:Q,o:Q,d(O){O&&k(e),E.d(),P&&P.d(),v=!1,ft(b)}}}function rc(r,e,n){var b;let t,l,{feature:o}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:f}=e;const u=(b=o.properties)==null?void 0:b.categories;let c,_,d=0,m=o.place_type[0]==="reverse";function g(){_&&a.add(_),n(10,d++,d)}function y(L){je.call(this,r,L)}function h(L){je.call(this,r,L)}const v=()=>g();return r.$$set=L=>{"feature"in L&&n(0,o=L.feature),"selected"in L&&n(1,i=L.selected),"showPlaceType"in L&&n(2,s=L.showPlaceType),"missingIconsCache"in L&&n(9,a=L.missingIconsCache),"iconsBaseUrl"in L&&n(3,f=L.iconsBaseUrl)},r.$$.update=()=>{var L,I,E,P;if(r.$$.dirty&3640)do n(11,t--,t),n(4,c=u==null?void 0:u[t]),n(5,_=c?f+c.replace(/ /g,"_")+".svg":void 0);while(t>-1&&(!_||a.has(_)));r.$$.dirty&1&&n(6,l=((I=(L=o.properties)==null?void 0:L.categories)==null?void 0:I.join(", "))??((P=(E=o.properties)==null?void 0:E.place_type_name)==null?void 0:P[0])??o.place_type[0])},n(11,t=(u==null?void 0:u.length)??0),[o,i,s,f,c,_,l,m,g,a,d,t,y,h,v]}class lc extends ae{constructor(e){super(),fe(this,e,rc,nc,oe,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function oc(r){let e;return{c(){e=S("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',N(e,"class","svelte-7cmwmc")},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}class ic extends ae{constructor(e){super(),fe(this,e,null,oc,oe,{})}}function sc(r){let e,n;return{c(){e=qt("svg"),n=qt("path"),N(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),N(e,"viewBox","0 0 60.006 21.412"),N(e,"width","14"),N(e,"height","20"),N(e,"class","svelte-en2qvf")},m(t,l){w(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&k(e)}}}class ac extends ae{constructor(e){super(),fe(this,e,null,sc,oe,{})}}function fc(r){let e,n,t;return{c(){e=qt("svg"),n=qt("circle"),t=qt("path"),N(n,"cx","4.789"),N(n,"cy","4.787"),N(n,"r","3.85"),N(n,"class","svelte-1aq105l"),N(t,"d","M12.063 12.063 7.635 7.635"),N(t,"class","svelte-1aq105l"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"width","13"),N(e,"height","13"),N(e,"viewBox","0 0 13 13"),N(e,"class","svelte-1aq105l")},m(l,o){w(l,e,o),p(e,n),p(e,t)},p:Q,i:Q,o:Q,d(l){l&&k(e)}}}class uc extends ae{constructor(e){super(),fe(this,e,null,fc,oe,{})}}function cc(r,e,n){const t=e[1],l=e[0],o=t-l;return r===t&&n?r:((r-l)%o+o)%o+l}function so(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let En;async function dc(r,e,n){const t=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(t&&(l.minZoom!=null&&l.minZoom>t[0]||l.maxZoom!=null&&l.maxZoom<t[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(En&&l.cachedLocationExpiry&&En.time+l.cachedLocationExpiry>Date.now()){if(!En.coords)break e;return En.coords}let o;try{return o=await new Promise((i,s)=>{n.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(f=>f.toFixed(6)).join(","))},a=>{s(a)},l)}),o}catch{}finally{l.cachedLocationExpiry&&(En={time:Date.now(),coords:o})}if(n.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(t&&l.type==="map-center")return t[1].toFixed(6)+","+t[2].toFixed(6)}}function ao(r,e,n){const t=r.slice();return t[84]=e[n],t[86]=n,t}function fo(r){let e,n;return e=new ic({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function uo(r){let e,n,t,l,o;return n=new ac({}),{c(){e=S("button"),T(n.$$.fragment),N(e,"type","button"),N(e,"title",r[9]),N(e,"class","svelte-bz0zu3"),gt(e,"active",r[0])},m(i,s){w(i,e,s),A(n,e,null),t=!0,l||(o=X(e,"click",r[69]),l=!0)},p(i,s){(!t||s[0]&512)&&N(e,"title",i[9]),(!t||s[0]&1)&&gt(e,"active",i[0])},i(i){t||($(n.$$.fragment,i),t=!0)},o(i){C(n.$$.fragment,i),t=!1},d(i){i&&k(e),F(n),l=!1,o()}}}function _c(r){let e,n=[],t=new Map,l,o,i,s=Me(r[14]);const a=f=>f[84].id+(f[84].address?","+f[84].address:"");for(let f=0;f<s.length;f+=1){let u=ao(r,s,f),c=a(u);t.set(c,n[f]=co(c,u))}return{c(){e=S("ul");for(let f=0;f<n.length;f+=1)n[f].c();N(e,"class","options svelte-bz0zu3")},m(f,u){w(f,e,u);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);l=!0,o||(i=[X(e,"mouseleave",r[73]),X(e,"blur",r[74])],o=!0)},p(f,u){u[0]&17880064&&(s=Me(f[14]),he(),n=na(n,u,a,1,f,s,t,e,ra,co,null,ao),be())},i(f){if(!l){for(let u=0;u<s.length;u+=1)$(n[u]);l=!0}},o(f){for(let u=0;u<n.length;u+=1)C(n[u]);l=!1},d(f){f&&k(e);for(let u=0;u<n.length;u+=1)n[u].d();o=!1,ft(i)}}}function mc(r){let e,n,t,l,o,i;return n=new us({}),{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("div"),o=j(r[7]),N(l,"class","svelte-bz0zu3"),N(e,"class","no-results svelte-bz0zu3")},m(s,a){w(s,e,a),A(n,e,null),p(e,t),p(e,l),p(l,o),i=!0},p(s,a){(!i||a[0]&128)&&le(o,s[7])},i(s){i||($(n.$$.fragment,s),i=!0)},o(s){C(n.$$.fragment,s),i=!1},d(s){s&&k(e),F(n)}}}function pc(r){let e="",n;return{c(){n=j(e)},m(t,l){w(t,n,l)},p:Q,i:Q,o:Q,d(t){t&&k(n)}}}function gc(r){let e,n,t,l,o,i,s,a,f,u,c;return n=new us({}),a=new fs({}),{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("div"),o=j(r[6]),i=M(),s=S("button"),T(a.$$.fragment),N(l,"class","svelte-bz0zu3"),N(s,"class","svelte-bz0zu3"),N(e,"class","error svelte-bz0zu3")},m(_,d){w(_,e,d),A(n,e,null),p(e,t),p(e,l),p(l,o),p(e,i),p(e,s),A(a,s,null),f=!0,u||(c=X(s,"click",r[70]),u=!0)},p(_,d){(!f||d[0]&64)&&le(o,_[6])},i(_){f||($(n.$$.fragment,_),$(a.$$.fragment,_),f=!0)},o(_){C(n.$$.fragment,_),C(a.$$.fragment,_),f=!1},d(_){_&&k(e),F(n),F(a),u=!1,c()}}}function co(r,e){let n,t,l;function o(){return e[71](e[86])}function i(){return e[72](e[84])}return t=new lc({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),t.$on("mouseenter",o),t.$on("focus",i),{key:r,first:null,c(){n=Ye(),T(t.$$.fragment),this.first=n},m(s,a){w(s,n,a),A(t,s,a),l=!0},p(s,a){e=s;const f={};a[0]&16384&&(f.feature=e[84]),a[0]&1024&&(f.showPlaceType=e[10]),a[0]&49152&&(f.selected=e[15]===e[86]),a[0]&4096&&(f.iconsBaseUrl=e[12]),t.$set(f)},i(s){l||($(t.$$.fragment,s),l=!0)},o(s){C(t.$$.fragment,s),l=!1},d(s){s&&k(n),F(t,s)}}}function hc(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,v,b,L,I,E=!1;o=new uc({}),c=new fs({});let P=r[19]&&fo(),O=r[5]==="button"&&uo(r);const B=r[61].default,D=Re(B,r,r[60],null),R=[gc,pc,mc,_c],z=[];function U(H,Y){var Z,se;return H[18]?0:H[16]?((Z=H[14])==null?void 0:Z.length)===0?2:H[16]&&((se=H[14])!=null&&se.length)?3:-1:1}return~(y=U(r))&&(h=z[y]=R[y](r)),{c(){e=M(),n=S("form"),t=S("div"),l=S("button"),T(o.$$.fragment),i=M(),s=S("input"),a=M(),f=S("div"),u=S("button"),T(c.$$.fragment),_=M(),P&&P.c(),d=M(),O&&O.c(),m=M(),D&&D.c(),g=M(),h&&h.c(),N(l,"class","search-button svelte-bz0zu3"),N(l,"type","button"),N(s,"placeholder",r[8]),N(s,"aria-label",r[8]),N(s,"class","svelte-bz0zu3"),N(u,"type","button"),N(u,"title",r[3]),N(u,"class","svelte-bz0zu3"),N(f,"class","clear-button-container svelte-bz0zu3"),gt(f,"displayable",r[1]!==""),N(t,"class","input-group svelte-bz0zu3"),N(n,"tabindex","0"),N(n,"class",v=kl(r[2])+" svelte-bz0zu3"),gt(n,"can-collapse",r[4]&&r[1]==="")},m(H,Y){w(H,e,Y),w(H,n,Y),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),r[63](s),qe(s,r[1]),p(t,a),p(t,f),p(f,u),A(c,u,null),p(f,_),P&&P.m(f,null),p(t,d),O&&O.m(t,null),p(t,m),D&&D.m(t,null),p(n,g),~y&&z[y].m(n,null),b=!0,L||(I=[X(l,"click",r[62]),X(s,"input",r[64]),X(s,"focus",r[65]),X(s,"blur",r[66]),X(s,"keydown",r[22]),X(s,"input",r[67]),X(u,"click",r[68]),X(n,"submit",Di(r[21]))],L=!0)},p(H,Y){(!b||Y[0]&256)&&N(s,"placeholder",H[8]),(!b||Y[0]&256)&&N(s,"aria-label",H[8]),Y[0]&2&&s.value!==H[1]&&qe(s,H[1]),(!b||Y[0]&8)&&N(u,"title",H[3]),H[19]?P?Y[0]&524288&&$(P,1):(P=fo(),P.c(),$(P,1),P.m(f,null)):P&&(he(),C(P,1,1,()=>{P=null}),be()),(!b||Y[0]&2)&&gt(f,"displayable",H[1]!==""),H[5]==="button"?O?(O.p(H,Y),Y[0]&32&&$(O,1)):(O=uo(H),O.c(),$(O,1),O.m(t,m)):O&&(he(),C(O,1,1,()=>{O=null}),be()),D&&D.p&&(!b||Y[1]&536870912)&&De(D,B,H,H[60],b?He(B,H[60],Y,null):Ue(H[60]),null);let Z=y;y=U(H),y===Z?~y&&z[y].p(H,Y):(h&&(he(),C(z[Z],1,1,()=>{z[Z]=null}),be()),~y?(h=z[y],h?h.p(H,Y):(h=z[y]=R[y](H),h.c()),$(h,1),h.m(n,null)):h=null),(!b||Y[0]&4&&v!==(v=kl(H[2])+" svelte-bz0zu3"))&&N(n,"class",v),(!b||Y[0]&22)&&gt(n,"can-collapse",H[4]&&H[1]==="")},i(H){b||($(E),$(o.$$.fragment,H),$(c.$$.fragment,H),$(P),$(O),$(D,H),$(h),b=!0)},o(H){C(E),C(o.$$.fragment,H),C(c.$$.fragment,H),C(P),C(O),C(D,H),C(h),b=!1},d(H){H&&(k(e),k(n)),F(o),r[63](null),F(c),P&&P.d(),O&&O.d(),D&&D.d(H),~y&&z[y].d(),L=!1,ft(I)}}}function bc(r,e,n){let t,l,{$$slots:o={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:f}=e,{bbox:u=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:m=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:y="never"}=e,{errorMessage:h="Something went wrong…"}=e,{filter:v=()=>!0}=e,{flyTo:b=!0}=e,{fuzzyMatch:L=!0}=e,{language:I=void 0}=e,{limit:E=void 0}=e,{mapController:P=void 0}=e,{minLength:O=2}=e,{noResultsMessage:B="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:D="Search"}=e,{proximity:R=[{type:"server-geolocation"}]}=e,{reverseActive:z=y==="always"}=e,{reverseButtonTitle:U="toggle reverse geocoding"}=e,{searchValue:H=""}=e,{pickedResultStyle:Y="full-geometry"}=e,{showPlaceType:Z="if-needed"}=e,{showResultsWhileTyping:se=!0}=e,{selectFirst:G=!0}=e,{flyToSelected:we=!1}=e,{markerOnSelected:x=!0}=e,{types:ue=void 0}=e,{exhaustiveReverseGeocoding:ve=!1}=e,{excludeTypes:ce=!1}=e,{zoom:Fe=s}=e,{apiUrl:Ze="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Te={}}=e,{iconsBaseUrl:re="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Je=()=>{}}=e;function Ne(){Be.focus()}function ke(){Be.blur()}function K(J,et=!0,ht=!1){n(1,H=J),et?(n(15,Ge=-1),Pt()):(Er(!ht,ht),setTimeout(()=>{Be.focus(),Be.select()}))}function pe(){n(14,$e=void 0),n(56,W=void 0),n(15,Ge=-1)}function ee(){n(55,Se=[]),n(56,W=void 0)}let ge=!1,$e,Se,W,_t="",Be,Ge=-1,kt,bt=[],Qe,xt,en,St;const nr=new Set,Ft=dn();Tt(()=>{P&&(P.setEventHandler(void 0),P.indicateReverse(!1),P.setSelectedMarker(-1),P.setFeatures(void 0,void 0,!1))});function Pt(J){if(xt&&(clearTimeout(xt),xt=void 0),Ge>-1&&$e)n(56,W=$e[Ge]),n(1,H=W.place_type[0]==="reverse"?W.place_name:W.place_name.replace(/,.*/,"")),n(18,kt=void 0),n(55,Se=void 0),n(15,Ge=-1);else if(H){const et=J||!ot(H);Pe(H,{exact:!0}).then(()=>{n(55,Se=$e),n(56,W=void 0),et&&it()}).catch(ht=>n(18,kt=ht))}}function ot(J){try{return ta(J,6)}catch{return!1}}async function Pe(J,{byId:et=!1,exact:ht=!1}={}){n(18,kt=void 0),Qe==null||Qe.abort();const Et=new AbortController;n(19,Qe=Et);try{const Ee=ot(J),mt=new URLSearchParams;if(I!==void 0&&mt.set("language",Array.isArray(I)?I.join(","):I??""),ue&&mt.set("types",ue.join(",")),ce&&mt.set("excludeTypes",String(ce)),u&&mt.set("bbox",u.map(rr=>rr.toFixed(6)).join(",")),m&&mt.set("country",Array.isArray(m)?m.join(","):m),!et&&!Ee){const rr=await dc(P,R,Et);rr&&mt.set("proximity",rr),(ht||!se)&&mt.set("autocomplete","false"),mt.set("fuzzyMatch",String(L))}E!==void 0&&(ve||!Ee||(ue==null?void 0:ue.length)===1)&&mt.set("limit",String(E)),mt.set("key",f),Je(mt);const Yt=Ze+"/"+encodeURIComponent(Ee?Ee.decimalLongitude+","+Ee.decimalLatitude:J)+".json?"+mt.toString();if(Yt===_t){et?(n(14,$e=void 0),n(56,W=bt[0])):n(14,$e=bt);return}_t=Yt;const Nr=await fetch(Yt,{signal:Et.signal,...Te});if(!Nr.ok)throw new Error(await Nr.text());const jr=await Nr.json();Ft("response",{url:Yt,featureCollection:jr}),et?(n(14,$e=void 0),n(56,W=jr.features[0]),bt=[W]):(n(14,$e=jr.features.filter(v)),Ee&&$e.unshift({type:"Feature",properties:{},id:"reverse_"+Ee.decimalLongitude+"_"+Ee.decimalLatitude,text:Ee.decimalLatitude+", "+Ee.decimalLongitude,place_name:Ee.decimalLatitude+", "+Ee.decimalLongitude,place_type:["reverse"],center:[Ee.decimalLongitude,Ee.decimalLatitude],bbox:[Ee.decimalLongitude,Ee.decimalLatitude,Ee.decimalLongitude,Ee.decimalLatitude],geometry:{type:"Point",coordinates:[Ee.decimalLongitude,Ee.decimalLatitude]}}),bt=$e,Ee&&Be.focus())}catch(Ee){if(Ee&&typeof Ee=="object"&&"name"in Ee&&Ee.name==="AbortError")return;throw Ee}finally{Et===Qe&&n(19,Qe=void 0)}}function it(){var Et;if(!(Se!=null&&Se.length)||!b)return;const J=[180,90,-180,-90],et=!Se.some(Ee=>!Ee.matching_text);let ht;for(const Ee of Se){const mt=Fn(Ee);if(ht=ht===void 0?mt:mt===void 0?ht:Math.max(ht,mt),et||!Ee.matching_text)for(const Yt of[0,1,2,3])J[Yt]=Math[Yt<2?"min":"max"](J[Yt],((Et=Ee.bbox)==null?void 0:Et[Yt])??Ee.center[Yt%2])}P&&Se.length>0&&(W&&J[0]===J[2]&&J[1]===J[3]?P.flyTo(W.center,Fn(W)):P.fitBounds(so(J),50,ht))}function Fn(J){var ht;if(!J.bbox||J.bbox[0]!==J.bbox[2]&&J.bbox[1]!==J.bbox[3])return;const et=J.id.replace(/\..*/,"");return(Array.isArray((ht=J.properties)==null?void 0:ht.categories)?J.properties.categories.reduce((Et,Ee)=>{const mt=Fe[et+"."+Ee];return Et===void 0?mt:mt===void 0?Et:Math.max(Et,mt)},void 0):void 0)??Fe[et]}function As(J){n(0,z=y==="always"),n(14,$e=void 0),n(56,W=void 0),n(15,Ge=-1),K(J[1].toFixed(6)+", "+cc(J[0],[-180,180],!0).toFixed(6),!1,!0)}function Fs(J){if(!$e)return;let et=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;et&&(Ge===(G?0:-1)&&et===-1&&n(15,Ge=$e.length),n(15,Ge+=et),Ge>=$e.length&&n(15,Ge=-1),Ge<0&&G&&n(15,Ge=0),J.preventDefault())}function Er(J=!0,et=!1){if(n(18,kt=void 0),se||et){if(xt&&clearTimeout(xt),H.length<O)return;const ht=H;xt=window.setTimeout(()=>{Pe(ht).catch(Et=>n(18,kt=Et))},J?g:0)}else n(14,$e=void 0),n(18,kt=void 0)}function Ir(J){n(56,W=J),n(1,H=J.place_name),n(15,Ge=-1)}const Ps=()=>Be.focus();function Es(J){ze[J?"unshift":"push"](()=>{Be=J,n(17,Be)})}function Is(){H=this.value,n(1,H),n(13,ge),n(28,_)}const Ns=()=>n(13,ge=!0),js=()=>n(13,ge=!1),zs=()=>Er(),Os=()=>{n(1,H=""),Be.focus()},Bs=()=>n(0,z=!z),Rs=()=>n(18,kt=void 0),Ds=J=>n(15,Ge=J),Us=J=>Ir(J),Hs=()=>{G||n(15,Ge=-1)},Gs=()=>{};return r.$$set=J=>{"class"in J&&n(2,a=J.class),"apiKey"in J&&n(26,f=J.apiKey),"bbox"in J&&n(27,u=J.bbox),"clearButtonTitle"in J&&n(3,c=J.clearButtonTitle),"clearOnBlur"in J&&n(28,_=J.clearOnBlur),"collapsed"in J&&n(4,d=J.collapsed),"country"in J&&n(29,m=J.country),"debounceSearch"in J&&n(30,g=J.debounceSearch),"enableReverse"in J&&n(5,y=J.enableReverse),"errorMessage"in J&&n(6,h=J.errorMessage),"filter"in J&&n(31,v=J.filter),"flyTo"in J&&n(32,b=J.flyTo),"fuzzyMatch"in J&&n(33,L=J.fuzzyMatch),"language"in J&&n(34,I=J.language),"limit"in J&&n(35,E=J.limit),"mapController"in J&&n(36,P=J.mapController),"minLength"in J&&n(37,O=J.minLength),"noResultsMessage"in J&&n(7,B=J.noResultsMessage),"placeholder"in J&&n(8,D=J.placeholder),"proximity"in J&&n(38,R=J.proximity),"reverseActive"in J&&n(0,z=J.reverseActive),"reverseButtonTitle"in J&&n(9,U=J.reverseButtonTitle),"searchValue"in J&&n(1,H=J.searchValue),"pickedResultStyle"in J&&n(39,Y=J.pickedResultStyle),"showPlaceType"in J&&n(10,Z=J.showPlaceType),"showResultsWhileTyping"in J&&n(40,se=J.showResultsWhileTyping),"selectFirst"in J&&n(11,G=J.selectFirst),"flyToSelected"in J&&n(41,we=J.flyToSelected),"markerOnSelected"in J&&n(42,x=J.markerOnSelected),"types"in J&&n(43,ue=J.types),"exhaustiveReverseGeocoding"in J&&n(44,ve=J.exhaustiveReverseGeocoding),"excludeTypes"in J&&n(45,ce=J.excludeTypes),"zoom"in J&&n(46,Fe=J.zoom),"apiUrl"in J&&n(47,Ze=J.apiUrl),"fetchParameters"in J&&n(48,Te=J.fetchParameters),"iconsBaseUrl"in J&&n(12,re=J.iconsBaseUrl),"adjustUrlQuery"in J&&n(49,Je=J.adjustUrlQuery),"$$scope"in J&&n(60,i=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&n(0,z=y==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{n(16,en=ge),_&&!ge&&n(1,H="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&H.length<O&&(n(56,W=void 0),n(14,$e=void 0),n(18,kt=void 0),n(55,Se=$e)),r.$$.dirty[1]&33554688&&Y!=="marker-only"&&W&&!W.address&&W.geometry.type==="Point"&&W.place_type[0]!=="reverse"&&Pe(W.id,{byId:!0}).catch(J=>n(18,kt=J)),r.$$.dirty[1]&100663330&&(P&&W&&W.id!==St&&b&&(!W.bbox||W.bbox[0]===W.bbox[2]&&W.bbox[1]===W.bbox[3]?P.flyTo(W.center,Fn(W)):P.fitBounds(so(W.bbox),50,Fn(W)),n(14,$e=void 0),n(55,Se=void 0),n(15,Ge=-1)),n(57,St=W==null?void 0:W.id)),r.$$.dirty[0]&18432&&G&&$e!=null&&$e.length&&n(15,Ge=0),r.$$.dirty[0]&2&&n(15,Ge=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Se!==$e&&n(55,Se=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&P&&P.setEventHandler(J=>{switch(J.type){case"mapClick":z&&As(J.coordinates);break;case"markerClick":{const et=$e==null?void 0:$e.find(ht=>ht.id===J.id);et&&Ir(et)}break;case"markerMouseEnter":Se&&n(15,Ge=en?($e==null?void 0:$e.findIndex(et=>et.id===J.id))??-1:-1);break;case"markerMouseLeave":Se&&n(15,Ge=-1);break}}),r.$$.dirty[0]&49152&&n(58,l=$e==null?void 0:$e[Ge]),r.$$.dirty[1]&134218786&&P&&l&&b&&we&&P.flyTo(l.center,Fn(l)),r.$$.dirty[1]&256&&n(59,t=Y==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(x||P==null||P.setFeatures(void 0,void 0,t)),r.$$.dirty[1]&419432480&&P&&x&&!Se&&(P.setFeatures(l?[l]:void 0,void 0,t),P.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&P&&P.setFeatures(Se,W,t),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Se&&P&&P.setSelectedMarker(Ge),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&P){const J=ot(H);P.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Ft("select",{feature:l}),r.$$.dirty[1]&33554432&&Ft("pick",{feature:W}),r.$$.dirty[0]&81920&&Ft("optionsvisibilitychange",{optionsVisible:en&&!!$e}),r.$$.dirty[0]&16384&&Ft("featureslisted",{features:$e}),r.$$.dirty[1]&16777216&&Ft("featuresmarked",{features:Se}),r.$$.dirty[0]&1&&Ft("reversetoggle",{reverse:z}),r.$$.dirty[0]&2&&Ft("querychange",{query:H}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&P&&P.indicateReverse(z)},[z,H,a,c,d,y,h,B,D,U,Z,G,re,ge,$e,Ge,en,Be,kt,Qe,nr,Pt,Fs,Er,Ir,s,f,u,_,m,g,v,b,L,I,E,P,O,R,Y,se,we,x,ue,ve,ce,Fe,Ze,Te,Je,Ne,ke,K,pe,ee,Se,W,St,l,t,i,o,Ps,Es,Is,Ns,js,zs,Os,Bs,Rs,Ds,Us,Hs,Gs]}class $c extends ae{constructor(e){super(),fe(this,e,bc,hc,oe,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function _o(r){let e,n,t;return n=new $c({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=S("div"),T(n.$$.fragment),N(e,"class","svelte-ixhnie")},m(l,o){w(l,e,o),A(n,e,null),t=!0},p(l,o){const i={};o&4&&(i.mapController=l[2]),o&1&&(i.apiKey=l[0]),o&2&&(i.country=l[1]),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function vc(r){let e,n,t=r[2]&&_o(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,[o]){l[2]?t?(t.p(l,o),o&4&&$(t,1)):(t=_o(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function yc(r,e,n){let t,{apiKey:l}=e,{map:o}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(f){return f?la(f,Xt,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=f=>{"apiKey"in f&&n(0,l=f.apiKey),"map"in f&&n(4,o=f.map),"country"in f&&n(1,i=f.country)},r.$$.update=()=>{r.$$.dirty&16&&n(2,t=a(o))},[l,i,t,s,o]}class wc extends ae{constructor(e){super(),fe(this,e,yc,vc,oe,{apiKey:0,map:4,country:1})}}const kc=["==",["geometry-type"],"Polygon"],Sc=["==",["geometry-type"],"LineString"];function Ht(r,e,n){let t=["match",r];for(let[l,o]of Object.entries(e))t.push(l),t.push(o);return t.push(n),t}function Jt(r,e,n){let t=["step",r];for(let l=1;l<e.length;l++)t.push(n[l-1]),t.push(e[l]);return t.push(n[n.length-1]),t}function rn(){return{type:"FeatureCollection",features:[]}}function mo(r){let e,n,t,l,o;return n=new yn({props:{colorScale:r[3].colorScale,limits:r[3].limits}}),l=new Dt({props:{$$slots:{default:[Lc]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&k(e),F(n),F(l)}}}function Lc(r){let e;return{c(){e=S("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function po(r){let e,n,t,l,o;return n=new cl({props:{colors:r[4],horiz:!0}}),l=new Dt({props:{$$slots:{default:[Cc]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&k(e),F(n),F(l)}}}function Cc(r){let e;return{c(){e=S("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function go(r){let e,n,t,l,o;return n=new cl({props:{colors:r[5],horiz:!0}}),l=new Dt({props:{$$slots:{default:[Mc]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&k(e),F(n),F(l)}}}function Mc(r){let e;return{c(){e=S("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Tc(r){let e,n,t,l,o,i;const s=[ye("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Ht(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":on(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={};for(let d=0;d<s.length;d+=1)a=me(a,s[d]);e=new lt({props:a});const f=[ye("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Ht(["get","Level of Service"],r[4],"cyan"),"line-width":on(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={};for(let d=0;d<f.length;d+=1)u=me(u,f[d]);t=new lt({props:u});const c=[ye("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Ht(["get","Infrastructure type"],r[5],"cyan"),"line-width":on(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=me(_,c[d]);return o=new lt({props:_}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,l,m),A(o,d,m),i=!0},p(d,m){const g=m&9?Oe(s,[s[0],s[1],s[2],m&8&&{paint:{"line-color":Ht(["get","Traffic volume category"],{"0 to 1999":d[3].colorScale[0],"2000 to 3999":d[3].colorScale[1],"4000+":d[3].colorScale[2]},"cyan"),"line-width":on(0)}},m&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};e.$set(g);const y=m&18?Oe(f,[f[0],f[1],m&16&&{paint:{"line-color":Ht(["get","Level of Service"],d[4],"cyan"),"line-width":on(1)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};t.$set(y);const h=m&36?Oe(c,[c[0],c[1],c[2],m&32&&{paint:{"line-color":Ht(["get","Infrastructure type"],d[5],"cyan"),"line-width":on(1)}},m&4&&{layout:{visibility:d[2]?"visible":"none"}}]):{};o.$set(h)},i(d){i||($(e.$$.fragment,d),$(t.$$.fragment,d),$(o.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(t.$$.fragment,d),C(o.$$.fragment,d),i=!1},d(d){d&&(k(n),k(l)),F(e,d),F(t,d),F(o,d)}}}function Ac(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m=r[0]&&mo(r),g=r[1]&&po(r),y=r[2]&&go(r);return u=new Cr({props:{url:`pmtiles://${Ct("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[Tc]},$$scope:{ctx:r}}}),{c(){e=S("button"),e.textContent="Traffic",n=M(),m&&m.c(),t=M(),l=S("button"),l.textContent="Level of Service",o=M(),g&&g.c(),i=M(),s=S("button"),s.textContent="Existing cycle infrastructure",a=M(),y&&y.c(),f=M(),T(u.$$.fragment),N(e,"class","secondary"),N(l,"class","secondary"),N(s,"class","secondary")},m(h,v){w(h,e,v),w(h,n,v),m&&m.m(h,v),w(h,t,v),w(h,l,v),w(h,o,v),g&&g.m(h,v),w(h,i,v),w(h,s,v),w(h,a,v),y&&y.m(h,v),w(h,f,v),A(u,h,v),c=!0,_||(d=[X(e,"click",r[6]),X(l,"click",r[7]),X(s,"click",r[8])],_=!0)},p(h,[v]){h[0]?m?(m.p(h,v),v&1&&$(m,1)):(m=mo(h),m.c(),$(m,1),m.m(t.parentNode,t)):m&&(he(),C(m,1,1,()=>{m=null}),be()),h[1]?g?(g.p(h,v),v&2&&$(g,1)):(g=po(h),g.c(),$(g,1),g.m(i.parentNode,i)):g&&(he(),C(g,1,1,()=>{g=null}),be()),h[2]?y?(y.p(h,v),v&4&&$(y,1)):(y=go(h),y.c(),$(y,1),y.m(f.parentNode,f)):y&&(he(),C(y,1,1,()=>{y=null}),be());const b={};v&519&&(b.$$scope={dirty:v,ctx:h}),u.$set(b)},i(h){c||($(m),$(g),$(y),$(u.$$.fragment,h),c=!0)},o(h){C(m),C(g),C(y),C(u.$$.fragment,h),c=!1},d(h){h&&(k(e),k(n),k(t),k(l),k(o),k(i),k(s),k(a),k(f)),m&&m.d(h),g&&g.d(h),y&&y.d(h),F(u,h),_=!1,ft(d)}}}function Fc(r,e,n){let t=!1,l=!1,o=!1;return[t,l,o,{colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},{High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"},()=>n(0,t=!t),()=>n(1,l=!l),()=>n(2,o=!o)]}class Pc extends ae{constructor(e){super(),fe(this,e,Fc,Ac,oe,{})}}function ho(r){let e,n,t,l,o;return n=new cl({props:{colors:r[1],horiz:!0}}),l=new Dt({props:{$$slots:{default:[Ec]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment)},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(l,e,null),o=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&k(e),F(n),F(l)}}}function Ec(r){let e;return{c(){e=S("p"),e.innerHTML=`See Scottish data sources for <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
        ,
        <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
        , and
        <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
        .`},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Ic(r){let e=r[3].name+"",n;return{c(){n=j(e)},m(t,l){w(t,n,l)},p(t,l){l&8&&e!==(e=t[3].name+"")&&le(n,e)},d(t){t&&k(n)}}}function Nc(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[Ic,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function jc(r){let e,n;const t=[ye("context-gp-practices"),{paint:{"circle-color":r[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Nc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new _n({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s=i&3?Oe(t,[t[0],i&2&&{paint:{"circle-color":o[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function zc(r){let e=r[3].name+"",n;return{c(){n=j(e)},m(t,l){w(t,n,l)},p(t,l){l&8&&e!==(e=t[3].name+"")&&le(n,e)},d(t){t&&k(n)}}}function Oc(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[zc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Bc(r){let e,n;const t=[ye("context-hospitals"),{paint:{"circle-color":r[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Oc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new _n({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s=i&3?Oe(t,[t[0],i&2&&{paint:{"circle-color":o[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Rc(r){let e=r[3].name+"",n,t,l=r[3].pupils+"",o,i;return{c(){n=j(e),t=j(" with "),o=j(l),i=j(" pupils")},m(s,a){w(s,n,a),w(s,t,a),w(s,o,a),w(s,i,a)},p(s,a){a&8&&e!==(e=s[3].name+"")&&le(n,e),a&8&&l!==(l=s[3].pupils+"")&&le(o,l)},d(s){s&&(k(n),k(t),k(o),k(i))}}}function Dc(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[Rc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Uc(r){let e,n;const t=[ye("context-schools"),{paint:{"circle-color":r[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Dc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new _n({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s=i&3?Oe(t,[t[0],i&2&&{paint:{"circle-color":o[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Hc(r){let e,n,t,l,o,i,s,a,f,u,c,_=r[0]&&ho(r);return l=new Ve({props:{data:Ct("cnt_layers/gp_practices.geojson"),generateId:!0,$$slots:{default:[jc]},$$scope:{ctx:r}}}),i=new Ve({props:{data:Ct("cnt_layers/hospitals.geojson"),generateId:!0,$$slots:{default:[Bc]},$$scope:{ctx:r}}}),a=new Ve({props:{data:Ct("cnt_layers/schools.geojson"),generateId:!0,$$slots:{default:[Uc]},$$scope:{ctx:r}}}),{c(){e=S("button"),e.textContent="POIs",n=M(),_&&_.c(),t=M(),T(l.$$.fragment),o=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),N(e,"class","secondary")},m(d,m){w(d,e,m),w(d,n,m),_&&_.m(d,m),w(d,t,m),A(l,d,m),w(d,o,m),A(i,d,m),w(d,s,m),A(a,d,m),f=!0,u||(c=X(e,"click",r[2]),u=!0)},p(d,[m]){d[0]?_?(_.p(d,m),m&1&&$(_,1)):(_=ho(d),_.c(),$(_,1),_.m(t.parentNode,t)):_&&(he(),C(_,1,1,()=>{_=null}),be());const g={};m&17&&(g.$$scope={dirty:m,ctx:d}),l.$set(g);const y={};m&17&&(y.$$scope={dirty:m,ctx:d}),i.$set(y);const h={};m&17&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){f||($(_),$(l.$$.fragment,d),$(i.$$.fragment,d),$(a.$$.fragment,d),f=!0)},o(d){C(_),C(l.$$.fragment,d),C(i.$$.fragment,d),C(a.$$.fragment,d),f=!1},d(d){d&&(k(e),k(n),k(t),k(o),k(s)),_&&_.d(d),F(l,d),F(i,d),F(a,d),u=!1,c()}}}function Gc(r,e,n){let t=!1;return[t,{Schools:"#7fc97f",GPs:"#beaed4",Hospitals:"#fdc086"},()=>n(0,t=!t)]}class Wc extends ae{constructor(e){super(),fe(this,e,Gc,Hc,oe,{})}}let cs=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],ds=[20,30,40,50,60,70],ln=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],Qn=[0,20,40,60,80,100];const bn={mapFeature:{hover:{backgroundColor:"blue"}}};let fr=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],$l=[0,.3,.6,1,1.5,2];function bo(r){let e,n,t,l,o,i;return e=new yn({props:{colorScale:ln,limits:Qn}}),o=new Dt({props:{$$slots:{default:[qc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),t=S("p"),t.textContent="Darker colours are more deprived",l=M(),T(o.$$.fragment)},m(s,a){A(e,s,a),w(s,n,a),w(s,t,a),w(s,l,a),A(o,s,a),i=!0},i(s){i||($(e.$$.fragment,s),$(o.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(o.$$.fragment,s),i=!1},d(s){s&&(k(n),k(t),k(l)),F(e,s),F(o,s)}}}function qc(r){let e;return{c(){e=S("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      . SIMD combines different domains: income; employment; health; education, skills
      and training; geographic access to services; crime; and housing.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function $o(r){let e,n,t,l,o,i;return e=new yn({props:{colorScale:r[2],limits:r[3]}}),o=new Dt({props:{$$slots:{default:[Jc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),t=S("p"),t.textContent="Darker colours are denser",l=M(),T(o.$$.fragment)},m(s,a){A(e,s,a),w(s,n,a),w(s,t,a),w(s,l,a),A(o,s,a),i=!0},p(s,a){const f={};a&128&&(f.$$scope={dirty:a,ctx:s}),o.$set(f)},i(s){i||($(e.$$.fragment,s),$(o.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(o.$$.fragment,s),i=!1},d(s){s&&(k(n),k(t),k(l)),F(e,s),F(o,s)}}}function Jc(r){let e;return{c(){e=S("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      .`},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Zc(r){let e,n,t=r[6].id+"",l,o,i=r[6].population.toLocaleString()+"",s,a,f=r[6].imd_rank+"",u,c,_=r[6].imd_percentile+"",d,m;return{c(){e=S("p"),n=j("Data zone "),l=j(t),o=j(`
        has `),s=j(i),a=j(`
        people, and a SIMD rank of `),u=j(f),c=j(", putting it in the "),d=j(_),m=j(`
        percentile.`)},m(g,y){w(g,e,y),p(e,n),p(e,l),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c),p(e,d),p(e,m)},p(g,y){y&64&&t!==(t=g[6].id+"")&&le(l,t),y&64&&i!==(i=g[6].population.toLocaleString()+"")&&le(s,i),y&64&&f!==(f=g[6].imd_rank+"")&&le(u,f),y&64&&_!==(_=g[6].imd_percentile+"")&&le(d,_)},d(g){g&&k(e)}}}function Yc(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[Zc,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Kc(r){let e,n,t=r[6].id+"",l,o,i=r[6].population.toLocaleString()+"",s,a,f=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",u,c;return{c(){e=S("p"),n=j("Data zone "),l=j(t),o=j(`
        has `),s=j(i),a=j(`
        people, with a density of `),u=j(f),c=j(" people per square kilometer")},m(_,d){w(_,e,d),p(e,n),p(e,l),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c)},p(_,d){d&64&&t!==(t=_[6].id+"")&&le(l,t),d&64&&i!==(i=_[6].population.toLocaleString()+"")&&le(s,i),d&64&&f!==(f=Math.round(_[6].population/(_[6].area/1e6)).toLocaleString()+"")&&le(u,f)},d(_){_&&k(e)}}}function Xc(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[Kc,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Vc(r){let e,n,t,l,o,i;const s=[ye("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Jt(["get","imd_percentile"],Qn,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={$$slots:{default:[Yc]},$$scope:{ctx:r}};for(let d=0;d<s.length;d+=1)a=me(a,s[d]);e=new $t({props:a});const f=[ye("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Jt(["/",["get","population"],["/",["get","area"],1e6]],r[3],r[2]),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={$$slots:{default:[Xc]},$$scope:{ctx:r}};for(let d=0;d<f.length;d+=1)u=me(u,f[d]);t=new $t({props:u});const c=[ye("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=me(_,c[d]);return o=new lt({props:_}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,l,m),A(o,d,m),i=!0},p(d,m){const g=m&1?Oe(s,[s[0],s[1],s[2],s[3],{layout:{visibility:d[0]?"visible":"none"}}]):{};m&128&&(g.$$scope={dirty:m,ctx:d}),e.$set(g);const y=m&14?Oe(f,[f[0],f[1],f[2],m&12&&{paint:{"fill-color":Jt(["/",["get","population"],["/",["get","area"],1e6]],d[3],d[2]),"fill-opacity":at(.7,.9)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};m&128&&(y.$$scope={dirty:m,ctx:d}),t.$set(y);const h=m&3?Oe(c,[c[0],c[1],c[2],{layout:{visibility:d[0]||d[1]?"visible":"none"}}]):{};o.$set(h)},i(d){i||($(e.$$.fragment,d),$(t.$$.fragment,d),$(o.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(t.$$.fragment,d),C(o.$$.fragment,d),i=!1},d(d){d&&(k(n),k(l)),F(e,d),F(t,d),F(o,d)}}}function Qc(r){let e,n,t,l,o,i,s,a,f,u,c=r[0]&&bo(r),_=r[1]&&$o(r);return s=new Cr({props:{url:`pmtiles://${Ct("cnt_layers/population.pmtiles")}`,$$slots:{default:[Vc]},$$scope:{ctx:r}}}),{c(){e=S("button"),e.textContent="SIMD",n=M(),c&&c.c(),t=M(),l=S("button"),l.textContent="Population density",o=M(),_&&_.c(),i=M(),T(s.$$.fragment),N(e,"class","secondary"),N(l,"class","secondary")},m(d,m){w(d,e,m),w(d,n,m),c&&c.m(d,m),w(d,t,m),w(d,l,m),w(d,o,m),_&&_.m(d,m),w(d,i,m),A(s,d,m),a=!0,f||(u=[X(e,"click",r[4]),X(l,"click",r[5])],f=!0)},p(d,[m]){d[0]?c?m&1&&$(c,1):(c=bo(d),c.c(),$(c,1),c.m(t.parentNode,t)):c&&(he(),C(c,1,1,()=>{c=null}),be()),d[1]?_?(_.p(d,m),m&2&&$(_,1)):(_=$o(d),_.c(),$(_,1),_.m(i.parentNode,i)):_&&(he(),C(_,1,1,()=>{_=null}),be());const g={};m&131&&(g.$$scope={dirty:m,ctx:d}),s.$set(g)},i(d){a||($(c),$(_),$(s.$$.fragment,d),a=!0)},o(d){C(c),C(_),C(s.$$.fragment,d),a=!1},d(d){d&&(k(e),k(n),k(t),k(l),k(o),k(i)),c&&c.d(d),_&&_.d(d),F(s,d),f=!1,ft(u)}}}function xc(r,e,n){let t=!1,l=!1,o=ln.toReversed();return[t,l,o,[0,4700,13e3,33e3,94e3,198e4],()=>n(0,t=!t),()=>n(1,l=!l)]}class ed extends ae{constructor(e){super(),fe(this,e,xc,Qc,oe,{})}}function vo(r){let e,n,t,l,o,i;return o=new Dt({props:{$$slots:{default:[td]},$$scope:{ctx:r}}}),{c(){e=S("div"),n=S("img"),l=M(),T(o.$$.fragment),Ke(n.src,t=Wi)||N(n,"src",t),N(n,"alt","National Rail logo")},m(s,a){w(s,e,a),p(e,n),p(e,l),A(o,e,null),i=!0},i(s){i||($(o.$$.fragment,s),i=!0)},o(s){C(o.$$.fragment,s),i=!1},d(s){s&&k(e),F(o)}}}function td(r){let e;return{c(){e=S("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
        according to OpenStreetMap.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function nd(r){let e,n=(r[2].name??"Unnamed railway station")+"",t;return{c(){e=S("p"),t=j(n)},m(l,o){w(l,e,o),p(e,t)},p(l,o){o&4&&n!==(n=(l[2].name??"Unnamed railway station")+"")&&le(t,n)},d(l){l&&k(e)}}}function rd(r){let e,n;return e=new ut({props:{$$slots:{default:[nd,({props:t})=>({2:t}),({props:t})=>t?4:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&12&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ld(r){let e,n;const t=[ye("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[rd]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new vr({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s=i&1?Oe(t,[t[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function od(r){let e,n,t,l,o,i,s,a=r[0]&&vo(r);return l=new Ve({props:{data:Ct("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[ld]},$$scope:{ctx:r}}}),{c(){e=S("button"),e.textContent="Railway stations",n=M(),a&&a.c(),t=M(),T(l.$$.fragment),N(e,"class","secondary")},m(f,u){w(f,e,u),w(f,n,u),a&&a.m(f,u),w(f,t,u),A(l,f,u),o=!0,i||(s=X(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&$(a,1):(a=vo(f),a.c(),$(a,1),a.m(t.parentNode,t)):a&&(he(),C(a,1,1,()=>{a=null}),be());const c={};u&9&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||($(a),$(l.$$.fragment,f),o=!0)},o(f){C(a),C(l.$$.fragment,f),o=!1},d(f){f&&(k(e),k(n),k(t)),a&&a.d(f),F(l,f),i=!1,s()}}}function id(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class sd extends ae{constructor(e){super(),fe(this,e,id,od,oe,{})}}function yo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function wo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function ko(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function So(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Lo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Co(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Mo(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,v,b,L;e=new Dt({props:{$$slots:{default:[ad]},$$scope:{ctx:r}}});let I=Me(r[7]),E=[];for(let U=0;U<I.length;U+=1)E[U]=To(Co(r,I,U));let P=Me(r[8]),O=[];for(let U=0;U<P.length;U+=1)O[U]=Ao(Lo(r,P,U));let B=Me(r[9]),D=[];for(let U=0;U<B.length;U+=1)D[U]=Fo(So(r,B,U));let R=Me(r[10]),z=[];for(let U=0;U<R.length;U+=1)z[U]=Po(ko(r,R,U));return{c(){T(e.$$.fragment),n=M(),t=S("label"),l=j(`Trip purpose:
    `),o=S("select");for(let U=0;U<E.length;U+=1)E[U].c();i=M(),s=S("label"),a=j(`Scenario:
    `),f=S("select");for(let U=0;U<O.length;U+=1)O[U].c();u=M(),c=S("label"),_=j(`Network type:
    `),d=S("select");for(let U=0;U<D.length;U+=1)D[U].c();m=M(),g=S("label"),y=j(`Color by:
    `),h=S("select");for(let U=0;U<z.length;U+=1)z[U].c();r[0]===void 0&&sn(()=>r[12].call(o)),r[1]===void 0&&sn(()=>r[13].call(f)),r[2]===void 0&&sn(()=>r[14].call(d)),r[3]===void 0&&sn(()=>r[15].call(h))},m(U,H){A(e,U,H),w(U,n,H),w(U,t,H),p(t,l),p(t,o);for(let Y=0;Y<E.length;Y+=1)E[Y]&&E[Y].m(o,null);wt(o,r[0],!0),w(U,i,H),w(U,s,H),p(s,a),p(s,f);for(let Y=0;Y<O.length;Y+=1)O[Y]&&O[Y].m(f,null);wt(f,r[1],!0),w(U,u,H),w(U,c,H),p(c,_),p(c,d);for(let Y=0;Y<D.length;Y+=1)D[Y]&&D[Y].m(d,null);wt(d,r[2],!0),w(U,m,H),w(U,g,H),p(g,y),p(g,h);for(let Y=0;Y<z.length;Y+=1)z[Y]&&z[Y].m(h,null);wt(h,r[3],!0),v=!0,b||(L=[X(o,"change",r[12]),X(f,"change",r[13]),X(d,"change",r[14]),X(h,"change",r[15])],b=!0)},p(U,H){const Y={};if(H[1]&2&&(Y.$$scope={dirty:H,ctx:U}),e.$set(Y),H[0]&128){I=Me(U[7]);let Z;for(Z=0;Z<I.length;Z+=1){const se=Co(U,I,Z);E[Z]?E[Z].p(se,H):(E[Z]=To(se),E[Z].c(),E[Z].m(o,null))}for(;Z<E.length;Z+=1)E[Z].d(1);E.length=I.length}if(H[0]&129&&wt(o,U[0]),H[0]&256){P=Me(U[8]);let Z;for(Z=0;Z<P.length;Z+=1){const se=Lo(U,P,Z);O[Z]?O[Z].p(se,H):(O[Z]=Ao(se),O[Z].c(),O[Z].m(f,null))}for(;Z<O.length;Z+=1)O[Z].d(1);O.length=P.length}if(H[0]&258&&wt(f,U[1]),H[0]&512){B=Me(U[9]);let Z;for(Z=0;Z<B.length;Z+=1){const se=So(U,B,Z);D[Z]?D[Z].p(se,H):(D[Z]=Fo(se),D[Z].c(),D[Z].m(d,null))}for(;Z<D.length;Z+=1)D[Z].d(1);D.length=B.length}if(H[0]&516&&wt(d,U[2]),H[0]&1024){R=Me(U[10]);let Z;for(Z=0;Z<R.length;Z+=1){const se=ko(U,R,Z);z[Z]?z[Z].p(se,H):(z[Z]=Po(se),z[Z].c(),z[Z].m(h,null))}for(;Z<z.length;Z+=1)z[Z].d(1);z.length=R.length}H[0]&1032&&wt(h,U[3])},i(U){v||($(e.$$.fragment,U),v=!0)},o(U){C(e.$$.fragment,U),v=!1},d(U){U&&(k(n),k(t),k(i),k(s),k(u),k(c),k(m),k(g)),F(e,U),dt(E,U),dt(O,U),dt(D,U),dt(z,U),b=!1,ft(L)}}}function ad(r){let e;return{c(){e=S("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#routenetwork"),N(e,"target","_blank")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function To(r){let e,n=r[19]+"",t;return{c(){e=S("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(l,o){w(l,e,o),p(e,t)},p:Q,d(l){l&&k(e)}}}function Ao(r){let e,n=r[19]+"",t;return{c(){e=S("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(l,o){w(l,e,o),p(e,t)},p:Q,d(l){l&&k(e)}}}function Fo(r){let e,n=r[19]+"",t;return{c(){e=S("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(l,o){w(l,e,o),p(e,t)},p:Q,d(l){l&&k(e)}}}function Po(r){let e,n=r[19]+"",t;return{c(){e=S("option"),t=j(n),e.__value=r[18],qe(e,e.__value)},m(l,o){w(l,e,o),p(e,t)},p:Q,d(l){l&&k(e)}}}function Eo(r){let e,n,t,l,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=S("tr"),n=S("th"),n.textContent=`${r[19]}`,t=M(),l=S("td"),i=j(o),s=M(),a=S("td"),u=j(f),c=M(),_=S("td"),m=j(d),g=M()},m(y,h){w(y,e,h),p(e,n),p(e,t),p(e,l),p(l,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(y,h){h[0]&131072&&o!==(o=y[17][`${y[18]}_fastest_bicycle`].toLocaleString()+"")&&le(i,o),h[0]&131072&&f!==(f=y[17][`${y[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&le(u,f),h[0]&131072&&d!==(d=y[17][`${y[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&le(m,d)},d(y){y&&k(e)}}}function Io(r){let e,n,t,l,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=S("tr"),n=S("th"),n.textContent=`${r[19]}`,t=M(),l=S("td"),i=j(o),s=M(),a=S("td"),u=j(f),c=M(),_=S("td"),m=j(d),g=M()},m(y,h){w(y,e,h),p(e,n),p(e,t),p(e,l),p(l,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(y,h){h[0]&131072&&o!==(o=y[17][`${y[18]}_quietest_bicycle`].toLocaleString()+"")&&le(i,o),h[0]&131072&&f!==(f=y[17][`${y[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&le(u,f),h[0]&131072&&d!==(d=y[17][`${y[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&le(m,d)},d(y){y&&k(e)}}}function fd(r){let e,n,t,l=r[17][r[4]].toLocaleString()+"",o,i,s,a,f=r[17].gradient+"",u,c,_,d,m,g=r[17].quietness+"",y,h,v,b,L,I,E,P,O,B,D,R,z,U,H,Y,Z,se=Me(r[7]),G=[];for(let ue=0;ue<se.length;ue+=1)G[ue]=Eo(wo(r,se,ue));let we=Me(r[7]),x=[];for(let ue=0;ue<we.length;ue+=1)x[ue]=Io(yo(r,we,ue));return{c(){e=S("div"),n=S("p"),t=j("Cyclists: "),o=j(l),i=M(),s=S("p"),a=j("Gradient: "),u=j(f),c=j("%"),_=M(),d=S("p"),m=j("Cycle-friendliness: "),y=j(g),h=j("%"),v=M(),b=S("details"),L=S("summary"),L.textContent="All network details",I=M(),E=S("p"),E.textContent="Fast/Direct network",P=M(),O=S("table"),B=S("tr"),B.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",D=M();for(let ue=0;ue<G.length;ue+=1)G[ue].c();R=M(),z=S("p"),z.textContent="Quiet/Indirect network",U=M(),H=S("table"),Y=S("tr"),Y.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Z=M();for(let ue=0;ue<x.length;ue+=1)x[ue].c();ie(e,"max-width","30vw"),ie(e,"max-height","60vh"),ie(e,"overflow","auto")},m(ue,ve){w(ue,e,ve),p(e,n),p(n,t),p(n,o),p(e,i),p(e,s),p(s,a),p(s,u),p(s,c),p(e,_),p(e,d),p(d,m),p(d,y),p(d,h),p(e,v),p(e,b),p(b,L),p(b,I),p(b,E),p(b,P),p(b,O),p(O,B),p(O,D);for(let ce=0;ce<G.length;ce+=1)G[ce]&&G[ce].m(O,null);p(b,R),p(b,z),p(b,U),p(b,H),p(H,Y),p(H,Z);for(let ce=0;ce<x.length;ce+=1)x[ce]&&x[ce].m(H,null)},p(ue,ve){if(ve[0]&131088&&l!==(l=ue[17][ue[4]].toLocaleString()+"")&&le(o,l),ve[0]&131072&&f!==(f=ue[17].gradient+"")&&le(u,f),ve[0]&131072&&g!==(g=ue[17].quietness+"")&&le(y,g),ve[0]&131200){se=Me(ue[7]);let ce;for(ce=0;ce<se.length;ce+=1){const Fe=wo(ue,se,ce);G[ce]?G[ce].p(Fe,ve):(G[ce]=Eo(Fe),G[ce].c(),G[ce].m(O,null))}for(;ce<G.length;ce+=1)G[ce].d(1);G.length=se.length}if(ve[0]&131200){we=Me(ue[7]);let ce;for(ce=0;ce<we.length;ce+=1){const Fe=yo(ue,we,ce);x[ce]?x[ce].p(Fe,ve):(x[ce]=Io(Fe),x[ce].c(),x[ce].m(H,null))}for(;ce<x.length;ce+=1)x[ce].d(1);x.length=we.length}},d(ue){ue&&k(e),dt(G,ue),dt(x,ue)}}}function ud(r){let e,n;return e=new ut({props:{openOn:"click",$$slots:{default:[fd,({props:t})=>({17:t}),({props:t})=>[t?131072:0]]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[0]&131088|l[1]&2&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function cd(r){let e,n;const t=[ye("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":No(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let l={$$slots:{default:[ud]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s=i[0]&112?Oe(t,[t[0],t[1],i[0]&80&&{paint:{"line-color":o[6],"line-width":No(["get",o[4]])}},i[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},t[4]]):{};i[0]&16|i[1]&2&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function dd(r){let e,n,t,l,o,i,s,a=r[5]&&Mo(r);return l=new Cr({props:{url:`pmtiles://${Ct("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[cd]},$$scope:{ctx:r}}}),{c(){e=S("button"),e.textContent="Route network",n=M(),a&&a.c(),t=M(),T(l.$$.fragment),N(e,"class","secondary")},m(f,u){w(f,e,u),w(f,n,u),a&&a.m(f,u),w(f,t,u),A(l,f,u),o=!0,i||(s=X(e,"click",r[11]),i=!0)},p(f,u){f[5]?a?(a.p(f,u),u[0]&32&&$(a,1)):(a=Mo(f),a.c(),$(a,1),a.m(t.parentNode,t)):a&&(he(),C(a,1,1,()=>{a=null}),be());const c={};u[0]&112|u[1]&2&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||($(a),$(l.$$.fragment,f),o=!0)},o(f){C(a),C(l.$$.fragment,f),o=!1},d(f){f&&(k(e),k(n),k(t)),a&&a.d(f),F(l,f),i=!1,s()}}}function No(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function _d(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function md(r,e,n){let t,l,o=!1,i="all",s="bicycle_go_dutch",a="fastest",f="flow",u=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],c=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],_=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],d=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],m={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};const g=()=>n(5,o=!o);function y(){i=an(this),n(0,i),n(7,u)}function h(){s=an(this),n(1,s),n(8,c)}function v(){a=an(this),n(2,a),n(9,_)}function b(){f=an(this),n(3,f),n(10,d)}return r.$$.update=()=>{r.$$.dirty[0]&7&&n(4,t=`${i}_${a}_${s}`),r.$$.dirty[0]&24&&n(6,l={none:"#304ce7",flow:_d(["get",t]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Jt(["abs",["get","gradient"]],m.limits,m.colorScale)}[f])},[i,s,a,f,t,o,l,u,c,_,d,g,y,h,v,b]}class pd extends ae{constructor(e){super(),fe(this,e,md,dd,oe,{},null,[-1,-1])}}function gd(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,v;return o=new Wc({}),s=new ed({}),f=new sd({}),c=new qu({}),d=new Pc({}),g=new pd({}),{c(){e=S("div"),n=S("button"),n.innerHTML=`<img src="${Jf}" title="Layers" alt="Layers"/>`,t=M(),l=S("div"),T(o.$$.fragment),i=M(),T(s.$$.fragment),a=M(),T(f.$$.fragment),u=M(),T(c.$$.fragment),_=M(),T(d.$$.fragment),m=M(),T(g.$$.fragment),ie(l,"display","flex"),ie(l,"flex-direction","column"),ie(l,"visibility",r[0]?"visible":"collapse"),N(e,"class","pico"),ie(e,"display","flex"),ie(e,"flex-direction","column"),ie(e,"background","grey")},m(b,L){w(b,e,L),p(e,n),p(e,t),p(e,l),A(o,l,null),p(l,i),A(s,l,null),p(l,a),A(f,l,null),p(l,u),A(c,l,null),p(l,_),A(d,l,null),p(l,m),A(g,l,null),y=!0,h||(v=X(n,"click",r[1]),h=!0)},p(b,L){L&1&&ie(l,"visibility",b[0]?"visible":"collapse")},i(b){y||($(o.$$.fragment,b),$(s.$$.fragment,b),$(f.$$.fragment,b),$(c.$$.fragment,b),$(d.$$.fragment,b),$(g.$$.fragment,b),y=!0)},o(b){C(o.$$.fragment,b),C(s.$$.fragment,b),C(f.$$.fragment,b),C(c.$$.fragment,b),C(d.$$.fragment,b),C(g.$$.fragment,b),y=!1},d(b){b&&k(e),F(o),F(s),F(f),F(c),F(d),F(g),h=!1,v()}}}function hd(r){let e,n;return e=new Pf({props:{defaultStyling:!0,$$slots:{default:[gd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&5&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function bd(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class $d extends ae{constructor(e){super(),fe(this,e,bd,hd,oe,{})}}let q;const _s=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&_s.decode();let On=null;function Ln(){return(On===null||On.byteLength===0)&&(On=new Uint8Array(q.memory.buffer)),On}function ct(r,e){return r=r>>>0,_s.decode(Ln().subarray(r,r+e))}const nn=new Array(128).fill(void 0);nn.push(void 0,null,!0,!1);let Gn=nn.length;function We(r){Gn===nn.length&&nn.push(nn.length+1);const e=Gn;return Gn=nn[e],nn[e]=r,e}function Le(r){return nn[r]}function Sn(r){return r==null}let Bn=null;function ms(){return(Bn===null||Bn.byteLength===0)&&(Bn=new Float64Array(q.memory.buffer)),Bn}let Rn=null;function te(){return(Rn===null||Rn.byteLength===0)&&(Rn=new Int32Array(q.memory.buffer)),Rn}let yt=0;const ur=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},vd=typeof ur.encodeInto=="function"?function(r,e){return ur.encodeInto(r,e)}:function(r,e){const n=ur.encode(r);return e.set(n),{read:r.length,written:n.length}};function Ut(r,e,n){if(n===void 0){const s=ur.encode(r),a=e(s.length,1)>>>0;return Ln().subarray(a,a+s.length).set(s),yt=s.length,a}let t=r.length,l=e(t,1)>>>0;const o=Ln();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;o[l+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),l=n(l,t,t=i+r.length*3,1)>>>0;const s=Ln().subarray(l+i,l+t),a=vd(r,s);i+=a.written}return yt=i,l}function yd(r){r<132||(nn[r]=Gn,Gn=r)}function Xe(r){const e=Le(r);return yd(r),e}let Dn=null;function wd(){return(Dn===null||Dn.byteLength===0)&&(Dn=new BigInt64Array(q.memory.buffer)),Dn}function xr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let o="[";l>0&&(o+=xr(r[0]));for(let i=1;i<l;i++)o+=", "+xr(r[i]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function jo(r,e){const n=e(r.length*1,1)>>>0;return Ln().set(r,n/1),yt=r.length,n}function kd(r,e){return r=r>>>0,ms().subarray(r/8,r/8+e)}function Sd(r,e){return r=r>>>0,Ln().subarray(r/1,r/1+e)}function gn(r,e){try{return r.apply(this,e)}catch(n){q.__wbindgen_exn_store(We(n))}}class Ld{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();q.__wbg_ltn_free(e)}constructor(e,n,t,l){try{const u=q.__wbindgen_add_to_stack_pointer(-16),c=jo(e,q.__wbindgen_malloc),_=yt,d=jo(n,q.__wbindgen_malloc),m=yt;var o=Sn(l)?0:Ut(l,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;q.ltn_new(u,c,_,d,m,We(t),o,i);var s=te()[u/4+0],a=te()[u/4+1],f=te()[u/4+2];if(f)throw Xe(a);return this.__wbg_ptr=s>>>0,this}finally{q.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getInvertedBoundary(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getBounds(){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getBounds(l,this.__wbg_ptr);var e=te()[l/4+0],n=te()[l/4+1],t=kd(e,n).slice();return q.__wbindgen_free(e,n*8,8),t}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=te()[l/4+0],n=te()[l/4+1],t=Sd(e,n).slice();return q.__wbindgen_free(e,n*1,1),t}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapperGj(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderModalFilters(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderModalFilters(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderNeighbourhood(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderNeighbourhood(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderAutoBoundaries(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderAutoBoundaries(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}setNeighbourhoodBoundary(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,i,s,We(n));var t=te()[o/4+0],l=te()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const n=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),t=yt;q.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,t)}renameNeighbourhoodBoundary(e,n){const t=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),l=yt,o=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;q.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,t,l,o,i)}setCurrentNeighbourhood(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_setCurrentNeighbourhood(o,this.__wbg_ptr,i,s,n);var t=te()[o/4+0],l=te()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_addModalFilter(o,this.__wbg_ptr,We(e),i,s);var t=te()[o/4+0],l=te()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_addManyModalFilters(o,this.__wbg_ptr,We(e),i,s);var t=te()[o/4+0],l=te()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){q.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_addDiagonalFilter(l,this.__wbg_ptr,e);var n=te()[l/4+0],t=te()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_rotateDiagonalFilter(l,this.__wbg_ptr,e);var n=te()[l/4+0],t=te()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_deleteDiagonalFilter(l,this.__wbg_ptr,e);var n=te()[l/4+0],t=te()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}toggleTravelFlow(e){q.ltn_toggleTravelFlow(this.__wbg_ptr,e)}undo(){q.ltn_undo(this.__wbg_ptr)}redo(){q.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getShortcutsCrossingRoad(u,this.__wbg_ptr,e);var l=te()[u/4+0],o=te()[u/4+1],i=te()[u/4+2],s=te()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,ct(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getAllShortcuts(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllShortcuts(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toSavefile(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_loadSavefile(l,this.__wbg_ptr,We(e));var n=te()[l/4+0],t=te()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,n,t,l,o){let i,s;try{const m=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_compareRoute(m,this.__wbg_ptr,e,n,t,l,o);var a=te()[m/4+0],f=te()[m/4+1],u=te()[m/4+2],c=te()[m/4+3],_=a,d=f;if(c)throw _=0,d=0,Xe(u);return i=_,s=d,ct(_,d)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(i,s,1)}}impactToOneDestination(e,n){let t,l;try{const c=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_impactToOneDestination(c,this.__wbg_ptr,e,n);var o=te()[c/4+0],i=te()[c/4+1],s=te()[c/4+2],a=te()[c/4+3],f=o,u=i;if(a)throw f=0,u=0,Xe(s);return t=f,l=u,ct(f,u)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(t,l,1)}}predictImpact(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_predictImpact(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getImpactsOnRoad(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getImpactsOnRoad(u,this.__wbg_ptr,e);var l=te()[u/4+0],o=te()[u/4+1],i=te()[u/4+2],s=te()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,ct(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getAllNeighbourhoods(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllNeighbourhoods(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getAllIntersections(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllIntersections(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getMovements(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getMovements(u,this.__wbg_ptr,e);var l=te()[u/4+0],o=te()[u/4+1],i=te()[u/4+2],s=te()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,ct(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getDemandModel(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getDemandModel(f,this.__wbg_ptr);var t=te()[f/4+0],l=te()[f/4+1],o=te()[f/4+2],i=te()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ct(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}}async function Cd(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Md(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(ct(e,n));return We(t)},r.wbg.__wbindgen_string_new=function(e,n){const t=ct(e,n);return We(t)},r.wbg.__wbindgen_boolean_get=function(e){const n=Le(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Le(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,n){const t=Le(n),l=typeof t=="number"?t:void 0;ms()[e/8+1]=Sn(l)?0:l,te()[e/4+0]=!Sn(l)},r.wbg.__wbindgen_string_get=function(e,n){const t=Le(n),l=typeof t=="string"?t:void 0;var o=Sn(l)?0:Ut(l,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;te()[e/4+1]=i,te()[e/4+0]=o},r.wbg.__wbindgen_is_object=function(e){const n=Le(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_in=function(e,n){return Le(e)in Le(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Xe(e)},r.wbg.__wbindgen_bigint_from_i64=function(e){return We(e)},r.wbg.__wbindgen_jsval_eq=function(e,n){return Le(e)===Le(n)},r.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return We(n)},r.wbg.__wbindgen_is_undefined=function(e){return Le(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Le(e)==Le(n)},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Le(e);return We(n)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,n){const t=Le(e)[Le(n)];return We(t)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Le(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Le(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Le(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Le(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Le(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return We(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Le(n).stack,l=Ut(t,q.__wbindgen_malloc,q.__wbindgen_realloc),o=yt;te()[e/4+1]=o,te()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,l;try{t=e,l=n,console.error(ct(e,n))}finally{q.__wbindgen_free(t,l,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const n=Le(e).performance;return We(n)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Le(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,n){const t=Le(e)[n>>>0];return We(t)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Le(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Le(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,n){const t=new Function(ct(e,n));return We(t)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const n=Le(e).next;return We(n)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return gn(function(e){const n=Le(e).next();return We(n)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Le(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const n=Le(e).value;return We(n)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return We(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return gn(function(e,n){const t=Reflect.get(Le(e),Le(n));return We(t)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return gn(function(e,n){const t=Le(e).call(Le(n));return We(t)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return gn(function(){const e=self.self;return We(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return gn(function(){const e=window.window;return We(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return gn(function(){const e=globalThis.globalThis;return We(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return gn(function(){const e=global.global;return We(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Le(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let n;try{n=Le(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Le(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const n=Object.entries(Le(e));return We(n)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const n=Le(e).buffer;return We(n)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const n=new Uint8Array(Le(e));return We(n)},r.wbg.__wbg_set_2357bf09366ee480=function(e,n,t){Le(e).set(Le(n),t>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Le(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let n;try{n=Le(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const t=Le(n),l=typeof t=="bigint"?t:void 0;wd()[e/8+1]=Sn(l)?BigInt(0):l,te()[e/4+0]=!Sn(l)},r.wbg.__wbindgen_debug_string=function(e,n){const t=xr(Le(n)),l=Ut(t,q.__wbindgen_malloc,q.__wbindgen_realloc),o=yt;te()[e/4+1]=o,te()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,n){throw new Error(ct(e,n))},r.wbg.__wbindgen_memory=function(){const e=q.memory;return We(e)},r}function Td(r,e){return q=r.exports,ps.__wbindgen_wasm_module=e,Dn=null,Bn=null,Rn=null,On=null,q}async function ps(r){if(q!==void 0)return q;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=Md();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Cd(await r,e);return Td(n,t)}const Ad=r=>({}),zo=r=>({}),Fd=r=>({}),Oo=r=>({}),Pd=r=>({}),Bo=r=>({});function Ed(r){let e,n,t,l,o,i,s,a;const f=r[1].top,u=Re(f,r,r[0],Bo),c=r[1].left,_=Re(c,r,r[0],Oo),d=r[1].main,m=Re(d,r,r[0],zo);return{c(){e=S("div"),n=S("div"),u&&u.c(),t=M(),l=S("div"),o=S("div"),_&&_.c(),i=M(),s=S("div"),m&&m.c(),N(n,"class","top svelte-29q570"),N(o,"class","left svelte-29q570"),N(s,"class","main svelte-29q570"),N(l,"class","content svelte-29q570"),N(e,"class","flex-container svelte-29q570")},m(g,y){w(g,e,y),p(e,n),u&&u.m(n,null),p(e,t),p(e,l),p(l,o),_&&_.m(o,null),p(l,i),p(l,s),m&&m.m(s,null),a=!0},p(g,[y]){u&&u.p&&(!a||y&1)&&De(u,f,g,g[0],a?He(f,g[0],y,Pd):Ue(g[0]),Bo),_&&_.p&&(!a||y&1)&&De(_,c,g,g[0],a?He(c,g[0],y,Fd):Ue(g[0]),Oo),m&&m.p&&(!a||y&1)&&De(m,d,g,g[0],a?He(d,g[0],y,Ad):Ue(g[0]),zo)},i(g){a||($(u,g),$(_,g),$(m,g),a=!0)},o(g){C(u,g),C(_,g),C(m,g),a=!1},d(g){g&&k(e),u&&u.d(g),_&&_.d(g),m&&m.d(g)}}}function Id(r,e,n){let{$$slots:t={},$$scope:l}=e;return r.$$set=o=>{"$$scope"in o&&n(0,l=o.$$scope)},[l,t]}class Nd extends ae{constructor(e){super(),fe(this,e,Id,Ed,oe,{})}}const jd=r=>({}),Ro=r=>({}),zd=r=>({}),Do=r=>({}),Od=r=>({}),Uo=r=>({});function Bd(r){let e,n,t,l,o,i;const s=r[4].top,a=Re(s,r,r[3],Uo),f=r[4].sidebar,u=Re(f,r,r[3],Do),c=r[4].map,_=Re(c,r,r[3],Ro);return{c(){e=S("div"),a&&a.c(),n=M(),t=S("div"),u&&u.c(),l=M(),o=S("div"),_&&_.c()},m(d,m){w(d,e,m),a&&a.m(e,null),r[5](e),w(d,n,m),w(d,t,m),u&&u.m(t,null),r[6](t),w(d,l,m),w(d,o,m),_&&_.m(o,null),r[7](o),i=!0},p(d,[m]){a&&a.p&&(!i||m&8)&&De(a,s,d,d[3],i?He(s,d[3],m,Od):Ue(d[3]),Uo),u&&u.p&&(!i||m&8)&&De(u,f,d,d[3],i?He(f,d[3],m,zd):Ue(d[3]),Do),_&&_.p&&(!i||m&8)&&De(_,c,d,d[3],i?He(c,d[3],m,jd):Ue(d[3]),Ro)},i(d){i||($(a,d),$(u,d),$(_,d),i=!0)},o(d){C(a,d),C(u,d),C(_,d),i=!1},d(d){d&&(k(e),k(n),k(t),k(l),k(o)),a&&a.d(d),r[5](null),u&&u.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function Rd(r,e,n){let t,l,o;V(r,el,c=>n(0,t=c)),V(r,tl,c=>n(1,l=c)),V(r,nl,c=>n(2,o=c));let{$$slots:i={},$$scope:s}=e;function a(c){ze[c?"unshift":"push"](()=>{t=c,el.set(t)})}function f(c){ze[c?"unshift":"push"](()=>{l=c,tl.set(l)})}function u(c){ze[c?"unshift":"push"](()=>{o=c,nl.set(o)})}return r.$$set=c=>{"$$scope"in c&&n(3,s=c.$$scope)},[t,l,o,s,i,a,f,u]}class At extends ae{constructor(e){super(),fe(this,e,Rd,Bd,oe,{})}}let el=Mt(null),tl=Mt(null),nl=Mt(null);function Dd(r){let e;return{c(){e=j("Back")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Ud(r){let e,n,t,l;return e=new Ce({props:{$$slots:{default:[Dd]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0,t||(l=X(window,"keydown",r[1]),t=!0)},p(o,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o),t=!1,l()}}}function Hd(r){let e=dn();function n(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,n,()=>e("click")]}class mn extends ae{constructor(e){super(),fe(this,e,Hd,Ud,oe,{})}}function rl(r,e,n){let t=new Set(r.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,n);if(!l)return null;if(t.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function Gd(r){let e,n;return e=new yn({props:{colorScale:ln,limits:$l}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Wd(r){let e,n;return e=new yn({props:{colorScale:ln,limits:Qn}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function qd(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;const g=[Wd,Gd],y=[];function h(v,b){return v[0]=="simd"?0:v[0]=="area"?1:-1}return~(f=h(r))&&(u=y[f]=g[f](r)),{c(){e=S("div"),n=S("label"),n.textContent="Metric",t=M(),l=S("select"),o=S("option"),o.textContent="None",i=S("option"),i.textContent="Area (km²)",s=S("option"),s.textContent="Fake SIMD (percentile)",a=M(),u&&u.c(),c=Ye(),N(n,"for","prioritization-selection"),o.__value="none",qe(o,o.__value),i.__value="area",qe(i,i.__value),s.__value="simd",qe(s,s.__value),N(l,"id","prioritization-selection"),r[0]===void 0&&sn(()=>r[1].call(l)),ie(e,"display","flex"),ie(e,"gap","16px"),ie(e,"align-items","center")},m(v,b){w(v,e,b),p(e,n),p(e,t),p(e,l),p(l,o),p(l,i),p(l,s),wt(l,r[0],!0),w(v,a,b),~f&&y[f].m(v,b),w(v,c,b),_=!0,d||(m=X(l,"change",r[1]),d=!0)},p(v,[b]){b&1&&wt(l,v[0]);let L=f;f=h(v),f!==L&&(u&&(he(),C(y[L],1,1,()=>{y[L]=null}),be()),~f?(u=y[f],u||(u=y[f]=g[f](v),u.c()),$(u,1),u.m(c.parentNode,c)):u=null)},i(v){_||($(u),_=!0)},o(v){C(u),_=!1},d(v){v&&(k(e),k(a),k(c)),~f&&y[f].d(v),d=!1,m()}}}function Jd(r,e,n){let t;V(r,Zt,s=>n(2,t=s));let{selectedPrioritization:l}=e;function o(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="area"?n(0,l="area"):s=="simd"&&n(0,l="simd")}t.startsWith("ltn_cnt/")?o():l="none";function i(){l=an(this),n(0,l)}return r.$$set=s=>{"selectedPrioritization"in s&&n(0,l=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);l=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",l),history.replaceState({},"",s)}},[l,i]}class gs extends ae{constructor(e){super(),fe(this,e,Jd,qd,oe,{selectedPrioritization:0})}}function Zd(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Yd(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Kd(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Ce({props:{$$slots:{default:[Zd]},$$scope:{ctx:r}}}),o.$on("click",r[13]),a=new Ce({props:{$$slots:{default:[Yd]},$$scope:{ctx:r}}}),a.$on("click",r[14]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),u.textContent="Use an auto-generated boundary",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&262144&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&262144&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||($(o.$$.fragment,_),$(a.$$.fragment,_),c=!0)},o(_){C(o.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),F(o),F(a)}}}function Ho(r){let e,n,t,l,o,i,s;function a(u){r[10](u)}let f={};return r[2]!==void 0&&(f.selectedPrioritization=r[2]),o=new gs({props:f}),ze.push(()=>nt(o,"selectedPrioritization",a)),{c(){e=S("h3"),e.textContent="Prioritization",n=M(),t=S("p"),t.textContent="Compare metrics across candidate neighbourhoods.",l=M(),T(o.$$.fragment)},m(u,c){w(u,e,c),w(u,n,c),w(u,t,c),w(u,l,c),A(o,u,c),s=!0},p(u,c){const _={};!i&&c&4&&(i=!0,_.selectedPrioritization=u[2],rt(()=>i=!1)),o.$set(_)},i(u){s||($(o.$$.fragment,u),s=!0)},o(u){C(o.$$.fragment,u),s=!1},d(u){u&&(k(e),k(n),k(t),k(l)),F(o,u)}}}function Go(r){let e;return{c(){e=S("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Xd(r){let e,n,t,l,o,i=r[4].startsWith("ltn_cnt/"),s,a,f,u,c,_,d,m,g,y,h,v,b,L;n=new mn({}),n.$on("click",r[9]);let I=i&&Ho(r),E=r[2]=="none"&&Go();return{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("p"),l.textContent=`Click an area to use it as the boundary for your neighbourhood. These
      particular boundaries are suggested by finding roads, railways, and water
      that form severances.`,o=M(),I&&I.c(),s=M(),E&&E.c(),a=M(),f=S("button"),f.textContent="Export to GeoJSON",u=M(),c=S("label"),_=j(`Minimum area (km²)
      `),d=S("input"),m=M(),g=S("label"),y=S("input"),h=j(`
      Remove areas not touching a big road`),N(f,"class","secondary"),N(d,"type","number"),N(d,"min","0"),N(d,"max","1"),N(d,"step","0.01"),N(y,"type","checkbox"),N(e,"slot","sidebar")},m(P,O){w(P,e,O),A(n,e,null),p(e,t),p(e,l),p(e,o),I&&I.m(e,null),p(e,s),E&&E.m(e,null),p(e,a),p(e,f),p(e,u),p(e,c),p(c,_),p(c,d),qe(d,r[0]),p(e,m),p(e,g),p(g,y),y.checked=r[1],p(g,h),v=!0,b||(L=[X(f,"click",r[7]),X(d,"input",r[11]),X(y,"change",r[12])],b=!0)},p(P,O){O&16&&(i=P[4].startsWith("ltn_cnt/")),i?I?(I.p(P,O),O&16&&$(I,1)):(I=Ho(P),I.c(),$(I,1),I.m(e,s)):I&&(he(),C(I,1,1,()=>{I=null}),be()),P[2]=="none"?E||(E=Go(),E.c(),E.m(e,a)):E&&(E.d(1),E=null),O&1&&fl(d.value)!==P[0]&&qe(d,P[0]),O&2&&(y.checked=P[1])},i(P){v||($(n.$$.fragment,P),$(I),v=!0)},o(P){C(n.$$.fragment,P),C(I),v=!1},d(P){P&&k(e),F(n),I&&I.d(),E&&E.d(),b=!1,ft(L)}}}function Vd(r){let e,n,t=r[17].area_km2.toFixed(1)+"",l,o,i;return{c(){e=S("b"),e.textContent="Area:",n=M(),l=j(t),o=j(` km²
          `),i=S("br")},m(s,a){w(s,e,a),w(s,n,a),w(s,l,a),w(s,o,a),w(s,i,a)},p(s,a){a&131072&&t!==(t=s[17].area_km2.toFixed(1)+"")&&le(l,t)},d(s){s&&(k(e),k(n),k(l),k(o),k(i))}}}function Qd(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[Vd,({props:t})=>({17:t}),({props:t})=>t?131072:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&393216&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function xd(r){let e,n,t=r[17].simd.toFixed(1)+"",l;return{c(){e=S("b"),e.textContent="SIMD:",n=M(),l=j(t)},m(o,i){w(o,e,i),w(o,n,i),w(o,l,i)},p(o,i){i&131072&&t!==(t=o[17].simd.toFixed(1)+"")&&le(l,t)},d(o){o&&(k(e),k(n),k(l))}}}function e_(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[xd,({props:t})=>({17:t}),({props:t})=>t?131072:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&393216&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function t_(r){let e,n,t=r[17].area_km2.toFixed(1)+"",l,o;return{c(){e=S("b"),e.textContent="Area:",n=M(),l=j(t),o=j(" km²")},m(i,s){w(i,e,s),w(i,n,s),w(i,l,s),w(i,o,s)},p(i,s){s&131072&&t!==(t=i[17].area_km2.toFixed(1)+"")&&le(l,t)},d(i){i&&(k(e),k(n),k(l),k(o))}}}function n_(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[t_,({props:t})=>({17:t}),({props:t})=>t?131072:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&393216&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function r_(r){let e,n,t,l,o,i,s,a;const f=[ye("auto-boundaries-severances"),{filter:Sc},{manageHoverState:!0},{paint:{"line-color":at("black","red"),"line-width":3}}];let u={};for(let h=0;h<f.length;h+=1)u=me(u,f[h]);e=new lt({props:u});const c=[ye("neighbourhood-boundaries",!1),{filter:r[8](r[0],r[1])},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":at(.2,.4)}},{layout:{visibility:r[2]=="none"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let _={$$slots:{default:[Qd]},$$scope:{ctx:r}};for(let h=0;h<c.length;h+=1)_=me(_,c[h]);t=new $t({props:_}),t.$on("click",r[6]);const d=[ye("neighbourhood-prioritization-simd"),{filter:r[8](r[0],r[1])},{paint:{"fill-color":Jt(["get","simd"],Qn,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[2]=="simd"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let m={$$slots:{default:[e_]},$$scope:{ctx:r}};for(let h=0;h<d.length;h+=1)m=me(m,d[h]);o=new $t({props:m}),o.$on("click",r[6]);const g=[ye("neighbourhood-prioritization-area"),{filter:r[8](r[0],r[1])},{paint:{"fill-color":Jt(["get","area_km2"],$l,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[2]=="area"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let y={$$slots:{default:[n_]},$$scope:{ctx:r}};for(let h=0;h<g.length;h+=1)y=me(y,g[h]);return s=new $t({props:y}),s.$on("click",r[6]),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),T(s.$$.fragment)},m(h,v){A(e,h,v),w(h,n,v),A(t,h,v),w(h,l,v),A(o,h,v),w(h,i,v),A(s,h,v),a=!0},p(h,v){const b={};e.$set(b);const L=v&263?Oe(c,[c[0],v&259&&{filter:h[8](h[0],h[1])},c[2],v&4&&{layout:{visibility:h[2]=="none"?"visible":"none"}},c[4],c[5]]):{};v&262144&&(L.$$scope={dirty:v,ctx:h}),t.$set(L);const I=v&263?Oe(d,[d[0],v&259&&{filter:h[8](h[0],h[1])},d[2],v&4&&{layout:{visibility:h[2]=="simd"?"visible":"none"}},d[4],d[5]]):{};v&262144&&(I.$$scope={dirty:v,ctx:h}),o.$set(I);const E=v&263?Oe(g,[g[0],v&259&&{filter:h[8](h[0],h[1])},g[2],v&4&&{layout:{visibility:h[2]=="area"?"visible":"none"}},g[4],g[5]]):{};v&262144&&(E.$$scope={dirty:v,ctx:h}),s.$set(E)},i(h){a||($(e.$$.fragment,h),$(t.$$.fragment,h),$(o.$$.fragment,h),$(s.$$.fragment,h),a=!0)},o(h){C(e.$$.fragment,h),C(t.$$.fragment,h),C(o.$$.fragment,h),C(s.$$.fragment,h),a=!1},d(h){h&&(k(n),k(l),k(i)),F(e,h),F(t,h),F(o,h),F(s,h)}}}function l_(r){let e,n,t;return n=new Ve({props:{data:r[5],generateId:!0,$$slots:{default:[r_]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),N(e,"slot","map")},m(l,o){w(l,e,o),A(n,e,null),t=!0},p(l,o){const i={};o&262151&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function o_(r){let e,n;return e=new At({props:{$$slots:{map:[l_],sidebar:[Xd],top:[Kd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&262175&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function i_(r,e,n){let t,l,o,i;V(r,de,L=>n(3,t=L)),V(r,Wn,L=>n(15,l=L)),V(r,xe,L=>n(16,o=L)),V(r,Zt,L=>n(4,i=L));let s=o.renderAutoBoundaries(),a=0,f=!0,u="none";function c(L){let I=rl(o,"What do you want to name the neighbourhood?","");if(I)try{let E={type:"Feature",properties:{},geometry:s.features[L.detail.features[0].id].geometry};o.setNeighbourhoodBoundary(I,E),Cn(),o.setCurrentNeighbourhood(I,l),ne(de,t={mode:"neighbourhood"},t)}catch(E){console.log("error when setting auto-generated neighborhood",E),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working.")}}function _(){gr("auto_boundaries.geojson",JSON.stringify(s,null,"  "))}function d(L,I){let E=["all",kc,[">=",["get","area_km2"],L]];return I&&E.push(["get","touches_big_road"]),E}const m=()=>ne(de,t={mode:"pick-neighbourhood"},t);function g(L){u=L,n(2,u)}function y(){a=fl(this.value),n(0,a)}function h(){f=this.checked,n(1,f)}return[a,f,u,t,i,s,c,_,d,m,g,y,h,()=>ne(de,t={mode:"title",firstLoad:!1},t),()=>ne(de,t={mode:"pick-neighbourhood"},t)]}class s_ extends ae{constructor(e){super(),fe(this,e,i_,o_,oe,{})}}function a_(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function f_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function u_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Ce({props:{$$slots:{default:[a_]},$$scope:{ctx:r}}}),o.$on("click",r[11]),a=new Ce({props:{$$slots:{default:[f_]},$$scope:{ctx:r}}}),a.$on("click",r[12]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),u.textContent="Debug demand model",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&65536&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&65536&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||($(o.$$.fragment,_),$(a.$$.fragment,_),c=!0)},o(_){C(o.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),F(o),F(a)}}}function c_(r){let e;return{c(){e=S("p"),e.textContent="Hover on a zone"},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function d_(r){let e,n=r[6].properties.name+"",t,l,o,i,s=r[6].properties.sum_from.toLocaleString()+"",a,f,u,c,_=r[6].properties.sum_to.toLocaleString()+"",d,m,g,y,h=r[6].properties.counts_from[r[3]]+"",v;return{c(){e=S("u"),t=j(n),l=M(),o=S("p"),i=j("Total trips from here: "),a=j(s),f=M(),u=S("p"),c=j("Total trips to here: "),d=j(_),m=M(),g=S("p"),y=j("Total intra-zonal trips starting and ending here: "),v=j(h)},m(b,L){w(b,e,L),p(e,t),w(b,l,L),w(b,o,L),p(o,i),p(o,a),w(b,f,L),w(b,u,L),p(u,c),p(u,d),w(b,m,L),w(b,g,L),p(g,y),p(g,v)},p(b,L){L&64&&n!==(n=b[6].properties.name+"")&&le(t,n),L&64&&s!==(s=b[6].properties.sum_from.toLocaleString()+"")&&le(a,s),L&64&&_!==(_=b[6].properties.sum_to.toLocaleString()+"")&&le(d,_),L&72&&h!==(h=b[6].properties.counts_from[b[3]]+"")&&le(v,h)},d(b){b&&(k(e),k(l),k(o),k(f),k(u),k(m),k(g))}}}function __(r){let e,n,t,l,o=r[0].features.length.toLocaleString()+"",i,s,a,f,u,c,_,d,m,g,y=r[1]?"from":"to",h,v,b=r[3]==null?"each zone":"this zone",L,I,E,P,O,B,D,R,z,U;n=new mn({}),n.$on("click",r[9]),P=new yn({props:{colorScale:fr,limits:r[5]}});function H(se,G){return se[6]&&se[3]!=null?d_:c_}let Y=H(r),Z=Y(r);return{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("p"),i=j(o),s=j(" zones"),a=M(),f=S("label"),u=j(`Trips from
      `),c=S("input"),_=j(`
      Trips to`),d=M(),m=S("p"),g=j("Trips "),h=j(y),v=M(),L=j(b),I=j(":"),E=M(),T(P.$$.fragment),O=M(),B=S("hr"),D=M(),Z.c(),N(c,"type","checkbox"),N(c,"role","switch"),N(e,"slot","sidebar")},m(se,G){w(se,e,G),A(n,e,null),p(e,t),p(e,l),p(l,i),p(l,s),p(e,a),p(e,f),p(f,u),p(f,c),c.checked=r[1],p(f,_),p(e,d),p(e,m),p(m,g),p(m,h),p(m,v),p(m,L),p(m,I),p(e,E),A(P,e,null),p(e,O),p(e,B),p(e,D),Z.m(e,null),R=!0,z||(U=X(c,"change",r[10]),z=!0)},p(se,G){(!R||G&1)&&o!==(o=se[0].features.length.toLocaleString()+"")&&le(i,o),G&2&&(c.checked=se[1]),(!R||G&2)&&y!==(y=se[1]?"from":"to")&&le(h,y),(!R||G&8)&&b!==(b=se[3]==null?"each zone":"this zone")&&le(L,b);const we={};G&32&&(we.limits=se[5]),P.$set(we),Y===(Y=H(se))&&Z?Z.p(se,G):(Z.d(1),Z=Y(se),Z&&(Z.c(),Z.m(e,null)))},i(se){R||($(n.$$.fragment,se),$(P.$$.fragment,se),R=!0)},o(se){C(n.$$.fragment,se),C(P.$$.fragment,se),R=!1},d(se){se&&k(e),F(n),F(P),Z.d(),z=!1,U()}}}function m_(r){let e,n,t,l,o;const i=[ye("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":at(.5,.1)}},{manageHoverState:!0}];function s(c){r[8](c)}let a={};for(let c=0;c<i.length;c+=1)a=me(a,i[c]);r[2]!==void 0&&(a.hovered=r[2]),e=new $t({props:a}),ze.push(()=>nt(e,"hovered",s));const f=[ye("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let u={};for(let c=0;c<f.length;c+=1)u=me(u,f[c]);return l=new lt({props:u}),{c(){T(e.$$.fragment),t=M(),T(l.$$.fragment)},m(c,_){A(e,c,_),w(c,t,_),A(l,c,_),o=!0},p(c,_){const d=_&16?Oe(i,[i[0],{paint:{"fill-color":c[4],"fill-opacity":at(.5,.1)}},i[2]]):{};!n&&_&4&&(n=!0,d.hovered=c[2],rt(()=>n=!1)),e.$set(d);const m={};l.$set(m)},i(c){o||($(e.$$.fragment,c),$(l.$$.fragment,c),o=!0)},o(c){C(e.$$.fragment,c),C(l.$$.fragment,c),o=!1},d(c){c&&k(t),F(e,c),F(l,c)}}}function p_(r){let e,n,t;return n=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[m_]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),N(e,"slot","map")},m(l,o){w(l,e,o),A(n,e,null),t=!0},p(l,o){const i={};o&1&&(i.data=l[0]),o&65556&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function g_(r){let e,n;return e=new At({props:{$$slots:{map:[p_],sidebar:[__],top:[u_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&65791&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function h_(r,e,n){let t,l,o,i,s,a;V(r,de,b=>n(7,s=b)),V(r,xe,b=>n(13,a=b));let f=rn();try{f=a.getDemandModel()}catch{window.alert("No demand model for this area"),ne(de,s={mode:"pick-neighbourhood"},s)}let u=!1,c=null;function _(b,L){if(b==null){let I=L?"sum_to":"sum_from",E=Math.max(...f.features.map(O=>O.properties[I])),P=d(E);return[P.map(O=>O.toLocaleString()),Jt(["get",I],P,fr)]}else{let I=L?"counts_to":"counts_from",E=[...f.features.map(B=>B.properties[I][b])],P=Math.max(...E),O=d(P);return[O.map(B=>B.toLocaleString()),Jt(["at",["id"],["literal",E]],O,fr)]}}function d(b){let L=fr.length+1;return Array.from(Array(L).keys()).map(I=>Math.round(b/(L-1)*I))}function m(b){c=b,n(2,c)}const g=()=>ne(de,s={mode:"pick-neighbourhood"},s);function y(){u=this.checked,n(1,u)}const h=()=>ne(de,s={mode:"title",firstLoad:!1},s),v=()=>ne(de,s={mode:"pick-neighbourhood"},s);return r.$$.update=()=>{r.$$.dirty&4&&n(3,t=c==null?null:c.id),r.$$.dirty&9&&n(6,l=t!=null?f.features[t]:null),r.$$.dirty&10&&n(5,[o,i]=_(t,u),o,(n(4,i),n(3,t),n(1,u),n(2,c)))},[f,u,c,t,i,o,l,s,m,g,y,h,v]}class b_ extends ae{constructor(e){super(),fe(this,e,h_,g_,oe,{})}}function $_(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function v_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function y_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Ce({props:{$$slots:{default:[$_]},$$scope:{ctx:r}}}),o.$on("click",r[8]),a=new Ce({props:{$$slots:{default:[v_]},$$scope:{ctx:r}}}),a.$on("click",r[9]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),u.textContent="Debug intersections",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||($(o.$$.fragment,_),$(a.$$.fragment,_),c=!0)},o(_){C(o.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),F(o),F(a)}}}function Wo(r){let e,n,t,l,o,i,s;function a(u){r[7](u)}let f={list:r[0].features};return r[1]!==void 0&&(f.idx=r[1]),t=new Tr({props:f}),ze.push(()=>nt(t,"idx",a)),{c(){e=S("button"),e.textContent="Pick another intersection",n=M(),T(t.$$.fragment),N(e,"class","secondary")},m(u,c){w(u,e,c),w(u,n,c),A(t,u,c),o=!0,i||(s=X(e,"click",r[6]),i=!0)},p(u,c){const _={};c&1&&(_.list=u[0].features),!l&&c&2&&(l=!0,_.idx=u[1],rt(()=>l=!1)),t.$set(_)},i(u){o||($(t.$$.fragment,u),o=!0)},o(u){C(t.$$.fragment,u),o=!1},d(u){u&&(k(e),k(n)),F(t,u),i=!1,s()}}}function w_(r){let e,n,t,l,o,i;n=new mn({}),n.$on("click",r[5]);let s=r[0].features.length>0&&Wo(r);return{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("p"),l.textContent="Purple intersections have some kind of turn restriction.",o=M(),s&&s.c(),N(e,"slot","sidebar")},m(a,f){w(a,e,f),A(n,e,null),p(e,t),p(e,l),p(e,o),s&&s.m(e,null),i=!0},p(a,f){a[0].features.length>0?s?(s.p(a,f),f&1&&$(s,1)):(s=Wo(a),s.c(),$(s,1),s.m(e,null)):s&&(he(),C(s,1,1,()=>{s=null}),be())},i(a){i||($(n.$$.fragment,a),$(s),i=!0)},o(a){C(n.$$.fragment,a),C(s),i=!1},d(a){a&&k(e),F(n),s&&s.d()}}}function k_(r){let e,n;const t=[ye("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new _n({props:l}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function S_(r){let e,n,t,l;const o=[ye("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<o.length;f+=1)i=me(i,o[f]);e=new lt({props:i});const s=[ye("debug-movements-fill"),{filter:["==",["id"],r[1]]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=me(a,s[f]);return t=new $t({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _=u&2?Oe(s,[s[0],{filter:["==",["id"],f[1]]},s[2]]):{};t.$set(_)},i(f){l||($(e.$$.fragment,f),$(t.$$.fragment,f),l=!0)},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),l=!1},d(f){f&&k(n),F(e,f),F(t,f)}}}function L_(r){let e,n,t,l,o;return n=new Ve({props:{data:tt(r[2]).getAllIntersections(),generateId:!0,$$slots:{default:[k_]},$$scope:{ctx:r}}}),l=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[S_]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),N(e,"slot","map")},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(l,e,null),o=!0},p(i,s){const a={};s&4&&(a.data=tt(i[2]).getAllIntersections()),s&1024&&(a.$$scope={dirty:s,ctx:i}),n.$set(a);const f={};s&1&&(f.data=i[0]),s&1026&&(f.$$scope={dirty:s,ctx:i}),l.$set(f)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&k(e),F(n),F(l)}}}function C_(r){let e,n;return e=new At({props:{$$slots:{map:[L_],sidebar:[w_],top:[y_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1039&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function M_(r,e,n){let t,l;V(r,xe,d=>n(2,t=d)),V(r,de,d=>n(3,l=d));let o=rn(),i=0;function s(d){n(0,o=t.getMovements(d.detail.features[0].id)),n(1,i=0)}const a=()=>ne(de,l={mode:"pick-neighbourhood"},l),f=()=>n(0,o=rn());function u(d){i=d,n(1,i)}return[o,i,t,l,s,a,f,u,()=>ne(de,l={mode:"title",firstLoad:!1},l),()=>ne(de,l={mode:"pick-neighbourhood"},l)]}class T_ extends ae{constructor(e){super(),fe(this,e,M_,C_,oe,{})}}function A_(r){let e,n,t,l,o,i;const s=[ye("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=me(a,s[d]);e=new $t({props:a});const f=[ye("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let u={};for(let d=0;d<f.length;d+=1)u=me(u,f[d]);t=new $t({props:u});const c=[ye("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=me(_,c[d]);return o=new lt({props:_}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,l,m),A(o,d,m),i=!0},p(d,[m]){const g=m&1?Oe(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const y={};t.$set(y);const h={};o.$set(h)},i(d){i||($(e.$$.fragment,d),$(t.$$.fragment,d),$(o.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(t.$$.fragment,d),C(o.$$.fragment,d),i=!1},d(d){d&&(k(n),k(l)),F(e,d),F(t,d),F(o,d)}}}function F_(r,e,n){let t;return V(r,pr,l=>n(0,t=l)),[t]}class Ar extends ae{constructor(e){super(),fe(this,e,F_,A_,oe,{})}}function P_(r){let e,n;const t=[ye("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new $t({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,[i]){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}class Fr extends ae{constructor(e){super(),fe(this,e,null,P_,oe,{})}}const E_=r=>({}),qo=r=>({});function Jo(r){let e;const n=r[7]["line-popup"],t=Re(n,r,r[9],qo);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&512)&&De(t,n,l,l[9],e?He(n,l[9],o,E_):Ue(l[9]),qo)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function I_(r){let e,n,t=r[0]&&Jo(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,o){l[0]?t?(t.p(l,o),o&1&&$(t,1)):(t=Jo(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function N_(r){let e,n,t,l;const o=[ye("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let f=0;f<o.length;f+=1)i=me(i,o[f]);e=new lt({props:i});const s=[ye("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":at(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[I_]},$$scope:{ctx:r}};for(let f=0;f<s.length;f+=1)a=me(a,s[f]);return t=new lt({props:a}),t.$on("click",r[8]),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),l=!0},p(f,[u]){const c=u&84?Oe(o,[o[0],o[1],{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=u&125?Oe(s,[s[0],s[1],u&124&&{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":f[5](f[3],f[4].maxShortcuts),"line-opacity":at(1,.5)}},u&1&&{manageHoverState:f[0]},u&1&&{hoverCursor:f[0]?"pointer":void 0}]):{};u&513&&(_.$$scope={dirty:u,ctx:f}),t.$set(_)},i(f){l||($(e.$$.fragment,f),$(t.$$.fragment,f),l=!0)},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),l=!1},d(f){f&&k(n),F(e,f),F(t,f)}}}function j_(r,e,n){let t,l;V(r,Jr,d=>n(2,t=d)),V(r,pr,d=>n(3,l=d));let{$$slots:o={},$$scope:i}=e,s=ul("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:f=(d,m)=>{}}=e;function u(d,m){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?Jt(["get","speed_mph"],ds,cs):m<=2?at("white","blue"):at(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",m,"#A32015"],bn.mapFeature.hover.backgroundColor)}function c(d,m,g){return!d||m<=2?on(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,m,25+g]}const _=d=>a&&f(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&n(0,a=d.interactive),"onClickLine"in d&&n(1,f=d.onClickLine),"$$scope"in d&&n(9,i=d.$$scope)},[a,f,t,l,s,u,c,o,_,i]}class xn extends ae{constructor(e){super(),fe(this,e,j_,N_,oe,{interactive:0,onClickLine:1})}}function z_(r){let e;const n=r[3].default,t=Re(n,r,r[5],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&32)&&De(t,n,l,l[5],e?He(n,l[5],o,null):Ue(l[5]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function O_(r){let e,n,t,l;const o=[ye("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[z_]},$$scope:{ctx:r}};for(let f=0;f<o.length;f+=1)i=me(i,o[f]);e=new vr({props:i}),e.$on("click",r[4]);const s=[ye("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let f=0;f<s.length;f+=1)a=me(a,s[f]);return t=new vr({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),l=!0},p(f,u){const c={};u&32&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};t.$set(_)},i(f){l||($(e.$$.fragment,f),$(t.$$.fragment,f),l=!0)},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),l=!1},d(f){f&&k(n),F(e,f),F(t,f)}}}function B_(r){let e,n;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[O_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&32&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function R_(r,e,n){let t,l,o;V(r,xe,f=>n(1,l=f)),V(r,Nt,f=>n(2,o=f));let{$$slots:i={},$$scope:s}=e;function a(f){je.call(this,r,f)}return r.$$set=f=>{"$$scope"in f&&n(5,s=f.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=o>0?l.renderModalFilters():rn())},[t,l,o,i,a,s]}class pn extends ae{constructor(e){super(),fe(this,e,R_,B_,oe,{})}}function D_(r){let e,n;const t=[ye("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new vr({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,[i]){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}class Pr extends ae{constructor(e){super(),fe(this,e,null,D_,oe,{})}}function U_(r){let e;const n=r[3].default,t=Re(n,r,r[4],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16)&&De(t,n,l,l[4],e?He(n,l[4],o,null):Ue(l[4]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function H_(r){let e,n;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[U_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function G_(r,e,n){let t,l;V(r,xe,a=>n(2,l=a));let{$$slots:o={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&n(1,s=a.input),"$$scope"in a&&n(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=s||l.renderNeighbourhood()),r.$$.dirty&1&&Gi("neighbourhoodGj",t)},[t,s,l,o,i]}class er extends ae{constructor(e){super(),fe(this,e,G_,H_,oe,{input:1})}}function W_(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function q_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function J_(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Z_(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Ce({props:{$$slots:{default:[W_]},$$scope:{ctx:r}}}),o.$on("click",r[8]),a=new Ce({props:{$$slots:{default:[q_]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new Ce({props:{$$slots:{default:[J_]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),T(c.$$.fragment),_=M(),d=S("li"),d.textContent="Debug mode",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){w(g,e,y),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),A(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&4096&&(h.$$scope={dirty:y,ctx:g}),o.$set(h);const v={};y&4096&&(v.$$scope={dirty:y,ctx:g}),a.$set(v);const b={};y&4096&&(b.$$scope={dirty:y,ctx:g}),c.$set(b)},i(g){m||($(o.$$.fragment,g),$(a.$$.fragment,g),$(c.$$.fragment,g),m=!0)},o(g){C(o.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),m=!1},d(g){g&&k(e),F(o),F(a),F(c)}}}function Zo(r){let e,n,t;return{c(){e=S("button"),e.textContent="Ⓧ",N(e,"class","close-btn svelte-khnvno")},m(l,o){w(l,e,o),n||(t=X(e,"click",r[6]),n=!0)},p:Q,d(l){l&&k(e),n=!1,t()}}}function Y_(r){let e;return{c(){e=S("p"),e.textContent="Click an intersection to inspect its movements."},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}function K_(r){let e,n,t,l,o,i,s;e=new Xn({props:{properties:r[0].feature.properties}});function a(u){r[7](u)}let f={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(f.idx=r[0].movementIdx),o=new Tr({props:f}),ze.push(()=>nt(o,"idx",a)),{c(){T(e.$$.fragment),n=M(),t=S("h5"),t.textContent="Turn restrictions:",l=M(),T(o.$$.fragment)},m(u,c){A(e,u,c),w(u,n,c),w(u,t,c),w(u,l,c),A(o,u,c),s=!0},p(u,c){const _={};c&1&&(_.properties=u[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=u[0].movements.features),!i&&c&1&&(i=!0,d.idx=u[0].movementIdx,rt(()=>i=!1)),o.$set(d)},i(u){s||($(e.$$.fragment,u),$(o.$$.fragment,u),s=!0)},o(u){C(e.$$.fragment,u),C(o.$$.fragment,u),s=!1},d(u){u&&(k(n),k(t),k(l)),F(e,u),F(o,u)}}}function X_(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;n=new mn({}),n.$on("click",r[5]);let g=r[0]&&Zo(r);const y=[K_,Y_],h=[];function v(b,L){return b[0]?0:1}return _=v(r),d=h[_]=y[_](r),{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("h4"),l.textContent="Roads",o=M(),i=S("p"),i.textContent="Click a road to visit its OSM object.",s=M(),a=S("div"),f=S("h4"),f.textContent="Intersections",u=M(),g&&g.c(),c=M(),d.c(),ie(a,"display","flex"),ie(a,"align-items","start"),ie(a,"justify-content","space-between"),N(e,"slot","sidebar")},m(b,L){w(b,e,L),A(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(e,s),p(e,a),p(a,f),p(a,u),g&&g.m(a,null),p(e,c),h[_].m(e,null),m=!0},p(b,L){b[0]?g?g.p(b,L):(g=Zo(b),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let I=_;_=v(b),_===I?h[_].p(b,L):(he(),C(h[I],1,1,()=>{h[I]=null}),be(),d=h[_],d?d.p(b,L):(d=h[_]=y[_](b),d.c()),$(d,1),d.m(e,null))},i(b){m||($(n.$$.fragment,b),$(d),m=!0)},o(b){C(n.$$.fragment,b),C(d),m=!1},d(b){b&&k(e),F(n),g&&g.d(),h[_].d()}}}function V_(r){let e,n;return e=new Xn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Q_(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[V_,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function x_(r){let e,n;return e=new Xn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function em(r){let e,n,t;return n=new ut({props:{openOn:"hover",$$slots:{default:[x_,({props:l})=>({11:l}),({props:l})=>l?2048:0]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){w(l,e,o),A(n,e,null),t=!0},p(l,o){const i={};o&6144&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function tm(r){let e,n,t,l,o,i,s,a,f,u;e=new Fr({}),t=new Ar({}),o=new Pr({});const c=[ye("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[Q_]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=me(_,c[d]);return s=new _n({props:_}),f=new xn({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[em]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),T(s.$$.fragment),a=M(),T(f.$$.fragment)},m(d,m){A(e,d,m),w(d,n,m),A(t,d,m),w(d,l,m),A(o,d,m),w(d,i,m),A(s,d,m),w(d,a,m),A(f,d,m),u=!0},p(d,m){const g={};m&4096&&(g.$$scope={dirty:m,ctx:d}),s.$set(g);const y={};m&4096&&(y.$$scope={dirty:m,ctx:d}),f.$set(y)},i(d){u||($(e.$$.fragment,d),$(t.$$.fragment,d),$(o.$$.fragment,d),$(s.$$.fragment,d),$(f.$$.fragment,d),u=!0)},o(d){C(e.$$.fragment,d),C(t.$$.fragment,d),C(o.$$.fragment,d),C(s.$$.fragment,d),C(f.$$.fragment,d),u=!1},d(d){d&&(k(n),k(l),k(i),k(a)),F(e,d),F(t,d),F(o,d),F(s,d),F(f,d)}}}function nm(r){let e,n;return e=new Xn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function rm(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[nm,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function lm(r){let e,n;return e=new Xn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function om(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[lm,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function im(r){var o,i,s;let e,n;const t=[ye("debug-intersections"),{paint:{"circle-radius":Qr(30),"circle-color":bn.mapFeature.hover.backgroundColor,"circle-stroke-color":bn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(o=r[0])==null?void 0:o.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,at(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[om]},$$scope:{ctx:r}};for(let a=0;a<t.length;a+=1)l=me(l,t[a]);return e=new _n({props:l}),e.$on("click",r[3]),{c(){T(e.$$.fragment)},m(a,f){A(e,a,f),n=!0},p(a,f){var c,_,d;const u=f&1?Oe(t,[t[0],{paint:{"circle-radius":Qr(30),"circle-color":bn.mapFeature.hover.backgroundColor,"circle-stroke-color":bn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,at(0,.5)]}},t[2],t[3]]):{};f&4096&&(u.$$scope={dirty:f,ctx:a}),e.$set(u)},i(a){n||($(e.$$.fragment,a),n=!0)},o(a){C(e.$$.fragment,a),n=!1},d(a){F(e,a)}}}function Yo(r){let e,n;return e=new Ve({props:{data:r[0].movements,generateId:!0,$$slots:{default:[sm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.data=t[0].movements),l&4097&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function sm(r){let e,n,t,l;const o=[ye("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<o.length;f+=1)i=me(i,o[f]);e=new lt({props:i});const s=[ye("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=me(a,s[f]);return t=new $t({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _=u&1?Oe(s,[s[0],{filter:["==",["id"],f[0].movementIdx]},s[2]]):{};t.$set(_)},i(f){l||($(e.$$.fragment,f),$(t.$$.fragment,f),l=!0)},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),l=!1},d(f){f&&k(n),F(e,f),F(t,f)}}}function am(r){let e,n,t,l,o,i,s,a;n=new er({props:{$$slots:{default:[tm]},$$scope:{ctx:r}}}),l=new pn({props:{$$slots:{default:[rm]},$$scope:{ctx:r}}}),i=new Ve({props:{data:tt(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[im]},$$scope:{ctx:r}}});let f=r[0]&&Yo(r);return{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),o=M(),T(i.$$.fragment),s=M(),f&&f.c(),N(e,"slot","map")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),A(l,e,null),p(e,o),A(i,e,null),p(e,s),f&&f.m(e,null),a=!0},p(u,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:u}),l.$set(d);const m={};c&2&&(m.data=tt(u[1]).getAllIntersections()),c&4097&&(m.$$scope={dirty:c,ctx:u}),i.$set(m),u[0]?f?(f.p(u,c),c&1&&$(f,1)):(f=Yo(u),f.c(),$(f,1),f.m(e,null)):f&&(he(),C(f,1,1,()=>{f=null}),be())},i(u){a||($(n.$$.fragment,u),$(l.$$.fragment,u),$(i.$$.fragment,u),$(f),a=!0)},o(u){C(n.$$.fragment,u),C(l.$$.fragment,u),C(i.$$.fragment,u),C(f),a=!1},d(u){u&&k(e),F(n),F(l),F(i),f&&f.d()}}}function fm(r){let e,n;return e=new At({props:{$$slots:{map:[am],sidebar:[X_],top:[Z_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&4103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function um(r,e,n){let t,l;V(r,xe,m=>n(1,t=m)),V(r,de,m=>n(2,l=m));let o=null;function i(m){let g=m.detail.features[0],y=t.getMovements(g.properties.intersection_id);n(0,o={feature:g,movements:y,movementIdx:0})}const s=(m,g)=>window.open(tt(m.properties).way,"_blank"),a=()=>ne(de,l={mode:"neighbourhood"},l),f=()=>n(0,o=null);function u(m){r.$$.not_equal(o.movementIdx,m)&&(o.movementIdx=m,n(0,o))}return[o,t,l,i,s,a,f,u,()=>ne(de,l={mode:"title",firstLoad:!1},l),()=>ne(de,l={mode:"pick-neighbourhood"},l),()=>ne(de,l={mode:"neighbourhood"},l)]}class cm extends ae{constructor(e){super(),fe(this,e,um,fm,oe,{})}}var It=63710088e-1,hs={centimeters:It*100,centimetres:It*100,degrees:360/(2*Math.PI),feet:It*3.28084,inches:It*39.37,kilometers:It/1e3,kilometres:It/1e3,meters:It,metres:It,miles:It/1609.344,millimeters:It*1e3,millimetres:It*1e3,nauticalmiles:It/1852,radians:1,yards:It*1.0936};function dm(r,e,n={}){const t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function ll(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ko(r[0])||!Ko(r[1]))throw new Error("coordinates must contain numbers");return dm({type:"Point",coordinates:r},e,n)}function _m(r,e="kilometers"){const n=hs[e];if(!n)throw new Error(e+" units is invalid");return r*n}function mm(r,e="kilometers"){const n=hs[e];if(!n)throw new Error(e+" units is invalid");return r/n}function ol(r){return r%(2*Math.PI)*180/Math.PI}function Wt(r){return r%360*Math.PI/180}function Ko(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Kn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function pm(r){return r.type==="Feature"?r.geometry:r}function bs(r,e,n={}){if(n.final===!0)return gm(r,e);const t=Kn(r),l=Kn(e),o=Wt(t[0]),i=Wt(l[0]),s=Wt(t[1]),a=Wt(l[1]),f=Math.sin(i-o)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-o);return ol(Math.atan2(f,u))}function gm(r,e){let n=bs(e,r);return n=(n+180)%360,n}function hm(r,e,n,t={}){const l=Kn(r),o=Wt(l[0]),i=Wt(l[1]),s=Wt(n),a=mm(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=ol(u),_=ol(f);return ll([c,_],t.properties)}function bm(r,e,n={}){var t=Kn(r),l=Kn(e),o=Wt(l[1]-t[1]),i=Wt(l[0]-t[0]),s=Wt(t[1]),a=Wt(l[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return _m(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function $m(r,e,n={}){const l=pm(r).coordinates;let o=0;for(let i=0;i<l.length&&!(e>=o&&i===l.length-1);i++)if(o>=e){const s=e-o;if(s){const a=bs(l[i],l[i-1])-180;return hm(l[i],s,a,n)}else return ll(l[i])}else o+=bm(l[i],l[i+1],n);return ll(l[l.length-1])}var vm=$m;function ym(r){let e,n;const t=[ye("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new _n({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function wm(r){let e,n;return e=new Ve({props:{data:r[0],$$slots:{default:[ym]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}let km=50,Sm=100,Lm=.01;function Cm(r,e,n){let{paths:t}=e,l=a(),o=f(),i=c(),s=setInterval(_,Sm);Tt(()=>clearInterval(s));function a(){return t.features.map(d=>1/d.properties.directness).reduce((d,m)=>d+m,0)}function f(){return t.features.length==0?[]:Array.from({length:km},u)}function u(){let d=Math.random()*l,m=0;for(let[g,y]of t.features.entries())if(m+=1/y.properties.directness,d<m)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function c(){return{type:"FeatureCollection",features:o.map(({idx:d,distance:m})=>vm(t.features[d],m,{units:"kilometers"}))}}function _(){for(let[d,m]of o.entries())m.distance+=Lm,m.distance>=t.features[m.idx].properties.length_meters/1e3&&(o[d]=u());n(0,i=c())}return r.$$set=d=>{"paths"in d&&n(1,t=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&t&&(l=a(),o=f())},[i,t]}class Mm extends ae{constructor(e){super(),fe(this,e,Cm,wm,oe,{paths:1})}}class Tm{constructor(e){pt(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function Am(r){let e,n,t,l,o;return{c(){e=S("div"),e.textContent="+",n=M(),t=S("img"),o=j(`
    Add diagonal filter`),ie(e,"font-size","200%"),ie(e,"margin-top","-12px"),N(e,"class","icon"),Ke(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Add diagonal filter"),ie(t,"transform","rotate(135deg)"),N(t,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,o,s)},p:Q,d(i){i&&(k(e),k(n),k(t),k(o))}}}function Fm(r){let e;function n(o,i){return o[0].hasRotatedFilter?Em:Pm}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),w(o,e,i)},p(o,i){t!==(t=n(o))&&(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},d(o){o&&k(e),l.d(o)}}}function Pm(r){let e,n,t,l,o;return{c(){e=S("div"),e.textContent="↻",n=M(),t=S("img"),o=j(`
      Rotate diagonal filter`),ie(e,"font-size","200%"),ie(e,"padding-bottom","4px"),N(e,"class","icon"),Ke(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Rotate diagonal filter"),ie(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,o,s)},d(i){i&&(k(e),k(n),k(t),k(o))}}}function Em(r){let e,n,t,l,o;return{c(){e=S("div"),e.textContent="❌",n=M(),t=S("img"),o=j(`
      Delete diagonal filter`),N(e,"class","icon"),Ke(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Remove diagonal filter"),ie(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,o,s)},d(i){i&&(k(e),k(n),k(t),k(o))}}}function Im(r){let e;function n(o,i){return o[0].filter?Fm:Am}let t=n(r),l=t(r);return{c(){e=S("div"),l.c(),ie(e,"display","flex"),ie(e,"align-items","center")},m(o,i){w(o,e,i),l.m(e,null)},p(o,[i]){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e,null)))},i:Q,o:Q,d(o){o&&k(e),l.d()}}}function Nm(r,e,n){let{intersection:t}=e;return r.$$set=l=>{"intersection"in l&&n(0,t=l.intersection)},[t]}class jm extends ae{constructor(e){super(),fe(this,e,Nm,Im,oe,{intersection:0})}}function zm(r){let e,n;return e=new jm({props:{intersection:r[2](r[6])}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&64&&(o.intersection=t[2](t[6])),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Om(r){let e,n;return e=new Df({props:{openOn:"hover",$$slots:{default:[zm,({features:t})=>({6:t}),({features:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Bm(r){let e,n;const t=[ye("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":Qr(30),"circle-color":bn.mapFeature.hover.backgroundColor,"circle-opacity":at(0,.5),"circle-stroke-color":bn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[Om]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new _n({props:l}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,[i]){const s=i&2?Oe(t,[t[0],t[1],t[2],{interactive:o[1]},t[4],t[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Rm(r,e,n){let{neighbourhood:t=ul("neighbourhoodGj")}=e,{onClickIntersection:l=f=>{}}=e,{interactive:o=!1}=e;function i(f){let u=t.features[f];return new Tm(u)}function s(f){return i(f[0].id)}const a=f=>l(s(f.detail.features));return r.$$set=f=>{"neighbourhood"in f&&n(3,t=f.neighbourhood),"onClickIntersection"in f&&n(0,l=f.onClickIntersection),"interactive"in f&&n(1,o=f.interactive)},[l,o,s,t,a]}class Dm extends ae{constructor(e){super(),fe(this,e,Rm,Bm,oe,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function Xo(r,e,n){const t=r.slice();return t[7]=e[n][0],t[8]=e[n][1],t[9]=e[n][2],t}function Vo(r){let e,n,t,l,o,i,s=r[8]+"",a,f,u,c,_;function d(){return r[3](r[7])}return{c(){e=S("button"),n=S("img"),l=M(),o=S("br"),i=M(),a=j(s),f=M(),Ke(n.src,t=`/ltn//filters/${r[7]}_icon.gif`)||N(n,"src",t),N(n,"width","80"),N(n,"alt",r[8]),N(e,"class","outline"),ie(e,"width","100%"),e.disabled=u=r[0]==r[7]},m(m,g){w(m,e,g),p(e,n),p(e,l),p(e,o),p(e,i),p(e,a),p(e,f),c||(_=X(e,"click",d),c=!0)},p(m,g){r=m,g&1&&u!==(u=r[0]==r[7])&&(e.disabled=u)},d(m){m&&k(e),c=!1,_()}}}function Um(r){let e,n,t,l,o,i,s,a,f,u,c,_,d=r[1][2]+"",m,g,y,h,v,b,L=Me(r[2]),I=[];for(let P=0;P<L.length;P+=1)I[P]=Vo(Xo(r,L,P));function E(){return r[4](r[6])}return{c(){e=S("h3"),e.textContent="Choose a modal filter to place on streets",n=M(),t=S("table"),l=S("tr"),o=S("td");for(let P=0;P<I.length;P+=1)I[P].c();i=M(),s=S("td"),a=S("img"),c=M(),_=S("p"),m=j(d),g=M(),y=S("center"),h=S("button"),h.textContent="Confirm",Ke(a.src,f=`/ltn//filters/${r[0]}.gif`)||N(a,"src",f),N(a,"height","300"),N(a,"alt",u=r[1][1])},m(P,O){w(P,e,O),w(P,n,O),w(P,t,O),p(t,l),p(l,o);for(let B=0;B<I.length;B+=1)I[B]&&I[B].m(o,null);p(l,i),p(l,s),p(s,a),p(s,c),p(s,_),p(_,m),w(P,g,O),w(P,y,O),p(y,h),v||(b=X(h,"click",E),v=!0)},p(P,O){if(r=P,O&5){L=Me(r[2]);let B;for(B=0;B<L.length;B+=1){const D=Xo(r,L,B);I[B]?I[B].p(D,O):(I[B]=Vo(D),I[B].c(),I[B].m(o,null))}for(;B<I.length;B+=1)I[B].d(1);I.length=L.length}O&1&&!Ke(a.src,f=`/ltn//filters/${r[0]}.gif`)&&N(a,"src",f),O&2&&u!==(u=r[1][1])&&N(a,"alt",u),O&2&&d!==(d=r[1][2]+"")&&le(m,d)},d(P){P&&(k(e),k(n),k(t),k(g),k(y)),dt(I,P),v=!1,b()}}}function Hm(r){let e,n;return e=new kr({props:{$$slots:{default:[Um,({dialog:t})=>({6:t}),({dialog:t})=>t?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&4163&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Gm(r,e,n){let t,l;V(r,Zr,f=>n(0,l=f));let o=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const i=f=>ne(Zr,l=f,l),s=f=>tt(f).close();function a(f){je.call(this,r,f)}return r.$$.update=()=>{r.$$.dirty&1&&n(1,t=o.find(f=>f[0]==l))},[l,t,o,i,s,a]}class Wm extends ae{constructor(e){super(),fe(this,e,Gm,Hm,oe,{})}}function Qo(r){let e,n;return e=new Ve({props:{data:r[0],$$slots:{default:[qm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.data=t[0]),l&64&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function qm(r){let e,n;const t=[ye("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Jm(r){let e,n,t=r[0]&&Qo(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&$(t,1)):(t=Qo(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function Zm(r,e,n){let{map:t}=e,l=null;const o=dn();t.on("dragstart",i),t.on("mousemove",s),t.on("mouseup",a),Tt(()=>{t.dragPan.enable(),t.off("dragstart",i),t.off("mousemove",s),t.off("mouseup",a)});function i(){t.dragPan.disable(),n(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(f){l&&(l.geometry.coordinates.push(f.lngLat.toArray()),n(0,l))}function a(){l&&(o("done",l),n(0,l=null))}return r.$$set=f=>{"map"in f&&n(1,t=f.map)},[l,t]}class Ym extends ae{constructor(e){super(),fe(this,e,Zm,Jm,oe,{map:1})}}function Km(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Xm(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Vm(r){let e;return{c(){e=S("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Qm(r){let e;return{c(){e=j("View shortcuts")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function xm(r){let e;return{c(){e=j("Route")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function ep(r){let e;return{c(){e=j("Impact routing to one destination")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function tp(r){let e;return{c(){e=j("Change this boundary")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function np(r){let e;return{c(){e=j("Debug")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function rp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,v,b,L,I,E,P,O,B,D,R,z,U,H;return o=new Ce({props:{$$slots:{default:[Km]},$$scope:{ctx:r}}}),o.$on("click",r[31]),a=new Ce({props:{$$slots:{default:[Xm]},$$scope:{ctx:r}}}),a.$on("click",r[32]),_=new Dt({props:{$$slots:{default:[Vm]},$$scope:{ctx:r}}}),h=new Ce({props:{$$slots:{default:[Qm]},$$scope:{ctx:r}}}),h.$on("click",r[33]),L=new Ce({props:{$$slots:{default:[xm]},$$scope:{ctx:r}}}),L.$on("click",r[34]),P=new Ce({props:{$$slots:{default:[ep]},$$scope:{ctx:r}}}),P.$on("click",r[35]),D=new Ce({props:{$$slots:{default:[tp]},$$scope:{ctx:r}}}),D.$on("click",r[36]),U=new Ce({props:{$$slots:{default:[np]},$$scope:{ctx:r}}}),U.$on("click",r[37]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),c=j(`Editing
          `),T(_.$$.fragment),d=M(),m=S("nav"),g=S("ul"),y=S("li"),T(h.$$.fragment),v=M(),b=S("li"),T(L.$$.fragment),I=M(),E=S("li"),T(P.$$.fragment),O=M(),B=S("li"),T(D.$$.fragment),R=M(),z=S("li"),T(U.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),ie(e,"display","flex"),ie(e,"justify-content","space-between")},m(Y,Z){w(Y,e,Z),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),p(u,c),A(_,u,null),p(e,d),p(e,m),p(m,g),p(g,y),A(h,y,null),p(g,v),p(g,b),A(L,b,null),p(g,I),p(g,E),A(P,E,null),p(g,O),p(g,B),A(D,B,null),p(g,R),p(g,z),A(U,z,null),H=!0},p(Y,Z){const se={};Z[1]&1024&&(se.$$scope={dirty:Z,ctx:Y}),o.$set(se);const G={};Z[1]&1024&&(G.$$scope={dirty:Z,ctx:Y}),a.$set(G);const we={};Z[1]&1024&&(we.$$scope={dirty:Z,ctx:Y}),_.$set(we);const x={};Z[1]&1024&&(x.$$scope={dirty:Z,ctx:Y}),h.$set(x);const ue={};Z[1]&1024&&(ue.$$scope={dirty:Z,ctx:Y}),L.$set(ue);const ve={};Z[1]&1024&&(ve.$$scope={dirty:Z,ctx:Y}),P.$set(ve);const ce={};Z[1]&1024&&(ce.$$scope={dirty:Z,ctx:Y}),D.$set(ce);const Fe={};Z[1]&1024&&(Fe.$$scope={dirty:Z,ctx:Y}),U.$set(Fe)},i(Y){H||($(o.$$.fragment,Y),$(a.$$.fragment,Y),$(_.$$.fragment,Y),$(h.$$.fragment,Y),$(L.$$.fragment,Y),$(P.$$.fragment,Y),$(D.$$.fragment,Y),$(U.$$.fragment,Y),H=!0)},o(Y){C(o.$$.fragment,Y),C(a.$$.fragment,Y),C(_.$$.fragment,Y),C(h.$$.fragment,Y),C(L.$$.fragment,Y),C(P.$$.fragment,Y),C(D.$$.fragment,Y),C(U.$$.fragment,Y),H=!1},d(Y){Y&&k(e),F(o),F(a),F(_),F(h),F(L),F(P),F(D),F(U)}}}function xo(r){let e;return{c(){e=S("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function ei(r){let e,n;return e=new yn({props:{colorScale:cs,limits:ds}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function lp(r){let e,n,t;return{c(){e=j("Undo ("),n=j(r[4]),t=j(")")},m(l,o){w(l,e,o),w(l,n,o),w(l,t,o)},p(l,o){o[0]&16&&le(n,l[4])},d(l){l&&(k(e),k(n),k(t))}}}function op(r){let e;return{c(){e=j("Undo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function ip(r){let e,n,t;return{c(){e=j("Redo ("),n=j(r[5]),t=j(")")},m(l,o){w(l,e,o),w(l,n,o),w(l,t,o)},p(l,o){o[0]&32&&le(n,l[5])},d(l){l&&(k(e),k(n),k(t))}}}function sp(r){let e;return{c(){e=j("Redo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function ti(r){let e,n;return e=new Wm({}),e.$on("close",r[30]),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ap(r){let e,n,t,l,o=tt(r[6]).properties.name+"",i,s,a=tt(r[6]).properties.area_km2.toFixed(1)+"",f,u,c,_,d,m,g,y,h,v,b,L,I,E,P,O,B,D,R,z,U,H,Y,Z,se,G,we,x,ue,ve,ce,Fe,Ze,Te,re,Je,Ne,ke,K,pe,ee,ge,$e,Se,W,_t,Be,Ge,kt,bt=r[8]>0&&xo(),Qe=r[12]=="speeds"&&ei();function xt(Pe,it){return Pe[4]==0?op:lp}let en=xt(r),St=en(r);function nr(Pe,it){return Pe[5]==0?sp:ip}let Ft=nr(r),Pt=Ft(r),ot=r[3]&&ti(r);return{c(){e=S("div"),n=S("p"),t=j("Editing neighbourhood "),l=S("u"),i=j(o),s=j(`
      , with an area of `),f=j(a),u=j(" km²"),c=M(),bt&&bt.c(),_=M(),d=S("div"),m=S("button"),g=S("img"),h=j(`
        Add a modal filter`),b=M(),L=S("button"),I=j("Add many modal filters along line"),P=M(),O=S("button"),B=j("Reverse directions"),R=M(),z=S("button"),z.textContent="Change modal filter type",U=M(),H=S("label"),Y=S("input"),Z=j(`
      Animate shortcuts`),se=M(),G=S("label"),we=S("input"),x=j(`
      Include perimeter roads`),ue=M(),ve=S("div"),ce=S("label"),Fe=j(`Draw roads:
        `),Ze=S("select"),Te=S("option"),Te.textContent="Worst shortcuts",re=S("option"),re.textContent="Cell",Je=S("option"),Je.textContent="Edits (either filter or direction)",Ne=S("option"),Ne.textContent="Speed limit",ke=M(),Qe&&Qe.c(),K=M(),pe=S("div"),ee=S("button"),St.c(),$e=M(),Se=S("button"),Pt.c(),_t=M(),ot&&ot.c(),Ke(g.src,y=`/ltn//filters/${r[9]}_icon.gif`)||N(g,"src",y),N(g,"width","30"),N(g,"alt","Add a modal filter"),m.disabled=v=r[0]=="filter",N(m,"data-tooltip","hotkey 1"),L.disabled=E=r[0]=="freehand-filters",N(L,"data-tooltip","hotkey 2"),O.disabled=D=r[0]=="oneway",N(O,"data-tooltip","hotkey 3"),ie(d,"display","flex"),ie(d,"justify-content","space-between"),N(Y,"type","checkbox"),N(we,"type","checkbox"),Te.__value="shortcuts",qe(Te,Te.__value),re.__value="cells",qe(re,re.__value),Je.__value="edits",qe(Je,Je.__value),Ne.__value="speeds",qe(Ne,Ne.__value),r[12]===void 0&&sn(()=>r[29].call(Ze)),ie(ve,"border","1px solid black"),ie(ve,"padding","4px"),ee.disabled=ge=r[4]==0,N(ee,"data-tooltip","Ctrl+Z"),Se.disabled=W=r[5]==0,N(Se,"data-tooltip","Ctrl+Y"),ie(pe,"display","flex"),ie(pe,"justify-content","space-between"),N(e,"slot","sidebar")},m(Pe,it){w(Pe,e,it),p(e,n),p(n,t),p(n,l),p(l,i),p(n,s),p(n,f),p(n,u),p(e,c),bt&&bt.m(e,null),p(e,_),p(e,d),p(d,m),p(m,g),p(m,h),p(d,b),p(d,L),p(L,I),p(d,P),p(d,O),p(O,B),p(e,R),p(e,z),p(e,U),p(e,H),p(H,Y),Y.checked=r[11],p(H,Z),p(e,se),p(e,G),p(G,we),we.checked=r[10],p(G,x),p(e,ue),p(e,ve),p(ve,ce),p(ce,Fe),p(ce,Ze),p(Ze,Te),p(Ze,re),p(Ze,Je),p(Ze,Ne),wt(Ze,r[12],!0),p(ve,ke),Qe&&Qe.m(ve,null),p(e,K),p(e,pe),p(pe,ee),St.m(ee,null),p(pe,$e),p(pe,Se),Pt.m(Se,null),p(e,_t),ot&&ot.m(e,null),Be=!0,Ge||(kt=[X(m,"click",r[23]),X(L,"click",r[24]),X(O,"click",r[25]),X(z,"click",r[26]),X(Y,"change",r[27]),X(we,"change",r[28]),X(we,"change",r[14]),X(Ze,"change",r[29]),X(ee,"click",r[19]),X(Se,"click",r[20])],Ge=!0)},p(Pe,it){(!Be||it[0]&64)&&o!==(o=tt(Pe[6]).properties.name+"")&&le(i,o),(!Be||it[0]&64)&&a!==(a=tt(Pe[6]).properties.area_km2.toFixed(1)+"")&&le(f,a),Pe[8]>0?bt||(bt=xo(),bt.c(),bt.m(e,_)):bt&&(bt.d(1),bt=null),(!Be||it[0]&512&&!Ke(g.src,y=`/ltn//filters/${Pe[9]}_icon.gif`))&&N(g,"src",y),(!Be||it[0]&1&&v!==(v=Pe[0]=="filter"))&&(m.disabled=v),(!Be||it[0]&1&&E!==(E=Pe[0]=="freehand-filters"))&&(L.disabled=E),(!Be||it[0]&1&&D!==(D=Pe[0]=="oneway"))&&(O.disabled=D),it[0]&2048&&(Y.checked=Pe[11]),it[0]&1024&&(we.checked=Pe[10]),it[0]&4096&&wt(Ze,Pe[12]),Pe[12]=="speeds"?Qe?it[0]&4096&&$(Qe,1):(Qe=ei(),Qe.c(),$(Qe,1),Qe.m(ve,null)):Qe&&(he(),C(Qe,1,1,()=>{Qe=null}),be()),en===(en=xt(Pe))&&St?St.p(Pe,it):(St.d(1),St=en(Pe),St&&(St.c(),St.m(ee,null))),(!Be||it[0]&16&&ge!==(ge=Pe[4]==0))&&(ee.disabled=ge),Ft===(Ft=nr(Pe))&&Pt?Pt.p(Pe,it):(Pt.d(1),Pt=Ft(Pe),Pt&&(Pt.c(),Pt.m(Se,null))),(!Be||it[0]&32&&W!==(W=Pe[5]==0))&&(Se.disabled=W),Pe[3]?ot?(ot.p(Pe,it),it[0]&8&&$(ot,1)):(ot=ti(Pe),ot.c(),$(ot,1),ot.m(e,null)):ot&&(he(),C(ot,1,1,()=>{ot=null}),be())},i(Pe){Be||($(Qe),$(ot),Be=!0)},o(Pe){C(Qe),C(ot),Be=!1},d(Pe){Pe&&k(e),bt&&bt.d(),Qe&&Qe.d(),St.d(),Pt.d(),ot&&ot.d(),Ge=!1,ft(kt)}}}function fp(r){let e;return{c(){e=S("p"),e.textContent="Click to change direction"},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function up(r){let e,n,t,l;return{c(){e=S("div"),n=S("img"),l=j(`
                Click to add modal filter`),Ke(n.src,t=`/ltn//filters/${r[9]}_icon.gif`)||N(n,"src",t),N(n,"width","20"),N(n,"alt","Add modal filter")},m(o,i){w(o,e,i),p(e,n),p(e,l)},p(o,i){i[0]&512&&!Ke(n.src,t=`/ltn//filters/${o[9]}_icon.gif`)&&N(n,"src",t)},d(o){o&&k(e)}}}function cp(r){let e,n=r[40].shortcuts+"",t,l,o=(r[40].name??"unnamed road")+"",i,s,a=Math.round(r[40].speed_mph)+"",f,u,c,_;function d(y,h){return y[0]=="filter"?up:fp}let m=d(r),g=m(r);return{c(){e=S("p"),t=j(n),l=j(" shortcuts through "),i=j(o),s=j(`
              (`),f=j(a),u=j(" mph)"),c=M(),g.c(),_=Ye()},m(y,h){w(y,e,h),p(e,t),p(e,l),p(e,i),p(e,s),p(e,f),p(e,u),w(y,c,h),g.m(y,h),w(y,_,h)},p(y,h){h[1]&512&&n!==(n=y[40].shortcuts+"")&&le(t,n),h[1]&512&&o!==(o=(y[40].name??"unnamed road")+"")&&le(i,o),h[1]&512&&a!==(a=Math.round(y[40].speed_mph)+"")&&le(f,a),m===(m=d(y))&&g?g.p(y,h):(g.d(1),g=m(y),g&&(g.c(),g.m(_.parentNode,_)))},d(y){y&&(k(e),k(c),k(_)),g.d(y)}}}function dp(r){let e,n,t;return n=new ut({props:{openOn:"hover",$$slots:{default:[cp,({props:l})=>({40:l}),({props:l})=>[0,l?512:0]]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){w(l,e,o),A(n,e,null),t=!0},p(l,o){const i={};o[0]&513|o[1]&1536&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function _p(r){let e,n,t,l,o,i,s,a,f,u;return e=new Fr({}),t=new Ar({}),o=new Pr({}),s=new xn({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[dp]},$$scope:{ctx:r}}}),f=new Dm({props:{interactive:r[0]=="filter",neighbourhood:r[1],onClickIntersection:r[17]}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),T(s.$$.fragment),a=M(),T(f.$$.fragment)},m(c,_){A(e,c,_),w(c,n,_),A(t,c,_),w(c,l,_),A(o,c,_),w(c,i,_),A(s,c,_),w(c,a,_),A(f,c,_),u=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0]=="filter"||c[0]=="oneway"),_[0]&513|_[1]&1024&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const m={};_[0]&1&&(m.interactive=c[0]=="filter"),_[0]&2&&(m.neighbourhood=c[1]),f.$set(m)},i(c){u||($(e.$$.fragment,c),$(t.$$.fragment,c),$(o.$$.fragment,c),$(s.$$.fragment,c),$(f.$$.fragment,c),u=!0)},o(c){C(e.$$.fragment,c),C(t.$$.fragment,c),C(o.$$.fragment,c),C(s.$$.fragment,c),C(f.$$.fragment,c),u=!1},d(c){c&&(k(n),k(l),k(i),k(a)),F(e,c),F(t,c),F(o,c),F(s,c),F(f,c)}}}function ni(r){let e,n;return e=new Mm({props:{paths:r[7]}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[0]&128&&(o.paths=t[7]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function mp(r){let e;return{c(){e=j("Click to delete")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function pp(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[mp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[1]&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ri(r){let e,n;return e=new Ym({props:{map:tt(r[2])}}),e.$on("done",r[21]),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[0]&4&&(o.map=tt(t[2])),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function gp(r){let e,n,t,l,o,i,s;n=new er({props:{input:r[1],$$slots:{default:[_p]},$$scope:{ctx:r}}});let a=r[11]&&ni(r);o=new pn({props:{$$slots:{default:[pp]},$$scope:{ctx:r}}}),o.$on("click",r[16]);let f=r[0]=="freehand-filters"&&ri(r);return{c(){e=S("div"),T(n.$$.fragment),t=M(),a&&a.c(),l=M(),T(o.$$.fragment),i=M(),f&&f.c(),N(e,"slot","map")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),a&&a.m(e,null),p(e,l),A(o,e,null),p(e,i),f&&f.m(e,null),s=!0},p(u,c){const _={};c[0]&2&&(_.input=u[1]),c[0]&515|c[1]&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_),u[11]?a?(a.p(u,c),c[0]&2048&&$(a,1)):(a=ni(u),a.c(),$(a,1),a.m(e,l)):a&&(he(),C(a,1,1,()=>{a=null}),be());const d={};c[1]&1024&&(d.$$scope={dirty:c,ctx:u}),o.$set(d),u[0]=="freehand-filters"?f?(f.p(u,c),c[0]&1&&$(f,1)):(f=ri(u),f.c(),$(f,1),f.m(e,null)):f&&(he(),C(f,1,1,()=>{f=null}),be())},i(u){s||($(n.$$.fragment,u),$(a),$(o.$$.fragment,u),$(f),s=!0)},o(u){C(n.$$.fragment,u),C(a),C(o.$$.fragment,u),C(f),s=!1},d(u){u&&k(e),F(n),a&&a.d(),F(o),f&&f.d()}}}function hp(r){let e,n,t,l;return e=new At({props:{$$slots:{map:[gp],sidebar:[ap],top:[rp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0,t||(l=X(window,"keydown",r[18]),t=!0)},p(o,i){const s={};i[0]&16383|i[1]&1024&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o),t=!1,l()}}}function bp(r,e,n){let t,l,o,i,s,a,f,u,c;V(r,Nt,re=>n(22,l=re)),V(r,Zr,re=>n(9,o=re)),V(r,xe,re=>n(38,i=re)),V(r,Wn,re=>n(10,s=re)),V(r,Qt,re=>n(2,a=re)),V(r,Sl,re=>n(11,f=re)),V(r,pr,re=>n(12,u=re)),V(r,de,re=>n(13,c=re));let _="filter",d=!1,m=0,g=0,y,h,v=i.getAllShortcuts();Tt(()=>{a.doubleClickZoom.enable()});function b(re){n(1,h=i.renderNeighbourhood()),n(6,y=h.features.find(Je=>Je.properties.kind=="boundary")),n(4,m=h.undo_length),n(5,g=h.redo_length),n(7,v=i.getAllShortcuts()),Cn()}function L(){i.setCurrentNeighbourhood(y.properties.name,s),ne(Nt,l++,l)}function I(re,Je){_=="filter"?(i.addModalFilter(Je,o),ne(Nt,l++,l)):_=="oneway"&&(i.toggleTravelFlow(re.properties.road),ne(Nt,l++,l))}function E(re){let Je=re.detail.features[0];i.deleteModalFilter(Je.properties.road),ne(Nt,l++,l)}function P(re){if(_!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${_}`);return}re.hasRotatedFilter?(i.deleteDiagonalFilter(re),ne(Nt,l++,l)):re.filter?(i.rotateDiagonalFilter(re),ne(Nt,l++,l)):(i.addDiagonalFilter(re),ne(Nt,l++,l))}function O(re){re.target.tagName!="INPUT"&&(re.ctrlKey&&re.key=="z"&&B(),re.ctrlKey&&re.key=="y"&&D(),re.key=="1"&&n(0,_="filter"),re.key=="2"&&n(0,_="freehand-filters"),re.key=="3"&&n(0,_="oneway"))}function B(){i.undo(),ne(Nt,l++,l)}function D(){i.redo(),ne(Nt,l++,l)}function R(re){let Je=re.detail;Je&&(i.addManyModalFilters(Je,o),ne(Nt,l++,l)),n(0,_="filter")}const z=()=>n(0,_="filter"),U=()=>n(0,_="freehand-filters"),H=()=>n(0,_="oneway"),Y=()=>n(3,d=!0);function Z(){f=this.checked,Sl.set(f)}function se(){s=this.checked,Wn.set(s)}function G(){u=an(this),pr.set(u)}const we=()=>n(3,d=!1),x=()=>ne(de,c={mode:"title",firstLoad:!1},c),ue=()=>ne(de,c={mode:"pick-neighbourhood"},c),ve=()=>ne(de,c={mode:"view-shortcuts"},c),ce=()=>ne(de,c={mode:"route",prevMode:"neighbourhood"},c),Fe=()=>ne(de,c={mode:"impact-one-destination"},c),Ze=()=>ne(de,c={mode:"set-boundary",name:tt(y).properties.name,existing:y},c),Te=()=>ne(de,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(_=="oneway"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&4194304&&b(),r.$$.dirty[0]&2&&n(8,t=h.features.filter(re=>re.properties.kind=="cell"&&re.properties.cell_color=="disconnected").length)},[_,h,a,d,m,g,y,v,t,o,s,f,u,c,L,I,E,P,O,B,D,R,l,z,U,H,Y,Z,se,G,we,x,ue,ve,ce,Fe,Ze,Te]}class $p extends ae{constructor(e){super(),fe(this,e,bp,hp,oe,{},null,[-1,-1])}}function vp(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function yp(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function wp(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Ce({props:{$$slots:{default:[vp]},$$scope:{ctx:r}}}),o.$on("click",r[7]),a=new Ce({props:{$$slots:{default:[yp]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||($(o.$$.fragment,_),$(a.$$.fragment,_),c=!0)},o(_){C(o.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),F(o),F(a)}}}function kp(r){let e;return{c(){e=j("Pick a different road")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Sp(r){let e,n,t,l,o,i,s,a;n=new Ce({props:{$$slots:{default:[kp]},$$scope:{ctx:r}}}),n.$on("click",r[5]);function f(c){r[6](c)}let u={list:r[2]};return r[0]!==void 0&&(u.idx=r[0]),l=new Tr({props:u}),ze.push(()=>nt(l,"idx",f)),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),i=M(),s=S("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,N(e,"slot","sidebar")},m(c,_){w(c,e,_),A(n,e,null),p(e,t),A(l,e,null),p(e,i),p(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),n.$set(d);const m={};!o&&_&1&&(o=!0,m.idx=c[0],rt(()=>o=!1)),l.$set(m)},i(c){a||($(n.$$.fragment,c),$(l.$$.fragment,c),a=!0)},o(c){C(n.$$.fragment,c),C(l.$$.fragment,c),a=!1},d(c){c&&k(e),F(n),F(l)}}}function Lp(r){let e,n;const t=[ye("predict-impact"),{paint:{"line-width":Ht(["get","kind"],{focus:8},5),"line-color":Ht(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Ht(["get","kind"],{focus:1},.5)}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Cp(r){let e;return{c(){e=j("A")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Mp(r){let e;return{c(){e=j("B")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Tp(r){let e,n,t,l,o,i,s,a,f;return n=new Ve({props:{data:r[3](r[0]),$$slots:{default:[Lp]},$$scope:{ctx:r}}}),l=new vn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[Cp]},$$scope:{ctx:r}}}),i=new vn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[Mp]},$$scope:{ctx:r}}}),a=new pn({}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),o=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),N(e,"slot","map")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),A(l,e,null),p(e,o),A(i,e,null),p(e,s),A(a,e,null),f=!0},p(u,c){const _={};c&1&&(_.data=u[3](u[0])),c&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&1&&(d.lngLat=u[2][u[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:u}),l.$set(d);const m={};c&1&&(m.lngLat=u[2][u[0]][0].geometry.coordinates[u[2][u[0]][0].geometry.coordinates.length-1]),c&1024&&(m.$$scope={dirty:c,ctx:u}),i.$set(m)},i(u){f||($(n.$$.fragment,u),$(l.$$.fragment,u),$(i.$$.fragment,u),$(a.$$.fragment,u),f=!0)},o(u){C(n.$$.fragment,u),C(l.$$.fragment,u),C(i.$$.fragment,u),C(a.$$.fragment,u),f=!1},d(u){u&&k(e),F(n),F(l),F(i),F(a)}}}function Ap(r){let e,n;return e=new At({props:{$$slots:{map:[Tp],sidebar:[Sp],top:[wp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1027&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Fp(r,e,n){let t,l;V(r,xe,d=>n(9,t=d)),V(r,de,d=>n(1,l=d));let{road:o}=e;o.properties.kind="focus";let i=t.getImpactsOnRoad(o.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],o]}}const f=()=>ne(de,l={mode:"predict-impact"},l);function u(d){s=d,n(0,s)}const c=()=>ne(de,l={mode:"title",firstLoad:!1},l),_=()=>ne(de,l={mode:"pick-neighbourhood"},l);return r.$$set=d=>{"road"in d&&n(4,o=d.road)},[s,l,i,a,o,f,u,c,_]}class Pp extends ae{constructor(e){super(),fe(this,e,Fp,Ap,oe,{road:4})}}function Ep(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Ip(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Np(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function jp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Ce({props:{$$slots:{default:[Ep]},$$scope:{ctx:r}}}),o.$on("click",r[12]),a=new Ce({props:{$$slots:{default:[Ip]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new Ce({props:{$$slots:{default:[Np]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),T(c.$$.fragment),_=M(),d=S("li"),d.textContent="Impact routing to one destination",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){w(g,e,y),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),A(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&262144&&(h.$$scope={dirty:y,ctx:g}),o.$set(h);const v={};y&262144&&(v.$$scope={dirty:y,ctx:g}),a.$set(v);const b={};y&262144&&(b.$$scope={dirty:y,ctx:g}),c.$set(b)},i(g){m||($(o.$$.fragment,g),$(a.$$.fragment,g),$(c.$$.fragment,g),m=!0)},o(g){C(o.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),m=!1},d(g){g&&k(e),F(o),F(a),F(c)}}}function zp(r){let e,n,t,l,o,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",f,u;return n=new mn({}),n.$on("click",r[5]),{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=M(),i=S("p"),s=j("Highest ratio is "),f=j(a),N(e,"slot","sidebar")},m(c,_){w(c,e,_),A(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(i,s),p(i,f),u=!0},p(c,_){(!u||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&le(f,a)},i(c){u||($(n.$$.fragment,c),u=!0)},o(c){C(n.$$.fragment,c),u=!1},d(c){c&&k(e),F(n)}}}function Op(r){let e,n;const t=[ye("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new $t({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Bp(r){let e,n=un(r[17].distance_before)+"",t,l,o=cn(r[17].time_before)+"",i,s,a,f,u=un(r[17].distance_after)+"",c,_,d=cn(r[17].time_after)+"",m,g,y,h,v,b=(r[17].time_after/r[17].time_before).toFixed(1)+"",L;return{c(){e=S("p"),t=j(n),l=j(", "),i=j(o),s=j(" before"),a=M(),f=S("p"),c=j(u),_=j(", "),m=j(d),g=j(" after"),y=M(),h=S("p"),v=j("Time ratio: "),L=j(b)},m(I,E){w(I,e,E),p(e,t),p(e,l),p(e,i),p(e,s),w(I,a,E),w(I,f,E),p(f,c),p(f,_),p(f,m),p(f,g),w(I,y,E),w(I,h,E),p(h,v),p(h,L)},p(I,E){E&131072&&n!==(n=un(I[17].distance_before)+"")&&le(t,n),E&131072&&o!==(o=cn(I[17].time_before)+"")&&le(i,o),E&131072&&u!==(u=un(I[17].distance_after)+"")&&le(c,u),E&131072&&d!==(d=cn(I[17].time_after)+"")&&le(m,d),E&131072&&b!==(b=(I[17].time_after/I[17].time_before).toFixed(1)+"")&&le(L,b)},d(I){I&&(k(e),k(a),k(f),k(y),k(h))}}}function Rp(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[Bp,({props:t})=>({17:t}),({props:t})=>t?131072:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&393216&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Dp(r){let e,n,t;const l=[ye("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[9](s)}let i={$$slots:{default:[Rp]},$$scope:{ctx:r}};for(let s=0;s<l.length;s+=1)i=me(i,l[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new lt({props:i}),ze.push(()=>nt(e,"hovered",o)),e.$on("click",r[10]),{c(){T(e.$$.fragment)},m(s,a){A(e,s,a),t=!0},p(s,a){const f=a&8?Oe(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},l[2]]):{};a&262144&&(f.$$scope={dirty:a,ctx:s}),!n&&a&1&&(n=!0,f.hovered=s[0],rt(()=>n=!1)),e.$set(f)},i(s){t||($(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Up(r){let e,n;const t=[ye("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Ht(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Hp(r){let e;return{c(){e=j("X")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Gp(r){let e,n,t,l,o,i,s,a,f,u,c,_;n=new er({props:{$$slots:{default:[Op]},$$scope:{ctx:r}}}),l=new Ve({props:{data:r[3],generateId:!0,$$slots:{default:[Dp]},$$scope:{ctx:r}}}),i=new Ve({props:{data:r[2],$$slots:{default:[Up]},$$scope:{ctx:r}}}),a=new pn({});function d(g){r[11](g)}let m={draggable:!0,$$slots:{default:[Hp]},$$scope:{ctx:r}};return r[1]!==void 0&&(m.lngLat=r[1]),u=new vn({props:m}),ze.push(()=>nt(u,"lngLat",d)),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),o=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),f=M(),T(u.$$.fragment),N(e,"slot","map")},m(g,y){w(g,e,y),A(n,e,null),p(e,t),A(l,e,null),p(e,o),A(i,e,null),p(e,s),A(a,e,null),p(e,f),A(u,e,null),_=!0},p(g,y){const h={};y&262144&&(h.$$scope={dirty:y,ctx:g}),n.$set(h);const v={};y&8&&(v.data=g[3]),y&262153&&(v.$$scope={dirty:y,ctx:g}),l.$set(v);const b={};y&4&&(b.data=g[2]),y&262144&&(b.$$scope={dirty:y,ctx:g}),i.$set(b);const L={};y&262144&&(L.$$scope={dirty:y,ctx:g}),!c&&y&2&&(c=!0,L.lngLat=g[1],rt(()=>c=!1)),u.$set(L)},i(g){_||($(n.$$.fragment,g),$(l.$$.fragment,g),$(i.$$.fragment,g),$(a.$$.fragment,g),$(u.$$.fragment,g),_=!0)},o(g){C(n.$$.fragment,g),C(l.$$.fragment,g),C(i.$$.fragment,g),C(a.$$.fragment,g),C(u.$$.fragment,g),_=!1},d(g){g&&k(e),F(n),F(l),F(i),F(a),F(u)}}}function Wp(r){let e,n,t,l;return e=new ss({}),e.$on("contextmenu",r[7]),t=new At({props:{$$slots:{map:[Gp],sidebar:[zp],top:[jp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(o,i){A(e,o,i),w(o,n,i),A(t,o,i),l=!0},p(o,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){l||($(e.$$.fragment,o),$(t.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),C(t.$$.fragment,o),l=!1},d(o){o&&k(n),F(e,o),F(t,o)}}}function qp(r,e,n){let t,l,o,i,s,a,f;V(r,ir,L=>n(1,o=L)),V(r,de,L=>n(4,i=L)),V(r,qn,L=>n(14,s=L)),V(r,Jn,L=>n(15,a=L)),V(r,xe,L=>n(8,f=L));function u(){ne(de,i={mode:"neighbourhood"},i)}let c=null;function _(L){return L?f.compareRoute(new Yr.LngLat(L.properties.pt1_x,L.properties.pt1_y),o,1):rn()}function d(L){ne(Jn,a=new Yr.LngLat(L.properties.pt1_x,L.properties.pt1_y),a),ne(qn,s=o,s),ne(de,i={mode:"route",prevMode:"impact-one-destination"},i)}function m(L){ne(ir,o=L.detail.lngLat,o)}function g(L){c=L,n(0,c)}const y=L=>d(L.detail.features[0]);function h(L){o=L,ir.set(o)}const v=()=>ne(de,i={mode:"title",firstLoad:!1},i),b=()=>ne(de,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&n(3,t=f.impactToOneDestination(o)),r.$$.dirty&1&&n(2,l=_(c))},[c,o,l,t,i,u,d,m,f,g,y,h,v,b]}class Jp extends ae{constructor(e){super(),fe(this,e,qp,Wp,oe,{})}}function li(r,e,n){const t=r.slice();return t[34]=e[n].properties.name,t[35]=e[n].properties.area_km2,t[36]=e[n].properties.simd,t}function Zp(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Yp(r){let e;return{c(){e=S("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Kp(r){let e;return{c(){e=j("Route")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Xp(r){let e;return{c(){e=j("Predict impact")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Vp(r){let e;return{c(){e=j("Debug intersections")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Qp(r){let e;return{c(){e=j("Debug demand")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function xp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,v,b,L,I,E,P,O;return o=new Ce({props:{$$slots:{default:[Zp]},$$scope:{ctx:r}}}),o.$on("click",r[27]),f=new Dt({props:{$$slots:{default:[Yp]},$$scope:{ctx:r}}}),m=new Ce({props:{$$slots:{default:[Kp]},$$scope:{ctx:r}}}),m.$on("click",r[28]),h=new Ce({props:{$$slots:{default:[Xp]},$$scope:{ctx:r}}}),h.$on("click",r[29]),L=new Ce({props:{$$slots:{default:[Vp]},$$scope:{ctx:r}}}),L.$on("click",r[30]),P=new Ce({props:{$$slots:{default:[Qp]},$$scope:{ctx:r}}}),P.$on("click",r[31]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),a=j(`Pick neighbourhood
          `),T(f.$$.fragment),u=M(),c=S("nav"),_=S("ul"),d=S("li"),T(m.$$.fragment),g=M(),y=S("li"),T(h.$$.fragment),v=M(),b=S("li"),T(L.$$.fragment),I=M(),E=S("li"),T(P.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),ie(e,"display","flex"),ie(e,"justify-content","space-between")},m(B,D){w(B,e,D),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),p(s,a),A(f,s,null),p(e,u),p(e,c),p(c,_),p(_,d),A(m,d,null),p(_,g),p(_,y),A(h,y,null),p(_,v),p(_,b),A(L,b,null),p(_,I),p(_,E),A(P,E,null),O=!0},p(B,D){const R={};D[1]&256&&(R.$$scope={dirty:D,ctx:B}),o.$set(R);const z={};D[1]&256&&(z.$$scope={dirty:D,ctx:B}),f.$set(z);const U={};D[1]&256&&(U.$$scope={dirty:D,ctx:B}),m.$set(U);const H={};D[1]&256&&(H.$$scope={dirty:D,ctx:B}),h.$set(H);const Y={};D[1]&256&&(Y.$$scope={dirty:D,ctx:B}),L.$set(Y);const Z={};D[1]&256&&(Z.$$scope={dirty:D,ctx:B}),P.$set(Z)},i(B){O||($(o.$$.fragment,B),$(f.$$.fragment,B),$(m.$$.fragment,B),$(h.$$.fragment,B),$(L.$$.fragment,B),$(P.$$.fragment,B),O=!0)},o(B){C(o.$$.fragment,B),C(f.$$.fragment,B),C(m.$$.fragment,B),C(h.$$.fragment,B),C(L.$$.fragment,B),C(P.$$.fragment,B),O=!1},d(B){B&&k(e),F(o),F(f),F(m),F(h),F(L),F(P)}}}function eg(r){let e=r[34]+"",n;return{c(){n=j(e)},m(t,l){w(t,n,l)},p(t,l){l[0]&1&&e!==(e=t[34]+"")&&le(n,e)},d(t){t&&k(n)}}}function tg(r){let e,n,t,l=r[36].toFixed(1)+"",o;return{c(){e=S("span"),n=S("b"),n.textContent="SIMD (percentile):",t=M(),o=j(l)},m(i,s){w(i,e,s),p(e,n),p(e,t),p(e,o)},p(i,s){s[0]&1&&l!==(l=i[36].toFixed(1)+"")&&le(o,l)},d(i){i&&k(e)}}}function ng(r){let e,n,t,l=r[35].toFixed(1)+"",o,i;return{c(){e=S("span"),n=S("b"),n.textContent="Area:",t=M(),o=j(l),i=j(" km²")},m(s,a){w(s,e,a),p(e,n),p(e,t),p(e,o),p(e,i)},p(s,a){a[0]&1&&l!==(l=s[35].toFixed(1)+"")&&le(o,l)},d(s){s&&k(e)}}}function oi(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g;function y(){return r[20](r[34])}l=new Ce({props:{$$slots:{default:[eg]},$$scope:{ctx:r}}}),l.$on("click",y),a=new bl({props:{color:"black"}});function h(){return r[21](r[34])}c=new as({props:{color:"white"}});function v(){return r[22](r[34])}function b(P,O){if(P[1]=="area")return ng;if(P[1]=="simd")return tg}let L=b(r),I=L&&L(r);function E(){return r[23](r[34])}return{c(){var P;e=S("li"),n=S("span"),t=S("span"),T(l.$$.fragment),o=M(),i=S("span"),s=S("button"),T(a.$$.fragment),f=M(),u=S("button"),T(c.$$.fragment),_=M(),I&&I.c(),N(t,"class","neighbourhood-name svelte-v2avug"),N(s,"class","outline icon-btn"),N(s,"aria-label","Rename neighbourhood"),N(u,"class","icon-btn destructive"),N(u,"aria-label","Delete neighbourhood"),ie(i,"display","flex"),ie(i,"gap","16px"),ie(n,"display","flex"),ie(n,"justify-content","space-between"),N(e,"class","svelte-v2avug"),gt(e,"highlighted",((P=r[3])==null?void 0:P.properties.name)==r[34])},m(P,O){w(P,e,O),p(e,n),p(n,t),A(l,t,null),p(n,o),p(n,i),p(i,s),A(a,s,null),p(i,f),p(i,u),A(c,u,null),p(e,_),I&&I.m(e,null),d=!0,m||(g=[X(s,"click",h),X(u,"click",v),X(e,"mouseenter",E),X(e,"mouseleave",r[24])],m=!0)},p(P,O){var D;r=P;const B={};O[0]&1|O[1]&256&&(B.$$scope={dirty:O,ctx:r}),l.$set(B),L===(L=b(r))&&I?I.p(r,O):(I&&I.d(1),I=L&&L(r),I&&(I.c(),I.m(e,null))),(!d||O[0]&9)&&gt(e,"highlighted",((D=r[3])==null?void 0:D.properties.name)==r[34])},i(P){d||($(l.$$.fragment,P),$(a.$$.fragment,P),$(c.$$.fragment,P),d=!0)},o(P){C(l.$$.fragment,P),C(a.$$.fragment,P),C(c.$$.fragment,P),d=!1},d(P){P&&k(e),F(l),F(a),F(c),I&&I.d(),m=!1,ft(g)}}}function rg(r){let e,n,t;return e=new bl({}),{c(){T(e.$$.fragment),n=j(`
              Draw a new boundary`)},m(l,o){A(e,l,o),w(l,n,o),t=!0},i(l){t||($(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){l&&k(n),F(e,l)}}}function lg(r){let e,n,t;return e=new $u({}),{c(){T(e.$$.fragment),n=j(`
              Use a generated boundary`)},m(l,o){A(e,l,o),w(l,n,o),t=!0},i(l){t||($(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){l&&k(n),F(e,l)}}}function ii(r){let e,n,t,l,o,i,s,a,f;function u(_){r[26](_)}let c={};return r[1]!==void 0&&(c.selectedPrioritization=r[1]),o=new gs({props:c}),ze.push(()=>nt(o,"selectedPrioritization",u)),{c(){e=S("h3"),e.textContent="Prioritization",n=M(),t=S("p"),t.textContent="Compare metrics across your neighbourhoods.",l=M(),T(o.$$.fragment),s=M(),a=S("hr")},m(_,d){w(_,e,d),w(_,n,d),w(_,t,d),w(_,l,d),A(o,_,d),w(_,s,d),w(_,a,d),f=!0},p(_,d){const m={};!i&&d[0]&2&&(i=!0,m.selectedPrioritization=_[1],rt(()=>i=!1)),o.$set(m)},i(_){f||($(o.$$.fragment,_),f=!0)},o(_){C(o.$$.fragment,_),f=!1},d(_){_&&(k(e),k(n),k(t),k(l),k(s),k(a)),F(o,_)}}}function og(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g=r[5].startsWith("ltn_cnt/"),y,h,v,b,L,I,E=r[4].modalFilters+"",P,O,B,D,R=r[4].deletedModalFilters+"",z,U,H,Y,Z=r[4].travelFlows+"",se,G,we,x,ue,ve,ce,Fe,Ze,Te=Me(r[0].features),re=[];for(let ke=0;ke<Te.length;ke+=1)re[ke]=oi(li(r,Te,ke));const Je=ke=>C(re[ke],1,1,()=>{re[ke]=null});u=new Ce({props:{$$slots:{default:[rg]},$$scope:{ctx:r}}}),u.$on("click",r[10]),d=new Ce({props:{$$slots:{default:[lg]},$$scope:{ctx:r}}}),d.$on("click",r[25]);let Ne=g&&ii(r);return{c(){e=S("div"),n=S("h3"),n.textContent="Neighbourhoods",t=M(),l=S("ul");for(let ke=0;ke<re.length;ke+=1)re[ke].c();o=M(),i=S("li"),s=j(`Add a new neighbourhood:
        `),a=S("ul"),f=S("li"),T(u.$$.fragment),c=M(),_=S("li"),T(d.$$.fragment),m=M(),Ne&&Ne.c(),y=M(),h=S("p"),v=j("Current project: "),b=j(r[5]),L=M(),I=S("p"),P=j(E),O=j(" new modal filter(s) added"),B=M(),D=S("p"),z=j(R),U=j(`
      existing modal filter(s) removed`),H=M(),Y=S("p"),se=j(Z),G=j(" road segment direction(s) changed"),we=M(),x=S("button"),x.textContent="Export project to GeoJSON",ue=M(),ve=S("button"),ve.textContent="Debug route-snapper",ie(n,"padding","4px 8px"),ie(n,"margin-bottom","0"),ie(f,"list-style","none"),ie(_,"list-style","none"),ie(a,"margin-bottom","0"),ie(a,"padding","0"),N(i,"class","svelte-v2avug"),N(l,"class","neighbourhood-list svelte-v2avug"),N(ve,"class","secondary"),N(e,"slot","sidebar")},m(ke,K){w(ke,e,K),p(e,n),p(e,t),p(e,l);for(let pe=0;pe<re.length;pe+=1)re[pe]&&re[pe].m(l,null);p(l,o),p(l,i),p(i,s),p(i,a),p(a,f),A(u,f,null),p(a,c),p(a,_),A(d,_,null),p(e,m),Ne&&Ne.m(e,null),p(e,y),p(e,h),p(h,v),p(h,b),p(e,L),p(e,I),p(I,P),p(I,O),p(e,B),p(e,D),p(D,z),p(D,U),p(e,H),p(e,Y),p(Y,se),p(Y,G),p(e,we),p(e,x),p(e,ue),p(e,ve),ce=!0,Fe||(Ze=[X(x,"click",r[11]),X(ve,"click",r[12])],Fe=!0)},p(ke,K){if(K[0]&911){Te=Me(ke[0].features);let ge;for(ge=0;ge<Te.length;ge+=1){const $e=li(ke,Te,ge);re[ge]?(re[ge].p($e,K),$(re[ge],1)):(re[ge]=oi($e),re[ge].c(),$(re[ge],1),re[ge].m(l,o))}for(he(),ge=Te.length;ge<re.length;ge+=1)Je(ge);be()}const pe={};K[1]&256&&(pe.$$scope={dirty:K,ctx:ke}),u.$set(pe);const ee={};K[1]&256&&(ee.$$scope={dirty:K,ctx:ke}),d.$set(ee),K[0]&32&&(g=ke[5].startsWith("ltn_cnt/")),g?Ne?(Ne.p(ke,K),K[0]&32&&$(Ne,1)):(Ne=ii(ke),Ne.c(),$(Ne,1),Ne.m(e,y)):Ne&&(he(),C(Ne,1,1,()=>{Ne=null}),be()),(!ce||K[0]&32)&&le(b,ke[5]),(!ce||K[0]&16)&&E!==(E=ke[4].modalFilters+"")&&le(P,E),(!ce||K[0]&16)&&R!==(R=ke[4].deletedModalFilters+"")&&le(z,R),(!ce||K[0]&16)&&Z!==(Z=ke[4].travelFlows+"")&&le(se,Z)},i(ke){if(!ce){for(let K=0;K<Te.length;K+=1)$(re[K]);$(u.$$.fragment,ke),$(d.$$.fragment,ke),$(Ne),ce=!0}},o(ke){re=re.filter(Boolean);for(let K=0;K<re.length;K+=1)C(re[K]);C(u.$$.fragment,ke),C(d.$$.fragment,ke),C(Ne),ce=!1},d(ke){ke&&k(e),dt(re,ke),F(u),F(d),Ne&&Ne.d(),Fe=!1,ft(Ze)}}}function ig(r){let e,n=r[33].name+"",t,l,o,i,s=r[33].area_km2.toFixed(1)+"",a,f;return{c(){e=S("h2"),t=j(n),l=M(),o=S("b"),o.textContent="Area:",i=M(),a=j(s),f=j(" km²")},m(u,c){w(u,e,c),p(e,t),w(u,l,c),w(u,o,c),w(u,i,c),w(u,a,c),w(u,f,c)},p(u,c){c[1]&4&&n!==(n=u[33].name+"")&&le(t,n),c[1]&4&&s!==(s=u[33].area_km2.toFixed(1)+"")&&le(a,s)},d(u){u&&(k(e),k(l),k(o),k(i),k(a),k(f))}}}function sg(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[ig,({props:t})=>({33:t}),({props:t})=>[0,t?4:0]]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[1]&260&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ag(r){let e,n=r[33].name+"",t,l,o,i,s=r[33].simd.toFixed(1)+"",a;return{c(){e=S("h2"),t=j(n),l=M(),o=S("b"),o.textContent="SIMD:",i=M(),a=j(s)},m(f,u){w(f,e,u),p(e,t),w(f,l,u),w(f,o,u),w(f,i,u),w(f,a,u)},p(f,u){u[1]&4&&n!==(n=f[33].name+"")&&le(t,n),u[1]&4&&s!==(s=f[33].simd.toFixed(1)+"")&&le(a,s)},d(f){f&&(k(e),k(l),k(o),k(i),k(a))}}}function fg(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[ag,({props:t})=>({33:t}),({props:t})=>[0,t?4:0]]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[1]&260&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ug(r){let e,n=r[33].name+"",t,l,o,i,s=r[33].area_km2.toFixed(1)+"",a,f;return{c(){e=S("h2"),t=j(n),l=M(),o=S("b"),o.textContent="Area:",i=M(),a=j(s),f=j(" km²")},m(u,c){w(u,e,c),p(e,t),w(u,l,c),w(u,o,c),w(u,i,c),w(u,a,c),w(u,f,c)},p(u,c){c[1]&4&&n!==(n=u[33].name+"")&&le(t,n),c[1]&4&&s!==(s=u[33].area_km2.toFixed(1)+"")&&le(a,s)},d(u){u&&(k(e),k(l),k(o),k(i),k(a),k(f))}}}function cg(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[ug,({props:t})=>({33:t}),({props:t})=>[0,t?4:0]]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[1]&260&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function dg(r){let e,n,t,l,o,i,s,a,f;const u=[ye("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":at(.3,.5)}},{layout:{visibility:r[1]=="none"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];function c(b){r[14](b)}let _={$$slots:{default:[sg]},$$scope:{ctx:r}};for(let b=0;b<u.length;b+=1)_=me(_,u[b]);r[3]!==void 0&&(_.hovered=r[3]),e=new $t({props:_}),ze.push(()=>nt(e,"hovered",c)),e.$on("click",r[15]);const d=[ye("neighbourhood-prioritization-simd"),{paint:{"fill-color":Jt(["get","simd"],Qn,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[1]=="simd"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];function m(b){r[16](b)}let g={$$slots:{default:[fg]},$$scope:{ctx:r}};for(let b=0;b<d.length;b+=1)g=me(g,d[b]);r[3]!==void 0&&(g.hovered=r[3]),l=new $t({props:g}),ze.push(()=>nt(l,"hovered",m)),l.$on("click",r[17]);const y=[ye("neighbourhood-prioritization-area"),{paint:{"fill-color":Jt(["get","area_km2"],$l,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[1]=="area"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];function h(b){r[18](b)}let v={$$slots:{default:[cg]},$$scope:{ctx:r}};for(let b=0;b<y.length;b+=1)v=me(v,y[b]);return r[3]!==void 0&&(v.hovered=r[3]),s=new $t({props:v}),ze.push(()=>nt(s,"hovered",h)),s.$on("click",r[19]),{c(){T(e.$$.fragment),t=M(),T(l.$$.fragment),i=M(),T(s.$$.fragment)},m(b,L){A(e,b,L),w(b,t,L),A(l,b,L),w(b,i,L),A(s,b,L),f=!0},p(b,L){const I=L[0]&2?Oe(u,[u[0],u[1],u[2],{layout:{visibility:b[1]=="none"?"visible":"none"}},u[4],u[5]]):{};L[1]&256&&(I.$$scope={dirty:L,ctx:b}),!n&&L[0]&8&&(n=!0,I.hovered=b[3],rt(()=>n=!1)),e.$set(I);const E=L[0]&2?Oe(d,[d[0],d[1],{layout:{visibility:b[1]=="simd"?"visible":"none"}},d[3],d[4]]):{};L[1]&256&&(E.$$scope={dirty:L,ctx:b}),!o&&L[0]&8&&(o=!0,E.hovered=b[3],rt(()=>o=!1)),l.$set(E);const P=L[0]&2?Oe(y,[y[0],y[1],{layout:{visibility:b[1]=="area"?"visible":"none"}},y[3],y[4]]):{};L[1]&256&&(P.$$scope={dirty:L,ctx:b}),!a&&L[0]&8&&(a=!0,P.hovered=b[3],rt(()=>a=!1)),s.$set(P)},i(b){f||($(e.$$.fragment,b),$(l.$$.fragment,b),$(s.$$.fragment,b),f=!0)},o(b){C(e.$$.fragment,b),C(l.$$.fragment,b),C(s.$$.fragment,b),f=!1},d(b){b&&(k(t),k(i)),F(e,b),F(l,b),F(s,b)}}}function _g(r){let e,n,t,l,o;return n=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[dg]},$$scope:{ctx:r}}}),l=new pn({}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),N(e,"slot","map")},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(l,e,null),o=!0},p(i,s){const a={};s[0]&1&&(a.data=i[0]),s[0]&10|s[1]&256&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&k(e),F(n),F(l)}}}function mg(r){let e,n;return e=new At({props:{$$slots:{map:[_g],sidebar:[og],top:[xp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l[0]&127|l[1]&256&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function pg(r){let e=0,n=0,t=0;for(let l of r.features)l.properties.kind=="modal_filter"?e++:l.properties.kind=="deleted_existing_modal_filter"?n++:l.properties.kind=="travel_flow"&&t++;return{modalFilters:e,deletedModalFilters:n,travelFlows:t}}function gg(r,e,n){let t,l,o,i,s,a;V(r,xe,x=>n(13,o=x)),V(r,Zt,x=>n(5,i=x)),V(r,de,x=>n(6,s=x)),V(r,Wn,x=>n(32,a=x));let f="none",u=null,c=null;function _(x){o.setCurrentNeighbourhood(x,a),ne(de,s={mode:"neighbourhood"},s)}function d(x){window.confirm(`Really delete neighbourhood ${x}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(x),Cn(),n(0,t=o.getAllNeighbourhoods()))}function m(x){let ue=rl(o,`Rename neighbourhood ${x} to what?`,x);ue&&(o.renameNeighbourhoodBoundary(x,ue),Cn(),n(0,t=o.getAllNeighbourhoods()))}function g(){let x=rl(o,"What do you want to name the neighbourhood?","");x&&ne(de,s={mode:"set-boundary",name:x,existing:null},s)}function y(){gr(i+".geojson",JSON.stringify(o.toSavefile()))}function h(){gr("debug_route_snapper.geojson",o.toRouteSnapperGj())}function v(x){c=x,n(3,c)}const b=x=>_(tt(x.detail.features[0].properties).name);function L(x){c=x,n(3,c)}const I=x=>_(tt(x.detail.features[0].properties).name);function E(x){c=x,n(3,c)}const P=x=>_(tt(x.detail.features[0].properties).name),O=x=>_(x),B=x=>m(x),D=x=>d(x),R=x=>n(2,u=x),z=()=>n(2,u=null),U=()=>ne(de,s={mode:"auto-boundaries"},s);function H(x){f=x,n(1,f)}const Y=()=>ne(de,s={mode:"title",firstLoad:!1},s),Z=()=>ne(de,s={mode:"route",prevMode:"pick-neighbourhood"},s),se=()=>ne(de,s={mode:"predict-impact"},s),G=()=>ne(de,s={mode:"debug-intersections"},s),we=()=>ne(de,s={mode:"debug-demand"},s);return r.$$.update=()=>{r.$$.dirty[0]&8192&&n(0,t=o.getAllNeighbourhoods()),r.$$.dirty[0]&1&&n(4,l=pg(t))},[t,f,u,c,l,i,s,_,d,m,g,y,h,o,v,b,L,I,E,P,O,B,D,R,z,U,H,Y,Z,se,G,we]}class hg extends ae{constructor(e){super(),fe(this,e,gg,mg,oe,{},null,[-1,-1])}}function bg(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function $g(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function vg(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Ce({props:{$$slots:{default:[bg]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[$g]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){w(_,e,d),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||($(o.$$.fragment,_),$(a.$$.fragment,_),c=!0)},o(_){C(o.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),F(o),F(a)}}}function yg(r){let e,n,t,l,o,i,s,a,f;return n=new mn({}),n.$on("click",r[5]),{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("p"),l.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,o=M(),i=S("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=M(),a=S("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,N(e,"slot","sidebar")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(e,s),p(e,a),f=!0},p:Q,i(u){f||($(n.$$.fragment,u),f=!0)},o(u){C(n.$$.fragment,u),f=!1},d(u){u&&k(e),F(n)}}}function wg(r){let e,n=r[9].before.toLocaleString()+"",t,l,o=r[9].after.toLocaleString()+"",i,s,a,f,u=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=S("p"),t=j(n),l=j(" before, "),i=j(o),s=j(`
            after`),a=M(),f=S("p"),c=j(u),_=j("%")},m(d,m){w(d,e,m),p(e,t),p(e,l),p(e,i),p(e,s),w(d,a,m),w(d,f,m),p(f,c),p(f,_)},p(d,m){m&512&&n!==(n=d[9].before.toLocaleString()+"")&&le(t,n),m&512&&o!==(o=d[9].after.toLocaleString()+"")&&le(i,o),m&512&&u!==(u=Math.round(100*d[9].after/d[9].before)+"")&&le(c,u)},d(d){d&&(k(e),k(a),k(f))}}}function kg(r){let e,n;return e=new ut({props:{openOn:"hover",$$slots:{default:[wg,({props:t})=>({9:t}),({props:t})=>t?512:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&1536&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Sg(r){let e,n;const t=[ye("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,si,r[2].max_count,ai],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[kg]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s=i&6?Oe(t,[t[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,si,o[2].max_count,ai],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,o[1][0],50,o[1][1],100,o[1][2],150,o[1][3],200,o[1][4]]]}},t[2],t[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Lg(r){let e,n,t,l,o;return n=new Ve({props:{data:r[2],generateId:!0,$$slots:{default:[Sg]},$$scope:{ctx:r}}}),l=new pn({}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),N(e,"slot","map")},m(i,s){w(i,e,s),A(n,e,null),p(e,t),A(l,e,null),o=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&k(e),F(n),F(l)}}}function Cg(r){let e,n;return e=new At({props:{$$slots:{map:[Lg],sidebar:[yg],top:[vg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1025&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}let si=3,ai=10;function Mg(r,e,n){let t,l;V(r,de,_=>n(0,t=_)),V(r,xe,_=>n(8,l=_));let o=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=l.predictImpact();function s(_){ne(de,t={mode:"impact-detail",road:_},t)}return[t,o,i,s,_=>s(_.detail.features[0]),()=>ne(de,t={mode:"pick-neighbourhood"},t),()=>ne(de,t={mode:"title",firstLoad:!1},t),()=>ne(de,t={mode:"pick-neighbourhood"},t)]}class Tg extends ae{constructor(e){super(),fe(this,e,Mg,Cg,oe,{})}}function Ag(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Fg(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function fi(r){let e,n,t;return n=new Ce({props:{$$slots:{default:[Pg]},$$scope:{ctx:r}}}),n.$on("click",r[13]),{c(){e=S("li"),T(n.$$.fragment)},m(l,o){w(l,e,o),A(n,e,null),t=!0},p(l,o){const i={};o&16384&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function Pg(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Eg(r){let e,n,t,l,o,i,s,a,f,u,c,_;o=new Ce({props:{$$slots:{default:[Ag]},$$scope:{ctx:r}}}),o.$on("click",r[11]),a=new Ce({props:{$$slots:{default:[Fg]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&fi(r);return{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),d&&d.c(),u=M(),c=S("li"),c.textContent="Routing",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(m,g){w(m,e,g),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),d&&d.m(t,null),p(t,u),p(t,c),_=!0},p(m,g){const y={};g&16384&&(y.$$scope={dirty:g,ctx:m}),o.$set(y);const h={};g&16384&&(h.$$scope={dirty:g,ctx:m}),a.$set(h),m[0]=="neighbourhood"?d?(d.p(m,g),g&1&&$(d,1)):(d=fi(m),d.c(),$(d,1),d.m(t,u)):d&&(he(),C(d,1,1,()=>{d=null}),be())},i(m){_||($(o.$$.fragment,m),$(a.$$.fragment,m),$(d),_=!0)},o(m){C(o.$$.fragment,m),C(a.$$.fragment,m),C(d),_=!1},d(m){m&&k(e),F(o),F(a),d&&d.d()}}}function ui(r){let e,n,t,l=un(r[4].features[0].properties.distance)+"",o,i,s=cn(r[4].features[0].properties.time)+"",a,f,u,c,_,d=un(r[4].features[1].properties.distance)+"",m,g,y=cn(r[4].features[1].properties.time)+"",h;return{c(){e=S("p"),n=S("span"),n.textContent="Route before",t=j(`
        : `),o=j(l),i=j(", "),a=j(s),f=M(),u=S("p"),c=S("span"),c.textContent="Route after",_=j(`
        : `),m=j(d),g=j(", "),h=j(y),ie(n,"color","red"),ie(c,"color","blue")},m(v,b){w(v,e,b),p(e,n),p(e,t),p(e,o),p(e,i),p(e,a),w(v,f,b),w(v,u,b),p(u,c),p(u,_),p(u,m),p(u,g),p(u,h)},p(v,b){b&16&&l!==(l=un(v[4].features[0].properties.distance)+"")&&le(o,l),b&16&&s!==(s=cn(v[4].features[0].properties.time)+"")&&le(a,s),b&16&&d!==(d=un(v[4].features[1].properties.distance)+"")&&le(m,d),b&16&&y!==(y=cn(v[4].features[1].properties.time)+"")&&le(h,y)},d(v){v&&(k(e),k(f),k(u))}}}function Ig(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y;n=new mn({}),n.$on("click",r[6]);let h=r[4].features.length==2&&ui(r);return{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("p"),l.textContent="Drag markers for a route",o=M(),h&&h.c(),i=M(),s=S("label"),a=j("Slow-down factor for main roads: "),f=j(r[1]),u=M(),c=S("input"),_=M(),d=S("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,N(c,"type","range"),N(c,"min","1.0"),N(c,"max","5.0"),N(c,"step","0.1"),N(e,"slot","sidebar")},m(v,b){w(v,e,b),A(n,e,null),p(e,t),p(e,l),p(e,o),h&&h.m(e,null),p(e,i),p(e,s),p(s,a),p(s,f),p(s,u),p(s,c),qe(c,r[1]),p(e,_),p(e,d),m=!0,g||(y=[X(c,"change",r[10]),X(c,"input",r[10])],g=!0)},p(v,b){v[4].features.length==2?h?h.p(v,b):(h=ui(v),h.c(),h.m(e,i)):h&&(h.d(1),h=null),(!m||b&2)&&le(f,v[1]),b&2&&qe(c,v[1])},i(v){m||($(n.$$.fragment,v),m=!0)},o(v){C(n.$$.fragment,v),m=!1},d(v){v&&k(e),F(n),h&&h.d(),g=!1,ft(y)}}}function ci(r){let e,n;return e=new er({props:{$$slots:{default:[Ng]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Ng(r){let e,n,t,l,o,i,s,a;return e=new Fr({}),t=new Ar({}),o=new Pr({}),s=new xn({props:{interactive:!1}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),T(s.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),w(f,l,u),A(o,f,u),w(f,i,u),A(s,f,u),a=!0},p:Q,i(f){a||($(e.$$.fragment,f),$(t.$$.fragment,f),$(o.$$.fragment,f),$(s.$$.fragment,f),a=!0)},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),C(o.$$.fragment,f),C(s.$$.fragment,f),a=!1},d(f){f&&(k(n),k(l),k(i)),F(e,f),F(t,f),F(o,f),F(s,f)}}}function jg(r){let e,n;const t=[ye("compare-route"),{paint:{"line-width":10,"line-color":Ht(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function zg(r){let e;return{c(){e=j("A")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Og(r){let e;return{c(){e=j("B")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Bg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d=r[0]=="neighbourhood"&&ci(r);t=new pn({}),o=new Ve({props:{data:r[4],$$slots:{default:[jg]},$$scope:{ctx:r}}});function m(v){r[8](v)}let g={draggable:!0,$$slots:{default:[zg]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new vn({props:g}),ze.push(()=>nt(s,"lngLat",m));function y(v){r[9](v)}let h={draggable:!0,$$slots:{default:[Og]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.lngLat=r[2]),u=new vn({props:h}),ze.push(()=>nt(u,"lngLat",y)),{c(){e=S("div"),d&&d.c(),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),T(s.$$.fragment),f=M(),T(u.$$.fragment),N(e,"slot","map")},m(v,b){w(v,e,b),d&&d.m(e,null),p(e,n),A(t,e,null),p(e,l),A(o,e,null),p(e,i),A(s,e,null),p(e,f),A(u,e,null),_=!0},p(v,b){v[0]=="neighbourhood"?d?b&1&&$(d,1):(d=ci(v),d.c(),$(d,1),d.m(e,n)):d&&(he(),C(d,1,1,()=>{d=null}),be());const L={};b&16&&(L.data=v[4]),b&16384&&(L.$$scope={dirty:b,ctx:v}),o.$set(L);const I={};b&16384&&(I.$$scope={dirty:b,ctx:v}),!a&&b&8&&(a=!0,I.lngLat=v[3],rt(()=>a=!1)),s.$set(I);const E={};b&16384&&(E.$$scope={dirty:b,ctx:v}),!c&&b&4&&(c=!0,E.lngLat=v[2],rt(()=>c=!1)),u.$set(E)},i(v){_||($(d),$(t.$$.fragment,v),$(o.$$.fragment,v),$(s.$$.fragment,v),$(u.$$.fragment,v),_=!0)},o(v){C(d),C(t.$$.fragment,v),C(o.$$.fragment,v),C(s.$$.fragment,v),C(u.$$.fragment,v),_=!1},d(v){v&&k(e),d&&d.d(),F(t),F(o),F(s),F(u)}}}function Rg(r){let e,n;return e=new At({props:{$$slots:{map:[Bg],sidebar:[Ig],top:[Eg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&16447&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Dg(r,e,n){let t,l,o,i,s,a;V(r,de,h=>n(5,l=h)),V(r,Ll,h=>n(1,o=h)),V(r,qn,h=>n(2,i=h)),V(r,Jn,h=>n(3,s=h)),V(r,xe,h=>n(7,a=h));let{prevMode:f}=e;function u(){ne(de,l={mode:f},l)}function c(h){s=h,Jn.set(s)}function _(h){i=h,qn.set(i)}function d(){o=fl(this.value),Ll.set(o)}const m=()=>ne(de,l={mode:"title",firstLoad:!1},l),g=()=>ne(de,l={mode:"pick-neighbourhood"},l),y=()=>ne(de,l={mode:"neighbourhood"},l);return r.$$set=h=>{"prevMode"in h&&n(0,f=h.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&n(4,t=a.compareRoute(s,i,o))},[f,o,i,s,t,l,u,a,c,_,d,m,g,y]}class Ug extends ae{constructor(e){super(),fe(this,e,Dg,Rg,oe,{prevMode:0})}}let Tn=Mt(null);const jt=Mt([]);function $s(r){if(r.length<3)return JSON.parse(Gt(Tn).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let n=JSON.parse(Gt(Tn).inner.calculateRoute(e));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}const{window:Hg}=Ui,Gg=r=>({}),di=r=>({}),Wg=r=>({}),_i=r=>({});function mi(r,e,n){const t=r.slice();return t[44]=e[n],t[45]=e,t[46]=n,t}function pi(r,e,n){const t=r.slice();return t[47]=e[n],t[48]=e,t[49]=n,t}function qg(r){let e,n;const t=r[24]["extra-top"],l=Re(t,r,r[38],di);return{c(){e=S("div"),l&&l.c(),N(e,"slot","top")},m(o,i){w(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i[1]&128)&&De(l,t,o,o[38],n?He(t,o[38],i,Gg):Ue(o[38]),di)},i(o){n||($(l,o),n=!0)},o(o){C(l,o),n=!1},d(o){o&&k(e),l&&l.d(o)}}}function Jg(r){let e,n,t,l,o;return{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,n=M(),t=S("p"),t.textContent="Keyboard shortcuts:",l=M(),o=S("ul"),o.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){w(i,e,s),w(i,n,s),w(i,t,s),w(i,l,s),w(i,o,s)},p:Q,d(i){i&&(k(e),k(n),k(t),k(l),k(o))}}}function Zg(r){let e,n=r[8].length+"",t,l;return{c(){e=j("Undo ("),t=j(n),l=j(")")},m(o,i){w(o,e,i),w(o,t,i),w(o,l,i)},p(o,i){i[0]&256&&n!==(n=o[8].length+"")&&le(t,n)},d(o){o&&(k(e),k(t),k(l))}}}function Yg(r){let e;return{c(){e=j("Undo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Kg(r){let e;return{c(){e=S("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function Xg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;return c=Hi(r[36][0]),{c(){e=S("fieldset"),n=S("label"),t=S("input"),l=j(`
          Snap to roads`),o=M(),i=S("label"),s=S("input"),a=j(`
          Draw anywhere`),f=M(),u=S("p"),u.textContent="Click to add at least 3 points",N(t,"type","radio"),t.__value="snap",qe(t,t.__value),N(s,"type","radio"),s.__value="free",qe(s,s.__value),c.p(t,s)},m(m,g){w(m,e,g),p(e,n),p(n,t),t.checked=t.__value===r[7],p(n,l),p(e,o),p(e,i),p(i,s),s.checked=s.__value===r[7],p(i,a),w(m,f,g),w(m,u,g),_||(d=[X(t,"change",r[35]),X(s,"change",r[37])],_=!0)},p(m,g){g[0]&128&&(t.checked=t.__value===m[7]),g[0]&128&&(s.checked=s.__value===m[7])},d(m){m&&(k(e),k(f),k(u)),c.r(),_=!1,ft(d)}}}function Vg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h;const v=r[24]["extra-sidebar"],b=Re(v,r,r[38],_i);u=new Dt({props:{$$slots:{default:[Jg]},$$scope:{ctx:r}}});function L(D,R){return D[8].length==0?Yg:Zg}let I=L(r),E=I(r);function P(D,R){return D[5].length<3?Xg:Kg}let O=P(r),B=O(r);return{c(){e=S("div"),b&&b.c(),n=M(),t=S("div"),l=S("button"),o=j("Finish"),s=M(),a=S("button"),a.textContent="Cancel",f=M(),T(u.$$.fragment),c=M(),_=S("button"),E.c(),m=M(),B.c(),l.disabled=i=r[5].length<3,N(a,"class","secondary"),ie(t,"display","flex"),N(_,"class","secondary"),_.disabled=d=r[8].length==0,N(e,"slot","sidebar")},m(D,R){w(D,e,R),b&&b.m(e,null),p(e,n),p(e,t),p(t,l),p(l,o),p(t,s),p(t,a),p(t,f),A(u,t,null),p(e,c),p(e,_),E.m(_,null),p(e,m),B.m(e,null),g=!0,y||(h=[X(l,"click",function(){Wr(r[0])&&r[0].apply(this,arguments)}),X(a,"click",function(){Wr(r[1])&&r[1].apply(this,arguments)}),X(_,"click",r[11])],y=!0)},p(D,R){r=D,b&&b.p&&(!g||R[1]&128)&&De(b,v,r,r[38],g?He(v,r[38],R,Wg):Ue(r[38]),_i),(!g||R[0]&32&&i!==(i=r[5].length<3))&&(l.disabled=i);const z={};R[1]&128&&(z.$$scope={dirty:R,ctx:r}),u.$set(z),I===(I=L(r))&&E?E.p(r,R):(E.d(1),E=I(r),E&&(E.c(),E.m(_,null))),(!g||R[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),O===(O=P(r))&&B?B.p(r,R):(B.d(1),B=O(r),B&&(B.c(),B.m(e,null)))},i(D){g||($(b,D),$(u.$$.fragment,D),g=!0)},o(D){C(b,D),C(u.$$.fragment,D),g=!1},d(D){D&&k(e),b&&b.d(D),F(u),E.d(),B.d(),y=!1,ft(h)}}}function Qg(r){let e;return{c(){e=S("span"),N(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped-node",r[47].snapped),gt(e,"free-node",!r[47].snapped),gt(e,"hide",r[4])},m(n,t){w(n,e,t)},p(n,t){t[0]&512&&gt(e,"snapped-node",n[47].snapped),t[0]&512&&gt(e,"free-node",!n[47].snapped),t[0]&16&&gt(e,"hide",n[4])},d(n){n&&k(e)}}}function gi(r){let e,n,t;function l(f){r[25](f,r[47])}function o(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[Qg]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new Lr({props:a}),ze.push(()=>nt(e,"lngLat",l)),e.$on("dragstart",o),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){T(e.$$.fragment)},m(f,u){A(e,f,u),t=!0},p(f,u){r=f;const c={};u[0]&528|u[1]&128&&(c.$$scope={dirty:u,ctx:r}),!n&&u[0]&512&&(n=!0,c.lngLat=r[47].point,rt(()=>n=!1)),e.$set(c)},i(f){t||($(e.$$.fragment,f),t=!0)},o(f){C(e.$$.fragment,f),t=!1},d(f){F(e,f)}}}function xg(r){let e;return{c(){e=S("span"),e.textContent=`${r[46]+1}`,N(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped",r[44].snapped)},m(n,t){w(n,e,t)},p(n,t){t[0]&32&&gt(e,"snapped",n[44].snapped)},d(n){n&&k(e)}}}function hi(r){let e,n,t;function l(a){r[29](a,r[44])}function o(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[xg]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new Lr({props:s}),ze.push(()=>nt(e,"lngLat",l)),e.$on("click",o),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){T(e.$$.fragment)},m(a,f){A(e,a,f),t=!0},p(a,f){r=a;const u={};f[0]&32|f[1]&128&&(u.$$scope={dirty:f,ctx:r}),!n&&f[0]&32&&(n=!0,u.lngLat=r[44].point,rt(()=>n=!1)),e.$set(u)},i(a){t||($(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){F(e,a)}}}function e1(r){let e,n,t,l;const o=[ye("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let f=0;f<o.length;f+=1)i=me(i,o[f]);e=new lt({props:i});const s=[ye("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let f=0;f<s.length;f+=1)a=me(a,s[f]);return t=new $t({props:a}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _={};t.$set(_)},i(f){l||($(e.$$.fragment,f),$(t.$$.fragment,f),l=!0)},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),l=!1},d(f){f&&k(n),F(e,f),F(t,f)}}}function t1(r){let e,n;return e=new lt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function n1(r){let e,n,t,l,o,i,s,a,f;n=new ss({}),n.$on("click",r[12]),n.$on("mousemove",r[13]);let u=Me(r[9]),c=[];for(let y=0;y<u.length;y+=1)c[y]=gi(pi(r,u,y));const _=y=>C(c[y],1,1,()=>{c[y]=null});let d=Me(r[5]),m=[];for(let y=0;y<d.length;y+=1)m[y]=hi(mi(r,d,y));const g=y=>C(m[y],1,1,()=>{m[y]=null});return i=new Ve({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[e1]},$$scope:{ctx:r}}}),a=new Ve({props:{data:r[10],$$slots:{default:[t1]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),t=M();for(let y=0;y<c.length;y+=1)c[y].c();l=M();for(let y=0;y<m.length;y+=1)m[y].c();o=M(),T(i.$$.fragment),s=M(),T(a.$$.fragment),N(e,"slot","map")},m(y,h){w(y,e,h),A(n,e,null),p(e,t);for(let v=0;v<c.length;v+=1)c[v]&&c[v].m(e,null);p(e,l);for(let v=0;v<m.length;v+=1)m[v]&&m[v].m(e,null);p(e,o),A(i,e,null),p(e,s),A(a,e,null),f=!0},p(y,h){if(h[0]&918032){u=Me(y[9]);let L;for(L=0;L<u.length;L+=1){const I=pi(y,u,L);c[L]?(c[L].p(I,h),$(c[L],1)):(c[L]=gi(I),c[L].c(),$(c[L],1),c[L].m(e,l))}for(he(),L=u.length;L<c.length;L+=1)_(L);be()}if(h[0]&2146348){d=Me(y[5]);let L;for(L=0;L<d.length;L+=1){const I=mi(y,d,L);m[L]?(m[L].p(I,h),$(m[L],1)):(m[L]=hi(I),m[L].c(),$(m[L],1),m[L].m(e,o))}for(he(),L=d.length;L<m.length;L+=1)g(L);be()}const v={};h[0]&96&&(v.data=y[16](y[6],y[5])),h[1]&128&&(v.$$scope={dirty:h,ctx:y}),i.$set(v);const b={};h[0]&1024&&(b.data=y[10]),h[1]&128&&(b.$$scope={dirty:h,ctx:y}),a.$set(b)},i(y){if(!f){$(n.$$.fragment,y);for(let h=0;h<u.length;h+=1)$(c[h]);for(let h=0;h<d.length;h+=1)$(m[h]);$(i.$$.fragment,y),$(a.$$.fragment,y),f=!0}},o(y){C(n.$$.fragment,y),c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)C(c[h]);m=m.filter(Boolean);for(let h=0;h<m.length;h+=1)C(m[h]);C(i.$$.fragment,y),C(a.$$.fragment,y),f=!1},d(y){y&&k(e),F(n),dt(c,y),dt(m,y),F(i),F(a)}}}function r1(r){let e,n,t,l;return e=new At({props:{$$slots:{map:[n1],sidebar:[Vg],top:[qg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0,t||(l=X(Hg,"keydown",r[20]),t=!0)},p(o,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o),t=!1,l()}}}function l1(r,e,n){let t,l,o;V(r,jt,K=>n(5,l=K)),V(r,Tn,K=>n(6,o=K));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:f}=e,{cancel:u}=e;Tt(()=>{ne(jt,l=[],l),o==null||o.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],m=null,g=!1,y=!1,h=!1;function v(K){let pe=K.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=pe}function b(){let K=_.pop();n(8,_),K&&ne(jt,l=K,l)}function L(){_.length==100&&_.shift(),n(8,_=[..._,JSON.parse(JSON.stringify(l))])}function I(){n(7,c=c=="snap"?"free":"snap"),m&&n(23,m.snapped=c=="snap",m)}function E(K){l.length>=3||(L(),jt.update(pe=>(pe.push({point:K.detail.lngLat.toArray(),snapped:c=="snap"}),pe)))}function P(K){n(23,m={point:K.detail.lngLat.toArray(),snapped:c=="snap"})}function O(K){L(),jt.update(pe=>(pe[K].snapped=!pe[K].snapped,pe))}function B(K){L(),jt.update(pe=>(pe.splice(K,1),pe)),n(2,g=!1)}function D(K,pe){try{if(K)return $s(pe)}catch{}return rn()}function R(K,pe,ee,ge){if(ge||pe.length>=3)return rn();try{if(K&&pe.length>0&&ee)return JSON.parse(K.inner.calculateRoute([pe[pe.length-1],ee]))}catch{}return rn()}function z(K,pe,ee){if(ee)return;if(!K||pe.length<3){n(9,d=[]);return}let ge=[],$e=1,Se=JSON.parse(JSON.stringify(pe));Se.push(Se[0]);for(let W=0;W<Se.length-1;W++){let _t=JSON.parse(K.inner.getExtraNodes(Se[W],Se[W+1]));for(let[Be,Ge,kt]of _t)ge.push({point:[Be,Ge],snapped:kt,insertIdx:$e});$e++}n(9,d=ge)}function U(K){L(),jt.update(pe=>(pe.splice(K.insertIdx,0,{point:K.point,snapped:K.snapped}),pe)),n(4,h=!0)}function H(K){jt.update(pe=>(pe[K.insertIdx].point=K.point,pe))}function Y(){n(4,h=!1)}function Z(K){let pe=K.target.tagName,ee=pe=="INPUT"||pe=="TEXTAREA";K.key=="Enter"&&!ee||K.key=="Escape"?(K.stopPropagation(),l.length>=3?f():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):K.key=="s"&&!ee?I():K.key=="z"&&K.ctrlKey&&(K.stopPropagation(),b())}function se(){L(),n(3,y=!0)}const G=[[]];function we(K,pe){r.$$.not_equal(pe.point,K)&&(pe.point=K,n(9,d))}const x=K=>U(K),ue=K=>H(K),ve=K=>{U(K),n(4,h=!1)};function ce(K,pe){r.$$.not_equal(pe.point,K)&&(pe.point=K,jt.set(l))}const Fe=K=>O(K),Ze=K=>B(K),Te=()=>n(2,g=!0),re=()=>n(2,g=!1),Je=()=>n(3,y=!1);function Ne(){c=this.__value,n(7,c)}function ke(){c=this.__value,n(7,c)}return r.$$set=K=>{"map"in K&&n(22,a=K.map),"finish"in K&&n(0,f=K.finish),"cancel"in K&&n(1,u=K.cancel),"$$scope"in K&&n(38,s=K.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&z(o,l,h),r.$$.dirty[0]&8388716&&n(10,t=R(o,l,m,g||y)),r.$$.dirty[0]&32&&v(l)},[f,u,g,y,h,l,o,c,_,d,t,b,E,P,O,B,D,U,H,Y,Z,se,a,m,i,we,x,ue,ve,ce,Fe,Ze,Te,re,Je,Ne,G,ke,s]}class o1 extends ae{constructor(e){super(),fe(this,e,l1,r1,oe,{map:22,finish:0,cancel:1},null,[-1,-1])}}function i1(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function s1(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function a1(r){let e;return{c(){e=S("li"),e.textContent="Creating new neighbourhood boundary"},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}function f1(r){let e,n,t,l,o;return n=new Ce({props:{$$slots:{default:[u1]},$$scope:{ctx:r}}}),n.$on("click",r[8]),{c(){e=S("li"),T(n.$$.fragment),t=M(),l=S("li"),l.textContent="Changing neighbourhood boundary"},m(i,s){w(i,e,s),A(n,e,null),w(i,t,s),w(i,l,s),o=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||($(n.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),o=!1},d(i){i&&(k(e),k(t),k(l)),F(n)}}}function u1(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function c1(r){let e,n,t,l,o,i,s,a,f,u,c,_;o=new Ce({props:{$$slots:{default:[i1]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[s1]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[f1,a1],m=[];function g(y,h){return y[1]?0:1}return u=g(r),c=m[u]=d[u](r),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),c.c(),N(n,"aria-label","breadcrumb"),N(e,"slot","extra-top")},m(y,h){w(y,e,h),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),m[u].m(t,null),_=!0},p(y,h){const v={};h&4096&&(v.$$scope={dirty:h,ctx:y}),o.$set(v);const b={};h&4096&&(b.$$scope={dirty:h,ctx:y}),a.$set(b);let L=u;u=g(y),u===L?m[u].p(y,h):(he(),C(m[L],1,1,()=>{m[L]=null}),be(),c=m[u],c?c.p(y,h):(c=m[u]=d[u](y),c.c()),$(c,1),c.m(t,null))},i(y){_||($(o.$$.fragment,y),$(a.$$.fragment,y),$(c),_=!0)},o(y){C(o.$$.fragment,y),C(a.$$.fragment,y),C(c),_=!1},d(y){y&&k(e),F(o),F(a),m[u].d()}}}function d1(r){let e,n,t,l;return{c(){e=S("div"),n=S("h1"),t=j("Draw your neighbourhood boundary for "),l=j(r[0]),N(e,"slot","extra-sidebar")},m(o,i){w(o,e,i),p(e,n),p(n,t),p(n,l)},p(o,i){i&1&&le(l,o[0])},d(o){o&&k(e)}}}function _1(r){let e,n;return e=new o1({props:{map:tt(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[d1],"extra-top":[c1]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&8&&(o.map=tt(t[3])),l&4103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function m1(r,e,n){let t,l,o,i,s;V(r,de,g=>n(2,t=g)),V(r,Wn,g=>n(9,l=g)),V(r,xe,g=>n(10,o=g)),V(r,jt,g=>n(11,i=g)),V(r,Qt,g=>n(3,s=g));let{name:a}=e,{existing:f}=e;f&&(f.properties.waypoints?ne(jt,i=f.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):ne(jt,i=f.geometry.coordinates[1].slice(1).map(g=>({point:g,snapped:!1})),i));function u(){if(i.length>=3)try{let g=$s(i);o.setNeighbourhoodBoundary(a,g),Cn(),o.setCurrentNeighbourhood(a,l),ne(de,t={mode:"neighbourhood"},t)}catch(g){console.log("error when setting hand drawn neighborhood",g),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working."),c()}}function c(){f?ne(de,t={mode:"neighbourhood"},t):ne(de,t={mode:"pick-neighbourhood"},t)}const _=()=>ne(de,t={mode:"title",firstLoad:!1},t),d=()=>ne(de,t={mode:"pick-neighbourhood"},t),m=()=>ne(de,t={mode:"neighbourhood"},t);return r.$$set=g=>{"name"in g&&n(0,a=g.name),"existing"in g&&n(1,f=g.existing)},[a,f,t,s,u,c,_,d,m]}class p1 extends ae{constructor(e){super(),fe(this,e,m1,_1,oe,{name:0,existing:1})}}const g1="/ltn/assets/settings-342fb430.svg";function bi(r){let e,n;return e=new kr({props:{$$slots:{default:[h1]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&67&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function h1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;return t=new Kf({}),{c(){e=S("h1"),e.textContent="Settings",n=M(),T(t.$$.fragment),l=M(),o=S("label"),i=S("input"),s=j(`
      Road thickness depends on shortcuts`),a=M(),f=S("center"),u=S("button"),u.textContent="Confirm",N(i,"type","checkbox")},m(m,g){w(m,e,g),w(m,n,g),A(t,m,g),w(m,l,g),w(m,o,g),p(o,i),i.checked=r[1],p(o,s),w(m,a,g),w(m,f,g),p(f,u),c=!0,_||(d=[X(i,"change",r[3]),X(u,"click",r[4])],_=!0)},p(m,g){g&2&&(i.checked=m[1])},i(m){c||($(t.$$.fragment,m),c=!0)},o(m){C(t.$$.fragment,m),c=!1},d(m){m&&(k(e),k(n),k(l),k(o),k(a),k(f)),F(t,m),_=!1,ft(d)}}}function b1(r){let e,n,t,l,o,i,s=r[0]&&bi(r);return{c(){e=S("button"),e.innerHTML=`<img src="${g1}" alt="Settings"/>`,n=M(),s&&s.c(),t=Ye(),N(e,"class","outline")},m(a,f){w(a,e,f),w(a,n,f),s&&s.m(a,f),w(a,t,f),l=!0,o||(i=X(e,"click",r[2]),o=!0)},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&$(s,1)):(s=bi(a),s.c(),$(s,1),s.m(t.parentNode,t)):s&&(he(),C(s,1,1,()=>{s=null}),be())},i(a){l||($(s),l=!0)},o(a){C(s),l=!1},d(a){a&&(k(e),k(n),k(t)),s&&s.d(a),o=!1,i()}}}function $1(r,e,n){let t;V(r,Jr,f=>n(1,t=f));let l=!1;const o=()=>n(0,l=!0);function i(){t=this.checked,Jr.set(t)}return[l,t,o,i,()=>n(0,l=!1),()=>n(0,l=!1)]}class v1 extends ae{constructor(e){super(),fe(this,e,$1,b1,oe,{})}}const y1=["==",["geometry-type"],"Polygon"],w1=["==",["geometry-type"],"LineString"],k1=["==",["geometry-type"],"Point"];function vs(){return{type:"FeatureCollection",features:[]}}function Hr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:ys(r)}}}function ys(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const ws=Mt(vs()),ks=Mt(0),S1=100;class L1{constructor(e){pt(this,"map");pt(this,"active");pt(this,"eventListenersSuccess");pt(this,"eventListenersUpdated");pt(this,"eventListenersFailure");pt(this,"points");pt(this,"cursor");pt(this,"hover");pt(this,"dragFrom");pt(this,"previousStates");pt(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,t=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=n,l[1]-=t}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});pt(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if($i(this.points).forEach((t,l)=>{n.push([l+1,$f(t,this.cursor).properties.dist])}),n.sort((t,l)=>t[1]-l[1]),n.length>0){let t=n[0][0];this.points.splice(t,0,this.cursor.geometry.coordinates),this.hover=t}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});pt(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Hr(e.lngLat.toArray()),this.onClick(e),this.finish())});pt(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});pt(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});pt(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});pt(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=vs();this.points.forEach((l,o)=>{let i=Hr(l);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),e.features=e.features.concat($i(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),ws.set(e);let t="crosshair";this.hover!=null&&(t=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=t,ks.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Hr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(ys),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>S1&&this.previousStates.shift()}}function $i(r){let e=[];for(let n=0;n<r.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[n],r[n+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function C1(r){let e,n,t;return{c(){e=j("Undo ("),n=j(r[1]),t=j(")")},m(l,o){w(l,e,o),w(l,n,o),w(l,t,o)},p(l,o){o&2&&le(n,l[1])},d(l){l&&(k(e),k(n),k(t))}}}function M1(r){let e;return{c(){e=j("Undo")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function T1(r){let e,n,t,l,o,i,s,a,f,u,c;function _(g,y){return g[1]==0?M1:C1}let d=_(r),m=d(r);return{c(){e=S("div"),n=S("button"),n.textContent="Finish",t=M(),l=S("button"),l.textContent="Cancel",o=M(),i=S("button"),m.c(),a=M(),f=S("ul"),f.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,ie(e,"display","flex"),ie(e,"justify-content","space-between")},m(g,y){w(g,e,y),p(e,n),p(e,t),p(e,l),p(e,o),p(e,i),m.m(i,null),w(g,a,y),w(g,f,y),u||(c=[X(n,"click",r[2]),X(l,"click",r[3]),X(i,"click",r[4])],u=!0)},p(g,[y]){d===(d=_(g))&&m?m.p(g,y):(m.d(1),m=d(g),m&&(m.c(),m.m(i,null))),y&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Q,o:Q,d(g){g&&(k(e),k(a),k(f)),m.d(),u=!1,ft(c)}}}function A1(r,e,n){let t;V(r,ks,a=>n(1,t=a));let{polygonTool:l}=e;const o=()=>l.finish(),i=()=>l.cancel(),s=()=>l.undo();return r.$$set=a=>{"polygonTool"in a&&n(0,l=a.polygonTool)},[l,t,o,i,s]}class F1 extends ae{constructor(e){super(),fe(this,e,A1,T1,oe,{polygonTool:0})}}let P1=Date.now();function tr(r){return`${r}-${P1++}`}const Ss=Symbol.for("svelte-maplibre");function E1(){return ul(Ss)}function vi(r){return{subscribe:r.subscribe}}function Ls({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:t=!1}){let l=E1(),o=Mt(null),i=vi(o),s={...l,[r]:vi(o)};if(e&&(s.popupTarget=i),t){let a=Mt(null);s.layerEvent=a,l.layerEvent=a}return n&&(s.cluster=Mt()),Gi(Ss,s),{...l,self:o}}function I1(){return Ls({key:"source",setCluster:!0})}function N1(r=!0){return Ls({key:"layer",setPopupTarget:r,setMouseEvent:r})}function yi(r){let e;return n=>{if(n)for(let t in n){let l=e==null?void 0:e[t],o=n[t];l!==o&&r(t,o,l)}else if(e)for(let t in e)r(t,void 0,e[t]);e=n}}function j1(r,...e){let n=[r];for(let t of e)if(t)Array.isArray(t)&&t[0]===r?n.push(...t.slice(1)):n.push(t);else continue;if(n.length!==1)return n.length===2?n[1]:n}function z1(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function wi(r){let e=r[0],n,t,l=ki(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),w(o,n,i),t=!0},p(o,i){i[0]&1&&oe(e,e=o[0])?(he(),C(l,1,1,Q),be(),l=ki(o),l.c(),$(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||($(l),t=!0)},o(o){C(l),t=!1},d(o){o&&k(n),l.d(o)}}}function ki(r){let e;const n=r[36].default,t=Re(n,r,r[35],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o[1]&16)&&De(t,n,l,l[35],e?He(n,l[35],o,null):Ue(l[35]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function O1(r){let e,n,t=r[0]&&wi(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,o){l[0]?t?(t.p(l,o),o[0]&1&&$(t,1)):(t=wi(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function B1(r,e,n){let t,l,o,i,s,a,f,u,c,_,d,m,{$$slots:g={},$$scope:y}=e,{id:h=tr("layer")}=e,{source:v=void 0}=e,{sourceLayer:b=void 0}=e,{beforeId:L=void 0}=e,{beforeLayerType:I=void 0}=e,{type:E}=e,{paint:P=void 0}=e,{layout:O=void 0}=e,{filter:B=void 0}=e,{applyToClusters:D=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:z=void 0}=e,{manageHoverState:U=!1}=e,{hovered:H=null}=e,{interactive:Y=!0}=e,{hoverCursor:Z=void 0}=e,{eventsIfTopMost:se=!1}=e;const G=dn(),{map:we,source:x,self:ue,minzoom:ve,maxzoom:ce,eventTopMost:Fe,layerInfo:Ze}=N1();V(r,we,ee=>n(31,c=ee)),V(r,x,ee=>n(32,_=ee)),V(r,ue,ee=>n(0,u=ee)),V(r,ve,ee=>n(34,m=ee)),V(r,ce,ee=>n(33,d=ee)),Tt(()=>{u&&c&&(Ze.delete(u),c==null||c.removeLayer(u))});let Te;function re(ee){var W,_t;if(!Y||!u||!c||se&&Fe(ee)!==u)return;let ge=ee.features??[],$e=(_t=(W=ge[0])==null?void 0:W.properties)==null?void 0:_t.cluster_id,Se={event:ee,map:c,clusterId:$e,layer:u,source:s,features:ge};G(ee.type,Se)}function Je(ee){var W,_t;if(!Y||!u||!c||se&&Fe(ee)!==u)return;Z&&(c.getCanvas().style.cursor=Z);let ge=ee.features??[];n(6,H=ge[0]??null);let $e=(_t=(W=ge[0])==null?void 0:W.properties)==null?void 0:_t.cluster_id;G("mouseenter",{event:ee,map:c,clusterId:$e,layer:u,source:s,features:ge})}function Ne(ee){var W,_t,Be;if(!Y||!c)return;if(se&&Fe(ee)!==u){n(6,H=null),U&&Te!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:b,id:Te},{hover:!1}),Te=void 0);return}c.getCanvas().style.cursor=Z;let ge=ee.features??[],$e=(_t=(W=ge[0])==null?void 0:W.properties)==null?void 0:_t.cluster_id,Se=(Be=ge[0])==null?void 0:Be.id;Se!==Te&&(U&&(Te!==void 0&&(c==null||c.setFeatureState({source:s,id:Te,sourceLayer:b},{hover:!1})),c==null||c.setFeatureState({source:s,id:Se,sourceLayer:b},{hover:!0})),Te=Se,n(6,H=ge[0]??null)),G("mousemove",{event:ee,map:c,clusterId:$e,layer:u,source:s,features:ge})}function ke(ee){if(!(!Y||!u||!c)){if(Z&&(c.getCanvas().style.cursor=""),n(6,H=null),U&&Te!==void 0){const ge={source:s,id:Te,sourceLayer:b};c==null||c.setFeatureState(ge,{hover:!1}),Te=void 0}G("mouseleave",{map:c,layer:u,source:s})}}let K=!0;function pe(ee){c&&(c.off("click",ee,re),c.off("dblclick",ee,re),c.off("contextmenu",ee,re),c.off("mouseenter",ee,Je),c.off("mousemove",ee,Ne),c.off("mouseleave",ee,ke))}return Tt(()=>{c&&u&&pe(u)}),r.$$set=ee=>{"id"in ee&&n(7,h=ee.id),"source"in ee&&n(8,v=ee.source),"sourceLayer"in ee&&n(9,b=ee.sourceLayer),"beforeId"in ee&&n(10,L=ee.beforeId),"beforeLayerType"in ee&&n(11,I=ee.beforeLayerType),"type"in ee&&n(12,E=ee.type),"paint"in ee&&n(13,P=ee.paint),"layout"in ee&&n(14,O=ee.layout),"filter"in ee&&n(15,B=ee.filter),"applyToClusters"in ee&&n(16,D=ee.applyToClusters),"minzoom"in ee&&n(17,R=ee.minzoom),"maxzoom"in ee&&n(18,z=ee.maxzoom),"manageHoverState"in ee&&n(19,U=ee.manageHoverState),"hovered"in ee&&n(6,H=ee.hovered),"interactive"in ee&&n(20,Y=ee.interactive),"hoverCursor"in ee&&n(21,Z=ee.hoverCursor),"eventsIfTopMost"in ee&&n(22,se=ee.eventsIfTopMost),"$$scope"in ee&&n(35,y=ee.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,t=z1(D)),r.$$.dirty[0]&1073774592&&n(24,l=j1("all",t,B)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,o=R??m),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,i=z??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,s=v||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&u!==h&&s){u&&(pe(u),Ze.delete(u));let ee=L;if(!L&&I){let ge=c.getStyle().layers,$e=typeof I=="function"?I:W=>W.type===I,Se=ge==null?void 0:ge.find($e);Se&&(ee=Se.id)}ne(ue,u=h,u),c.addLayer(_r({id:u,type:E,source:s,"source-layer":b,filter:l,paint:P,layout:O,minzoom:o,maxzoom:i}),ee),n(23,K=!0),c.on("click",u,re),c.on("dblclick",u,re),c.on("contextmenu",u,re),c.on("mouseenter",u,Je),c.on("mousemove",u,Ne),c.on("mouseleave",u,ke)}r.$$.dirty[0]&1048577&&u&&Ze.set(u,{interactive:Y}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,a=u?yi((ee,ge)=>c==null?void 0:c.setPaintProperty(u,ee,ge)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,f=u?yi((ee,ge)=>c==null?void 0:c.setLayoutProperty(u,ee,ge)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(P)),r.$$.dirty[0]&134234112&&(f==null||f(O)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&u&&(c==null||c.setLayerZoomRange(u,o,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&u&&(K?n(23,K=!1):c==null||c.setFilter(u,l))},[u,we,x,ue,ve,ce,H,h,v,b,L,I,E,P,O,B,D,R,z,U,Y,Z,se,K,l,i,o,f,a,s,t,c,_,d,m,y,g]}class vl extends ae{constructor(e){super(),fe(this,e,B1,O1,oe,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function R1(r){let e;const n=r[16].default,t=Re(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&De(t,n,l,l[24],e?He(n,l[24],o,null):Ue(l[24]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function D1(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[R1]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new vl({props:o}),ze.push(()=>nt(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],rt(()=>n=!1)),e.$set(a)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function U1(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=tr("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:L=!0}=e;function I(z){v=z,n(0,v)}function E(z){je.call(this,r,z)}function P(z){je.call(this,r,z)}function O(z){je.call(this,r,z)}function B(z){je.call(this,r,z)}function D(z){je.call(this,r,z)}function R(z){je.call(this,r,z)}return r.$$set=z=>{"id"in z&&n(1,o=z.id),"source"in z&&n(2,i=z.source),"sourceLayer"in z&&n(3,s=z.sourceLayer),"beforeId"in z&&n(4,a=z.beforeId),"beforeLayerType"in z&&n(5,f=z.beforeLayerType),"paint"in z&&n(6,u=z.paint),"layout"in z&&n(7,c=z.layout),"filter"in z&&n(8,_=z.filter),"applyToClusters"in z&&n(9,d=z.applyToClusters),"minzoom"in z&&n(10,m=z.minzoom),"maxzoom"in z&&n(11,g=z.maxzoom),"hoverCursor"in z&&n(12,y=z.hoverCursor),"manageHoverState"in z&&n(13,h=z.manageHoverState),"hovered"in z&&n(0,v=z.hovered),"eventsIfTopMost"in z&&n(14,b=z.eventsIfTopMost),"interactive"in z&&n(15,L=z.interactive),"$$scope"in z&&n(24,l=z.$$scope)},[v,o,i,s,a,f,u,c,_,d,m,g,y,h,b,L,t,I,E,P,O,B,D,R,l]}class H1 extends ae{constructor(e){super(),fe(this,e,U1,D1,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function G1(r){let e;const n=r[15].default,t=Re(n,r,r[23],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8388608)&&De(t,n,l,l[23],e?He(n,l[23],o,null):Ue(l[23]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function W1(r){let e,n,t;function l(i){r[16](i)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[G1]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new vl({props:o}),ze.push(()=>nt(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],rt(()=>n=!1)),e.$set(a)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function q1(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=tr("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:y=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:b=!0}=e;function L(R){h=R,n(0,h)}function I(R){je.call(this,r,R)}function E(R){je.call(this,r,R)}function P(R){je.call(this,r,R)}function O(R){je.call(this,r,R)}function B(R){je.call(this,r,R)}function D(R){je.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,o=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,y=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,v=R.eventsIfTopMost),"interactive"in R&&n(14,b=R.interactive),"$$scope"in R&&n(23,l=R.$$scope)},[h,o,i,s,a,f,u,c,_,d,m,g,y,v,b,t,L,I,E,P,O,B,D,l]}class J1 extends ae{constructor(e){super(),fe(this,e,q1,W1,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Z1(r,e,n,t,l){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const i=()=>{t(e)&&(r.addSource(e,n),l())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function Y1(r,e,n){oa().then(()=>{let t=Gt(r);if(!t)return;t.getSource(e)===n&&t.removeSource(e)})}function Si(r){let e=r[0],n,t,l=Li(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),w(o,n,i),t=!0},p(o,i){i&1&&oe(e,e=o[0])?(he(),C(l,1,1,Q),be(),l=Li(o),l.c(),$(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||($(l),t=!0)},o(o){C(l),t=!1},d(o){o&&k(n),l.d(o)}}}function Li(r){let e;const n=r[15].default,t=Re(n,r,r[14],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16384)&&De(t,n,l,l[14],e?He(n,l[14],o,null):Ue(l[14]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function K1(r){let e,n,t=r[0]&&Si(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),w(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&$(t,1)):(t=Si(l),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(he(),C(t,1,1,()=>{t=null}),be())},i(l){n||($(t),n=!0)},o(l){C(t),n=!1},d(l){l&&k(e),t&&t.d(l)}}}function X1(r,e,n){let t,l,o,{$$slots:i={},$$scope:s}=e,{id:a=tr("geojson")}=e,{data:f}=e,{generateId:u=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:m=void 0}=e;const{map:g,cluster:y,self:h}=I1();V(r,g,L=>n(13,l=L)),V(r,y,L=>n(16,o=L)),V(r,h,L=>n(0,t=L));let v,b=!0;return Tt(()=>{t&&v&&l&&(Y1(g,t,v),ne(h,t=null,t),n(11,v=void 0))}),r.$$set=L=>{"id"in L&&n(4,a=L.id),"data"in L&&n(5,f=L.data),"generateId"in L&&n(6,u=L.generateId),"promoteId"in L&&n(7,c=L.promoteId),"filter"in L&&n(8,_=L.filter),"lineMetrics"in L&&n(9,d=L.lineMetrics),"cluster"in L&&n(10,m=L.cluster),"$$scope"in L&&n(14,s=L.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&ne(y,o=m,o),r.$$.dirty&12273&&l&&t!==a&&(ne(h,t=a,t),Z1(l,t,_r({type:"geojson",data:f,filter:_,lineMetrics:d,generateId:u,promoteId:c,cluster:!!m,clusterMinPoints:m==null?void 0:m.minPoints,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius,clusterProperties:m==null?void 0:m.properties}),L=>l&&L===t,()=>{t&&(n(11,v=l==null?void 0:l.getSource(t)),n(12,b=!0))})),r.$$.dirty&8208&&(l==null||l.on("style.load",()=>{n(11,v=l==null?void 0:l.getSource(a))})),r.$$.dirty&6176&&v&&(b?n(12,b=!1):v.setData(f)),r.$$.dirty&3072&&(v==null||v.setClusterOptions(_r({cluster:!!m,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius})))},[t,g,y,h,a,f,u,c,_,d,m,v,b,l,s,i]}class V1 extends ae{constructor(e){super(),fe(this,e,X1,K1,oe,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function Q1(r){let e;const n=r[15].default,t=Re(n,r,r[23],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8388608)&&De(t,n,l,l[23],e?He(n,l[23],o,null):Ue(l[23]),null)},i(l){e||($(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function x1(r){let e,n,t;function l(i){r[16](i)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[Q1]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new vl({props:o}),ze.push(()=>nt(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],rt(()=>n=!1)),e.$set(a)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function eh(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=tr("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:y=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:b=!0}=e;function L(R){h=R,n(0,h)}function I(R){je.call(this,r,R)}function E(R){je.call(this,r,R)}function P(R){je.call(this,r,R)}function O(R){je.call(this,r,R)}function B(R){je.call(this,r,R)}function D(R){je.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,o=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,y=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,v=R.eventsIfTopMost),"interactive"in R&&n(14,b=R.interactive),"$$scope"in R&&n(23,l=R.$$scope)},[h,o,i,s,a,f,u,c,_,d,m,g,y,v,b,t,L,I,E,P,O,B,D,l]}class th extends ae{constructor(e){super(),fe(this,e,eh,x1,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function nh(r){let e,n,t,l,o,i;return e=new J1({props:{id:"edit-polygon-fill",filter:y1,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),t=new th({props:{id:"edit-polygon-lines",filter:w1,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new H1({props:{id:"edit-polygon-vertices",filter:k1,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment)},m(s,a){A(e,s,a),w(s,n,a),A(t,s,a),w(s,l,a),A(o,s,a),i=!0},p:Q,i(s){i||($(e.$$.fragment,s),$(t.$$.fragment,s),$(o.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(t.$$.fragment,s),C(o.$$.fragment,s),i=!1},d(s){s&&(k(n),k(l)),F(e,s),F(t,s),F(o,s)}}}function rh(r){let e,n;return e=new V1({props:{data:r[0],$$slots:{default:[nh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&2&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function lh(r,e,n){let t;return V(r,ws,l=>n(0,t=l)),[t]}class oh extends ae{constructor(e){super(),fe(this,e,lh,rh,oe,{})}}function ih(r){let e,n,t,l,o,i,s;return{c(){e=S("button"),e.textContent="Import current view",n=M(),t=S("i"),t.textContent="or...",l=M(),o=S("button"),o.textContent="Draw an area to import on the map",N(e,"type","button"),N(o,"type","button")},m(a,f){w(a,e,f),w(a,n,f),w(a,t,f),w(a,l,f),w(a,o,f),i||(s=[X(e,"click",r[2]),X(o,"click",r[3])],i=!0)},p:Q,i:Q,o:Q,d(a){a&&(k(e),k(n),k(t),k(l),k(o)),i=!1,ft(s)}}}function sh(r){let e,n;return e=new F1({props:{polygonTool:r[0]}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.polygonTool=t[0]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function ah(r){let e,n,t,l,o,i,s,a,f;const u=[sh,ih],c=[];function _(d,m){return d[0]?0:1}return e=_(r),n=c[e]=u[e](r),{c(){n.c(),t=M(),l=S("label"),o=S("input"),i=j(`Save a copy of the osm.xml
  after importing`),N(o,"type","checkbox")},m(d,m){c[e].m(d,m),w(d,t,m),w(d,l,m),p(l,o),o.checked=r[1],p(l,i),s=!0,a||(f=X(o,"change",r[5]),a=!0)},p(d,[m]){let g=e;e=_(d),e===g?c[e].p(d,m):(he(),C(c[g],1,1,()=>{c[g]=null}),be(),n=c[e],n?n.p(d,m):(n=c[e]=u[e](d),n.c()),$(n,1),n.m(t.parentNode,t)),m&2&&(o.checked=d[1])},i(d){s||($(n),s=!0)},o(d){C(n),s=!1},d(d){d&&(k(t),k(l)),c[e].d(d),a=!1,f()}}}function In(r){return[r.lng,r.lat]}function fh(r,e,n){let{map:t}=e;const l=dn();let o=null,i=!1;async function s(_){try{l("loading","Loading from Overpass");let m=await(await fetch(Cs(_))).text();i&&gr("osm.xml",m),l("gotXml",{xml:m,boundary:_})}catch(d){l("error",d.toString())}}function a(){let _=t.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[In(_.getSouthWest()),In(_.getNorthWest()),In(_.getNorthEast()),In(_.getSouthEast()),In(_.getSouthWest())]],type:"Polygon"}}}async function f(){if(t){if(t.getZoom()<13){l("error","Zoom in more to import");return}await s(a())}}function u(){t&&(n(0,o=new L1(t)),o.startNew(),o.addEventListenerSuccess(async _=>{n(0,o=null),await s(_)}),o.addEventListenerFailure(()=>{n(0,o=null)}))}function c(){i=this.checked,n(1,i)}return r.$$set=_=>{"map"in _&&n(4,t=_.map)},[o,i,f,u,t,c]}class uh extends ae{constructor(e){super(),fe(this,e,fh,ah,oe,{map:4})}}function Cs(r){let e='poly:"';for(let[t,l]of r.geometry.coordinates[0])e+=`${l} ${t} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Ms{constructor(e,n,t,l){pt(this,"inner");this.inner=new Ld(e,n||new Uint8Array,t,l)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=ch(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(n=>n.properties.kind=="interior_road"?n.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,n){this.inner.setNeighbourhoodBoundary(e,n)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,n){this.inner.renameNeighbourhoodBoundary(e,n)}setCurrentNeighbourhood(e,n){this.inner.setCurrentNeighbourhood(e,n)}addModalFilter(e,n){this.inner.addModalFilter(e,n)}addManyModalFilters(e,n){this.inner.addManyModalFilters(e,n)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,n,t){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,n.lng,n.lat,t))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let n of e.features)n.properties.sum_from=lo(n.properties.counts_from),n.properties.sum_to=lo(n.properties.counts_to);return e}}function ch(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of r.features)n.properties.kind!="cell"&&n.properties.kind!="border_arrow"&&n.properties.kind!="interior_road"||(n.properties.cell_color=="disconnected"?n.properties.color="red":n.properties.color=e[n.properties.cell_color%e.length]);return r}async function cr(r){Zt.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let[n,t,l]=await dh(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),xe.set(new Ms(new Uint8Array(n),t?new Uint8Array(t):void 0,l,e.study_area_name||void 0)),Gt(xe).loadSavefile(e),console.timeEnd("load"),Ts()}catch(e){window.alert(`Couldn't open project: ${e}`),Zt.set("")}}async function dh(r,e){if(e){let n=Ct(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${n}`);let l=await(await hn(n)).arrayBuffer(),o=Ct(`cnt_boundaries/${r.study_area_name}.geojson`),s=await(await hn(o)).json(),a=Ct(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let f=null;try{f=await(await hn(a)).arrayBuffer()}catch(u){console.log(`No demand model: ${u}`)}return[l,f,s]}else if(r.study_area_name){let n=Ct(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${n}`);let l=await(await hn(n)).arrayBuffer(),o=Ct(`boundaries/${r.study_area_name}.geojson`),s=await(await hn(o)).json();return[l,null,s]}else{console.log("Grabbing from Overpass");let n=r.features.find(o=>o.properties.kind=="study_area_boundary");return[await(await hn(Cs(n))).arrayBuffer(),null,n]}}function Ts(){de.set({mode:"pick-neighbourhood"}),Tn.set(new yf(Gt(Qt),Gt(xe).toRouteSnapper(),Mt(rn()),Mt(!0),Mt(0))),Gt(Qt).fitBounds(Gt(xe).getBounds(),{animate:!1}),Jn.set(Gr()),qn.set(Gr()),ir.set(Gr());let r=new URL(window.location.href);r.searchParams.set("project",Gt(Zt)),window.history.replaceState(null,"",r.toString())}function Gr(){let r=Gt(xe).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),n=r[1]+Math.random()*(r[3]-r[1]);return new Yr.LngLat(e,n)}function Ci(r,e,n){const t=r.slice();return t[16]=e[n][0],t[17]=e[n][1],t}function Mi(r,e,n){const t=r.slice();return t[20]=e[n][0],t[21]=e[n][1],t}function _h(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function mh(r){let e,n,t,l,o,i,s,a;return o=new Ce({props:{$$slots:{default:[_h]},$$scope:{ctx:r}}}),o.$on("click",r[13]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),s.textContent="New project",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(f,u){w(f,e,u),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),a=!0},p(f,u){const c={};u&16777216&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){a||($(o.$$.fragment,f),a=!0)},o(f){C(o.$$.fragment,f),a=!1},d(f){f&&k(e),F(o)}}}function Ti(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;e=new qi({props:{loading:r[4]}});let g=Me(r[3]),y=[];for(let h=0;h<g.length;h+=1)y[h]=Fi(Ci(r,g,h));return c=new uh({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){T(e.$$.fragment),n=M(),t=S("label"),l=j(`Load a built-in area:
        `),o=S("select"),i=S("option");for(let h=0;h<y.length;h+=1)y[h].c();s=M(),a=S("i"),a.textContent="or...",f=M(),u=S("div"),T(c.$$.fragment),i.__value="",qe(i,i.__value),r[2]===void 0&&sn(()=>r[9].call(o))},m(h,v){A(e,h,v),w(h,n,v),w(h,t,v),p(t,l),p(t,o),p(o,i);for(let b=0;b<y.length;b+=1)y[b]&&y[b].m(o,null);wt(o,r[2],!0),w(h,s,v),w(h,a,v),w(h,f,v),w(h,u,v),A(c,u,null),_=!0,d||(m=[X(o,"change",r[9]),X(o,"change",r[10])],d=!0)},p(h,v){const b={};if(v&16&&(b.loading=h[4]),e.$set(b),v&8){g=Me(h[3]);let I;for(I=0;I<g.length;I+=1){const E=Ci(h,g,I);y[I]?y[I].p(E,v):(y[I]=Fi(E),y[I].c(),y[I].m(o,null))}for(;I<y.length;I+=1)y[I].d(1);y.length=g.length}v&12&&wt(o,h[2]);const L={};v&32&&(L.map=h[5]),c.$set(L)},i(h){_||($(e.$$.fragment,h),$(c.$$.fragment,h),_=!0)},o(h){C(e.$$.fragment,h),C(c.$$.fragment,h),_=!1},d(h){h&&(k(n),k(t),k(s),k(a),k(f),k(u)),F(e,h),dt(y,h),F(c),d=!1,ft(m)}}}function Ai(r){let e,n=r[21]+"",t,l;return{c(){e=S("option"),t=j(n),e.__value=l=r[20],qe(e,e.__value)},m(o,i){w(o,e,i),p(e,t)},p(o,i){i&8&&n!==(n=o[21]+"")&&le(t,n),i&8&&l!==(l=o[20])&&(e.__value=l,qe(e,e.__value))},d(o){o&&k(e)}}}function Fi(r){let e,n,t=Me(r[17]),l=[];for(let o=0;o<t.length;o+=1)l[o]=Ai(Mi(r,t,o));return{c(){e=S("optgroup");for(let o=0;o<l.length;o+=1)l[o].c();N(e,"label",n=r[16])},m(o,i){w(o,e,i);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(o,i){if(i&8){t=Me(o[17]);let s;for(s=0;s<t.length;s+=1){const a=Mi(o,t,s);l[s]?l[s].p(a,i):(l[s]=Ai(a),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}i&8&&n!==(n=o[16])&&N(e,"label",n)},d(o){o&&k(e),dt(l,o)}}}function ph(r){let e,n,t,l,o,i,s,a,f,u=r[1]&&Ti(r);return{c(){e=S("div"),n=S("div"),t=S("label"),l=j(`Project name:
        `),o=S("input"),i=M(),u&&u.c(),N(o,"type","text"),N(e,"slot","sidebar")},m(c,_){w(c,e,_),p(e,n),p(n,t),p(t,l),p(t,o),qe(o,r[1]),p(e,i),u&&u.m(e,null),s=!0,a||(f=X(o,"input",r[8]),a=!0)},p(c,_){_&2&&o.value!==c[1]&&qe(o,c[1]),c[1]?u?(u.p(c,_),_&2&&$(u,1)):(u=Ti(c),u.c(),$(u,1),u.m(e,null)):u&&(he(),C(u,1,1,()=>{u=null}),be())},i(c){s||($(u),s=!0)},o(c){C(u),s=!1},d(c){c&&k(e),u&&u.d(),a=!1,f()}}}function gh(r){let e,n,t;return n=new oh({}),{c(){e=S("div"),T(n.$$.fragment),N(e,"slot","map")},m(l,o){w(l,e,o),A(n,e,null),t=!0},p:Q,i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function hh(r){let e,n;return e=new At({props:{$$slots:{map:[gh],sidebar:[ph],top:[mh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&16777342&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function bh(r,e,n){let t,l,o,i;V(r,Zt,b=>n(14,t=b)),V(r,xe,b=>n(15,l=b)),V(r,Qt,b=>n(5,o=b)),V(r,de,b=>n(6,i=b));let s="",a="",f=[],u="";yr(async()=>{let b=await hn(Ct("severance_pbfs/areas.json"));n(3,f=await b.json())});function c(b){n(4,u="Loading OSM");try{ne(xe,l=new Ms(new TextEncoder().encode(b.detail.xml),void 0,b.detail.boundary,void 0),l),ne(Zt,t=`ltn_${s}`,t),Ts(),Cn()}catch(L){window.alert(`Couldn't import from Overpass: ${L}`)}n(4,u="")}async function _(){if(a=="")return;let b=`ltn_${s}`;window.localStorage.setItem(b,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:a})),n(4,u=`Loading pre-clipped OSM area ${a}`),await cr(b),n(4,u="")}function d(){s=this.value,n(1,s)}function m(){a=an(this),n(2,a),n(3,f)}return[_,s,a,f,u,o,i,c,d,m,()=>_(),b=>n(4,u=b.detail),b=>window.alert(b.detail),()=>ne(de,i={mode:"title",firstLoad:!1},i)]}class $h extends ae{constructor(e){super(),fe(this,e,bh,hh,oe,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Pi(r,e,n){const t=r.slice();return t[19]=e[n][0],t[20]=e[n][1],t}function Ei(r,e,n){const t=r.slice();return t[23]=e[n],t}function vh(r){let e;return{c(){e=S("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',N(e,"slot","top")},m(n,t){w(n,e,t)},p:Q,d(n){n&&k(e)}}}function yh(r){let e;return{c(){e=S("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}function wh(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;n=new Ce({props:{$$slots:{default:[kh]},$$scope:{ctx:r}}}),n.$on("click",r[11]);let m=Me(r[2]),g=[];for(let h=0;h<m.length;h+=1)g[h]=Ni(Pi(r,m,h));const y=h=>C(g[h],1,1,()=>{g[h]=null});return{c(){e=S("div"),T(n.$$.fragment),t=M(),l=S("p"),l.textContent="Load a saved project:",o=M(),i=S("ul");for(let h=0;h<g.length;h+=1)g[h].c();s=M(),a=S("label"),f=j(`Load a project from a file
        `),u=S("input"),N(u,"type","file")},m(h,v){w(h,e,v),A(n,e,null),w(h,t,v),w(h,l,v),w(h,o,v),w(h,i,v);for(let b=0;b<g.length;b+=1)g[b]&&g[b].m(i,null);w(h,s,v),w(h,a,v),p(a,f),p(a,u),r[15](u),c=!0,_||(d=X(u,"change",r[6]),_=!0)},p(h,v){const b={};if(v&67108864&&(b.$$scope={dirty:v,ctx:h}),n.$set(b),v&900){m=Me(h[2]);let L;for(L=0;L<m.length;L+=1){const I=Pi(h,m,L);g[L]?(g[L].p(I,v),$(g[L],1)):(g[L]=Ni(I),g[L].c(),$(g[L],1),g[L].m(i,null))}for(he(),L=m.length;L<g.length;L+=1)y(L);be()}},i(h){if(!c){$(n.$$.fragment,h);for(let v=0;v<m.length;v+=1)$(g[v]);c=!0}},o(h){C(n.$$.fragment,h),g=g.filter(Boolean);for(let v=0;v<g.length;v+=1)C(g[v]);c=!1},d(h){h&&(k(e),k(t),k(l),k(o),k(i),k(s),k(a)),F(n),dt(g,h),r[15](null),_=!1,d()}}}function kh(r){let e;return{c(){e=j("New project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Sh(r){let e=r[23].slice(4)+"",n;return{c(){n=j(e)},m(t,l){w(t,n,l)},p(t,l){l&4&&e!==(e=t[23].slice(4)+"")&&le(n,e)},d(t){t&&k(n)}}}function Ii(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;function g(){return r[12](r[23])}t=new Ce({props:{$$slots:{default:[Sh]},$$scope:{ctx:r}}}),t.$on("click",g),s=new bl({props:{color:"black"}});function y(){return r[13](r[23])}u=new as({props:{color:"white"}});function h(){return r[14](r[23])}return{c(){e=S("li"),n=S("span"),T(t.$$.fragment),l=M(),o=S("span"),i=S("button"),T(s.$$.fragment),a=M(),f=S("button"),T(u.$$.fragment),c=M(),N(i,"class","outline icon-btn"),N(i,"aria-label","Rename project"),N(f,"class","icon-btn destructive"),N(f,"aria-label","Delete project"),ie(o,"display","flex"),ie(o,"gap","16px"),ie(n,"display","flex"),ie(n,"justify-content","space-between")},m(v,b){w(v,e,b),p(e,n),A(t,n,null),p(n,l),p(n,o),p(o,i),A(s,i,null),p(o,a),p(o,f),A(u,f,null),p(e,c),_=!0,d||(m=[X(i,"click",y),X(f,"click",h)],d=!0)},p(v,b){r=v;const L={};b&67108868&&(L.$$scope={dirty:b,ctx:r}),t.$set(L)},i(v){_||($(t.$$.fragment,v),$(s.$$.fragment,v),$(u.$$.fragment,v),_=!0)},o(v){C(t.$$.fragment,v),C(s.$$.fragment,v),C(u.$$.fragment,v),_=!1},d(v){v&&k(e),F(t),F(s),F(u),d=!1,ft(m)}}}function Ni(r){let e,n=(r[19]??"custom area")+"",t,l,o,i,s=Me(r[20]),a=[];for(let u=0;u<s.length;u+=1)a[u]=Ii(Ei(r,s,u));const f=u=>C(a[u],1,1,()=>{a[u]=null});return{c(){e=S("u"),t=j(n),l=M();for(let u=0;u<a.length;u+=1)a[u].c();o=Ye()},m(u,c){w(u,e,c),p(e,t),w(u,l,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(u,c);w(u,o,c),i=!0},p(u,c){if((!i||c&4)&&n!==(n=(u[19]??"custom area")+"")&&le(t,n),c&900){s=Me(u[20]);let _;for(_=0;_<s.length;_+=1){const d=Ei(u,s,_);a[_]?(a[_].p(d,c),$(a[_],1)):(a[_]=Ii(d),a[_].c(),$(a[_],1),a[_].m(o.parentNode,o))}for(he(),_=s.length;_<a.length;_+=1)f(_);be()}},i(u){if(!i){for(let c=0;c<s.length;c+=1)$(a[c]);i=!0}},o(u){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)C(a[c]);i=!1},d(u){u&&(k(e),k(l),k(o)),dt(a,u)}}}function Lh(r){let e,n,t,l;const o=[wh,yh],i=[];function s(a,f){return a[4]&&a[0]?0:1}return n=s(r),t=i[n]=o[n](r),{c(){e=S("div"),t.c(),N(e,"slot","sidebar")},m(a,f){w(a,e,f),i[n].m(e,null),l=!0},p(a,f){let u=n;n=s(a),n===u?i[n].p(a,f):(he(),C(i[u],1,1,()=>{i[u]=null}),be(),t=i[n],t?t.p(a,f):(t=i[n]=o[n](a),t.c()),$(t,1),t.m(e,null))},i(a){l||($(t),l=!0)},o(a){C(t),l=!1},d(a){a&&k(e),i[n].d()}}}function Ch(r){let e,n,t,l;return e=new qi({props:{loading:r[1]}}),t=new At({props:{$$slots:{sidebar:[Lh],top:[vh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment)},m(o,i){A(e,o,i),w(o,n,i),A(t,o,i),l=!0},p(o,[i]){const s={};i&2&&(s.loading=o[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:o}),t.$set(a)},i(o){l||($(e.$$.fragment,o),$(t.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),C(t.$$.fragment,o),l=!1},d(o){o&&k(n),F(e,o),F(t,o)}}}function or(){let r=new Map,e=[];for(let t=0;t<window.localStorage.length;t++){let l=window.localStorage.key(t);if(l.startsWith("ltn_")){let o="";try{o=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}o&&o.length>0?(r.has(o)||r.set(o,[]),r.get(o).push(l)):e.push(l)}}let n=[...r.entries()];return n.sort((t,l)=>t[0].localeCompare(l[0])),n.push(["custom",e]),n}function Mh(r,e,n){let t,l,o,i,s;V(r,Zt,E=>n(16,t=E)),V(r,Tn,E=>n(17,l=E)),V(r,xe,E=>n(18,o=E)),V(r,Qt,E=>n(4,i=E)),V(r,de,E=>n(5,s=E));let{wasmReady:a}=e,{firstLoad:f}=e,u="";if(ne(xe,o=null,o),ne(Tn,l=null,l),ne(Zt,t="",t),f){let P=new URLSearchParams(window.location.search).get("project");P&&(u=`Loading project ${P}`,cr(P))}else{let E=new URL(window.location.href);E.searchParams.delete("project"),window.history.replaceState(null,"",E.toString())}let c=or(),_;async function d(E){let P="ltn_"+_.files[0].name;n(1,u=`Loading from file ${P}`),window.localStorage.setItem(P,await _.files[0].text()),n(2,c=or()),await cr(P),n(1,u="")}function m(E){window.confirm(`Really delete project ${E}? You can't undo this.`)&&(window.localStorage.removeItem(E),n(2,c=or()))}function g(E){let P=window.prompt(`Rename project ${E} to what?`,E);if(P){P.startsWith("ltn_")||(P=`ltn_${P}`);let O=window.localStorage.getItem(E);window.localStorage.setItem(P,O),window.localStorage.removeItem(E),n(2,c=or())}}async function y(E){n(1,u=`Loading project ${E}`),await cr(E),n(1,u="")}const h=()=>ne(de,s={mode:"new-project"},s),v=E=>y(E),b=E=>g(E),L=E=>m(E);function I(E){ze[E?"unshift":"push"](()=>{_=E,n(3,_)})}return r.$$set=E=>{"wasmReady"in E&&n(0,a=E.wasmReady),"firstLoad"in E&&n(10,f=E.firstLoad)},[a,u,c,_,i,s,d,m,g,y,f,h,v,b,L,I]}class Th extends ae{constructor(e){super(),fe(this,e,Mh,Ch,oe,{wasmReady:0,firstLoad:10})}}function Ah(r){let e;return{c(){e=j("Choose project")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Fh(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Ph(r){let e;return{c(){e=j("Editing")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Eh(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Ce({props:{$$slots:{default:[Ah]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[Fh]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new Ce({props:{$$slots:{default:[Ph]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=S("div"),n=S("nav"),t=S("ul"),l=S("li"),T(o.$$.fragment),i=M(),s=S("li"),T(a.$$.fragment),f=M(),u=S("li"),T(c.$$.fragment),_=M(),d=S("li"),d.textContent="Viewing shortcuts",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){w(g,e,y),p(e,n),p(n,t),p(t,l),A(o,l,null),p(t,i),p(t,s),A(a,s,null),p(t,f),p(t,u),A(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&1024&&(h.$$scope={dirty:y,ctx:g}),o.$set(h);const v={};y&1024&&(v.$$scope={dirty:y,ctx:g}),a.$set(v);const b={};y&1024&&(b.$$scope={dirty:y,ctx:g}),c.$set(b)},i(g){m||($(o.$$.fragment,g),$(a.$$.fragment,g),$(c.$$.fragment,g),m=!0)},o(g){C(o.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),m=!1},d(g){g&&k(e),F(o),F(a),F(c)}}}function Ih(r){let e,n,t,l,o,i,s,a,f,u,c=tt(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,m,g,y,h;function v(L){r[5](L)}let b={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(b.idx=r[0].shortcutIndex),o=new Tr({props:b}),ze.push(()=>nt(o,"idx",v)),{c(){e=S("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=M(),t=S("button"),t.textContent="Pick a different road",l=M(),T(o.$$.fragment),s=M(),a=S("p"),f=j("This shortcut is "),u=S("b"),_=j(c),d=j("x"),m=j(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(L,I){w(L,e,I),w(L,n,I),w(L,t,I),w(L,l,I),A(o,L,I),w(L,s,I),w(L,a,I),p(a,f),p(a,u),p(u,_),p(u,d),p(a,m),g=!0,y||(h=X(t,"click",r[4]),y=!0)},p(L,I){const E={};I&1&&(E.list=L[0].gj.features),!i&&I&1&&(i=!0,E.idx=L[0].shortcutIndex,rt(()=>i=!1)),o.$set(E),(!g||I&1)&&c!==(c=tt(L[0].gj.features[L[0].shortcutIndex].properties).directness.toFixed(1)+"")&&le(_,c)},i(L){g||($(o.$$.fragment,L),g=!0)},o(L){C(o.$$.fragment,L),g=!1},d(L){L&&(k(e),k(n),k(t),k(l),k(s),k(a)),F(o,L),y=!1,h()}}}function Nh(r){let e;return{c(){e=S("p"),e.textContent="Click a road to see shortcuts"},m(n,t){w(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}function jh(r){let e,n,t,l,o,i;n=new mn({}),n.$on("click",r[3]);const s=[Nh,Ih],a=[];function f(u,c){return u[0].state=="neutral"?0:u[0].state=="chose-road"?1:-1}return~(l=f(r))&&(o=a[l]=s[l](r)),{c(){e=S("div"),T(n.$$.fragment),t=M(),o&&o.c(),N(e,"slot","sidebar")},m(u,c){w(u,e,c),A(n,e,null),p(e,t),~l&&a[l].m(e,null),i=!0},p(u,c){let _=l;l=f(u),l===_?~l&&a[l].p(u,c):(o&&(he(),C(a[_],1,1,()=>{a[_]=null}),be()),~l?(o=a[l],o?o.p(u,c):(o=a[l]=s[l](u),o.c()),$(o,1),o.m(e,null)):o=null)},i(u){i||($(n.$$.fragment,u),$(o),i=!0)},o(u){C(n.$$.fragment,u),C(o),i=!1},d(u){u&&k(e),F(n),~l&&a[l].d()}}}function zh(r){let e,n;return e=new xn({props:{interactive:!1}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Oh(r){let e,n;return e=new xn({props:{onClickLine:r[2],$$slots:{"line-popup":[Rh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Bh(r){let e,n=r[9].shortcuts+"",t,l,o=(r[9].name??"unnamed road")+"",i;return{c(){e=S("p"),t=j(n),l=j(" shortcuts through "),i=j(o)},m(s,a){w(s,e,a),p(e,t),p(e,l),p(e,i)},p(s,a){a&512&&n!==(n=s[9].shortcuts+"")&&le(t,n),a&512&&o!==(o=(s[9].name??"unnamed road")+"")&&le(i,o)},d(s){s&&k(e)}}}function Rh(r){let e,n,t;return n=new ut({props:{openOn:"hover",$$slots:{default:[Bh,({props:l})=>({9:l}),({props:l})=>l?512:0]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){w(l,e,o),A(n,e,null),t=!0},p(l,o){const i={};o&1536&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){C(n.$$.fragment,l),t=!1},d(l){l&&k(e),F(n)}}}function Dh(r){let e,n,t,l,o,i,s,a,f,u;e=new Fr({}),t=new Ar({}),o=new Pr({});const c=[Oh,zh],_=[];function d(m,g){return m[0].state=="neutral"?0:m[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),a&&a.c(),f=Ye()},m(m,g){A(e,m,g),w(m,n,g),A(t,m,g),w(m,l,g),A(o,m,g),w(m,i,g),~s&&_[s].m(m,g),w(m,f,g),u=!0},p(m,g){let y=s;s=d(m),s===y?~s&&_[s].p(m,g):(a&&(he(),C(_[y],1,1,()=>{_[y]=null}),be()),~s?(a=_[s],a?a.p(m,g):(a=_[s]=c[s](m),a.c()),$(a,1),a.m(f.parentNode,f)):a=null)},i(m){u||($(e.$$.fragment,m),$(t.$$.fragment,m),$(o.$$.fragment,m),$(a),u=!0)},o(m){C(e.$$.fragment,m),C(t.$$.fragment,m),C(o.$$.fragment,m),C(a),u=!1},d(m){m&&(k(n),k(l),k(i),k(f)),F(e,m),F(t,m),F(o,m),~s&&_[s].d(m)}}}function ji(r){let e,n,t,l,o,i,s,a;return e=new Ve({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[Uh]},$$scope:{ctx:r}}}),t=new Ve({props:{data:r[0].roadGj,$$slots:{default:[Hh]},$$scope:{ctx:r}}}),o=new vn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[Gh]},$$scope:{ctx:r}}}),s=new vn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[Wh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),T(s.$$.fragment)},m(f,u){A(e,f,u),w(f,n,u),A(t,f,u),w(f,l,u),A(o,f,u),w(f,i,u),A(s,f,u),a=!0},p(f,u){const c={};u&1&&(c.data=f[0].gj.features[f[0].shortcutIndex]),u&1024&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};u&1&&(_.data=f[0].roadGj),u&1024&&(_.$$scope={dirty:u,ctx:f}),t.$set(_);const d={};u&1&&(d.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[0]),u&1024&&(d.$$scope={dirty:u,ctx:f}),o.$set(d);const m={};u&1&&(m.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[f[0].gj.features[f[0].shortcutIndex].geometry.coordinates.length-1]),u&1024&&(m.$$scope={dirty:u,ctx:f}),s.$set(m)},i(f){a||($(e.$$.fragment,f),$(t.$$.fragment,f),$(o.$$.fragment,f),$(s.$$.fragment,f),a=!0)},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),C(o.$$.fragment,f),C(s.$$.fragment,f),a=!1},d(f){f&&(k(n),k(l),k(i)),F(e,f),F(t,f),F(o,f),F(s,f)}}}function Uh(r){let e,n;const t=[ye("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Hh(r){let e,n;const t=[ye("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new lt({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function Gh(r){let e;return{c(){e=j("A")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function Wh(r){let e;return{c(){e=j("B")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function qh(r){let e,n,t,l,o,i;n=new er({props:{$$slots:{default:[Dh]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&ji(r);return o=new pn({}),{c(){e=S("div"),T(n.$$.fragment),t=M(),s&&s.c(),l=M(),T(o.$$.fragment),N(e,"slot","map")},m(a,f){w(a,e,f),A(n,e,null),p(e,t),s&&s.m(e,null),p(e,l),A(o,e,null),i=!0},p(a,f){const u={};f&1025&&(u.$$scope={dirty:f,ctx:a}),n.$set(u),a[0].state=="chose-road"?s?(s.p(a,f),f&1&&$(s,1)):(s=ji(a),s.c(),$(s,1),s.m(e,l)):s&&(he(),C(s,1,1,()=>{s=null}),be())},i(a){i||($(n.$$.fragment,a),$(s),$(o.$$.fragment,a),i=!0)},o(a){C(n.$$.fragment,a),C(s),C(o.$$.fragment,a),i=!1},d(a){a&&k(e),F(n),s&&s.d(),F(o)}}}function Jh(r){let e,n;return e=new At({props:{$$slots:{map:[qh],sidebar:[jh],top:[Eh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,[l]){const o={};l&1027&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Zh(r,e,n){let t,l;V(r,de,_=>n(1,t=_)),V(r,xe,_=>n(8,l=_));let o={state:"neutral"};function i(_,d){let m=l.getShortcutsCrossingRoad(_.properties.id);if(m.features.length==0){window.alert("No shortcuts here");return}n(0,o={state:"chose-road",roadGj:_,gj:m,shortcutIndex:0})}function s(){ne(de,t={mode:"neighbourhood"},t)}const a=()=>n(0,o={state:"neutral"});function f(_){r.$$.not_equal(o.shortcutIndex,_)&&(o.shortcutIndex=_,n(0,o))}return[o,t,i,s,a,f,()=>ne(de,t={mode:"title",firstLoad:!1},t),()=>ne(de,t={mode:"pick-neighbourhood"},t)]}class Yh extends ae{constructor(e){super(),fe(this,e,Zh,Jh,oe,{})}}function Kh(r){let e,n,t,l,o,i,s,a,f;return l=new v1({}),{c(){e=S("div"),n=S("button"),n.innerHTML=`<img src="${ua}" style="height: 6vh;" alt="A/B Street logo"/>`,t=M(),T(l.$$.fragment),o=M(),i=S("span"),N(n,"class","outline"),ie(i,"width","100%"),N(e,"slot","top"),N(e,"class","pico"),ie(e,"display","flex")},m(u,c){w(u,e,c),p(e,n),p(e,t),A(l,e,null),p(e,o),p(e,i),r[20](i),s=!0,a||(f=X(n,"click",r[19]),a=!0)},p:Q,i(u){s||($(l.$$.fragment,u),s=!0)},o(u){C(l.$$.fragment,u),s=!1},d(u){u&&k(e),F(l),r[20](null),a=!1,f()}}}function zi(r){let e,n,t,l,o,i;return t=new Ru({props:{map:tt(r[6]),maptilerBasemap:r[7]}}),{c(){e=S("button"),e.textContent="Zoom to fit study area",n=M(),T(t.$$.fragment),N(e,"class","secondary")},m(s,a){w(s,e,a),w(s,n,a),A(t,s,a),l=!0,o||(i=X(e,"click",r[11]),o=!0)},p(s,a){const f={};a&64&&(f.map=tt(s[6])),a&128&&(f.maptilerBasemap=s[7]),t.$set(f)},i(s){l||($(t.$$.fragment,s),l=!0)},o(s){C(t.$$.fragment,s),l=!1},d(s){s&&(k(e),k(n)),F(t,s),o=!1,i()}}}function Xh(r){let e,n,t,l,o,i,s=r[5]&&zi(r);return{c(){e=S("div"),n=S("div"),t=M(),l=S("hr"),o=M(),s&&s.c(),N(e,"class","pico"),N(e,"slot","left")},m(a,f){w(a,e,f),p(e,n),r[18](n),p(e,t),p(e,l),p(e,o),s&&s.m(e,null),i=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&$(s,1)):(s=zi(a),s.c(),$(s,1),s.m(e,null)):s&&(he(),C(s,1,1,()=>{s=null}),be())},i(a){i||($(s),i=!0)},o(a){C(s),i=!1},d(a){a&&k(e),r[18](null),s&&s.d()}}}function Oi(r){let e,n;return e=new $d({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Vh(r){let e,n;return e=new $h({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Qh(r){let e,n;return e=new Th({props:{wasmReady:r[4],firstLoad:r[9].firstLoad}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&16&&(o.wasmReady=t[4]),l&512&&(o.firstLoad=t[9].firstLoad),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Bi(r){let e,n,t,l,o,i;e=new Ve({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[xh]},$$scope:{ctx:r}}});const s=[c0,u0,f0,a0,s0,i0,o0,l0,r0,n0,t0,e0],a=[];function f(u,c){return u[9].mode=="pick-neighbourhood"?0:u[9].mode=="set-boundary"?1:u[9].mode=="auto-boundaries"?2:u[9].mode=="neighbourhood"?3:u[9].mode=="view-shortcuts"?4:u[9].mode=="impact-one-destination"?5:u[9].mode=="route"?6:u[9].mode=="predict-impact"?7:u[9].mode=="impact-detail"?8:u[9].mode=="debug-neighbourhood"?9:u[9].mode=="debug-intersections"?10:u[9].mode=="debug-demand"?11:-1}return~(t=f(r))&&(l=a[t]=s[t](r)),{c(){T(e.$$.fragment),n=M(),l&&l.c(),o=Ye()},m(u,c){A(e,u,c),w(u,n,c),~t&&a[t].m(u,c),w(u,o,c),i=!0},p(u,c){const _={};c&32&&(_.data=u[5].getInvertedBoundary()),c&4194304&&(_.$$scope={dirty:c,ctx:u}),e.$set(_);let d=t;t=f(u),t===d?~t&&a[t].p(u,c):(l&&(he(),C(a[d],1,1,()=>{a[d]=null}),be()),~t?(l=a[t],l?l.p(u,c):(l=a[t]=s[t](u),l.c()),$(l,1),l.m(o.parentNode,o)):l=null)},i(u){i||($(e.$$.fragment,u),$(l),i=!0)},o(u){C(e.$$.fragment,u),C(l),i=!1},d(u){u&&(k(n),k(o)),F(e,u),~t&&a[t].d(u)}}}function xh(r){let e,n;const t=[ye("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let o=0;o<t.length;o+=1)l=me(l,t[o]);return e=new $t({props:l}),{c(){T(e.$$.fragment)},m(o,i){A(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){F(e,o)}}}function e0(r){let e,n;return e=new b_({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function t0(r){let e,n;return e=new T_({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function n0(r){let e,n;return e=new cm({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function r0(r){let e,n;return e=new Pp({props:{road:r[9].road}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.road=t[9].road),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function l0(r){let e,n;return e=new Tg({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function o0(r){let e,n;return e=new Ug({props:{prevMode:r[9].prevMode}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.prevMode=t[9].prevMode),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function i0(r){let e,n;return e=new Jp({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function s0(r){let e,n;return e=new Yh({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function a0(r){let e,n;return e=new $p({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function f0(r){let e,n;return e=new s_({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function u0(r){let e,n;return e=new p1({props:{name:r[9].name,existing:r[9].existing}}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.name=t[9].name),l&512&&(o.existing=t[9].existing),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function c0(r){let e,n;return e=new hg({}),{c(){T(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:Q,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function d0(r){let e,n,t,l,o,i,s=r[8].startsWith("ltn_cnt/"),a,f,u,c,_,d,m,g,y;e=new sa({}),t=new aa({}),o=new wc({props:{map:r[0],apiKey:Kr,country:void 0}});let h=s&&Oi();const v=[Qh,Vh],b=[];function L(E,P){return E[9].mode=="title"?0:E[9].mode=="new-project"?1:-1}~(c=L(r))&&(_=b[c]=v[c](r));let I=r[5]&&Bi(r);return g=new xf({}),{c(){T(e.$$.fragment),n=M(),T(t.$$.fragment),l=M(),T(o.$$.fragment),i=M(),h&&h.c(),a=M(),f=S("div"),u=M(),_&&_.c(),d=M(),I&&I.c(),m=M(),T(g.$$.fragment)},m(E,P){A(e,E,P),w(E,n,P),A(t,E,P),w(E,l,P),A(o,E,P),w(E,i,P),h&&h.m(E,P),w(E,a,P),w(E,f,P),r[15](f),w(E,u,P),~c&&b[c].m(E,P),w(E,d,P),I&&I.m(E,P),w(E,m,P),A(g,E,P),y=!0},p(E,P){const O={};P&1&&(O.map=E[0]),o.$set(O),P&256&&(s=E[8].startsWith("ltn_cnt/")),s?h?P&256&&$(h,1):(h=Oi(),h.c(),$(h,1),h.m(a.parentNode,a)):h&&(he(),C(h,1,1,()=>{h=null}),be());let B=c;c=L(E),c===B?~c&&b[c].p(E,P):(_&&(he(),C(b[B],1,1,()=>{b[B]=null}),be()),~c?(_=b[c],_?_.p(E,P):(_=b[c]=v[c](E),_.c()),$(_,1),_.m(d.parentNode,d)):_=null),E[5]?I?(I.p(E,P),P&32&&$(I,1)):(I=Bi(E),I.c(),$(I,1),I.m(m.parentNode,m)):I&&(he(),C(I,1,1,()=>{I=null}),be())},i(E){y||($(e.$$.fragment,E),$(t.$$.fragment,E),$(o.$$.fragment,E),$(h),$(_),$(I),$(g.$$.fragment,E),y=!0)},o(E){C(e.$$.fragment,E),C(t.$$.fragment,E),C(o.$$.fragment,E),C(h),C(_),C(I),C(g.$$.fragment,E),y=!1},d(E){E&&(k(n),k(l),k(i),k(a),k(f),k(u),k(d),k(m)),F(e,E),F(t,E),F(o,E),h&&h.d(E),r[15](null),~c&&b[c].d(E),I&&I.d(E),F(g,E)}}}function _0(r){let e,n,t,l;function o(s){r[16](s)}let i={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${Kr}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"oneway_arrow",url:fa},{id:"national_rail",url:Wi}],$$slots:{default:[d0]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.map=r[0]),n=new ia({props:i}),ze.push(()=>nt(n,"map",o)),n.$on("error",r[17]),{c(){e=S("div"),T(n.$$.fragment),N(e,"slot","main"),ie(e,"position","relative"),ie(e,"width","100%"),ie(e,"height","100%")},m(s,a){w(s,e,a),A(n,e,null),l=!0},p(s,a){const f={};a&128&&(f.style=`https://api.maptiler.com/maps/${s[7]}/style.json?key=${Kr}`),a&4195129&&(f.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,f.map=s[0],rt(()=>t=!1)),n.$set(f)},i(s){l||($(n.$$.fragment,s),l=!0)},o(s){C(n.$$.fragment,s),l=!1},d(s){s&&k(e),F(n)}}}function m0(r){let e,n,t,l,o;return n=new Lf({}),l=new Nd({props:{$$slots:{main:[_0],left:[Xh],top:[Kh]},$$scope:{ctx:r}}}),{c(){e=S("div"),T(n.$$.fragment),t=M(),T(l.$$.fragment),N(e,"class","pico")},m(i,s){w(i,e,s),A(n,e,null),w(i,t,s),A(l,i,s),o=!0},p(i,[s]){const a={};s&4196351&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||($(n.$$.fragment,i),$(l.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),C(l.$$.fragment,i),o=!1},d(i){i&&(k(e),k(t)),F(n),F(l,i)}}}function p0(r,e,n){let t,l,o,i,s,a,f,u,c,_;V(r,nl,B=>n(12,t=B)),V(r,tl,B=>n(13,l=B)),V(r,el,B=>n(14,o=B)),V(r,xe,B=>n(5,i=B)),V(r,Qt,B=>n(6,s=B)),V(r,Cl,B=>n(21,a=B)),V(r,qr,B=>n(7,f=B)),V(r,Zt,B=>n(8,u=B)),V(r,de,B=>n(9,c=B)),V(r,dr,B=>n(10,_=B));let d=!1;yr(async()=>{await ps(),await Zi(),n(4,d=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(ne(Cl,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let m=null;function g(){s.fitBounds(i.getBounds(),{animate:!1})}let y,h,v;function b(B){ze[B?"unshift":"push"](()=>{v=B,n(3,v),n(12,t)})}function L(B){m=B,n(0,m)}const I=B=>{console.log(B.detail.error)};function E(B){ze[B?"unshift":"push"](()=>{h=B,n(2,h),n(13,l)})}const P=()=>ne(dr,_=!0,_);function O(B){ze[B?"unshift":"push"](()=>{y=B,n(1,y),n(14,o)})}return r.$$.update=()=>{r.$$.dirty&1&&m&&Qt.set(m),r.$$.dirty&16386&&y&&o&&(n(1,y.innerHTML="",y),y.appendChild(o)),r.$$.dirty&8196&&h&&l&&(n(2,h.innerHTML="",h),h.appendChild(l)),r.$$.dirty&4104&&v&&t&&(n(3,v.innerHTML="",v),v.appendChild(t))},[m,y,h,v,d,i,s,f,u,c,_,g,t,l,o,b,L,I,E,P,O]}class g0 extends ae{constructor(e){super(),fe(this,e,p0,m0,oe,{})}}new g0({target:document.getElementById("app")});
