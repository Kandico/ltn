var ea=Object.defineProperty;var ta=(r,e,n)=>e in r?ea(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var pt=(r,e,n)=>(ta(r,typeof e!="symbol"?e+"":e,n),n);import{S as ie,i as se,s as le,e as Ye,a as $,n as Q,d as y,b as k,t as j,c as M,f as N,g as p,h as ne,j as oe,k as De,l as K,u as Ue,m as He,o as Ge,p as b,q as S,r as nt,v as ze,w as Be,x as Me,y as ft,z as na,A as ml,B as ra,C as he,D as be,E as X,F as hr,G as F,H as P,I,J as te,L as Ki,K as st,M as at,N as pl,O as gt,P as gl,Q as Tt,R as la,T as pn,U as Ml,V as Dr,W as Xi,X as Kr,Y as oa,Z as Vt,_ as ia,$ as Cr,a0 as sa,a1 as aa,a2 as fa,a3 as ua,a4 as br,a5 as ca,a6 as Oe,a7 as un,a8 as vt,a9 as Xr,aa as cn,ab as Mt,ac as Ke,ad as kt,ae as _e,af as Jt,ag as $r,ah as Tl,ai as Qt,aj as xt,ak as Vi,al as Qi,am as Wt,an as wt,ao as et,ap as Ve,aq as Al,ar as da,as as _a,at as ma,au as pa,av as dt,aw as ut,ax as yn,ay as Le,az as Zt,aA as ce,aB as Jn,aC as xe,aD as Tn,aE as yr,aF as Vr,aG as hl,aH as Nt,aI as xi,aJ as Qr,aK as Fl,aL as cr,aM as Yn,aN as Zn,aO as xr,aP as Pl,aQ as ga,aR as el,aS as ha,aT as Il,aU as ba,aV as $a}from"./pico.conditional.jade.min-4f0550d9.js";function Ne(r,e){const n={},t={},l={$$scope:1};let o=r.length;for(;o--;){const i=r[o],s=e[o];if(s){for(const a in i)a in s||(t[a]=1);for(const a in s)l[a]||(n[a]=s[a],l[a]=1);r[o]=s}else for(const a in i)l[a]=1}for(const i in t)i in n||(n[i]=void 0);return n}function Lr(r){return typeof r=="object"&&r!==null?r:{}}const ya="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",va="/ltn/assets/logo-97f2d067.svg",es="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function El(r){let e,n,t,l=r[1]!=null&&Nl(r);return{c(){e=k("div"),n=j(r[0]),t=M(),l&&l.c(),N(e,"class","cover svelte-1w7hi45")},m(o,i){$(o,e,i),p(e,n),p(e,t),l&&l.m(e,null)},p(o,i){i&1&&ne(n,o[0]),o[1]!=null?l?l.p(o,i):(l=Nl(o),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(o){o&&y(e),l&&l.d()}}}function Nl(r){let e,n;return{c(){e=k("div"),n=k("progress"),n.value=r[1],oe(n,"width","100%")},m(t,l){$(t,e,l),p(e,n)},p(t,l){l&2&&(n.value=t[1])},d(t){t&&y(e)}}}function wa(r){let e,n=r[0]&&El(r);return{c(){n&&n.c(),e=Ye()},m(t,l){n&&n.m(t,l),$(t,e,l)},p(t,[l]){t[0]?n?n.p(t,l):(n=El(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Q,o:Q,d(t){t&&y(e),n&&n.d(t)}}}function ka(r,e,n){let{loading:t}=e,{progress:l=null}=e;return r.$$set=o=>{"loading"in o&&n(0,t=o.loading),"progress"in o&&n(1,l=o.progress)},[t,l]}class ts extends ie{constructor(e){super(),se(this,e,ka,wa,le,{loading:0,progress:1})}}const Sa=r=>({dialog:r&1}),jl=r=>({dialog:r[0]});function Ca(r){let e,n,t,l,o;const i=r[4].default,s=De(i,r,r[3],jl);return{c(){e=k("dialog"),n=k("article"),s&&s.c(),e.open=!0},m(a,f){$(a,e,f),p(e,n),s&&s.m(n,null),r[6](e),t=!0,l||(o=[K(window,"click",r[1]),K(window,"keydown",r[2]),K(e,"close",r[5])],l=!0)},p(a,[f]){s&&s.p&&(!t||f&9)&&Ue(s,i,a,a[3],t?Ge(i,a[3],f,Sa):He(a[3]),jl)},i(a){t||(b(s,a),t=!0)},o(a){S(s,a),t=!1},d(a){a&&y(e),s&&s.d(a),r[6](null),l=!1,nt(o)}}}function La(r,e,n){let{$$slots:t={},$$scope:l}=e,o;function i(u){o.open&&u.target==o&&o.close()}function s(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),o.close())}function a(u){ze.call(this,r,u)}function f(u){Be[u?"unshift":"push"](()=>{o=u,n(0,o)})}return r.$$set=u=>{"$$scope"in u&&n(3,l=u.$$scope)},[o,i,s,l,t,a,f]}class Mr extends ie{constructor(e){super(),se(this,e,La,Ca,le,{})}}function zl(r,e,n){const t=r.slice();return t[1]=e[n][0],t[2]=e[n][1],t}function Ol(r){let e,n,t=r[1]+"",l,o,i,s=r[2]+"",a,f;return{c(){e=k("tr"),n=k("td"),l=j(t),o=M(),i=k("td"),a=j(s),f=M()},m(u,c){$(u,e,c),p(e,n),p(n,l),p(e,o),p(e,i),p(i,a),p(e,f)},p(u,c){c&1&&t!==(t=u[1]+"")&&ne(l,t),c&1&&s!==(s=u[2]+"")&&ne(a,s)},d(u){u&&y(e)}}}function Ma(r){let e,n,t=Me(Object.entries(r[0])),l=[];for(let o=0;o<t.length;o+=1)l[o]=Ol(zl(r,t,o));return{c(){e=k("table"),n=k("tbody");for(let o=0;o<l.length;o+=1)l[o].c();N(e,"class","svelte-lh2o9l")},m(o,i){$(o,e,i),p(e,n);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(n,null)},p(o,[i]){if(i&1){t=Me(Object.entries(o[0]));let s;for(s=0;s<t.length;s+=1){const a=zl(o,t,s);l[s]?l[s].p(a,i):(l[s]=Ol(a),l[s].c(),l[s].m(n,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}},i:Q,o:Q,d(o){o&&y(e),ft(l,o)}}}function Ta(r,e,n){let{properties:t}=e;return r.$$set=l=>{"properties"in l&&n(0,t=l.properties)},[t]}class xn extends ie{constructor(e){super(),se(this,e,Ta,Ma,le,{properties:0})}}function Bl(r,e,n){const t=r.slice();return t[2]=e[n][0],t[6]=e[n][1],t}function Rl(r,e,n){const t=r.slice();return t[2]=e[n][0],t[3]=e[n][1],t}function Dl(r,e,n){const t=r.slice();return t[3]=e[n][0],t[6]=e[n][1],t}function Aa(r){let e,n=Me(Object.entries(r[0])),t=[];for(let l=0;l<n.length;l+=1)t[l]=Ul(Bl(r,n,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=Ye()},m(l,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(l,o);$(l,e,o)},p(l,o){if(o&1){n=Me(Object.entries(l[0]));let i;for(i=0;i<n.length;i+=1){const s=Bl(l,n,i);t[i]?t[i].p(s,o):(t[i]=Ul(s),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(l){l&&y(e),ft(t,l)}}}function Fa(r){let e,n,t,l=Me(Object.entries(r[0])),o=[];for(let a=0;a<l.length;a+=1)o[a]=Hl(Dl(r,l,a));let i=Me(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=Gl(Rl(r,i,a));return{c(){e=k("div");for(let a=0;a<o.length;a+=1)o[a].c();n=M(),t=k("div");for(let a=0;a<s.length;a+=1)s[a].c();oe(e,"display","flex"),oe(t,"display","flex"),oe(t,"justify-content","space-between")},m(a,f){$(a,e,f);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);$(a,n,f),$(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,f){if(f&1){l=Me(Object.entries(a[0]));let u;for(u=0;u<l.length;u+=1){const c=Dl(a,l,u);o[u]?o[u].p(c,f):(o[u]=Hl(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=l.length}if(f&1){i=Me(Object.entries(a[0]));let u;for(u=0;u<i.length;u+=1){const c=Rl(a,i,u);s[u]?s[u].p(c,f):(s[u]=Gl(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},d(a){a&&(y(e),y(n),y(t)),ft(o,a),ft(s,a)}}}function Ul(r){let e,n,t,l=r[2]+"",o,i;return{c(){e=k("div"),n=k("span"),t=M(),o=j(l),i=M(),N(n,"class","vertical-block svelte-rl95zk"),oe(n,"background",r[6])},m(s,a){$(s,e,a),p(e,n),p(e,t),p(e,o),p(e,i)},p(s,a){a&1&&oe(n,"background",s[6]),a&1&&l!==(l=s[2]+"")&&ne(o,l)},d(s){s&&y(e)}}}function Hl(r){let e,n;return{c(){e=k("span"),n=j(` 
      `),oe(e,"background",r[6]),oe(e,"width","100%"),oe(e,"border","1px solid black")},m(t,l){$(t,e,l),p(e,n)},p(t,l){l&1&&oe(e,"background",t[6])},d(t){t&&y(e)}}}function Gl(r){let e,n=r[2]+"",t;return{c(){e=k("span"),t=j(n)},m(l,o){$(l,e,o),p(e,t)},p(l,o){o&1&&n!==(n=l[2]+"")&&ne(t,n)},d(l){l&&y(e)}}}function Pa(r){let e;function n(o,i){return o[1]?Fa:Aa}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),$(o,e,i)},p(o,[i]){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},i:Q,o:Q,d(o){o&&y(e),l.d(o)}}}function Ia(r,e,n){let{colors:t}=e,{horiz:l=!1}=e;return r.$$set=o=>{"colors"in o&&n(0,t=o.colors),"horiz"in o&&n(1,l=o.horiz)},[t,l]}class Tr extends ie{constructor(e){super(),se(this,e,Ia,Pa,le,{colors:0,horiz:1})}}function Wl(r,e,n){const t=r.slice();return t[3]=e[n],t}function ql(r,e,n){const t=r.slice();return t[6]=e[n],t}function Jl(r){let e,n;return{c(){e=k("span"),n=j(` 
    `),oe(e,"background",r[6]),oe(e,"width","100%"),oe(e,"border","1px solid black")},m(t,l){$(t,e,l),p(e,n)},p(t,l){l&1&&oe(e,"background",t[6])},d(t){t&&y(e)}}}function Ea(r){let e,n=r[3]+"",t;return{c(){e=k("span"),t=j(n)},m(l,o){$(l,e,o),p(e,t)},p(l,o){o&2&&n!==(n=l[3]+"")&&ne(t,n)},d(l){l&&y(e)}}}function Na(r){let e,n=r[3].toFixed(r[2])+"",t;return{c(){e=k("span"),t=j(n)},m(l,o){$(l,e,o),p(e,t)},p(l,o){o&6&&n!==(n=l[3].toFixed(l[2])+"")&&ne(t,n)},d(l){l&&y(e)}}}function Yl(r){let e;function n(o,i){return o[2]>0?Na:Ea}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),$(o,e,i)},p(o,i){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},d(o){o&&y(e),l.d(o)}}}function ja(r){let e,n,t,l=Me(r[0]),o=[];for(let a=0;a<l.length;a+=1)o[a]=Jl(ql(r,l,a));let i=Me(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Yl(Wl(r,i,a));return{c(){e=k("div");for(let a=0;a<o.length;a+=1)o[a].c();n=M(),t=k("div");for(let a=0;a<s.length;a+=1)s[a].c();oe(e,"display","flex"),oe(t,"display","flex"),oe(t,"justify-content","space-between")},m(a,f){$(a,e,f);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);$(a,n,f),$(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,[f]){if(f&1){l=Me(a[0]);let u;for(u=0;u<l.length;u+=1){const c=ql(a,l,u);o[u]?o[u].p(c,f):(o[u]=Jl(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=l.length}if(f&6){i=Me(a[1]);let u;for(u=0;u<i.length;u+=1){const c=Wl(a,i,u);s[u]?s[u].p(c,f):(s[u]=Yl(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},i:Q,o:Q,d(a){a&&(y(e),y(n),y(t)),ft(o,a),ft(s,a)}}}function za(r,e,n){let{colorScale:t}=e,{limits:l}=e,{decimalPlaces:o=0}=e;return r.$$set=i=>{"colorScale"in i&&n(0,t=i.colorScale),"limits"in i&&n(1,l=i.limits),"decimalPlaces"in i&&n(2,o=i.decimalPlaces)},[t,l,o]}class kn extends ie{constructor(e){super(),se(this,e,za,ja,le,{colorScale:0,limits:1,decimalPlaces:2})}}function vr(r,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ct(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let de;const ns=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ns.decode();let zn=null;function Gn(){return(zn===null||zn.byteLength===0)&&(zn=new Uint8Array(de.memory.buffer)),zn}function Bt(r,e){return r=r>>>0,ns.decode(Gn().subarray(r,r+e))}const nn=new Array(128).fill(void 0);nn.push(void 0,null,!0,!1);let Wn=nn.length;function it(r){Wn===nn.length&&nn.push(nn.length+1);const e=Wn;return Wn=nn[e],nn[e]=r,e}function Ae(r){return nn[r]}function Oa(r){r<132||(nn[r]=Wn,Wn=r)}function Cn(r){const e=Ae(r);return Oa(r),e}function Ur(r){return r==null}let On=null;function Ba(){return(On===null||On.byteLength===0)&&(On=new Float64Array(de.memory.buffer)),On}let Bn=null;function Ee(){return(Bn===null||Bn.byteLength===0)&&(Bn=new Int32Array(de.memory.buffer)),Bn}let dn=0;const dr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ra=typeof dr.encodeInto=="function"?function(r,e){return dr.encodeInto(r,e)}:function(r,e){const n=dr.encode(r);return e.set(n),{read:r.length,written:n.length}};function ar(r,e,n){if(n===void 0){const s=dr.encode(r),a=e(s.length,1)>>>0;return Gn().subarray(a,a+s.length).set(s),dn=s.length,a}let t=r.length,l=e(t,1)>>>0;const o=Gn();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;o[l+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),l=n(l,t,t=i+r.length*3,1)>>>0;const s=Gn().subarray(l+i,l+t),a=Ra(r,s);i+=a.written}return dn=i,l}function tl(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let o="[";l>0&&(o+=tl(r[0]));for(let i=1;i<l;i++)o+=", "+tl(r[i]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function Da(r,e){const n=e(r.length*1,1)>>>0;return Gn().set(r,n/1),dn=r.length,n}function Hr(r,e){try{return r.apply(this,e)}catch(n){de.__wbindgen_exn_store(it(n))}}class wr{static __wrap(e){e=e>>>0;const n=Object.create(wr.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();de.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=de.__wbindgen_add_to_stack_pointer(-16),i=Da(e,de.__wbindgen_malloc),s=dn;de.jsroutesnapper_new(o,i,s);var n=Ee()[o/4+0],t=Ee()[o/4+1],l=Ee()[o/4+2];if(l)throw Cn(t);return wr.__wrap(n)}finally{de.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){de.jsroutesnapper_setRouteConfig(this.__wbg_ptr,it(e))}setAreaMode(){de.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getConfig(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const t=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=Ee()[t/4+0],n=Ee()[t/4+1];let l;return e!==0&&(l=Bt(e,n).slice(),de.__wbindgen_free(e,n*1)),l}finally{de.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}toggleSnapMode(){de.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,t){return de.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,t)!==0}onClick(){de.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return de.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return de.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){de.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_editExisting(l,this.__wbg_ptr,it(e));var n=Ee()[l/4+0],t=Ee()[l/4+1];if(t)throw Cn(n)}finally{de.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,t;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,it(e));var l=Ee()[u/4+0],o=Ee()[u/4+1],i=Ee()[u/4+2],s=Ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Cn(i);return n=a,t=f,Bt(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(n,t,1)}}addSnappedWaypoint(e,n){de.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){de.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,t;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,it(e));var l=Ee()[u/4+0],o=Ee()[u/4+1],i=Ee()[u/4+2],s=Ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Cn(i);return n=a,t=f,Bt(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(n,t,1)}}getExtraNodes(e,n){let t,l;try{const c=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,it(e),it(n));var o=Ee()[c/4+0],i=Ee()[c/4+1],s=Ee()[c/4+2],a=Ee()[c/4+3],f=o,u=i;if(a)throw f=0,u=0,Cn(s);return t=f,l=u,Bt(f,u)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(t,l,1)}}}async function Ua(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Ha(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,n){const t=Bt(e,n);return it(t)},r.wbg.__wbindgen_object_drop_ref=function(e){Cn(e)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(Bt(e,n));return it(t)},r.wbg.__wbindgen_number_get=function(e,n){const t=Ae(n),l=typeof t=="number"?t:void 0;Ba()[e/8+1]=Ur(l)?0:l,Ee()[e/4+0]=!Ur(l)},r.wbg.__wbindgen_is_object=function(e){const n=Ae(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return Ae(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return Ae(e)in Ae(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=Ae(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Ae(e)==Ae(n)},r.wbg.__wbindgen_string_get=function(e,n){const t=Ae(n),l=typeof t=="string"?t:void 0;var o=Ur(l)?0:ar(l,de.__wbindgen_malloc,de.__wbindgen_realloc),i=dn;Ee()[e/4+1]=i,Ee()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,n){const t=String(Ae(n)),l=ar(t,de.__wbindgen_malloc,de.__wbindgen_realloc),o=dn;Ee()[e/4+1]=o,Ee()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Ae(e);return it(n)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const t=Ae(e)[Ae(n)];return it(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return it(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Ae(n).stack,l=ar(t,de.__wbindgen_malloc,de.__wbindgen_realloc),o=dn;Ee()[e/4+1]=o,Ee()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,l;try{t=e,l=n,console.error(Bt(e,n))}finally{de.__wbindgen_free(t,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ae(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ae(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ae(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ae(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ae(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,n){const t=Ae(e)[n>>>0];return it(t)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ae(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ae(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const n=Ae(e).next;return it(n)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Hr(function(e){const n=Ae(e).next();return it(n)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ae(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const n=Ae(e).value;return it(n)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return it(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Hr(function(e,n){const t=Reflect.get(Ae(e),Ae(n));return it(t)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Hr(function(e,n){const t=Ae(e).call(Ae(n));return it(t)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ae(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Ae(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Ae(e).buffer;return it(n)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Ae(e));return it(n)},r.wbg.__wbg_set_5cf90238115182c3=function(e,n,t){Ae(e).set(Ae(n),t>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ae(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Ae(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const t=tl(Ae(n)),l=ar(t,de.__wbindgen_malloc,de.__wbindgen_realloc),o=dn;Ee()[e/4+1]=o,Ee()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,n){throw new Error(Bt(e,n))},r.wbg.__wbindgen_memory=function(){const e=de.memory;return it(e)},r}function Ga(r,e){return de=r.exports,rs.__wbindgen_wasm_module=e,On=null,Bn=null,zn=null,de}async function rs(r){if(de!==void 0)return de;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Ha();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Ua(await r,e);return Ga(n,t)}var yt=63710088e-1,bl={centimeters:yt*100,centimetres:yt*100,degrees:yt/111325,feet:yt*3.28084,inches:yt*39.37,kilometers:yt/1e3,kilometres:yt/1e3,meters:yt,metres:yt,miles:yt/1609.344,millimeters:yt*1e3,millimetres:yt*1e3,nauticalmiles:yt/1852,radians:1,yards:yt*1.0936},Wa={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/yt,yards:1.0936133},nl={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ut(r,e,n){n===void 0&&(n={});var t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function qa(r,e,n){switch(r){case"Point":return Lt(e).geometry;case"LineString":return Rt(e).geometry;case"Polygon":return $l(e).geometry;case"MultiPoint":return os(e).geometry;case"MultiLineString":return ls(e).geometry;case"MultiPolygon":return is(e).geometry;default:throw new Error(r+" is invalid")}}function Lt(r,e,n){if(n===void 0&&(n={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!kr(r[0])||!kr(r[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:r};return Ut(t,e,n)}function Ja(r,e,n){return n===void 0&&(n={}),vn(r.map(function(t){return Lt(t,e)}),n)}function $l(r,e,n){n===void 0&&(n={});for(var t=0,l=r;t<l.length;t++){var o=l[t];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return Ut(s,e,n)}function Ya(r,e,n){return n===void 0&&(n={}),vn(r.map(function(t){return $l(t,e)}),n)}function Rt(r,e,n){if(n===void 0&&(n={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:r};return Ut(t,e,n)}function Za(r,e,n){return n===void 0&&(n={}),vn(r.map(function(t){return Rt(t,e)}),n)}function vn(r,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function ls(r,e,n){n===void 0&&(n={});var t={type:"MultiLineString",coordinates:r};return Ut(t,e,n)}function os(r,e,n){n===void 0&&(n={});var t={type:"MultiPoint",coordinates:r};return Ut(t,e,n)}function is(r,e,n){n===void 0&&(n={});var t={type:"MultiPolygon",coordinates:r};return Ut(t,e,n)}function Ka(r,e,n){n===void 0&&(n={});var t={type:"GeometryCollection",geometries:r};return Ut(t,e,n)}function Xa(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(r*n)/n}function yl(r,e){e===void 0&&(e="kilometers");var n=bl[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Ar(r,e){e===void 0&&(e="kilometers");var n=bl[e];if(!n)throw new Error(e+" units is invalid");return r/n}function Va(r,e){return Kn(Ar(r,e))}function Qa(r){var e=r%360;return e<0&&(e+=360),e}function Kn(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Dt(r){var e=r%360;return e*Math.PI/180}function xa(r,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("length must be a positive number");return yl(Ar(r,e),n)}function ef(r,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("area must be a positive number");var t=nl[e];if(!t)throw new Error("invalid original units");var l=nl[n];if(!l)throw new Error("invalid final units");return r/t*l}function kr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function vl(r){return!!r&&r.constructor===Object}function tf(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!kr(e))throw new Error("bbox must only contain numbers")})}function nf(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const rf=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:nl,bearingToAzimuth:Qa,convertArea:ef,convertLength:xa,degreesToRadians:Dt,earthRadius:yt,factors:bl,feature:Ut,featureCollection:vn,geometry:qa,geometryCollection:Ka,isNumber:kr,isObject:vl,lengthToDegrees:Va,lengthToRadians:Ar,lineString:Rt,lineStrings:Za,multiLineString:ls,multiPoint:os,multiPolygon:is,point:Lt,points:Ja,polygon:$l,polygons:Ya,radiansToDegrees:Kn,radiansToLength:yl,round:Xa,unitsFactors:Wa,validateBBox:tf,validateId:nf},Symbol.toStringTag,{value:"Module"}));function Xn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function An(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function En(r,e,n){n===void 0&&(n={});var t=Xn(r),l=Xn(e),o=Dt(l[1]-t[1]),i=Dt(l[0]-t[0]),s=Dt(t[1]),a=Dt(l[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return yl(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function er(r,e,n){if(r!==null)for(var t,l,o,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",v=m?r.features.length:1,h=0;h<v;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var w=0;w<s;w++){var C=0,L=0;if(i=_?f.geometries[w]:f,i!==null){a=i.coordinates;var E=i.type;switch(u=n&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":if(e(a,c,h,C,L)===!1)return!1;c++,C++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,C,L)===!1)return!1;c++,E==="MultiPoint"&&C++}E==="LineString"&&C++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(l=0;l<a[t].length-u;l++){if(e(a[t][l],c,h,C,L)===!1)return!1;c++}E==="MultiLineString"&&C++,E==="Polygon"&&L++}E==="Polygon"&&C++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(L=0,l=0;l<a[t].length;l++){for(o=0;o<a[t][l].length-u;o++){if(e(a[t][l][o],c,h,C,L)===!1)return!1;c++}L++}C++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(er(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function lf(r,e,n,t){var l=n;return er(r,function(o,i,s,a,f){i===0&&n===void 0?l=o:l=e(l,o,i,s,a,f)},t),l}function ss(r,e){var n;switch(r.type){case"FeatureCollection":for(n=0;n<r.features.length&&e(r.features[n].properties,n)!==!1;n++);break;case"Feature":e(r.properties,0);break}}function of(r,e,n){var t=n;return ss(r,function(l,o){o===0&&n===void 0?t=l:t=e(t,l,o)}),t}function Sr(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var n=0;n<r.features.length&&e(r.features[n],n)!==!1;n++);}function sf(r,e,n){var t=n;return Sr(r,function(l,o){o===0&&n===void 0?t=l:t=e(t,l,o)}),t}function af(r){var e=[];return er(r,function(n){e.push(n)}),e}function wl(r,e){var n,t,l,o,i,s,a,f,u,c,_=0,d=r.type==="FeatureCollection",m=r.type==="Feature",g=d?r.features.length:1;for(n=0;n<g;n++){for(s=d?r.features[n].geometry:m?r.geometry:r,f=d?r.features[n].properties:m?r.properties:{},u=d?r.features[n].bbox:m?r.bbox:void 0,c=d?r.features[n].id:m?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,l=0;l<i;l++){if(o=a?s.geometries[l]:s,o===null){if(e(null,_,f,u,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,_,f,u,c)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<o.geometries.length;t++)if(e(o.geometries[t],_,f,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function ff(r,e,n){var t=n;return wl(r,function(l,o,i,s,a){o===0&&n===void 0?t=l:t=e(t,l,o,i,s,a)}),t}function Pn(r,e){wl(r,function(n,t,l,o,i){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Ut(n,l,{bbox:o,id:i}),t,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var f=0;f<n.coordinates.length;f++){var u=n.coordinates[f],c={type:a,coordinates:u};if(e(Ut(c,l),t,f)===!1)return!1}})}function uf(r,e,n){var t=n;return Pn(r,function(l,o,i){o===0&&i===0&&n===void 0?t=l:t=e(t,l,o,i)}),t}function as(r,e){Pn(r,function(n,t,l){var o=0;if(n.geometry){var i=n.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,f=0,u=0;if(er(n,function(c,_,d,m,g){if(s===void 0||t>a||m>f||g>u){s=c,a=t,f=m,u=g,o=0;return}var v=Rt([s,c],n.properties);if(e(v,t,l,g,o)===!1)return!1;o++,s=c})===!1)return!1}}})}function cf(r,e,n){var t=n,l=!1;return as(r,function(o,i,s,a,f){l===!1&&n===void 0?t=o:t=e(t,o,i,s,a,f),l=!0}),t}function fs(r,e){if(!r)throw new Error("geojson is required");Pn(r,function(n,t,l){if(n.geometry!==null){var o=n.geometry.type,i=n.geometry.coordinates;switch(o){case"LineString":if(e(n,t,l,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Rt(i[s],n.properties),t,l,s)===!1)return!1;break}}})}function df(r,e,n){var t=n;return fs(r,function(l,o,i,s){o===0&&n===void 0?t=l:t=e(t,l,o,i,s)}),t}function _f(r,e){if(e=e||{},!vl(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,l=e.geometryIndex||0,o=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=a.length+o-1),Rt([a[o],a[o+1]],i,e);case"Polygon":return l<0&&(l=a.length+l),o<0&&(o=a[l].length+o-1),Rt([a[l][o],a[l][o+1]],i,e);case"MultiLineString":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o-1),Rt([a[t][o],a[t][o+1]],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l),o<0&&(o=a[t][l].length-o-1),Rt([a[t][l][o],a[t][l][o+1]],i,e)}throw new Error("geojson is invalid")}function mf(r,e){if(e=e||{},!vl(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,l=e.geometryIndex||0,o=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return Lt(a,i,e);case"MultiPoint":return t<0&&(t=a.length+t),Lt(a[t],i,e);case"LineString":return o<0&&(o=a.length+o),Lt(a[o],i,e);case"Polygon":return l<0&&(l=a.length+l),o<0&&(o=a[l].length+o),Lt(a[l][o],i,e);case"MultiLineString":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),Lt(a[t][o],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l),o<0&&(o=a[t][l].length-o),Lt(a[t][l][o],i,e)}throw new Error("geojson is invalid")}const pf=Object.freeze(Object.defineProperty({__proto__:null,coordAll:af,coordEach:er,coordReduce:lf,featureEach:Sr,featureReduce:sf,findPoint:mf,findSegment:_f,flattenEach:Pn,flattenReduce:uf,geomEach:wl,geomReduce:ff,lineEach:fs,lineReduce:df,propEach:ss,propReduce:of,segmentEach:as,segmentReduce:cf},Symbol.toStringTag,{value:"Module"}));function us(r,e,n){if(n===void 0&&(n={}),n.final===!0)return gf(r,e);var t=Xn(r),l=Xn(e),o=Dt(t[0]),i=Dt(l[0]),s=Dt(t[1]),a=Dt(l[1]),f=Math.sin(i-o)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-o);return Kn(Math.atan2(f,u))}function gf(r,e){var n=us(e,r);return n=(n+180)%360,n}function Zl(r,e,n,t){t===void 0&&(t={});var l=Xn(r),o=Dt(l[0]),i=Dt(l[1]),s=Dt(n),a=Ar(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=Kn(u),_=Kn(f);return Lt([c,_],t.properties)}function Kl(r){if(!r)throw new Error("geojson is required");var e=[];return Pn(r,function(n){hf(n,e)}),vn(e)}function hf(r,e){var n=[],t=r.geometry;if(t!==null){switch(t.type){case"Polygon":n=An(t);break;case"LineString":n=[An(t)]}n.forEach(function(l){var o=bf(l,r.properties);o.forEach(function(i){i.id=e.length,e.push(i)})})}}function bf(r,e){var n=[];return r.reduce(function(t,l){var o=Rt([t,l],e);return o.bbox=$f(t,l),n.push(o),l}),n}function $f(r,e){var n=r[0],t=r[1],l=e[0],o=e[1],i=n<l?n:l,s=t<o?t:o,a=n>l?n:l,f=t>o?t:o;return[i,s,a,f]}var kl={exports:{}},cs={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(na,function(){function n(w,C,L,E,T){(function A(z,O,U,R,B){for(;R>U;){if(R-U>600){var H=R-U+1,G=O-U+1,Z=Math.log(H),Y=.5*Math.exp(2*Z/3),ae=.5*Math.sqrt(Z*Y*(H-Y)/H)*(G-H/2<0?-1:1),D=Math.max(U,Math.floor(O-G*Y/H+ae)),ye=Math.min(R,Math.floor(O+(H-G)*Y/H+ae));A(z,O,D,ye,B)}var ge=z[O],fe=U,ve=R;for(t(z,U,O),B(z[R],ge)>0&&t(z,U,R);fe<ve;){for(t(z,fe,ve),fe++,ve--;B(z[fe],ge)<0;)fe++;for(;B(z[ve],ge)>0;)ve--}B(z[U],ge)===0?t(z,U,ve):t(z,++ve,R),ve<=O&&(U=ve+1),O<=ve&&(R=ve-1)}})(w,C,L||0,E||w.length-1,T||l)}function t(w,C,L){var E=w[C];w[C]=w[L],w[L]=E}function l(w,C){return w<C?-1:w>C?1:0}var o=function(w){w===void 0&&(w=9),this._maxEntries=Math.max(4,w),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(w,C,L){if(!L)return C.indexOf(w);for(var E=0;E<C.length;E++)if(L(w,C[E]))return E;return-1}function s(w,C){a(w,0,w.children.length,C,w)}function a(w,C,L,E,T){T||(T=v(null)),T.minX=1/0,T.minY=1/0,T.maxX=-1/0,T.maxY=-1/0;for(var A=C;A<L;A++){var z=w.children[A];f(T,w.leaf?E(z):z)}return T}function f(w,C){return w.minX=Math.min(w.minX,C.minX),w.minY=Math.min(w.minY,C.minY),w.maxX=Math.max(w.maxX,C.maxX),w.maxY=Math.max(w.maxY,C.maxY),w}function u(w,C){return w.minX-C.minX}function c(w,C){return w.minY-C.minY}function _(w){return(w.maxX-w.minX)*(w.maxY-w.minY)}function d(w){return w.maxX-w.minX+(w.maxY-w.minY)}function m(w,C){return w.minX<=C.minX&&w.minY<=C.minY&&C.maxX<=w.maxX&&C.maxY<=w.maxY}function g(w,C){return C.minX<=w.maxX&&C.minY<=w.maxY&&C.maxX>=w.minX&&C.maxY>=w.minY}function v(w){return{children:w,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function h(w,C,L,E,T){for(var A=[C,L];A.length;)if(!((L=A.pop())-(C=A.pop())<=E)){var z=C+Math.ceil((L-C)/E/2)*E;n(w,z,C,L,T),A.push(C,z,z,L)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(w){var C=this.data,L=[];if(!g(w,C))return L;for(var E=this.toBBox,T=[];C;){for(var A=0;A<C.children.length;A++){var z=C.children[A],O=C.leaf?E(z):z;g(w,O)&&(C.leaf?L.push(z):m(w,O)?this._all(z,L):T.push(z))}C=T.pop()}return L},o.prototype.collides=function(w){var C=this.data;if(!g(w,C))return!1;for(var L=[];C;){for(var E=0;E<C.children.length;E++){var T=C.children[E],A=C.leaf?this.toBBox(T):T;if(g(w,A)){if(C.leaf||m(w,A))return!0;L.push(T)}}C=L.pop()}return!1},o.prototype.load=function(w){if(!w||!w.length)return this;if(w.length<this._minEntries){for(var C=0;C<w.length;C++)this.insert(w[C]);return this}var L=this._build(w.slice(),0,w.length-1,0);if(this.data.children.length)if(this.data.height===L.height)this._splitRoot(this.data,L);else{if(this.data.height<L.height){var E=this.data;this.data=L,L=E}this._insert(L,this.data.height-L.height-1,!0)}else this.data=L;return this},o.prototype.insert=function(w){return w&&this._insert(w,this.data.height-1),this},o.prototype.clear=function(){return this.data=v([]),this},o.prototype.remove=function(w,C){if(!w)return this;for(var L,E,T,A=this.data,z=this.toBBox(w),O=[],U=[];A||O.length;){if(A||(A=O.pop(),E=O[O.length-1],L=U.pop(),T=!0),A.leaf){var R=i(w,A.children,C);if(R!==-1)return A.children.splice(R,1),O.push(A),this._condense(O),this}T||A.leaf||!m(A,z)?E?(L++,A=E.children[L],T=!1):A=null:(O.push(A),U.push(L),L=0,E=A,A=A.children[0])}return this},o.prototype.toBBox=function(w){return w},o.prototype.compareMinX=function(w,C){return w.minX-C.minX},o.prototype.compareMinY=function(w,C){return w.minY-C.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(w){return this.data=w,this},o.prototype._all=function(w,C){for(var L=[];w;)w.leaf?C.push.apply(C,w.children):L.push.apply(L,w.children),w=L.pop();return C},o.prototype._build=function(w,C,L,E){var T,A=L-C+1,z=this._maxEntries;if(A<=z)return s(T=v(w.slice(C,L+1)),this.toBBox),T;E||(E=Math.ceil(Math.log(A)/Math.log(z)),z=Math.ceil(A/Math.pow(z,E-1))),(T=v([])).leaf=!1,T.height=E;var O=Math.ceil(A/z),U=O*Math.ceil(Math.sqrt(z));h(w,C,L,U,this.compareMinX);for(var R=C;R<=L;R+=U){var B=Math.min(R+U-1,L);h(w,R,B,O,this.compareMinY);for(var H=R;H<=B;H+=O){var G=Math.min(H+O-1,B);T.children.push(this._build(w,H,G,E-1))}}return s(T,this.toBBox),T},o.prototype._chooseSubtree=function(w,C,L,E){for(;E.push(C),!C.leaf&&E.length-1!==L;){for(var T=1/0,A=1/0,z=void 0,O=0;O<C.children.length;O++){var U=C.children[O],R=_(U),B=(H=w,G=U,(Math.max(G.maxX,H.maxX)-Math.min(G.minX,H.minX))*(Math.max(G.maxY,H.maxY)-Math.min(G.minY,H.minY))-R);B<A?(A=B,T=R<T?R:T,z=U):B===A&&R<T&&(T=R,z=U)}C=z||C.children[0]}var H,G;return C},o.prototype._insert=function(w,C,L){var E=L?w:this.toBBox(w),T=[],A=this._chooseSubtree(E,this.data,C,T);for(A.children.push(w),f(A,E);C>=0&&T[C].children.length>this._maxEntries;)this._split(T,C),C--;this._adjustParentBBoxes(E,T,C)},o.prototype._split=function(w,C){var L=w[C],E=L.children.length,T=this._minEntries;this._chooseSplitAxis(L,T,E);var A=this._chooseSplitIndex(L,T,E),z=v(L.children.splice(A,L.children.length-A));z.height=L.height,z.leaf=L.leaf,s(L,this.toBBox),s(z,this.toBBox),C?w[C-1].children.push(z):this._splitRoot(L,z)},o.prototype._splitRoot=function(w,C){this.data=v([w,C]),this.data.height=w.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(w,C,L){for(var E,T,A,z,O,U,R,B=1/0,H=1/0,G=C;G<=L-C;G++){var Z=a(w,0,G,this.toBBox),Y=a(w,G,L,this.toBBox),ae=(T=Z,A=Y,z=void 0,O=void 0,U=void 0,R=void 0,z=Math.max(T.minX,A.minX),O=Math.max(T.minY,A.minY),U=Math.min(T.maxX,A.maxX),R=Math.min(T.maxY,A.maxY),Math.max(0,U-z)*Math.max(0,R-O)),D=_(Z)+_(Y);ae<B?(B=ae,E=G,H=D<H?D:H):ae===B&&D<H&&(H=D,E=G)}return E||L-C},o.prototype._chooseSplitAxis=function(w,C,L){var E=w.leaf?this.compareMinX:u,T=w.leaf?this.compareMinY:c;this._allDistMargin(w,C,L,E)<this._allDistMargin(w,C,L,T)&&w.children.sort(E)},o.prototype._allDistMargin=function(w,C,L,E){w.children.sort(E);for(var T=this.toBBox,A=a(w,0,C,T),z=a(w,L-C,L,T),O=d(A)+d(z),U=C;U<L-C;U++){var R=w.children[U];f(A,w.leaf?T(R):R),O+=d(A)}for(var B=L-C-1;B>=C;B--){var H=w.children[B];f(z,w.leaf?T(H):H),O+=d(z)}return O},o.prototype._adjustParentBBoxes=function(w,C,L){for(var E=L;E>=0;E--)f(C[E],w)},o.prototype._condense=function(w){for(var C=w.length-1,L=void 0;C>=0;C--)w[C].children.length===0?C>0?(L=w[C-1].children).splice(L.indexOf(w[C]),1):this.clear():s(w[C],this.toBBox)},o})})(cs);var yf=cs.exports;const vf=ml(rf),wf=ml(pf);function ds(r,e,n){if(r!==null)for(var t,l,o,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",v=m?r.features.length:1,h=0;h<v;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var w=0;w<s;w++){var C=0,L=0;if(i=_?f.geometries[w]:f,i!==null){a=i.coordinates;var E=i.type;switch(u=n&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":if(e(a,c,h,C,L)===!1)return!1;c++,C++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,C,L)===!1)return!1;c++,E==="MultiPoint"&&C++}E==="LineString"&&C++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(l=0;l<a[t].length-u;l++){if(e(a[t][l],c,h,C,L)===!1)return!1;c++}E==="MultiLineString"&&C++,E==="Polygon"&&L++}E==="Polygon"&&C++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(L=0,l=0;l<a[t].length;l++){for(o=0;o<a[t][l].length-u;o++){if(e(a[t][l][o],c,h,C,L)===!1)return!1;c++}L++}C++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(ds(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _s(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return ds(r,t=>{n[0]>t[0]&&(n[0]=t[0]),n[1]>t[1]&&(n[1]=t[1]),n[2]<t[0]&&(n[2]=t[0]),n[3]<t[1]&&(n[3]=t[1])}),n}var kf=_s;const Sf=Object.freeze(Object.defineProperty({__proto__:null,bbox:_s,default:kf},Symbol.toStringTag,{value:"Module"})),Cf=ml(Sf);var Xt=yf,ms=vf,ps=wf,Sn=Cf.default,Lf=ps.featureEach;ps.coordEach;ms.polygon;var Xl=ms.featureCollection;function gs(r){var e=new Xt(r);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Sn(n),Xt.prototype.insert.call(this,n)},e.load=function(n){var t=[];return Array.isArray(n)?n.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Sn(l),t.push(l)}):Lf(n,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Sn(l),t.push(l)}),Xt.prototype.load.call(this,t)},e.remove=function(n,t){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Sn(n),Xt.prototype.remove.call(this,n,t)},e.clear=function(){return Xt.prototype.clear.call(this)},e.search=function(n){var t=Xt.prototype.search.call(this,this.toBBox(n));return Xl(t)},e.collides=function(n){return Xt.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=Xt.prototype.all.call(this);return Xl(n)},e.toJSON=function(){return Xt.prototype.toJSON.call(this)},e.fromJSON=function(n){return Xt.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var t;if(n.bbox)t=n.bbox;else if(Array.isArray(n)&&n.length===4)t=n;else if(Array.isArray(n)&&n.length===6)t=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")t=Sn(n);else if(n.type==="FeatureCollection")t=Sn(n);else throw new Error("invalid geojson");return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},e}kl.exports=gs;kl.exports.default=gs;var Mf=kl.exports;const Tf=ra(Mf);function Af(r,e){var n={},t=[];if(r.type==="LineString"&&(r=Ut(r)),e.type==="LineString"&&(e=Ut(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Vl(r,e);return l&&t.push(l),vn(t)}var o=Tf();return o.load(Kl(e)),Sr(Kl(r),function(i){Sr(o.search(i),function(s){var a=Vl(i,s);if(a){var f=An(a).join(",");n[f]||(n[f]=!0,t.push(a))}})}),vn(t)}function Vl(r,e){var n=An(r),t=An(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(t.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=n[0][0],o=n[0][1],i=n[1][0],s=n[1][1],a=t[0][0],f=t[0][1],u=t[1][0],c=t[1][1],_=(c-f)*(i-l)-(u-a)*(s-o),d=(u-a)*(o-f)-(c-f)*(l-a),m=(i-l)*(o-f)-(s-o)*(l-a);if(_===0)return null;var g=d/_,v=m/_;if(g>=0&&g<=1&&v>=0&&v<=1){var h=l+g*(i-l),w=o+g*(s-o);return Lt([h,w])}return null}function Ff(r,e,n){n===void 0&&(n={});var t=Lt([1/0,1/0],{dist:1/0}),l=0;return Pn(r,function(o){for(var i=An(o),s=0;s<i.length-1;s++){var a=Lt(i[s]);a.properties.dist=En(e,a,n);var f=Lt(i[s+1]);f.properties.dist=En(e,f,n);var u=En(a,f,n),c=Math.max(a.properties.dist,f.properties.dist),_=us(a,f),d=Zl(e,c,_+90,n),m=Zl(e,c,_-90,n),g=Af(Rt([d.geometry.coordinates,m.geometry.coordinates]),Rt([a.geometry.coordinates,f.geometry.coordinates])),v=null;g.features.length>0&&(v=g.features[0],v.properties.dist=En(e,v,n),v.properties.location=l+En(a,v,n)),a.properties.dist<t.properties.dist&&(t=a,t.properties.index=s,t.properties.location=l),f.properties.dist<t.properties.dist&&(t=f,t.properties.index=s+1,t.properties.location=l+u),v&&v.properties.dist<t.properties.dist&&(t=v,t.properties.index=s),l+=u}}),t}const Pf=30;class If{constructor(e,n,t,l,o){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-Pf,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new wr(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=l,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}function Ql(r){let e,n;return e=new Mr({props:{$$slots:{default:[Ef,({dialog:t})=>({3:t}),({dialog:t})=>t?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ef(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;function g(){return r[1](r[3])}return{c(){e=k("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",n=M(),t=k("p"),t.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=M(),o=k("p"),o.textContent="To use this tool, you need to:",i=M(),s=k("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,a=M(),f=k("p"),f.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,u=M(),c=k("center"),_=k("button"),_.textContent="Start!"},m(v,h){$(v,e,h),$(v,n,h),$(v,t,h),$(v,l,h),$(v,o,h),$(v,i,h),$(v,s,h),$(v,a,h),$(v,f,h),$(v,u,h),$(v,c,h),p(c,_),d||(m=K(_,"click",g),d=!0)},p(v,h){r=v},d(v){v&&(y(e),y(n),y(t),y(l),y(o),y(i),y(s),y(a),y(f),y(u),y(c)),d=!1,m()}}}function Nf(r){let e,n,t=r[0]&&Ql(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&b(t,1)):(t=Ql(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function jf(r,e,n){let t;return X(r,hr,i=>n(0,t=i)),[t,i=>ct(i).close(),()=>te(hr,t=!1,t)]}class zf extends ie{constructor(e){super(),se(this,e,jf,Nf,le,{})}}function Of(r){let e;const n=r[16].default,t=De(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&Ue(t,n,l,l[24],e?Ge(n,l[24],o,null):He(l[24]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Bf(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Of]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Ki({props:o}),Be.push(()=>st(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],at(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function Rf(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=pl("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:v=void 0}=e,{manageHoverState:h=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:L=!0}=e;function E(B){w=B,n(0,w)}function T(B){ze.call(this,r,B)}function A(B){ze.call(this,r,B)}function z(B){ze.call(this,r,B)}function O(B){ze.call(this,r,B)}function U(B){ze.call(this,r,B)}function R(B){ze.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,o=B.id),"source"in B&&n(2,i=B.source),"sourceLayer"in B&&n(3,s=B.sourceLayer),"beforeId"in B&&n(4,a=B.beforeId),"beforeLayerType"in B&&n(5,f=B.beforeLayerType),"paint"in B&&n(6,u=B.paint),"layout"in B&&n(7,c=B.layout),"filter"in B&&n(8,_=B.filter),"applyToClusters"in B&&n(9,d=B.applyToClusters),"minzoom"in B&&n(10,m=B.minzoom),"maxzoom"in B&&n(11,g=B.maxzoom),"hoverCursor"in B&&n(12,v=B.hoverCursor),"manageHoverState"in B&&n(13,h=B.manageHoverState),"hovered"in B&&n(0,w=B.hovered),"eventsIfTopMost"in B&&n(14,C=B.eventsIfTopMost),"interactive"in B&&n(15,L=B.interactive),"$$scope"in B&&n(24,l=B.$$scope)},[w,o,i,s,a,f,u,c,_,d,m,g,v,h,C,L,t,E,T,A,z,O,U,R,l]}let on=class extends ie{constructor(e){super(),se(this,e,Rf,Bf,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Df(r){let e,n;const t=r[7].default,l=De(t,r,r[6],null);return{c(){e=k("div"),l&&l.c(),N(e,"class",r[1]),gt(e,"maplibregl-ctrl",r[0])},m(o,i){$(o,e,i),l&&l.m(e,null),r[8](e),n=!0},p(o,[i]){l&&l.p&&(!n||i&64)&&Ue(l,t,o,o[6],n?Ge(t,o[6],i,null):He(o[6]),null),(!n||i&2)&&N(e,"class",o[1]),(!n||i&3)&&gt(e,"maplibregl-ctrl",o[0])},i(o){n||(b(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&y(e),l&&l.d(o),r[8](null)}}}function Uf(r,e,n){let t,{$$slots:l={},$$scope:o}=e,{defaultStyling:i=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:f}=gl();X(r,f,d=>n(5,t=d));let u,c={onAdd(){return u},onRemove(){var d;(d=u==null?void 0:u.parentNode)==null||d.removeChild(u)}};Tt(()=>{t==null||t.removeControl(c)});function _(d){Be[d?"unshift":"push"](()=>{u=d,n(2,u)})}return r.$$set=d=>{"defaultStyling"in d&&n(0,i=d.defaultStyling),"position"in d&&n(4,s=d.position),"class"in d&&n(1,a=d.class),"$$scope"in d&&n(6,o=d.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&t&&u&&t.addControl(c,s)},[i,a,u,f,s,t,o,l,_]}class Hf extends ie{constructor(e){super(),se(this,e,Uf,Df,le,{defaultStyling:0,position:4,class:1})}}function Gf(r,e,n){let t,l,{data:o}=e,{idCol:i}=e,{sourceLayer:s=void 0}=e,a=new Set;const{map:f,source:u}=la();return X(r,f,c=>n(6,t=c)),X(r,u,c=>n(7,l=c)),r.$$set=c=>{"data"in c&&n(2,o=c.data),"idCol"in c&&n(3,i=c.idCol),"sourceLayer"in c&&n(4,s=c.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&t&&l){let c=new Set;for(const _ of o){const d=_[i];if(!d)continue;a.delete(d),c.add(d);const m={id:d,source:l,sourceLayer:s},g=t.getFeatureState(m);let v=!1;for(const h of Object.keys(_))if(g[h]!==_[h]){v=!0;break}v&&t.setFeatureState(m,_)}for(const _ of a){const d={id:_,source:l,sourceLayer:s},m=t.getFeatureState(d);for(const g of Object.keys(m))t.removeFeatureState(d,g)}n(5,a=c)}},[f,u,o,i,s,a,t,l]}class Wf extends ie{constructor(e){super(),se(this,e,Gf,null,le,{data:2,idCol:3,sourceLayer:4})}}function qf(r,e,n){let t;const l=pn();let{layer:o=void 0}=e;const{map:i}=gl();X(r,i,u=>n(2,t=u));function s(u){l(u.type,{...u,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Tt(()=>{if(t)if(o)for(const u of a)t.off(u,o,s);else for(const u of f)t.off(u,s)}),r.$$set=u=>{"layer"in u&&n(1,o=u.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&t)if(o)for(const u of a)t.on(u,o,s);else for(const u of f)t.on(u,s)},[i,o,t]}class hs extends ie{constructor(e){super(),se(this,e,qf,null,le,{layer:1})}}const Jf=r=>({marker:r&8}),xl=r=>({marker:r[3]});function Yf(r){let e,n,t,l,o,i,s;const a=r[19].default,f=De(a,r,r[18],xl);return{c(){e=k("div"),f&&f.c(),N(e,"tabindex",n=r[1]?0:void 0),N(e,"role",t=r[1]?"button":void 0),oe(e,"z-index",r[2])},m(u,c){$(u,e,c),f&&f.m(e,null),o=!0,i||(s=[Ml(r[7].call(null,e)),Ml(l=Zf.call(null,e,r[0])),K(e,"click",Dr(r[20])),K(e,"dblclick",Dr(r[21])),K(e,"contextmenu",Dr(Xi(r[22]))),K(e,"mouseenter",r[23]),K(e,"mouseleave",r[24]),K(e,"mousemove",r[25]),K(e,"keydown",r[8])],i=!0)},p(u,[c]){f&&f.p&&(!o||c&262152)&&Ue(f,a,u,u[18],o?Ge(a,u[18],c,Jf):He(u[18]),xl),(!o||c&2&&n!==(n=u[1]?0:void 0))&&N(e,"tabindex",n),(!o||c&2&&t!==(t=u[1]?"button":void 0))&&N(e,"role",t),l&&Kr(l.update)&&c&1&&l.update.call(null,u[0]),c&4&&oe(e,"z-index",u[2])},i(u){o||(b(f,u),o=!0)},o(u){S(f,u),o=!1},d(u){u&&y(e),f&&f.d(u),i=!1,nt(s)}}}function Zf(r,e){const n=r.className;function t(l){l?r.className=`${n} ${l}`:r.className=n}return t(e),{update:t}}function Kf(r,e,n){let t,l,o,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:f}=e,{class:u=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:m=null}=e,{offset:g=void 0}=e,{zIndex:v=void 0}=e,{rotation:h=0}=e,{opacity:w=1}=e;const C=pn(),{map:L,layerEvent:E,self:T,markerClickManager:A}=oa();X(r,L,D=>n(27,o=D)),X(r,E,D=>n(26,t=D)),X(r,T,D=>n(3,l=D));function z(D){te(T,l=new Vt.Marker({element:D,rotation:h,draggable:d,offset:g,opacity:w.toString()}).setLngLat(f).addTo(o),l),n(11,a=l);const ye=()=>R("dragstart"),ge=()=>{O(),R("drag")},fe=()=>{O(),R("dragend")};return d&&(l.on("dragstart",ye),l.on("drag",ge),l.on("dragend",fe)),{destroy(){d&&(l==null||l.off("dragstart",ye),l==null||l.off("drag",ge),l==null||l.off("dragend",fe)),n(11,a=void 0),l==null||l.remove()}}}function O(){let D=l==null?void 0:l.getLngLat();D&&(Array.isArray(f)?n(10,f=[D.lng,D.lat]):f&&"lon"in f?n(10,f={lon:D.lng,lat:D.lat}):n(10,f=D))}function U(D){D.key===" "&&(D.preventDefault(),D.stopPropagation(),R("click"))}function R(D){if(!c)return;let ye=l==null?void 0:l.getLngLat();if(!ye)return;const ge=[ye.lng,ye.lat];let fe={map:o,marker:l,lngLat:ge,features:[{type:"Feature",properties:(m==null?void 0:m.properties)??{},geometry:{type:"Point",coordinates:ge}}]};(D==="click"||D==="contextmenu")&&A.handleClick(fe),te(E,t={...fe,layerType:"marker",type:D},t),C(D,fe)}const B=()=>R("click"),H=()=>R("dblclick"),G=()=>{R("contextmenu")},Z=()=>{R("mouseenter")},Y=()=>{R("mouseleave")},ae=()=>R("mousemove");return r.$$set=D=>{"marker"in D&&n(11,a=D.marker),"lngLat"in D&&n(10,f=D.lngLat),"class"in D&&n(0,u=D.class),"interactive"in D&&n(12,c=D.interactive),"asButton"in D&&n(1,_=D.asButton),"draggable"in D&&n(13,d=D.draggable),"feature"in D&&n(14,m=D.feature),"offset"in D&&n(15,g=D.offset),"zIndex"in D&&n(2,v=D.zIndex),"rotation"in D&&n(16,h=D.rotation),"opacity"in D&&n(17,w=D.opacity),"$$scope"in D&&n(18,s=D.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(f)),r.$$.dirty&32776&&(l==null||l.setOffset(g??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(h)),r.$$.dirty&131080&&(l==null||l.setOpacity(w.toString()))},[u,_,v,l,L,E,T,z,U,R,f,a,c,d,m,g,h,w,s,i,B,H,G,Z,Y,ae]}class Fr extends ie{constructor(e){super(),se(this,e,Kf,Yf,le,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Xf=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),eo=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function to(r){var l;let e,n,t=(((l=r[4])==null?void 0:l.length)||r[3]instanceof Vt.Marker)&&no(r);return{c(){e=k("div"),t&&t.c()},m(o,i){$(o,e,i),t&&t.m(e,null),r[32](e),n=!0},p(o,i){var s;(s=o[4])!=null&&s.length||o[3]instanceof Vt.Marker?t?(t.p(o,i),i[0]&24&&b(t,1)):(t=no(o),t.c(),b(t,1),t.m(e,null)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(o){n||(b(t),n=!0)},o(o){S(t),n=!1},d(o){o&&y(e),t&&t.d(),r[32](null)}}}function no(r){let e;const n=r[30].default,t=De(n,r,r[29],eo);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o[0]&536870933)&&Ue(t,n,l,l[29],e?Ge(n,l[29],o,Xf):He(l[29]),eo)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Vf(r){let e,n,t=r[9].default&&to(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,o){l[9].default?t?(t.p(l,o),o[0]&512&&b(t,1)):(t=to(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function Qf(r,e,n){let t,l,o,i,s,a,{$$slots:f={},$$scope:u}=e;const c=ia(f);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:m=!1}=e,{closeOnMove:g=!1}=e,{openOn:v="click"}=e,{openIfTopMost:h=!0}=e,{focusAfterOpen:w=!0}=e,{anchor:C=void 0}=e,{offset:L=void 0}=e,{popupClass:E=void 0}=e,{maxWidth:T=void 0}=e,{lngLat:A=void 0}=e,{html:z=void 0}=e,{open:O=!1}=e;const U=pn(),{map:R,popupTarget:B,layerEvent:H,layer:G,eventTopMost:Z,markerClickManager:Y}=gl();X(r,R,q=>n(2,o=q)),X(r,B,q=>n(3,s=q)),X(r,H,q=>n(28,i=q)),X(r,G,q=>n(35,a=q));const ae=["click","dblclick","contextmenu"];let D,ye=!1,ge;function fe(){if(!D)return;let q=D.getElement();!q||q===ge||(ge=q,v==="hover"&&(ge.style.pointerEvents="none"),ge.addEventListener("mouseenter",()=>{n(24,ye=!0)},{passive:!0}),ge.addEventListener("mouseleave",()=>{n(24,ye=!1)},{passive:!0}),ge.addEventListener("click",()=>{m&&n(0,O=!1)},{passive:!0}))}Cr(()=>{if(o)return o.on("click",me),o.on("contextmenu",me),Y.add(x),typeof s=="string"&&(o.on("click",s,Te),o.on("dblclick",s,Te),o.on("contextmenu",s,Te),o.on("mousemove",s,V),o.on("mouseleave",s,ke),o.on("touchstart",s,Je),o.on("touchend",s,je)),()=>{o!=null&&o.loaded()&&(D==null||D.remove(),o.off("click",me),o.off("contextmenu",me),Y.remove(x),s instanceof Vt.Marker?s.getPopup()===D&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Te),o.off("dblclick",s,Te),o.off("contextmenu",s,Te),o.off("mousemove",s,V),o.off("mouseleave",s,ke),o.off("touchstart",s,Je),o.off("touchend",s,je)))}});function ve(q){return h?!("marker"in q)&&!sa(q)&&Z(q)!==a:!1}let ue=null,Fe="normal";function Ze(q){"layerType"in q&&q.layerType==="deckgl"?(n(10,A=q.coordinate),n(4,ue=q.object?[q.object]:null)):(n(10,A=q.lngLat),n(4,ue=q.features??[]))}function Te(q){q.type!==v||ve(q)||(Ze(q),setTimeout(()=>n(0,O=!0)))}let re=null;function Je(q){re=q.point}function je(q){if(!re||v!=="hover")return;let _t=re.dist(q.point);re=null,_t<3&&(n(10,A=q.lngLat),n(4,ue=q.features??[]),D.isOpen()?n(25,Fe="justOpened"):(n(25,Fe="opening"),n(0,O=!0)))}function ke(q){v!=="hover"||re||Fe!=="normal"||(n(0,O=!1),n(4,ue=null))}function V(q){if(!(v!=="hover"||re||Fe!=="normal")){if(ve(q)){n(0,O=!1),n(4,ue=null);return}n(0,O=!0),n(4,ue=q.features??[]),n(10,A=q.lngLat)}}function me(q){if(Fe==="justOpened"){n(25,Fe="normal");return}if(!d)return;let _t=[ge,s instanceof Vt.Marker?s==null?void 0:s.getElement():null];O&&D.isOpen()&&!_t.some(Re=>Re==null?void 0:Re.contains(q.originalEvent.target))&&(q.type==="contextmenu"&&v==="contextmenu"||q.type!=="contextmenu")&&n(0,O=!1)}function x(q){d&&O&&D.isOpen()&&q.marker!==s&&n(0,O=!1)}Tt(()=>{o&&(D!=null&&D.isOpen())&&D.remove()});let pe;const $e=()=>n(0,O=!1);function Se(q){Be[q?"unshift":"push"](()=>{pe=q,n(1,pe)})}return r.$$set=q=>{"closeButton"in q&&n(11,_=q.closeButton),"closeOnClickOutside"in q&&n(12,d=q.closeOnClickOutside),"closeOnClickInside"in q&&n(13,m=q.closeOnClickInside),"closeOnMove"in q&&n(14,g=q.closeOnMove),"openOn"in q&&n(15,v=q.openOn),"openIfTopMost"in q&&n(16,h=q.openIfTopMost),"focusAfterOpen"in q&&n(17,w=q.focusAfterOpen),"anchor"in q&&n(18,C=q.anchor),"offset"in q&&n(19,L=q.offset),"popupClass"in q&&n(20,E=q.popupClass),"maxWidth"in q&&n(21,T=q.maxWidth),"lngLat"in q&&n(10,A=q.lngLat),"html"in q&&n(22,z=q.html),"open"in q&&n(0,O=q.open),"$$scope"in q&&n(29,u=q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(27,t=_??(!d&&!m)),r.$$.dirty[0]&146685952&&(D||(n(23,D=new Vt.Popup({closeButton:t,closeOnClick:!1,closeOnMove:g,focusAfterOpen:w,maxWidth:T,className:E,anchor:C,offset:L})),ge=D.getElement(),D.on("open",()=>{n(0,O=!0),fe(),U("open",D)}),D.on("close",()=>{n(0,O=!1),U("close",D)}),D.on("hover",()=>{U("hover",D)}))),r.$$.dirty[0]&8421384&&D&&s instanceof Vt.Marker&&(v==="click"?s.setPopup(D):s.getPopup()===D&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&ae.includes(v)&&(i==null?void 0:i.type)===v&&(Te(i),te(H,i=null,i)),r.$$.dirty[0]&268468224&&n(26,l=v==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&v==="hover"&&H&&(l&&i&&Ze(i),n(0,O=(l||ye)??!1)),r.$$.dirty[0]&12582914&&(pe?D.setDOMContent(pe):z&&D.setHTML(z)),r.$$.dirty[0]&8389632&&A&&D.setLngLat(A),r.$$.dirty[0]&41943045&&o){let q=D.isOpen();O&&!q?(D.addTo(o),Fe==="opening"&&n(25,Fe="justOpened")):!O&&q&&D.remove()}},[O,pe,o,s,ue,R,B,H,G,c,A,_,d,m,g,v,h,w,C,L,E,T,z,D,ye,Fe,l,t,i,u,f,$e,Se]}class xf extends ie{constructor(e){super(),se(this,e,Qf,Vf,le,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function eu(r){let e;const n=r[16].default,t=De(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&Ue(t,n,l,l[24],e?Ge(n,l[24],o,null):He(l[24]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function tu(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[eu]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Ki({props:o}),Be.push(()=>st(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],at(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function nu(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=pl("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:v=void 0}=e,{manageHoverState:h=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:L=!0}=e;function E(B){w=B,n(0,w)}function T(B){ze.call(this,r,B)}function A(B){ze.call(this,r,B)}function z(B){ze.call(this,r,B)}function O(B){ze.call(this,r,B)}function U(B){ze.call(this,r,B)}function R(B){ze.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,o=B.id),"source"in B&&n(2,i=B.source),"sourceLayer"in B&&n(3,s=B.sourceLayer),"beforeId"in B&&n(4,a=B.beforeId),"beforeLayerType"in B&&n(5,f=B.beforeLayerType),"paint"in B&&n(6,u=B.paint),"layout"in B&&n(7,c=B.layout),"filter"in B&&n(8,_=B.filter),"applyToClusters"in B&&n(9,d=B.applyToClusters),"minzoom"in B&&n(10,m=B.minzoom),"maxzoom"in B&&n(11,g=B.maxzoom),"hoverCursor"in B&&n(12,v=B.hoverCursor),"manageHoverState"in B&&n(13,h=B.manageHoverState),"hovered"in B&&n(0,w=B.hovered),"eventsIfTopMost"in B&&n(14,C=B.eventsIfTopMost),"interactive"in B&&n(15,L=B.interactive),"$$scope"in B&&n(24,l=B.$$scope)},[w,o,i,s,a,f,u,c,_,d,m,g,v,h,C,L,t,E,T,A,z,O,U,R,l]}class Vn extends ie{constructor(e){super(),se(this,e,nu,tu,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ro(r){let e=r[0],n,t,l=lo(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),$(o,n,i),t=!0},p(o,i){i&1&&le(e,e=o[0])?(he(),S(l,1,1,Q),be(),l=lo(o),l.c(),b(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||(b(l),t=!0)},o(o){S(l),t=!1},d(o){o&&y(n),l.d(o)}}}function lo(r){let e;const n=r[15].default,t=De(n,r,r[14],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16384)&&Ue(t,n,l,l[14],e?Ge(n,l[14],o,null):He(l[14]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function ru(r){let e,n,t=r[0]&&ro(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&b(t,1)):(t=ro(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function lu(r,e,n){let t,l,{$$slots:o={},$$scope:i}=e,{id:s=pl("vector")}=e,{url:a=null}=e,{tiles:f=null}=e,{promoteId:u=null}=e,{bounds:c=null}=e,{scheme:_=null}=e,{attribution:d=null}=e,{minzoom:m=null}=e,{maxzoom:g=null}=e,{volatile:v=null}=e;if(a&&a.includes("pmtiles://")&&!Vt.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let L=new ca;Vt.addProtocol("pmtiles",L.tile)}const{map:h,self:w}=aa();X(r,h,L=>n(13,l=L)),X(r,w,L=>n(0,t=L));let C;return Tt(()=>{t&&l&&(fa(h,t,C),te(w,t=null,t),C=void 0)}),r.$$set=L=>{"id"in L&&n(3,s=L.id),"url"in L&&n(4,a=L.url),"tiles"in L&&n(5,f=L.tiles),"promoteId"in L&&n(6,u=L.promoteId),"bounds"in L&&n(7,c=L.bounds),"scheme"in L&&n(8,_=L.scheme),"attribution"in L&&n(9,d=L.attribution),"minzoom"in L&&n(10,m=L.minzoom),"maxzoom"in L&&n(11,g=L.maxzoom),"volatile"in L&&n(12,v=L.volatile),"$$scope"in L&&n(14,i=L.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&l&&t!==s&&(te(w,t=s,t),ua(l,t,br({type:"vector",url:a,tiles:f,promoteId:u,bounds:c,scheme:_,attribution:d,minzoom:m,maxzoom:g,volatile:v}),L=>l&&L===t,()=>{t&&(C=l==null?void 0:l.getSource(t))})),r.$$.dirty&8200&&(l==null||l.on("style.load",()=>{C=l==null?void 0:l.getSource(s)}))},[t,h,w,s,a,f,u,c,_,d,m,g,v,l,i,o]}class tr extends ie{constructor(e){super(),se(this,e,lu,ru,le,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const ou="/ltn/assets/layers-03647595.svg";function iu(r){let e,n,t,l,o,i,s,a,f;return{c(){e=k("label"),n=j(`Basemap:
  `),t=k("select"),l=k("option"),l.textContent="MapTiler Dataviz",o=k("option"),o.textContent="MapTiler Streets",i=k("option"),i.textContent="MapTiler Satellite",s=k("option"),s.textContent="OS Open Zoomstack",l.__value="dataviz",Oe(l,l.__value),o.__value="streets-v2",Oe(o,o.__value),i.__value="hybrid",Oe(i,i.__value),s.__value="uk-openzoomstack-light",Oe(s,s.__value),r[0]===void 0&&un(()=>r[1].call(t))},m(u,c){$(u,e,c),p(e,n),p(e,t),p(t,l),p(t,o),p(t,i),p(t,s),vt(t,r[0],!0),a||(f=K(t,"change",r[1]),a=!0)},p(u,[c]){c&1&&vt(t,u[0])},i:Q,o:Q,d(u){u&&y(e),a=!1,f()}}}function su(r,e,n){let t;X(r,Xr,o=>n(0,t=o));function l(){t=cn(this),Xr.set(t)}return[t,l]}class au extends ie{constructor(e){super(),se(this,e,su,iu,le,{})}}let _r=Mt(!0);function fu(r){let e,n;return e=new kt({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.layout={visibility:t[0]?"none":"visible"}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function uu(r){let e,n;return e=new Ke({props:{data:r[1],$$slots:{default:[fu]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&5&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function cu(r,e,n){let t;return X(r,_r,o=>n(0,t=o)),[t,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class du extends ie{constructor(e){super(),se(this,e,cu,uu,le,{})}}function _u(r){let e,n;return e=new Fr({props:{lngLat:r[0],$$slots:{default:[pu]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.lngLat=t[0]),l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function mu(r){let e,n,t;function l(i){r[3](i)}let o={draggable:!0,$$slots:{default:[gu]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new Fr({props:o}),Be.push(()=>st(e,"lngLat",l)),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),t=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.lngLat=i[0],at(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function pu(r){let e,n;const t=r[2].default,l=De(t,r,r[4],null);return{c(){e=k("span"),l&&l.c(),N(e,"class","dot svelte-1gcxp27")},m(o,i){$(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i&16)&&Ue(l,t,o,o[4],n?Ge(t,o[4],i,null):He(o[4]),null)},i(o){n||(b(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&y(e),l&&l.d(o)}}}function gu(r){let e,n;const t=r[2].default,l=De(t,r,r[4],null);return{c(){e=k("span"),l&&l.c(),N(e,"class","dot svelte-1gcxp27")},m(o,i){$(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i&16)&&Ue(l,t,o,o[4],n?Ge(t,o[4],i,null):He(o[4]),null)},i(o){n||(b(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&y(e),l&&l.d(o)}}}function hu(r){let e,n,t,l;const o=[mu,_u],i=[];function s(a,f){return a[1]?0:1}return e=s(r),n=i[e]=o[e](r),{c(){n.c(),t=Ye()},m(a,f){i[e].m(a,f),$(a,t,f),l=!0},p(a,[f]){let u=e;e=s(a),e===u?i[e].p(a,f):(he(),S(i[u],1,1,()=>{i[u]=null}),be(),n=i[e],n?n.p(a,f):(n=i[e]=o[e](a),n.c()),b(n,1),n.m(t.parentNode,t))},i(a){l||(b(n),l=!0)},o(a){S(n),l=!1},d(a){a&&y(t),i[e].d(a)}}}function bu(r,e,n){let{$$slots:t={},$$scope:l}=e,{lngLat:o}=e,{draggable:i=!1}=e;function s(a){o=a,n(0,o)}return r.$$set=a=>{"lngLat"in a&&n(0,o=a.lngLat),"draggable"in a&&n(1,i=a.draggable),"$$scope"in a&&n(4,l=a.$$scope)},[o,i,t,s,l]}class wn extends ie{constructor(e){super(),se(this,e,bu,hu,le,{lngLat:0,draggable:1})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const $u={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},oo=$u;function io(r,e,n){const t=r.slice();return t[11]=e[n][0],t[12]=e[n][1],t}function Gr(r){let e,n=[r[12]],t={};for(let l=0;l<n.length;l+=1)t=_e(t,n[l]);return{c(){e=Jt(r[11]),$r(e,t)},m(l,o){$(l,e,o)},p(l,o){$r(e,t=Ne(n,[o&32&&l[12]]))},d(l){l&&y(e)}}}function so(r){let e=r[11],n,t=r[11]&&Gr(r);return{c(){t&&t.c(),n=Ye()},m(l,o){t&&t.m(l,o),$(l,n,o)},p(l,o){l[11]?e?le(e,l[11])?(t.d(1),t=Gr(l),e=l[11],t.c(),t.m(n.parentNode,n)):t.p(l,o):(t=Gr(l),e=l[11],t.c(),t.m(n.parentNode,n)):e&&(t.d(1),t=null,e=l[11])},d(l){l&&y(n),t&&t.d(l)}}}function yu(r){let e,n,t,l,o,i=Me(r[5]),s=[];for(let _=0;_<i.length;_+=1)s[_]=so(io(r,i,_));const a=r[10].default,f=De(a,r,r[9],null);let u=[oo,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":t=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:l=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],c={};for(let _=0;_<u.length;_+=1)c=_e(c,u[_]);return{c(){e=Jt("svg");for(let _=0;_<s.length;_+=1)s[_].c();n=Ye(),f&&f.c(),$r(e,c)},m(_,d){$(_,e,d);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null);p(e,n),f&&f.m(e,null),o=!0},p(_,[d]){if(d&32){i=Me(_[5]);let m;for(m=0;m<i.length;m+=1){const g=io(_,i,m);s[m]?s[m].p(g,d):(s[m]=so(g),s[m].c(),s[m].m(e,n))}for(;m<s.length;m+=1)s[m].d(1);s.length=i.length}f&&f.p&&(!o||d&512)&&Ue(f,a,_,_[9],o?Ge(a,_[9],d,null):He(_[9]),null),$r(e,c=Ne(u,[oo,d&128&&_[7],(!o||d&4)&&{width:_[2]},(!o||d&4)&&{height:_[2]},(!o||d&2)&&{stroke:_[1]},(!o||d&28&&t!==(t=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":t},(!o||d&257&&l!==(l=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:l}]))},i(_){o||(b(f,_),o=!0)},o(_){S(f,_),o=!1},d(_){_&&y(e),ft(s,_),f&&f.d(_)}}}function vu(r,e,n){const t=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let l=Tl(e,t),{$$slots:o={},$$scope:i}=e,{name:s=void 0}=e,{color:a="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:c=!1}=e,{iconNode:_=[]}=e;const d=(...m)=>m.filter((g,v,h)=>!!g&&h.indexOf(g)===v).join(" ");return r.$$set=m=>{n(8,e=_e(_e({},e),Qt(m))),n(7,l=Tl(e,t)),"name"in m&&n(0,s=m.name),"color"in m&&n(1,a=m.color),"size"in m&&n(2,f=m.size),"strokeWidth"in m&&n(3,u=m.strokeWidth),"absoluteStrokeWidth"in m&&n(4,c=m.absoluteStrokeWidth),"iconNode"in m&&n(5,_=m.iconNode),"$$scope"in m&&n(9,i=m.$$scope)},e=Qt(e),[s,a,f,u,c,_,d,l,e,i,o]}class wu extends ie{constructor(e){super(),se(this,e,vu,yu,le,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Pr=wu;function ku(r){let e;const n=r[2].default,t=De(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&Ue(t,n,l,l[3],e?Ge(n,l[3],o,null):He(l[3]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Su(r){let e,n;const t=[{name:"circle-help"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[ku]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Pr({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,[i]){const s=i&3?Ne(t,[t[0],i&2&&Lr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Cu(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Qt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Qt(e),[o,e,t,l]}class Lu extends ie{constructor(e){super(),se(this,e,Cu,Su,le,{})}}const Mu=Lu;function Tu(r){let e;const n=r[2].default,t=De(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&Ue(t,n,l,l[3],e?Ge(n,l[3],o,null):He(l[3]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Au(r){let e,n;const t=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[Tu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Pr({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,[i]){const s=i&3?Ne(t,[t[0],i&2&&Lr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Fu(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Qt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Qt(e),[o,e,t,l]}class Pu extends ie{constructor(e){super(),se(this,e,Fu,Au,le,{})}}const Iu=Pu;function Eu(r){let e;const n=r[2].default,t=De(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&Ue(t,n,l,l[3],e?Ge(n,l[3],o,null):He(l[3]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Nu(r){let e,n;const t=[{name:"pencil"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[Eu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Pr({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,[i]){const s=i&3?Ne(t,[t[0],i&2&&Lr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function ju(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Qt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Qt(e),[o,e,t,l]}class zu extends ie{constructor(e){super(),se(this,e,ju,Nu,le,{})}}const Sl=zu;function Ou(r){let e;const n=r[2].default,t=De(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&Ue(t,n,l,l[3],e?Ge(n,l[3],o,null):He(l[3]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Bu(r){let e,n;const t=[{name:"trash-2"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[Ou]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Pr({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,[i]){const s=i&3?Ne(t,[t[0],i&2&&Lr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Ru(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Qt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Qt(e),[o,e,t,l]}class Du extends ie{constructor(e){super(),se(this,e,Ru,Bu,le,{})}}const bs=Du;function ao(r){let e,n;return e=new Mr({props:{$$slots:{default:[Uu]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Uu(r){let e,n,t;const l=r[1].default,o=De(l,r,r[4],null);return{c(){e=k("h2"),e.textContent="Help",n=M(),o&&o.c()},m(i,s){$(i,e,s),$(i,n,s),o&&o.m(i,s),t=!0},p(i,s){o&&o.p&&(!t||s&16)&&Ue(o,l,i,i[4],t?Ge(l,i[4],s,null):He(i[4]),null)},i(i){t||(b(o,i),t=!0)},o(i){S(o,i),t=!1},d(i){i&&(y(e),y(n)),o&&o.d(i)}}}function Hu(r){let e,n,t,l,o,i,s;n=new Mu({props:{color:"black"}});let a=r[0]&&ao(r);return{c(){e=k("button"),F(n.$$.fragment),t=M(),a&&a.c(),l=Ye(),N(e,"class","icon-btn help svelte-my65h"),N(e,"aria-label","Help")},m(f,u){$(f,e,u),P(n,e,null),$(f,t,u),a&&a.m(f,u),$(f,l,u),o=!0,i||(s=K(e,"click",r[2]),i=!0)},p(f,[u]){f[0]?a?(a.p(f,u),u&1&&b(a,1)):(a=ao(f),a.c(),b(a,1),a.m(l.parentNode,l)):a&&(he(),S(a,1,1,()=>{a=null}),be())},i(f){o||(b(n.$$.fragment,f),b(a),o=!0)},o(f){S(n.$$.fragment,f),S(a),o=!1},d(f){f&&(y(e),y(t),y(l)),I(n),a&&a.d(f),i=!1,s()}}}function Gu(r,e,n){let{$$slots:t={},$$scope:l}=e,o=!1;const i=()=>n(0,o=!0),s=()=>n(0,o=!1);return r.$$set=a=>{"$$scope"in a&&n(4,l=a.$$scope)},[o,t,i,s,l]}class zt extends ie{constructor(e){super(),se(this,e,Gu,Hu,le,{})}}function Wu(r){let e,n,t,l,o,i=r[0]+1+"",s,a,f=r[1].length+"",u,c,_,d,m,g,v;return{c(){e=k("div"),n=k("button"),t=j("Previous"),o=M(),s=j(i),a=j(" / "),u=j(f),c=M(),_=k("button"),d=j("Next"),n.disabled=l=r[0]==0,N(n,"data-tooltip","Left"),_.disabled=m=r[0]==r[1].length-1,N(_,"data-tooltip","Right"),oe(e,"display","flex"),oe(e,"justify-content","space-between"),oe(e,"align-items","center")},m(h,w){$(h,e,w),p(e,n),p(n,t),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c),p(e,_),p(_,d),g||(v=[K(window,"keydown",r[2]),K(n,"click",r[3]),K(_,"click",r[4])],g=!0)},p(h,[w]){w&1&&l!==(l=h[0]==0)&&(n.disabled=l),w&1&&i!==(i=h[0]+1+"")&&ne(s,i),w&2&&f!==(f=h[1].length+"")&&ne(u,f),w&3&&m!==(m=h[0]==h[1].length-1)&&(_.disabled=m)},i:Q,o:Q,d(h){h&&y(e),g=!1,nt(v)}}}function qu(r,e,n){let t;X(r,xt,f=>n(5,t=f));let{list:l}=e,{idx:o=0}=e;Cr(()=>{t==null||t.keyboard.disable()}),Tt(()=>{t==null||t.keyboard.enable()});function i(f){f.key=="ArrowLeft"&&(f.stopPropagation(),s()),f.key=="ArrowRight"&&(f.stopPropagation(),a())}function s(){o!=0&&n(0,o--,o)}function a(){o!=l.length-1&&n(0,o++,o)}return r.$$set=f=>{"list"in f&&n(1,l=f.list),"idx"in f&&n(0,o=f.idx)},[o,l,i,s,a]}class Ir extends ie{constructor(e){super(),se(this,e,qu,Wu,le,{list:1,idx:0})}}function Ju(r,e){let n=new Set(r.getStyle().layers.filter(t=>t.type=="line").map(t=>t.id));return e=="dataviz"?["Road network","Path"].filter(t=>n.has(t)):e=="hybrid"?["Path","Road","Tunnel"].filter(t=>n.has(t)):e=="streets-v2"?r.getStyle().layers.filter(t=>t["source-layer"]=="transportation"&&t.type=="line").map(t=>t.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(t=>t["source-layer"]=="roads"&&t.type=="line").map(t=>t.id):[]}const{window:Yu}=Vi;function Zu(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g;return d=Qi(r[8][0]),{c(){e=k("button"),e.textContent="Stop StreetView",n=M(),t=k("fieldset"),l=k("legend"),l.textContent="Source:",o=M(),i=k("label"),s=k("input"),a=j(`
      Google Street View`),f=M(),u=k("label"),c=k("input"),_=j(`
      Bing Streetside`),N(e,"class","secondary"),N(s,"type","radio"),s.__value="google",Oe(s,s.__value),N(c,"type","radio"),c.__value="bing",Oe(c,c.__value),d.p(s,c)},m(v,h){$(v,e,h),$(v,n,h),$(v,t,h),p(t,l),p(t,o),p(t,i),p(i,s),s.checked=s.__value===r[0],p(i,a),p(t,f),p(t,u),p(u,c),c.checked=c.__value===r[0],p(u,_),m||(g=[K(e,"click",r[3]),K(s,"change",r[7]),K(c,"change",r[9])],m=!0)},p(v,h){h&1&&(s.checked=s.__value===v[0]),h&1&&(c.checked=c.__value===v[0])},d(v){v&&(y(e),y(n),y(t)),d.r(),m=!1,nt(g)}}}function Ku(r){let e,n,t;return{c(){e=k("button"),e.textContent="StreetView",N(e,"class","secondary")},m(l,o){$(l,e,o),n||(t=K(e,"click",r[2]),n=!0)},p:Q,d(l){l&&y(e),n=!1,t()}}}function Xu(r){let e,n,t;function l(s,a){return s[1]?Ku:Zu}let o=l(r),i=o(r);return{c(){i.c(),e=Ye()},m(s,a){i.m(s,a),$(s,e,a),n||(t=K(Yu,"keydown",r[4]),n=!0)},p(s,[a]){o===(o=l(s))&&i?i.p(s,a):(i.d(1),i=o(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Q,o:Q,d(s){s&&y(e),i.d(s),n=!1,t()}}}function Vu(r,e,n){let t;X(r,_r,g=>n(1,t=g));let{map:l}=e,{maptilerBasemap:o}=e,i="google",s=[];function a(){te(_r,t=!1,t),l.on("click",u),l.getCanvas().style.cursor="crosshair";for(let g of Ju(l,o))s.push([g,l.getPaintProperty(g,"line-color")]),l.setPaintProperty(g,"line-color","cyan")}function f(){te(_r,t=!0,t),l.off("click",u),l.getCanvas().style.cursor="inherit";for(let[g,v]of s)l.setPaintProperty(g,"line-color",v);s=[]}Tt(f);function u(g){let v=g.lngLat.lng,h=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${h},${v}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${h}~${v}&style=x`,"_blank")}function c(g){!t&&g.key=="Escape"&&(g.stopPropagation(),f())}const _=[[]];function d(){i=this.__value,n(0,i)}function m(){i=this.__value,n(0,i)}return r.$$set=g=>{"map"in g&&n(5,l=g.map),"maptilerBasemap"in g&&n(6,o=g.maptilerBasemap)},[i,t,a,f,c,l,o,d,_,m]}class Qu extends ie{constructor(e){super(),se(this,e,Vu,Xu,le,{map:5,maptilerBasemap:6})}}function we(r,e=!0){return{id:r,beforeId:xu(r),eventsIfTopMost:e}}function xu(r){let e=Wt(xt);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let n,t=!1;for(let l=fo.length-1;l>=0;l--){let o=fo[l];if(o==r){t=!0;break}e.getLayer(o)&&(n=o)}if(!t)throw new Error(`Layer ID ${r} not defined in layerZorder`);return n}let Wr=r=>r,qr=r=>r;const fo=[Wr(qr("Background")),"neighbourhood-boundaries","neighbourhood-prioritization-simd","neighbourhood-prioritization-area",Wr("Ferry line"),"neighbourhood-boundaries-outline","debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",qr("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-gp-practices","context-hospitals","context-schools","context-railway-stations","context-stats19",qr("Road labels"),Wr("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function fn(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function _n(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function mn(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),n=Math.round(r-e*60);return`${e}m${n}s`}function rl(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function an(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function uo(r){return r.reduce((e,n)=>e+n,0)}function co(r){let e,n;return e=new zt({props:{$$slots:{default:[ec]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function ec(r){let e;return{c(){e=k("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
      according to OpenStreetMap.`},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function tc(r){let e,n;const t=[we("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":fn(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i&1?Ne(t,[t[0],t[1],t[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function nc(r){let e,n,t,l,o,i,s,a=r[0]&&co(r);return l=new tr({props:{url:`pmtiles://${wt("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[tc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Bus routes",n=M(),a&&a.c(),t=M(),F(l.$$.fragment),N(e,"class","secondary")},m(f,u){$(f,e,u),$(f,n,u),a&&a.m(f,u),$(f,t,u),P(l,f,u),o=!0,i||(s=K(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&b(a,1):(a=co(f),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u&5&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(b(a),b(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&(y(e),y(n),y(t)),a&&a.d(f),I(l,f),i=!1,s()}}}function rc(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class lc extends ie{constructor(e){super(),se(this,e,rc,nc,le,{})}}function oc(r){let e,n;return{c(){e=Jt("svg"),n=Jt("path"),N(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),N(e,"viewBox","0 0 14 14"),N(e,"width","13"),N(e,"height","13"),N(e,"class","svelte-en2qvf")},m(t,l){$(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&y(e)}}}class $s extends ie{constructor(e){super(),se(this,e,null,oc,le,{})}}function ic(r){let e,n;return{c(){e=Jt("svg"),n=Jt("path"),N(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),N(e,"viewBox","0 0 30 30"),N(e,"fill","none"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"class","svelte-d2loi5")},m(t,l){$(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&y(e)}}}class ys extends ie{constructor(e){super(),se(this,e,null,ic,le,{})}}function sc(r){let e,n;return{c(){e=k("img"),Ve(e.src,n=r[3]+"area.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){$(t,e,l)},p(t,l){l&8&&!Ve(e.src,n=t[3]+"area.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&y(e)}}}function ac(r){let e,n;return{c(){e=k("img"),Ve(e.src,n=r[3]+"reverse.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){$(t,e,l)},p(t,l){l&8&&!Ve(e.src,n=t[3]+"reverse.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&y(e)}}}function fc(r){let e,n;return{c(){e=k("img"),Ve(e.src,n=r[3]+"poi.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){$(t,e,l)},p(t,l){l&8&&!Ve(e.src,n=t[3]+"poi.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&y(e)}}}function uc(r){let e,n;return{c(){e=k("img"),Ve(e.src,n=r[3]+"postal_code.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){$(t,e,l)},p(t,l){l&8&&!Ve(e.src,n=t[3]+"postal_code.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&y(e)}}}function cc(r){let e,n;return{c(){e=k("img"),Ve(e.src,n=r[3]+"street.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){$(t,e,l)},p(t,l){l&8&&!Ve(e.src,n=t[3]+"street.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&y(e)}}}function dc(r){let e,n;return{c(){e=k("img"),Ve(e.src,n=r[3]+"road.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){$(t,e,l)},p(t,l){l&8&&!Ve(e.src,n=t[3]+"road.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&y(e)}}}function _c(r){let e,n;return{c(){e=k("img"),Ve(e.src,n=r[3]+"housenumber.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){$(t,e,l)},p(t,l){l&8&&!Ve(e.src,n=t[3]+"housenumber.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&y(e)}}}function mc(r){let e,n,t,l;return{c(){e=k("img"),Ve(e.src,n=r[5])||N(e,"src",n),N(e,"alt",r[4]),N(e,"class","svelte-ltkwvy")},m(o,i){$(o,e,i),t||(l=K(e,"error",r[14]),t=!0)},p(o,i){i&32&&!Ve(e.src,n=o[5])&&N(e,"src",n),i&16&&N(e,"alt",o[4])},d(o){o&&y(e),t=!1,l()}}}function _o(r){let e,n;return{c(){e=k("span"),n=j(r[6]),N(e,"class","secondary svelte-ltkwvy")},m(t,l){$(t,e,l),p(e,n)},p(t,l){l&64&&ne(n,t[6])},d(t){t&&y(e)}}}function pc(r){let e,n,t,l,o,i,s,a,f,u=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],m,g,v=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",h,w,C;function L(z,O){return O&1&&(n=null),O&1&&(t=null),O&1&&(l=null),O&1&&(o=null),z[5]?mc:z[0].address?_c:(n==null&&(n=!!z[0].id.startsWith("road.")),n?dc:(t==null&&(t=!!z[0].id.startsWith("address.")),t?cc:(l==null&&(l=!!z[0].id.startsWith("postal_code.")),l?uc:(o==null&&(o=!!z[0].id.startsWith("poi.")),o?fc:z[7]?ac:sc))))}let E=L(r,-1),T=E(r),A=d&&_o(r);return{c(){e=k("li"),T.c(),i=M(),s=k("span"),a=k("span"),f=k("span"),c=j(u),_=M(),A&&A.c(),m=M(),g=k("span"),h=j(v),N(f,"class","primary svelte-ltkwvy"),N(a,"class","svelte-ltkwvy"),N(g,"class","line2 svelte-ltkwvy"),N(s,"class","texts svelte-ltkwvy"),N(e,"tabindex","0"),N(e,"data-selected",r[1]),N(e,"class","svelte-ltkwvy"),gt(e,"selected",r[1])},m(z,O){$(z,e,O),T.m(e,null),p(e,i),p(e,s),p(s,a),p(a,f),p(f,c),p(a,_),A&&A.m(a,null),p(s,m),p(s,g),p(g,h),w||(C=[K(e,"mouseenter",r[12]),K(e,"focus",r[13])],w=!0)},p(z,[O]){E===(E=L(z,O))&&T?T.p(z,O):(T.d(1),T=E(z),T&&(T.c(),T.m(e,i))),O&1&&u!==(u=(z[7]?z[0].place_name:z[0].place_name.replace(/,.*/,""))+"")&&ne(c,u),O&37&&(d=z[2]==="always"||z[2]!=="never"&&!z[0].address&&!z[0].id.startsWith("road.")&&!z[0].id.startsWith("address.")&&!z[0].id.startsWith("postal_code.")&&(!z[0].id.startsWith("poi.")||!z[5])&&!z[7]),d?A?A.p(z,O):(A=_o(z),A.c(),A.m(a,null)):A&&(A.d(1),A=null),O&1&&v!==(v=(z[7]?"":z[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&ne(h,v),O&2&&N(e,"data-selected",z[1]),O&2&&gt(e,"selected",z[1])},i:Q,o:Q,d(z){z&&y(e),T.d(),A&&A.d(),w=!1,nt(C)}}}function gc(r,e,n){var C;let t,l,{feature:o}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:f}=e;const u=(C=o.properties)==null?void 0:C.categories;let c,_,d=0,m=o.place_type[0]==="reverse";function g(){_&&a.add(_),n(10,d++,d)}function v(L){ze.call(this,r,L)}function h(L){ze.call(this,r,L)}const w=()=>g();return r.$$set=L=>{"feature"in L&&n(0,o=L.feature),"selected"in L&&n(1,i=L.selected),"showPlaceType"in L&&n(2,s=L.showPlaceType),"missingIconsCache"in L&&n(9,a=L.missingIconsCache),"iconsBaseUrl"in L&&n(3,f=L.iconsBaseUrl)},r.$$.update=()=>{var L,E,T,A;if(r.$$.dirty&3640)do n(11,t--,t),n(4,c=u==null?void 0:u[t]),n(5,_=c?f+c.replace(/ /g,"_")+".svg":void 0);while(t>-1&&(!_||a.has(_)));r.$$.dirty&1&&n(6,l=((E=(L=o.properties)==null?void 0:L.categories)==null?void 0:E.join(", "))??((A=(T=o.properties)==null?void 0:T.place_type_name)==null?void 0:A[0])??o.place_type[0])},n(11,t=(u==null?void 0:u.length)??0),[o,i,s,f,c,_,l,m,g,a,d,t,v,h,w]}class hc extends ie{constructor(e){super(),se(this,e,gc,pc,le,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function bc(r){let e;return{c(){e=k("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',N(e,"class","svelte-7cmwmc")},m(n,t){$(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&y(e)}}}class $c extends ie{constructor(e){super(),se(this,e,null,bc,le,{})}}function yc(r){let e,n;return{c(){e=Jt("svg"),n=Jt("path"),N(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),N(e,"viewBox","0 0 60.006 21.412"),N(e,"width","14"),N(e,"height","20"),N(e,"class","svelte-en2qvf")},m(t,l){$(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&y(e)}}}class vc extends ie{constructor(e){super(),se(this,e,null,yc,le,{})}}function wc(r){let e,n,t;return{c(){e=Jt("svg"),n=Jt("circle"),t=Jt("path"),N(n,"cx","4.789"),N(n,"cy","4.787"),N(n,"r","3.85"),N(n,"class","svelte-1aq105l"),N(t,"d","M12.063 12.063 7.635 7.635"),N(t,"class","svelte-1aq105l"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"width","13"),N(e,"height","13"),N(e,"viewBox","0 0 13 13"),N(e,"class","svelte-1aq105l")},m(l,o){$(l,e,o),p(e,n),p(e,t)},p:Q,i:Q,o:Q,d(l){l&&y(e)}}}class kc extends ie{constructor(e){super(),se(this,e,null,wc,le,{})}}function Sc(r,e,n){const t=e[1],l=e[0],o=t-l;return r===t&&n?r:((r-l)%o+o)%o+l}function mo(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Nn;async function Cc(r,e,n){const t=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(t&&(l.minZoom!=null&&l.minZoom>t[0]||l.maxZoom!=null&&l.maxZoom<t[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Nn&&l.cachedLocationExpiry&&Nn.time+l.cachedLocationExpiry>Date.now()){if(!Nn.coords)break e;return Nn.coords}let o;try{return o=await new Promise((i,s)=>{n.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(f=>f.toFixed(6)).join(","))},a=>{s(a)},l)}),o}catch{}finally{l.cachedLocationExpiry&&(Nn={time:Date.now(),coords:o})}if(n.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(t&&l.type==="map-center")return t[1].toFixed(6)+","+t[2].toFixed(6)}}function po(r,e,n){const t=r.slice();return t[84]=e[n],t[86]=n,t}function go(r){let e,n;return e=new $c({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function ho(r){let e,n,t,l,o;return n=new vc({}),{c(){e=k("button"),F(n.$$.fragment),N(e,"type","button"),N(e,"title",r[9]),N(e,"class","svelte-bz0zu3"),gt(e,"active",r[0])},m(i,s){$(i,e,s),P(n,e,null),t=!0,l||(o=K(e,"click",r[69]),l=!0)},p(i,s){(!t||s[0]&512)&&N(e,"title",i[9]),(!t||s[0]&1)&&gt(e,"active",i[0])},i(i){t||(b(n.$$.fragment,i),t=!0)},o(i){S(n.$$.fragment,i),t=!1},d(i){i&&y(e),I(n),l=!1,o()}}}function Lc(r){let e,n=[],t=new Map,l,o,i,s=Me(r[14]);const a=f=>f[84].id+(f[84].address?","+f[84].address:"");for(let f=0;f<s.length;f+=1){let u=po(r,s,f),c=a(u);t.set(c,n[f]=bo(c,u))}return{c(){e=k("ul");for(let f=0;f<n.length;f+=1)n[f].c();N(e,"class","options svelte-bz0zu3")},m(f,u){$(f,e,u);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);l=!0,o||(i=[K(e,"mouseleave",r[73]),K(e,"blur",r[74])],o=!0)},p(f,u){u[0]&17880064&&(s=Me(f[14]),he(),n=_a(n,u,a,1,f,s,t,e,ma,bo,null,po),be())},i(f){if(!l){for(let u=0;u<s.length;u+=1)b(n[u]);l=!0}},o(f){for(let u=0;u<n.length;u+=1)S(n[u]);l=!1},d(f){f&&y(e);for(let u=0;u<n.length;u+=1)n[u].d();o=!1,nt(i)}}}function Mc(r){let e,n,t,l,o,i;return n=new ys({}),{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("div"),o=j(r[7]),N(l,"class","svelte-bz0zu3"),N(e,"class","no-results svelte-bz0zu3")},m(s,a){$(s,e,a),P(n,e,null),p(e,t),p(e,l),p(l,o),i=!0},p(s,a){(!i||a[0]&128)&&ne(o,s[7])},i(s){i||(b(n.$$.fragment,s),i=!0)},o(s){S(n.$$.fragment,s),i=!1},d(s){s&&y(e),I(n)}}}function Tc(r){let e="",n;return{c(){n=j(e)},m(t,l){$(t,n,l)},p:Q,i:Q,o:Q,d(t){t&&y(n)}}}function Ac(r){let e,n,t,l,o,i,s,a,f,u,c;return n=new ys({}),a=new $s({}),{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("div"),o=j(r[6]),i=M(),s=k("button"),F(a.$$.fragment),N(l,"class","svelte-bz0zu3"),N(s,"class","svelte-bz0zu3"),N(e,"class","error svelte-bz0zu3")},m(_,d){$(_,e,d),P(n,e,null),p(e,t),p(e,l),p(l,o),p(e,i),p(e,s),P(a,s,null),f=!0,u||(c=K(s,"click",r[70]),u=!0)},p(_,d){(!f||d[0]&64)&&ne(o,_[6])},i(_){f||(b(n.$$.fragment,_),b(a.$$.fragment,_),f=!0)},o(_){S(n.$$.fragment,_),S(a.$$.fragment,_),f=!1},d(_){_&&y(e),I(n),I(a),u=!1,c()}}}function bo(r,e){let n,t,l;function o(){return e[71](e[86])}function i(){return e[72](e[84])}return t=new hc({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),t.$on("mouseenter",o),t.$on("focus",i),{key:r,first:null,c(){n=Ye(),F(t.$$.fragment),this.first=n},m(s,a){$(s,n,a),P(t,s,a),l=!0},p(s,a){e=s;const f={};a[0]&16384&&(f.feature=e[84]),a[0]&1024&&(f.showPlaceType=e[10]),a[0]&49152&&(f.selected=e[15]===e[86]),a[0]&4096&&(f.iconsBaseUrl=e[12]),t.$set(f)},i(s){l||(b(t.$$.fragment,s),l=!0)},o(s){S(t.$$.fragment,s),l=!1},d(s){s&&y(n),I(t,s)}}}function Fc(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v,h,w,C,L,E,T=!1;o=new kc({}),c=new $s({});let A=r[19]&&go(),z=r[5]==="button"&&ho(r);const O=r[61].default,U=De(O,r,r[60],null),R=[Ac,Tc,Mc,Lc],B=[];function H(G,Z){var Y,ae;return G[18]?0:G[16]?((Y=G[14])==null?void 0:Y.length)===0?2:G[16]&&((ae=G[14])!=null&&ae.length)?3:-1:1}return~(v=H(r))&&(h=B[v]=R[v](r)),{c(){e=M(),n=k("form"),t=k("div"),l=k("button"),F(o.$$.fragment),i=M(),s=k("input"),a=M(),f=k("div"),u=k("button"),F(c.$$.fragment),_=M(),A&&A.c(),d=M(),z&&z.c(),m=M(),U&&U.c(),g=M(),h&&h.c(),N(l,"class","search-button svelte-bz0zu3"),N(l,"type","button"),N(s,"placeholder",r[8]),N(s,"aria-label",r[8]),N(s,"class","svelte-bz0zu3"),N(u,"type","button"),N(u,"title",r[3]),N(u,"class","svelte-bz0zu3"),N(f,"class","clear-button-container svelte-bz0zu3"),gt(f,"displayable",r[1]!==""),N(t,"class","input-group svelte-bz0zu3"),N(n,"tabindex","0"),N(n,"class",w=Al(r[2])+" svelte-bz0zu3"),gt(n,"can-collapse",r[4]&&r[1]==="")},m(G,Z){$(G,e,Z),$(G,n,Z),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),r[63](s),Oe(s,r[1]),p(t,a),p(t,f),p(f,u),P(c,u,null),p(f,_),A&&A.m(f,null),p(t,d),z&&z.m(t,null),p(t,m),U&&U.m(t,null),p(n,g),~v&&B[v].m(n,null),C=!0,L||(E=[K(l,"click",r[62]),K(s,"input",r[64]),K(s,"focus",r[65]),K(s,"blur",r[66]),K(s,"keydown",r[22]),K(s,"input",r[67]),K(u,"click",r[68]),K(n,"submit",Xi(r[21]))],L=!0)},p(G,Z){(!C||Z[0]&256)&&N(s,"placeholder",G[8]),(!C||Z[0]&256)&&N(s,"aria-label",G[8]),Z[0]&2&&s.value!==G[1]&&Oe(s,G[1]),(!C||Z[0]&8)&&N(u,"title",G[3]),G[19]?A?Z[0]&524288&&b(A,1):(A=go(),A.c(),b(A,1),A.m(f,null)):A&&(he(),S(A,1,1,()=>{A=null}),be()),(!C||Z[0]&2)&&gt(f,"displayable",G[1]!==""),G[5]==="button"?z?(z.p(G,Z),Z[0]&32&&b(z,1)):(z=ho(G),z.c(),b(z,1),z.m(t,m)):z&&(he(),S(z,1,1,()=>{z=null}),be()),U&&U.p&&(!C||Z[1]&536870912)&&Ue(U,O,G,G[60],C?Ge(O,G[60],Z,null):He(G[60]),null);let Y=v;v=H(G),v===Y?~v&&B[v].p(G,Z):(h&&(he(),S(B[Y],1,1,()=>{B[Y]=null}),be()),~v?(h=B[v],h?h.p(G,Z):(h=B[v]=R[v](G),h.c()),b(h,1),h.m(n,null)):h=null),(!C||Z[0]&4&&w!==(w=Al(G[2])+" svelte-bz0zu3"))&&N(n,"class",w),(!C||Z[0]&22)&&gt(n,"can-collapse",G[4]&&G[1]==="")},i(G){C||(b(T),b(o.$$.fragment,G),b(c.$$.fragment,G),b(A),b(z),b(U,G),b(h),C=!0)},o(G){S(T),S(o.$$.fragment,G),S(c.$$.fragment,G),S(A),S(z),S(U,G),S(h),C=!1},d(G){G&&(y(e),y(n)),I(o),r[63](null),I(c),A&&A.d(),z&&z.d(),U&&U.d(G),~v&&B[v].d(),L=!1,nt(E)}}}function Pc(r,e,n){let t,l,{$$slots:o={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:f}=e,{bbox:u=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:m=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:v="never"}=e,{errorMessage:h="Something went wrong…"}=e,{filter:w=()=>!0}=e,{flyTo:C=!0}=e,{fuzzyMatch:L=!0}=e,{language:E=void 0}=e,{limit:T=void 0}=e,{mapController:A=void 0}=e,{minLength:z=2}=e,{noResultsMessage:O="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:U="Search"}=e,{proximity:R=[{type:"server-geolocation"}]}=e,{reverseActive:B=v==="always"}=e,{reverseButtonTitle:H="toggle reverse geocoding"}=e,{searchValue:G=""}=e,{pickedResultStyle:Z="full-geometry"}=e,{showPlaceType:Y="if-needed"}=e,{showResultsWhileTyping:ae=!0}=e,{selectFirst:D=!0}=e,{flyToSelected:ye=!1}=e,{markerOnSelected:ge=!0}=e,{types:fe=void 0}=e,{exhaustiveReverseGeocoding:ve=!1}=e,{excludeTypes:ue=!1}=e,{zoom:Fe=s}=e,{apiUrl:Ze="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Te={}}=e,{iconsBaseUrl:re="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Je=()=>{}}=e;function je(){Re.focus()}function ke(){Re.blur()}function V(J,tt=!0,ht=!1){n(1,G=J),tt?(n(15,We=-1),Pt()):(zr(!ht,ht),setTimeout(()=>{Re.focus(),Re.select()}))}function me(){n(14,$e=void 0),n(56,q=void 0),n(15,We=-1)}function x(){n(55,Se=[]),n(56,q=void 0)}let pe=!1,$e,Se,q,_t="",Re,We=-1,St,bt=[],Qe,en,tn,Ct;const ir=new Set,Ft=pn();Tt(()=>{A&&(A.setEventHandler(void 0),A.indicateReverse(!1),A.setSelectedMarker(-1),A.setFeatures(void 0,void 0,!1))});function Pt(J){if(en&&(clearTimeout(en),en=void 0),We>-1&&$e)n(56,q=$e[We]),n(1,G=q.place_type[0]==="reverse"?q.place_name:q.place_name.replace(/,.*/,"")),n(18,St=void 0),n(55,Se=void 0),n(15,We=-1);else if(G){const tt=J||!rt(G);Pe(G,{exact:!0}).then(()=>{n(55,Se=$e),n(56,q=void 0),tt&&lt()}).catch(ht=>n(18,St=ht))}}function rt(J){try{return da(J,6)}catch{return!1}}async function Pe(J,{byId:tt=!1,exact:ht=!1}={}){n(18,St=void 0),Qe==null||Qe.abort();const It=new AbortController;n(19,Qe=It);try{const Ie=rt(J),mt=new URLSearchParams;if(E!==void 0&&mt.set("language",Array.isArray(E)?E.join(","):E??""),fe&&mt.set("types",fe.join(",")),ue&&mt.set("excludeTypes",String(ue)),u&&mt.set("bbox",u.map(sr=>sr.toFixed(6)).join(",")),m&&mt.set("country",Array.isArray(m)?m.join(","):m),!tt&&!Ie){const sr=await Cc(A,R,It);sr&&mt.set("proximity",sr),(ht||!ae)&&mt.set("autocomplete","false"),mt.set("fuzzyMatch",String(L))}T!==void 0&&(ve||!Ie||(fe==null?void 0:fe.length)===1)&&mt.set("limit",String(T)),mt.set("key",f),Je(mt);const Kt=Ze+"/"+encodeURIComponent(Ie?Ie.decimalLongitude+","+Ie.decimalLatitude:J)+".json?"+mt.toString();if(Kt===_t){tt?(n(14,$e=void 0),n(56,q=bt[0])):n(14,$e=bt);return}_t=Kt;const Br=await fetch(Kt,{signal:It.signal,...Te});if(!Br.ok)throw new Error(await Br.text());const Rr=await Br.json();Ft("response",{url:Kt,featureCollection:Rr}),tt?(n(14,$e=void 0),n(56,q=Rr.features[0]),bt=[q]):(n(14,$e=Rr.features.filter(w)),Ie&&$e.unshift({type:"Feature",properties:{},id:"reverse_"+Ie.decimalLongitude+"_"+Ie.decimalLatitude,text:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_name:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_type:["reverse"],center:[Ie.decimalLongitude,Ie.decimalLatitude],bbox:[Ie.decimalLongitude,Ie.decimalLatitude,Ie.decimalLongitude,Ie.decimalLatitude],geometry:{type:"Point",coordinates:[Ie.decimalLongitude,Ie.decimalLatitude]}}),bt=$e,Ie&&Re.focus())}catch(Ie){if(Ie&&typeof Ie=="object"&&"name"in Ie&&Ie.name==="AbortError")return;throw Ie}finally{It===Qe&&n(19,Qe=void 0)}}function lt(){var It;if(!(Se!=null&&Se.length)||!C)return;const J=[180,90,-180,-90],tt=!Se.some(Ie=>!Ie.matching_text);let ht;for(const Ie of Se){const mt=In(Ie);if(ht=ht===void 0?mt:mt===void 0?ht:Math.max(ht,mt),tt||!Ie.matching_text)for(const Kt of[0,1,2,3])J[Kt]=Math[Kt<2?"min":"max"](J[Kt],((It=Ie.bbox)==null?void 0:It[Kt])??Ie.center[Kt%2])}A&&Se.length>0&&(q&&J[0]===J[2]&&J[1]===J[3]?A.flyTo(q.center,In(q)):A.fitBounds(mo(J),50,ht))}function In(J){var ht;if(!J.bbox||J.bbox[0]!==J.bbox[2]&&J.bbox[1]!==J.bbox[3])return;const tt=J.id.replace(/\..*/,"");return(Array.isArray((ht=J.properties)==null?void 0:ht.categories)?J.properties.categories.reduce((It,Ie)=>{const mt=Fe[tt+"."+Ie];return It===void 0?mt:mt===void 0?It:Math.max(It,mt)},void 0):void 0)??Fe[tt]}function Rs(J){n(0,B=v==="always"),n(14,$e=void 0),n(56,q=void 0),n(15,We=-1),V(J[1].toFixed(6)+", "+Sc(J[0],[-180,180],!0).toFixed(6),!1,!0)}function Ds(J){if(!$e)return;let tt=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;tt&&(We===(D?0:-1)&&tt===-1&&n(15,We=$e.length),n(15,We+=tt),We>=$e.length&&n(15,We=-1),We<0&&D&&n(15,We=0),J.preventDefault())}function zr(J=!0,tt=!1){if(n(18,St=void 0),ae||tt){if(en&&clearTimeout(en),G.length<z)return;const ht=G;en=window.setTimeout(()=>{Pe(ht).catch(It=>n(18,St=It))},J?g:0)}else n(14,$e=void 0),n(18,St=void 0)}function Or(J){n(56,q=J),n(1,G=J.place_name),n(15,We=-1)}const Us=()=>Re.focus();function Hs(J){Be[J?"unshift":"push"](()=>{Re=J,n(17,Re)})}function Gs(){G=this.value,n(1,G),n(13,pe),n(28,_)}const Ws=()=>n(13,pe=!0),qs=()=>n(13,pe=!1),Js=()=>zr(),Ys=()=>{n(1,G=""),Re.focus()},Zs=()=>n(0,B=!B),Ks=()=>n(18,St=void 0),Xs=J=>n(15,We=J),Vs=J=>Or(J),Qs=()=>{D||n(15,We=-1)},xs=()=>{};return r.$$set=J=>{"class"in J&&n(2,a=J.class),"apiKey"in J&&n(26,f=J.apiKey),"bbox"in J&&n(27,u=J.bbox),"clearButtonTitle"in J&&n(3,c=J.clearButtonTitle),"clearOnBlur"in J&&n(28,_=J.clearOnBlur),"collapsed"in J&&n(4,d=J.collapsed),"country"in J&&n(29,m=J.country),"debounceSearch"in J&&n(30,g=J.debounceSearch),"enableReverse"in J&&n(5,v=J.enableReverse),"errorMessage"in J&&n(6,h=J.errorMessage),"filter"in J&&n(31,w=J.filter),"flyTo"in J&&n(32,C=J.flyTo),"fuzzyMatch"in J&&n(33,L=J.fuzzyMatch),"language"in J&&n(34,E=J.language),"limit"in J&&n(35,T=J.limit),"mapController"in J&&n(36,A=J.mapController),"minLength"in J&&n(37,z=J.minLength),"noResultsMessage"in J&&n(7,O=J.noResultsMessage),"placeholder"in J&&n(8,U=J.placeholder),"proximity"in J&&n(38,R=J.proximity),"reverseActive"in J&&n(0,B=J.reverseActive),"reverseButtonTitle"in J&&n(9,H=J.reverseButtonTitle),"searchValue"in J&&n(1,G=J.searchValue),"pickedResultStyle"in J&&n(39,Z=J.pickedResultStyle),"showPlaceType"in J&&n(10,Y=J.showPlaceType),"showResultsWhileTyping"in J&&n(40,ae=J.showResultsWhileTyping),"selectFirst"in J&&n(11,D=J.selectFirst),"flyToSelected"in J&&n(41,ye=J.flyToSelected),"markerOnSelected"in J&&n(42,ge=J.markerOnSelected),"types"in J&&n(43,fe=J.types),"exhaustiveReverseGeocoding"in J&&n(44,ve=J.exhaustiveReverseGeocoding),"excludeTypes"in J&&n(45,ue=J.excludeTypes),"zoom"in J&&n(46,Fe=J.zoom),"apiUrl"in J&&n(47,Ze=J.apiUrl),"fetchParameters"in J&&n(48,Te=J.fetchParameters),"iconsBaseUrl"in J&&n(12,re=J.iconsBaseUrl),"adjustUrlQuery"in J&&n(49,Je=J.adjustUrlQuery),"$$scope"in J&&n(60,i=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&n(0,B=v==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{n(16,tn=pe),_&&!pe&&n(1,G="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&G.length<z&&(n(56,q=void 0),n(14,$e=void 0),n(18,St=void 0),n(55,Se=$e)),r.$$.dirty[1]&33554688&&Z!=="marker-only"&&q&&!q.address&&q.geometry.type==="Point"&&q.place_type[0]!=="reverse"&&Pe(q.id,{byId:!0}).catch(J=>n(18,St=J)),r.$$.dirty[1]&100663330&&(A&&q&&q.id!==Ct&&C&&(!q.bbox||q.bbox[0]===q.bbox[2]&&q.bbox[1]===q.bbox[3]?A.flyTo(q.center,In(q)):A.fitBounds(mo(q.bbox),50,In(q)),n(14,$e=void 0),n(55,Se=void 0),n(15,We=-1)),n(57,Ct=q==null?void 0:q.id)),r.$$.dirty[0]&18432&&D&&$e!=null&&$e.length&&n(15,We=0),r.$$.dirty[0]&2&&n(15,We=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Se!==$e&&n(55,Se=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&A&&A.setEventHandler(J=>{switch(J.type){case"mapClick":B&&Rs(J.coordinates);break;case"markerClick":{const tt=$e==null?void 0:$e.find(ht=>ht.id===J.id);tt&&Or(tt)}break;case"markerMouseEnter":Se&&n(15,We=tn?($e==null?void 0:$e.findIndex(tt=>tt.id===J.id))??-1:-1);break;case"markerMouseLeave":Se&&n(15,We=-1);break}}),r.$$.dirty[0]&49152&&n(58,l=$e==null?void 0:$e[We]),r.$$.dirty[1]&134218786&&A&&l&&C&&ye&&A.flyTo(l.center,In(l)),r.$$.dirty[1]&256&&n(59,t=Z==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ge||A==null||A.setFeatures(void 0,void 0,t)),r.$$.dirty[1]&419432480&&A&&ge&&!Se&&(A.setFeatures(l?[l]:void 0,void 0,t),A.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&A&&A.setFeatures(Se,q,t),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Se&&A&&A.setSelectedMarker(We),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&A){const J=rt(G);A.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Ft("select",{feature:l}),r.$$.dirty[1]&33554432&&Ft("pick",{feature:q}),r.$$.dirty[0]&81920&&Ft("optionsvisibilitychange",{optionsVisible:tn&&!!$e}),r.$$.dirty[0]&16384&&Ft("featureslisted",{features:$e}),r.$$.dirty[1]&16777216&&Ft("featuresmarked",{features:Se}),r.$$.dirty[0]&1&&Ft("reversetoggle",{reverse:B}),r.$$.dirty[0]&2&&Ft("querychange",{query:G}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&A&&A.indicateReverse(B)},[B,G,a,c,d,v,h,O,U,H,Y,D,re,pe,$e,We,tn,Re,St,Qe,ir,Pt,Ds,zr,Or,s,f,u,_,m,g,w,C,L,E,T,A,z,R,Z,ae,ye,ge,fe,ve,ue,Fe,Ze,Te,Je,je,ke,V,me,x,Se,q,Ct,l,t,i,o,Us,Hs,Gs,Ws,qs,Js,Ys,Zs,Ks,Xs,Vs,Qs,xs]}class Ic extends ie{constructor(e){super(),se(this,e,Pc,Fc,le,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function $o(r){let e,n,t;return n=new Ic({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=k("div"),F(n.$$.fragment),N(e,"class","svelte-ixhnie")},m(l,o){$(l,e,o),P(n,e,null),t=!0},p(l,o){const i={};o&4&&(i.mapController=l[2]),o&1&&(i.apiKey=l[0]),o&2&&(i.country=l[1]),n.$set(i)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function Ec(r){let e,n,t=r[2]&&$o(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,[o]){l[2]?t?(t.p(l,o),o&4&&b(t,1)):(t=$o(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function Nc(r,e,n){let t,{apiKey:l}=e,{map:o}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(f){return f?pa(f,Vt,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=f=>{"apiKey"in f&&n(0,l=f.apiKey),"map"in f&&n(4,o=f.map),"country"in f&&n(1,i=f.country)},r.$$.update=()=>{r.$$.dirty&16&&n(2,t=a(o))},[l,i,t,s,o]}class jc extends ie{constructor(e){super(),se(this,e,Nc,Ec,le,{apiKey:0,map:4,country:1})}}function Gt(r,e,n){let t=["match",r];for(let[l,o]of Object.entries(e))t.push(l),t.push(o);return t.push(n),t}function jt(r,e,n){let t=["step",r];for(let l=1;l<e.length;l++)t.push(n[l-1]),t.push(e[l]);return t.push(n[n.length-1]),t}function Yt(){return{type:"FeatureCollection",features:[]}}function yo(r){let e,n,t,l,o;return n=new kn({props:{colorScale:r[3].colorScale,limits:r[3].limits}}),l=new zt({props:{$$slots:{default:[zc]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment)},m(i,s){$(i,e,s),P(n,e,null),p(e,t),P(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&y(e),I(n),I(l)}}}function zc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function vo(r){let e,n,t,l,o;return n=new Tr({props:{colors:r[4],horiz:!0}}),l=new zt({props:{$$slots:{default:[Oc]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment)},m(i,s){$(i,e,s),P(n,e,null),p(e,t),P(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&y(e),I(n),I(l)}}}function Oc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function wo(r){let e,n,t,l,o;return n=new Tr({props:{colors:r[5],horiz:!0}}),l=new zt({props:{$$slots:{default:[Bc]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment)},m(i,s){$(i,e,s),P(n,e,null),p(e,t),P(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&y(e),I(n),I(l)}}}function Bc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function Rc(r){let e,n,t,l,o,i;const s=[we("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Gt(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":fn(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new et({props:a});const f=[we("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Gt(["get","Level of Service"],r[4],"cyan"),"line-width":fn(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new et({props:u});const c=[we("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Gt(["get","Infrastructure type"],r[5],"cyan"),"line-width":fn(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return o=new et({props:_}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment)},m(d,m){P(e,d,m),$(d,n,m),P(t,d,m),$(d,l,m),P(o,d,m),i=!0},p(d,m){const g=m&9?Ne(s,[s[0],s[1],s[2],m&8&&{paint:{"line-color":Gt(["get","Traffic volume category"],{"0 to 1999":d[3].colorScale[0],"2000 to 3999":d[3].colorScale[1],"4000+":d[3].colorScale[2]},"cyan"),"line-width":fn(0)}},m&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};e.$set(g);const v=m&18?Ne(f,[f[0],f[1],m&16&&{paint:{"line-color":Gt(["get","Level of Service"],d[4],"cyan"),"line-width":fn(1)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};t.$set(v);const h=m&36?Ne(c,[c[0],c[1],c[2],m&32&&{paint:{"line-color":Gt(["get","Infrastructure type"],d[5],"cyan"),"line-width":fn(1)}},m&4&&{layout:{visibility:d[2]?"visible":"none"}}]):{};o.$set(h)},i(d){i||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(o.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),i=!1},d(d){d&&(y(n),y(l)),I(e,d),I(t,d),I(o,d)}}}function Dc(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m=r[0]&&yo(r),g=r[1]&&vo(r),v=r[2]&&wo(r);return u=new tr({props:{url:`pmtiles://${wt("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[Rc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Traffic",n=M(),m&&m.c(),t=M(),l=k("button"),l.textContent="Level of Service",o=M(),g&&g.c(),i=M(),s=k("button"),s.textContent="Existing cycle infrastructure",a=M(),v&&v.c(),f=M(),F(u.$$.fragment),N(e,"class","secondary"),N(l,"class","secondary"),N(s,"class","secondary")},m(h,w){$(h,e,w),$(h,n,w),m&&m.m(h,w),$(h,t,w),$(h,l,w),$(h,o,w),g&&g.m(h,w),$(h,i,w),$(h,s,w),$(h,a,w),v&&v.m(h,w),$(h,f,w),P(u,h,w),c=!0,_||(d=[K(e,"click",r[6]),K(l,"click",r[7]),K(s,"click",r[8])],_=!0)},p(h,[w]){h[0]?m?(m.p(h,w),w&1&&b(m,1)):(m=yo(h),m.c(),b(m,1),m.m(t.parentNode,t)):m&&(he(),S(m,1,1,()=>{m=null}),be()),h[1]?g?(g.p(h,w),w&2&&b(g,1)):(g=vo(h),g.c(),b(g,1),g.m(i.parentNode,i)):g&&(he(),S(g,1,1,()=>{g=null}),be()),h[2]?v?(v.p(h,w),w&4&&b(v,1)):(v=wo(h),v.c(),b(v,1),v.m(f.parentNode,f)):v&&(he(),S(v,1,1,()=>{v=null}),be());const C={};w&519&&(C.$$scope={dirty:w,ctx:h}),u.$set(C)},i(h){c||(b(m),b(g),b(v),b(u.$$.fragment,h),c=!0)},o(h){S(m),S(g),S(v),S(u.$$.fragment,h),c=!1},d(h){h&&(y(e),y(n),y(t),y(l),y(o),y(i),y(s),y(a),y(f)),m&&m.d(h),g&&g.d(h),v&&v.d(h),I(u,h),_=!1,nt(d)}}}function Uc(r,e,n){let t=!1,l=!1,o=!1;return[t,l,o,{colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},{High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"},()=>n(0,t=!t),()=>n(1,l=!l),()=>n(2,o=!o)]}class Hc extends ie{constructor(e){super(),se(this,e,Uc,Dc,le,{})}}function ko(r){let e,n,t,l,o;return n=new Tr({props:{colors:r[1],horiz:!0}}),l=new zt({props:{$$slots:{default:[Gc]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment)},m(i,s){$(i,e,s),P(n,e,null),p(e,t),P(l,e,null),o=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&y(e),I(n),I(l)}}}function Gc(r){let e;return{c(){e=k("p"),e.innerHTML=`See Scottish data sources for <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
        ,
        <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
        , and
        <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
        .`},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function Wc(r){let e=r[3].name+"",n;return{c(){n=j(e)},m(t,l){$(t,n,l)},p(t,l){l&8&&e!==(e=t[3].name+"")&&ne(n,e)},d(t){t&&y(n)}}}function qc(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Wc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Jc(r){let e,n;const t=[we("context-gp-practices"),{paint:{"circle-color":r[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[qc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i&3?Ne(t,[t[0],i&2&&{paint:{"circle-color":o[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Yc(r){let e=r[3].name+"",n;return{c(){n=j(e)},m(t,l){$(t,n,l)},p(t,l){l&8&&e!==(e=t[3].name+"")&&ne(n,e)},d(t){t&&y(n)}}}function Zc(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Yc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Kc(r){let e,n;const t=[we("context-hospitals"),{paint:{"circle-color":r[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Zc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i&3?Ne(t,[t[0],i&2&&{paint:{"circle-color":o[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Xc(r){let e=r[3].name+"",n,t,l=r[3].pupils+"",o,i;return{c(){n=j(e),t=j(" with "),o=j(l),i=j(" pupils")},m(s,a){$(s,n,a),$(s,t,a),$(s,o,a),$(s,i,a)},p(s,a){a&8&&e!==(e=s[3].name+"")&&ne(n,e),a&8&&l!==(l=s[3].pupils+"")&&ne(o,l)},d(s){s&&(y(n),y(t),y(o),y(i))}}}function Vc(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Xc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Qc(r){let e,n;const t=[we("context-schools"),{paint:{"circle-color":r[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Vc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i&3?Ne(t,[t[0],i&2&&{paint:{"circle-color":o[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function xc(r){let e,n,t,l,o,i,s,a,f,u,c,_=r[0]&&ko(r);return l=new Ke({props:{data:wt("cnt_layers/gp_practices.geojson"),generateId:!0,$$slots:{default:[Jc]},$$scope:{ctx:r}}}),i=new Ke({props:{data:wt("cnt_layers/hospitals.geojson"),generateId:!0,$$slots:{default:[Kc]},$$scope:{ctx:r}}}),a=new Ke({props:{data:wt("cnt_layers/schools.geojson"),generateId:!0,$$slots:{default:[Qc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="POIs",n=M(),_&&_.c(),t=M(),F(l.$$.fragment),o=M(),F(i.$$.fragment),s=M(),F(a.$$.fragment),N(e,"class","secondary")},m(d,m){$(d,e,m),$(d,n,m),_&&_.m(d,m),$(d,t,m),P(l,d,m),$(d,o,m),P(i,d,m),$(d,s,m),P(a,d,m),f=!0,u||(c=K(e,"click",r[2]),u=!0)},p(d,[m]){d[0]?_?(_.p(d,m),m&1&&b(_,1)):(_=ko(d),_.c(),b(_,1),_.m(t.parentNode,t)):_&&(he(),S(_,1,1,()=>{_=null}),be());const g={};m&17&&(g.$$scope={dirty:m,ctx:d}),l.$set(g);const v={};m&17&&(v.$$scope={dirty:m,ctx:d}),i.$set(v);const h={};m&17&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){f||(b(_),b(l.$$.fragment,d),b(i.$$.fragment,d),b(a.$$.fragment,d),f=!0)},o(d){S(_),S(l.$$.fragment,d),S(i.$$.fragment,d),S(a.$$.fragment,d),f=!1},d(d){d&&(y(e),y(n),y(t),y(o),y(s)),_&&_.d(d),I(l,d),I(i,d),I(a,d),u=!1,c()}}}function ed(r,e,n){let t=!1;return[t,{Schools:"#7fc97f",GPs:"#beaed4",Hospitals:"#fdc086"},()=>n(0,t=!t)]}class td extends ie{constructor(e){super(),se(this,e,ed,xc,le,{})}}let vs=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],ws=[20,30,40,50,60,70],ln=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],nr=[0,20,40,60,80,100];const $n={mapFeature:{hover:{backgroundColor:"blue"}}};let mr=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],Cl=[0,.3,.6,1,1.5,2];function So(r){let e,n,t,l,o,i;return e=new kn({props:{colorScale:ln,limits:nr}}),o=new zt({props:{$$slots:{default:[nd]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=M(),t=k("p"),t.textContent="Darker colours are more deprived",l=M(),F(o.$$.fragment)},m(s,a){P(e,s,a),$(s,n,a),$(s,t,a),$(s,l,a),P(o,s,a),i=!0},i(s){i||(b(e.$$.fragment,s),b(o.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(o.$$.fragment,s),i=!1},d(s){s&&(y(n),y(t),y(l)),I(e,s),I(o,s)}}}function nd(r){let e;return{c(){e=k("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      . SIMD combines different domains: income; employment; health; education, skills
      and training; geographic access to services; crime; and housing.`},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function Co(r){let e,n,t,l,o,i;return e=new kn({props:{colorScale:r[2],limits:r[3]}}),o=new zt({props:{$$slots:{default:[rd]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=M(),t=k("p"),t.textContent="Darker colours are denser",l=M(),F(o.$$.fragment)},m(s,a){P(e,s,a),$(s,n,a),$(s,t,a),$(s,l,a),P(o,s,a),i=!0},p(s,a){const f={};a&128&&(f.$$scope={dirty:a,ctx:s}),o.$set(f)},i(s){i||(b(e.$$.fragment,s),b(o.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(o.$$.fragment,s),i=!1},d(s){s&&(y(n),y(t),y(l)),I(e,s),I(o,s)}}}function rd(r){let e;return{c(){e=k("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      .`},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function ld(r){let e,n,t=r[6].id+"",l,o,i=r[6].population.toLocaleString()+"",s,a,f=r[6].imd_rank+"",u,c,_=r[6].imd_percentile+"",d,m;return{c(){e=k("p"),n=j("Data zone "),l=j(t),o=j(`
        has `),s=j(i),a=j(`
        people, and a SIMD rank of `),u=j(f),c=j(", putting it in the "),d=j(_),m=j(`
        percentile.`)},m(g,v){$(g,e,v),p(e,n),p(e,l),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c),p(e,d),p(e,m)},p(g,v){v&64&&t!==(t=g[6].id+"")&&ne(l,t),v&64&&i!==(i=g[6].population.toLocaleString()+"")&&ne(s,i),v&64&&f!==(f=g[6].imd_rank+"")&&ne(u,f),v&64&&_!==(_=g[6].imd_percentile+"")&&ne(d,_)},d(g){g&&y(e)}}}function od(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[ld,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function id(r){let e,n,t=r[6].id+"",l,o,i=r[6].population.toLocaleString()+"",s,a,f=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",u,c;return{c(){e=k("p"),n=j("Data zone "),l=j(t),o=j(`
        has `),s=j(i),a=j(`
        people, with a density of `),u=j(f),c=j(" people per square kilometer")},m(_,d){$(_,e,d),p(e,n),p(e,l),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c)},p(_,d){d&64&&t!==(t=_[6].id+"")&&ne(l,t),d&64&&i!==(i=_[6].population.toLocaleString()+"")&&ne(s,i),d&64&&f!==(f=Math.round(_[6].population/(_[6].area/1e6)).toLocaleString()+"")&&ne(u,f)},d(_){_&&y(e)}}}function sd(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[id,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function ad(r){let e,n,t,l,o,i;const s=[we("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":jt(["get","imd_percentile"],nr,ln),"fill-opacity":ut(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={$$slots:{default:[od]},$$scope:{ctx:r}};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new kt({props:a});const f=[we("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":jt(["/",["get","population"],["/",["get","area"],1e6]],r[3],r[2]),"fill-opacity":ut(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={$$slots:{default:[sd]},$$scope:{ctx:r}};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new kt({props:u});const c=[we("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return o=new et({props:_}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment)},m(d,m){P(e,d,m),$(d,n,m),P(t,d,m),$(d,l,m),P(o,d,m),i=!0},p(d,m){const g=m&1?Ne(s,[s[0],s[1],s[2],s[3],{layout:{visibility:d[0]?"visible":"none"}}]):{};m&128&&(g.$$scope={dirty:m,ctx:d}),e.$set(g);const v=m&14?Ne(f,[f[0],f[1],f[2],m&12&&{paint:{"fill-color":jt(["/",["get","population"],["/",["get","area"],1e6]],d[3],d[2]),"fill-opacity":ut(.7,.9)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};m&128&&(v.$$scope={dirty:m,ctx:d}),t.$set(v);const h=m&3?Ne(c,[c[0],c[1],c[2],{layout:{visibility:d[0]||d[1]?"visible":"none"}}]):{};o.$set(h)},i(d){i||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(o.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),i=!1},d(d){d&&(y(n),y(l)),I(e,d),I(t,d),I(o,d)}}}function fd(r){let e,n,t,l,o,i,s,a,f,u,c=r[0]&&So(r),_=r[1]&&Co(r);return s=new tr({props:{url:`pmtiles://${wt("cnt_layers/population.pmtiles")}`,$$slots:{default:[ad]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="SIMD",n=M(),c&&c.c(),t=M(),l=k("button"),l.textContent="Population density",o=M(),_&&_.c(),i=M(),F(s.$$.fragment),N(e,"class","secondary"),N(l,"class","secondary")},m(d,m){$(d,e,m),$(d,n,m),c&&c.m(d,m),$(d,t,m),$(d,l,m),$(d,o,m),_&&_.m(d,m),$(d,i,m),P(s,d,m),a=!0,f||(u=[K(e,"click",r[4]),K(l,"click",r[5])],f=!0)},p(d,[m]){d[0]?c?m&1&&b(c,1):(c=So(d),c.c(),b(c,1),c.m(t.parentNode,t)):c&&(he(),S(c,1,1,()=>{c=null}),be()),d[1]?_?(_.p(d,m),m&2&&b(_,1)):(_=Co(d),_.c(),b(_,1),_.m(i.parentNode,i)):_&&(he(),S(_,1,1,()=>{_=null}),be());const g={};m&131&&(g.$$scope={dirty:m,ctx:d}),s.$set(g)},i(d){a||(b(c),b(_),b(s.$$.fragment,d),a=!0)},o(d){S(c),S(_),S(s.$$.fragment,d),a=!1},d(d){d&&(y(e),y(n),y(t),y(l),y(o),y(i)),c&&c.d(d),_&&_.d(d),I(s,d),f=!1,nt(u)}}}function ud(r,e,n){let t=!1,l=!1,o=ln.toReversed();return[t,l,o,[0,4700,13e3,33e3,94e3,198e4],()=>n(0,t=!t),()=>n(1,l=!l)]}class cd extends ie{constructor(e){super(),se(this,e,ud,fd,le,{})}}function Lo(r){let e,n,t,l,o,i;return o=new zt({props:{$$slots:{default:[dd]},$$scope:{ctx:r}}}),{c(){e=k("div"),n=k("img"),l=M(),F(o.$$.fragment),Ve(n.src,t=es)||N(n,"src",t),N(n,"alt","National Rail logo")},m(s,a){$(s,e,a),p(e,n),p(e,l),P(o,e,null),i=!0},i(s){i||(b(o.$$.fragment,s),i=!0)},o(s){S(o.$$.fragment,s),i=!1},d(s){s&&y(e),I(o)}}}function dd(r){let e;return{c(){e=k("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
        according to OpenStreetMap.`},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function _d(r){let e,n=(r[2].name??"Unnamed railway station")+"",t;return{c(){e=k("p"),t=j(n)},m(l,o){$(l,e,o),p(e,t)},p(l,o){o&4&&n!==(n=(l[2].name??"Unnamed railway station")+"")&&ne(t,n)},d(l){l&&y(e)}}}function md(r){let e,n;return e=new dt({props:{$$slots:{default:[_d,({props:t})=>({2:t}),({props:t})=>t?4:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&12&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function pd(r){let e,n;const t=[we("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[md]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Vn({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i&1?Ne(t,[t[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function gd(r){let e,n,t,l,o,i,s,a=r[0]&&Lo(r);return l=new Ke({props:{data:wt("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[pd]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Railway stations",n=M(),a&&a.c(),t=M(),F(l.$$.fragment),N(e,"class","secondary")},m(f,u){$(f,e,u),$(f,n,u),a&&a.m(f,u),$(f,t,u),P(l,f,u),o=!0,i||(s=K(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&b(a,1):(a=Lo(f),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u&9&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(b(a),b(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&(y(e),y(n),y(t)),a&&a.d(f),I(l,f),i=!1,s()}}}function hd(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class bd extends ie{constructor(e){super(),se(this,e,hd,gd,le,{})}}function Mo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function To(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Ao(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Fo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Po(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Io(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Eo(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v,h,w,C,L;e=new zt({props:{$$slots:{default:[$d]},$$scope:{ctx:r}}});let E=Me(r[7]),T=[];for(let H=0;H<E.length;H+=1)T[H]=No(Io(r,E,H));let A=Me(r[8]),z=[];for(let H=0;H<A.length;H+=1)z[H]=jo(Po(r,A,H));let O=Me(r[9]),U=[];for(let H=0;H<O.length;H+=1)U[H]=zo(Fo(r,O,H));let R=Me(r[10]),B=[];for(let H=0;H<R.length;H+=1)B[H]=Oo(Ao(r,R,H));return{c(){F(e.$$.fragment),n=M(),t=k("label"),l=j(`Trip purpose:
    `),o=k("select");for(let H=0;H<T.length;H+=1)T[H].c();i=M(),s=k("label"),a=j(`Scenario:
    `),f=k("select");for(let H=0;H<z.length;H+=1)z[H].c();u=M(),c=k("label"),_=j(`Network type:
    `),d=k("select");for(let H=0;H<U.length;H+=1)U[H].c();m=M(),g=k("label"),v=j(`Color by:
    `),h=k("select");for(let H=0;H<B.length;H+=1)B[H].c();r[0]===void 0&&un(()=>r[12].call(o)),r[1]===void 0&&un(()=>r[13].call(f)),r[2]===void 0&&un(()=>r[14].call(d)),r[3]===void 0&&un(()=>r[15].call(h))},m(H,G){P(e,H,G),$(H,n,G),$(H,t,G),p(t,l),p(t,o);for(let Z=0;Z<T.length;Z+=1)T[Z]&&T[Z].m(o,null);vt(o,r[0],!0),$(H,i,G),$(H,s,G),p(s,a),p(s,f);for(let Z=0;Z<z.length;Z+=1)z[Z]&&z[Z].m(f,null);vt(f,r[1],!0),$(H,u,G),$(H,c,G),p(c,_),p(c,d);for(let Z=0;Z<U.length;Z+=1)U[Z]&&U[Z].m(d,null);vt(d,r[2],!0),$(H,m,G),$(H,g,G),p(g,v),p(g,h);for(let Z=0;Z<B.length;Z+=1)B[Z]&&B[Z].m(h,null);vt(h,r[3],!0),w=!0,C||(L=[K(o,"change",r[12]),K(f,"change",r[13]),K(d,"change",r[14]),K(h,"change",r[15])],C=!0)},p(H,G){const Z={};if(G[1]&2&&(Z.$$scope={dirty:G,ctx:H}),e.$set(Z),G[0]&128){E=Me(H[7]);let Y;for(Y=0;Y<E.length;Y+=1){const ae=Io(H,E,Y);T[Y]?T[Y].p(ae,G):(T[Y]=No(ae),T[Y].c(),T[Y].m(o,null))}for(;Y<T.length;Y+=1)T[Y].d(1);T.length=E.length}if(G[0]&129&&vt(o,H[0]),G[0]&256){A=Me(H[8]);let Y;for(Y=0;Y<A.length;Y+=1){const ae=Po(H,A,Y);z[Y]?z[Y].p(ae,G):(z[Y]=jo(ae),z[Y].c(),z[Y].m(f,null))}for(;Y<z.length;Y+=1)z[Y].d(1);z.length=A.length}if(G[0]&258&&vt(f,H[1]),G[0]&512){O=Me(H[9]);let Y;for(Y=0;Y<O.length;Y+=1){const ae=Fo(H,O,Y);U[Y]?U[Y].p(ae,G):(U[Y]=zo(ae),U[Y].c(),U[Y].m(d,null))}for(;Y<U.length;Y+=1)U[Y].d(1);U.length=O.length}if(G[0]&516&&vt(d,H[2]),G[0]&1024){R=Me(H[10]);let Y;for(Y=0;Y<R.length;Y+=1){const ae=Ao(H,R,Y);B[Y]?B[Y].p(ae,G):(B[Y]=Oo(ae),B[Y].c(),B[Y].m(h,null))}for(;Y<B.length;Y+=1)B[Y].d(1);B.length=R.length}G[0]&1032&&vt(h,H[3])},i(H){w||(b(e.$$.fragment,H),w=!0)},o(H){S(e.$$.fragment,H),w=!1},d(H){H&&(y(n),y(t),y(i),y(s),y(u),y(c),y(m),y(g)),I(e,H),ft(T,H),ft(z,H),ft(U,H),ft(B,H),C=!1,nt(L)}}}function $d(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#routenetwork"),N(e,"target","_blank")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function No(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],Oe(e,e.__value)},m(l,o){$(l,e,o),p(e,t)},p:Q,d(l){l&&y(e)}}}function jo(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],Oe(e,e.__value)},m(l,o){$(l,e,o),p(e,t)},p:Q,d(l){l&&y(e)}}}function zo(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],Oe(e,e.__value)},m(l,o){$(l,e,o),p(e,t)},p:Q,d(l){l&&y(e)}}}function Oo(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=j(n),e.__value=r[18],Oe(e,e.__value)},m(l,o){$(l,e,o),p(e,t)},p:Q,d(l){l&&y(e)}}}function Bo(r){let e,n,t,l,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=k("tr"),n=k("th"),n.textContent=`${r[19]}`,t=M(),l=k("td"),i=j(o),s=M(),a=k("td"),u=j(f),c=M(),_=k("td"),m=j(d),g=M()},m(v,h){$(v,e,h),p(e,n),p(e,t),p(e,l),p(l,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(v,h){h[0]&131072&&o!==(o=v[17][`${v[18]}_fastest_bicycle`].toLocaleString()+"")&&ne(i,o),h[0]&131072&&f!==(f=v[17][`${v[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&ne(u,f),h[0]&131072&&d!==(d=v[17][`${v[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&ne(m,d)},d(v){v&&y(e)}}}function Ro(r){let e,n,t,l,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=k("tr"),n=k("th"),n.textContent=`${r[19]}`,t=M(),l=k("td"),i=j(o),s=M(),a=k("td"),u=j(f),c=M(),_=k("td"),m=j(d),g=M()},m(v,h){$(v,e,h),p(e,n),p(e,t),p(e,l),p(l,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(v,h){h[0]&131072&&o!==(o=v[17][`${v[18]}_quietest_bicycle`].toLocaleString()+"")&&ne(i,o),h[0]&131072&&f!==(f=v[17][`${v[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&ne(u,f),h[0]&131072&&d!==(d=v[17][`${v[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&ne(m,d)},d(v){v&&y(e)}}}function yd(r){let e,n,t,l=r[17][r[4]].toLocaleString()+"",o,i,s,a,f=r[17].gradient+"",u,c,_,d,m,g=r[17].quietness+"",v,h,w,C,L,E,T,A,z,O,U,R,B,H,G,Z,Y,ae=Me(r[7]),D=[];for(let fe=0;fe<ae.length;fe+=1)D[fe]=Bo(To(r,ae,fe));let ye=Me(r[7]),ge=[];for(let fe=0;fe<ye.length;fe+=1)ge[fe]=Ro(Mo(r,ye,fe));return{c(){e=k("div"),n=k("p"),t=j("Cyclists: "),o=j(l),i=M(),s=k("p"),a=j("Gradient: "),u=j(f),c=j("%"),_=M(),d=k("p"),m=j("Cycle-friendliness: "),v=j(g),h=j("%"),w=M(),C=k("details"),L=k("summary"),L.textContent="All network details",E=M(),T=k("p"),T.textContent="Fast/Direct network",A=M(),z=k("table"),O=k("tr"),O.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",U=M();for(let fe=0;fe<D.length;fe+=1)D[fe].c();R=M(),B=k("p"),B.textContent="Quiet/Indirect network",H=M(),G=k("table"),Z=k("tr"),Z.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Y=M();for(let fe=0;fe<ge.length;fe+=1)ge[fe].c();oe(e,"max-width","30vw"),oe(e,"max-height","60vh"),oe(e,"overflow","auto")},m(fe,ve){$(fe,e,ve),p(e,n),p(n,t),p(n,o),p(e,i),p(e,s),p(s,a),p(s,u),p(s,c),p(e,_),p(e,d),p(d,m),p(d,v),p(d,h),p(e,w),p(e,C),p(C,L),p(C,E),p(C,T),p(C,A),p(C,z),p(z,O),p(z,U);for(let ue=0;ue<D.length;ue+=1)D[ue]&&D[ue].m(z,null);p(C,R),p(C,B),p(C,H),p(C,G),p(G,Z),p(G,Y);for(let ue=0;ue<ge.length;ue+=1)ge[ue]&&ge[ue].m(G,null)},p(fe,ve){if(ve[0]&131088&&l!==(l=fe[17][fe[4]].toLocaleString()+"")&&ne(o,l),ve[0]&131072&&f!==(f=fe[17].gradient+"")&&ne(u,f),ve[0]&131072&&g!==(g=fe[17].quietness+"")&&ne(v,g),ve[0]&131200){ae=Me(fe[7]);let ue;for(ue=0;ue<ae.length;ue+=1){const Fe=To(fe,ae,ue);D[ue]?D[ue].p(Fe,ve):(D[ue]=Bo(Fe),D[ue].c(),D[ue].m(z,null))}for(;ue<D.length;ue+=1)D[ue].d(1);D.length=ae.length}if(ve[0]&131200){ye=Me(fe[7]);let ue;for(ue=0;ue<ye.length;ue+=1){const Fe=Mo(fe,ye,ue);ge[ue]?ge[ue].p(Fe,ve):(ge[ue]=Ro(Fe),ge[ue].c(),ge[ue].m(G,null))}for(;ue<ge.length;ue+=1)ge[ue].d(1);ge.length=ye.length}},d(fe){fe&&y(e),ft(D,fe),ft(ge,fe)}}}function vd(r){let e,n;return e=new dt({props:{openOn:"click",$$slots:{default:[yd,({props:t})=>({17:t}),({props:t})=>[t?131072:0]]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l[0]&131088|l[1]&2&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function wd(r){let e,n;const t=[we("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Do(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let l={$$slots:{default:[vd]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i[0]&112?Ne(t,[t[0],t[1],i[0]&80&&{paint:{"line-color":o[6],"line-width":Do(["get",o[4]])}},i[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},t[4]]):{};i[0]&16|i[1]&2&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function kd(r){let e,n,t,l,o,i,s,a=r[5]&&Eo(r);return l=new tr({props:{url:`pmtiles://${wt("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[wd]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Route network",n=M(),a&&a.c(),t=M(),F(l.$$.fragment),N(e,"class","secondary")},m(f,u){$(f,e,u),$(f,n,u),a&&a.m(f,u),$(f,t,u),P(l,f,u),o=!0,i||(s=K(e,"click",r[11]),i=!0)},p(f,u){f[5]?a?(a.p(f,u),u[0]&32&&b(a,1)):(a=Eo(f),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u[0]&112|u[1]&2&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(b(a),b(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&(y(e),y(n),y(t)),a&&a.d(f),I(l,f),i=!1,s()}}}function Do(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function Sd(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function Cd(r,e,n){let t,l,o=!1,i="all",s="bicycle_go_dutch",a="fastest",f="flow",u=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],c=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],_=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],d=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],m={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};const g=()=>n(5,o=!o);function v(){i=cn(this),n(0,i),n(7,u)}function h(){s=cn(this),n(1,s),n(8,c)}function w(){a=cn(this),n(2,a),n(9,_)}function C(){f=cn(this),n(3,f),n(10,d)}return r.$$.update=()=>{r.$$.dirty[0]&7&&n(4,t=`${i}_${a}_${s}`),r.$$.dirty[0]&24&&n(6,l={none:"#304ce7",flow:Sd(["get",t]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:jt(["abs",["get","gradient"]],m.limits,m.colorScale)}[f])},[i,s,a,f,t,o,l,u,c,_,d,g,v,h,w,C]}class Ld extends ie{constructor(e){super(),se(this,e,Cd,kd,le,{},null,[-1,-1])}}function Uo(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v,h,w,C,L,E;return e=new zt({props:{$$slots:{default:[Md]},$$scope:{ctx:r}}}),w=new Tr({props:{colors:r[6],horiz:!0}}),{c(){F(e.$$.fragment),n=M(),t=k("fieldset"),l=k("label"),o=k("input"),i=j(`
      Pedestrians`),s=M(),a=k("label"),f=k("input"),u=j(`
      Cyclists`),c=M(),_=k("div"),d=j(`Filter years:
    `),m=k("input"),g=j(`
    -
    `),v=k("input"),h=M(),F(w.$$.fragment),N(o,"type","checkbox"),N(o,"class","svelte-1ft65rw"),N(f,"type","checkbox"),N(f,"class","svelte-1ft65rw"),N(m,"type","number"),N(m,"min",2017),N(m,"max",2023),N(m,"class","svelte-1ft65rw"),N(v,"type","number"),N(v,"min",2017),N(v,"max",2023),N(v,"class","svelte-1ft65rw")},m(T,A){P(e,T,A),$(T,n,A),$(T,t,A),p(t,l),p(l,o),o.checked=r[1].pedestrians,p(l,i),p(t,s),p(t,a),p(a,f),f.checked=r[1].cyclists,p(a,u),$(T,c,A),$(T,_,A),p(_,d),p(_,m),Oe(m,r[1].minYear),p(_,g),p(_,v),Oe(v,r[1].maxYear),$(T,h,A),P(w,T,A),C=!0,L||(E=[K(o,"change",r[8]),K(f,"change",r[9]),K(m,"input",r[10]),K(v,"input",r[11])],L=!0)},p(T,A){const z={};A&8192&&(z.$$scope={dirty:A,ctx:T}),e.$set(z),A&2&&(o.checked=T[1].pedestrians),A&2&&(f.checked=T[1].cyclists),A&2&&yn(m.value)!==T[1].minYear&&Oe(m,T[1].minYear),A&2&&yn(v.value)!==T[1].maxYear&&Oe(v,T[1].maxYear)},i(T){C||(b(e.$$.fragment,T),b(w.$$.fragment,T),C=!0)},o(T){S(e.$$.fragment,T),S(w.$$.fragment,T),C=!1},d(T){T&&(y(n),y(t),y(c),y(_),y(h)),I(e,T),I(w,T),L=!1,nt(E)}}}function Md(r){let e,n,t,l,o,i,s;return{c(){e=k("p"),e.innerHTML=`This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:`,n=M(),t=k("ul"),t.innerHTML=`<li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li>`,l=M(),o=k("p"),o.textContent="You can click a point to open the full report, thanks to CycleStreets.",i=M(),s=k("p"),s.innerHTML=`License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data © Crown copyright and database right 2025.`},m(a,f){$(a,e,f),$(a,n,f),$(a,t,f),$(a,l,f),$(a,o,f),$(a,i,f),$(a,s,f)},p:Q,d(a){a&&(y(e),y(n),y(t),y(l),y(o),y(i),y(s))}}}function Ho(r){let e,n,t,l=r[3][r[12].pedestrian_location]+"",o;return{c(){e=k("p"),n=j("Pedestrian location: "),t=k("b"),o=j(l)},m(i,s){$(i,e,s),p(e,n),p(e,t),p(t,o)},p(i,s){s&4096&&l!==(l=i[3][i[12].pedestrian_location]+"")&&ne(o,l)},d(i){i&&y(e)}}}function Go(r){let e,n,t,l=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=k("p"),n=j("Pedestrian movement: "),t=k("b"),o=j(l)},m(i,s){$(i,e,s),p(e,n),p(e,t),p(t,o)},p(i,s){s&4096&&l!==(l=i[4][i[12].pedestrian_movement]+"")&&ne(o,l)},d(i){i&&y(e)}}}function Td(r){let e,n,t,l=r[12].year+"",o,i,s,a,f,u=r[5][r[12].severity]+"",c,_,d,m,g,v=Wo(r[12])+"",h,w,C,L,E,T=r[12].pedestrian_location&&Ho(r),A=r[12].pedestrian_movement&&Go(r);return{c(){e=k("p"),n=j("Year: "),t=k("b"),o=j(l),i=M(),s=k("p"),a=j("Severity: "),f=k("b"),c=j(u),_=M(),d=k("p"),m=j("Casualties: "),g=k("b"),h=j(v),w=M(),T&&T.c(),C=M(),A&&A.c(),L=M(),E=k("p"),E.textContent="Click to open full report in CycleStreets"},m(z,O){$(z,e,O),p(e,n),p(e,t),p(t,o),$(z,i,O),$(z,s,O),p(s,a),p(s,f),p(f,c),$(z,_,O),$(z,d,O),p(d,m),p(d,g),p(g,h),$(z,w,O),T&&T.m(z,O),$(z,C,O),A&&A.m(z,O),$(z,L,O),$(z,E,O)},p(z,O){O&4096&&l!==(l=z[12].year+"")&&ne(o,l),O&4096&&u!==(u=z[5][z[12].severity]+"")&&ne(c,u),O&4096&&v!==(v=Wo(z[12])+"")&&ne(h,v),z[12].pedestrian_location?T?T.p(z,O):(T=Ho(z),T.c(),T.m(C.parentNode,C)):T&&(T.d(1),T=null),z[12].pedestrian_movement?A?A.p(z,O):(A=Go(z),A.c(),A.m(L.parentNode,L)):A&&(A.d(1),A=null)},d(z){z&&(y(e),y(i),y(s),y(_),y(d),y(w),y(C),y(L),y(E)),T&&T.d(z),A&&A.d(z)}}}function Ad(r){let e,n;return e=new dt({props:{$$slots:{default:[Td,({props:t})=>({12:t}),({props:t})=>t?4096:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&12288&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Fd(r){let e,n;const t=[we("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":jt(["get","severity"],[1,2,3],[ll,ol,il]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let l={$$slots:{default:[Ad]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),e.$on("click",Id),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i&7?Ne(t,[t[0],t[1],i&0&&{paint:{"circle-color":jt(["get","severity"],[1,2,3],[ll,ol,il]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},i&6&&{filter:o[2](o[1])},i&1&&{layout:{visibility:o[0]?"visible":"none"}},t[5]]):{};i&8192&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Pd(r){let e,n,t,l,o,i,s,a=r[0]&&Uo(r);return l=new tr({props:{url:`pmtiles://${wt("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[Fd]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Collisions",n=M(),a&&a.c(),t=M(),F(l.$$.fragment),N(e,"class","secondary")},m(f,u){$(f,e,u),$(f,n,u),a&&a.m(f,u),$(f,t,u),P(l,f,u),o=!0,i||(s=K(e,"click",r[7]),i=!0)},p(f,[u]){f[0]?a?(a.p(f,u),u&1&&b(a,1)):(a=Uo(f),a.c(),b(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u&8195&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(b(a),b(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&(y(e),y(n),y(t)),a&&a.d(f),I(l,f),i=!1,s()}}}let ll="#080C54",ol="#1F9EB7",il="#CDE594";function Wo(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function Id(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function Ed(r,e,n){let t=!1,l={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(g){let v=["any"];return l.pedestrians&&v.push(["get","pedestrian"]),l.cyclists&&v.push(["get","cyclist"]),["all",[">=",["get","year"],l.minYear],["<=",["get","year"],l.maxYear],v]}let i={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},a={1:"Fatal",2:"Serious",3:"Slight"},f={Fatal:ll,Serious:ol,Slight:il};const u=()=>n(0,t=!t);function c(){l.pedestrians=this.checked,n(1,l)}function _(){l.cyclists=this.checked,n(1,l)}function d(){l.minYear=yn(this.value),n(1,l)}function m(){l.maxYear=yn(this.value),n(1,l)}return[t,l,o,i,s,a,f,u,c,_,d,m]}class Nd extends ie{constructor(e){super(),se(this,e,Ed,Pd,le,{})}}function jd(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v,h,w,C,L;return o=new td({}),s=new cd({}),f=new bd({}),c=new lc({}),d=new Hc({}),g=new Ld({}),h=new Nd({}),{c(){e=k("div"),n=k("button"),n.innerHTML=`<img src="${ou}" title="Layers" alt="Layers"/>`,t=M(),l=k("div"),F(o.$$.fragment),i=M(),F(s.$$.fragment),a=M(),F(f.$$.fragment),u=M(),F(c.$$.fragment),_=M(),F(d.$$.fragment),m=M(),F(g.$$.fragment),v=M(),F(h.$$.fragment),oe(l,"display","flex"),oe(l,"flex-direction","column"),oe(l,"visibility",r[0]?"visible":"collapse"),N(e,"class","pico"),oe(e,"display","flex"),oe(e,"flex-direction","column"),oe(e,"max-height","80vh"),oe(e,"overflow","auto"),oe(e,"background","grey")},m(E,T){$(E,e,T),p(e,n),p(e,t),p(e,l),P(o,l,null),p(l,i),P(s,l,null),p(l,a),P(f,l,null),p(l,u),P(c,l,null),p(l,_),P(d,l,null),p(l,m),P(g,l,null),p(l,v),P(h,l,null),w=!0,C||(L=K(n,"click",r[1]),C=!0)},p(E,T){T&1&&oe(l,"visibility",E[0]?"visible":"collapse")},i(E){w||(b(o.$$.fragment,E),b(s.$$.fragment,E),b(f.$$.fragment,E),b(c.$$.fragment,E),b(d.$$.fragment,E),b(g.$$.fragment,E),b(h.$$.fragment,E),w=!0)},o(E){S(o.$$.fragment,E),S(s.$$.fragment,E),S(f.$$.fragment,E),S(c.$$.fragment,E),S(d.$$.fragment,E),S(g.$$.fragment,E),S(h.$$.fragment,E),w=!1},d(E){E&&y(e),I(o),I(s),I(f),I(c),I(d),I(g),I(h),C=!1,L()}}}function zd(r){let e,n;return e=new Hf({props:{defaultStyling:!0,$$slots:{default:[jd]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&5&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Od(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class Bd extends ie{constructor(e){super(),se(this,e,Od,zd,le,{})}}let W;const rn=new Array(128).fill(void 0);rn.push(void 0,null,!0,!1);function Ce(r){return rn[r]}let qn=rn.length;function Rd(r){r<132||(rn[r]=qn,qn=r)}function Xe(r){const e=Ce(r);return Rd(r),e}let $t=0,Rn=null;function Mn(){return(Rn===null||Rn.byteLength===0)&&(Rn=new Uint8Array(W.memory.buffer)),Rn}const pr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Dd=typeof pr.encodeInto=="function"?function(r,e){return pr.encodeInto(r,e)}:function(r,e){const n=pr.encode(r);return e.set(n),{read:r.length,written:n.length}};function Ht(r,e,n){if(n===void 0){const s=pr.encode(r),a=e(s.length,1)>>>0;return Mn().subarray(a,a+s.length).set(s),$t=s.length,a}let t=r.length,l=e(t,1)>>>0;const o=Mn();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;o[l+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),l=n(l,t,t=i+r.length*3,1)>>>0;const s=Mn().subarray(l+i,l+t),a=Dd(r,s);i+=a.written}return $t=i,l}function Ln(r){return r==null}let Dn=null;function ee(){return(Dn===null||Dn.byteLength===0)&&(Dn=new Int32Array(W.memory.buffer)),Dn}const ks=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ks.decode();function ot(r,e){return r=r>>>0,ks.decode(Mn().subarray(r,r+e))}function qe(r){qn===rn.length&&rn.push(rn.length+1);const e=qn;return qn=rn[e],rn[e]=r,e}let Un=null;function Ss(){return(Un===null||Un.byteLength===0)&&(Un=new Float64Array(W.memory.buffer)),Un}let Hn=null;function Ud(){return(Hn===null||Hn.byteLength===0)&&(Hn=new BigInt64Array(W.memory.buffer)),Hn}function sl(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let o="[";l>0&&(o+=sl(r[0]));for(let i=1;i<l;i++)o+=", "+sl(r[i]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function Jr(r,e){const n=e(r.length*1,1)>>>0;return Mn().set(r,n/1),$t=r.length,n}function Hd(r,e){return r=r>>>0,Ss().subarray(r/8,r/8+e)}function Gd(r,e){return r=r>>>0,Mn().subarray(r/1,r/1+e)}function bn(r,e){try{return r.apply(this,e)}catch(n){W.__wbindgen_exn_store(qe(n))}}class Wd{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();W.__wbg_ltn_free(e)}constructor(e,n,t,l,o){try{const c=W.__wbindgen_add_to_stack_pointer(-16),_=Jr(e,W.__wbindgen_malloc),d=$t,m=Jr(n,W.__wbindgen_malloc),g=$t,v=Jr(t,W.__wbindgen_malloc),h=$t;var i=Ln(o)?0:Ht(o,W.__wbindgen_malloc,W.__wbindgen_realloc),s=$t;W.ltn_new(c,_,d,m,g,v,h,qe(l),i,s);var a=ee()[c/4+0],f=ee()[c/4+1],u=ee()[c/4+2];if(u)throw Xe(f);return this.__wbg_ptr=a>>>0,this}finally{W.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getInvertedBoundary(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}getBounds(){try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getBounds(l,this.__wbg_ptr);var e=ee()[l/4+0],n=ee()[l/4+1],t=Hd(e,n).slice();return W.__wbindgen_free(e,n*8,8),t}finally{W.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=ee()[l/4+0],n=ee()[l/4+1],t=Gd(e,n).slice();return W.__wbindgen_free(e,n*1,1),t}finally{W.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_toRouteSnapperGj(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}renderModalFilters(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_renderModalFilters(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}renderTurnRestrictions(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_renderTurnRestrictions(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}renderNeighbourhood(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_renderNeighbourhood(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}renderAutoBoundaries(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_renderAutoBoundaries(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}setNeighbourhoodBoundary(e,n){try{const o=W.__wbindgen_add_to_stack_pointer(-16),i=Ht(e,W.__wbindgen_malloc,W.__wbindgen_realloc),s=$t;W.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,i,s,qe(n));var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const n=Ht(e,W.__wbindgen_malloc,W.__wbindgen_realloc),t=$t;W.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,t)}renameNeighbourhoodBoundary(e,n){const t=Ht(e,W.__wbindgen_malloc,W.__wbindgen_realloc),l=$t,o=Ht(n,W.__wbindgen_malloc,W.__wbindgen_realloc),i=$t;W.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,t,l,o,i)}setCurrentNeighbourhood(e,n){try{const o=W.__wbindgen_add_to_stack_pointer(-16),i=Ht(e,W.__wbindgen_malloc,W.__wbindgen_realloc),s=$t;W.ltn_setCurrentNeighbourhood(o,this.__wbg_ptr,i,s,n);var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,n){try{const o=W.__wbindgen_add_to_stack_pointer(-16),i=Ht(n,W.__wbindgen_malloc,W.__wbindgen_realloc),s=$t;W.ltn_addModalFilter(o,this.__wbg_ptr,qe(e),i,s);var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,n){try{const o=W.__wbindgen_add_to_stack_pointer(-16),i=Ht(n,W.__wbindgen_malloc,W.__wbindgen_realloc),s=$t;W.ltn_addManyModalFilters(o,this.__wbg_ptr,qe(e),i,s);var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){W.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_addDiagonalFilter(l,this.__wbg_ptr,e);var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{W.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_rotateDiagonalFilter(l,this.__wbg_ptr,e);var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{W.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_deleteDiagonalFilter(l,this.__wbg_ptr,e);var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{W.__wbindgen_add_to_stack_pointer(16)}}toggleTravelFlow(e){W.ltn_toggleTravelFlow(this.__wbg_ptr,e)}undo(){W.ltn_undo(this.__wbg_ptr)}redo(){W.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let n,t;try{const u=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getShortcutsCrossingRoad(u,this.__wbg_ptr,e);var l=ee()[u/4+0],o=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,ot(a,f)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(n,t,1)}}getAllShortcuts(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getAllShortcuts(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_toSavefile(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const l=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_loadSavefile(l,this.__wbg_ptr,qe(e));var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{W.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,n,t,l,o){let i,s;try{const m=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_compareRoute(m,this.__wbg_ptr,e,n,t,l,o);var a=ee()[m/4+0],f=ee()[m/4+1],u=ee()[m/4+2],c=ee()[m/4+3],_=a,d=f;if(c)throw _=0,d=0,Xe(u);return i=_,s=d,ot(_,d)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(i,s,1)}}impactToOneDestination(e,n){let t,l;try{const c=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_impactToOneDestination(c,this.__wbg_ptr,e,n);var o=ee()[c/4+0],i=ee()[c/4+1],s=ee()[c/4+2],a=ee()[c/4+3],f=o,u=i;if(a)throw f=0,u=0,Xe(s);return t=f,l=u,ot(f,u)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(t,l,1)}}predictImpact(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_predictImpact(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}getImpactsOnRoad(e){let n,t;try{const u=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getImpactsOnRoad(u,this.__wbg_ptr,e);var l=ee()[u/4+0],o=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,ot(a,f)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(n,t,1)}}getAllNeighbourhoods(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getAllNeighbourhoods(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}getAllIntersections(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getAllIntersections(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}getMovements(e){let n,t;try{const u=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getMovements(u,this.__wbg_ptr,e);var l=ee()[u/4+0],o=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,ot(a,f)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(n,t,1)}}getDemandModel(){let e,n;try{const f=W.__wbindgen_add_to_stack_pointer(-16);W.ltn_getDemandModel(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,ot(s,a)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,n,1)}}}async function qd(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Jd(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Xe(e)},r.wbg.__wbindgen_string_get=function(e,n){const t=Ce(n),l=typeof t=="string"?t:void 0;var o=Ln(l)?0:Ht(l,W.__wbindgen_malloc,W.__wbindgen_realloc),i=$t;ee()[e/4+1]=i,ee()[e/4+0]=o},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(ot(e,n));return qe(t)},r.wbg.__wbindgen_string_new=function(e,n){const t=ot(e,n);return qe(t)},r.wbg.__wbindgen_boolean_get=function(e){const n=Ce(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Ce(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,n){const t=Ce(n),l=typeof t=="number"?t:void 0;Ss()[e/8+1]=Ln(l)?0:l,ee()[e/4+0]=!Ln(l)},r.wbg.__wbindgen_is_object=function(e){const n=Ce(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_in=function(e,n){return Ce(e)in Ce(n)},r.wbg.__wbindgen_bigint_from_i64=function(e){return qe(e)},r.wbg.__wbindgen_jsval_eq=function(e,n){return Ce(e)===Ce(n)},r.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return qe(n)},r.wbg.__wbindgen_is_undefined=function(e){return Ce(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Ce(e)==Ce(n)},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Ce(e);return qe(n)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,n){const t=Ce(e)[Ce(n)];return qe(t)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Ce(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Ce(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Ce(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Ce(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Ce(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return qe(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Ce(n).stack,l=Ht(t,W.__wbindgen_malloc,W.__wbindgen_realloc),o=$t;ee()[e/4+1]=o,ee()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,l;try{t=e,l=n,console.error(ot(e,n))}finally{W.__wbindgen_free(t,l,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const n=Ce(e).performance;return qe(n)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Ce(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,n){const t=Ce(e)[n>>>0];return qe(t)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Ce(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ce(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,n){const t=new Function(ot(e,n));return qe(t)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const n=Ce(e).next;return qe(n)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return bn(function(e){const n=Ce(e).next();return qe(n)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Ce(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const n=Ce(e).value;return qe(n)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return qe(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return bn(function(e,n){const t=Reflect.get(Ce(e),Ce(n));return qe(t)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return bn(function(e,n){const t=Ce(e).call(Ce(n));return qe(t)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return bn(function(){const e=self.self;return qe(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return bn(function(){const e=window.window;return qe(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return bn(function(){const e=globalThis.globalThis;return qe(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return bn(function(){const e=global.global;return qe(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Ce(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let n;try{n=Ce(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Ce(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const n=Object.entries(Ce(e));return qe(n)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const n=Ce(e).buffer;return qe(n)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const n=new Uint8Array(Ce(e));return qe(n)},r.wbg.__wbg_set_2357bf09366ee480=function(e,n,t){Ce(e).set(Ce(n),t>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Ce(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let n;try{n=Ce(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const t=Ce(n),l=typeof t=="bigint"?t:void 0;Ud()[e/8+1]=Ln(l)?BigInt(0):l,ee()[e/4+0]=!Ln(l)},r.wbg.__wbindgen_debug_string=function(e,n){const t=sl(Ce(n)),l=Ht(t,W.__wbindgen_malloc,W.__wbindgen_realloc),o=$t;ee()[e/4+1]=o,ee()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,n){throw new Error(ot(e,n))},r.wbg.__wbindgen_memory=function(){const e=W.memory;return qe(e)},r}function Yd(r,e){return W=r.exports,Cs.__wbindgen_wasm_module=e,Hn=null,Un=null,Dn=null,Rn=null,W}async function Cs(r){if(W!==void 0)return W;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=Jd();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await qd(await r,e);return Yd(n,t)}const Zd=r=>({}),qo=r=>({}),Kd=r=>({}),Jo=r=>({}),Xd=r=>({}),Yo=r=>({});function Vd(r){let e,n,t,l,o,i,s,a;const f=r[1].top,u=De(f,r,r[0],Yo),c=r[1].left,_=De(c,r,r[0],Jo),d=r[1].main,m=De(d,r,r[0],qo);return{c(){e=k("div"),n=k("div"),u&&u.c(),t=M(),l=k("div"),o=k("div"),_&&_.c(),i=M(),s=k("div"),m&&m.c(),N(n,"class","top svelte-29q570"),N(o,"class","left svelte-29q570"),N(s,"class","main svelte-29q570"),N(l,"class","content svelte-29q570"),N(e,"class","flex-container svelte-29q570")},m(g,v){$(g,e,v),p(e,n),u&&u.m(n,null),p(e,t),p(e,l),p(l,o),_&&_.m(o,null),p(l,i),p(l,s),m&&m.m(s,null),a=!0},p(g,[v]){u&&u.p&&(!a||v&1)&&Ue(u,f,g,g[0],a?Ge(f,g[0],v,Xd):He(g[0]),Yo),_&&_.p&&(!a||v&1)&&Ue(_,c,g,g[0],a?Ge(c,g[0],v,Kd):He(g[0]),Jo),m&&m.p&&(!a||v&1)&&Ue(m,d,g,g[0],a?Ge(d,g[0],v,Zd):He(g[0]),qo)},i(g){a||(b(u,g),b(_,g),b(m,g),a=!0)},o(g){S(u,g),S(_,g),S(m,g),a=!1},d(g){g&&y(e),u&&u.d(g),_&&_.d(g),m&&m.d(g)}}}function Qd(r,e,n){let{$$slots:t={},$$scope:l}=e;return r.$$set=o=>{"$$scope"in o&&n(0,l=o.$$scope)},[l,t]}class xd extends ie{constructor(e){super(),se(this,e,Qd,Vd,le,{})}}const e_=r=>({}),Zo=r=>({}),t_=r=>({}),Ko=r=>({}),n_=r=>({}),Xo=r=>({});function r_(r){let e,n,t,l,o,i;const s=r[4].top,a=De(s,r,r[3],Xo),f=r[4].sidebar,u=De(f,r,r[3],Ko),c=r[4].map,_=De(c,r,r[3],Zo);return{c(){e=k("div"),a&&a.c(),n=M(),t=k("div"),u&&u.c(),l=M(),o=k("div"),_&&_.c()},m(d,m){$(d,e,m),a&&a.m(e,null),r[5](e),$(d,n,m),$(d,t,m),u&&u.m(t,null),r[6](t),$(d,l,m),$(d,o,m),_&&_.m(o,null),r[7](o),i=!0},p(d,[m]){a&&a.p&&(!i||m&8)&&Ue(a,s,d,d[3],i?Ge(s,d[3],m,n_):He(d[3]),Xo),u&&u.p&&(!i||m&8)&&Ue(u,f,d,d[3],i?Ge(f,d[3],m,t_):He(d[3]),Ko),_&&_.p&&(!i||m&8)&&Ue(_,c,d,d[3],i?Ge(c,d[3],m,e_):He(d[3]),Zo)},i(d){i||(b(a,d),b(u,d),b(_,d),i=!0)},o(d){S(a,d),S(u,d),S(_,d),i=!1},d(d){d&&(y(e),y(n),y(t),y(l),y(o)),a&&a.d(d),r[5](null),u&&u.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function l_(r,e,n){let t,l,o;X(r,al,c=>n(0,t=c)),X(r,fl,c=>n(1,l=c)),X(r,ul,c=>n(2,o=c));let{$$slots:i={},$$scope:s}=e;function a(c){Be[c?"unshift":"push"](()=>{t=c,al.set(t)})}function f(c){Be[c?"unshift":"push"](()=>{l=c,fl.set(l)})}function u(c){Be[c?"unshift":"push"](()=>{o=c,ul.set(o)})}return r.$$set=c=>{"$$scope"in c&&n(3,s=c.$$scope)},[t,l,o,s,i,a,f,u]}class At extends ie{constructor(e){super(),se(this,e,l_,r_,le,{})}}let al=Mt(null),fl=Mt(null),ul=Mt(null);function o_(r){let e;return{c(){e=j("Back")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function i_(r){let e,n,t,l;return e=new Le({props:{$$slots:{default:[o_]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0,t||(l=K(window,"keydown",r[1]),t=!0)},p(o,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o),t=!1,l()}}}function s_(r){let e=pn();function n(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,n,()=>e("click")]}class gn extends ie{constructor(e){super(),se(this,e,s_,i_,le,{})}}function cl(r,e,n){let t=new Set(r.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,n);if(!l)return null;if(t.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function a_(r){let e,n;return e=new kn({props:{colorScale:ln,limits:Cl}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function f_(r){let e,n;return e=new kn({props:{colorScale:ln,limits:nr}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function u_(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;const g=[f_,a_],v=[];function h(w,C){return w[0]=="simd"?0:w[0]=="area"?1:-1}return~(f=h(r))&&(u=v[f]=g[f](r)),{c(){e=k("div"),n=k("label"),n.textContent="Metric",t=M(),l=k("select"),o=k("option"),o.textContent="None",i=k("option"),i.textContent="Area (km²)",s=k("option"),s.textContent="Fake SIMD (percentile)",a=M(),u&&u.c(),c=Ye(),N(n,"for","prioritization-selection"),o.__value="none",Oe(o,o.__value),i.__value="area",Oe(i,i.__value),s.__value="simd",Oe(s,s.__value),N(l,"id","prioritization-selection"),r[0]===void 0&&un(()=>r[1].call(l)),oe(e,"display","flex"),oe(e,"gap","16px"),oe(e,"align-items","center")},m(w,C){$(w,e,C),p(e,n),p(e,t),p(e,l),p(l,o),p(l,i),p(l,s),vt(l,r[0],!0),$(w,a,C),~f&&v[f].m(w,C),$(w,c,C),_=!0,d||(m=K(l,"change",r[1]),d=!0)},p(w,[C]){C&1&&vt(l,w[0]);let L=f;f=h(w),f!==L&&(u&&(he(),S(v[L],1,1,()=>{v[L]=null}),be()),~f?(u=v[f],u||(u=v[f]=g[f](w),u.c()),b(u,1),u.m(c.parentNode,c)):u=null)},i(w){_||(b(u),_=!0)},o(w){S(u),_=!1},d(w){w&&(y(e),y(a),y(c)),~f&&v[f].d(w),d=!1,m()}}}function c_(r,e,n){let t;X(r,Zt,s=>n(2,t=s));let{selectedPrioritization:l}=e;function o(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="area"?n(0,l="area"):s=="simd"&&n(0,l="simd")}t.startsWith("ltn_cnt/")?o():l="none";function i(){l=cn(this),n(0,l)}return r.$$set=s=>{"selectedPrioritization"in s&&n(0,l=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);l=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",l),history.replaceState({},"",s)}},[l,i]}class Ls extends ie{constructor(e){super(),se(this,e,c_,u_,le,{selectedPrioritization:0})}}function d_(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function __(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function m_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[d_]},$$scope:{ctx:r}}}),o.$on("click",r[12]),a=new Le({props:{$$slots:{default:[__]},$$scope:{ctx:r}}}),a.$on("click",r[13]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),u.textContent="Use an auto-generated boundary",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){$(_,e,d),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&131072&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&131072&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(o.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&y(e),I(o),I(a)}}}function Vo(r){let e,n,t,l,o,i,s;function a(u){r[9](u)}let f={};return r[2]!==void 0&&(f.selectedPrioritization=r[2]),o=new Ls({props:f}),Be.push(()=>st(o,"selectedPrioritization",a)),{c(){e=k("h3"),e.textContent="Prioritization",n=M(),t=k("p"),t.textContent="Compare metrics across candidate neighbourhoods.",l=M(),F(o.$$.fragment)},m(u,c){$(u,e,c),$(u,n,c),$(u,t,c),$(u,l,c),P(o,u,c),s=!0},p(u,c){const _={};!i&&c&4&&(i=!0,_.selectedPrioritization=u[2],at(()=>i=!1)),o.$set(_)},i(u){s||(b(o.$$.fragment,u),s=!0)},o(u){S(o.$$.fragment,u),s=!1},d(u){u&&(y(e),y(n),y(t),y(l)),I(o,u)}}}function Qo(r){let e;return{c(){e=k("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function p_(r){let e,n,t,l,o,i=r[4].startsWith("ltn_cnt/"),s,a,f,u,c,_,d,m,g,v,h,w,C,L;n=new gn({}),n.$on("click",r[8]);let E=i&&Vo(r),T=r[2]=="none"&&Qo();return{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("p"),l.textContent=`Click an area to use it as the boundary for your neighbourhood. These
      particular boundaries are suggested by finding roads, railways, and water
      that form severances.`,o=M(),E&&E.c(),s=M(),T&&T.c(),a=M(),f=k("button"),f.textContent="Export to GeoJSON",u=M(),c=k("label"),_=j(`Minimum area (km²)
      `),d=k("input"),m=M(),g=k("label"),v=k("input"),h=j(`
      Remove areas not touching a big road`),N(f,"class","secondary"),N(d,"type","number"),N(d,"min","0"),N(d,"max","1"),N(d,"step","0.01"),N(v,"type","checkbox"),N(e,"slot","sidebar")},m(A,z){$(A,e,z),P(n,e,null),p(e,t),p(e,l),p(e,o),E&&E.m(e,null),p(e,s),T&&T.m(e,null),p(e,a),p(e,f),p(e,u),p(e,c),p(c,_),p(c,d),Oe(d,r[0]),p(e,m),p(e,g),p(g,v),v.checked=r[1],p(g,h),w=!0,C||(L=[K(f,"click",r[7]),K(d,"input",r[10]),K(v,"change",r[11])],C=!0)},p(A,z){z&16&&(i=A[4].startsWith("ltn_cnt/")),i?E?(E.p(A,z),z&16&&b(E,1)):(E=Vo(A),E.c(),b(E,1),E.m(e,s)):E&&(he(),S(E,1,1,()=>{E=null}),be()),A[2]=="none"?T||(T=Qo(),T.c(),T.m(e,a)):T&&(T.d(1),T=null),z&1&&yn(d.value)!==A[0]&&Oe(d,A[0]),z&2&&(v.checked=A[1])},i(A){w||(b(n.$$.fragment,A),b(E),w=!0)},o(A){S(n.$$.fragment,A),S(E),w=!1},d(A){A&&y(e),I(n),E&&E.d(),T&&T.d(),C=!1,nt(L)}}}function g_(r){let e,n,t=r[16].area_km2.toFixed(1)+"",l,o,i;return{c(){e=k("b"),e.textContent="Area:",n=M(),l=j(t),o=j(` km²
          `),i=k("br")},m(s,a){$(s,e,a),$(s,n,a),$(s,l,a),$(s,o,a),$(s,i,a)},p(s,a){a&65536&&t!==(t=s[16].area_km2.toFixed(1)+"")&&ne(l,t)},d(s){s&&(y(e),y(n),y(l),y(o),y(i))}}}function h_(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[g_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&196608&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function b_(r){let e,n,t=r[16].simd.toFixed(1)+"",l;return{c(){e=k("b"),e.textContent="SIMD:",n=M(),l=j(t)},m(o,i){$(o,e,i),$(o,n,i),$(o,l,i)},p(o,i){i&65536&&t!==(t=o[16].simd.toFixed(1)+"")&&ne(l,t)},d(o){o&&(y(e),y(n),y(l))}}}function $_(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[b_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&196608&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function y_(r){let e,n,t=r[16].area_km2.toFixed(1)+"",l,o;return{c(){e=k("b"),e.textContent="Area:",n=M(),l=j(t),o=j(" km²")},m(i,s){$(i,e,s),$(i,n,s),$(i,l,s),$(i,o,s)},p(i,s){s&65536&&t!==(t=i[16].area_km2.toFixed(1)+"")&&ne(l,t)},d(i){i&&(y(e),y(n),y(l),y(o))}}}function v_(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[y_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&196608&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function w_(r){let e,n,t,l,o,i,s,a;const f=[we("neighbourhood-boundaries",!1),{filter:sn(r[0],r[1])},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":ut(.2,.4)}},{layout:{visibility:r[2]=="none"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[h_]},$$scope:{ctx:r}};for(let h=0;h<f.length;h+=1)u=_e(u,f[h]);e=new kt({props:u}),e.$on("click",r[6]);const c=[we("neighbourhood-prioritization-simd"),{filter:sn(r[0],r[1])},{paint:{"fill-color":jt(["get","simd"],nr,ln),"fill-opacity":ut(.7,.9)}},{layout:{visibility:r[2]=="simd"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let _={$$slots:{default:[$_]},$$scope:{ctx:r}};for(let h=0;h<c.length;h+=1)_=_e(_,c[h]);t=new kt({props:_}),t.$on("click",r[6]);const d=[we("neighbourhood-prioritization-area"),{filter:sn(r[0],r[1])},{paint:{"fill-color":jt(["get","area_km2"],Cl,ln),"fill-opacity":ut(.7,.9)}},{layout:{visibility:r[2]=="area"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let m={$$slots:{default:[v_]},$$scope:{ctx:r}};for(let h=0;h<d.length;h+=1)m=_e(m,d[h]);o=new kt({props:m}),o.$on("click",r[6]);const g=[we("neighbourhood-boundaries-outline",!1),{filter:sn(r[0],r[1])},{paint:{"line-color":"black","line-width":1}}];let v={};for(let h=0;h<g.length;h+=1)v=_e(v,g[h]);return s=new et({props:v}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),F(s.$$.fragment)},m(h,w){P(e,h,w),$(h,n,w),P(t,h,w),$(h,l,w),P(o,h,w),$(h,i,w),P(s,h,w),a=!0},p(h,w){const C=w&7?Ne(f,[f[0],w&3&&{filter:sn(h[0],h[1])},f[2],w&4&&{layout:{visibility:h[2]=="none"?"visible":"none"}},f[4],f[5]]):{};w&131072&&(C.$$scope={dirty:w,ctx:h}),e.$set(C);const L=w&7?Ne(c,[c[0],w&3&&{filter:sn(h[0],h[1])},c[2],w&4&&{layout:{visibility:h[2]=="simd"?"visible":"none"}},c[4],c[5]]):{};w&131072&&(L.$$scope={dirty:w,ctx:h}),t.$set(L);const E=w&7?Ne(d,[d[0],w&3&&{filter:sn(h[0],h[1])},d[2],w&4&&{layout:{visibility:h[2]=="area"?"visible":"none"}},d[4],d[5]]):{};w&131072&&(E.$$scope={dirty:w,ctx:h}),o.$set(E);const T=w&3?Ne(g,[g[0],{filter:sn(h[0],h[1])},g[2]]):{};s.$set(T)},i(h){a||(b(e.$$.fragment,h),b(t.$$.fragment,h),b(o.$$.fragment,h),b(s.$$.fragment,h),a=!0)},o(h){S(e.$$.fragment,h),S(t.$$.fragment,h),S(o.$$.fragment,h),S(s.$$.fragment,h),a=!1},d(h){h&&(y(n),y(l),y(i)),I(e,h),I(t,h),I(o,h),I(s,h)}}}function k_(r){let e,n,t;return n=new Ke({props:{data:r[5],generateId:!0,$$slots:{default:[w_]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),N(e,"slot","map")},m(l,o){$(l,e,o),P(n,e,null),t=!0},p(l,o){const i={};o&131079&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function S_(r){let e,n;return e=new At({props:{$$slots:{map:[k_],sidebar:[p_],top:[m_]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&131103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function sn(r,e){let n=["all",[">=",["get","area_km2"],r]];return e&&n.push(["get","touches_big_road"]),n}function C_(r,e,n){let t,l,o,i;X(r,ce,C=>n(3,t=C)),X(r,Jn,C=>n(14,l=C)),X(r,xe,C=>n(15,o=C)),X(r,Zt,C=>n(4,i=C));let s=o.renderAutoBoundaries(),a=0,f=!0,u="none";function c(C){let L=cl(o,"What do you want to name the neighbourhood?","");if(L)try{let E={type:"Feature",properties:{},geometry:s.features[C.detail.features[0].id].geometry};o.setNeighbourhoodBoundary(L,E),Tn(),o.setCurrentNeighbourhood(L,l),te(ce,t={mode:"neighbourhood"},t)}catch(E){console.log("error when setting auto-generated neighborhood",E),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working.")}}function _(){vr("auto_boundaries.geojson",JSON.stringify(s,null,"  "))}const d=()=>te(ce,t={mode:"pick-neighbourhood"},t);function m(C){u=C,n(2,u)}function g(){a=yn(this.value),n(0,a)}function v(){f=this.checked,n(1,f)}return[a,f,u,t,i,s,c,_,d,m,g,v,()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class L_ extends ie{constructor(e){super(),se(this,e,C_,S_,le,{})}}function M_(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function T_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function A_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[M_]},$$scope:{ctx:r}}}),o.$on("click",r[11]),a=new Le({props:{$$slots:{default:[T_]},$$scope:{ctx:r}}}),a.$on("click",r[12]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),u.textContent="Debug demand model",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){$(_,e,d),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&65536&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&65536&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(o.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&y(e),I(o),I(a)}}}function F_(r){let e;return{c(){e=k("p"),e.textContent="Hover on a zone"},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function P_(r){let e,n=r[6].properties.name+"",t,l,o,i,s=r[6].properties.sum_from.toLocaleString()+"",a,f,u,c,_=r[6].properties.sum_to.toLocaleString()+"",d,m,g,v,h=r[6].properties.counts_from[r[3]]+"",w;return{c(){e=k("u"),t=j(n),l=M(),o=k("p"),i=j("Total trips from here: "),a=j(s),f=M(),u=k("p"),c=j("Total trips to here: "),d=j(_),m=M(),g=k("p"),v=j("Total intra-zonal trips starting and ending here: "),w=j(h)},m(C,L){$(C,e,L),p(e,t),$(C,l,L),$(C,o,L),p(o,i),p(o,a),$(C,f,L),$(C,u,L),p(u,c),p(u,d),$(C,m,L),$(C,g,L),p(g,v),p(g,w)},p(C,L){L&64&&n!==(n=C[6].properties.name+"")&&ne(t,n),L&64&&s!==(s=C[6].properties.sum_from.toLocaleString()+"")&&ne(a,s),L&64&&_!==(_=C[6].properties.sum_to.toLocaleString()+"")&&ne(d,_),L&72&&h!==(h=C[6].properties.counts_from[C[3]]+"")&&ne(w,h)},d(C){C&&(y(e),y(l),y(o),y(f),y(u),y(m),y(g))}}}function I_(r){let e,n,t,l,o=r[0].features.length.toLocaleString()+"",i,s,a,f,u,c,_,d,m,g,v=r[1]?"from":"to",h,w,C=r[3]==null?"each zone":"this zone",L,E,T,A,z,O,U,R,B,H;n=new gn({}),n.$on("click",r[9]),A=new kn({props:{colorScale:mr,limits:r[5]}});function G(ae,D){return ae[6]&&ae[3]!=null?P_:F_}let Z=G(r),Y=Z(r);return{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("p"),i=j(o),s=j(" zones"),a=M(),f=k("label"),u=j(`Trips from
      `),c=k("input"),_=j(`
      Trips to`),d=M(),m=k("p"),g=j("Trips "),h=j(v),w=M(),L=j(C),E=j(":"),T=M(),F(A.$$.fragment),z=M(),O=k("hr"),U=M(),Y.c(),N(c,"type","checkbox"),N(c,"role","switch"),N(e,"slot","sidebar")},m(ae,D){$(ae,e,D),P(n,e,null),p(e,t),p(e,l),p(l,i),p(l,s),p(e,a),p(e,f),p(f,u),p(f,c),c.checked=r[1],p(f,_),p(e,d),p(e,m),p(m,g),p(m,h),p(m,w),p(m,L),p(m,E),p(e,T),P(A,e,null),p(e,z),p(e,O),p(e,U),Y.m(e,null),R=!0,B||(H=K(c,"change",r[10]),B=!0)},p(ae,D){(!R||D&1)&&o!==(o=ae[0].features.length.toLocaleString()+"")&&ne(i,o),D&2&&(c.checked=ae[1]),(!R||D&2)&&v!==(v=ae[1]?"from":"to")&&ne(h,v),(!R||D&8)&&C!==(C=ae[3]==null?"each zone":"this zone")&&ne(L,C);const ye={};D&32&&(ye.limits=ae[5]),A.$set(ye),Z===(Z=G(ae))&&Y?Y.p(ae,D):(Y.d(1),Y=Z(ae),Y&&(Y.c(),Y.m(e,null)))},i(ae){R||(b(n.$$.fragment,ae),b(A.$$.fragment,ae),R=!0)},o(ae){S(n.$$.fragment,ae),S(A.$$.fragment,ae),R=!1},d(ae){ae&&y(e),I(n),I(A),Y.d(),B=!1,H()}}}function E_(r){let e,n,t,l,o;const i=[we("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":ut(.5,.1)}},{manageHoverState:!0}];function s(c){r[8](c)}let a={};for(let c=0;c<i.length;c+=1)a=_e(a,i[c]);r[2]!==void 0&&(a.hovered=r[2]),e=new kt({props:a}),Be.push(()=>st(e,"hovered",s));const f=[we("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let u={};for(let c=0;c<f.length;c+=1)u=_e(u,f[c]);return l=new et({props:u}),{c(){F(e.$$.fragment),t=M(),F(l.$$.fragment)},m(c,_){P(e,c,_),$(c,t,_),P(l,c,_),o=!0},p(c,_){const d=_&16?Ne(i,[i[0],{paint:{"fill-color":c[4],"fill-opacity":ut(.5,.1)}},i[2]]):{};!n&&_&4&&(n=!0,d.hovered=c[2],at(()=>n=!1)),e.$set(d);const m={};l.$set(m)},i(c){o||(b(e.$$.fragment,c),b(l.$$.fragment,c),o=!0)},o(c){S(e.$$.fragment,c),S(l.$$.fragment,c),o=!1},d(c){c&&y(t),I(e,c),I(l,c)}}}function N_(r){let e,n,t;return n=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[E_]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),N(e,"slot","map")},m(l,o){$(l,e,o),P(n,e,null),t=!0},p(l,o){const i={};o&1&&(i.data=l[0]),o&65556&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function j_(r){let e,n;return e=new At({props:{$$slots:{map:[N_],sidebar:[I_],top:[A_]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&65791&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function z_(r,e,n){let t,l,o,i,s,a;X(r,ce,C=>n(7,s=C)),X(r,xe,C=>n(13,a=C));let f=Yt();try{f=a.getDemandModel()}catch{window.alert("No demand model for this area"),te(ce,s={mode:"pick-neighbourhood"},s)}let u=!1,c=null;function _(C,L){if(C==null){let E=L?"sum_to":"sum_from",T=Math.max(...f.features.map(z=>z.properties[E])),A=d(T);return[A.map(z=>z.toLocaleString()),jt(["get",E],A,mr)]}else{let E=L?"counts_to":"counts_from",T=[...f.features.map(O=>O.properties[E][C])],A=Math.max(...T),z=d(A);return[z.map(O=>O.toLocaleString()),jt(["at",["id"],["literal",T]],z,mr)]}}function d(C){let L=mr.length+1;return Array.from(Array(L).keys()).map(E=>Math.round(C/(L-1)*E))}function m(C){c=C,n(2,c)}const g=()=>te(ce,s={mode:"pick-neighbourhood"},s);function v(){u=this.checked,n(1,u)}const h=()=>te(ce,s={mode:"title",firstLoad:!1},s),w=()=>te(ce,s={mode:"pick-neighbourhood"},s);return r.$$.update=()=>{r.$$.dirty&4&&n(3,t=c==null?null:c.id),r.$$.dirty&9&&n(6,l=t!=null?f.features[t]:null),r.$$.dirty&10&&n(5,[o,i]=_(t,u),o,(n(4,i),n(3,t),n(1,u),n(2,c)))},[f,u,c,t,i,o,l,s,m,g,v,h,w]}class O_ extends ie{constructor(e){super(),se(this,e,z_,j_,le,{})}}function B_(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function R_(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function D_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[B_]},$$scope:{ctx:r}}}),o.$on("click",r[9]),a=new Le({props:{$$slots:{default:[R_]},$$scope:{ctx:r}}}),a.$on("click",r[10]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),u.textContent="Debug intersections",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){$(_,e,d),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&2048&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&2048&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(o.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&y(e),I(o),I(a)}}}function xo(r){let e,n,t,l,o,i,s;function a(u){r[8](u)}let f={list:r[1].features};return r[2]!==void 0&&(f.idx=r[2]),t=new Ir({props:f}),Be.push(()=>st(t,"idx",a)),{c(){e=k("button"),e.textContent="Pick another intersection",n=M(),F(t.$$.fragment),N(e,"class","secondary")},m(u,c){$(u,e,c),$(u,n,c),P(t,u,c),o=!0,i||(s=K(e,"click",r[7]),i=!0)},p(u,c){const _={};c&2&&(_.list=u[1].features),!l&&c&4&&(l=!0,_.idx=u[2],at(()=>l=!1)),t.$set(_)},i(u){o||(b(t.$$.fragment,u),o=!0)},o(u){S(t.$$.fragment,u),o=!1},d(u){u&&(y(e),y(n)),I(t,u),i=!1,s()}}}function ei(r){let e,n;return{c(){e=k("a"),n=j("Open OSM"),N(e,"href",r[0]),N(e,"target","_blank")},m(t,l){$(t,e,l),p(e,n)},p(t,l){l&1&&N(e,"href",t[0])},d(t){t&&y(e)}}}function U_(r){let e,n,t,l,o,i,s;n=new gn({}),n.$on("click",r[6]);let a=r[1].features.length>0&&xo(r),f=r[0]&&ei(r);return{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("p"),l.textContent="Purple intersections have some kind of turn restriction.",o=M(),a&&a.c(),i=M(),f&&f.c(),N(e,"slot","sidebar")},m(u,c){$(u,e,c),P(n,e,null),p(e,t),p(e,l),p(e,o),a&&a.m(e,null),p(e,i),f&&f.m(e,null),s=!0},p(u,c){u[1].features.length>0?a?(a.p(u,c),c&2&&b(a,1)):(a=xo(u),a.c(),b(a,1),a.m(e,i)):a&&(he(),S(a,1,1,()=>{a=null}),be()),u[0]?f?f.p(u,c):(f=ei(u),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i(u){s||(b(n.$$.fragment,u),b(a),s=!0)},o(u){S(n.$$.fragment,u),S(a),s=!1},d(u){u&&y(e),I(n),a&&a.d(),f&&f.d()}}}function H_(r){let e,n;const t=[we("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),e.$on("click",r[5]),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function G_(r){let e,n,t,l;const o=[we("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new et({props:i});const s=[we("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new kt({props:a}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _=u&4?Ne(s,[s[0],{filter:["==",["id"],f[2]]},s[2]]):{};t.$set(_)},i(f){l||(b(e.$$.fragment,f),b(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&y(n),I(e,f),I(t,f)}}}function W_(r){let e,n,t,l,o;return n=new Ke({props:{data:ct(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[H_]},$$scope:{ctx:r}}}),l=new Ke({props:{data:r[1],generateId:!0,$$slots:{default:[G_]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),N(e,"slot","map")},m(i,s){$(i,e,s),P(n,e,null),p(e,t),P(l,e,null),o=!0},p(i,s){const a={};s&8&&(a.data=ct(i[3]).getAllIntersections()),s&2048&&(a.$$scope={dirty:s,ctx:i}),n.$set(a);const f={};s&2&&(f.data=i[1]),s&2052&&(f.$$scope={dirty:s,ctx:i}),l.$set(f)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&y(e),I(n),I(l)}}}function q_(r){let e,n;return e=new At({props:{$$slots:{map:[W_],sidebar:[U_],top:[D_]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&2079&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function J_(r,e,n){let t,l;X(r,xe,m=>n(3,t=m)),X(r,ce,m=>n(4,l=m));let o=null,i=Yt(),s=0;function a(m){n(0,o=m.detail.features[0].properties.osm),n(1,i=t.getMovements(m.detail.features[0].id)),n(2,s=0)}const f=()=>te(ce,l={mode:"pick-neighbourhood"},l),u=()=>n(1,i=Yt());function c(m){s=m,n(2,s)}return[o,i,s,t,l,a,f,u,c,()=>te(ce,l={mode:"title",firstLoad:!1},l),()=>te(ce,l={mode:"pick-neighbourhood"},l)]}class Y_ extends ie{constructor(e){super(),se(this,e,J_,q_,le,{})}}function Z_(r){let e,n,t,l,o,i;const s=[we("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new kt({props:a});const f=[we("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let u={};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new kt({props:u});const c=[we("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return o=new et({props:_}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment)},m(d,m){P(e,d,m),$(d,n,m),P(t,d,m),$(d,l,m),P(o,d,m),i=!0},p(d,[m]){const g=m&1?Ne(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const v={};t.$set(v);const h={};o.$set(h)},i(d){i||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(o.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),i=!1},d(d){d&&(y(n),y(l)),I(e,d),I(t,d),I(o,d)}}}function K_(r,e,n){let t;return X(r,yr,l=>n(0,t=l)),[t]}class Er extends ie{constructor(e){super(),se(this,e,K_,Z_,le,{})}}function X_(r){let e,n;const t=[we("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new kt({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,[i]){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}class Nr extends ie{constructor(e){super(),se(this,e,null,X_,le,{})}}const V_=r=>({}),ti=r=>({});function ni(r){let e;const n=r[7]["line-popup"],t=De(n,r,r[9],ti);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&512)&&Ue(t,n,l,l[9],e?Ge(n,l[9],o,V_):He(l[9]),ti)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Q_(r){let e,n,t=r[0]&&ni(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,o){l[0]?t?(t.p(l,o),o&1&&b(t,1)):(t=ni(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function x_(r){let e,n,t,l;const o=[we("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new et({props:i});const s=[we("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":ut(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[Q_]},$$scope:{ctx:r}};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new et({props:a}),t.$on("click",r[8]),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),l=!0},p(f,[u]){const c=u&84?Ne(o,[o[0],o[1],{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=u&125?Ne(s,[s[0],s[1],u&124&&{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":f[5](f[3],f[4].maxShortcuts),"line-opacity":ut(1,.5)}},u&1&&{manageHoverState:f[0]},u&1&&{hoverCursor:f[0]?"pointer":void 0}]):{};u&513&&(_.$$scope={dirty:u,ctx:f}),t.$set(_)},i(f){l||(b(e.$$.fragment,f),b(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&y(n),I(e,f),I(t,f)}}}function em(r,e,n){let t,l;X(r,Vr,d=>n(2,t=d)),X(r,yr,d=>n(3,l=d));let{$$slots:o={},$$scope:i}=e,s=hl("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:f=(d,m)=>{}}=e;function u(d,m){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?jt(["get","speed_mph"],ws,vs):m<=2?ut("white","blue"):ut(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",m,"#A32015"],$n.mapFeature.hover.backgroundColor)}function c(d,m,g){return!d||m<=2?fn(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,m,25+g]}const _=d=>a&&f(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&n(0,a=d.interactive),"onClickLine"in d&&n(1,f=d.onClickLine),"$$scope"in d&&n(9,i=d.$$scope)},[a,f,t,l,s,u,c,o,_,i]}class rr extends ie{constructor(e){super(),se(this,e,em,x_,le,{interactive:0,onClickLine:1})}}function tm(r){let e,n,t;const l=[we("turn-restrictions"),{minzoom:13},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(s){r[5](s)}let i={};for(let s=0;s<l.length;s+=1)i=_e(i,l[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new Vn({props:i}),Be.push(()=>st(e,"hovered",o)),{c(){F(e.$$.fragment)},m(s,a){P(e,s,a),t=!0},p(s,a){const f={};!n&&a&1&&(n=!0,f.hovered=s[0],at(()=>n=!1)),e.$set(f)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){I(e,s)}}}function nm(r){let e,n;const t=[we("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function rm(r){let e,n,t,l;return e=new Ke({props:{data:r[1],generateId:!0,$$slots:{default:[tm]},$$scope:{ctx:r}}}),t=new Ke({props:{data:r[2],$$slots:{default:[nm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(o,i){P(e,o,i),$(o,n,i),P(t,o,i),l=!0},p(o,[i]){const s={};i&2&&(s.data=o[1]),i&65&&(s.$$scope={dirty:i,ctx:o}),e.$set(s);const a={};i&4&&(a.data=o[2]),i&64&&(a.$$scope={dirty:i,ctx:o}),t.$set(a)},i(o){l||(b(e.$$.fragment,o),b(t.$$.fragment,o),l=!0)},o(o){S(e.$$.fragment,o),S(t.$$.fragment,o),l=!1},d(o){o&&y(n),I(e,o),I(t,o)}}}function lm(r,e,n){let t,l,o,i;X(r,xe,f=>n(3,o=f)),X(r,Nt,f=>n(4,i=f));let s=null;function a(f){s=f,n(0,s)}return r.$$.update=()=>{r.$$.dirty&1&&n(2,t=s==null?Yt():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(s.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(s.properties.to_geometry),properties:{}}]}),r.$$.dirty&24&&n(1,l=i>0?o.renderTurnRestrictions():Yt())},[s,l,t,o,i,a]}class om extends ie{constructor(e){super(),se(this,e,lm,rm,le,{})}}function im(r){let e;const n=r[3].default,t=De(n,r,r[5],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&32)&&Ue(t,n,l,l[5],e?Ge(n,l[5],o,null):He(l[5]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function sm(r){let e,n,t,l;const o=[we("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{minzoom:fr},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[im]},$$scope:{ctx:r}};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new Vn({props:i}),e.$on("click",r[4]);const s=[we("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:fr},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new Vn({props:a}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),l=!0},p(f,u){const c=u&0?Ne(o,[o[0],o[1],{minzoom:fr},o[3],o[4]]):{};u&32&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _=u&0?Ne(s,[s[0],s[1],{minzoom:fr},s[3],s[4]]):{};t.$set(_)},i(f){l||(b(e.$$.fragment,f),b(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&y(n),I(e,f),I(t,f)}}}function am(r){let e,n,t,l;return e=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[sm]},$$scope:{ctx:r}}}),t=new om({}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(o,i){P(e,o,i),$(o,n,i),P(t,o,i),l=!0},p(o,[i]){const s={};i&1&&(s.data=o[0]),i&32&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){l||(b(e.$$.fragment,o),b(t.$$.fragment,o),l=!0)},o(o){S(e.$$.fragment,o),S(t.$$.fragment,o),l=!1},d(o){o&&y(n),I(e,o),I(t,o)}}}let fr=13;function fm(r,e,n){let t,l,o;X(r,xe,f=>n(1,l=f)),X(r,Nt,f=>n(2,o=f));let{$$slots:i={},$$scope:s}=e;function a(f){ze.call(this,r,f)}return r.$$set=f=>{"$$scope"in f&&n(5,s=f.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=o>0?l.renderModalFilters():Yt())},[t,l,o,i,a,s]}class hn extends ie{constructor(e){super(),se(this,e,fm,am,le,{})}}function um(r){let e,n;const t=[we("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Vn({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,[i]){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}class jr extends ie{constructor(e){super(),se(this,e,null,um,le,{})}}function cm(r){let e;const n=r[3].default,t=De(n,r,r[4],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16)&&Ue(t,n,l,l[4],e?Ge(n,l[4],o,null):He(l[4]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function dm(r){let e,n;return e=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[cm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function _m(r,e,n){let t,l;X(r,xe,a=>n(2,l=a));let{$$slots:o={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&n(1,s=a.input),"$$scope"in a&&n(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=s||l.renderNeighbourhood()),r.$$.dirty&1&&xi("neighbourhoodGj",t)},[t,s,l,o,i]}class lr extends ie{constructor(e){super(),se(this,e,_m,dm,le,{input:1})}}function mm(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function pm(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function gm(r){let e;return{c(){e=j("Editing")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function hm(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Le({props:{$$slots:{default:[mm]},$$scope:{ctx:r}}}),o.$on("click",r[8]),a=new Le({props:{$$slots:{default:[pm]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new Le({props:{$$slots:{default:[gm]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),F(c.$$.fragment),_=M(),d=k("li"),d.textContent="Debug mode",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,v){$(g,e,v),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),P(c,u,null),p(t,_),p(t,d),m=!0},p(g,v){const h={};v&4096&&(h.$$scope={dirty:v,ctx:g}),o.$set(h);const w={};v&4096&&(w.$$scope={dirty:v,ctx:g}),a.$set(w);const C={};v&4096&&(C.$$scope={dirty:v,ctx:g}),c.$set(C)},i(g){m||(b(o.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){S(o.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&y(e),I(o),I(a),I(c)}}}function ri(r){let e,n,t;return{c(){e=k("button"),e.textContent="Ⓧ",N(e,"class","close-btn svelte-khnvno")},m(l,o){$(l,e,o),n||(t=K(e,"click",r[6]),n=!0)},p:Q,d(l){l&&y(e),n=!1,t()}}}function bm(r){let e;return{c(){e=k("p"),e.textContent="Click an intersection to inspect its movements."},m(n,t){$(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&y(e)}}}function $m(r){let e,n,t,l,o,i,s;e=new xn({props:{properties:r[0].feature.properties}});function a(u){r[7](u)}let f={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(f.idx=r[0].movementIdx),o=new Ir({props:f}),Be.push(()=>st(o,"idx",a)),{c(){F(e.$$.fragment),n=M(),t=k("h5"),t.textContent="Turn restrictions:",l=M(),F(o.$$.fragment)},m(u,c){P(e,u,c),$(u,n,c),$(u,t,c),$(u,l,c),P(o,u,c),s=!0},p(u,c){const _={};c&1&&(_.properties=u[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=u[0].movements.features),!i&&c&1&&(i=!0,d.idx=u[0].movementIdx,at(()=>i=!1)),o.$set(d)},i(u){s||(b(e.$$.fragment,u),b(o.$$.fragment,u),s=!0)},o(u){S(e.$$.fragment,u),S(o.$$.fragment,u),s=!1},d(u){u&&(y(n),y(t),y(l)),I(e,u),I(o,u)}}}function ym(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;n=new gn({}),n.$on("click",r[5]);let g=r[0]&&ri(r);const v=[$m,bm],h=[];function w(C,L){return C[0]?0:1}return _=w(r),d=h[_]=v[_](r),{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("h4"),l.textContent="Roads",o=M(),i=k("p"),i.textContent="Click a road to visit its OSM object.",s=M(),a=k("div"),f=k("h4"),f.textContent="Intersections",u=M(),g&&g.c(),c=M(),d.c(),oe(a,"display","flex"),oe(a,"align-items","start"),oe(a,"justify-content","space-between"),N(e,"slot","sidebar")},m(C,L){$(C,e,L),P(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(e,s),p(e,a),p(a,f),p(a,u),g&&g.m(a,null),p(e,c),h[_].m(e,null),m=!0},p(C,L){C[0]?g?g.p(C,L):(g=ri(C),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let E=_;_=w(C),_===E?h[_].p(C,L):(he(),S(h[E],1,1,()=>{h[E]=null}),be(),d=h[_],d?d.p(C,L):(d=h[_]=v[_](C),d.c()),b(d,1),d.m(e,null))},i(C){m||(b(n.$$.fragment,C),b(d),m=!0)},o(C){S(n.$$.fragment,C),S(d),m=!1},d(C){C&&y(e),I(n),g&&g.d(),h[_].d()}}}function vm(r){let e,n;return e=new xn({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function wm(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[vm,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function km(r){let e,n;return e=new xn({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Sm(r){let e,n,t;return n=new dt({props:{openOn:"hover",$$slots:{default:[km,({props:l})=>({11:l}),({props:l})=>l?2048:0]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){$(l,e,o),P(n,e,null),t=!0},p(l,o){const i={};o&6144&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function Cm(r){let e,n,t,l,o,i,s,a,f,u;e=new Nr({}),t=new Er({}),o=new jr({});const c=[we("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[wm]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return s=new on({props:_}),f=new rr({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[Sm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),F(s.$$.fragment),a=M(),F(f.$$.fragment)},m(d,m){P(e,d,m),$(d,n,m),P(t,d,m),$(d,l,m),P(o,d,m),$(d,i,m),P(s,d,m),$(d,a,m),P(f,d,m),u=!0},p(d,m){const g={};m&4096&&(g.$$scope={dirty:m,ctx:d}),s.$set(g);const v={};m&4096&&(v.$$scope={dirty:m,ctx:d}),f.$set(v)},i(d){u||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(o.$$.fragment,d),b(s.$$.fragment,d),b(f.$$.fragment,d),u=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),S(s.$$.fragment,d),S(f.$$.fragment,d),u=!1},d(d){d&&(y(n),y(l),y(i),y(a)),I(e,d),I(t,d),I(o,d),I(s,d),I(f,d)}}}function Lm(r){let e,n;return e=new xn({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Mm(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Lm,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Tm(r){let e,n;return e=new xn({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Am(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Tm,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Fm(r){var o,i,s;let e,n;const t=[we("debug-intersections"),{paint:{"circle-radius":rl(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ut(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(o=r[0])==null?void 0:o.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,ut(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[Am]},$$scope:{ctx:r}};for(let a=0;a<t.length;a+=1)l=_e(l,t[a]);return e=new on({props:l}),e.$on("click",r[3]),{c(){F(e.$$.fragment)},m(a,f){P(e,a,f),n=!0},p(a,f){var c,_,d;const u=f&1?Ne(t,[t[0],{paint:{"circle-radius":rl(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ut(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,ut(0,.5)]}},t[2],t[3]]):{};f&4096&&(u.$$scope={dirty:f,ctx:a}),e.$set(u)},i(a){n||(b(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){I(e,a)}}}function li(r){let e,n;return e=new Ke({props:{data:r[0].movements,generateId:!0,$$slots:{default:[Pm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.data=t[0].movements),l&4097&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Pm(r){let e,n,t,l;const o=[we("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new et({props:i});const s=[we("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new kt({props:a}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _=u&1?Ne(s,[s[0],{filter:["==",["id"],f[0].movementIdx]},s[2]]):{};t.$set(_)},i(f){l||(b(e.$$.fragment,f),b(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&y(n),I(e,f),I(t,f)}}}function Im(r){let e,n,t,l,o,i,s,a;n=new lr({props:{$$slots:{default:[Cm]},$$scope:{ctx:r}}}),l=new hn({props:{$$slots:{default:[Mm]},$$scope:{ctx:r}}}),i=new Ke({props:{data:ct(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[Fm]},$$scope:{ctx:r}}});let f=r[0]&&li(r);return{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),o=M(),F(i.$$.fragment),s=M(),f&&f.c(),N(e,"slot","map")},m(u,c){$(u,e,c),P(n,e,null),p(e,t),P(l,e,null),p(e,o),P(i,e,null),p(e,s),f&&f.m(e,null),a=!0},p(u,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:u}),l.$set(d);const m={};c&2&&(m.data=ct(u[1]).getAllIntersections()),c&4097&&(m.$$scope={dirty:c,ctx:u}),i.$set(m),u[0]?f?(f.p(u,c),c&1&&b(f,1)):(f=li(u),f.c(),b(f,1),f.m(e,null)):f&&(he(),S(f,1,1,()=>{f=null}),be())},i(u){a||(b(n.$$.fragment,u),b(l.$$.fragment,u),b(i.$$.fragment,u),b(f),a=!0)},o(u){S(n.$$.fragment,u),S(l.$$.fragment,u),S(i.$$.fragment,u),S(f),a=!1},d(u){u&&y(e),I(n),I(l),I(i),f&&f.d()}}}function Em(r){let e,n;return e=new At({props:{$$slots:{map:[Im],sidebar:[ym],top:[hm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&4103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Nm(r,e,n){let t,l;X(r,xe,m=>n(1,t=m)),X(r,ce,m=>n(2,l=m));let o=null;function i(m){let g=m.detail.features[0],v=t.getMovements(g.properties.intersection_id);n(0,o={feature:g,movements:v,movementIdx:0})}const s=(m,g)=>window.open(ct(m.properties).way,"_blank"),a=()=>te(ce,l={mode:"neighbourhood"},l),f=()=>n(0,o=null);function u(m){r.$$.not_equal(o.movementIdx,m)&&(o.movementIdx=m,n(0,o))}return[o,t,l,i,s,a,f,u,()=>te(ce,l={mode:"title",firstLoad:!1},l),()=>te(ce,l={mode:"pick-neighbourhood"},l),()=>te(ce,l={mode:"neighbourhood"},l)]}class jm extends ie{constructor(e){super(),se(this,e,Nm,Em,le,{})}}var Et=63710088e-1,Ms={centimeters:Et*100,centimetres:Et*100,degrees:360/(2*Math.PI),feet:Et*3.28084,inches:Et*39.37,kilometers:Et/1e3,kilometres:Et/1e3,meters:Et,metres:Et,miles:Et/1609.344,millimeters:Et*1e3,millimetres:Et*1e3,nauticalmiles:Et/1852,radians:1,yards:Et*1.0936};function zm(r,e,n={}){const t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function dl(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!oi(r[0])||!oi(r[1]))throw new Error("coordinates must contain numbers");return zm({type:"Point",coordinates:r},e,n)}function Om(r,e="kilometers"){const n=Ms[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Bm(r,e="kilometers"){const n=Ms[e];if(!n)throw new Error(e+" units is invalid");return r/n}function _l(r){return r%(2*Math.PI)*180/Math.PI}function qt(r){return r%360*Math.PI/180}function oi(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Qn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Rm(r){return r.type==="Feature"?r.geometry:r}function Ts(r,e,n={}){if(n.final===!0)return Dm(r,e);const t=Qn(r),l=Qn(e),o=qt(t[0]),i=qt(l[0]),s=qt(t[1]),a=qt(l[1]),f=Math.sin(i-o)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-o);return _l(Math.atan2(f,u))}function Dm(r,e){let n=Ts(e,r);return n=(n+180)%360,n}function Um(r,e,n,t={}){const l=Qn(r),o=qt(l[0]),i=qt(l[1]),s=qt(n),a=Bm(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=_l(u),_=_l(f);return dl([c,_],t.properties)}function Hm(r,e,n={}){var t=Qn(r),l=Qn(e),o=qt(l[1]-t[1]),i=qt(l[0]-t[0]),s=qt(t[1]),a=qt(l[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return Om(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function Gm(r,e,n={}){const l=Rm(r).coordinates;let o=0;for(let i=0;i<l.length&&!(e>=o&&i===l.length-1);i++)if(o>=e){const s=e-o;if(s){const a=Ts(l[i],l[i-1])-180;return Um(l[i],s,a,n)}else return dl(l[i])}else o+=Hm(l[i],l[i+1],n);return dl(l[l.length-1])}var Wm=Gm;function qm(r){let e,n;const t=[we("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Jm(r){let e,n;return e=new Ke({props:{data:r[0],$$slots:{default:[qm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}let Ym=50,Zm=100,Km=.01;function Xm(r,e,n){let{paths:t}=e,l=a(),o=f(),i=c(),s=setInterval(_,Zm);Tt(()=>clearInterval(s));function a(){return t.features.map(d=>1/d.properties.directness).reduce((d,m)=>d+m,0)}function f(){return t.features.length==0?[]:Array.from({length:Ym},u)}function u(){let d=Math.random()*l,m=0;for(let[g,v]of t.features.entries())if(m+=1/v.properties.directness,d<m)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function c(){return{type:"FeatureCollection",features:o.map(({idx:d,distance:m})=>Wm(t.features[d],m,{units:"kilometers"}))}}function _(){for(let[d,m]of o.entries())m.distance+=Km,m.distance>=t.features[m.idx].properties.length_meters/1e3&&(o[d]=u());n(0,i=c())}return r.$$set=d=>{"paths"in d&&n(1,t=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&t&&(l=a(),o=f())},[i,t]}class Vm extends ie{constructor(e){super(),se(this,e,Xm,Jm,le,{paths:1})}}class Qm{constructor(e){pt(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function xm(r){let e,n,t,l,o;return{c(){e=k("div"),e.textContent="+",n=M(),t=k("img"),o=j(`
    Add diagonal filter`),oe(e,"font-size","200%"),oe(e,"margin-top","-12px"),N(e,"class","icon"),Ve(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Add diagonal filter"),oe(t,"transform","rotate(135deg)"),N(t,"class","svelte-j2s60j")},m(i,s){$(i,e,s),$(i,n,s),$(i,t,s),$(i,o,s)},p:Q,d(i){i&&(y(e),y(n),y(t),y(o))}}}function ep(r){let e;function n(o,i){return o[0].hasRotatedFilter?np:tp}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),$(o,e,i)},p(o,i){t!==(t=n(o))&&(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},d(o){o&&y(e),l.d(o)}}}function tp(r){let e,n,t,l,o;return{c(){e=k("div"),e.textContent="↻",n=M(),t=k("img"),o=j(`
      Rotate diagonal filter`),oe(e,"font-size","200%"),oe(e,"padding-bottom","4px"),N(e,"class","icon"),Ve(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Rotate diagonal filter"),oe(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){$(i,e,s),$(i,n,s),$(i,t,s),$(i,o,s)},d(i){i&&(y(e),y(n),y(t),y(o))}}}function np(r){let e,n,t,l,o;return{c(){e=k("div"),e.textContent="❌",n=M(),t=k("img"),o=j(`
      Delete diagonal filter`),N(e,"class","icon"),Ve(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Remove diagonal filter"),oe(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){$(i,e,s),$(i,n,s),$(i,t,s),$(i,o,s)},d(i){i&&(y(e),y(n),y(t),y(o))}}}function rp(r){let e;function n(o,i){return o[0].filter?ep:xm}let t=n(r),l=t(r);return{c(){e=k("div"),l.c(),oe(e,"display","flex"),oe(e,"align-items","center")},m(o,i){$(o,e,i),l.m(e,null)},p(o,[i]){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e,null)))},i:Q,o:Q,d(o){o&&y(e),l.d()}}}function lp(r,e,n){let{intersection:t}=e;return r.$$set=l=>{"intersection"in l&&n(0,t=l.intersection)},[t]}class op extends ie{constructor(e){super(),se(this,e,lp,rp,le,{intersection:0})}}function ip(r){let e,n;return e=new op({props:{intersection:r[2](r[6])}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&64&&(o.intersection=t[2](t[6])),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function sp(r){let e,n;return e=new xf({props:{openOn:"hover",$$slots:{default:[ip,({features:t})=>({6:t}),({features:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function ap(r){let e,n;const t=[we("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":rl(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-opacity":ut(0,.5),"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ut(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[sp]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),e.$on("click",r[4]),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,[i]){const s=i&2?Ne(t,[t[0],t[1],t[2],{interactive:o[1]},t[4],t[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function fp(r,e,n){let{neighbourhood:t=hl("neighbourhoodGj")}=e,{onClickIntersection:l=f=>{}}=e,{interactive:o=!1}=e;function i(f){let u=t.features[f];return new Qm(u)}function s(f){return i(f[0].id)}const a=f=>l(s(f.detail.features));return r.$$set=f=>{"neighbourhood"in f&&n(3,t=f.neighbourhood),"onClickIntersection"in f&&n(0,l=f.onClickIntersection),"interactive"in f&&n(1,o=f.interactive)},[l,o,s,t,a]}class up extends ie{constructor(e){super(),se(this,e,fp,ap,le,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function ii(r,e,n){const t=r.slice();return t[7]=e[n][0],t[8]=e[n][1],t[9]=e[n][2],t}function si(r){let e,n,t,l,o,i,s=r[8]+"",a,f,u,c,_;function d(){return r[3](r[7])}return{c(){e=k("button"),n=k("img"),l=M(),o=k("br"),i=M(),a=j(s),f=M(),Ve(n.src,t=`/ltn//filters/${r[7]}_icon.gif`)||N(n,"src",t),N(n,"width","80"),N(n,"alt",r[8]),N(e,"class","outline"),oe(e,"width","100%"),e.disabled=u=r[0]==r[7]},m(m,g){$(m,e,g),p(e,n),p(e,l),p(e,o),p(e,i),p(e,a),p(e,f),c||(_=K(e,"click",d),c=!0)},p(m,g){r=m,g&1&&u!==(u=r[0]==r[7])&&(e.disabled=u)},d(m){m&&y(e),c=!1,_()}}}function cp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d=r[1][2]+"",m,g,v,h,w,C,L=Me(r[2]),E=[];for(let A=0;A<L.length;A+=1)E[A]=si(ii(r,L,A));function T(){return r[4](r[6])}return{c(){e=k("h3"),e.textContent="Choose a modal filter to place on streets",n=M(),t=k("table"),l=k("tr"),o=k("td");for(let A=0;A<E.length;A+=1)E[A].c();i=M(),s=k("td"),a=k("img"),c=M(),_=k("p"),m=j(d),g=M(),v=k("center"),h=k("button"),h.textContent="Confirm",Ve(a.src,f=`/ltn//filters/${r[0]}.gif`)||N(a,"src",f),N(a,"height","300"),N(a,"alt",u=r[1][1])},m(A,z){$(A,e,z),$(A,n,z),$(A,t,z),p(t,l),p(l,o);for(let O=0;O<E.length;O+=1)E[O]&&E[O].m(o,null);p(l,i),p(l,s),p(s,a),p(s,c),p(s,_),p(_,m),$(A,g,z),$(A,v,z),p(v,h),w||(C=K(h,"click",T),w=!0)},p(A,z){if(r=A,z&5){L=Me(r[2]);let O;for(O=0;O<L.length;O+=1){const U=ii(r,L,O);E[O]?E[O].p(U,z):(E[O]=si(U),E[O].c(),E[O].m(o,null))}for(;O<E.length;O+=1)E[O].d(1);E.length=L.length}z&1&&!Ve(a.src,f=`/ltn//filters/${r[0]}.gif`)&&N(a,"src",f),z&2&&u!==(u=r[1][1])&&N(a,"alt",u),z&2&&d!==(d=r[1][2]+"")&&ne(m,d)},d(A){A&&(y(e),y(n),y(t),y(g),y(v)),ft(E,A),w=!1,C()}}}function dp(r){let e,n;return e=new Mr({props:{$$slots:{default:[cp,({dialog:t})=>({6:t}),({dialog:t})=>t?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&4163&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function _p(r,e,n){let t,l;X(r,Qr,f=>n(0,l=f));let o=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const i=f=>te(Qr,l=f,l),s=f=>ct(f).close();function a(f){ze.call(this,r,f)}return r.$$.update=()=>{r.$$.dirty&1&&n(1,t=o.find(f=>f[0]==l))},[l,t,o,i,s,a]}class mp extends ie{constructor(e){super(),se(this,e,_p,dp,le,{})}}function ai(r){let e,n;return e=new Ke({props:{data:r[0],$$slots:{default:[pp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.data=t[0]),l&64&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function pp(r){let e,n;const t=[we("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function gp(r){let e,n,t=r[0]&&ai(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&b(t,1)):(t=ai(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function hp(r,e,n){let{map:t}=e,l=null;const o=pn();t.on("dragstart",i),t.on("mousemove",s),t.on("mouseup",a),Tt(()=>{t.dragPan.enable(),t.off("dragstart",i),t.off("mousemove",s),t.off("mouseup",a)});function i(){t.dragPan.disable(),n(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(f){l&&(l.geometry.coordinates.push(f.lngLat.toArray()),n(0,l))}function a(){l&&(o("done",l),n(0,l=null))}return r.$$set=f=>{"map"in f&&n(1,t=f.map)},[l,t]}class bp extends ie{constructor(e){super(),se(this,e,hp,gp,le,{map:1})}}function $p(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function yp(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function vp(r){let e;return{c(){e=k("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function wp(r){let e;return{c(){e=j("View shortcuts")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function kp(r){let e;return{c(){e=j("Route")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Sp(r){let e;return{c(){e=j("Impact routing to one destination")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Cp(r){let e;return{c(){e=j("Change this boundary")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Lp(r){let e;return{c(){e=j("Debug")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Mp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v,h,w,C,L,E,T,A,z,O,U,R,B,H,G;return o=new Le({props:{$$slots:{default:[$p]},$$scope:{ctx:r}}}),o.$on("click",r[31]),a=new Le({props:{$$slots:{default:[yp]},$$scope:{ctx:r}}}),a.$on("click",r[32]),_=new zt({props:{$$slots:{default:[vp]},$$scope:{ctx:r}}}),h=new Le({props:{$$slots:{default:[wp]},$$scope:{ctx:r}}}),h.$on("click",r[33]),L=new Le({props:{$$slots:{default:[kp]},$$scope:{ctx:r}}}),L.$on("click",r[34]),A=new Le({props:{$$slots:{default:[Sp]},$$scope:{ctx:r}}}),A.$on("click",r[35]),U=new Le({props:{$$slots:{default:[Cp]},$$scope:{ctx:r}}}),U.$on("click",r[36]),H=new Le({props:{$$slots:{default:[Lp]},$$scope:{ctx:r}}}),H.$on("click",r[37]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),c=j(`Editing
          `),F(_.$$.fragment),d=M(),m=k("nav"),g=k("ul"),v=k("li"),F(h.$$.fragment),w=M(),C=k("li"),F(L.$$.fragment),E=M(),T=k("li"),F(A.$$.fragment),z=M(),O=k("li"),F(U.$$.fragment),R=M(),B=k("li"),F(H.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),oe(e,"display","flex"),oe(e,"justify-content","space-between")},m(Z,Y){$(Z,e,Y),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),p(u,c),P(_,u,null),p(e,d),p(e,m),p(m,g),p(g,v),P(h,v,null),p(g,w),p(g,C),P(L,C,null),p(g,E),p(g,T),P(A,T,null),p(g,z),p(g,O),P(U,O,null),p(g,R),p(g,B),P(H,B,null),G=!0},p(Z,Y){const ae={};Y[1]&1024&&(ae.$$scope={dirty:Y,ctx:Z}),o.$set(ae);const D={};Y[1]&1024&&(D.$$scope={dirty:Y,ctx:Z}),a.$set(D);const ye={};Y[1]&1024&&(ye.$$scope={dirty:Y,ctx:Z}),_.$set(ye);const ge={};Y[1]&1024&&(ge.$$scope={dirty:Y,ctx:Z}),h.$set(ge);const fe={};Y[1]&1024&&(fe.$$scope={dirty:Y,ctx:Z}),L.$set(fe);const ve={};Y[1]&1024&&(ve.$$scope={dirty:Y,ctx:Z}),A.$set(ve);const ue={};Y[1]&1024&&(ue.$$scope={dirty:Y,ctx:Z}),U.$set(ue);const Fe={};Y[1]&1024&&(Fe.$$scope={dirty:Y,ctx:Z}),H.$set(Fe)},i(Z){G||(b(o.$$.fragment,Z),b(a.$$.fragment,Z),b(_.$$.fragment,Z),b(h.$$.fragment,Z),b(L.$$.fragment,Z),b(A.$$.fragment,Z),b(U.$$.fragment,Z),b(H.$$.fragment,Z),G=!0)},o(Z){S(o.$$.fragment,Z),S(a.$$.fragment,Z),S(_.$$.fragment,Z),S(h.$$.fragment,Z),S(L.$$.fragment,Z),S(A.$$.fragment,Z),S(U.$$.fragment,Z),S(H.$$.fragment,Z),G=!1},d(Z){Z&&y(e),I(o),I(a),I(_),I(h),I(L),I(A),I(U),I(H)}}}function fi(r){let e;return{c(){e=k("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function ui(r){let e,n;return e=new kn({props:{colorScale:vs,limits:ws}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Tp(r){let e,n,t;return{c(){e=j("Undo ("),n=j(r[4]),t=j(")")},m(l,o){$(l,e,o),$(l,n,o),$(l,t,o)},p(l,o){o[0]&16&&ne(n,l[4])},d(l){l&&(y(e),y(n),y(t))}}}function Ap(r){let e;return{c(){e=j("Undo")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function Fp(r){let e,n,t;return{c(){e=j("Redo ("),n=j(r[5]),t=j(")")},m(l,o){$(l,e,o),$(l,n,o),$(l,t,o)},p(l,o){o[0]&32&&ne(n,l[5])},d(l){l&&(y(e),y(n),y(t))}}}function Pp(r){let e;return{c(){e=j("Redo")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function ci(r){let e,n;return e=new mp({}),e.$on("close",r[30]),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ip(r){let e,n,t,l,o=ct(r[6]).properties.name+"",i,s,a=ct(r[6]).properties.area_km2.toFixed(1)+"",f,u,c,_,d,m,g,v,h,w,C,L,E,T,A,z,O,U,R,B,H,G,Z,Y,ae,D,ye,ge,fe,ve,ue,Fe,Ze,Te,re,Je,je,ke,V,me,x,pe,$e,Se,q,_t,Re,We,St,bt=r[8]>0&&fi(),Qe=r[12]=="speeds"&&ui();function en(Pe,lt){return Pe[4]==0?Ap:Tp}let tn=en(r),Ct=tn(r);function ir(Pe,lt){return Pe[5]==0?Pp:Fp}let Ft=ir(r),Pt=Ft(r),rt=r[3]&&ci(r);return{c(){e=k("div"),n=k("p"),t=j("Editing neighbourhood "),l=k("u"),i=j(o),s=j(`
      , with an area of `),f=j(a),u=j(" km²"),c=M(),bt&&bt.c(),_=M(),d=k("div"),m=k("button"),g=k("img"),h=j(`
        Add a modal filter`),C=M(),L=k("button"),E=j("Add many modal filters along line"),A=M(),z=k("button"),O=j("Reverse directions"),R=M(),B=k("button"),B.textContent="Change modal filter type",H=M(),G=k("label"),Z=k("input"),Y=j(`
      Animate shortcuts`),ae=M(),D=k("label"),ye=k("input"),ge=j(`
      Include perimeter roads`),fe=M(),ve=k("div"),ue=k("label"),Fe=j(`Draw roads:
        `),Ze=k("select"),Te=k("option"),Te.textContent="Worst shortcuts",re=k("option"),re.textContent="Cell",Je=k("option"),Je.textContent="Edits (either filter or direction)",je=k("option"),je.textContent="Speed limit",ke=M(),Qe&&Qe.c(),V=M(),me=k("div"),x=k("button"),Ct.c(),$e=M(),Se=k("button"),Pt.c(),_t=M(),rt&&rt.c(),Ve(g.src,v=`/ltn//filters/${r[9]}_icon.gif`)||N(g,"src",v),N(g,"width","30"),N(g,"alt","Add a modal filter"),m.disabled=w=r[0]=="filter",N(m,"data-tooltip","hotkey 1"),L.disabled=T=r[0]=="freehand-filters",N(L,"data-tooltip","hotkey 2"),z.disabled=U=r[0]=="oneway",N(z,"data-tooltip","hotkey 3"),oe(d,"display","flex"),oe(d,"justify-content","space-between"),N(Z,"type","checkbox"),N(ye,"type","checkbox"),Te.__value="shortcuts",Oe(Te,Te.__value),re.__value="cells",Oe(re,re.__value),Je.__value="edits",Oe(Je,Je.__value),je.__value="speeds",Oe(je,je.__value),r[12]===void 0&&un(()=>r[29].call(Ze)),oe(ve,"border","1px solid black"),oe(ve,"padding","4px"),x.disabled=pe=r[4]==0,N(x,"data-tooltip","Ctrl+Z"),Se.disabled=q=r[5]==0,N(Se,"data-tooltip","Ctrl+Y"),oe(me,"display","flex"),oe(me,"justify-content","space-between"),N(e,"slot","sidebar")},m(Pe,lt){$(Pe,e,lt),p(e,n),p(n,t),p(n,l),p(l,i),p(n,s),p(n,f),p(n,u),p(e,c),bt&&bt.m(e,null),p(e,_),p(e,d),p(d,m),p(m,g),p(m,h),p(d,C),p(d,L),p(L,E),p(d,A),p(d,z),p(z,O),p(e,R),p(e,B),p(e,H),p(e,G),p(G,Z),Z.checked=r[11],p(G,Y),p(e,ae),p(e,D),p(D,ye),ye.checked=r[10],p(D,ge),p(e,fe),p(e,ve),p(ve,ue),p(ue,Fe),p(ue,Ze),p(Ze,Te),p(Ze,re),p(Ze,Je),p(Ze,je),vt(Ze,r[12],!0),p(ve,ke),Qe&&Qe.m(ve,null),p(e,V),p(e,me),p(me,x),Ct.m(x,null),p(me,$e),p(me,Se),Pt.m(Se,null),p(e,_t),rt&&rt.m(e,null),Re=!0,We||(St=[K(m,"click",r[23]),K(L,"click",r[24]),K(z,"click",r[25]),K(B,"click",r[26]),K(Z,"change",r[27]),K(ye,"change",r[28]),K(ye,"change",r[14]),K(Ze,"change",r[29]),K(x,"click",r[19]),K(Se,"click",r[20])],We=!0)},p(Pe,lt){(!Re||lt[0]&64)&&o!==(o=ct(Pe[6]).properties.name+"")&&ne(i,o),(!Re||lt[0]&64)&&a!==(a=ct(Pe[6]).properties.area_km2.toFixed(1)+"")&&ne(f,a),Pe[8]>0?bt||(bt=fi(),bt.c(),bt.m(e,_)):bt&&(bt.d(1),bt=null),(!Re||lt[0]&512&&!Ve(g.src,v=`/ltn//filters/${Pe[9]}_icon.gif`))&&N(g,"src",v),(!Re||lt[0]&1&&w!==(w=Pe[0]=="filter"))&&(m.disabled=w),(!Re||lt[0]&1&&T!==(T=Pe[0]=="freehand-filters"))&&(L.disabled=T),(!Re||lt[0]&1&&U!==(U=Pe[0]=="oneway"))&&(z.disabled=U),lt[0]&2048&&(Z.checked=Pe[11]),lt[0]&1024&&(ye.checked=Pe[10]),lt[0]&4096&&vt(Ze,Pe[12]),Pe[12]=="speeds"?Qe?lt[0]&4096&&b(Qe,1):(Qe=ui(),Qe.c(),b(Qe,1),Qe.m(ve,null)):Qe&&(he(),S(Qe,1,1,()=>{Qe=null}),be()),tn===(tn=en(Pe))&&Ct?Ct.p(Pe,lt):(Ct.d(1),Ct=tn(Pe),Ct&&(Ct.c(),Ct.m(x,null))),(!Re||lt[0]&16&&pe!==(pe=Pe[4]==0))&&(x.disabled=pe),Ft===(Ft=ir(Pe))&&Pt?Pt.p(Pe,lt):(Pt.d(1),Pt=Ft(Pe),Pt&&(Pt.c(),Pt.m(Se,null))),(!Re||lt[0]&32&&q!==(q=Pe[5]==0))&&(Se.disabled=q),Pe[3]?rt?(rt.p(Pe,lt),lt[0]&8&&b(rt,1)):(rt=ci(Pe),rt.c(),b(rt,1),rt.m(e,null)):rt&&(he(),S(rt,1,1,()=>{rt=null}),be())},i(Pe){Re||(b(Qe),b(rt),Re=!0)},o(Pe){S(Qe),S(rt),Re=!1},d(Pe){Pe&&y(e),bt&&bt.d(),Qe&&Qe.d(),Ct.d(),Pt.d(),rt&&rt.d(),We=!1,nt(St)}}}function Ep(r){let e;return{c(){e=k("p"),e.textContent="Click to change direction"},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function Np(r){let e,n,t,l;return{c(){e=k("div"),n=k("img"),l=j(`
                Click to add modal filter`),Ve(n.src,t=`/ltn//filters/${r[9]}_icon.gif`)||N(n,"src",t),N(n,"width","20"),N(n,"alt","Add modal filter")},m(o,i){$(o,e,i),p(e,n),p(e,l)},p(o,i){i[0]&512&&!Ve(n.src,t=`/ltn//filters/${o[9]}_icon.gif`)&&N(n,"src",t)},d(o){o&&y(e)}}}function jp(r){let e,n=r[40].shortcuts+"",t,l,o=(r[40].name??"unnamed road")+"",i,s,a=Math.round(r[40].speed_mph)+"",f,u,c,_;function d(v,h){return v[0]=="filter"?Np:Ep}let m=d(r),g=m(r);return{c(){e=k("p"),t=j(n),l=j(" shortcuts through "),i=j(o),s=j(`
              (`),f=j(a),u=j(" mph)"),c=M(),g.c(),_=Ye()},m(v,h){$(v,e,h),p(e,t),p(e,l),p(e,i),p(e,s),p(e,f),p(e,u),$(v,c,h),g.m(v,h),$(v,_,h)},p(v,h){h[1]&512&&n!==(n=v[40].shortcuts+"")&&ne(t,n),h[1]&512&&o!==(o=(v[40].name??"unnamed road")+"")&&ne(i,o),h[1]&512&&a!==(a=Math.round(v[40].speed_mph)+"")&&ne(f,a),m===(m=d(v))&&g?g.p(v,h):(g.d(1),g=m(v),g&&(g.c(),g.m(_.parentNode,_)))},d(v){v&&(y(e),y(c),y(_)),g.d(v)}}}function zp(r){let e,n,t;return n=new dt({props:{openOn:"hover",$$slots:{default:[jp,({props:l})=>({40:l}),({props:l})=>[0,l?512:0]]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){$(l,e,o),P(n,e,null),t=!0},p(l,o){const i={};o[0]&513|o[1]&1536&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function Op(r){let e,n,t,l,o,i,s,a,f,u;return e=new Nr({}),t=new Er({}),o=new jr({}),s=new rr({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[zp]},$$scope:{ctx:r}}}),f=new up({props:{interactive:r[0]=="filter",neighbourhood:r[1],onClickIntersection:r[17]}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),F(s.$$.fragment),a=M(),F(f.$$.fragment)},m(c,_){P(e,c,_),$(c,n,_),P(t,c,_),$(c,l,_),P(o,c,_),$(c,i,_),P(s,c,_),$(c,a,_),P(f,c,_),u=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0]=="filter"||c[0]=="oneway"),_[0]&513|_[1]&1024&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const m={};_[0]&1&&(m.interactive=c[0]=="filter"),_[0]&2&&(m.neighbourhood=c[1]),f.$set(m)},i(c){u||(b(e.$$.fragment,c),b(t.$$.fragment,c),b(o.$$.fragment,c),b(s.$$.fragment,c),b(f.$$.fragment,c),u=!0)},o(c){S(e.$$.fragment,c),S(t.$$.fragment,c),S(o.$$.fragment,c),S(s.$$.fragment,c),S(f.$$.fragment,c),u=!1},d(c){c&&(y(n),y(l),y(i),y(a)),I(e,c),I(t,c),I(o,c),I(s,c),I(f,c)}}}function di(r){let e,n;return e=new Vm({props:{paths:r[7]}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l[0]&128&&(o.paths=t[7]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Bp(r){let e;return{c(){e=j("Click to delete")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Rp(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Bp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l[1]&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function _i(r){let e,n;return e=new bp({props:{map:ct(r[2])}}),e.$on("done",r[21]),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l[0]&4&&(o.map=ct(t[2])),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Dp(r){let e,n,t,l,o,i,s;n=new lr({props:{input:r[1],$$slots:{default:[Op]},$$scope:{ctx:r}}});let a=r[11]&&di(r);o=new hn({props:{$$slots:{default:[Rp]},$$scope:{ctx:r}}}),o.$on("click",r[16]);let f=r[0]=="freehand-filters"&&_i(r);return{c(){e=k("div"),F(n.$$.fragment),t=M(),a&&a.c(),l=M(),F(o.$$.fragment),i=M(),f&&f.c(),N(e,"slot","map")},m(u,c){$(u,e,c),P(n,e,null),p(e,t),a&&a.m(e,null),p(e,l),P(o,e,null),p(e,i),f&&f.m(e,null),s=!0},p(u,c){const _={};c[0]&2&&(_.input=u[1]),c[0]&515|c[1]&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_),u[11]?a?(a.p(u,c),c[0]&2048&&b(a,1)):(a=di(u),a.c(),b(a,1),a.m(e,l)):a&&(he(),S(a,1,1,()=>{a=null}),be());const d={};c[1]&1024&&(d.$$scope={dirty:c,ctx:u}),o.$set(d),u[0]=="freehand-filters"?f?(f.p(u,c),c[0]&1&&b(f,1)):(f=_i(u),f.c(),b(f,1),f.m(e,null)):f&&(he(),S(f,1,1,()=>{f=null}),be())},i(u){s||(b(n.$$.fragment,u),b(a),b(o.$$.fragment,u),b(f),s=!0)},o(u){S(n.$$.fragment,u),S(a),S(o.$$.fragment,u),S(f),s=!1},d(u){u&&y(e),I(n),a&&a.d(),I(o),f&&f.d()}}}function Up(r){let e,n,t,l;return e=new At({props:{$$slots:{map:[Dp],sidebar:[Ip],top:[Mp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0,t||(l=K(window,"keydown",r[18]),t=!0)},p(o,i){const s={};i[0]&16383|i[1]&1024&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o),t=!1,l()}}}function Hp(r,e,n){let t,l,o,i,s,a,f,u,c;X(r,Nt,re=>n(22,l=re)),X(r,Qr,re=>n(9,o=re)),X(r,xe,re=>n(38,i=re)),X(r,Jn,re=>n(10,s=re)),X(r,xt,re=>n(2,a=re)),X(r,Fl,re=>n(11,f=re)),X(r,yr,re=>n(12,u=re)),X(r,ce,re=>n(13,c=re));let _="filter",d=!1,m=0,g=0,v,h,w=i.getAllShortcuts();Tt(()=>{a.doubleClickZoom.enable()});function C(re){n(1,h=i.renderNeighbourhood()),n(6,v=h.features.find(Je=>Je.properties.kind=="boundary")),n(4,m=h.undo_length),n(5,g=h.redo_length),n(7,w=i.getAllShortcuts()),Tn()}function L(){i.setCurrentNeighbourhood(v.properties.name,s),te(Nt,l++,l)}function E(re,Je){_=="filter"?(i.addModalFilter(Je,o),te(Nt,l++,l)):_=="oneway"&&(i.toggleTravelFlow(re.properties.road),te(Nt,l++,l))}function T(re){let Je=re.detail.features[0];i.deleteModalFilter(Je.properties.road),te(Nt,l++,l)}function A(re){if(_!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${_}`);return}re.hasRotatedFilter?(i.deleteDiagonalFilter(re),te(Nt,l++,l)):re.filter?(i.rotateDiagonalFilter(re),te(Nt,l++,l)):(i.addDiagonalFilter(re),te(Nt,l++,l))}function z(re){re.target.tagName!="INPUT"&&(re.ctrlKey&&re.key=="z"&&O(),re.ctrlKey&&re.key=="y"&&U(),re.key=="1"&&n(0,_="filter"),re.key=="2"&&n(0,_="freehand-filters"),re.key=="3"&&n(0,_="oneway"))}function O(){i.undo(),te(Nt,l++,l)}function U(){i.redo(),te(Nt,l++,l)}function R(re){let Je=re.detail;Je&&(i.addManyModalFilters(Je,o),te(Nt,l++,l)),n(0,_="filter")}const B=()=>n(0,_="filter"),H=()=>n(0,_="freehand-filters"),G=()=>n(0,_="oneway"),Z=()=>n(3,d=!0);function Y(){f=this.checked,Fl.set(f)}function ae(){s=this.checked,Jn.set(s)}function D(){u=cn(this),yr.set(u)}const ye=()=>n(3,d=!1),ge=()=>te(ce,c={mode:"title",firstLoad:!1},c),fe=()=>te(ce,c={mode:"pick-neighbourhood"},c),ve=()=>te(ce,c={mode:"view-shortcuts"},c),ue=()=>te(ce,c={mode:"route",prevMode:"neighbourhood"},c),Fe=()=>te(ce,c={mode:"impact-one-destination"},c),Ze=()=>te(ce,c={mode:"set-boundary",name:ct(v).properties.name,existing:v},c),Te=()=>te(ce,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(_=="oneway"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&4194304&&C(),r.$$.dirty[0]&2&&n(8,t=h.features.filter(re=>re.properties.kind=="cell"&&re.properties.cell_color=="disconnected").length)},[_,h,a,d,m,g,v,w,t,o,s,f,u,c,L,E,T,A,z,O,U,R,l,B,H,G,Z,Y,ae,D,ye,ge,fe,ve,ue,Fe,Ze,Te]}class Gp extends ie{constructor(e){super(),se(this,e,Hp,Up,le,{},null,[-1,-1])}}function Wp(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function qp(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Jp(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[Wp]},$$scope:{ctx:r}}}),o.$on("click",r[7]),a=new Le({props:{$$slots:{default:[qp]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){$(_,e,d),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(o.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&y(e),I(o),I(a)}}}function Yp(r){let e;return{c(){e=j("Pick a different road")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Zp(r){let e,n,t,l,o,i,s,a;n=new Le({props:{$$slots:{default:[Yp]},$$scope:{ctx:r}}}),n.$on("click",r[5]);function f(c){r[6](c)}let u={list:r[2]};return r[0]!==void 0&&(u.idx=r[0]),l=new Ir({props:u}),Be.push(()=>st(l,"idx",f)),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),i=M(),s=k("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,N(e,"slot","sidebar")},m(c,_){$(c,e,_),P(n,e,null),p(e,t),P(l,e,null),p(e,i),p(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),n.$set(d);const m={};!o&&_&1&&(o=!0,m.idx=c[0],at(()=>o=!1)),l.$set(m)},i(c){a||(b(n.$$.fragment,c),b(l.$$.fragment,c),a=!0)},o(c){S(n.$$.fragment,c),S(l.$$.fragment,c),a=!1},d(c){c&&y(e),I(n),I(l)}}}function Kp(r){let e,n;const t=[we("predict-impact"),{paint:{"line-width":Gt(["get","kind"],{focus:8},5),"line-color":Gt(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Gt(["get","kind"],{focus:1},.5)}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Xp(r){let e;return{c(){e=j("A")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Vp(r){let e;return{c(){e=j("B")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Qp(r){let e,n,t,l,o,i,s,a,f;return n=new Ke({props:{data:r[3](r[0]),$$slots:{default:[Kp]},$$scope:{ctx:r}}}),l=new wn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[Xp]},$$scope:{ctx:r}}}),i=new wn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[Vp]},$$scope:{ctx:r}}}),a=new hn({}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),o=M(),F(i.$$.fragment),s=M(),F(a.$$.fragment),N(e,"slot","map")},m(u,c){$(u,e,c),P(n,e,null),p(e,t),P(l,e,null),p(e,o),P(i,e,null),p(e,s),P(a,e,null),f=!0},p(u,c){const _={};c&1&&(_.data=u[3](u[0])),c&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&1&&(d.lngLat=u[2][u[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:u}),l.$set(d);const m={};c&1&&(m.lngLat=u[2][u[0]][0].geometry.coordinates[u[2][u[0]][0].geometry.coordinates.length-1]),c&1024&&(m.$$scope={dirty:c,ctx:u}),i.$set(m)},i(u){f||(b(n.$$.fragment,u),b(l.$$.fragment,u),b(i.$$.fragment,u),b(a.$$.fragment,u),f=!0)},o(u){S(n.$$.fragment,u),S(l.$$.fragment,u),S(i.$$.fragment,u),S(a.$$.fragment,u),f=!1},d(u){u&&y(e),I(n),I(l),I(i),I(a)}}}function xp(r){let e,n;return e=new At({props:{$$slots:{map:[Qp],sidebar:[Zp],top:[Jp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&1027&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function eg(r,e,n){let t,l;X(r,xe,d=>n(9,t=d)),X(r,ce,d=>n(1,l=d));let{road:o}=e;o.properties.kind="focus";let i=t.getImpactsOnRoad(o.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],o]}}const f=()=>te(ce,l={mode:"predict-impact"},l);function u(d){s=d,n(0,s)}const c=()=>te(ce,l={mode:"title",firstLoad:!1},l),_=()=>te(ce,l={mode:"pick-neighbourhood"},l);return r.$$set=d=>{"road"in d&&n(4,o=d.road)},[s,l,i,a,o,f,u,c,_]}class tg extends ie{constructor(e){super(),se(this,e,eg,xp,le,{road:4})}}function ng(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function rg(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function lg(r){let e;return{c(){e=j("Editing")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function og(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Le({props:{$$slots:{default:[ng]},$$scope:{ctx:r}}}),o.$on("click",r[12]),a=new Le({props:{$$slots:{default:[rg]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new Le({props:{$$slots:{default:[lg]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),F(c.$$.fragment),_=M(),d=k("li"),d.textContent="Impact routing to one destination",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,v){$(g,e,v),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),P(c,u,null),p(t,_),p(t,d),m=!0},p(g,v){const h={};v&262144&&(h.$$scope={dirty:v,ctx:g}),o.$set(h);const w={};v&262144&&(w.$$scope={dirty:v,ctx:g}),a.$set(w);const C={};v&262144&&(C.$$scope={dirty:v,ctx:g}),c.$set(C)},i(g){m||(b(o.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){S(o.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&y(e),I(o),I(a),I(c)}}}function ig(r){let e,n,t,l,o,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",f,u;return n=new gn({}),n.$on("click",r[5]),{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=M(),i=k("p"),s=j("Highest ratio is "),f=j(a),N(e,"slot","sidebar")},m(c,_){$(c,e,_),P(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(i,s),p(i,f),u=!0},p(c,_){(!u||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&ne(f,a)},i(c){u||(b(n.$$.fragment,c),u=!0)},o(c){S(n.$$.fragment,c),u=!1},d(c){c&&y(e),I(n)}}}function sg(r){let e,n;const t=[we("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new kt({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function ag(r){let e,n=_n(r[17].distance_before)+"",t,l,o=mn(r[17].time_before)+"",i,s,a,f,u=_n(r[17].distance_after)+"",c,_,d=mn(r[17].time_after)+"",m,g,v,h,w,C=(r[17].time_after/r[17].time_before).toFixed(1)+"",L;return{c(){e=k("p"),t=j(n),l=j(", "),i=j(o),s=j(" before"),a=M(),f=k("p"),c=j(u),_=j(", "),m=j(d),g=j(" after"),v=M(),h=k("p"),w=j("Time ratio: "),L=j(C)},m(E,T){$(E,e,T),p(e,t),p(e,l),p(e,i),p(e,s),$(E,a,T),$(E,f,T),p(f,c),p(f,_),p(f,m),p(f,g),$(E,v,T),$(E,h,T),p(h,w),p(h,L)},p(E,T){T&131072&&n!==(n=_n(E[17].distance_before)+"")&&ne(t,n),T&131072&&o!==(o=mn(E[17].time_before)+"")&&ne(i,o),T&131072&&u!==(u=_n(E[17].distance_after)+"")&&ne(c,u),T&131072&&d!==(d=mn(E[17].time_after)+"")&&ne(m,d),T&131072&&C!==(C=(E[17].time_after/E[17].time_before).toFixed(1)+"")&&ne(L,C)},d(E){E&&(y(e),y(a),y(f),y(v),y(h))}}}function fg(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[ag,({props:t})=>({17:t}),({props:t})=>t?131072:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&393216&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function ug(r){let e,n,t;const l=[we("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[9](s)}let i={$$slots:{default:[fg]},$$scope:{ctx:r}};for(let s=0;s<l.length;s+=1)i=_e(i,l[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new et({props:i}),Be.push(()=>st(e,"hovered",o)),e.$on("click",r[10]),{c(){F(e.$$.fragment)},m(s,a){P(e,s,a),t=!0},p(s,a){const f=a&8?Ne(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},l[2]]):{};a&262144&&(f.$$scope={dirty:a,ctx:s}),!n&&a&1&&(n=!0,f.hovered=s[0],at(()=>n=!1)),e.$set(f)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){I(e,s)}}}function cg(r){let e,n;const t=[we("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Gt(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function dg(r){let e;return{c(){e=j("X")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function _g(r){let e,n,t,l,o,i,s,a,f,u,c,_;n=new lr({props:{$$slots:{default:[sg]},$$scope:{ctx:r}}}),l=new Ke({props:{data:r[3],generateId:!0,$$slots:{default:[ug]},$$scope:{ctx:r}}}),i=new Ke({props:{data:r[2],$$slots:{default:[cg]},$$scope:{ctx:r}}}),a=new hn({});function d(g){r[11](g)}let m={draggable:!0,$$slots:{default:[dg]},$$scope:{ctx:r}};return r[1]!==void 0&&(m.lngLat=r[1]),u=new wn({props:m}),Be.push(()=>st(u,"lngLat",d)),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),o=M(),F(i.$$.fragment),s=M(),F(a.$$.fragment),f=M(),F(u.$$.fragment),N(e,"slot","map")},m(g,v){$(g,e,v),P(n,e,null),p(e,t),P(l,e,null),p(e,o),P(i,e,null),p(e,s),P(a,e,null),p(e,f),P(u,e,null),_=!0},p(g,v){const h={};v&262144&&(h.$$scope={dirty:v,ctx:g}),n.$set(h);const w={};v&8&&(w.data=g[3]),v&262153&&(w.$$scope={dirty:v,ctx:g}),l.$set(w);const C={};v&4&&(C.data=g[2]),v&262144&&(C.$$scope={dirty:v,ctx:g}),i.$set(C);const L={};v&262144&&(L.$$scope={dirty:v,ctx:g}),!c&&v&2&&(c=!0,L.lngLat=g[1],at(()=>c=!1)),u.$set(L)},i(g){_||(b(n.$$.fragment,g),b(l.$$.fragment,g),b(i.$$.fragment,g),b(a.$$.fragment,g),b(u.$$.fragment,g),_=!0)},o(g){S(n.$$.fragment,g),S(l.$$.fragment,g),S(i.$$.fragment,g),S(a.$$.fragment,g),S(u.$$.fragment,g),_=!1},d(g){g&&y(e),I(n),I(l),I(i),I(a),I(u)}}}function mg(r){let e,n,t,l;return e=new hs({}),e.$on("contextmenu",r[7]),t=new At({props:{$$slots:{map:[_g],sidebar:[ig],top:[og]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(o,i){P(e,o,i),$(o,n,i),P(t,o,i),l=!0},p(o,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){l||(b(e.$$.fragment,o),b(t.$$.fragment,o),l=!0)},o(o){S(e.$$.fragment,o),S(t.$$.fragment,o),l=!1},d(o){o&&y(n),I(e,o),I(t,o)}}}function pg(r,e,n){let t,l,o,i,s,a,f;X(r,cr,L=>n(1,o=L)),X(r,ce,L=>n(4,i=L)),X(r,Yn,L=>n(14,s=L)),X(r,Zn,L=>n(15,a=L)),X(r,xe,L=>n(8,f=L));function u(){te(ce,i={mode:"neighbourhood"},i)}let c=null;function _(L){return L?f.compareRoute(new xr.LngLat(L.properties.pt1_x,L.properties.pt1_y),o,1):Yt()}function d(L){te(Zn,a=new xr.LngLat(L.properties.pt1_x,L.properties.pt1_y),a),te(Yn,s=o,s),te(ce,i={mode:"route",prevMode:"impact-one-destination"},i)}function m(L){te(cr,o=L.detail.lngLat,o)}function g(L){c=L,n(0,c)}const v=L=>d(L.detail.features[0]);function h(L){o=L,cr.set(o)}const w=()=>te(ce,i={mode:"title",firstLoad:!1},i),C=()=>te(ce,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&n(3,t=f.impactToOneDestination(o)),r.$$.dirty&1&&n(2,l=_(c))},[c,o,l,t,i,u,d,m,f,g,v,h,w,C]}class gg extends ie{constructor(e){super(),se(this,e,pg,mg,le,{})}}function mi(r,e,n){const t=r.slice();return t[32]=e[n].properties.name,t[33]=e[n].properties.area_km2,t[34]=e[n].properties.simd,t}function hg(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function bg(r){let e;return{c(){e=k("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function $g(r){let e;return{c(){e=j("Route")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function yg(r){let e;return{c(){e=j("Predict impact")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function vg(r){let e;return{c(){e=j("Debug intersections")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function wg(r){let e;return{c(){e=j("Debug demand")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function kg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v,h,w,C,L,E,T,A,z;return o=new Le({props:{$$slots:{default:[hg]},$$scope:{ctx:r}}}),o.$on("click",r[25]),f=new zt({props:{$$slots:{default:[bg]},$$scope:{ctx:r}}}),m=new Le({props:{$$slots:{default:[$g]},$$scope:{ctx:r}}}),m.$on("click",r[26]),h=new Le({props:{$$slots:{default:[yg]},$$scope:{ctx:r}}}),h.$on("click",r[27]),L=new Le({props:{$$slots:{default:[vg]},$$scope:{ctx:r}}}),L.$on("click",r[28]),A=new Le({props:{$$slots:{default:[wg]},$$scope:{ctx:r}}}),A.$on("click",r[29]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),a=j(`Pick neighbourhood
          `),F(f.$$.fragment),u=M(),c=k("nav"),_=k("ul"),d=k("li"),F(m.$$.fragment),g=M(),v=k("li"),F(h.$$.fragment),w=M(),C=k("li"),F(L.$$.fragment),E=M(),T=k("li"),F(A.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),oe(e,"display","flex"),oe(e,"justify-content","space-between")},m(O,U){$(O,e,U),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),p(s,a),P(f,s,null),p(e,u),p(e,c),p(c,_),p(_,d),P(m,d,null),p(_,g),p(_,v),P(h,v,null),p(_,w),p(_,C),P(L,C,null),p(_,E),p(_,T),P(A,T,null),z=!0},p(O,U){const R={};U[1]&64&&(R.$$scope={dirty:U,ctx:O}),o.$set(R);const B={};U[1]&64&&(B.$$scope={dirty:U,ctx:O}),f.$set(B);const H={};U[1]&64&&(H.$$scope={dirty:U,ctx:O}),m.$set(H);const G={};U[1]&64&&(G.$$scope={dirty:U,ctx:O}),h.$set(G);const Z={};U[1]&64&&(Z.$$scope={dirty:U,ctx:O}),L.$set(Z);const Y={};U[1]&64&&(Y.$$scope={dirty:U,ctx:O}),A.$set(Y)},i(O){z||(b(o.$$.fragment,O),b(f.$$.fragment,O),b(m.$$.fragment,O),b(h.$$.fragment,O),b(L.$$.fragment,O),b(A.$$.fragment,O),z=!0)},o(O){S(o.$$.fragment,O),S(f.$$.fragment,O),S(m.$$.fragment,O),S(h.$$.fragment,O),S(L.$$.fragment,O),S(A.$$.fragment,O),z=!1},d(O){O&&y(e),I(o),I(f),I(m),I(h),I(L),I(A)}}}function Sg(r){let e=r[32]+"",n;return{c(){n=j(e)},m(t,l){$(t,n,l)},p(t,l){l[0]&1&&e!==(e=t[32]+"")&&ne(n,e)},d(t){t&&y(n)}}}function Cg(r){let e,n,t,l=r[34].toFixed(1)+"",o;return{c(){e=k("span"),n=k("b"),n.textContent="SIMD (percentile):",t=M(),o=j(l)},m(i,s){$(i,e,s),p(e,n),p(e,t),p(e,o)},p(i,s){s[0]&1&&l!==(l=i[34].toFixed(1)+"")&&ne(o,l)},d(i){i&&y(e)}}}function Lg(r){let e,n,t,l=r[33].toFixed(1)+"",o,i;return{c(){e=k("span"),n=k("b"),n.textContent="Area:",t=M(),o=j(l),i=j(" km²")},m(s,a){$(s,e,a),p(e,n),p(e,t),p(e,o),p(e,i)},p(s,a){a[0]&1&&l!==(l=s[33].toFixed(1)+"")&&ne(o,l)},d(s){s&&y(e)}}}function pi(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g;function v(){return r[18](r[32])}l=new Le({props:{$$slots:{default:[Sg]},$$scope:{ctx:r}}}),l.$on("click",v),a=new Sl({props:{color:"black"}});function h(){return r[19](r[32])}c=new bs({props:{color:"white"}});function w(){return r[20](r[32])}function C(A,z){if(A[1]=="area")return Lg;if(A[1]=="simd")return Cg}let L=C(r),E=L&&L(r);function T(){return r[21](r[32])}return{c(){var A;e=k("li"),n=k("span"),t=k("span"),F(l.$$.fragment),o=M(),i=k("span"),s=k("button"),F(a.$$.fragment),f=M(),u=k("button"),F(c.$$.fragment),_=M(),E&&E.c(),N(t,"class","neighbourhood-name svelte-v2avug"),N(s,"class","outline icon-btn"),N(s,"aria-label","Rename neighbourhood"),N(u,"class","icon-btn destructive"),N(u,"aria-label","Delete neighbourhood"),oe(i,"display","flex"),oe(i,"gap","16px"),oe(n,"display","flex"),oe(n,"justify-content","space-between"),N(e,"class","svelte-v2avug"),gt(e,"highlighted",((A=r[3])==null?void 0:A.properties.name)==r[32])},m(A,z){$(A,e,z),p(e,n),p(n,t),P(l,t,null),p(n,o),p(n,i),p(i,s),P(a,s,null),p(i,f),p(i,u),P(c,u,null),p(e,_),E&&E.m(e,null),d=!0,m||(g=[K(s,"click",h),K(u,"click",w),K(e,"mouseenter",T),K(e,"mouseleave",r[22])],m=!0)},p(A,z){var U;r=A;const O={};z[0]&1|z[1]&64&&(O.$$scope={dirty:z,ctx:r}),l.$set(O),L===(L=C(r))&&E?E.p(r,z):(E&&E.d(1),E=L&&L(r),E&&(E.c(),E.m(e,null))),(!d||z[0]&9)&&gt(e,"highlighted",((U=r[3])==null?void 0:U.properties.name)==r[32])},i(A){d||(b(l.$$.fragment,A),b(a.$$.fragment,A),b(c.$$.fragment,A),d=!0)},o(A){S(l.$$.fragment,A),S(a.$$.fragment,A),S(c.$$.fragment,A),d=!1},d(A){A&&y(e),I(l),I(a),I(c),E&&E.d(),m=!1,nt(g)}}}function Mg(r){let e,n,t;return e=new Sl({}),{c(){F(e.$$.fragment),n=j(`
              Draw a new boundary`)},m(l,o){P(e,l,o),$(l,n,o),t=!0},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){l&&y(n),I(e,l)}}}function Tg(r){let e,n,t;return e=new Iu({}),{c(){F(e.$$.fragment),n=j(`
              Use a generated boundary`)},m(l,o){P(e,l,o),$(l,n,o),t=!0},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){l&&y(n),I(e,l)}}}function gi(r){let e,n,t,l,o,i,s,a,f;function u(_){r[24](_)}let c={};return r[1]!==void 0&&(c.selectedPrioritization=r[1]),o=new Ls({props:c}),Be.push(()=>st(o,"selectedPrioritization",u)),{c(){e=k("h3"),e.textContent="Prioritization",n=M(),t=k("p"),t.textContent="Compare metrics across your neighbourhoods.",l=M(),F(o.$$.fragment),s=M(),a=k("hr")},m(_,d){$(_,e,d),$(_,n,d),$(_,t,d),$(_,l,d),P(o,_,d),$(_,s,d),$(_,a,d),f=!0},p(_,d){const m={};!i&&d[0]&2&&(i=!0,m.selectedPrioritization=_[1],at(()=>i=!1)),o.$set(m)},i(_){f||(b(o.$$.fragment,_),f=!0)},o(_){S(o.$$.fragment,_),f=!1},d(_){_&&(y(e),y(n),y(t),y(l),y(s),y(a)),I(o,_)}}}function Ag(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g=r[5].startsWith("ltn_cnt/"),v,h,w,C,L,E,T=r[4].modalFilters+"",A,z,O,U,R=r[4].deletedModalFilters+"",B,H,G,Z,Y=r[4].travelFlows+"",ae,D,ye,ge,fe,ve,ue,Fe,Ze,Te=Me(r[0].features),re=[];for(let ke=0;ke<Te.length;ke+=1)re[ke]=pi(mi(r,Te,ke));const Je=ke=>S(re[ke],1,1,()=>{re[ke]=null});u=new Le({props:{$$slots:{default:[Mg]},$$scope:{ctx:r}}}),u.$on("click",r[10]),d=new Le({props:{$$slots:{default:[Tg]},$$scope:{ctx:r}}}),d.$on("click",r[23]);let je=g&&gi(r);return{c(){e=k("div"),n=k("h3"),n.textContent="Neighbourhoods",t=M(),l=k("ul");for(let ke=0;ke<re.length;ke+=1)re[ke].c();o=M(),i=k("li"),s=j(`Add a new neighbourhood:
        `),a=k("ul"),f=k("li"),F(u.$$.fragment),c=M(),_=k("li"),F(d.$$.fragment),m=M(),je&&je.c(),v=M(),h=k("p"),w=j("Current project: "),C=j(r[5]),L=M(),E=k("p"),A=j(T),z=j(" new modal filter(s) added"),O=M(),U=k("p"),B=j(R),H=j(`
      existing modal filter(s) removed`),G=M(),Z=k("p"),ae=j(Y),D=j(" road segment direction(s) changed"),ye=M(),ge=k("button"),ge.textContent="Export project to GeoJSON",fe=M(),ve=k("button"),ve.textContent="Debug route-snapper",oe(n,"padding","4px 8px"),oe(n,"margin-bottom","0"),oe(f,"list-style","none"),oe(_,"list-style","none"),oe(a,"margin-bottom","0"),oe(a,"padding","0"),N(i,"class","svelte-v2avug"),N(l,"class","neighbourhood-list svelte-v2avug"),N(ve,"class","secondary"),N(e,"slot","sidebar")},m(ke,V){$(ke,e,V),p(e,n),p(e,t),p(e,l);for(let me=0;me<re.length;me+=1)re[me]&&re[me].m(l,null);p(l,o),p(l,i),p(i,s),p(i,a),p(a,f),P(u,f,null),p(a,c),p(a,_),P(d,_,null),p(e,m),je&&je.m(e,null),p(e,v),p(e,h),p(h,w),p(h,C),p(e,L),p(e,E),p(E,A),p(E,z),p(e,O),p(e,U),p(U,B),p(U,H),p(e,G),p(e,Z),p(Z,ae),p(Z,D),p(e,ye),p(e,ge),p(e,fe),p(e,ve),ue=!0,Fe||(Ze=[K(ge,"click",r[11]),K(ve,"click",r[12])],Fe=!0)},p(ke,V){if(V[0]&911){Te=Me(ke[0].features);let pe;for(pe=0;pe<Te.length;pe+=1){const $e=mi(ke,Te,pe);re[pe]?(re[pe].p($e,V),b(re[pe],1)):(re[pe]=pi($e),re[pe].c(),b(re[pe],1),re[pe].m(l,o))}for(he(),pe=Te.length;pe<re.length;pe+=1)Je(pe);be()}const me={};V[1]&64&&(me.$$scope={dirty:V,ctx:ke}),u.$set(me);const x={};V[1]&64&&(x.$$scope={dirty:V,ctx:ke}),d.$set(x),V[0]&32&&(g=ke[5].startsWith("ltn_cnt/")),g?je?(je.p(ke,V),V[0]&32&&b(je,1)):(je=gi(ke),je.c(),b(je,1),je.m(e,v)):je&&(he(),S(je,1,1,()=>{je=null}),be()),(!ue||V[0]&32)&&ne(C,ke[5]),(!ue||V[0]&16)&&T!==(T=ke[4].modalFilters+"")&&ne(A,T),(!ue||V[0]&16)&&R!==(R=ke[4].deletedModalFilters+"")&&ne(B,R),(!ue||V[0]&16)&&Y!==(Y=ke[4].travelFlows+"")&&ne(ae,Y)},i(ke){if(!ue){for(let V=0;V<Te.length;V+=1)b(re[V]);b(u.$$.fragment,ke),b(d.$$.fragment,ke),b(je),ue=!0}},o(ke){re=re.filter(Boolean);for(let V=0;V<re.length;V+=1)S(re[V]);S(u.$$.fragment,ke),S(d.$$.fragment,ke),S(je),ue=!1},d(ke){ke&&y(e),ft(re,ke),I(u),I(d),je&&je.d(),Fe=!1,nt(Ze)}}}function Fg(r){let e,n,t=r[31].simd.toFixed(1)+"",l;return{c(){e=k("b"),e.textContent="Fake SIMD:",n=M(),l=j(t)},m(o,i){$(o,e,i),$(o,n,i),$(o,l,i)},p(o,i){i[1]&1&&t!==(t=o[31].simd.toFixed(1)+"")&&ne(l,t)},d(o){o&&(y(e),y(n),y(l))}}}function Pg(r){let e,n,t=r[31].area_km2.toFixed(1)+"",l,o;return{c(){e=k("b"),e.textContent="Area:",n=M(),l=j(t),o=j(" km²")},m(i,s){$(i,e,s),$(i,n,s),$(i,l,s),$(i,o,s)},p(i,s){s[1]&1&&t!==(t=i[31].area_km2.toFixed(1)+"")&&ne(l,t)},d(i){i&&(y(e),y(n),y(l),y(o))}}}function Ig(r){let e,n=r[31].name+"",t,l,o;function i(f,u){if(f[1]=="none"||f[1]=="area")return Pg;if(f[1]=="simd")return Fg}let s=i(r),a=s&&s(r);return{c(){e=k("h2"),t=j(n),l=M(),a&&a.c(),o=Ye()},m(f,u){$(f,e,u),p(e,t),$(f,l,u),a&&a.m(f,u),$(f,o,u)},p(f,u){u[1]&1&&n!==(n=f[31].name+"")&&ne(t,n),s===(s=i(f))&&a?a.p(f,u):(a&&a.d(1),a=s&&s(f),a&&(a.c(),a.m(o.parentNode,o)))},d(f){f&&(y(e),y(l),y(o)),a&&a.d(f)}}}function Eg(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Ig,({props:t})=>({31:t}),({props:t})=>[0,t?1:0]]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l[0]&2|l[1]&65&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ng(r){let e,n,t,l,o;e=new Wf({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const i=[we("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function s(f){r[16](f)}let a={$$slots:{default:[Eg]},$$scope:{ctx:r}};for(let f=0;f<i.length;f+=1)a=_e(a,i[f]);return r[3]!==void 0&&(a.hovered=r[3]),t=new kt({props:a}),Be.push(()=>st(t,"hovered",s)),t.$on("click",r[17]),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),o=!0},p(f,u){const c={};u[0]&4&&(c.data=f[2]?[{name:f[2],highlight:"yes"}]:[]),e.$set(c);const _=u[0]&24578?Ne(i,[i[0],i[1],{paint:{"fill-color":f[13](f[1]),"fill-opacity":f[14](f[1])}},i[3],i[4]]):{};u[0]&2|u[1]&64&&(_.$$scope={dirty:u,ctx:f}),!l&&u[0]&8&&(l=!0,_.hovered=f[3],at(()=>l=!1)),t.$set(_)},i(f){o||(b(e.$$.fragment,f),b(t.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),o=!1},d(f){f&&y(n),I(e,f),I(t,f)}}}function jg(r){let e,n,t,l,o;return n=new Ke({props:{data:r[0],promoteId:"name",$$slots:{default:[Ng]},$$scope:{ctx:r}}}),l=new hn({}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),N(e,"slot","map")},m(i,s){$(i,e,s),P(n,e,null),p(e,t),P(l,e,null),o=!0},p(i,s){const a={};s[0]&1&&(a.data=i[0]),s[0]&14|s[1]&64&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&y(e),I(n),I(l)}}}function zg(r){let e,n;return e=new At({props:{$$slots:{map:[jg],sidebar:[Ag],top:[kg]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l[0]&127|l[1]&64&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Og(r){let e=0,n=0,t=0;for(let l of r.features)l.properties.kind=="modal_filter"?e++:l.properties.kind=="deleted_existing_modal_filter"?n++:l.properties.kind=="travel_flow"&&t++;return{modalFilters:e,deletedModalFilters:n,travelFlows:t}}function Bg(r,e,n){let t,l,o,i,s,a;X(r,xe,D=>n(15,o=D)),X(r,Zt,D=>n(5,i=D)),X(r,ce,D=>n(6,s=D)),X(r,Jn,D=>n(30,a=D));let f="none",u=null,c=null;function _(D){o.setCurrentNeighbourhood(D,a),te(ce,s={mode:"neighbourhood"},s)}function d(D){window.confirm(`Really delete neighbourhood ${D}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(D),Tn(),n(0,t=o.getAllNeighbourhoods()))}function m(D){let ye=cl(o,`Rename neighbourhood ${D} to what?`,D);ye&&(o.renameNeighbourhoodBoundary(D,ye),Tn(),n(0,t=o.getAllNeighbourhoods()))}function g(){let D=cl(o,"What do you want to name the neighbourhood?","");D&&te(ce,s={mode:"set-boundary",name:D,existing:null},s)}function v(){vr(i+".geojson",JSON.stringify(o.toSavefile()))}function h(){vr("debug_route_snapper.geojson",o.toRouteSnapperGj())}function w(D){let ye={none:"black",simd:jt(["get","simd"],nr,ln),area:jt(["get","area_km2"],Cl,ln)}[D];return["case",["==",["feature-state","highlight"],"yes"],"yellow",ye]}function C(D){return{none:ut(.3,.5),simd:ut(.7,.9),area:ut(.7,.9)}[D]}function L(D){c=D,n(3,c)}const E=D=>_(ct(D.detail.features[0].properties).name),T=D=>_(D),A=D=>m(D),z=D=>d(D),O=D=>n(2,u=D),U=()=>n(2,u=null),R=()=>te(ce,s={mode:"auto-boundaries"},s);function B(D){f=D,n(1,f)}const H=()=>te(ce,s={mode:"title",firstLoad:!1},s),G=()=>te(ce,s={mode:"route",prevMode:"pick-neighbourhood"},s),Z=()=>te(ce,s={mode:"predict-impact"},s),Y=()=>te(ce,s={mode:"debug-intersections"},s),ae=()=>te(ce,s={mode:"debug-demand"},s);return r.$$.update=()=>{r.$$.dirty[0]&32768&&n(0,t=o.getAllNeighbourhoods()),r.$$.dirty[0]&1&&n(4,l=Og(t))},[t,f,u,c,l,i,s,_,d,m,g,v,h,w,C,o,L,E,T,A,z,O,U,R,B,H,G,Z,Y,ae]}class Rg extends ie{constructor(e){super(),se(this,e,Bg,zg,le,{},null,[-1,-1])}}function Dg(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Ug(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Hg(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[Dg]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Le({props:{$$slots:{default:[Ug]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){$(_,e,d),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(o.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&y(e),I(o),I(a)}}}function Gg(r){let e,n,t,l,o,i,s,a,f;return n=new gn({}),n.$on("click",r[5]),{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("p"),l.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,o=M(),i=k("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=M(),a=k("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,N(e,"slot","sidebar")},m(u,c){$(u,e,c),P(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(e,s),p(e,a),f=!0},p:Q,i(u){f||(b(n.$$.fragment,u),f=!0)},o(u){S(n.$$.fragment,u),f=!1},d(u){u&&y(e),I(n)}}}function Wg(r){let e,n=r[9].before.toLocaleString()+"",t,l,o=r[9].after.toLocaleString()+"",i,s,a,f,u=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=k("p"),t=j(n),l=j(" before, "),i=j(o),s=j(`
            after`),a=M(),f=k("p"),c=j(u),_=j("%")},m(d,m){$(d,e,m),p(e,t),p(e,l),p(e,i),p(e,s),$(d,a,m),$(d,f,m),p(f,c),p(f,_)},p(d,m){m&512&&n!==(n=d[9].before.toLocaleString()+"")&&ne(t,n),m&512&&o!==(o=d[9].after.toLocaleString()+"")&&ne(i,o),m&512&&u!==(u=Math.round(100*d[9].after/d[9].before)+"")&&ne(c,u)},d(d){d&&(y(e),y(a),y(f))}}}function qg(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Wg,({props:t})=>({9:t}),({props:t})=>t?512:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&1536&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Jg(r){let e,n;const t=[we("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,hi,r[2].max_count,bi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[qg]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),e.$on("click",r[4]),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s=i&6?Ne(t,[t[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,hi,o[2].max_count,bi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,o[1][0],50,o[1][1],100,o[1][2],150,o[1][3],200,o[1][4]]]}},t[2],t[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Yg(r){let e,n,t,l,o;return n=new Ke({props:{data:r[2],generateId:!0,$$slots:{default:[Jg]},$$scope:{ctx:r}}}),l=new hn({}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),N(e,"slot","map")},m(i,s){$(i,e,s),P(n,e,null),p(e,t),P(l,e,null),o=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&y(e),I(n),I(l)}}}function Zg(r){let e,n;return e=new At({props:{$$slots:{map:[Yg],sidebar:[Gg],top:[Hg]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&1025&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}let hi=3,bi=10;function Kg(r,e,n){let t,l;X(r,ce,_=>n(0,t=_)),X(r,xe,_=>n(8,l=_));let o=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=l.predictImpact();function s(_){te(ce,t={mode:"impact-detail",road:_},t)}return[t,o,i,s,_=>s(_.detail.features[0]),()=>te(ce,t={mode:"pick-neighbourhood"},t),()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class Xg extends ie{constructor(e){super(),se(this,e,Kg,Zg,le,{})}}function Vg(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Qg(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function $i(r){let e,n,t;return n=new Le({props:{$$slots:{default:[xg]},$$scope:{ctx:r}}}),n.$on("click",r[13]),{c(){e=k("li"),F(n.$$.fragment)},m(l,o){$(l,e,o),P(n,e,null),t=!0},p(l,o){const i={};o&16384&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function xg(r){let e;return{c(){e=j("Editing")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function e1(r){let e,n,t,l,o,i,s,a,f,u,c,_;o=new Le({props:{$$slots:{default:[Vg]},$$scope:{ctx:r}}}),o.$on("click",r[11]),a=new Le({props:{$$slots:{default:[Qg]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&$i(r);return{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),d&&d.c(),u=M(),c=k("li"),c.textContent="Routing",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(m,g){$(m,e,g),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),d&&d.m(t,null),p(t,u),p(t,c),_=!0},p(m,g){const v={};g&16384&&(v.$$scope={dirty:g,ctx:m}),o.$set(v);const h={};g&16384&&(h.$$scope={dirty:g,ctx:m}),a.$set(h),m[0]=="neighbourhood"?d?(d.p(m,g),g&1&&b(d,1)):(d=$i(m),d.c(),b(d,1),d.m(t,u)):d&&(he(),S(d,1,1,()=>{d=null}),be())},i(m){_||(b(o.$$.fragment,m),b(a.$$.fragment,m),b(d),_=!0)},o(m){S(o.$$.fragment,m),S(a.$$.fragment,m),S(d),_=!1},d(m){m&&y(e),I(o),I(a),d&&d.d()}}}function yi(r){let e,n,t,l=_n(r[4].features[0].properties.distance)+"",o,i,s=mn(r[4].features[0].properties.time)+"",a,f,u,c,_,d=_n(r[4].features[1].properties.distance)+"",m,g,v=mn(r[4].features[1].properties.time)+"",h;return{c(){e=k("p"),n=k("span"),n.textContent="Route before",t=j(`
        : `),o=j(l),i=j(", "),a=j(s),f=M(),u=k("p"),c=k("span"),c.textContent="Route after",_=j(`
        : `),m=j(d),g=j(", "),h=j(v),oe(n,"color","red"),oe(c,"color","blue")},m(w,C){$(w,e,C),p(e,n),p(e,t),p(e,o),p(e,i),p(e,a),$(w,f,C),$(w,u,C),p(u,c),p(u,_),p(u,m),p(u,g),p(u,h)},p(w,C){C&16&&l!==(l=_n(w[4].features[0].properties.distance)+"")&&ne(o,l),C&16&&s!==(s=mn(w[4].features[0].properties.time)+"")&&ne(a,s),C&16&&d!==(d=_n(w[4].features[1].properties.distance)+"")&&ne(m,d),C&16&&v!==(v=mn(w[4].features[1].properties.time)+"")&&ne(h,v)},d(w){w&&(y(e),y(f),y(u))}}}function t1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v;n=new gn({}),n.$on("click",r[6]);let h=r[4].features.length==2&&yi(r);return{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("p"),l.textContent="Drag markers for a route",o=M(),h&&h.c(),i=M(),s=k("label"),a=j("Slow-down factor for main roads: "),f=j(r[1]),u=M(),c=k("input"),_=M(),d=k("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,N(c,"type","range"),N(c,"min","1.0"),N(c,"max","5.0"),N(c,"step","0.1"),N(e,"slot","sidebar")},m(w,C){$(w,e,C),P(n,e,null),p(e,t),p(e,l),p(e,o),h&&h.m(e,null),p(e,i),p(e,s),p(s,a),p(s,f),p(s,u),p(s,c),Oe(c,r[1]),p(e,_),p(e,d),m=!0,g||(v=[K(c,"change",r[10]),K(c,"input",r[10])],g=!0)},p(w,C){w[4].features.length==2?h?h.p(w,C):(h=yi(w),h.c(),h.m(e,i)):h&&(h.d(1),h=null),(!m||C&2)&&ne(f,w[1]),C&2&&Oe(c,w[1])},i(w){m||(b(n.$$.fragment,w),m=!0)},o(w){S(n.$$.fragment,w),m=!1},d(w){w&&y(e),I(n),h&&h.d(),g=!1,nt(v)}}}function vi(r){let e,n;return e=new lr({props:{$$slots:{default:[n1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function n1(r){let e,n,t,l,o,i,s,a;return e=new Nr({}),t=new Er({}),o=new jr({}),s=new rr({props:{interactive:!1}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),F(s.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),$(f,l,u),P(o,f,u),$(f,i,u),P(s,f,u),a=!0},p:Q,i(f){a||(b(e.$$.fragment,f),b(t.$$.fragment,f),b(o.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),S(o.$$.fragment,f),S(s.$$.fragment,f),a=!1},d(f){f&&(y(n),y(l),y(i)),I(e,f),I(t,f),I(o,f),I(s,f)}}}function r1(r){let e,n;const t=[we("compare-route"),{paint:{"line-width":10,"line-color":Gt(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function l1(r){let e;return{c(){e=j("A")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function o1(r){let e;return{c(){e=j("B")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function i1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d=r[0]=="neighbourhood"&&vi(r);t=new hn({}),o=new Ke({props:{data:r[4],$$slots:{default:[r1]},$$scope:{ctx:r}}});function m(w){r[8](w)}let g={draggable:!0,$$slots:{default:[l1]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new wn({props:g}),Be.push(()=>st(s,"lngLat",m));function v(w){r[9](w)}let h={draggable:!0,$$slots:{default:[o1]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.lngLat=r[2]),u=new wn({props:h}),Be.push(()=>st(u,"lngLat",v)),{c(){e=k("div"),d&&d.c(),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),F(s.$$.fragment),f=M(),F(u.$$.fragment),N(e,"slot","map")},m(w,C){$(w,e,C),d&&d.m(e,null),p(e,n),P(t,e,null),p(e,l),P(o,e,null),p(e,i),P(s,e,null),p(e,f),P(u,e,null),_=!0},p(w,C){w[0]=="neighbourhood"?d?C&1&&b(d,1):(d=vi(w),d.c(),b(d,1),d.m(e,n)):d&&(he(),S(d,1,1,()=>{d=null}),be());const L={};C&16&&(L.data=w[4]),C&16384&&(L.$$scope={dirty:C,ctx:w}),o.$set(L);const E={};C&16384&&(E.$$scope={dirty:C,ctx:w}),!a&&C&8&&(a=!0,E.lngLat=w[3],at(()=>a=!1)),s.$set(E);const T={};C&16384&&(T.$$scope={dirty:C,ctx:w}),!c&&C&4&&(c=!0,T.lngLat=w[2],at(()=>c=!1)),u.$set(T)},i(w){_||(b(d),b(t.$$.fragment,w),b(o.$$.fragment,w),b(s.$$.fragment,w),b(u.$$.fragment,w),_=!0)},o(w){S(d),S(t.$$.fragment,w),S(o.$$.fragment,w),S(s.$$.fragment,w),S(u.$$.fragment,w),_=!1},d(w){w&&y(e),d&&d.d(),I(t),I(o),I(s),I(u)}}}function s1(r){let e,n;return e=new At({props:{$$slots:{map:[i1],sidebar:[t1],top:[e1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&16447&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function a1(r,e,n){let t,l,o,i,s,a;X(r,ce,h=>n(5,l=h)),X(r,Pl,h=>n(1,o=h)),X(r,Yn,h=>n(2,i=h)),X(r,Zn,h=>n(3,s=h)),X(r,xe,h=>n(7,a=h));let{prevMode:f}=e;function u(){te(ce,l={mode:f},l)}function c(h){s=h,Zn.set(s)}function _(h){i=h,Yn.set(i)}function d(){o=yn(this.value),Pl.set(o)}const m=()=>te(ce,l={mode:"title",firstLoad:!1},l),g=()=>te(ce,l={mode:"pick-neighbourhood"},l),v=()=>te(ce,l={mode:"neighbourhood"},l);return r.$$set=h=>{"prevMode"in h&&n(0,f=h.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&n(4,t=a.compareRoute(s,i,o))},[f,o,i,s,t,l,u,a,c,_,d,m,g,v]}class f1 extends ie{constructor(e){super(),se(this,e,a1,s1,le,{prevMode:0})}}let Fn=Mt(null);const Ot=Mt([]);function As(r){if(r.length<3)return JSON.parse(Wt(Fn).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let n=JSON.parse(Wt(Fn).inner.calculateRoute(e));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}const{window:u1}=Vi,c1=r=>({}),wi=r=>({}),d1=r=>({}),ki=r=>({});function Si(r,e,n){const t=r.slice();return t[44]=e[n],t[45]=e,t[46]=n,t}function Ci(r,e,n){const t=r.slice();return t[47]=e[n],t[48]=e,t[49]=n,t}function _1(r){let e,n;const t=r[24]["extra-top"],l=De(t,r,r[38],wi);return{c(){e=k("div"),l&&l.c(),N(e,"slot","top")},m(o,i){$(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i[1]&128)&&Ue(l,t,o,o[38],n?Ge(t,o[38],i,c1):He(o[38]),wi)},i(o){n||(b(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&y(e),l&&l.d(o)}}}function m1(r){let e,n,t,l,o;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,n=M(),t=k("p"),t.textContent="Keyboard shortcuts:",l=M(),o=k("ul"),o.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){$(i,e,s),$(i,n,s),$(i,t,s),$(i,l,s),$(i,o,s)},p:Q,d(i){i&&(y(e),y(n),y(t),y(l),y(o))}}}function p1(r){let e,n=r[8].length+"",t,l;return{c(){e=j("Undo ("),t=j(n),l=j(")")},m(o,i){$(o,e,i),$(o,t,i),$(o,l,i)},p(o,i){i[0]&256&&n!==(n=o[8].length+"")&&ne(t,n)},d(o){o&&(y(e),y(t),y(l))}}}function g1(r){let e;return{c(){e=j("Undo")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function h1(r){let e;return{c(){e=k("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function b1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;return c=Qi(r[36][0]),{c(){e=k("fieldset"),n=k("label"),t=k("input"),l=j(`
          Snap to roads`),o=M(),i=k("label"),s=k("input"),a=j(`
          Draw anywhere`),f=M(),u=k("p"),u.textContent="Click to add at least 3 points",N(t,"type","radio"),t.__value="snap",Oe(t,t.__value),N(s,"type","radio"),s.__value="free",Oe(s,s.__value),c.p(t,s)},m(m,g){$(m,e,g),p(e,n),p(n,t),t.checked=t.__value===r[7],p(n,l),p(e,o),p(e,i),p(i,s),s.checked=s.__value===r[7],p(i,a),$(m,f,g),$(m,u,g),_||(d=[K(t,"change",r[35]),K(s,"change",r[37])],_=!0)},p(m,g){g[0]&128&&(t.checked=t.__value===m[7]),g[0]&128&&(s.checked=s.__value===m[7])},d(m){m&&(y(e),y(f),y(u)),c.r(),_=!1,nt(d)}}}function $1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,v,h;const w=r[24]["extra-sidebar"],C=De(w,r,r[38],ki);u=new zt({props:{$$slots:{default:[m1]},$$scope:{ctx:r}}});function L(U,R){return U[8].length==0?g1:p1}let E=L(r),T=E(r);function A(U,R){return U[5].length<3?b1:h1}let z=A(r),O=z(r);return{c(){e=k("div"),C&&C.c(),n=M(),t=k("div"),l=k("button"),o=j("Finish"),s=M(),a=k("button"),a.textContent="Cancel",f=M(),F(u.$$.fragment),c=M(),_=k("button"),T.c(),m=M(),O.c(),l.disabled=i=r[5].length<3,N(a,"class","secondary"),oe(t,"display","flex"),N(_,"class","secondary"),_.disabled=d=r[8].length==0,N(e,"slot","sidebar")},m(U,R){$(U,e,R),C&&C.m(e,null),p(e,n),p(e,t),p(t,l),p(l,o),p(t,s),p(t,a),p(t,f),P(u,t,null),p(e,c),p(e,_),T.m(_,null),p(e,m),O.m(e,null),g=!0,v||(h=[K(l,"click",function(){Kr(r[0])&&r[0].apply(this,arguments)}),K(a,"click",function(){Kr(r[1])&&r[1].apply(this,arguments)}),K(_,"click",r[11])],v=!0)},p(U,R){r=U,C&&C.p&&(!g||R[1]&128)&&Ue(C,w,r,r[38],g?Ge(w,r[38],R,d1):He(r[38]),ki),(!g||R[0]&32&&i!==(i=r[5].length<3))&&(l.disabled=i);const B={};R[1]&128&&(B.$$scope={dirty:R,ctx:r}),u.$set(B),E===(E=L(r))&&T?T.p(r,R):(T.d(1),T=E(r),T&&(T.c(),T.m(_,null))),(!g||R[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),z===(z=A(r))&&O?O.p(r,R):(O.d(1),O=z(r),O&&(O.c(),O.m(e,null)))},i(U){g||(b(C,U),b(u.$$.fragment,U),g=!0)},o(U){S(C,U),S(u.$$.fragment,U),g=!1},d(U){U&&y(e),C&&C.d(U),I(u),T.d(),O.d(),v=!1,nt(h)}}}function y1(r){let e;return{c(){e=k("span"),N(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped-node",r[47].snapped),gt(e,"free-node",!r[47].snapped),gt(e,"hide",r[4])},m(n,t){$(n,e,t)},p(n,t){t[0]&512&&gt(e,"snapped-node",n[47].snapped),t[0]&512&&gt(e,"free-node",!n[47].snapped),t[0]&16&&gt(e,"hide",n[4])},d(n){n&&y(e)}}}function Li(r){let e,n,t;function l(f){r[25](f,r[47])}function o(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[y1]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new Fr({props:a}),Be.push(()=>st(e,"lngLat",l)),e.$on("dragstart",o),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){F(e.$$.fragment)},m(f,u){P(e,f,u),t=!0},p(f,u){r=f;const c={};u[0]&528|u[1]&128&&(c.$$scope={dirty:u,ctx:r}),!n&&u[0]&512&&(n=!0,c.lngLat=r[47].point,at(()=>n=!1)),e.$set(c)},i(f){t||(b(e.$$.fragment,f),t=!0)},o(f){S(e.$$.fragment,f),t=!1},d(f){I(e,f)}}}function v1(r){let e;return{c(){e=k("span"),e.textContent=`${r[46]+1}`,N(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped",r[44].snapped)},m(n,t){$(n,e,t)},p(n,t){t[0]&32&&gt(e,"snapped",n[44].snapped)},d(n){n&&y(e)}}}function Mi(r){let e,n,t;function l(a){r[29](a,r[44])}function o(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[v1]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new Fr({props:s}),Be.push(()=>st(e,"lngLat",l)),e.$on("click",o),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){F(e.$$.fragment)},m(a,f){P(e,a,f),t=!0},p(a,f){r=a;const u={};f[0]&32|f[1]&128&&(u.$$scope={dirty:f,ctx:r}),!n&&f[0]&32&&(n=!0,u.lngLat=r[44].point,at(()=>n=!1)),e.$set(u)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){S(e.$$.fragment,a),t=!1},d(a){I(e,a)}}}function w1(r){let e,n,t,l;const o=[we("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new et({props:i});const s=[we("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new kt({props:a}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _={};t.$set(_)},i(f){l||(b(e.$$.fragment,f),b(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&y(n),I(e,f),I(t,f)}}}function k1(r){let e,n;return e=new et({props:{paint:{"line-color":"black","line-width":3}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function S1(r){let e,n,t,l,o,i,s,a,f;n=new hs({}),n.$on("click",r[12]),n.$on("mousemove",r[13]);let u=Me(r[9]),c=[];for(let v=0;v<u.length;v+=1)c[v]=Li(Ci(r,u,v));const _=v=>S(c[v],1,1,()=>{c[v]=null});let d=Me(r[5]),m=[];for(let v=0;v<d.length;v+=1)m[v]=Mi(Si(r,d,v));const g=v=>S(m[v],1,1,()=>{m[v]=null});return i=new Ke({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[w1]},$$scope:{ctx:r}}}),a=new Ke({props:{data:r[10],$$slots:{default:[k1]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),t=M();for(let v=0;v<c.length;v+=1)c[v].c();l=M();for(let v=0;v<m.length;v+=1)m[v].c();o=M(),F(i.$$.fragment),s=M(),F(a.$$.fragment),N(e,"slot","map")},m(v,h){$(v,e,h),P(n,e,null),p(e,t);for(let w=0;w<c.length;w+=1)c[w]&&c[w].m(e,null);p(e,l);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(e,null);p(e,o),P(i,e,null),p(e,s),P(a,e,null),f=!0},p(v,h){if(h[0]&918032){u=Me(v[9]);let L;for(L=0;L<u.length;L+=1){const E=Ci(v,u,L);c[L]?(c[L].p(E,h),b(c[L],1)):(c[L]=Li(E),c[L].c(),b(c[L],1),c[L].m(e,l))}for(he(),L=u.length;L<c.length;L+=1)_(L);be()}if(h[0]&2146348){d=Me(v[5]);let L;for(L=0;L<d.length;L+=1){const E=Si(v,d,L);m[L]?(m[L].p(E,h),b(m[L],1)):(m[L]=Mi(E),m[L].c(),b(m[L],1),m[L].m(e,o))}for(he(),L=d.length;L<m.length;L+=1)g(L);be()}const w={};h[0]&96&&(w.data=v[16](v[6],v[5])),h[1]&128&&(w.$$scope={dirty:h,ctx:v}),i.$set(w);const C={};h[0]&1024&&(C.data=v[10]),h[1]&128&&(C.$$scope={dirty:h,ctx:v}),a.$set(C)},i(v){if(!f){b(n.$$.fragment,v);for(let h=0;h<u.length;h+=1)b(c[h]);for(let h=0;h<d.length;h+=1)b(m[h]);b(i.$$.fragment,v),b(a.$$.fragment,v),f=!0}},o(v){S(n.$$.fragment,v),c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)S(c[h]);m=m.filter(Boolean);for(let h=0;h<m.length;h+=1)S(m[h]);S(i.$$.fragment,v),S(a.$$.fragment,v),f=!1},d(v){v&&y(e),I(n),ft(c,v),ft(m,v),I(i),I(a)}}}function C1(r){let e,n,t,l;return e=new At({props:{$$slots:{map:[S1],sidebar:[$1],top:[_1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0,t||(l=K(u1,"keydown",r[20]),t=!0)},p(o,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o),t=!1,l()}}}function L1(r,e,n){let t,l,o;X(r,Ot,V=>n(5,l=V)),X(r,Fn,V=>n(6,o=V));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:f}=e,{cancel:u}=e;Tt(()=>{te(Ot,l=[],l),o==null||o.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],m=null,g=!1,v=!1,h=!1;function w(V){let me=V.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=me}function C(){let V=_.pop();n(8,_),V&&te(Ot,l=V,l)}function L(){_.length==100&&_.shift(),n(8,_=[..._,JSON.parse(JSON.stringify(l))])}function E(){n(7,c=c=="snap"?"free":"snap"),m&&n(23,m.snapped=c=="snap",m)}function T(V){l.length>=3||(L(),Ot.update(me=>(me.push({point:V.detail.lngLat.toArray(),snapped:c=="snap"}),me)))}function A(V){n(23,m={point:V.detail.lngLat.toArray(),snapped:c=="snap"})}function z(V){L(),Ot.update(me=>(me[V].snapped=!me[V].snapped,me))}function O(V){L(),Ot.update(me=>(me.splice(V,1),me)),n(2,g=!1)}function U(V,me){try{if(V)return As(me)}catch{}return Yt()}function R(V,me,x,pe){if(pe||me.length>=3)return Yt();try{if(V&&me.length>0&&x)return JSON.parse(V.inner.calculateRoute([me[me.length-1],x]))}catch{}return Yt()}function B(V,me,x){if(x)return;if(!V||me.length<3){n(9,d=[]);return}let pe=[],$e=1,Se=JSON.parse(JSON.stringify(me));Se.push(Se[0]);for(let q=0;q<Se.length-1;q++){let _t=JSON.parse(V.inner.getExtraNodes(Se[q],Se[q+1]));for(let[Re,We,St]of _t)pe.push({point:[Re,We],snapped:St,insertIdx:$e});$e++}n(9,d=pe)}function H(V){L(),Ot.update(me=>(me.splice(V.insertIdx,0,{point:V.point,snapped:V.snapped}),me)),n(4,h=!0)}function G(V){Ot.update(me=>(me[V.insertIdx].point=V.point,me))}function Z(){n(4,h=!1)}function Y(V){let me=V.target.tagName,x=me=="INPUT"||me=="TEXTAREA";V.key=="Enter"&&!x||V.key=="Escape"?(V.stopPropagation(),l.length>=3?f():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):V.key=="s"&&!x?E():V.key=="z"&&V.ctrlKey&&(V.stopPropagation(),C())}function ae(){L(),n(3,v=!0)}const D=[[]];function ye(V,me){r.$$.not_equal(me.point,V)&&(me.point=V,n(9,d))}const ge=V=>H(V),fe=V=>G(V),ve=V=>{H(V),n(4,h=!1)};function ue(V,me){r.$$.not_equal(me.point,V)&&(me.point=V,Ot.set(l))}const Fe=V=>z(V),Ze=V=>O(V),Te=()=>n(2,g=!0),re=()=>n(2,g=!1),Je=()=>n(3,v=!1);function je(){c=this.__value,n(7,c)}function ke(){c=this.__value,n(7,c)}return r.$$set=V=>{"map"in V&&n(22,a=V.map),"finish"in V&&n(0,f=V.finish),"cancel"in V&&n(1,u=V.cancel),"$$scope"in V&&n(38,s=V.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&B(o,l,h),r.$$.dirty[0]&8388716&&n(10,t=R(o,l,m,g||v)),r.$$.dirty[0]&32&&w(l)},[f,u,g,v,h,l,o,c,_,d,t,C,T,A,z,O,U,H,G,Z,Y,ae,a,m,i,ye,ge,fe,ve,ue,Fe,Ze,Te,re,Je,je,D,ke,s]}class M1 extends ie{constructor(e){super(),se(this,e,L1,C1,le,{map:22,finish:0,cancel:1},null,[-1,-1])}}function T1(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function A1(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function F1(r){let e;return{c(){e=k("li"),e.textContent="Creating new neighbourhood boundary"},m(n,t){$(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&y(e)}}}function P1(r){let e,n,t,l,o;return n=new Le({props:{$$slots:{default:[I1]},$$scope:{ctx:r}}}),n.$on("click",r[8]),{c(){e=k("li"),F(n.$$.fragment),t=M(),l=k("li"),l.textContent="Changing neighbourhood boundary"},m(i,s){$(i,e,s),P(n,e,null),$(i,t,s),$(i,l,s),o=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||(b(n.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),o=!1},d(i){i&&(y(e),y(t),y(l)),I(n)}}}function I1(r){let e;return{c(){e=j("Editing")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function E1(r){let e,n,t,l,o,i,s,a,f,u,c,_;o=new Le({props:{$$slots:{default:[T1]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Le({props:{$$slots:{default:[A1]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[P1,F1],m=[];function g(v,h){return v[1]?0:1}return u=g(r),c=m[u]=d[u](r),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),c.c(),N(n,"aria-label","breadcrumb"),N(e,"slot","extra-top")},m(v,h){$(v,e,h),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),m[u].m(t,null),_=!0},p(v,h){const w={};h&4096&&(w.$$scope={dirty:h,ctx:v}),o.$set(w);const C={};h&4096&&(C.$$scope={dirty:h,ctx:v}),a.$set(C);let L=u;u=g(v),u===L?m[u].p(v,h):(he(),S(m[L],1,1,()=>{m[L]=null}),be(),c=m[u],c?c.p(v,h):(c=m[u]=d[u](v),c.c()),b(c,1),c.m(t,null))},i(v){_||(b(o.$$.fragment,v),b(a.$$.fragment,v),b(c),_=!0)},o(v){S(o.$$.fragment,v),S(a.$$.fragment,v),S(c),_=!1},d(v){v&&y(e),I(o),I(a),m[u].d()}}}function N1(r){let e,n,t,l;return{c(){e=k("div"),n=k("h1"),t=j("Draw your neighbourhood boundary for "),l=j(r[0]),N(e,"slot","extra-sidebar")},m(o,i){$(o,e,i),p(e,n),p(n,t),p(n,l)},p(o,i){i&1&&ne(l,o[0])},d(o){o&&y(e)}}}function j1(r){let e,n;return e=new M1({props:{map:ct(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[N1],"extra-top":[E1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&8&&(o.map=ct(t[3])),l&4103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function z1(r,e,n){let t,l,o,i,s;X(r,ce,g=>n(2,t=g)),X(r,Jn,g=>n(9,l=g)),X(r,xe,g=>n(10,o=g)),X(r,Ot,g=>n(11,i=g)),X(r,xt,g=>n(3,s=g));let{name:a}=e,{existing:f}=e;f&&(f.properties.waypoints?te(Ot,i=f.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):te(Ot,i=f.geometry.coordinates[1].slice(1).map(g=>({point:g,snapped:!1})),i));function u(){if(i.length>=3)try{let g=As(i);o.setNeighbourhoodBoundary(a,g),Tn(),o.setCurrentNeighbourhood(a,l),te(ce,t={mode:"neighbourhood"},t)}catch(g){console.log("error when setting hand drawn neighborhood",g),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working."),c()}}function c(){f?te(ce,t={mode:"neighbourhood"},t):te(ce,t={mode:"pick-neighbourhood"},t)}const _=()=>te(ce,t={mode:"title",firstLoad:!1},t),d=()=>te(ce,t={mode:"pick-neighbourhood"},t),m=()=>te(ce,t={mode:"neighbourhood"},t);return r.$$set=g=>{"name"in g&&n(0,a=g.name),"existing"in g&&n(1,f=g.existing)},[a,f,t,s,u,c,_,d,m]}class O1 extends ie{constructor(e){super(),se(this,e,z1,j1,le,{name:0,existing:1})}}const B1="/ltn/assets/settings-342fb430.svg";function Ti(r){let e,n;return e=new Mr({props:{$$slots:{default:[R1]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&67&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function R1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;return t=new au({}),{c(){e=k("h1"),e.textContent="Settings",n=M(),F(t.$$.fragment),l=M(),o=k("label"),i=k("input"),s=j(`
      Road thickness depends on shortcuts`),a=M(),f=k("center"),u=k("button"),u.textContent="Confirm",N(i,"type","checkbox")},m(m,g){$(m,e,g),$(m,n,g),P(t,m,g),$(m,l,g),$(m,o,g),p(o,i),i.checked=r[1],p(o,s),$(m,a,g),$(m,f,g),p(f,u),c=!0,_||(d=[K(i,"change",r[3]),K(u,"click",r[4])],_=!0)},p(m,g){g&2&&(i.checked=m[1])},i(m){c||(b(t.$$.fragment,m),c=!0)},o(m){S(t.$$.fragment,m),c=!1},d(m){m&&(y(e),y(n),y(l),y(o),y(a),y(f)),I(t,m),_=!1,nt(d)}}}function D1(r){let e,n,t,l,o,i,s=r[0]&&Ti(r);return{c(){e=k("button"),e.innerHTML=`<img src="${B1}" alt="Settings"/>`,n=M(),s&&s.c(),t=Ye(),N(e,"class","outline")},m(a,f){$(a,e,f),$(a,n,f),s&&s.m(a,f),$(a,t,f),l=!0,o||(i=K(e,"click",r[2]),o=!0)},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&b(s,1)):(s=Ti(a),s.c(),b(s,1),s.m(t.parentNode,t)):s&&(he(),S(s,1,1,()=>{s=null}),be())},i(a){l||(b(s),l=!0)},o(a){S(s),l=!1},d(a){a&&(y(e),y(n),y(t)),s&&s.d(a),o=!1,i()}}}function U1(r,e,n){let t;X(r,Vr,f=>n(1,t=f));let l=!1;const o=()=>n(0,l=!0);function i(){t=this.checked,Vr.set(t)}return[l,t,o,i,()=>n(0,l=!1),()=>n(0,l=!1)]}class H1 extends ie{constructor(e){super(),se(this,e,U1,D1,le,{})}}const G1=["==",["geometry-type"],"Polygon"],W1=["==",["geometry-type"],"LineString"],q1=["==",["geometry-type"],"Point"];function Fs(){return{type:"FeatureCollection",features:[]}}function Yr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Ps(r)}}}function Ps(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Is=Mt(Fs()),Es=Mt(0),J1=100;class Y1{constructor(e){pt(this,"map");pt(this,"active");pt(this,"eventListenersSuccess");pt(this,"eventListenersUpdated");pt(this,"eventListenersFailure");pt(this,"points");pt(this,"cursor");pt(this,"hover");pt(this,"dragFrom");pt(this,"previousStates");pt(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,t=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=n,l[1]-=t}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});pt(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(Ai(this.points).forEach((t,l)=>{n.push([l+1,Ff(t,this.cursor).properties.dist])}),n.sort((t,l)=>t[1]-l[1]),n.length>0){let t=n[0][0];this.points.splice(t,0,this.cursor.geometry.coordinates),this.hover=t}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});pt(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Yr(e.lngLat.toArray()),this.onClick(e),this.finish())});pt(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});pt(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});pt(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});pt(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Fs();this.points.forEach((l,o)=>{let i=Yr(l);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),e.features=e.features.concat(Ai(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),Is.set(e);let t="crosshair";this.hover!=null&&(t=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=t,Es.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Yr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Ps),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>J1&&this.previousStates.shift()}}function Ai(r){let e=[];for(let n=0;n<r.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[n],r[n+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Z1(r){let e,n,t;return{c(){e=j("Undo ("),n=j(r[1]),t=j(")")},m(l,o){$(l,e,o),$(l,n,o),$(l,t,o)},p(l,o){o&2&&ne(n,l[1])},d(l){l&&(y(e),y(n),y(t))}}}function K1(r){let e;return{c(){e=j("Undo")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function X1(r){let e,n,t,l,o,i,s,a,f,u,c;function _(g,v){return g[1]==0?K1:Z1}let d=_(r),m=d(r);return{c(){e=k("div"),n=k("button"),n.textContent="Finish",t=M(),l=k("button"),l.textContent="Cancel",o=M(),i=k("button"),m.c(),a=M(),f=k("ul"),f.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,oe(e,"display","flex"),oe(e,"justify-content","space-between")},m(g,v){$(g,e,v),p(e,n),p(e,t),p(e,l),p(e,o),p(e,i),m.m(i,null),$(g,a,v),$(g,f,v),u||(c=[K(n,"click",r[2]),K(l,"click",r[3]),K(i,"click",r[4])],u=!0)},p(g,[v]){d===(d=_(g))&&m?m.p(g,v):(m.d(1),m=d(g),m&&(m.c(),m.m(i,null))),v&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Q,o:Q,d(g){g&&(y(e),y(a),y(f)),m.d(),u=!1,nt(c)}}}function V1(r,e,n){let t;X(r,Es,a=>n(1,t=a));let{polygonTool:l}=e;const o=()=>l.finish(),i=()=>l.cancel(),s=()=>l.undo();return r.$$set=a=>{"polygonTool"in a&&n(0,l=a.polygonTool)},[l,t,o,i,s]}class Q1 extends ie{constructor(e){super(),se(this,e,V1,X1,le,{polygonTool:0})}}let x1=Date.now();function or(r){return`${r}-${x1++}`}const Ns=Symbol.for("svelte-maplibre");function eh(){return hl(Ns)}function Fi(r){return{subscribe:r.subscribe}}function js({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:t=!1}){let l=eh(),o=Mt(null),i=Fi(o),s={...l,[r]:Fi(o)};if(e&&(s.popupTarget=i),t){let a=Mt(null);s.layerEvent=a,l.layerEvent=a}return n&&(s.cluster=Mt()),xi(Ns,s),{...l,self:o}}function th(){return js({key:"source",setCluster:!0})}function nh(r=!0){return js({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Pi(r){let e;return n=>{if(n)for(let t in n){let l=e==null?void 0:e[t],o=n[t];l!==o&&r(t,o,l)}else if(e)for(let t in e)r(t,void 0,e[t]);e=n}}function rh(r,...e){let n=[r];for(let t of e)if(t)Array.isArray(t)&&t[0]===r?n.push(...t.slice(1)):n.push(t);else continue;if(n.length!==1)return n.length===2?n[1]:n}function lh(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Ii(r){let e=r[0],n,t,l=Ei(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),$(o,n,i),t=!0},p(o,i){i[0]&1&&le(e,e=o[0])?(he(),S(l,1,1,Q),be(),l=Ei(o),l.c(),b(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||(b(l),t=!0)},o(o){S(l),t=!1},d(o){o&&y(n),l.d(o)}}}function Ei(r){let e;const n=r[36].default,t=De(n,r,r[35],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o[1]&16)&&Ue(t,n,l,l[35],e?Ge(n,l[35],o,null):He(l[35]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function oh(r){let e,n,t=r[0]&&Ii(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,o){l[0]?t?(t.p(l,o),o[0]&1&&b(t,1)):(t=Ii(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function ih(r,e,n){let t,l,o,i,s,a,f,u,c,_,d,m,{$$slots:g={},$$scope:v}=e,{id:h=or("layer")}=e,{source:w=void 0}=e,{sourceLayer:C=void 0}=e,{beforeId:L=void 0}=e,{beforeLayerType:E=void 0}=e,{type:T}=e,{paint:A=void 0}=e,{layout:z=void 0}=e,{filter:O=void 0}=e,{applyToClusters:U=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:B=void 0}=e,{manageHoverState:H=!1}=e,{hovered:G=null}=e,{interactive:Z=!0}=e,{hoverCursor:Y=void 0}=e,{eventsIfTopMost:ae=!1}=e;const D=pn(),{map:ye,source:ge,self:fe,minzoom:ve,maxzoom:ue,eventTopMost:Fe,layerInfo:Ze}=nh();X(r,ye,x=>n(31,c=x)),X(r,ge,x=>n(32,_=x)),X(r,fe,x=>n(0,u=x)),X(r,ve,x=>n(34,m=x)),X(r,ue,x=>n(33,d=x)),Tt(()=>{u&&c&&(Ze.delete(u),c==null||c.removeLayer(u))});let Te;function re(x){var q,_t;if(!Z||!u||!c||ae&&Fe(x)!==u)return;let pe=x.features??[],$e=(_t=(q=pe[0])==null?void 0:q.properties)==null?void 0:_t.cluster_id,Se={event:x,map:c,clusterId:$e,layer:u,source:s,features:pe};D(x.type,Se)}function Je(x){var q,_t;if(!Z||!u||!c||ae&&Fe(x)!==u)return;Y&&(c.getCanvas().style.cursor=Y);let pe=x.features??[];n(6,G=pe[0]??null);let $e=(_t=(q=pe[0])==null?void 0:q.properties)==null?void 0:_t.cluster_id;D("mouseenter",{event:x,map:c,clusterId:$e,layer:u,source:s,features:pe})}function je(x){var q,_t,Re;if(!Z||!c)return;if(ae&&Fe(x)!==u){n(6,G=null),H&&Te!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:C,id:Te},{hover:!1}),Te=void 0);return}c.getCanvas().style.cursor=Y;let pe=x.features??[],$e=(_t=(q=pe[0])==null?void 0:q.properties)==null?void 0:_t.cluster_id,Se=(Re=pe[0])==null?void 0:Re.id;Se!==Te&&(H&&(Te!==void 0&&(c==null||c.setFeatureState({source:s,id:Te,sourceLayer:C},{hover:!1})),c==null||c.setFeatureState({source:s,id:Se,sourceLayer:C},{hover:!0})),Te=Se,n(6,G=pe[0]??null)),D("mousemove",{event:x,map:c,clusterId:$e,layer:u,source:s,features:pe})}function ke(x){if(!(!Z||!u||!c)){if(Y&&(c.getCanvas().style.cursor=""),n(6,G=null),H&&Te!==void 0){const pe={source:s,id:Te,sourceLayer:C};c==null||c.setFeatureState(pe,{hover:!1}),Te=void 0}D("mouseleave",{map:c,layer:u,source:s})}}let V=!0;function me(x){c&&(c.off("click",x,re),c.off("dblclick",x,re),c.off("contextmenu",x,re),c.off("mouseenter",x,Je),c.off("mousemove",x,je),c.off("mouseleave",x,ke))}return Tt(()=>{c&&u&&me(u)}),r.$$set=x=>{"id"in x&&n(7,h=x.id),"source"in x&&n(8,w=x.source),"sourceLayer"in x&&n(9,C=x.sourceLayer),"beforeId"in x&&n(10,L=x.beforeId),"beforeLayerType"in x&&n(11,E=x.beforeLayerType),"type"in x&&n(12,T=x.type),"paint"in x&&n(13,A=x.paint),"layout"in x&&n(14,z=x.layout),"filter"in x&&n(15,O=x.filter),"applyToClusters"in x&&n(16,U=x.applyToClusters),"minzoom"in x&&n(17,R=x.minzoom),"maxzoom"in x&&n(18,B=x.maxzoom),"manageHoverState"in x&&n(19,H=x.manageHoverState),"hovered"in x&&n(6,G=x.hovered),"interactive"in x&&n(20,Z=x.interactive),"hoverCursor"in x&&n(21,Y=x.hoverCursor),"eventsIfTopMost"in x&&n(22,ae=x.eventsIfTopMost),"$$scope"in x&&n(35,v=x.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,t=lh(U)),r.$$.dirty[0]&1073774592&&n(24,l=rh("all",t,O)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,o=R??m),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,i=B??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,s=w||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&u!==h&&s){u&&(me(u),Ze.delete(u));let x=L;if(!L&&E){let pe=c.getStyle().layers,$e=typeof E=="function"?E:q=>q.type===E,Se=pe==null?void 0:pe.find($e);Se&&(x=Se.id)}te(fe,u=h,u),c.addLayer(br({id:u,type:T,source:s,"source-layer":C,filter:l,paint:A,layout:z,minzoom:o,maxzoom:i}),x),n(23,V=!0),c.on("click",u,re),c.on("dblclick",u,re),c.on("contextmenu",u,re),c.on("mouseenter",u,Je),c.on("mousemove",u,je),c.on("mouseleave",u,ke)}r.$$.dirty[0]&1048577&&u&&Ze.set(u,{interactive:Z}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,a=u?Pi((x,pe)=>c==null?void 0:c.setPaintProperty(u,x,pe)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,f=u?Pi((x,pe)=>c==null?void 0:c.setLayoutProperty(u,x,pe)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(A)),r.$$.dirty[0]&134234112&&(f==null||f(z)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&u&&(c==null||c.setLayerZoomRange(u,o,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&u&&(V?n(23,V=!1):c==null||c.setFilter(u,l))},[u,ye,ge,fe,ve,ue,G,h,w,C,L,E,T,A,z,O,U,R,B,H,Z,Y,ae,V,l,i,o,f,a,s,t,c,_,d,m,v,g]}class Ll extends ie{constructor(e){super(),se(this,e,ih,oh,le,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function sh(r){let e;const n=r[16].default,t=De(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&Ue(t,n,l,l[24],e?Ge(n,l[24],o,null):He(l[24]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function ah(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[sh]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Ll({props:o}),Be.push(()=>st(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],at(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function fh(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=or("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:v=void 0}=e,{manageHoverState:h=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:L=!0}=e;function E(B){w=B,n(0,w)}function T(B){ze.call(this,r,B)}function A(B){ze.call(this,r,B)}function z(B){ze.call(this,r,B)}function O(B){ze.call(this,r,B)}function U(B){ze.call(this,r,B)}function R(B){ze.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,o=B.id),"source"in B&&n(2,i=B.source),"sourceLayer"in B&&n(3,s=B.sourceLayer),"beforeId"in B&&n(4,a=B.beforeId),"beforeLayerType"in B&&n(5,f=B.beforeLayerType),"paint"in B&&n(6,u=B.paint),"layout"in B&&n(7,c=B.layout),"filter"in B&&n(8,_=B.filter),"applyToClusters"in B&&n(9,d=B.applyToClusters),"minzoom"in B&&n(10,m=B.minzoom),"maxzoom"in B&&n(11,g=B.maxzoom),"hoverCursor"in B&&n(12,v=B.hoverCursor),"manageHoverState"in B&&n(13,h=B.manageHoverState),"hovered"in B&&n(0,w=B.hovered),"eventsIfTopMost"in B&&n(14,C=B.eventsIfTopMost),"interactive"in B&&n(15,L=B.interactive),"$$scope"in B&&n(24,l=B.$$scope)},[w,o,i,s,a,f,u,c,_,d,m,g,v,h,C,L,t,E,T,A,z,O,U,R,l]}class uh extends ie{constructor(e){super(),se(this,e,fh,ah,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ch(r){let e;const n=r[15].default,t=De(n,r,r[23],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8388608)&&Ue(t,n,l,l[23],e?Ge(n,l[23],o,null):He(l[23]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function dh(r){let e,n,t;function l(i){r[16](i)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[ch]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Ll({props:o}),Be.push(()=>st(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],at(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function _h(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=or("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:v=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:w=!1}=e,{interactive:C=!0}=e;function L(R){h=R,n(0,h)}function E(R){ze.call(this,r,R)}function T(R){ze.call(this,r,R)}function A(R){ze.call(this,r,R)}function z(R){ze.call(this,r,R)}function O(R){ze.call(this,r,R)}function U(R){ze.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,o=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,v=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,w=R.eventsIfTopMost),"interactive"in R&&n(14,C=R.interactive),"$$scope"in R&&n(23,l=R.$$scope)},[h,o,i,s,a,f,u,c,_,d,m,g,v,w,C,t,L,E,T,A,z,O,U,l]}class mh extends ie{constructor(e){super(),se(this,e,_h,dh,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function ph(r,e,n,t,l){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const i=()=>{t(e)&&(r.addSource(e,n),l())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function gh(r,e,n){ga().then(()=>{let t=Wt(r);if(!t)return;t.getSource(e)===n&&t.removeSource(e)})}function Ni(r){let e=r[0],n,t,l=ji(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),$(o,n,i),t=!0},p(o,i){i&1&&le(e,e=o[0])?(he(),S(l,1,1,Q),be(),l=ji(o),l.c(),b(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||(b(l),t=!0)},o(o){S(l),t=!1},d(o){o&&y(n),l.d(o)}}}function ji(r){let e;const n=r[15].default,t=De(n,r,r[14],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16384)&&Ue(t,n,l,l[14],e?Ge(n,l[14],o,null):He(l[14]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function hh(r){let e,n,t=r[0]&&Ni(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),$(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&b(t,1)):(t=Ni(l),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&y(e),t&&t.d(l)}}}function bh(r,e,n){let t,l,o,{$$slots:i={},$$scope:s}=e,{id:a=or("geojson")}=e,{data:f}=e,{generateId:u=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:m=void 0}=e;const{map:g,cluster:v,self:h}=th();X(r,g,L=>n(13,l=L)),X(r,v,L=>n(16,o=L)),X(r,h,L=>n(0,t=L));let w,C=!0;return Tt(()=>{t&&w&&l&&(gh(g,t,w),te(h,t=null,t),n(11,w=void 0))}),r.$$set=L=>{"id"in L&&n(4,a=L.id),"data"in L&&n(5,f=L.data),"generateId"in L&&n(6,u=L.generateId),"promoteId"in L&&n(7,c=L.promoteId),"filter"in L&&n(8,_=L.filter),"lineMetrics"in L&&n(9,d=L.lineMetrics),"cluster"in L&&n(10,m=L.cluster),"$$scope"in L&&n(14,s=L.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&te(v,o=m,o),r.$$.dirty&12273&&l&&t!==a&&(te(h,t=a,t),ph(l,t,br({type:"geojson",data:f,filter:_,lineMetrics:d,generateId:u,promoteId:c,cluster:!!m,clusterMinPoints:m==null?void 0:m.minPoints,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius,clusterProperties:m==null?void 0:m.properties}),L=>l&&L===t,()=>{t&&(n(11,w=l==null?void 0:l.getSource(t)),n(12,C=!0))})),r.$$.dirty&8208&&(l==null||l.on("style.load",()=>{n(11,w=l==null?void 0:l.getSource(a))})),r.$$.dirty&6176&&w&&(C?n(12,C=!1):w.setData(f)),r.$$.dirty&3072&&(w==null||w.setClusterOptions(br({cluster:!!m,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius})))},[t,g,v,h,a,f,u,c,_,d,m,w,C,l,s,i]}class $h extends ie{constructor(e){super(),se(this,e,bh,hh,le,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function yh(r){let e;const n=r[15].default,t=De(n,r,r[23],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8388608)&&Ue(t,n,l,l[23],e?Ge(n,l[23],o,null):He(l[23]),null)},i(l){e||(b(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function vh(r){let e,n,t;function l(i){r[16](i)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[yh]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Ll({props:o}),Be.push(()=>st(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],at(()=>n=!1)),e.$set(a)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){I(e,i)}}}function wh(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=or("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:v=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:w=!1}=e,{interactive:C=!0}=e;function L(R){h=R,n(0,h)}function E(R){ze.call(this,r,R)}function T(R){ze.call(this,r,R)}function A(R){ze.call(this,r,R)}function z(R){ze.call(this,r,R)}function O(R){ze.call(this,r,R)}function U(R){ze.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,o=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,v=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,w=R.eventsIfTopMost),"interactive"in R&&n(14,C=R.interactive),"$$scope"in R&&n(23,l=R.$$scope)},[h,o,i,s,a,f,u,c,_,d,m,g,v,w,C,t,L,E,T,A,z,O,U,l]}class kh extends ie{constructor(e){super(),se(this,e,wh,vh,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Sh(r){let e,n,t,l,o,i;return e=new mh({props:{id:"edit-polygon-fill",filter:G1,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),t=new kh({props:{id:"edit-polygon-lines",filter:W1,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new uh({props:{id:"edit-polygon-vertices",filter:q1,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment)},m(s,a){P(e,s,a),$(s,n,a),P(t,s,a),$(s,l,a),P(o,s,a),i=!0},p:Q,i(s){i||(b(e.$$.fragment,s),b(t.$$.fragment,s),b(o.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(t.$$.fragment,s),S(o.$$.fragment,s),i=!1},d(s){s&&(y(n),y(l)),I(e,s),I(t,s),I(o,s)}}}function Ch(r){let e,n;return e=new $h({props:{data:r[0],$$slots:{default:[Sh]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&2&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Lh(r,e,n){let t;return X(r,Is,l=>n(0,t=l)),[t]}class Mh extends ie{constructor(e){super(),se(this,e,Lh,Ch,le,{})}}function Th(r){let e,n,t,l,o,i,s;return{c(){e=k("button"),e.textContent="Import current view",n=M(),t=k("i"),t.textContent="or...",l=M(),o=k("button"),o.textContent="Draw an area to import on the map",N(e,"type","button"),N(o,"type","button")},m(a,f){$(a,e,f),$(a,n,f),$(a,t,f),$(a,l,f),$(a,o,f),i||(s=[K(e,"click",r[2]),K(o,"click",r[3])],i=!0)},p:Q,i:Q,o:Q,d(a){a&&(y(e),y(n),y(t),y(l),y(o)),i=!1,nt(s)}}}function Ah(r){let e,n;return e=new Q1({props:{polygonTool:r[0]}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.polygonTool=t[0]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Fh(r){let e,n,t,l,o,i,s,a,f;const u=[Ah,Th],c=[];function _(d,m){return d[0]?0:1}return e=_(r),n=c[e]=u[e](r),{c(){n.c(),t=M(),l=k("label"),o=k("input"),i=j(`Save a copy of the osm.xml
  after importing`),N(o,"type","checkbox")},m(d,m){c[e].m(d,m),$(d,t,m),$(d,l,m),p(l,o),o.checked=r[1],p(l,i),s=!0,a||(f=K(o,"change",r[5]),a=!0)},p(d,[m]){let g=e;e=_(d),e===g?c[e].p(d,m):(he(),S(c[g],1,1,()=>{c[g]=null}),be(),n=c[e],n?n.p(d,m):(n=c[e]=u[e](d),n.c()),b(n,1),n.m(t.parentNode,t)),m&2&&(o.checked=d[1])},i(d){s||(b(n),s=!0)},o(d){S(n),s=!1},d(d){d&&(y(t),y(l)),c[e].d(d),a=!1,f()}}}function jn(r){return[r.lng,r.lat]}function Ph(r,e,n){let{map:t}=e;const l=pn();let o=null,i=!1;async function s(_){try{l("loading","Loading from Overpass");let m=await(await fetch(zs(_))).text();i&&vr("osm.xml",m),l("gotXml",{xml:m,boundary:_})}catch(d){l("error",d.toString())}}function a(){let _=t.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[jn(_.getSouthWest()),jn(_.getNorthWest()),jn(_.getNorthEast()),jn(_.getSouthEast()),jn(_.getSouthWest())]],type:"Polygon"}}}async function f(){if(t){if(t.getZoom()<13){l("error","Zoom in more to import");return}await s(a())}}function u(){t&&(n(0,o=new Y1(t)),o.startNew(),o.addEventListenerSuccess(async _=>{n(0,o=null),await s(_)}),o.addEventListenerFailure(()=>{n(0,o=null)}))}function c(){i=this.checked,n(1,i)}return r.$$set=_=>{"map"in _&&n(4,t=_.map)},[o,i,f,u,t,c]}class Ih extends ie{constructor(e){super(),se(this,e,Ph,Fh,le,{map:4})}}function zs(r){let e='poly:"';for(let[t,l]of r.geometry.coordinates[0])e+=`${l} ${t} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Os{constructor(e,n,t,l,o){pt(this,"inner");this.inner=new Wd(e,n||new Uint8Array,t||new Uint8Array,l,o)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=Eh(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(n=>n.properties.kind=="interior_road"?n.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,n){this.inner.setNeighbourhoodBoundary(e,n)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,n){this.inner.renameNeighbourhoodBoundary(e,n)}setCurrentNeighbourhood(e,n){this.inner.setCurrentNeighbourhood(e,n)}addModalFilter(e,n){this.inner.addModalFilter(e,n)}addManyModalFilters(e,n){this.inner.addManyModalFilters(e,n)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,n,t){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,n.lng,n.lat,t))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let n of e.features)n.properties.sum_from=uo(n.properties.counts_from),n.properties.sum_to=uo(n.properties.counts_to);return e}}function Eh(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of r.features)n.properties.kind!="cell"&&n.properties.kind!="border_arrow"&&n.properties.kind!="interior_road"||(n.properties.cell_color=="disconnected"?n.properties.color="red":n.properties.color=e[n.properties.cell_color%e.length]);return r}async function gr(r){Zt.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let{osmBuffer:n,demandBuffer:t,populationBuffer:l,boundary:o}=await Nh(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),xe.set(new Os(new Uint8Array(n),t?new Uint8Array(t):void 0,l?new Uint8Array(l):void 0,o,e.study_area_name||void 0)),Wt(xe).loadSavefile(e),console.timeEnd("load"),Bs()}catch(e){window.alert(`Couldn't open project: ${e}`),Zt.set("")}}async function Nh(r,e){if(e){let n=wt(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${n}`);let l=await(await an(n)).arrayBuffer(),o=wt(`cnt_boundaries/${r.study_area_name}.geojson`),s=await(await an(o)).json(),a=wt(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let f;try{f=await(await an(a)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let u=wt(`cnt_prioritization/population_${r.study_area_name}.bin`);console.log(`Grabbing ${u}`);let c;try{c=await(await an(u)).arrayBuffer()}catch(_){console.log(`No population prioritization: ${_}`)}return{osmBuffer:l,boundary:s,demandBuffer:f,populationBuffer:c}}else if(r.study_area_name){let n=wt(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${n}`);let l=await(await an(n)).arrayBuffer(),o=wt(`boundaries/${r.study_area_name}.geojson`),s=await(await an(o)).json();return{osmBuffer:l,boundary:s}}else{console.log("Grabbing from Overpass");let n=r.features.find(o=>o.properties.kind=="study_area_boundary");return{osmBuffer:await(await an(zs(n))).arrayBuffer(),boundary:n}}}function Bs(){ce.set({mode:"pick-neighbourhood"}),Fn.set(new If(Wt(xt),Wt(xe).toRouteSnapper(),Mt(Yt()),Mt(!0),Mt(0))),Wt(xt).fitBounds(Wt(xe).getBounds(),{animate:!1}),Zn.set(Zr()),Yn.set(Zr()),cr.set(Zr());let r=new URL(window.location.href);r.searchParams.set("project",Wt(Zt)),window.history.replaceState(null,"",r.toString())}function Zr(){let r=Wt(xe).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),n=r[1]+Math.random()*(r[3]-r[1]);return new xr.LngLat(e,n)}function zi(r,e,n){const t=r.slice();return t[16]=e[n][0],t[17]=e[n][1],t}function Oi(r,e,n){const t=r.slice();return t[20]=e[n][0],t[21]=e[n][1],t}function jh(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function zh(r){let e,n,t,l,o,i,s,a;return o=new Le({props:{$$slots:{default:[jh]},$$scope:{ctx:r}}}),o.$on("click",r[13]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),s.textContent="New project",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(f,u){$(f,e,u),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),a=!0},p(f,u){const c={};u&16777216&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){a||(b(o.$$.fragment,f),a=!0)},o(f){S(o.$$.fragment,f),a=!1},d(f){f&&y(e),I(o)}}}function Bi(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;e=new ts({props:{loading:r[4]}});let g=Me(r[3]),v=[];for(let h=0;h<g.length;h+=1)v[h]=Di(zi(r,g,h));return c=new Ih({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){F(e.$$.fragment),n=M(),t=k("label"),l=j(`Load a built-in area:
        `),o=k("select"),i=k("option");for(let h=0;h<v.length;h+=1)v[h].c();s=M(),a=k("i"),a.textContent="or...",f=M(),u=k("div"),F(c.$$.fragment),i.__value="",Oe(i,i.__value),r[2]===void 0&&un(()=>r[9].call(o))},m(h,w){P(e,h,w),$(h,n,w),$(h,t,w),p(t,l),p(t,o),p(o,i);for(let C=0;C<v.length;C+=1)v[C]&&v[C].m(o,null);vt(o,r[2],!0),$(h,s,w),$(h,a,w),$(h,f,w),$(h,u,w),P(c,u,null),_=!0,d||(m=[K(o,"change",r[9]),K(o,"change",r[10])],d=!0)},p(h,w){const C={};if(w&16&&(C.loading=h[4]),e.$set(C),w&8){g=Me(h[3]);let E;for(E=0;E<g.length;E+=1){const T=zi(h,g,E);v[E]?v[E].p(T,w):(v[E]=Di(T),v[E].c(),v[E].m(o,null))}for(;E<v.length;E+=1)v[E].d(1);v.length=g.length}w&12&&vt(o,h[2]);const L={};w&32&&(L.map=h[5]),c.$set(L)},i(h){_||(b(e.$$.fragment,h),b(c.$$.fragment,h),_=!0)},o(h){S(e.$$.fragment,h),S(c.$$.fragment,h),_=!1},d(h){h&&(y(n),y(t),y(s),y(a),y(f),y(u)),I(e,h),ft(v,h),I(c),d=!1,nt(m)}}}function Ri(r){let e,n=r[21]+"",t,l;return{c(){e=k("option"),t=j(n),e.__value=l=r[20],Oe(e,e.__value)},m(o,i){$(o,e,i),p(e,t)},p(o,i){i&8&&n!==(n=o[21]+"")&&ne(t,n),i&8&&l!==(l=o[20])&&(e.__value=l,Oe(e,e.__value))},d(o){o&&y(e)}}}function Di(r){let e,n,t=Me(r[17]),l=[];for(let o=0;o<t.length;o+=1)l[o]=Ri(Oi(r,t,o));return{c(){e=k("optgroup");for(let o=0;o<l.length;o+=1)l[o].c();N(e,"label",n=r[16])},m(o,i){$(o,e,i);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(o,i){if(i&8){t=Me(o[17]);let s;for(s=0;s<t.length;s+=1){const a=Oi(o,t,s);l[s]?l[s].p(a,i):(l[s]=Ri(a),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}i&8&&n!==(n=o[16])&&N(e,"label",n)},d(o){o&&y(e),ft(l,o)}}}function Oh(r){let e,n,t,l,o,i,s,a,f,u=r[1]&&Bi(r);return{c(){e=k("div"),n=k("div"),t=k("label"),l=j(`Project name:
        `),o=k("input"),i=M(),u&&u.c(),N(o,"type","text"),N(e,"slot","sidebar")},m(c,_){$(c,e,_),p(e,n),p(n,t),p(t,l),p(t,o),Oe(o,r[1]),p(e,i),u&&u.m(e,null),s=!0,a||(f=K(o,"input",r[8]),a=!0)},p(c,_){_&2&&o.value!==c[1]&&Oe(o,c[1]),c[1]?u?(u.p(c,_),_&2&&b(u,1)):(u=Bi(c),u.c(),b(u,1),u.m(e,null)):u&&(he(),S(u,1,1,()=>{u=null}),be())},i(c){s||(b(u),s=!0)},o(c){S(u),s=!1},d(c){c&&y(e),u&&u.d(),a=!1,f()}}}function Bh(r){let e,n,t;return n=new Mh({}),{c(){e=k("div"),F(n.$$.fragment),N(e,"slot","map")},m(l,o){$(l,e,o),P(n,e,null),t=!0},p:Q,i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function Rh(r){let e,n;return e=new At({props:{$$slots:{map:[Bh],sidebar:[Oh],top:[zh]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&16777342&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Dh(r,e,n){let t,l,o,i;X(r,Zt,C=>n(14,t=C)),X(r,xe,C=>n(15,l=C)),X(r,xt,C=>n(5,o=C)),X(r,ce,C=>n(6,i=C));let s="",a="",f=[],u="";Cr(async()=>{let C=await an(wt("severance_pbfs/areas.json"));n(3,f=await C.json())});function c(C){n(4,u="Loading OSM");try{te(xe,l=new Os(new TextEncoder().encode(C.detail.xml),void 0,void 0,C.detail.boundary,void 0),l),te(Zt,t=`ltn_${s}`,t),Bs(),Tn()}catch(L){window.alert(`Couldn't import from Overpass: ${L}`)}n(4,u="")}async function _(){if(a=="")return;let C=`ltn_${s}`;window.localStorage.setItem(C,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:a})),n(4,u=`Loading pre-clipped OSM area ${a}`),await gr(C),n(4,u="")}function d(){s=this.value,n(1,s)}function m(){a=cn(this),n(2,a),n(3,f)}return[_,s,a,f,u,o,i,c,d,m,()=>_(),C=>n(4,u=C.detail),C=>window.alert(C.detail),()=>te(ce,i={mode:"title",firstLoad:!1},i)]}class Uh extends ie{constructor(e){super(),se(this,e,Dh,Rh,le,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Ui(r,e,n){const t=r.slice();return t[19]=e[n][0],t[20]=e[n][1],t}function Hi(r,e,n){const t=r.slice();return t[23]=e[n],t}function Hh(r){let e;return{c(){e=k("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',N(e,"slot","top")},m(n,t){$(n,e,t)},p:Q,d(n){n&&y(e)}}}function Gh(r){let e;return{c(){e=k("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(n,t){$(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&y(e)}}}function Wh(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;n=new Le({props:{$$slots:{default:[qh]},$$scope:{ctx:r}}}),n.$on("click",r[11]);let m=Me(r[2]),g=[];for(let h=0;h<m.length;h+=1)g[h]=Wi(Ui(r,m,h));const v=h=>S(g[h],1,1,()=>{g[h]=null});return{c(){e=k("div"),F(n.$$.fragment),t=M(),l=k("p"),l.textContent="Load a saved project:",o=M(),i=k("ul");for(let h=0;h<g.length;h+=1)g[h].c();s=M(),a=k("label"),f=j(`Load a project from a file
        `),u=k("input"),N(u,"type","file")},m(h,w){$(h,e,w),P(n,e,null),$(h,t,w),$(h,l,w),$(h,o,w),$(h,i,w);for(let C=0;C<g.length;C+=1)g[C]&&g[C].m(i,null);$(h,s,w),$(h,a,w),p(a,f),p(a,u),r[15](u),c=!0,_||(d=K(u,"change",r[6]),_=!0)},p(h,w){const C={};if(w&67108864&&(C.$$scope={dirty:w,ctx:h}),n.$set(C),w&900){m=Me(h[2]);let L;for(L=0;L<m.length;L+=1){const E=Ui(h,m,L);g[L]?(g[L].p(E,w),b(g[L],1)):(g[L]=Wi(E),g[L].c(),b(g[L],1),g[L].m(i,null))}for(he(),L=m.length;L<g.length;L+=1)v(L);be()}},i(h){if(!c){b(n.$$.fragment,h);for(let w=0;w<m.length;w+=1)b(g[w]);c=!0}},o(h){S(n.$$.fragment,h),g=g.filter(Boolean);for(let w=0;w<g.length;w+=1)S(g[w]);c=!1},d(h){h&&(y(e),y(t),y(l),y(o),y(i),y(s),y(a)),I(n),ft(g,h),r[15](null),_=!1,d()}}}function qh(r){let e;return{c(){e=j("New project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Jh(r){let e=r[23].slice(4)+"",n;return{c(){n=j(e)},m(t,l){$(t,n,l)},p(t,l){l&4&&e!==(e=t[23].slice(4)+"")&&ne(n,e)},d(t){t&&y(n)}}}function Gi(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;function g(){return r[12](r[23])}t=new Le({props:{$$slots:{default:[Jh]},$$scope:{ctx:r}}}),t.$on("click",g),s=new Sl({props:{color:"black"}});function v(){return r[13](r[23])}u=new bs({props:{color:"white"}});function h(){return r[14](r[23])}return{c(){e=k("li"),n=k("span"),F(t.$$.fragment),l=M(),o=k("span"),i=k("button"),F(s.$$.fragment),a=M(),f=k("button"),F(u.$$.fragment),c=M(),N(i,"class","outline icon-btn"),N(i,"aria-label","Rename project"),N(f,"class","icon-btn destructive"),N(f,"aria-label","Delete project"),oe(o,"display","flex"),oe(o,"gap","16px"),oe(n,"display","flex"),oe(n,"justify-content","space-between")},m(w,C){$(w,e,C),p(e,n),P(t,n,null),p(n,l),p(n,o),p(o,i),P(s,i,null),p(o,a),p(o,f),P(u,f,null),p(e,c),_=!0,d||(m=[K(i,"click",v),K(f,"click",h)],d=!0)},p(w,C){r=w;const L={};C&67108868&&(L.$$scope={dirty:C,ctx:r}),t.$set(L)},i(w){_||(b(t.$$.fragment,w),b(s.$$.fragment,w),b(u.$$.fragment,w),_=!0)},o(w){S(t.$$.fragment,w),S(s.$$.fragment,w),S(u.$$.fragment,w),_=!1},d(w){w&&y(e),I(t),I(s),I(u),d=!1,nt(m)}}}function Wi(r){let e,n=(r[19]??"custom area")+"",t,l,o,i,s=Me(r[20]),a=[];for(let u=0;u<s.length;u+=1)a[u]=Gi(Hi(r,s,u));const f=u=>S(a[u],1,1,()=>{a[u]=null});return{c(){e=k("u"),t=j(n),l=M();for(let u=0;u<a.length;u+=1)a[u].c();o=Ye()},m(u,c){$(u,e,c),p(e,t),$(u,l,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(u,c);$(u,o,c),i=!0},p(u,c){if((!i||c&4)&&n!==(n=(u[19]??"custom area")+"")&&ne(t,n),c&900){s=Me(u[20]);let _;for(_=0;_<s.length;_+=1){const d=Hi(u,s,_);a[_]?(a[_].p(d,c),b(a[_],1)):(a[_]=Gi(d),a[_].c(),b(a[_],1),a[_].m(o.parentNode,o))}for(he(),_=s.length;_<a.length;_+=1)f(_);be()}},i(u){if(!i){for(let c=0;c<s.length;c+=1)b(a[c]);i=!0}},o(u){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)S(a[c]);i=!1},d(u){u&&(y(e),y(l),y(o)),ft(a,u)}}}function Yh(r){let e,n,t,l;const o=[Wh,Gh],i=[];function s(a,f){return a[4]&&a[0]?0:1}return n=s(r),t=i[n]=o[n](r),{c(){e=k("div"),t.c(),N(e,"slot","sidebar")},m(a,f){$(a,e,f),i[n].m(e,null),l=!0},p(a,f){let u=n;n=s(a),n===u?i[n].p(a,f):(he(),S(i[u],1,1,()=>{i[u]=null}),be(),t=i[n],t?t.p(a,f):(t=i[n]=o[n](a),t.c()),b(t,1),t.m(e,null))},i(a){l||(b(t),l=!0)},o(a){S(t),l=!1},d(a){a&&y(e),i[n].d()}}}function Zh(r){let e,n,t,l;return e=new ts({props:{loading:r[1]}}),t=new At({props:{$$slots:{sidebar:[Yh],top:[Hh]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment)},m(o,i){P(e,o,i),$(o,n,i),P(t,o,i),l=!0},p(o,[i]){const s={};i&2&&(s.loading=o[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:o}),t.$set(a)},i(o){l||(b(e.$$.fragment,o),b(t.$$.fragment,o),l=!0)},o(o){S(e.$$.fragment,o),S(t.$$.fragment,o),l=!1},d(o){o&&y(n),I(e,o),I(t,o)}}}function ur(){let r=new Map,e=[];for(let t=0;t<window.localStorage.length;t++){let l=window.localStorage.key(t);if(l.startsWith("ltn_")){let o="";try{o=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}o&&o.length>0?(r.has(o)||r.set(o,[]),r.get(o).push(l)):e.push(l)}}let n=[...r.entries()];return n.sort((t,l)=>t[0].localeCompare(l[0])),n.push(["custom",e]),n}function Kh(r,e,n){let t,l,o,i,s;X(r,Zt,T=>n(16,t=T)),X(r,Fn,T=>n(17,l=T)),X(r,xe,T=>n(18,o=T)),X(r,xt,T=>n(4,i=T)),X(r,ce,T=>n(5,s=T));let{wasmReady:a}=e,{firstLoad:f}=e,u="";if(te(xe,o=null,o),te(Fn,l=null,l),te(Zt,t="",t),f){let A=new URLSearchParams(window.location.search).get("project");A&&(u=`Loading project ${A}`,gr(A))}else{let T=new URL(window.location.href);T.searchParams.delete("project"),window.history.replaceState(null,"",T.toString())}let c=ur(),_;async function d(T){let A="ltn_"+_.files[0].name;n(1,u=`Loading from file ${A}`),window.localStorage.setItem(A,await _.files[0].text()),n(2,c=ur()),await gr(A),n(1,u="")}function m(T){window.confirm(`Really delete project ${T}? You can't undo this.`)&&(window.localStorage.removeItem(T),n(2,c=ur()))}function g(T){let A=window.prompt(`Rename project ${T} to what?`,T);if(A){A.startsWith("ltn_")||(A=`ltn_${A}`);let z=window.localStorage.getItem(T);window.localStorage.setItem(A,z),window.localStorage.removeItem(T),n(2,c=ur())}}async function v(T){n(1,u=`Loading project ${T}`),await gr(T),n(1,u="")}const h=()=>te(ce,s={mode:"new-project"},s),w=T=>v(T),C=T=>g(T),L=T=>m(T);function E(T){Be[T?"unshift":"push"](()=>{_=T,n(3,_)})}return r.$$set=T=>{"wasmReady"in T&&n(0,a=T.wasmReady),"firstLoad"in T&&n(10,f=T.firstLoad)},[a,u,c,_,i,s,d,m,g,v,f,h,w,C,L,E]}class Xh extends ie{constructor(e){super(),se(this,e,Kh,Zh,le,{wasmReady:0,firstLoad:10})}}function Vh(r){let e;return{c(){e=j("Choose project")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function Qh(r){let e;return{c(){e=j("Pick neighbourhood")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function xh(r){let e;return{c(){e=j("Editing")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function e0(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Le({props:{$$slots:{default:[Vh]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Le({props:{$$slots:{default:[Qh]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new Le({props:{$$slots:{default:[xh]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),F(o.$$.fragment),i=M(),s=k("li"),F(a.$$.fragment),f=M(),u=k("li"),F(c.$$.fragment),_=M(),d=k("li"),d.textContent="Viewing shortcuts",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,v){$(g,e,v),p(e,n),p(n,t),p(t,l),P(o,l,null),p(t,i),p(t,s),P(a,s,null),p(t,f),p(t,u),P(c,u,null),p(t,_),p(t,d),m=!0},p(g,v){const h={};v&1024&&(h.$$scope={dirty:v,ctx:g}),o.$set(h);const w={};v&1024&&(w.$$scope={dirty:v,ctx:g}),a.$set(w);const C={};v&1024&&(C.$$scope={dirty:v,ctx:g}),c.$set(C)},i(g){m||(b(o.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){S(o.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&y(e),I(o),I(a),I(c)}}}function t0(r){let e,n,t,l,o,i,s,a,f,u,c=ct(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,m,g,v,h;function w(L){r[5](L)}let C={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(C.idx=r[0].shortcutIndex),o=new Ir({props:C}),Be.push(()=>st(o,"idx",w)),{c(){e=k("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=M(),t=k("button"),t.textContent="Pick a different road",l=M(),F(o.$$.fragment),s=M(),a=k("p"),f=j("This shortcut is "),u=k("b"),_=j(c),d=j("x"),m=j(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(L,E){$(L,e,E),$(L,n,E),$(L,t,E),$(L,l,E),P(o,L,E),$(L,s,E),$(L,a,E),p(a,f),p(a,u),p(u,_),p(u,d),p(a,m),g=!0,v||(h=K(t,"click",r[4]),v=!0)},p(L,E){const T={};E&1&&(T.list=L[0].gj.features),!i&&E&1&&(i=!0,T.idx=L[0].shortcutIndex,at(()=>i=!1)),o.$set(T),(!g||E&1)&&c!==(c=ct(L[0].gj.features[L[0].shortcutIndex].properties).directness.toFixed(1)+"")&&ne(_,c)},i(L){g||(b(o.$$.fragment,L),g=!0)},o(L){S(o.$$.fragment,L),g=!1},d(L){L&&(y(e),y(n),y(t),y(l),y(s),y(a)),I(o,L),v=!1,h()}}}function n0(r){let e;return{c(){e=k("p"),e.textContent="Click a road to see shortcuts"},m(n,t){$(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&y(e)}}}function r0(r){let e,n,t,l,o,i;n=new gn({}),n.$on("click",r[3]);const s=[n0,t0],a=[];function f(u,c){return u[0].state=="neutral"?0:u[0].state=="chose-road"?1:-1}return~(l=f(r))&&(o=a[l]=s[l](r)),{c(){e=k("div"),F(n.$$.fragment),t=M(),o&&o.c(),N(e,"slot","sidebar")},m(u,c){$(u,e,c),P(n,e,null),p(e,t),~l&&a[l].m(e,null),i=!0},p(u,c){let _=l;l=f(u),l===_?~l&&a[l].p(u,c):(o&&(he(),S(a[_],1,1,()=>{a[_]=null}),be()),~l?(o=a[l],o?o.p(u,c):(o=a[l]=s[l](u),o.c()),b(o,1),o.m(e,null)):o=null)},i(u){i||(b(n.$$.fragment,u),b(o),i=!0)},o(u){S(n.$$.fragment,u),S(o),i=!1},d(u){u&&y(e),I(n),~l&&a[l].d()}}}function l0(r){let e,n;return e=new rr({props:{interactive:!1}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function o0(r){let e,n;return e=new rr({props:{onClickLine:r[2],$$slots:{"line-popup":[s0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function i0(r){let e,n=r[9].shortcuts+"",t,l,o=(r[9].name??"unnamed road")+"",i;return{c(){e=k("p"),t=j(n),l=j(" shortcuts through "),i=j(o)},m(s,a){$(s,e,a),p(e,t),p(e,l),p(e,i)},p(s,a){a&512&&n!==(n=s[9].shortcuts+"")&&ne(t,n),a&512&&o!==(o=(s[9].name??"unnamed road")+"")&&ne(i,o)},d(s){s&&y(e)}}}function s0(r){let e,n,t;return n=new dt({props:{openOn:"hover",$$slots:{default:[i0,({props:l})=>({9:l}),({props:l})=>l?512:0]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){$(l,e,o),P(n,e,null),t=!0},p(l,o){const i={};o&1536&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&y(e),I(n)}}}function a0(r){let e,n,t,l,o,i,s,a,f,u;e=new Nr({}),t=new Er({}),o=new jr({});const c=[o0,l0],_=[];function d(m,g){return m[0].state=="neutral"?0:m[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),a&&a.c(),f=Ye()},m(m,g){P(e,m,g),$(m,n,g),P(t,m,g),$(m,l,g),P(o,m,g),$(m,i,g),~s&&_[s].m(m,g),$(m,f,g),u=!0},p(m,g){let v=s;s=d(m),s===v?~s&&_[s].p(m,g):(a&&(he(),S(_[v],1,1,()=>{_[v]=null}),be()),~s?(a=_[s],a?a.p(m,g):(a=_[s]=c[s](m),a.c()),b(a,1),a.m(f.parentNode,f)):a=null)},i(m){u||(b(e.$$.fragment,m),b(t.$$.fragment,m),b(o.$$.fragment,m),b(a),u=!0)},o(m){S(e.$$.fragment,m),S(t.$$.fragment,m),S(o.$$.fragment,m),S(a),u=!1},d(m){m&&(y(n),y(l),y(i),y(f)),I(e,m),I(t,m),I(o,m),~s&&_[s].d(m)}}}function qi(r){let e,n,t,l,o,i,s,a;return e=new Ke({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[f0]},$$scope:{ctx:r}}}),t=new Ke({props:{data:r[0].roadGj,$$slots:{default:[u0]},$$scope:{ctx:r}}}),o=new wn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[c0]},$$scope:{ctx:r}}}),s=new wn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[d0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),F(s.$$.fragment)},m(f,u){P(e,f,u),$(f,n,u),P(t,f,u),$(f,l,u),P(o,f,u),$(f,i,u),P(s,f,u),a=!0},p(f,u){const c={};u&1&&(c.data=f[0].gj.features[f[0].shortcutIndex]),u&1024&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};u&1&&(_.data=f[0].roadGj),u&1024&&(_.$$scope={dirty:u,ctx:f}),t.$set(_);const d={};u&1&&(d.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[0]),u&1024&&(d.$$scope={dirty:u,ctx:f}),o.$set(d);const m={};u&1&&(m.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[f[0].gj.features[f[0].shortcutIndex].geometry.coordinates.length-1]),u&1024&&(m.$$scope={dirty:u,ctx:f}),s.$set(m)},i(f){a||(b(e.$$.fragment,f),b(t.$$.fragment,f),b(o.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),S(o.$$.fragment,f),S(s.$$.fragment,f),a=!1},d(f){f&&(y(n),y(l),y(i)),I(e,f),I(t,f),I(o,f),I(s,f)}}}function f0(r){let e,n;const t=[we("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function u0(r){let e,n;const t=[we("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new et({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function c0(r){let e;return{c(){e=j("A")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function d0(r){let e;return{c(){e=j("B")},m(n,t){$(n,e,t)},d(n){n&&y(e)}}}function _0(r){let e,n,t,l,o,i;n=new lr({props:{$$slots:{default:[a0]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&qi(r);return o=new hn({}),{c(){e=k("div"),F(n.$$.fragment),t=M(),s&&s.c(),l=M(),F(o.$$.fragment),N(e,"slot","map")},m(a,f){$(a,e,f),P(n,e,null),p(e,t),s&&s.m(e,null),p(e,l),P(o,e,null),i=!0},p(a,f){const u={};f&1025&&(u.$$scope={dirty:f,ctx:a}),n.$set(u),a[0].state=="chose-road"?s?(s.p(a,f),f&1&&b(s,1)):(s=qi(a),s.c(),b(s,1),s.m(e,l)):s&&(he(),S(s,1,1,()=>{s=null}),be())},i(a){i||(b(n.$$.fragment,a),b(s),b(o.$$.fragment,a),i=!0)},o(a){S(n.$$.fragment,a),S(s),S(o.$$.fragment,a),i=!1},d(a){a&&y(e),I(n),s&&s.d(),I(o)}}}function m0(r){let e,n;return e=new At({props:{$$slots:{map:[_0],sidebar:[r0],top:[e0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,[l]){const o={};l&1027&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function p0(r,e,n){let t,l;X(r,ce,_=>n(1,t=_)),X(r,xe,_=>n(8,l=_));let o={state:"neutral"};function i(_,d){let m=l.getShortcutsCrossingRoad(_.properties.id);if(m.features.length==0){window.alert("No shortcuts here");return}n(0,o={state:"chose-road",roadGj:_,gj:m,shortcutIndex:0})}function s(){te(ce,t={mode:"neighbourhood"},t)}const a=()=>n(0,o={state:"neutral"});function f(_){r.$$.not_equal(o.shortcutIndex,_)&&(o.shortcutIndex=_,n(0,o))}return[o,t,i,s,a,f,()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class g0 extends ie{constructor(e){super(),se(this,e,p0,m0,le,{})}}function h0(r){let e,n,t,l,o,i,s,a,f;return l=new H1({}),{c(){e=k("div"),n=k("button"),n.innerHTML=`<img src="${va}" style="height: 6vh;" alt="A/B Street logo"/>`,t=M(),F(l.$$.fragment),o=M(),i=k("span"),N(n,"class","outline"),oe(i,"width","100%"),N(e,"slot","top"),N(e,"class","pico"),oe(e,"display","flex")},m(u,c){$(u,e,c),p(e,n),p(e,t),P(l,e,null),p(e,o),p(e,i),r[20](i),s=!0,a||(f=K(n,"click",r[19]),a=!0)},p:Q,i(u){s||(b(l.$$.fragment,u),s=!0)},o(u){S(l.$$.fragment,u),s=!1},d(u){u&&y(e),I(l),r[20](null),a=!1,f()}}}function Ji(r){let e,n,t,l,o,i;return t=new Qu({props:{map:ct(r[6]),maptilerBasemap:r[7]}}),{c(){e=k("button"),e.textContent="Zoom to fit study area",n=M(),F(t.$$.fragment),N(e,"class","secondary")},m(s,a){$(s,e,a),$(s,n,a),P(t,s,a),l=!0,o||(i=K(e,"click",r[11]),o=!0)},p(s,a){const f={};a&64&&(f.map=ct(s[6])),a&128&&(f.maptilerBasemap=s[7]),t.$set(f)},i(s){l||(b(t.$$.fragment,s),l=!0)},o(s){S(t.$$.fragment,s),l=!1},d(s){s&&(y(e),y(n)),I(t,s),o=!1,i()}}}function b0(r){let e,n,t,l,o,i,s=r[5]&&Ji(r);return{c(){e=k("div"),n=k("div"),t=M(),l=k("hr"),o=M(),s&&s.c(),N(e,"class","pico"),N(e,"slot","left")},m(a,f){$(a,e,f),p(e,n),r[18](n),p(e,t),p(e,l),p(e,o),s&&s.m(e,null),i=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&b(s,1)):(s=Ji(a),s.c(),b(s,1),s.m(e,null)):s&&(he(),S(s,1,1,()=>{s=null}),be())},i(a){i||(b(s),i=!0)},o(a){S(s),i=!1},d(a){a&&y(e),r[18](null),s&&s.d()}}}function Yi(r){let e,n;return e=new Bd({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function $0(r){let e,n;return e=new Uh({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function y0(r){let e,n;return e=new Xh({props:{wasmReady:r[4],firstLoad:r[9].firstLoad}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&16&&(o.wasmReady=t[4]),l&512&&(o.firstLoad=t[9].firstLoad),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Zi(r){let e,n,t,l,o,i;e=new Ke({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[v0]},$$scope:{ctx:r}}});const s=[E0,I0,P0,F0,A0,T0,M0,L0,C0,S0,k0,w0],a=[];function f(u,c){return u[9].mode=="pick-neighbourhood"?0:u[9].mode=="set-boundary"?1:u[9].mode=="auto-boundaries"?2:u[9].mode=="neighbourhood"?3:u[9].mode=="view-shortcuts"?4:u[9].mode=="impact-one-destination"?5:u[9].mode=="route"?6:u[9].mode=="predict-impact"?7:u[9].mode=="impact-detail"?8:u[9].mode=="debug-neighbourhood"?9:u[9].mode=="debug-intersections"?10:u[9].mode=="debug-demand"?11:-1}return~(t=f(r))&&(l=a[t]=s[t](r)),{c(){F(e.$$.fragment),n=M(),l&&l.c(),o=Ye()},m(u,c){P(e,u,c),$(u,n,c),~t&&a[t].m(u,c),$(u,o,c),i=!0},p(u,c){const _={};c&32&&(_.data=u[5].getInvertedBoundary()),c&4194304&&(_.$$scope={dirty:c,ctx:u}),e.$set(_);let d=t;t=f(u),t===d?~t&&a[t].p(u,c):(l&&(he(),S(a[d],1,1,()=>{a[d]=null}),be()),~t?(l=a[t],l?l.p(u,c):(l=a[t]=s[t](u),l.c()),b(l,1),l.m(o.parentNode,o)):l=null)},i(u){i||(b(e.$$.fragment,u),b(l),i=!0)},o(u){S(e.$$.fragment,u),S(l),i=!1},d(u){u&&(y(n),y(o)),I(e,u),~t&&a[t].d(u)}}}function v0(r){let e,n;const t=[we("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new kt({props:l}),{c(){F(e.$$.fragment)},m(o,i){P(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function w0(r){let e,n;return e=new O_({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function k0(r){let e,n;return e=new Y_({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function S0(r){let e,n;return e=new jm({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function C0(r){let e,n;return e=new tg({props:{road:r[9].road}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.road=t[9].road),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function L0(r){let e,n;return e=new Xg({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function M0(r){let e,n;return e=new f1({props:{prevMode:r[9].prevMode}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.prevMode=t[9].prevMode),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function T0(r){let e,n;return e=new gg({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function A0(r){let e,n;return e=new g0({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function F0(r){let e,n;return e=new Gp({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function P0(r){let e,n;return e=new L_({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function I0(r){let e,n;return e=new O1({props:{name:r[9].name,existing:r[9].existing}}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.name=t[9].name),l&512&&(o.existing=t[9].existing),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function E0(r){let e,n;return e=new Rg({}),{c(){F(e.$$.fragment)},m(t,l){P(e,t,l),n=!0},p:Q,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function N0(r){let e,n,t,l,o,i,s=r[8].startsWith("ltn_cnt/"),a,f,u,c,_,d,m,g,v;e=new ba({}),t=new $a({}),o=new jc({props:{map:r[0],apiKey:el,country:void 0}});let h=s&&Yi();const w=[y0,$0],C=[];function L(T,A){return T[9].mode=="title"?0:T[9].mode=="new-project"?1:-1}~(c=L(r))&&(_=C[c]=w[c](r));let E=r[5]&&Zi(r);return g=new du({}),{c(){F(e.$$.fragment),n=M(),F(t.$$.fragment),l=M(),F(o.$$.fragment),i=M(),h&&h.c(),a=M(),f=k("div"),u=M(),_&&_.c(),d=M(),E&&E.c(),m=M(),F(g.$$.fragment)},m(T,A){P(e,T,A),$(T,n,A),P(t,T,A),$(T,l,A),P(o,T,A),$(T,i,A),h&&h.m(T,A),$(T,a,A),$(T,f,A),r[15](f),$(T,u,A),~c&&C[c].m(T,A),$(T,d,A),E&&E.m(T,A),$(T,m,A),P(g,T,A),v=!0},p(T,A){const z={};A&1&&(z.map=T[0]),o.$set(z),A&256&&(s=T[8].startsWith("ltn_cnt/")),s?h?A&256&&b(h,1):(h=Yi(),h.c(),b(h,1),h.m(a.parentNode,a)):h&&(he(),S(h,1,1,()=>{h=null}),be());let O=c;c=L(T),c===O?~c&&C[c].p(T,A):(_&&(he(),S(C[O],1,1,()=>{C[O]=null}),be()),~c?(_=C[c],_?_.p(T,A):(_=C[c]=w[c](T),_.c()),b(_,1),_.m(d.parentNode,d)):_=null),T[5]?E?(E.p(T,A),A&32&&b(E,1)):(E=Zi(T),E.c(),b(E,1),E.m(m.parentNode,m)):E&&(he(),S(E,1,1,()=>{E=null}),be())},i(T){v||(b(e.$$.fragment,T),b(t.$$.fragment,T),b(o.$$.fragment,T),b(h),b(_),b(E),b(g.$$.fragment,T),v=!0)},o(T){S(e.$$.fragment,T),S(t.$$.fragment,T),S(o.$$.fragment,T),S(h),S(_),S(E),S(g.$$.fragment,T),v=!1},d(T){T&&(y(n),y(l),y(i),y(a),y(f),y(u),y(d),y(m)),I(e,T),I(t,T),I(o,T),h&&h.d(T),r[15](null),~c&&C[c].d(T),E&&E.d(T),I(g,T)}}}function j0(r){let e,n,t,l;function o(s){r[16](s)}let i={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${el}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:ya},{id:"national_rail",url:es}],$$slots:{default:[N0]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.map=r[0]),n=new ha({props:i}),Be.push(()=>st(n,"map",o)),n.$on("error",r[17]),{c(){e=k("div"),F(n.$$.fragment),N(e,"slot","main"),oe(e,"position","relative"),oe(e,"width","100%"),oe(e,"height","100%")},m(s,a){$(s,e,a),P(n,e,null),l=!0},p(s,a){const f={};a&128&&(f.style=`https://api.maptiler.com/maps/${s[7]}/style.json?key=${el}`),a&4195129&&(f.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,f.map=s[0],at(()=>t=!1)),n.$set(f)},i(s){l||(b(n.$$.fragment,s),l=!0)},o(s){S(n.$$.fragment,s),l=!1},d(s){s&&y(e),I(n)}}}function z0(r){let e,n,t,l,o;return n=new zf({}),l=new xd({props:{$$slots:{main:[j0],left:[b0],top:[h0]},$$scope:{ctx:r}}}),{c(){e=k("div"),F(n.$$.fragment),t=M(),F(l.$$.fragment),N(e,"class","pico")},m(i,s){$(i,e,s),P(n,e,null),$(i,t,s),P(l,i,s),o=!0},p(i,[s]){const a={};s&4196351&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(b(n.$$.fragment,i),b(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&(y(e),y(t)),I(n),I(l,i)}}}function O0(r,e,n){let t,l,o,i,s,a,f,u,c,_;X(r,ul,O=>n(12,t=O)),X(r,fl,O=>n(13,l=O)),X(r,al,O=>n(14,o=O)),X(r,xe,O=>n(5,i=O)),X(r,xt,O=>n(6,s=O)),X(r,Il,O=>n(21,a=O)),X(r,Xr,O=>n(7,f=O)),X(r,Zt,O=>n(8,u=O)),X(r,ce,O=>n(9,c=O)),X(r,hr,O=>n(10,_=O));let d=!1;Cr(async()=>{await Cs(),await rs(),n(4,d=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(te(Il,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let m=null;function g(){s.fitBounds(i.getBounds(),{animate:!1})}let v,h,w;function C(O){Be[O?"unshift":"push"](()=>{w=O,n(3,w),n(12,t)})}function L(O){m=O,n(0,m)}const E=O=>{console.log(O.detail.error)};function T(O){Be[O?"unshift":"push"](()=>{h=O,n(2,h),n(13,l)})}const A=()=>te(hr,_=!0,_);function z(O){Be[O?"unshift":"push"](()=>{v=O,n(1,v),n(14,o)})}return r.$$.update=()=>{r.$$.dirty&1&&m&&xt.set(m),r.$$.dirty&16386&&v&&o&&(n(1,v.innerHTML="",v),v.appendChild(o)),r.$$.dirty&8196&&h&&l&&(n(2,h.innerHTML="",h),h.appendChild(l)),r.$$.dirty&4104&&w&&t&&(n(3,w.innerHTML="",w),w.appendChild(t))},[m,v,h,w,d,i,s,f,u,c,_,g,t,l,o,C,L,E,T,A,z]}class B0 extends ie{constructor(e){super(),se(this,e,O0,z0,le,{})}}new B0({target:document.getElementById("app")});
