var Wb=Object.defineProperty;var $b=(o,e,t)=>e in o?Wb(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Dn=(o,e,t)=>($b(o,typeof e!="symbol"?e+"":e,t),t);function Hb(o,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in o)){const u=Object.getOwnPropertyDescriptor(n,l);u&&Object.defineProperty(o,l,u.get?u:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function Dt(){}function an(o,e){for(const t in e)o[t]=e[t];return o}function jy(o){return o()}function vg(){return Object.create(null)}function ln(o){o.forEach(jy)}function Kl(o){return typeof o=="function"}function Ft(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let Yh;function En(o,e){return o===e?!0:(Yh||(Yh=document.createElement("a")),Yh.href=e,o===Yh.href)}function Xb(o){return Object.keys(o).length===0}function Uy(o,...e){if(o==null){for(const n of e)n(void 0);return Dt}const t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Lr(o){let e;return Uy(o,t=>e=t)(),e}function dt(o,e,t){o.$$.on_destroy.push(Uy(e,t))}function Ni(o,e,t,n){if(o){const l=Vy(o,e,t,n);return o[0](l)}}function Vy(o,e,t,n){return o[1]&&n?an(t.ctx.slice(),o[1](n(e))):t.ctx}function ji(o,e,t,n){if(o[2]&&n){const l=o[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Ui(o,e,t,n,l,u){if(l){const d=Vy(e,t,n,u);o.p(d,l)}}function Vi(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function Kb(o){const e={};for(const t in o)e[t]=!0;return e}function fd(o){return o??""}function At(o,e,t){return o.set(t),e}function Yf(o){return o&&Kl(o.destroy)?o.destroy:Dt}const kd=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Q(o,e){o.appendChild(e)}function he(o,e,t){o.insertBefore(e,t||null)}function ue(o){o.parentNode&&o.parentNode.removeChild(o)}function Ss(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function ce(o){return document.createElement(o)}function xs(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Qe(o){return document.createTextNode(o)}function Re(){return Qe(" ")}function Fn(){return Qe("")}function Et(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function xp(o){return function(e){return e.preventDefault(),o.call(this,e)}}function jf(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function Te(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function qy(o){let e;return{p(...t){e=t,e.forEach(n=>o.push(n))},r(){e.forEach(t=>o.splice(o.indexOf(t),1))}}}function kp(o){return o===""?null:+o}function Jb(o){return Array.from(o.childNodes)}function Mi(o,e){e=""+e,o.data!==e&&(o.data=e)}function Hn(o,e){o.value=e??""}function pn(o,e,t,n){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,n?"important":"")}function Jl(o,e,t){for(let n=0;n<o.options.length;n+=1){const l=o.options[n];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Sp(o){const e=o.querySelector(":checked");return e&&e.__value}function cr(o,e,t){o.classList.toggle(e,!!t)}function Yb(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let Su;function bu(o){Su=o}function Nu(){if(!Su)throw new Error("Function called outside component initialization");return Su}function Sd(o){Nu().$$.on_mount.push(o)}function tr(o){Nu().$$.on_destroy.push(o)}function ts(){const o=Nu();return(e,t,{cancelable:n=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=Yb(e,t,{cancelable:n});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function Tp(o,e){return Nu().$$.context.set(o,e),e}function Ep(o){return Nu().$$.context.get(o)}function ui(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Vl=[],Ki=[];let Wl=[];const Qf=[],Zy=Promise.resolve();let ep=!1;function Gy(){ep||(ep=!0,Zy.then($y))}function Wy(){return Gy(),Zy}function Yl(o){Wl.push(o)}function Gr(o){Qf.push(o)}const Uf=new Set;let Bl=0;function $y(){if(Bl!==0)return;const o=Su;do{try{for(;Bl<Vl.length;){const e=Vl[Bl];Bl++,bu(e),Qb(e.$$)}}catch(e){throw Vl.length=0,Bl=0,e}for(bu(null),Vl.length=0,Bl=0;Ki.length;)Ki.pop()();for(let e=0;e<Wl.length;e+=1){const t=Wl[e];Uf.has(t)||(Uf.add(t),t())}Wl.length=0}while(Vl.length);for(;Qf.length;)Qf.pop()();ep=!1,Uf.clear(),bu(o)}function Qb(o){if(o.fragment!==null){o.update(),ln(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Yl)}}function ev(o){const e=[],t=[];Wl.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Wl=e}const nd=new Set;let Da;function _i(){Da={r:0,c:[],p:Da}}function yi(){Da.r||ln(Da.c),Da=Da.p}function ie(o,e){o&&o.i&&(nd.delete(o),o.i(e))}function re(o,e,t,n){if(o&&o.o){if(nd.has(o))return;nd.add(o),Da.c.push(()=>{nd.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function Jn(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function tv(o,e){re(o,1,1,()=>{e.delete(o.key)})}function iv(o,e,t,n,l,u,d,a,_,x,S,k){let C=o.length,L=u.length,z=C;const R={};for(;z--;)R[o[z].key]=z;const D=[],B=new Map,N=new Map,V=[];for(z=L;z--;){const H=k(l,u,z),ee=t(H);let be=d.get(ee);be?n&&V.push(()=>be.p(H,e)):(be=x(ee,H),be.c()),B.set(ee,D[z]=be),ee in R&&N.set(ee,Math.abs(z-R[ee]))}const U=new Set,le=new Set;function oe(H){ie(H,1),H.m(a,S),d.set(H.key,H),S=H.first,L--}for(;C&&L;){const H=D[L-1],ee=o[C-1],be=H.key,Oe=ee.key;H===ee?(S=H.first,C--,L--):B.has(Oe)?!d.has(be)||U.has(be)?oe(H):le.has(Oe)?C--:N.get(be)>N.get(Oe)?(le.add(be),oe(H)):(U.add(Oe),C--):(_(ee,d),C--)}for(;C--;){const H=o[C];B.has(H.key)||_(H,d)}for(;L;)oe(D[L-1]);return ln(V),D}function Tu(o,e){const t={},n={},l={$$scope:1};let u=o.length;for(;u--;){const d=o[u],a=e[u];if(a){for(const _ in d)_ in a||(n[_]=1);for(const _ in a)l[_]||(t[_]=a[_],l[_]=1);o[u]=a}else for(const _ in d)l[_]=1}for(const d in n)d in t||(t[d]=void 0);return t}function Wr(o,e,t){const n=o.$$.props[e];n!==void 0&&(o.$$.bound[n]=t,t(o.$$.ctx[n]))}function Pe(o){o&&o.c()}function Le(o,e,t){const{fragment:n,after_update:l}=o.$$;n&&n.m(e,t),Yl(()=>{const u=o.$$.on_mount.map(jy).filter(Kl);o.$$.on_destroy?o.$$.on_destroy.push(...u):ln(u),o.$$.on_mount=[]}),l.forEach(Yl)}function Ae(o,e){const t=o.$$;t.fragment!==null&&(ev(t.after_update),ln(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function nv(o,e){o.$$.dirty[0]===-1&&(Vl.push(o),Gy(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function Zt(o,e,t,n,l,u,d=null,a=[-1]){const _=Su;bu(o);const x=o.$$={fragment:null,ctx:[],props:u,update:Dt,not_equal:l,bound:vg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:vg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(x.root);let S=!1;if(x.ctx=t?t(o,e.props||{},(k,C,...L)=>{const z=L.length?L[0]:C;return x.ctx&&l(x.ctx[k],x.ctx[k]=z)&&(!x.skip_bound&&x.bound[k]&&x.bound[k](z),S&&nv(o,k)),C}):[],x.update(),S=!0,ln(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const k=Jb(e.target);x.fragment&&x.fragment.l(k),k.forEach(ue)}else x.fragment&&x.fragment.c();e.intro&&ie(o.$$.fragment),Le(o,e.target,e.anchor),$y()}bu(_)}class Gt{constructor(){Dn(this,"$$");Dn(this,"$$set")}$destroy(){Ae(this,1),this.$destroy=Dt}$on(e,t){if(!Kl(t))return Dt;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!Xb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const rv="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(rv);const ov="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",sv="/ltn/assets/logo-97f2d067.svg";function wg(o){let e,t;return{c(){e=ce("div"),t=Qe(o[0]),Te(e,"class","svelte-1uuov7f")},m(n,l){he(n,e,l),Q(e,t)},p(n,l){l&1&&Mi(t,n[0])},d(n){n&&ue(e)}}}function av(o){let e,t=o[0]&&wg(o);return{c(){t&&t.c(),e=Fn()},m(n,l){t&&t.m(n,l),he(n,e,l)},p(n,[l]){n[0]?t?t.p(n,l):(t=wg(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Dt,o:Dt,d(n){n&&ue(e),t&&t.d(n)}}}function lv(o,e,t){let{loading:n}=e;return o.$$set=l=>{"loading"in l&&t(0,n=l.loading)},[n]}class Hy extends Gt{constructor(e){super(),Zt(this,e,lv,av,Ft,{loading:0})}}const cv=o=>({dialog:o&1}),xg=o=>({dialog:o[0]});function uv(o){let e,t,n,l,u;const d=o[4].default,a=Ni(d,o,o[3],xg);return{c(){e=ce("dialog"),t=ce("article"),a&&a.c(),e.open=!0},m(_,x){he(_,e,x),Q(e,t),a&&a.m(t,null),o[6](e),n=!0,l||(u=[Et(window,"click",o[1]),Et(window,"keydown",o[2]),Et(e,"close",o[5])],l=!0)},p(_,[x]){a&&a.p&&(!n||x&9)&&Ui(a,d,_,_[3],n?ji(d,_[3],x,cv):Vi(_[3]),xg)},i(_){n||(ie(a,_),n=!0)},o(_){re(a,_),n=!1},d(_){_&&ue(e),a&&a.d(_),o[6](null),l=!1,ln(u)}}}function hv(o,e,t){let{$$slots:n={},$$scope:l}=e,u;function d(S){u.open&&S.target==u&&u.close()}function a(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),u.close())}function _(S){ui.call(this,o,S)}function x(S){Ki[S?"unshift":"push"](()=>{u=S,t(0,u)})}return o.$$set=S=>{"$$scope"in S&&t(3,l=S.$$scope)},[u,d,a,l,n,_,x]}class Td extends Gt{constructor(e){super(),Zt(this,e,hv,uv,Ft,{})}}function kg(o,e,t){const n=o.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function Sg(o){let e,t,n=o[1]+"",l,u,d,a=o[2]+"",_,x;return{c(){e=ce("tr"),t=ce("td"),l=Qe(n),u=Re(),d=ce("td"),_=Qe(a),x=Re()},m(S,k){he(S,e,k),Q(e,t),Q(t,l),Q(e,u),Q(e,d),Q(d,_),Q(e,x)},p(S,k){k&1&&n!==(n=S[1]+"")&&Mi(l,n),k&1&&a!==(a=S[2]+"")&&Mi(_,a)},d(S){S&&ue(e)}}}function dv(o){let e,t,n=Jn(Object.entries(o[0])),l=[];for(let u=0;u<n.length;u+=1)l[u]=Sg(kg(o,n,u));return{c(){e=ce("table"),t=ce("tbody");for(let u=0;u<l.length;u+=1)l[u].c();Te(e,"class","svelte-lh2o9l")},m(u,d){he(u,e,d),Q(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[d]){if(d&1){n=Jn(Object.entries(u[0]));let a;for(a=0;a<n.length;a+=1){const _=kg(u,n,a);l[a]?l[a].p(_,d):(l[a]=Sg(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}},i:Dt,o:Dt,d(u){u&&ue(e),Ss(l,u)}}}function fv(o,e,t){let{properties:n}=e;return o.$$set=l=>{"properties"in l&&t(0,n=l.properties)},[n]}class Ed extends Gt{constructor(e){super(),Zt(this,e,fv,dv,Ft,{properties:0})}}function pd(o,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",o),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ei(o){if(o==null||o==null)throw new Error("Oops, notNull given something null");return o}var Xy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ky(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Cp(o){if(o.__esModule)return o;var e=o.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(o).forEach(function(n){var l=Object.getOwnPropertyDescriptor(o,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:function(){return o[n]}})}),t}var Jy={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(o,e){(function(t,n){o.exports=n()})(Xy,function(){var t={},n={};function l(d,a,_){if(n[d]=_,d==="index"){var x="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",S={};return n.shared(S),n.index(t,S),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([x],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function a(s,i,c,f){return new(c||(c=Promise))(function(g,v){function w(P){try{I(f.next(P))}catch(O){v(O)}}function T(P){try{I(f.throw(P))}catch(O){v(O)}}function I(P){var O;P.done?g(P.value):(O=P.value,O instanceof c?O:new c(function(j){j(O)})).then(w,T)}I((f=f.apply(s,i||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var x=S;function S(s,i){this.x=s,this.y=i}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,c=s.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),c=Math.sin(s),f=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=f,this},_rotateAround:function(s,i){var c=Math.cos(s),f=Math.sin(s),g=i.y+f*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-f*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(s){return s instanceof S?s:Array.isArray(s)?new S(s[0],s[1]):s};var k=_(x),C=L;function L(s,i,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=f}L.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=g/v}var w=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));f++)s>g?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var z=_(C);let R,D;function B(){return R==null&&(R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),R}function N(){if(D==null&&(D=!1,B())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let f=0;f<5*5;f++){const g=4*f;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(f%5,Math.floor(f/5),1,1)}const c=i.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){D=!0;break}}}return D||!1}function V(s,i,c,f){const g=new z(s,i,c,f);return function(v){return g.solve(v)}}const U=V(.25,.1,.25,1);function le(s,i,c){return Math.min(c,Math.max(i,s))}function oe(s,i,c){const f=c-i,g=((s-i)%f+f)%f+i;return g===i?c:g}function H(s,...i){for(const c of i)for(const f in c)s[f]=c[f];return s}let ee=1;function be(s,i,c){const f={};for(const g in s)f[g]=i.call(c||this,s[g],g,s);return f}function Oe(s,i,c){const f={};for(const g in s)i.call(c||this,s[g],g,s)&&(f[g]=s[g]);return f}function ne(s){return Array.isArray(s)?s.map(ne):typeof s=="object"&&s?be(s,ne):s}const ye={};function Ke(s){ye[s]||(typeof console<"u"&&console.warn(s),ye[s]=!0)}function Ce(s,i,c){return(c.y-s.y)*(i.x-s.x)>(i.y-s.y)*(c.x-s.x)}function et(s){let i=0;for(let c,f,g=0,v=s.length,w=v-1;g<v;w=g++)c=s[g],f=s[w],i+=(f.x-c.x)*(c.y+f.y);return i}function vt(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let pt=null;function st(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ii(s,i,c,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(s,{timestamp:0});try{const w=v==null?void 0:v.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const T=w.startsWith("BGR"),I=new Uint8ClampedArray(f*g*4);if(yield v.copyTo(I,function(P,O,j,$,K){const Y=4*Math.max(-O,0),ae=(Math.max(0,j)-j)*$*4+Y,ge=4*$,xe=Math.max(0,O),Fe=Math.max(0,j);return{rect:{x:xe,y:Fe,width:Math.min(P.width,O+$)-xe,height:Math.min(P.height,j+K)-Fe},layout:[{offset:ae,stride:ge}]}}(s,i,c,f,g)),T)for(let P=0;P<I.length;P+=4){const O=I[P];I[P]=I[P+2],I[P+2]=O}return I}finally{v.close()}})}let Ot,Pt;const Jt="AbortError";function Mt(){return new Error(Jt)}const ei={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Vt(s){return ei.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const hi="global-dispatcher";class xi extends Error{constructor(i,c,f,g){super(`AJAXError: ${c} (${i}): ${f}`),this.status=i,this.statusText=c,this.url=f,this.body=g}}const gi=()=>vt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Pi=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=Vt(s.url);if(f)return f(s,i);if(vt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:hi},i)}if(!(/^file:/.test(c=s.url)||/^file:/.test(gi())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const v=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:gi(),signal:g.signal});f.type==="json"&&v.headers.set("Accept","application/json");const w=yield fetch(v);if(!w.ok){const P=yield w.blob();throw new xi(w.status,w.statusText,f.url,P)}let T;T=f.type==="arrayBuffer"||f.type==="image"?w.arrayBuffer():f.type==="json"?w.json():w.text();const I=yield T;if(g.signal.aborted)throw Mt();return{data:I,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(s,i);if(vt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:hi},i)}var c;return function(f,g){return new Promise((v,w)=>{const T=new XMLHttpRequest;T.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(T.responseType="arraybuffer");for(const I in f.headers)T.setRequestHeader(I,f.headers[I]);f.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=f.credentials==="include",T.onerror=()=>{w(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(f.type==="json")try{I=JSON.parse(T.response)}catch(P){return void w(P)}v({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});w(new xi(T.status,T.statusText,f.url,I))}},g.signal.addEventListener("abort",()=>{T.abort(),w(Mt())}),T.send(f.body)})}(s,i)};function ct(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),c=window.location;return i.protocol===c.protocol&&i.host===c.host}function It(s,i,c){c[s]&&c[s].indexOf(i)!==-1||(c[s]=c[s]||[],c[s].push(i))}function Ne(s,i,c){if(c&&c[s]){const f=c[s].indexOf(i);f!==-1&&c[s].splice(f,1)}}class je{constructor(i,c={}){H(this,c),this.type=i}}class rt extends je{constructor(i,c={}){super("error",H({error:i},c))}}class xt{on(i,c){return this._listeners=this._listeners||{},It(i,c,this._listeners),this}off(i,c){return Ne(i,c,this._listeners),Ne(i,c,this._oneTimeListeners),this}once(i,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},It(i,c,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,c){typeof i=="string"&&(i=new je(i,c||{}));const f=i.type;if(this.listens(f)){i.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,i);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of v)Ne(f,T,this._oneTimeListeners),T.call(this,i);const w=this._eventedParent;w&&(H(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(i))}else i instanceof rt&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,c){return this._eventedParent=i,this._eventedParentData=c,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const di=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ve(s,i){const c={};for(const f in s)f!=="ref"&&(c[f]=s[f]);return di.forEach(f=>{f in i&&(c[f]=i[f])}),c}function $e(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let c=0;c<s.length;c++)if(!$e(s[c],i[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const c in s)if(!$e(s[c],i[c]))return!1;return!0}return s===i}function kt(s,i){s.push(i)}function vn(s,i,c){kt(c,{command:"addSource",args:[s,i[s]]})}function wn(s,i,c){kt(i,{command:"removeSource",args:[s]}),c[s]=!0}function Cn(s,i,c,f){wn(s,c,f),vn(s,i,c)}function ir(s,i,c){let f;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!$e(s[c][f],i[c][f]))return!1;for(f in i[c])if(Object.prototype.hasOwnProperty.call(i[c],f)&&f!=="data"&&!$e(s[c][f],i[c][f]))return!1;return!0}function nr(s,i,c,f,g,v){s=s||{},i=i||{};for(const w in s)Object.prototype.hasOwnProperty.call(s,w)&&($e(s[w],i[w])||c.push({command:v,args:[f,w,i[w],g]}));for(const w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(s,w)&&($e(s[w],i[w])||c.push({command:v,args:[f,w,i[w],g]}))}function Uo(s){return s.id}function Ji(s,i){return s[i.id]=i,s}class ut{constructor(i,c,f,g){this.message=(i?`${i}: `:"")+f,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Xn(s,...i){for(const c of i)for(const f in c)s[f]=c[f];return s}class xn extends Error{constructor(i,c){super(c),this.message=c,this.key=i}}class Lo{constructor(i,c=[]){this.parent=i,this.bindings={};for(const[f,g]of c)this.bindings[f]=g}concat(i){return new Lo(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const qi={kind:"null"},gt={kind:"number"},ni={kind:"string"},Yt={kind:"boolean"},Zi={kind:"color"},yr={kind:"object"},ti={kind:"value"},eo={kind:"collator"},cn={kind:"formatted"},me={kind:"padding"},W={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function te(s,i){return{kind:"array",itemType:s,N:i}}function de(s){if(s.kind==="array"){const i=de(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const Me=[qi,gt,ni,Yt,Zi,cn,yr,te(ti),me,W,X];function Ie(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Ie(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const c of Me)if(!Ie(c,i))return null}}return`Expected ${de(s)} but found ${de(i)} instead.`}function Be(s,i){return i.some(c=>c.kind===s.kind)}function ke(s,i){return i.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function G(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const Ue=.96422,qe=.82521,Ge=4/29,Je=6/29,ht=3*Je*Je,Rt=Je*Je*Je,Xt=Math.PI/180,ai=180/Math.PI;function bi(s){return(s%=360)<0&&(s+=360),s}function Yi([s,i,c,f]){let g,v;const w=li((.2225045*(s=Mn(s))+.7168786*(i=Mn(i))+.0606169*(c=Mn(c)))/1);s===i&&i===c?g=v=w:(g=li((.4360747*s+.3850649*i+.1430804*c)/Ue),v=li((.0139322*s+.0971045*i+.7141733*c)/qe));const T=116*w-16;return[T<0?0:T,500*(g-w),200*(w-v),f]}function Mn(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function li(s){return s>Rt?Math.pow(s,1/3):s/ht+Ge}function un([s,i,c,f]){let g=(s+16)/116,v=isNaN(i)?g:g+i/500,w=isNaN(c)?g:g-c/200;return g=1*ur(g),v=Ue*ur(v),w=qe*ur(w),[On(3.1338561*v-1.6168667*g-.4906146*w),On(-.9787684*v+1.9161415*g+.033454*w),On(.0719453*v-.2289914*g+1.4052427*w),f]}function On(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function ur(s){return s>Je?s*s*s:ht*(s-Ge)}function br(s){return parseInt(s.padEnd(2,s),16)/255}function Kn(s,i){return po(i?s/100:s,0,1)}function po(s,i,c){return Math.min(Math.max(i,s),c)}function $u(s){return!s.some(Number.isNaN)}const Dd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Di{constructor(i,c,f,g=1,v=!0){this.r=i,this.g=c,this.b=f,this.a=g,v||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,c,f,g]))}static parse(i){if(i instanceof Di)return i;if(typeof i!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Dd[f];if(g){const[w,T,I]=g;return[w/255,T/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let T=1;return[br(f.slice(T,T+=w)),br(f.slice(T,T+=w)),br(f.slice(T,T+=w)),br(f.slice(T,T+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[T,I,P,O,j,$,K,Y,ae,ge,xe,Fe]=w,Se=[O||" ",K||" ",ge].join("");if(Se==="  "||Se==="  /"||Se===",,"||Se===",,,"){const ze=[P,$,ae].join(""),Ye=ze==="%%%"?100:ze===""?255:0;if(Ye){const tt=[po(+I/Ye,0,1),po(+j/Ye,0,1),po(+Y/Ye,0,1),xe?Kn(+xe,Fe):1];if($u(tt))return tt}}return}}const v=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,T,I,P,O,j,$,K,Y]=v,ae=[I||" ",O||" ",$].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const ge=[+T,po(+P,0,100),po(+j,0,100),K?Kn(+K,Y):1];if($u(ge))return function([xe,Fe,Se,ze]){function Ye(tt){const Ct=(tt+xe/30)%12,Bt=Fe*Math.min(Se,1-Se);return Se-Bt*Math.max(-1,Math.min(Ct-3,9-Ct,1))}return xe=bi(xe),Fe/=100,Se/=100,[Ye(0),Ye(8),Ye(4),ze]}(ge)}}}(i);return c?new Di(...c,!1):void 0}get rgb(){const{r:i,g:c,b:f,a:g}=this,v=g||1/0;return this.overwriteGetter("rgb",[i/v,c/v,f/v,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[c,f,g,v]=Yi(i),w=Math.sqrt(f*f+g*g);return[Math.round(1e4*w)?bi(Math.atan2(g,f)*ai):NaN,w,c,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Yi(this.rgb))}overwriteGetter(i,c){return Object.defineProperty(this,i,{value:c}),c}toString(){const[i,c,f,g]=this.rgb;return`rgba(${[i,c,f].map(v=>Math.round(255*v)).join(",")},${g})`}}Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1);class oc{constructor(i,c,f){this.sensitivity=i?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,c){return this.collator.compare(i,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sc{constructor(i,c,f,g,v){this.text=i,this.image=c,this.scale=f,this.fontStack=g,this.textColor=v}}class Pr{constructor(i){this.sections=i}static fromString(i){return new Pr([new sc(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Pr?i:Pr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class vr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof vr)return i;if(typeof i=="number")return new vr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const c of i)if(typeof c!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new vr(i)}}toString(){return JSON.stringify(this.values)}}const aa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $r{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof $r)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let c=0;c<i.length;c+=2){const f=i[c],g=i[c+1];if(typeof f!="string"||!aa.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new $r(i)}}toString(){return JSON.stringify(this.values)}}class Hr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Hr({name:i,available:!1}):null}}function As(s,i,c,f){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,i,c,f]:[s,i,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Na(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Di||s instanceof oc||s instanceof Pr||s instanceof vr||s instanceof $r||s instanceof Hr)return!0;if(Array.isArray(s)){for(const i of s)if(!Na(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!Na(s[i]))return!1;return!0}return!1}function In(s){if(s===null)return qi;if(typeof s=="string")return ni;if(typeof s=="boolean")return Yt;if(typeof s=="number")return gt;if(s instanceof Di)return Zi;if(s instanceof oc)return eo;if(s instanceof Pr)return cn;if(s instanceof vr)return me;if(s instanceof $r)return X;if(s instanceof Hr)return W;if(Array.isArray(s)){const i=s.length;let c;for(const f of s){const g=In(f);if(c){if(c===g)continue;c=ti;break}c=g}return te(c||ti,i)}return yr}function la(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof Di||s instanceof Pr||s instanceof vr||s instanceof $r||s instanceof Hr?s.toString():JSON.stringify(s)}class Vo{constructor(i,c){this.type=i,this.value=c}static parse(i,c){if(i.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Na(i[1]))return c.error("invalid value");const f=i[1];let g=In(f);const v=c.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new Vo(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class nn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ja={string:ni,number:gt,boolean:Yt,object:yr};class zr{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");let f,g=1;const v=i[0];if(v==="array"){let T,I;if(i.length>2){const P=i[1];if(typeof P!="string"||!(P in ja)||P==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=ja[P],g++}else T=ti;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=i[2],g++}f=te(T,I)}else{if(!ja[v])throw new Error(`Types doesn't contain name = ${v}`);f=ja[v]}const w=[];for(;g<i.length;g++){const T=c.parse(i[g],g,ti);if(!T)return null;w.push(T)}return new zr(f,w)}evaluate(i){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(i);if(!Ie(this.type,In(f)))return f;if(c===this.args.length-1)throw new nn(`Expected value to be of type ${de(this.type)}, but found ${de(In(f))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Ua={"to-boolean":Yt,"to-color":Zi,"to-number":gt,"to-string":ni};class mo{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const f=i[0];if(!Ua[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return c.error("Expected one argument.");const g=Ua[f],v=[];for(let w=1;w<i.length;w++){const T=c.parse(i[w],w,ti);if(!T)return null;v.push(T)}return new mo(g,v)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let c,f;for(const g of this.args){if(c=g.evaluate(i),f=null,c instanceof Di)return c;if(typeof c=="string"){const v=i.parseColor(c);if(v)return v}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:As(c[0],c[1],c[2],c[3]),!f))return new Di(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new nn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(i);const g=vr.parse(c);if(g)return g}throw new nn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(i);const g=$r.parse(c);if(g)return g}throw new nn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(i),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new nn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Pr.fromString(la(this.args[0].evaluate(i)));case"resolvedImage":return Hr.fromString(la(this.args[0].evaluate(i)));default:return la(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ca=["Unknown","Point","LineString","Polygon"];class Ri{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ca[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let c=this._parseColorCache[i];return c||(c=this._parseColorCache[i]=Di.parse(i)),c}}class Va{constructor(i,c,f=[],g,v=new Lo,w=[]){this.registry=i,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=v,this.errors=w,this.expectedType=g,this._isConstant=c}parse(i,c,f,g,v={}){return c?this.concat(c,f,g)._parse(i,v):this._parse(i,v)}_parse(i,c){function f(g,v,w){return w==="assert"?new zr(v,[g]):w==="coerce"?new mo(v,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let w=v.parse(i,this);if(!w)return null;if(this.expectedType){const T=this.expectedType,I=w.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(T.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(T,I))return null}else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"assert")}if(!(w instanceof Vo)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const T=new Ri;try{w=new Vo(w.type,w.evaluate(T))}catch(I){return this.error(I.message),null}}return w}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,c,f){const g=typeof i=="number"?this.path.concat(i):this.path,v=f?this.scope.concat(f):this.scope;return new Va(this.registry,this._isConstant,g,c||null,v,this.errors)}error(i,...c){const f=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new xn(f,i))}checkSubtype(i,c){const f=Ie(i,c);return f&&this.error(f),f}}class Ps{constructor(i,c,f){this.type=eo,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=c}static parse(i,c){if(i.length!==2)return c.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const g=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Yt);if(!g)return null;const v=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Yt);if(!v)return null;let w=null;return f.locale&&(w=c.parse(f.locale,1,ni),!w)?null:new Ps(g,v,w)}evaluate(i){return new oc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const qo=8192;function qa(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function ua(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Rd(s,i){const c=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(c*g*qo),Math.round(f*g*qo)]}function Hu(s,i,c){const f=s[0]-i[0],g=s[1]-i[1],v=s[0]-c[0],w=s[1]-c[1];return f*w-v*g==0&&f*v<=0&&g*w<=0}function Za(s,i){let c=!1;for(let w=0,T=i.length;w<T;w++){const I=i[w];for(let P=0,O=I.length;P<O-1;P++){if(Hu(s,I[P],I[P+1]))return!1;(g=I[P])[1]>(f=s)[1]!=(v=I[P+1])[1]>f[1]&&f[0]<(v[0]-g[0])*(f[1]-g[1])/(v[1]-g[1])+g[0]&&(c=!c)}}var f,g,v;return c}function Bd(s,i){for(let c=0;c<i.length;c++)if(Za(s,i[c]))return!0;return!1}function Xu(s,i,c,f){const g=f[0]-c[0],v=f[1]-c[1],w=(s[0]-c[0])*v-g*(s[1]-c[1]),T=(i[0]-c[0])*v-g*(i[1]-c[1]);return w>0&&T<0||w<0&&T>0}function Fd(s,i,c){for(const P of c)for(let O=0;O<P.length-1;++O)if((T=[(w=P[O+1])[0]-(v=P[O])[0],w[1]-v[1]])[0]*(I=[(g=i)[0]-(f=s)[0],g[1]-f[1]])[1]-T[1]*I[0]!=0&&Xu(f,g,v,w)&&Xu(v,w,f,g))return!0;var f,g,v,w,T,I;return!1}function Ku(s,i){for(let c=0;c<s.length;++c)if(!Za(s[c],i))return!1;for(let c=0;c<s.length-1;++c)if(Fd(s[c],s[c+1],i))return!1;return!0}function Ju(s,i){for(let c=0;c<i.length;c++)if(Ku(s,i[c]))return!0;return!1}function Ga(s,i,c){const f=[];for(let g=0;g<s.length;g++){const v=[];for(let w=0;w<s[g].length;w++){const T=Rd(s[g][w],c);qa(i,T),v.push(T)}f.push(v)}return f}function Yu(s,i,c){const f=[];for(let g=0;g<s.length;g++){const v=Ga(s[g],i,c);f.push(v)}return f}function Qu(s,i,c,f){if(s[0]<c[0]||s[0]>c[2]){const g=.5*f;let v=s[0]-c[0]>g?-f:c[0]-s[0]>g?f:0;v===0&&(v=s[0]-c[2]>g?-f:c[2]-s[0]>g?f:0),s[0]+=v}qa(i,s)}function Wa(s,i,c,f){const g=Math.pow(2,f.z)*qo,v=[f.x*qo,f.y*qo],w=[];for(const T of s)for(const I of T){const P=[I.x+v[0],I.y+v[1]];Qu(P,i,c,g),w.push(P)}return w}function eh(s,i,c,f){const g=Math.pow(2,f.z)*qo,v=[f.x*qo,f.y*qo],w=[];for(const I of s){const P=[];for(const O of I){const j=[O.x+v[0],O.y+v[1]];qa(i,j),P.push(j)}w.push(P)}if(i[2]-i[0]<=g/2){(T=i)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of w)for(const P of I)Qu(P,i,c,g)}var T;return w}class rs{constructor(i,c){this.type=Yt,this.geojson=i,this.geometries=c}static parse(i,c){if(i.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Na(i[1])){const f=i[1];if(f.type==="FeatureCollection"){const g=[];for(const v of f.features){const{type:w,coordinates:T}=v.geometry;w==="Polygon"&&g.push(T),w==="MultiPolygon"&&g.push(...T)}if(g.length)return new rs(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new rs(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new rs(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const T=Ga(f.coordinates,v,w),I=Wa(c.geometry(),g,v,w);if(!ua(g,v))return!1;for(const P of I)if(!Za(P,T))return!1}if(f.type==="MultiPolygon"){const T=Yu(f.coordinates,v,w),I=Wa(c.geometry(),g,v,w);if(!ua(g,v))return!1;for(const P of I)if(!Bd(P,T))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const T=Ga(f.coordinates,v,w),I=eh(c.geometry(),g,v,w);if(!ua(g,v))return!1;for(const P of I)if(!Ku(P,T))return!1}if(f.type==="MultiPolygon"){const T=Yu(f.coordinates,v,w),I=eh(c.geometry(),g,v,w);if(!ua(g,v))return!1;for(const P of I)if(!Ju(P,T))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $a{constructor(i,c){this.type=c.type,this.name=i,this.boundExpression=c}static parse(i,c){if(i.length!==2||typeof i[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=i[1];return c.scope.has(f)?new $a(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Dr{constructor(i,c,f,g){this.name=i,this.type=c,this._evaluate=f,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,c){const f=i[0],g=Dr.definitions[f];if(!g)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=w.filter(([P])=>!Array.isArray(P)||P.length===i.length-1);let I=null;for(const[P,O]of T){I=new Va(c.registry,ha,c.path,null,c.scope);const j=[];let $=!1;for(let K=1;K<i.length;K++){const Y=i[K],ae=Array.isArray(P)?P[K-1]:P.type,ge=I.parse(Y,1+j.length,ae);if(!ge){$=!0;break}j.push(ge)}if(!$)if(Array.isArray(P)&&P.length!==j.length)I.error(`Expected ${P.length} arguments, but found ${j.length} instead.`);else{for(let K=0;K<j.length;K++){const Y=Array.isArray(P)?P[K]:P.type,ae=j[K];I.concat(K+1).checkSubtype(Y,ae.type)}if(I.errors.length===0)return new Dr(f,v,O,j)}}if(T.length===1)c.errors.push(...I.errors);else{const P=(T.length?T:w).map(([j])=>{return $=j,Array.isArray($)?`(${$.map(de).join(", ")})`:`(${de($.type)}...)`;var $}).join(" | "),O=[];for(let j=1;j<i.length;j++){const $=c.parse(i[j],1+O.length);if(!$)return null;O.push(de($.type))}c.error(`Expected arguments of type ${P}, but found (${O.join(", ")}) instead.`)}return null}static register(i,c){Dr.definitions=c;for(const f in c)i[f]=Dr}}function ha(s){if(s instanceof $a)return ha(s.boundExpression);if(s instanceof Dr&&s.name==="error"||s instanceof Ps||s instanceof rs)return!1;const i=s instanceof mo||s instanceof zr;let c=!0;return s.eachChild(f=>{c=i?c&&ha(f):c&&f instanceof Vo}),!!c&&Ha(s)&&fa(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ha(s){if(s instanceof Dr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof rs)return!1;let i=!0;return s.eachChild(c=>{i&&!Ha(c)&&(i=!1)}),i}function da(s){if(s instanceof Dr&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(c=>{i&&!da(c)&&(i=!1)}),i}function fa(s,i){if(s instanceof Dr&&i.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(f=>{c&&!fa(f,i)&&(c=!1)}),c}function pa(s,i){const c=s.length-1;let f,g,v=0,w=c,T=0;for(;v<=w;)if(T=Math.floor((v+w)/2),f=s[T],g=s[T+1],f<=i){if(T===c||i<g)return T;v=T+1}else{if(!(f>i))throw new nn("Input is not a number.");w=T-1}return 0}class ma{constructor(i,c,f){this.type=i,this.input=c,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static parse(i,c){if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(i[1],1,gt);if(!f)return null;const g=[];let v=null;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(let w=1;w<i.length;w+=2){const T=w===1?-1/0:i[w],I=i[w+1],P=w,O=w+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const j=c.parse(I,O,v);if(!j)return null;v=v||j.type,g.push([T,j])}return new ma(v,f,g)}evaluate(i){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return f[0].evaluate(i);const v=c.length;return g>=c[v-1]?f[v-1].evaluate(i):f[pa(c,g)].evaluate(i)}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Od(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Nd=th;function th(s,i,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=f}th.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=g/v}var w=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));f++)s>g?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var jd=Od(Nd);function os(s,i,c){return s+c*(i-s)}function Xa(s,i,c){return s.map((f,g)=>os(f,i[g],c))}const hr={number:os,color:function(s,i,c,f="rgb"){switch(f){case"rgb":{const[g,v,w,T]=Xa(s.rgb,i.rgb,c);return new Di(g,v,w,T,!1)}case"hcl":{const[g,v,w,T]=s.hcl,[I,P,O,j]=i.hcl;let $,K;if(isNaN(g)||isNaN(I))isNaN(g)?isNaN(I)?$=NaN:($=I,w!==1&&w!==0||(K=P)):($=g,O!==1&&O!==0||(K=v));else{let Fe=I-g;I>g&&Fe>180?Fe-=360:I<g&&g-I>180&&(Fe+=360),$=g+c*Fe}const[Y,ae,ge,xe]=function([Fe,Se,ze,Ye]){return Fe=isNaN(Fe)?0:Fe*Xt,un([ze,Math.cos(Fe)*Se,Math.sin(Fe)*Se,Ye])}([$,K??os(v,P,c),os(w,O,c),os(T,j,c)]);return new Di(Y,ae,ge,xe,!1)}case"lab":{const[g,v,w,T]=un(Xa(s.lab,i.lab,c));return new Di(g,v,w,T,!1)}}},array:Xa,padding:function(s,i,c){return new vr(Xa(s.values,i.values,c))},variableAnchorOffsetCollection:function(s,i,c){const f=s.values,g=i.values;if(f.length!==g.length)throw new nn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const v=[];for(let w=0;w<f.length;w+=2){if(f[w]!==g[w])throw new nn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${g[w]}`);v.push(f[w]);const[T,I]=f[w+1],[P,O]=g[w+1];v.push([os(T,P,c),os(I,O,c)])}return new $r(v)}};class rr{constructor(i,c,f,g,v){this.type=i,this.operator=c,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[w,T]of v)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(i,c,f,g){let v=0;if(i.name==="exponential")v=Ii(c,i.base,f,g);else if(i.name==="linear")v=Ii(c,1,f,g);else if(i.name==="cubic-bezier"){const w=i.controlPoints;v=new jd(w[0],w[1],w[2],w[3]).solve(Ii(c,1,f,g))}return v}static parse(i,c){let[f,g,v,...w]=i;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const P=g[1];if(typeof P!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:P}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const P=g.slice(1);if(P.length!==4||P.some(O=>typeof O!="number"||O<0||O>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:P}}}if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(v=c.parse(v,2,gt),!v)return null;const T=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Zi:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let P=0;P<w.length;P+=2){const O=w[P],j=w[P+1],$=P+3,K=P+4;if(typeof O!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=O)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const Y=c.parse(j,K,I);if(!Y)return null;I=I||Y.type,T.push([O,Y])}return G(I,gt)||G(I,Zi)||G(I,me)||G(I,X)||G(I,te(gt))?new rr(I,f,g,v,T):c.error(`Type ${de(I)} is not interpolatable.`)}evaluate(i){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return f[0].evaluate(i);const v=c.length;if(g>=c[v-1])return f[v-1].evaluate(i);const w=pa(c,g),T=rr.interpolationFactor(this.interpolation,g,c[w],c[w+1]),I=f[w].evaluate(i),P=f[w+1].evaluate(i);switch(this.operator){case"interpolate":return hr[this.type.kind](I,P,T);case"interpolate-hcl":return hr.color(I,P,T,"hcl");case"interpolate-lab":return hr.color(I,P,T,"lab")}}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Ii(s,i,c,f){const g=f-c,v=s-c;return g===0?0:i===1?v/g:(Math.pow(i,v)-1)/(Math.pow(i,g)-1)}class Ka{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expectected at least one argument.");let f=null;const g=c.expectedType;g&&g.kind!=="value"&&(f=g);const v=[];for(const T of i.slice(1)){const I=c.parse(T,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,v.push(I)}if(!f)throw new Error("No output type");const w=g&&v.some(T=>Ie(g,T.type));return new Ka(w?ti:f,v)}evaluate(i){let c,f=null,g=0;for(const v of this.args)if(g++,f=v.evaluate(i),f&&f instanceof Hr&&!f.available&&(c||(c=f.name),f=null,g===this.args.length&&(f=c)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class Ja{constructor(i,c){this.type=c.type,this.bindings=[].concat(i),this.result=c}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const c of this.bindings)i(c[1]);i(this.result)}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let v=1;v<i.length-1;v+=2){const w=i[v];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,v);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=c.parse(i[v+1],v+1);if(!T)return null;f.push([w,T])}const g=c.parse(i[i.length-1],i.length-1,c.expectedType,f);return g?new Ja(f,g):null}outputDefined(){return this.result.outputDefined()}}class ac{constructor(i,c,f){this.type=i,this.index=c,this.input=f}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,gt),g=c.parse(i[2],2,te(c.expectedType||ti));return f&&g?new ac(g.type.itemType,f,g):null}evaluate(i){const c=this.index.evaluate(i),f=this.input.evaluate(i);if(c<0)throw new nn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new nn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new nn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class lc{constructor(i,c){this.type=Yt,this.needle=i,this.haystack=c}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,ti),g=c.parse(i[2],2,ti);return f&&g?Be(f.type,[Yt,ni,gt,qi,ti])?new lc(f,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`):null}evaluate(i){const c=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!ke(c,["boolean","string","number","null"]))throw new nn(`Expected first argument to be of type boolean, string, number or null, but found ${de(In(c))} instead.`);if(!ke(f,["string","array"]))throw new nn(`Expected second argument to be of type array or string, but found ${de(In(f))} instead.`);return f.indexOf(c)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Ya{constructor(i,c,f){this.type=gt,this.needle=i,this.haystack=c,this.fromIndex=f}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,ti),g=c.parse(i[2],2,ti);if(!f||!g)return null;if(!Be(f.type,[Yt,ni,gt,qi,ti]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`);if(i.length===4){const v=c.parse(i[3],3,gt);return v?new Ya(f,g,v):null}return new Ya(f,g)}evaluate(i){const c=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!ke(c,["boolean","string","number","null"]))throw new nn(`Expected first argument to be of type boolean, string, number or null, but found ${de(In(c))} instead.`);if(!ke(f,["string","array"]))throw new nn(`Expected second argument to be of type array or string, but found ${de(In(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return f.indexOf(c,g)}return f.indexOf(c)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class cc{constructor(i,c,f,g,v,w){this.inputType=i,this.type=c,this.input=f,this.cases=g,this.outputs=v,this.otherwise=w}static parse(i,c){if(i.length<5)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return c.error("Expected an even number of arguments.");let f,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const v={},w=[];for(let P=2;P<i.length-1;P+=2){let O=i[P];const j=i[P+1];Array.isArray(O)||(O=[O]);const $=c.concat(P);if(O.length===0)return $.error("Expected at least one branch label.");for(const Y of O){if(typeof Y!="number"&&typeof Y!="string")return $.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return $.error("Numeric branch labels must be integer values.");if(f){if($.checkSubtype(f,In(Y)))return null}else f=In(Y);if(v[String(Y)]!==void 0)return $.error("Branch labels must be unique.");v[String(Y)]=w.length}const K=c.parse(j,P,g);if(!K)return null;g=g||K.type,w.push(K)}const T=c.parse(i[1],1,ti);if(!T)return null;const I=c.parse(i[i.length-1],i.length-1,g);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new cc(f,g,T,v,w,I):null}evaluate(i){const c=this.input.evaluate(i);return(In(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class uc{constructor(i,c,f){this.type=i,this.branches=c,this.otherwise=f}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const g=[];for(let w=1;w<i.length-1;w+=2){const T=c.parse(i[w],w,Yt);if(!T)return null;const I=c.parse(i[w+1],w+1,f);if(!I)return null;g.push([T,I]),f=f||I.type}const v=c.parse(i[i.length-1],i.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new uc(f,g,v)}evaluate(i){for(const[c,f]of this.branches)if(c.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[c,f]of this.branches)i(c),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Qa{constructor(i,c,f,g){this.type=i,this.input=c,this.beginIndex=f,this.endIndex=g}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,ti),g=c.parse(i[2],2,gt);if(!f||!g)return null;if(!Be(f.type,[te(ti),ni,ti]))return c.error(`Expected first argument to be of type array or string, but found ${de(f.type)} instead`);if(i.length===4){const v=c.parse(i[3],3,gt);return v?new Qa(f.type,f,g,v):null}return new Qa(f.type,f,g)}evaluate(i){const c=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!ke(c,["string","array"]))throw new nn(`Expected first argument to be of type array or string, but found ${de(In(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return c.slice(f,g)}return c.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function ih(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function nh(s,i,c,f){return f.compare(i,c)===0}function zs(s,i,c){const f=s!=="=="&&s!=="!=";return class Yy{constructor(v,w,T){this.type=Yt,this.lhs=v,this.rhs=w,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||w.type.kind==="value"}static parse(v,w){if(v.length!==3&&v.length!==4)return w.error("Expected two or three arguments.");const T=v[0];let I=w.parse(v[1],1,ti);if(!I)return null;if(!ih(T,I.type))return w.concat(1).error(`"${T}" comparisons are not supported for type '${de(I.type)}'.`);let P=w.parse(v[2],2,ti);if(!P)return null;if(!ih(T,P.type))return w.concat(2).error(`"${T}" comparisons are not supported for type '${de(P.type)}'.`);if(I.type.kind!==P.type.kind&&I.type.kind!=="value"&&P.type.kind!=="value")return w.error(`Cannot compare types '${de(I.type)}' and '${de(P.type)}'.`);f&&(I.type.kind==="value"&&P.type.kind!=="value"?I=new zr(P.type,[I]):I.type.kind!=="value"&&P.type.kind==="value"&&(P=new zr(I.type,[P])));let O=null;if(v.length===4){if(I.type.kind!=="string"&&P.type.kind!=="string"&&I.type.kind!=="value"&&P.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(v[3],3,eo),!O)return null}return new Yy(I,P,O)}evaluate(v){const w=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const I=In(w),P=In(T);if(I.kind!==P.kind||I.kind!=="string"&&I.kind!=="number")throw new nn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${P.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=In(w),P=In(T);if(I.kind!=="string"||P.kind!=="string")return i(v,w,T)}return this.collator?c(v,w,T,this.collator.evaluate(v)):i(v,w,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Ud=zs("==",function(s,i,c){return i===c},nh),Vd=zs("!=",function(s,i,c){return i!==c},function(s,i,c,f){return!nh(0,i,c,f)}),qd=zs("<",function(s,i,c){return i<c},function(s,i,c,f){return f.compare(i,c)<0}),Zd=zs(">",function(s,i,c){return i>c},function(s,i,c,f){return f.compare(i,c)>0}),Gd=zs("<=",function(s,i,c){return i<=c},function(s,i,c,f){return f.compare(i,c)<=0}),Wd=zs(">=",function(s,i,c){return i>=c},function(s,i,c,f){return f.compare(i,c)>=0});class hc{constructor(i,c,f,g,v){this.type=ni,this.number=i,this.locale=c,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,c){if(i.length!==3)return c.error("Expected two arguments.");const f=c.parse(i[1],1,gt);if(!f)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=c.parse(g.locale,1,ni),!v))return null;let w=null;if(g.currency&&(w=c.parse(g.currency,1,ni),!w))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,gt),!T))return null;let I=null;return g["max-fraction-digits"]&&(I=c.parse(g["max-fraction-digits"],1,gt),!I)?null:new hc(f,v,w,T,I)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class el{constructor(i){this.type=cn,this.sections=i}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const g=[];let v=!1;for(let w=1;w<=i.length-1;++w){const T=i[w];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let I=null;if(T["font-scale"]&&(I=c.parse(T["font-scale"],1,gt),!I))return null;let P=null;if(T["text-font"]&&(P=c.parse(T["text-font"],1,te(ni)),!P))return null;let O=null;if(T["text-color"]&&(O=c.parse(T["text-color"],1,Zi),!O))return null;const j=g[g.length-1];j.scale=I,j.font=P,j.textColor=O}else{const I=c.parse(i[w],1,ti);if(!I)return null;const P=I.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new el(g)}evaluate(i){return new Pr(this.sections.map(c=>{const f=c.content.evaluate(i);return In(f)===W?new sc("",f,null,null,null):new sc(la(f),null,c.scale?c.scale.evaluate(i):null,c.font?c.font.evaluate(i).join(","):null,c.textColor?c.textColor.evaluate(i):null)}))}eachChild(i){for(const c of this.sections)i(c.content),c.scale&&i(c.scale),c.font&&i(c.font),c.textColor&&i(c.textColor)}outputDefined(){return!1}}class dc{constructor(i){this.type=W,this.input=i}static parse(i,c){if(i.length!==2)return c.error("Expected two arguments.");const f=c.parse(i[1],1,ni);return f?new dc(f):c.error("No image name provided.")}evaluate(i){const c=this.input.evaluate(i),f=Hr.fromString(c);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(c)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}}class fc{constructor(i){this.type=gt,this.input=i}static parse(i,c){if(i.length!==2)return c.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=c.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${de(f.type)} instead.`):new fc(f):null}evaluate(i){const c=this.input.evaluate(i);if(typeof c=="string"||Array.isArray(c))return c.length;throw new nn(`Expected value to be of type string or array, but found ${de(In(c))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ds={"==":Ud,"!=":Vd,">":Zd,"<":qd,">=":Wd,"<=":Gd,array:zr,at:ac,boolean:zr,case:uc,coalesce:Ka,collator:Ps,format:el,image:dc,in:lc,"index-of":Ya,interpolate:rr,"interpolate-hcl":rr,"interpolate-lab":rr,length:fc,let:Ja,literal:Vo,match:cc,number:zr,"number-format":hc,object:zr,slice:Qa,step:ma,string:zr,"to-boolean":mo,"to-color":mo,"to-number":mo,"to-string":mo,var:$a,within:rs};function rh(s,[i,c,f,g]){i=i.evaluate(s),c=c.evaluate(s),f=f.evaluate(s);const v=g?g.evaluate(s):1,w=As(i,c,f,v);if(w)throw new nn(w);return new Di(i/255,c/255,f/255,v,!1)}function oh(s,i){return s in i}function pc(s,i){const c=i[s];return c===void 0?null:c}function ss(s){return{type:s}}function sh(s){return{result:"success",value:s}}function Rs(s){return{result:"error",value:s}}function Bs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function ah(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function mc(s){return!!s.expression&&s.expression.interpolated}function Ci(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function tl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function $d(s){return s}function lh(s,i){const c=i.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),v=s.type||(mc(i)?"exponential":"interval");if(c||i.type==="padding"){const O=c?Di.parse:vr.parse;(s=Xn({},s)).stops&&(s.stops=s.stops.map(j=>[j[0],O(j[1])])),s.default=O(s.default?s.default:i.default)}if(s.colorSpace&&(w=s.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var w;let T,I,P;if(v==="exponential")T=ki;else if(v==="interval")T=Hd;else if(v==="categorical"){T=kn,I=Object.create(null);for(const O of s.stops)I[O[0]]=O[1];P=typeof s.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);T=gc}if(f){const O={},j=[];for(let Y=0;Y<s.stops.length;Y++){const ae=s.stops[Y],ge=ae[0].zoom;O[ge]===void 0&&(O[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},j.push(ge)),O[ge].stops.push([ae[0].value,ae[1]])}const $=[];for(const Y of j)$.push([O[Y].zoom,lh(O[Y],i)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:rr.interpolationFactor.bind(void 0,K),zoomStops:$.map(Y=>Y[0]),evaluate:({zoom:Y},ae)=>ki({stops:$,base:s.base},i,Y).evaluate(Y,ae)}}if(g){const O=v==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:rr.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(j=>j[0]),evaluate:({zoom:j})=>T(s,i,j,I,P)}}return{kind:"source",evaluate(O,j){const $=j&&j.properties?j.properties[s.property]:void 0;return $===void 0?ga(s.default,i.default):T(s,i,$,I,P)}}}function ga(s,i,c){return s!==void 0?s:i!==void 0?i:c!==void 0?c:void 0}function kn(s,i,c,f,g){return ga(typeof c===g?f[c]:void 0,s.default,i.default)}function Hd(s,i,c){if(Ci(c)!=="number")return ga(s.default,i.default);const f=s.stops.length;if(f===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[f-1][0])return s.stops[f-1][1];const g=pa(s.stops.map(v=>v[0]),c);return s.stops[g][1]}function ki(s,i,c){const f=s.base!==void 0?s.base:1;if(Ci(c)!=="number")return ga(s.default,i.default);const g=s.stops.length;if(g===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[g-1][0])return s.stops[g-1][1];const v=pa(s.stops.map(O=>O[0]),c),w=function(O,j,$,K){const Y=K-$,ae=O-$;return Y===0?0:j===1?ae/Y:(Math.pow(j,ae)-1)/(Math.pow(j,Y)-1)}(c,f,s.stops[v][0],s.stops[v+1][0]),T=s.stops[v][1],I=s.stops[v+1][1],P=hr[i.type]||$d;return typeof T.evaluate=="function"?{evaluate(...O){const j=T.evaluate.apply(void 0,O),$=I.evaluate.apply(void 0,O);if(j!==void 0&&$!==void 0)return P(j,$,w,s.colorSpace)}}:P(T,I,w,s.colorSpace)}function gc(s,i,c){switch(i.type){case"color":c=Di.parse(c);break;case"formatted":c=Pr.fromString(c.toString());break;case"resolvedImage":c=Hr.fromString(c.toString());break;case"padding":c=vr.parse(c);break;default:Ci(c)===i.type||i.type==="enum"&&i.values[c]||(c=void 0)}return ga(c,s.default,i.default)}Dr.register(Ds,{error:[{kind:"error"},[ni],(s,[i])=>{throw new nn(i.evaluate(s))}],typeof:[ni,[ti],(s,[i])=>de(In(i.evaluate(s)))],"to-rgba":[te(gt,4),[Zi],(s,[i])=>{const[c,f,g,v]=i.evaluate(s).rgb;return[255*c,255*f,255*g,v]}],rgb:[Zi,[gt,gt,gt],rh],rgba:[Zi,[gt,gt,gt,gt],rh],has:{type:Yt,overloads:[[[ni],(s,[i])=>oh(i.evaluate(s),s.properties())],[[ni,yr],(s,[i,c])=>oh(i.evaluate(s),c.evaluate(s))]]},get:{type:ti,overloads:[[[ni],(s,[i])=>pc(i.evaluate(s),s.properties())],[[ni,yr],(s,[i,c])=>pc(i.evaluate(s),c.evaluate(s))]]},"feature-state":[ti,[ni],(s,[i])=>pc(i.evaluate(s),s.featureState||{})],properties:[yr,[],s=>s.properties()],"geometry-type":[ni,[],s=>s.geometryType()],id:[ti,[],s=>s.id()],zoom:[gt,[],s=>s.globals.zoom],"heatmap-density":[gt,[],s=>s.globals.heatmapDensity||0],"line-progress":[gt,[],s=>s.globals.lineProgress||0],accumulated:[ti,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[gt,ss(gt),(s,i)=>{let c=0;for(const f of i)c+=f.evaluate(s);return c}],"*":[gt,ss(gt),(s,i)=>{let c=1;for(const f of i)c*=f.evaluate(s);return c}],"-":{type:gt,overloads:[[[gt,gt],(s,[i,c])=>i.evaluate(s)-c.evaluate(s)],[[gt],(s,[i])=>-i.evaluate(s)]]},"/":[gt,[gt,gt],(s,[i,c])=>i.evaluate(s)/c.evaluate(s)],"%":[gt,[gt,gt],(s,[i,c])=>i.evaluate(s)%c.evaluate(s)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(s,[i,c])=>Math.pow(i.evaluate(s),c.evaluate(s))],sqrt:[gt,[gt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))],log2:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[gt,[gt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[gt,[gt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[gt,[gt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[gt,[gt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[gt,[gt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[gt,[gt],(s,[i])=>Math.atan(i.evaluate(s))],min:[gt,ss(gt),(s,i)=>Math.min(...i.map(c=>c.evaluate(s)))],max:[gt,ss(gt),(s,i)=>Math.max(...i.map(c=>c.evaluate(s)))],abs:[gt,[gt],(s,[i])=>Math.abs(i.evaluate(s))],round:[gt,[gt],(s,[i])=>{const c=i.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[gt,[gt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[gt,[gt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Yt,[ni,ti],(s,[i,c])=>s.properties()[i.value]===c.value],"filter-id-==":[Yt,[ti],(s,[i])=>s.id()===i.value],"filter-type-==":[Yt,[ni],(s,[i])=>s.geometryType()===i.value],"filter-<":[Yt,[ni,ti],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Yt,[ti],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c<f}],"filter->":[Yt,[ni,ti],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f>g}],"filter-id->":[Yt,[ti],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c>f}],"filter-<=":[Yt,[ni,ti],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Yt,[ti],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c<=f}],"filter->=":[Yt,[ni,ti],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Yt,[ti],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c>=f}],"filter-has":[Yt,[ti],(s,[i])=>i.value in s.properties()],"filter-has-id":[Yt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Yt,[te(ni)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Yt,[te(ti)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Yt,[ni,te(ti)],(s,[i,c])=>c.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Yt,[ni,te(ti)],(s,[i,c])=>function(f,g,v,w){for(;v<=w;){const T=v+w>>1;if(g[T]===f)return!0;g[T]>f?w=T-1:v=T+1}return!1}(s.properties()[i.value],c.value,0,c.value.length-1)],all:{type:Yt,overloads:[[[Yt,Yt],(s,[i,c])=>i.evaluate(s)&&c.evaluate(s)],[ss(Yt),(s,i)=>{for(const c of i)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Yt,overloads:[[[Yt,Yt],(s,[i,c])=>i.evaluate(s)||c.evaluate(s)],[ss(Yt),(s,i)=>{for(const c of i)if(c.evaluate(s))return!0;return!1}]]},"!":[Yt,[Yt],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Yt,[ni],(s,[i])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(i.evaluate(s))}],upcase:[ni,[ni],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[ni,[ni],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[ni,ss(ti),(s,i)=>i.map(c=>la(c.evaluate(s))).join("")],"resolved-locale":[ni,[eo],(s,[i])=>i.evaluate(s).resolvedLocale()]});class $i{constructor(i,c){var f;this.expression=i,this._warningHistory={},this._evaluator=new Ri,this._defaultValue=c?(f=c).type==="color"&&tl(f.default)?new Di(0,0,0,0):f.type==="color"?Di.parse(f.default)||null:f.type==="padding"?vr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?$r.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(i,c,f,g,v,w){return this._evaluator.globals=i,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(i,c,f,g,v,w){this._evaluator.globals=i,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new nn(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Gi(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ds}function as(s,i){const c=new Va(Ds,ha,[],i?function(g){const v={color:Zi,string:ni,number:gt,enum:ni,boolean:Yt,formatted:cn,padding:me,resolvedImage:W,variableAnchorOffsetCollection:X};return g.type==="array"?te(v[g.value]||ti,g.length):v[g.type]}(i):void 0),f=c.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?sh(new $i(f,i)):Rs(c.errors)}class il{constructor(i,c){this.kind=i,this._styleExpression=c,this.isStateDependent=i!=="constant"&&!da(c.expression)}evaluateWithoutErrorHandling(i,c,f,g,v,w){return this._styleExpression.evaluateWithoutErrorHandling(i,c,f,g,v,w)}evaluate(i,c,f,g,v,w){return this._styleExpression.evaluate(i,c,f,g,v,w)}}class _c{constructor(i,c,f,g){this.kind=i,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=i!=="camera"&&!da(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,c,f,g,v,w){return this._styleExpression.evaluateWithoutErrorHandling(i,c,f,g,v,w)}evaluate(i,c,f,g,v,w){return this._styleExpression.evaluate(i,c,f,g,v,w)}interpolationFactor(i,c,f){return this.interpolationType?rr.interpolationFactor(this.interpolationType,i,c,f):0}}function ch(s,i){const c=as(s,i);if(c.result==="error")return c;const f=c.value.expression,g=Ha(f);if(!g&&!Bs(i))return Rs([new xn("","data expressions not supported")]);const v=fa(f,["zoom"]);if(!v&&!ah(i))return Rs([new xn("","zoom expressions not supported")]);const w=rl(f);return w||v?w instanceof xn?Rs([w]):w instanceof rr&&!mc(i)?Rs([new xn("",'"interpolate" expressions cannot be used with this property')]):sh(w?new _c(g?"camera":"composite",c.value,w.labels,w instanceof rr?w.interpolation:void 0):new il(g?"constant":"source",c.value)):Rs([new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nl{constructor(i,c){this._parameters=i,this._specification=c,Xn(this,lh(this._parameters,this._specification))}static deserialize(i){return new nl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function rl(s){let i=null;if(s instanceof Ja)i=rl(s.result);else if(s instanceof Ka){for(const c of s.args)if(i=rl(c),i)break}else(s instanceof ma||s instanceof rr)&&s.input instanceof Dr&&s.input.name==="zoom"&&(i=s);return i instanceof xn||s.eachChild(c=>{const f=rl(c);f instanceof xn?i=f:!i&&f?i=new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new xn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function ol(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!ol(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const uh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function sl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};ol(s)||(s=ll(s));const i=as(s,uh);if(i.result==="error")throw new Error(i.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,g)=>i.value.evaluate(c,f,{},g),needGeometry:al(s)}}function hh(s,i){return s<i?-1:s>i?1:0}function al(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let i=1;i<s.length;i++)if(al(s[i]))return!0;return!1}function ll(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?yc(s[1],s[2],"=="):i==="!="?cl(yc(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?yc(s[1],s[2],i):i==="any"?(c=s.slice(1),["any"].concat(c.map(ll))):i==="all"?["all"].concat(s.slice(1).map(ll)):i==="none"?["all"].concat(s.slice(1).map(ll).map(cl)):i==="in"?dh(s[1],s.slice(2)):i==="!in"?cl(dh(s[1],s.slice(2))):i==="has"?fh(s[1]):i==="!has"?cl(fh(s[1])):i!=="within"||s;var c}function yc(s,i,c){switch(s){case"$type":return[`filter-type-${c}`,i];case"$id":return[`filter-id-${c}`,i];default:return[`filter-${c}`,s,i]}}function dh(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(c=>typeof c!=typeof i[0])?["filter-in-large",s,["literal",i.sort(hh)]]:["filter-in-small",s,["literal",i]]}}function fh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function cl(s){return["!",s]}function bc(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const v of s)g+=`${bc(v)},`;return`${g}]`}const c=Object.keys(s).sort();let f="{";for(let g=0;g<c.length;g++)f+=`${JSON.stringify(c[g])}:${bc(s[c[g]])},`;return`${f}}`}function Xd(s){let i="";for(const c of di)i+=`/${bc(s[c])}`;return i}function ph(s){const i=s.value;return i?[new ut(s.key,i,"constants have been deprecated as of v8")]:[]}function hn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Zo(s){if(Array.isArray(s))return s.map(Zo);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const c in s)i[c]=Zo(s[c]);return i}return hn(s)}function dr(s){const i=s.key,c=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},v=s.style,w=s.styleSpec,T=s.validateSpec;let I=[];const P=Ci(c);if(P!=="object")return[new ut(i,c,`object expected, ${P} found`)];for(const O in c){const j=O.split(".")[0],$=f[j]||f["*"];let K;if(g[j])K=g[j];else if(f[j])K=T;else if(g["*"])K=g["*"];else{if(!f["*"]){I.push(new ut(i,c[O],`unknown property "${O}"`));continue}K=T}I=I.concat(K({key:(i&&`${i}.`)+O,value:c[O],valueSpec:$,style:v,styleSpec:w,object:c,objectKey:O,validateSpec:T},c))}for(const O in f)g[O]||f[O].required&&f[O].default===void 0&&c[O]===void 0&&I.push(new ut(i,c,`missing required property "${O}"`));return I}function vc(s){const i=s.value,c=s.valueSpec,f=s.style,g=s.styleSpec,v=s.key,w=s.arrayElementValidator||s.validateSpec;if(Ci(i)!=="array")return[new ut(v,i,`array expected, ${Ci(i)} found`)];if(c.length&&i.length!==c.length)return[new ut(v,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new ut(v,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Ci(c.value)==="object"&&(T=c.value);let I=[];for(let P=0;P<i.length;P++)I=I.concat(w({array:i,arrayIndex:P,value:i[P],valueSpec:T,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${v}[${P}]`}));return I}function ul(s){const i=s.key,c=s.value,f=s.valueSpec;let g=Ci(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new ut(i,c,`number expected, ${g} found`)]:"minimum"in f&&c<f.minimum?[new ut(i,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new ut(i,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function mh(s){const i=s.valueSpec,c=hn(s.value.type);let f,g,v,w={};const T=c!=="categorical"&&s.value.property===void 0,I=!T,P=Ci(s.value.stops)==="array"&&Ci(s.value.stops[0])==="array"&&Ci(s.value.stops[0][0])==="object",O=dr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(K){if(c==="identity")return[new ut(K.key,K.value,'identity function may not have a "stops" property')];let Y=[];const ae=K.value;return Y=Y.concat(vc({key:K.key,value:ae,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:j})),Ci(ae)==="array"&&ae.length===0&&Y.push(new ut(K.key,ae,"array must have at least one stop")),Y},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return c==="identity"&&T&&O.push(new ut(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||O.push(new ut(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!mc(s.valueSpec)&&O.push(new ut(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!Bs(s.valueSpec)?O.push(new ut(s.key,s.value,"property functions not supported")):T&&!ah(s.valueSpec)&&O.push(new ut(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!P||s.value.property!==void 0||O.push(new ut(s.key,s.value,'"property" property is required')),O;function j(K){let Y=[];const ae=K.value,ge=K.key;if(Ci(ae)!=="array")return[new ut(ge,ae,`array expected, ${Ci(ae)} found`)];if(ae.length!==2)return[new ut(ge,ae,`array length 2 expected, length ${ae.length} found`)];if(P){if(Ci(ae[0])!=="object")return[new ut(ge,ae,`object expected, ${Ci(ae[0])} found`)];if(ae[0].zoom===void 0)return[new ut(ge,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new ut(ge,ae,"object stop key must have value")];if(v&&v>hn(ae[0].zoom))return[new ut(ge,ae[0].zoom,"stop zoom values must appear in ascending order")];hn(ae[0].zoom)!==v&&(v=hn(ae[0].zoom),g=void 0,w={}),Y=Y.concat(dr({key:`${ge}[0]`,value:ae[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:ul,value:$}}))}else Y=Y.concat($({key:`${ge}[0]`,value:ae[0],valueSpec:{},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},ae));return Gi(Zo(ae[1]))?Y.concat([new ut(`${ge}[1]`,ae[1],"expressions are not allowed in function stops.")]):Y.concat(K.validateSpec({key:`${ge}[1]`,value:ae[1],valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function $(K,Y){const ae=Ci(K.value),ge=hn(K.value),xe=K.value!==null?K.value:Y;if(f){if(ae!==f)return[new ut(K.key,xe,`${ae} stop domain type must match previous stop domain type ${f}`)]}else f=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new ut(K.key,xe,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&c!=="categorical"){let Fe=`number expected, ${ae} found`;return Bs(i)&&c===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ut(K.key,xe,Fe)]}return c!=="categorical"||ae!=="number"||isFinite(ge)&&Math.floor(ge)===ge?c!=="categorical"&&ae==="number"&&g!==void 0&&ge<g?[new ut(K.key,xe,"stop domain values must appear in ascending order")]:(g=ge,c==="categorical"&&ge in w?[new ut(K.key,xe,"stop domain values must be unique")]:(w[ge]=!0,[])):[new ut(K.key,xe,`integer expected, found ${ge}`)]}}function Go(s){const i=(s.expressionContext==="property"?ch:as)(Zo(s.value),s.valueSpec);if(i.result==="error")return i.value.map(f=>new ut(`${s.key}${f.key}`,s.value,f.message));const c=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new ut(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!da(c))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!da(c))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!fa(c,["zoom","feature-state"]))return[new ut(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ha(c))return[new ut(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wo(s){const i=s.key,c=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(hn(c))===-1&&g.push(new ut(i,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(hn(c))===-1&&g.push(new ut(i,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Fs(s){return ol(Zo(s.value))?Go(Xn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):wc(s)}function wc(s){const i=s.value,c=s.key;if(Ci(i)!=="array")return[new ut(c,i,`array expected, ${Ci(i)} found`)];const f=s.styleSpec;let g,v=[];if(i.length<1)return[new ut(c,i,"filter array must have at least 1 element")];switch(v=v.concat(Wo({key:`${c}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),hn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&hn(i[1])==="$type"&&v.push(new ut(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new ut(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Ci(i[1]),g!=="string"&&v.push(new ut(`${c}[1]`,i[1],`string expected, ${g} found`)));for(let w=2;w<i.length;w++)g=Ci(i[w]),hn(i[1])==="$type"?v=v.concat(Wo({key:`${c}[${w}]`,value:i[w],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new ut(`${c}[${w}]`,i[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)v=v.concat(wc({key:`${c}[${w}]`,value:i[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Ci(i[1]),i.length!==2?v.push(new ut(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new ut(`${c}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=Ci(i[1]),i.length!==2?v.push(new ut(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new ut(`${c}[1]`,i[1],`object expected, ${g} found`))}return v}function hl(s,i){const c=s.key,f=s.validateSpec,g=s.style,v=s.styleSpec,w=s.value,T=s.objectKey,I=v[`${i}_${s.layerType}`];if(!I)return[];const P=T.match(/^(.*)-transition$/);if(i==="paint"&&P&&I[P[1]]&&I[P[1]].transition)return f({key:c,value:w,valueSpec:v.transition,style:g,styleSpec:v});const O=s.valueSpec||I[T];if(!O)return[new ut(c,w,`unknown property "${T}"`)];let j;if(Ci(w)==="string"&&Bs(O)&&!O.tokens&&(j=/^{([^}]+)}$/.exec(w)))return[new ut(c,w,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const $=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&$.push(new ut(c,w,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&tl(Zo(w))&&hn(w.type)==="identity"&&$.push(new ut(c,w,'"text-font" does not support identity functions'))),$.concat(f({key:s.key,value:w,valueSpec:O,style:g,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:T}))}function xc(s){return hl(s,"paint")}function kc(s){return hl(s,"layout")}function _a(s){let i=[];const c=s.value,f=s.key,g=s.style,v=s.styleSpec;c.type||c.ref||i.push(new ut(f,c,'either "type" or "ref" is required'));let w=hn(c.type);const T=hn(c.ref);if(c.id){const I=hn(c.id);for(let P=0;P<s.arrayIndex;P++){const O=g.layers[P];hn(O.id)===I&&i.push(new ut(f,c.id,`duplicate layer id "${c.id}", previously used at line ${O.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(P=>{P in c&&i.push(new ut(f,c[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{hn(P.id)===T&&(I=P)}),I?I.ref?i.push(new ut(f,c.ref,"ref cannot reference another ref layer")):w=hn(I.type):i.push(new ut(f,c.ref,`ref layer "${T}" not found`))}else if(w!=="background")if(c.source){const I=g.sources&&g.sources[c.source],P=I&&hn(I.type);I?P==="vector"&&w==="raster"?i.push(new ut(f,c.source,`layer "${c.id}" requires a raster source`)):P!=="raster-dem"&&w==="hillshade"?i.push(new ut(f,c.source,`layer "${c.id}" requires a raster-dem source`)):P==="raster"&&w!=="raster"?i.push(new ut(f,c.source,`layer "${c.id}" requires a vector source`)):P!=="vector"||c["source-layer"]?P==="raster-dem"&&w!=="hillshade"?i.push(new ut(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!c.paint||!c.paint["line-gradient"]||P==="geojson"&&I.lineMetrics||i.push(new ut(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ut(f,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new ut(f,c.source,`source "${c.source}" not found`))}else i.push(new ut(f,c,'missing required property "source"'));return i=i.concat(dr({key:f,value:c,valueSpec:v.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:c.type,valueSpec:v.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Fs,layout:I=>dr({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":P=>kc(Xn({layerType:w},P))}}),paint:I=>dr({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":P=>xc(Xn({layerType:w},P))}})}})),i}function ls(s){const i=s.value,c=s.key,f=Ci(i);return f!=="string"?[new ut(c,i,`string expected, ${f} found`)]:[]}const gh={promoteId:function({key:s,value:i}){if(Ci(i)==="string")return ls({key:s,value:i});{const c=[];for(const f in i)c.push(...ls({key:`${s}.${f}`,value:i[f]}));return c}}};function _h(s){const i=s.value,c=s.key,f=s.styleSpec,g=s.style,v=s.validateSpec;if(!i.type)return[new ut(c,i,'"type" is required')];const w=hn(i.type);let T;switch(w){case"vector":case"raster":return T=dr({key:c,value:i,valueSpec:f[`source_${w.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:gh,validateSpec:v}),T;case"raster-dem":return T=function(I){var P;const O=(P=I.sourceName)!==null&&P!==void 0?P:"",j=I.value,$=I.styleSpec,K=$.source_raster_dem,Y=I.style;let ae=[];const ge=Ci(j);if(j===void 0)return ae;if(ge!=="object")return ae.push(new ut("source_raster_dem",j,`object expected, ${ge} found`)),ae;const xe=hn(j.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],Se=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const ze in j)!xe&&Fe.includes(ze)?ae.push(new ut(ze,j[ze],`In "${O}": "${ze}" is only valid when "encoding" is set to "custom". ${Se} encoding found`)):K[ze]?ae=ae.concat(I.validateSpec({key:ze,value:j[ze],valueSpec:K[ze],validateSpec:I.validateSpec,style:Y,styleSpec:$})):ae.push(new ut(ze,j[ze],`unknown property "${ze}"`));return ae}({sourceName:c,value:i,style:s.style,styleSpec:f,validateSpec:v}),T;case"geojson":if(T=dr({key:c,value:i,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:v,objectElementValidators:gh}),i.cluster)for(const I in i.clusterProperties){const[P,O]=i.clusterProperties[I],j=typeof P=="string"?[P,["accumulated"],["get",I]]:P;T.push(...Go({key:`${c}.${I}.map`,value:O,validateSpec:v,expressionContext:"cluster-map"})),T.push(...Go({key:`${c}.${I}.reduce`,value:j,validateSpec:v,expressionContext:"cluster-reduce"}))}return T;case"video":return dr({key:c,value:i,valueSpec:f.source_video,style:g,validateSpec:v,styleSpec:f});case"image":return dr({key:c,value:i,valueSpec:f.source_image,style:g,validateSpec:v,styleSpec:f});case"canvas":return[new ut(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wo({key:`${c}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:v,styleSpec:f})}}function yh(s){const i=s.value,c=s.styleSpec,f=c.light,g=s.style;let v=[];const w=Ci(i);if(i===void 0)return v;if(w!=="object")return v=v.concat([new ut("light",i,`object expected, ${w} found`)]),v;for(const T in i){const I=T.match(/^(.*)-transition$/);v=v.concat(I&&f[I[1]]&&f[I[1]].transition?s.validateSpec({key:T,value:i[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:g,styleSpec:c}):f[T]?s.validateSpec({key:T,value:i[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new ut(T,i[T],`unknown property "${T}"`)])}return v}function bh(s){const i=s.value,c=s.styleSpec,f=c.sky,g=s.style,v=Ci(i);if(i===void 0)return[];if(v!=="object")return[new ut("sky",i,`object expected, ${v} found`)];let w=[];for(const T in i)w=w.concat(f[T]?go({key:T,value:i[T],valueSpec:f[T],style:g,styleSpec:c}):[new ut(T,i[T],`unknown property "${T}"`)]);return w}function ya(s){const i=s.value,c=s.styleSpec,f=c.terrain,g=s.style;let v=[];const w=Ci(i);if(i===void 0)return v;if(w!=="object")return v=v.concat([new ut("terrain",i,`object expected, ${w} found`)]),v;for(const T in i)v=v.concat(f[T]?s.validateSpec({key:T,value:i[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new ut(T,i[T],`unknown property "${T}"`)]);return v}function ba(s){let i=[];const c=s.value,f=s.key;if(Array.isArray(c)){const g=[],v=[];for(const w in c)c[w].id&&g.includes(c[w].id)&&i.push(new ut(f,c,`all the sprites' ids must be unique, but ${c[w].id} is duplicated`)),g.push(c[w].id),c[w].url&&v.includes(c[w].url)&&i.push(new ut(f,c,`all the sprites' URLs must be unique, but ${c[w].url} is duplicated`)),v.push(c[w].url),i=i.concat(dr({key:`${f}[${w}]`,value:c[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return ls({key:f,value:c})}const wr={"*":()=>[],array:vc,boolean:function(s){const i=s.value,c=s.key,f=Ci(i);return f!=="boolean"?[new ut(c,i,`boolean expected, ${f} found`)]:[]},number:ul,color:function(s){const i=s.key,c=s.value,f=Ci(c);return f!=="string"?[new ut(i,c,`color expected, ${f} found`)]:Di.parse(String(c))?[]:[new ut(i,c,`color expected, "${c}" found`)]},constants:ph,enum:Wo,filter:Fs,function:mh,layer:_a,object:dr,source:_h,light:yh,sky:bh,terrain:ya,string:ls,formatted:function(s){return ls(s).length===0?[]:Go(s)},resolvedImage:function(s){return ls(s).length===0?[]:Go(s)},padding:function(s){const i=s.key,c=s.value;if(Ci(c)==="array"){if(c.length<1||c.length>4)return[new ut(i,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let g=[];for(let v=0;v<c.length;v++)g=g.concat(s.validateSpec({key:`${i}[${v}]`,value:c[v],validateSpec:s.validateSpec,valueSpec:f}));return g}return ul({key:i,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,c=s.value,f=Ci(c),g=s.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new ut(i,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let w=0;w<c.length;w+=2)v=v.concat(Wo({key:`${i}[${w}]`,value:c[w],valueSpec:g.layout_symbol["text-anchor"]})),v=v.concat(vc({key:`${i}[${w+1}]`,value:c[w+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return v},sprite:ba};function go(s){const i=s.value,c=s.valueSpec,f=s.styleSpec;return s.validateSpec=go,c.expression&&tl(hn(i))?mh(s):c.expression&&Gi(Zo(i))?Go(s):c.type&&wr[c.type]?wr[c.type](s):dr(Xn({},s,{valueSpec:c.type?f[c.type]:c}))}function Sc(s){const i=s.value,c=s.key,f=ls(s);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new ut(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new ut(c,i,'"glyphs" url must include a "{range}" token'))),f}function to(s,i=we){let c=[];return c=c.concat(go({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:go,objectElementValidators:{glyphs:Sc,"*":()=>[]}})),s.constants&&(c=c.concat(ph({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:go}))),Os(c)}function _o(s){return function(i){return s({...i,validateSpec:go})}}function Os(s){return[].concat(s).sort((i,c)=>i.line-c.line)}function io(s){return function(...i){return Os(s.apply(this,i))}}to.source=io(_o(_h)),to.sprite=io(_o(ba)),to.glyphs=io(_o(Sc)),to.light=io(_o(yh)),to.sky=io(_o(bh)),to.terrain=io(_o(ya)),to.layer=io(_o(_a)),to.filter=io(_o(Fs)),to.paintProperty=io(_o(xc)),to.layoutProperty=io(_o(kc));const cs=to,Kd=cs.light,Tc=cs.paintProperty,Jd=cs.layoutProperty;function Ns(s,i){let c=!1;if(i&&i.length)for(const f of i)s.fire(new rt(new Error(f.message))),c=!0;return c}class va{constructor(i,c,f){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const w=new Int32Array(this.arrayBuffer);i=w[0],this.d=(c=w[1])+2*(f=w[2]);for(let I=0;I<this.d*this.d;I++){const P=w[3+I],O=w[3+I+1];g.push(P===O?null:w.subarray(P,O))}const T=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],T),this.bboxes=w.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let w=0;w<this.d*this.d;w++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=i,this.padding=f,this.scale=c/i,this.uid=0;const v=f/c*i;this.min=-v,this.max=i+v}insert(i,c,f,g,v){this._forEachCell(c,f,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,c,f,g,v,w){this.cells[v].push(w)}query(i,c,f,g,v){const w=this.min,T=this.max;if(i<=w&&c<=w&&T<=f&&T<=g&&!v)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(i,c,f,g,this._queryCell,I,{},v),I}}_queryCell(i,c,f,g,v,w,T,I){const P=this.cells[v];if(P!==null){const O=this.keys,j=this.bboxes;for(let $=0;$<P.length;$++){const K=P[$];if(T[K]===void 0){const Y=4*K;(I?I(j[Y+0],j[Y+1],j[Y+2],j[Y+3]):i<=j[Y+2]&&c<=j[Y+3]&&f>=j[Y+0]&&g>=j[Y+1])?(T[K]=!0,w.push(O[K])):T[K]=!1}}}}_forEachCell(i,c,f,g,v,w,T,I){const P=this._convertToCellCoord(i),O=this._convertToCellCoord(c),j=this._convertToCellCoord(f),$=this._convertToCellCoord(g);for(let K=P;K<=j;K++)for(let Y=O;Y<=$;Y++){const ae=this.d*Y+K;if((!I||I(this._convertFromCellCoord(K),this._convertFromCellCoord(Y),this._convertFromCellCoord(K+1),this._convertFromCellCoord(Y+1)))&&v.call(this,i,c,f,g,ae,w,T,I))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,c=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const g=new Int32Array(c+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=c;for(let w=0;w<i.length;w++){const T=i[w];g[3+w]=v,g.set(T,v),v+=T.length}return g[3+i.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+i.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(i,c){const f=i.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(i){return new va(i.buffer)}}const yo={};function Lt(s,i,c={}){if(yo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),yo[s]={klass:i,omit:c.omit||[],shallow:c.shallow||[]}}Lt("Object",Object),Lt("TransferableGridIndex",va),Lt("Color",Di),Lt("Error",Error),Lt("AJAXError",xi),Lt("ResolvedImage",Hr),Lt("StylePropertyFunction",nl),Lt("StyleExpression",$i,{omit:["_evaluator"]}),Lt("ZoomDependentExpression",_c),Lt("ZoomConstantExpression",il),Lt("CompoundExpression",Dr,{omit:["_evaluate"]});for(const s in Ds)Ds[s]._classRegistryKey||Lt(`Expression_${s}`,Ds[s]);function dl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function js(s,i){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(dl(s)||st(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return i&&i.push(c.buffer),c}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const f of s)c.push(js(f,i));return c}if(typeof s=="object"){const c=s.constructor,f=c._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!yo[f])throw new Error(`${f} is not registered.`);const g=c.serialize?c.serialize(s,i):{};if(c.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in s){if(!s.hasOwnProperty(v)||yo[f].omit.indexOf(v)>=0)continue;const w=s[v];g[v]=yo[f].shallow.indexOf(v)>=0?w:js(w,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof s)}function Us(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||dl(s)||st(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Us);if(typeof s=="object"){const i=s.$name||"Object";if(!yo[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:c}=yo[i];if(!c)throw new Error(`can't deserialize unregistered class ${i}`);if(c.deserialize)return c.deserialize(s);const f=Object.create(c.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const v=s[g];f[g]=yo[i].shallow.indexOf(g)>=0?v:Us(v)}return f}throw new Error("can't deserialize object of type "+typeof s)}class vh{constructor(){this.first=!0}update(i,c){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const St={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Vs(s){for(const i of s)if(fl(i.charCodeAt(0)))return!0;return!1}function wh(s){for(const i of s)if(!xh(i.charCodeAt(0)))return!1;return!0}function xh(s){return!(St.Arabic(s)||St["Arabic Supplement"](s)||St["Arabic Extended-A"](s)||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s))}function fl(s){return!(s!==746&&s!==747&&(s<4352||!(St["Bopomofo Extended"](s)||St.Bopomofo(s)||St["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||St["CJK Compatibility Ideographs"](s)||St["CJK Compatibility"](s)||St["CJK Radicals Supplement"](s)||St["CJK Strokes"](s)||!(!St["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||St["CJK Unified Ideographs Extension A"](s)||St["CJK Unified Ideographs"](s)||St["Enclosed CJK Letters and Months"](s)||St["Hangul Compatibility Jamo"](s)||St["Hangul Jamo Extended-A"](s)||St["Hangul Jamo Extended-B"](s)||St["Hangul Jamo"](s)||St["Hangul Syllables"](s)||St.Hiragana(s)||St["Ideographic Description Characters"](s)||St.Kanbun(s)||St["Kangxi Radicals"](s)||St["Katakana Phonetic Extensions"](s)||St.Katakana(s)&&s!==12540||!(!St["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!St["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||St["Unified Canadian Aboriginal Syllabics"](s)||St["Unified Canadian Aboriginal Syllabics Extended"](s)||St["Vertical Forms"](s)||St["Yijing Hexagram Symbols"](s)||St["Yi Syllables"](s)||St["Yi Radicals"](s))))}function Ec(s){return!(fl(s)||function(i){return!!(St["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||St["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||St["Letterlike Symbols"](i)||St["Number Forms"](i)||St["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||St["Control Pictures"](i)&&i!==9251||St["Optical Character Recognition"](i)||St["Enclosed Alphanumerics"](i)||St["Geometric Shapes"](i)||St["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||St["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||St["CJK Symbols and Punctuation"](i)||St.Katakana(i)||St["Private Use Area"](i)||St["CJK Compatibility Forms"](i)||St["Small Form Variants"](i)||St["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}function pl(s){return s>=1424&&s<=2303||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s)}function kh(s,i){return!(!i&&pl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||St.Khmer(s))}function Yd(s){for(const i of s)if(pl(i.charCodeAt(0)))return!0;return!1}const $o=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Qi{constructor(i,c){this.zoom=i,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vh,this.transition={})}isSupportedScript(i){return function(c,f){for(const g of c)if(!kh(g.charCodeAt(0),f))return!1;return!0}(i,$o.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,c=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class wa{constructor(i,c){this.property=i,this.value=c,this.expression=function(f,g){if(tl(f))return new nl(f,g);if(Gi(f)){const v=ch(f,g);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));return v.value}{let v=f;return g.type==="color"&&typeof f=="string"?v=Di.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(v=$r.parse(f)):v=vr.parse(f),{kind:"constant",evaluate:()=>v}}}(c===void 0?i.specification.default:c,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,c,f){return this.property.possiblyEvaluate(this,i,c,f)}}class ml{constructor(i){this.property=i,this.value=new wa(i,void 0)}transitioned(i,c){return new Sh(this.property,this.value,c,H({},i.transition,this.transition),i.now)}untransitioned(){return new Sh(this.property,this.value,null,{},0)}}class Cc{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return ne(this._values[i].value.value)}setValue(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ml(this._values[i].property)),this._values[i].value=new wa(this._values[i].property,c===null?void 0:ne(c))}getTransition(i){return ne(this._values[i].transition)}setTransition(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ml(this._values[i].property)),this._values[i].transition=ne(c)||void 0}serialize(){const i={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(i[c]=f);const g=this.getTransition(c);g!==void 0&&(i[`${c}-transition`]=g)}return i}transitioned(i,c){const f=new Th(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(i,c._values[g]);return f}untransitioned(){const i=new Th(this._properties);for(const c of Object.keys(this._values))i._values[c]=this._values[c].untransitioned();return i}}class Sh{constructor(i,c,f,g,v){this.property=i,this.value=c,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(i,c,f){const g=i.now||0,v=this.value.possiblyEvaluate(i,c,f),w=this.prior;if(w){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return w.possiblyEvaluate(i,c,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(i,c,f),v,function(I){if(I<=0)return 0;if(I>=1)return 1;const P=I*I,O=P*I;return 4*(I<.5?O:3*(I-P)+O-.75)}(T))}}return v}}class Th{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,c,f){const g=new xa(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,c,f);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Eh{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return ne(this._values[i].value)}setValue(i,c){this._values[i]=new wa(this._values[i].property,c===null?void 0:ne(c))}serialize(){const i={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(i[c]=f)}return i}possiblyEvaluate(i,c,f){const g=new xa(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,c,f);return g}}class no{constructor(i,c,f){this.property=i,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,c,f,g){return this.property.evaluate(this.value,this.parameters,i,c,f,g)}}class xa{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class jt{constructor(i){this.specification=i}possiblyEvaluate(i,c){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(c)}interpolate(i,c,f){const g=hr[this.specification.type];return g?g(i,c,f):i}}class $t{constructor(i,c){this.specification=i,this.overrides=c}possiblyEvaluate(i,c,f,g){return new no(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(c,null,{},f,g)}:i.expression,c)}interpolate(i,c,f){if(i.value.kind!=="constant"||c.value.kind!=="constant")return i;if(i.value.value===void 0||c.value.value===void 0)return new no(this,{kind:"constant",value:void 0},i.parameters);const g=hr[this.specification.type];if(g){const v=g(i.value.value,c.value.value,f);return new no(this,{kind:"constant",value:v},i.parameters)}return i}evaluate(i,c,f,g,v,w){return i.kind==="constant"?i.value:i.evaluate(c,f,g,v,w)}}class gl extends $t{possiblyEvaluate(i,c,f,g){if(i.value===void 0)return new no(this,{kind:"constant",value:void 0},c);if(i.expression.kind==="constant"){const v=i.expression.evaluate(c,null,{},f,g),w=i.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,T=this._calculate(w,w,w,c);return new no(this,{kind:"constant",value:T},c)}if(i.expression.kind==="camera"){const v=this._calculate(i.expression.evaluate({zoom:c.zoom-1}),i.expression.evaluate({zoom:c.zoom}),i.expression.evaluate({zoom:c.zoom+1}),c);return new no(this,{kind:"constant",value:v},c)}return new no(this,i.expression,c)}evaluate(i,c,f,g,v,w){if(i.kind==="source"){const T=i.evaluate(c,f,g,v,w);return this._calculate(T,T,T,c)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(c.zoom)-1},f,g),i.evaluate({zoom:Math.floor(c.zoom)},f,g),i.evaluate({zoom:Math.floor(c.zoom)+1},f,g),c):i.value}_calculate(i,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:f,to:c}}interpolate(i){return i}}class ka{constructor(i){this.specification=i}possiblyEvaluate(i,c,f,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const v=i.expression.evaluate(c,null,{},f,g);return this._calculate(v,v,v,c)}return this._calculate(i.expression.evaluate(new Qi(Math.floor(c.zoom-1),c)),i.expression.evaluate(new Qi(Math.floor(c.zoom),c)),i.expression.evaluate(new Qi(Math.floor(c.zoom+1),c)),c)}}_calculate(i,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:f,to:c}}interpolate(i){return i}}class Mc{constructor(i){this.specification=i}possiblyEvaluate(i,c,f,g){return!!i.expression.evaluate(c,null,{},f,g)}interpolate(){return!1}}class xr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in i){const f=i[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new wa(f,void 0),v=this.defaultTransitionablePropertyValues[c]=new ml(f);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}Lt("DataDrivenProperty",$t),Lt("DataConstantProperty",jt),Lt("CrossFadedDataDrivenProperty",gl),Lt("CrossFadedProperty",ka),Lt("ColorRampProperty",Mc);const Ic="-transition";class ro extends xt{constructor(i,c){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),c.layout&&(this._unevaluatedLayout=new Eh(c.layout)),c.paint)){this._transitionablePaint=new Cc(c.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xa(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,c,f={}){c!=null&&this._validate(Jd,`layers.${this.id}.layout.${i}`,i,c,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,c):this.visibility=c)}getPaintProperty(i){return i.endsWith(Ic)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,c,f={}){if(c!=null&&this._validate(Tc,`layers.${this.id}.paint.${i}`,i,c,f))return!1;if(i.endsWith(Ic))return this._transitionablePaint.setTransition(i.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[i],v=g.property.specification["property-type"]==="cross-faded-data-driven",w=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(i,c),this._handleSpecialPaintPropertyUpdate(i);const I=this._transitionablePaint._values[i].value;return I.isDataDriven()||w||v||this._handleOverridablePaintPropertyUpdate(i,T,I)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,c,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,c){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,c)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Oe(i,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(i,c,f,g,v={}){return(!v||v.validate!==!1)&&Ns(this,i.call(cs,{key:c,layerType:this.type,objectKey:f,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const c=this.paint.get(i);if(c instanceof no&&Bs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Ch={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sa{constructor(i,c){this._structArray=i,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,c){return i._trim(),c&&(i.isTransferred=!0,c.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const c=Object.create(this.prototype);return c.arrayBuffer=i.arrayBuffer,c.length=i.length,c.capacity=i.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Sn(s,i=1){let c=0,f=0;return{members:s.map(g=>{const v=Ch[g.type].BYTES_PER_ELEMENT,w=c=Mh(c,Math.max(i,v)),T=g.components||1;return f=Math.max(f,v),c+=v*T,{name:g.name,type:g.type,components:T,offset:w}}),size:Mh(c,Math.max(f,i)),alignment:i}}function Mh(s,i){return Math.ceil(s/i)*i}class Ta extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,c)}emplace(i,c,f){const g=2*i;return this.int16[g+0]=c,this.int16[g+1]=f,i}}Ta.prototype.bytesPerElement=4,Lt("StructArrayLayout2i4",Ta);class Ao extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const v=3*i;return this.int16[v+0]=c,this.int16[v+1]=f,this.int16[v+2]=g,i}}Ao.prototype.bytesPerElement=6,Lt("StructArrayLayout3i6",Ao);class Lc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,c,f,g)}emplace(i,c,f,g,v){const w=4*i;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=g,this.int16[w+3]=v,i}}Lc.prototype.bytesPerElement=8,Lt("StructArrayLayout4i8",Lc);class Ac extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,f,g,v,w)}emplace(i,c,f,g,v,w,T){const I=6*i;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=v,this.int16[I+4]=w,this.int16[I+5]=T,i}}Ac.prototype.bytesPerElement=12,Lt("StructArrayLayout2i4i12",Ac);class Pc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,f,g,v,w)}emplace(i,c,f,g,v,w,T){const I=4*i,P=8*i;return this.int16[I+0]=c,this.int16[I+1]=f,this.uint8[P+4]=g,this.uint8[P+5]=v,this.uint8[P+6]=w,this.uint8[P+7]=T,i}}Pc.prototype.bytesPerElement=8,Lt("StructArrayLayout2i4ub8",Pc);class Ea extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,c)}emplace(i,c,f){const g=2*i;return this.float32[g+0]=c,this.float32[g+1]=f,i}}Ea.prototype.bytesPerElement=8,Lt("StructArrayLayout2f8",Ea);class _l extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w,T,I,P,O){const j=this.length;return this.resize(j+1),this.emplace(j,i,c,f,g,v,w,T,I,P,O)}emplace(i,c,f,g,v,w,T,I,P,O,j){const $=10*i;return this.uint16[$+0]=c,this.uint16[$+1]=f,this.uint16[$+2]=g,this.uint16[$+3]=v,this.uint16[$+4]=w,this.uint16[$+5]=T,this.uint16[$+6]=I,this.uint16[$+7]=P,this.uint16[$+8]=O,this.uint16[$+9]=j,i}}_l.prototype.bytesPerElement=20,Lt("StructArrayLayout10ui20",_l);class zc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w,T,I,P,O,j,$){const K=this.length;return this.resize(K+1),this.emplace(K,i,c,f,g,v,w,T,I,P,O,j,$)}emplace(i,c,f,g,v,w,T,I,P,O,j,$,K){const Y=12*i;return this.int16[Y+0]=c,this.int16[Y+1]=f,this.int16[Y+2]=g,this.int16[Y+3]=v,this.uint16[Y+4]=w,this.uint16[Y+5]=T,this.uint16[Y+6]=I,this.uint16[Y+7]=P,this.int16[Y+8]=O,this.int16[Y+9]=j,this.int16[Y+10]=$,this.int16[Y+11]=K,i}}zc.prototype.bytesPerElement=24,Lt("StructArrayLayout4i4ui4i24",zc);class Dc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const v=3*i;return this.float32[v+0]=c,this.float32[v+1]=f,this.float32[v+2]=g,i}}Dc.prototype.bytesPerElement=12,Lt("StructArrayLayout3f12",Dc);class Po extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint32[1*i+0]=c,i}}Po.prototype.bytesPerElement=4,Lt("StructArrayLayout1ul4",Po);class yl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w,T,I,P){const O=this.length;return this.resize(O+1),this.emplace(O,i,c,f,g,v,w,T,I,P)}emplace(i,c,f,g,v,w,T,I,P,O){const j=10*i,$=5*i;return this.int16[j+0]=c,this.int16[j+1]=f,this.int16[j+2]=g,this.int16[j+3]=v,this.int16[j+4]=w,this.int16[j+5]=T,this.uint32[$+3]=I,this.uint16[j+8]=P,this.uint16[j+9]=O,i}}yl.prototype.bytesPerElement=20,Lt("StructArrayLayout6i1ul2ui20",yl);class Ca extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,f,g,v,w)}emplace(i,c,f,g,v,w,T){const I=6*i;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=v,this.int16[I+4]=w,this.int16[I+5]=T,i}}Ca.prototype.bytesPerElement=12,Lt("StructArrayLayout2i2i2i12",Ca);class bl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,c,f,g,v)}emplace(i,c,f,g,v,w){const T=4*i,I=8*i;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[I+6]=v,this.int16[I+7]=w,i}}bl.prototype.bytesPerElement=16,Lt("StructArrayLayout2f1f2i16",bl);class Ma extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,c,f,g)}emplace(i,c,f,g,v){const w=12*i,T=3*i;return this.uint8[w+0]=c,this.uint8[w+1]=f,this.float32[T+1]=g,this.float32[T+2]=v,i}}Ma.prototype.bytesPerElement=12,Lt("StructArrayLayout2ub2f12",Ma);class vl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const v=3*i;return this.uint16[v+0]=c,this.uint16[v+1]=f,this.uint16[v+2]=g,i}}vl.prototype.bytesPerElement=6,Lt("StructArrayLayout3ui6",vl);class qs extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w,T,I,P,O,j,$,K,Y,ae,ge,xe){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,i,c,f,g,v,w,T,I,P,O,j,$,K,Y,ae,ge,xe)}emplace(i,c,f,g,v,w,T,I,P,O,j,$,K,Y,ae,ge,xe,Fe){const Se=24*i,ze=12*i,Ye=48*i;return this.int16[Se+0]=c,this.int16[Se+1]=f,this.uint16[Se+2]=g,this.uint16[Se+3]=v,this.uint32[ze+2]=w,this.uint32[ze+3]=T,this.uint32[ze+4]=I,this.uint16[Se+10]=P,this.uint16[Se+11]=O,this.uint16[Se+12]=j,this.float32[ze+7]=$,this.float32[ze+8]=K,this.uint8[Ye+36]=Y,this.uint8[Ye+37]=ae,this.uint8[Ye+38]=ge,this.uint32[ze+10]=xe,this.int16[Se+22]=Fe,i}}qs.prototype.bytesPerElement=48,Lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",qs);class us extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g,v,w,T,I,P,O,j,$,K,Y,ae,ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt,Tt,wt,mt,zt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,i,c,f,g,v,w,T,I,P,O,j,$,K,Y,ae,ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt,Tt,wt,mt,zt)}emplace(i,c,f,g,v,w,T,I,P,O,j,$,K,Y,ae,ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt,Tt,wt,mt,zt,bt){const at=32*i,Wt=16*i;return this.int16[at+0]=c,this.int16[at+1]=f,this.int16[at+2]=g,this.int16[at+3]=v,this.int16[at+4]=w,this.int16[at+5]=T,this.int16[at+6]=I,this.int16[at+7]=P,this.uint16[at+8]=O,this.uint16[at+9]=j,this.uint16[at+10]=$,this.uint16[at+11]=K,this.uint16[at+12]=Y,this.uint16[at+13]=ae,this.uint16[at+14]=ge,this.uint16[at+15]=xe,this.uint16[at+16]=Fe,this.uint16[at+17]=Se,this.uint16[at+18]=ze,this.uint16[at+19]=Ye,this.uint16[at+20]=tt,this.uint16[at+21]=Ct,this.uint16[at+22]=Bt,this.uint32[Wt+12]=Tt,this.float32[Wt+13]=wt,this.float32[Wt+14]=mt,this.uint16[at+30]=zt,this.uint16[at+31]=bt,i}}us.prototype.bytesPerElement=64,Lt("StructArrayLayout8i15ui1ul2f2ui64",us);class wl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.float32[1*i+0]=c,i}}wl.prototype.bytesPerElement=4,Lt("StructArrayLayout1f4",wl);class xl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const v=3*i;return this.uint16[6*i+0]=c,this.float32[v+1]=f,this.float32[v+2]=g,i}}xl.prototype.bytesPerElement=12,Lt("StructArrayLayout1ui2f12",xl);class hs extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const v=4*i;return this.uint32[2*i+0]=c,this.uint16[v+2]=f,this.uint16[v+3]=g,i}}hs.prototype.bytesPerElement=8,Lt("StructArrayLayout1ul2ui8",hs);class Rc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,c)}emplace(i,c,f){const g=2*i;return this.uint16[g+0]=c,this.uint16[g+1]=f,i}}Rc.prototype.bytesPerElement=4,Lt("StructArrayLayout2ui4",Rc);class Bc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint16[1*i+0]=c,i}}Bc.prototype.bytesPerElement=2,Lt("StructArrayLayout1ui2",Bc);class kl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,c,f,g)}emplace(i,c,f,g,v){const w=4*i;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,this.float32[w+3]=v,i}}kl.prototype.bytesPerElement=16,Lt("StructArrayLayout4f16",kl);class Ih extends Sa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}Ih.prototype.size=20;class y extends yl{get(i){return new Ih(this,i)}}Lt("CollisionBoxArray",y);class r extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}r.prototype.size=48;class h extends qs{get(i){return new r(this,i)}}Lt("PlacedSymbolArray",h);class p extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends us{get(i){return new p(this,i)}}Lt("SymbolInstanceArray",m);class b extends wl{getoffsetX(i){return this.float32[1*i+0]}}Lt("GlyphOffsetArray",b);class E extends Ao{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Lt("SymbolLineVertexArray",E);class M extends Sa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class A extends xl{get(i){return new M(this,i)}}Lt("TextAnchorOffsetArray",A);class F extends Sa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class q extends hs{get(i){return new F(this,i)}}Lt("FeatureIndexArray",q);class Z extends Ta{}class J extends Ta{}class pe extends Ta{}class fe extends Ac{}class _e extends Pc{}class se extends Ea{}class Ee extends _l{}class Ze extends zc{}class ve extends Dc{}class De extends Po{}class We extends Ca{}class He extends Ma{}class Xe extends vl{}class nt extends Rc{}const it=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ft}=it;class _t{constructor(i=[]){this.segments=i}prepareSegment(i,c,f,g){let v=this.segments[this.segments.length-1];return i>_t.MAX_VERTEX_ARRAY_LENGTH&&Ke(`Max vertices per segment is ${_t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!v||v.vertexLength+i>_t.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const i of this.segments)for(const c in i.vaos)i.vaos[c].destroy()}static simpleSegment(i,c,f,g){return new _t([{vertexOffset:i,primitiveOffset:c,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function oi(s,i){return 256*(s=le(Math.floor(s),0,255))+le(Math.floor(i),0,255)}_t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt("SegmentVector",_t);const yt=Sn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Kt={exports:{}},si={exports:{}};si.exports=function(s,i){var c,f,g,v,w,T,I,P;for(f=s.length-(c=3&s.length),g=i,w=3432918353,T=461845907,P=0;P<f;)I=255&s.charCodeAt(P)|(255&s.charCodeAt(++P))<<8|(255&s.charCodeAt(++P))<<16|(255&s.charCodeAt(++P))<<24,++P,g=27492+(65535&(v=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&s.charCodeAt(P+2))<<16;case 2:I^=(255&s.charCodeAt(P+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(P)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Si=si.exports,Qt={exports:{}};Qt.exports=function(s,i){for(var c,f=s.length,g=i^f,v=0;f>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:g^=(255&s.charCodeAt(v+2))<<16;case 2:g^=(255&s.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var ci=Si,pi=Qt.exports;Kt.exports=ci,Kt.exports.murmur3=ci,Kt.exports.murmur2=pi;var fn=_(Kt.exports);class Bi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,c,f,g){this.ids.push(Rr(i)),this.positions.push(c,f,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Rr(i);let f=0,g=this.ids.length-1;for(;f<g;){const w=f+g>>1;this.ids[w]>=c?g=w:f=w+1}const v=[];for(;this.ids[f]===c;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(i,c){const f=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Nn(f,g,0,f.length-1),c&&c.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(i){const c=new Bi;return c.ids=i.ids,c.positions=i.positions,c.indexed=!0,c}}function Rr(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:fn(String(s))}function Nn(s,i,c,f){for(;c<f;){const g=s[c+f>>1];let v=c-1,w=f+1;for(;;){do v++;while(s[v]<g);do w--;while(s[w]>g);if(v>=w)break;rn(s,v,w),rn(i,3*v,3*w),rn(i,3*v+1,3*w+1),rn(i,3*v+2,3*w+2)}w-c<f-w?(Nn(s,i,c,w),c=w+1):(Nn(s,i,w+1,f),f=w)}}function rn(s,i,c){const f=s[i];s[i]=s[c],s[c]=f}Lt("FeaturePositionMap",Bi);class jn{constructor(i,c){this.gl=i.gl,this.location=c}}class Br extends jn{constructor(i,c){super(i,c),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class bo extends jn{constructor(i,c){super(i,c),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Ho extends jn{constructor(i,c){super(i,c),this.current=Di.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Ia=new Float32Array(16);function Xo(s){return[oi(255*s.r,255*s.g),oi(255*s.b,255*s.a)]}class vo{constructor(i,c,f){this.value=i,this.uniformNames=c.map(g=>`u_${g}`),this.type=f}setUniform(i,c,f){i.set(f.constantOr(this.value))}getBinding(i,c,f){return this.type==="color"?new Ho(i,c):new Br(i,c)}}class Ln{constructor(i,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=i.tlbr}setUniform(i,c,f,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&i.set(v)}getBinding(i,c,f){return f.substr(0,9)==="u_pattern"?new bo(i,c):new Br(i,c)}}class on{constructor(i,c,f,g){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,c,f,g,v){const w=this.paintVertexArray.length,T=this.expression.evaluate(new Qi(0),c,{},g,[],v);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,c,f,g){const v=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(i,c,v)}_setPaintValue(i,c,f){if(this.type==="color"){const g=Xo(f);for(let v=i;v<c;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=i;g<c;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class en{constructor(i,c,f,g,v,w){this.expression=i,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(i,c,f,g,v){const w=this.expression.evaluate(new Qi(this.zoom),c,{},g,[],v),T=this.expression.evaluate(new Qi(this.zoom+1),c,{},g,[],v),I=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(I,i,w,T)}updatePaintArray(i,c,f,g){const v=this.expression.evaluate({zoom:this.zoom},f,g),w=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(i,c,v,w)}_setPaintValue(i,c,f,g){if(this.type==="color"){const v=Xo(f),w=Xo(g);for(let T=i;T<c;T++)this.paintVertexArray.emplace(T,v[0],v[1],w[0],w[1])}else{for(let v=i;v<c;v++)this.paintVertexArray.emplace(v,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=le(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,c,f){return new Br(i,c)}}class Xr{constructor(i,c,f,g,v,w){this.expression=i,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=w,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(i,c,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(i,c,f,g,v){this._setPaintValues(i,c,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(i,c,f,g){if(!g||!f)return;const{min:v,mid:w,max:T}=f,I=g[v],P=g[w],O=g[T];if(I&&P&&O)for(let j=i;j<c;j++)this.zoomInPaintVertexArray.emplace(j,P.tl[0],P.tl[1],P.br[0],P.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],P.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,P.tl[0],P.tl[1],P.br[0],P.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],P.pixelRatio,O.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class An{constructor(i,c,f){this.binders={},this._buffers=[];const g=[];for(const v in i.paint._values){if(!f(v))continue;const w=i.paint.get(v);if(!(w instanceof no&&Bs(w.property.specification)))continue;const T=Kr(v,i.type),I=w.value,P=w.property.specification.type,O=w.property.useIntegerZoom,j=w.property.specification["property-type"],$=j==="cross-faded"||j==="cross-faded-data-driven";if(I.kind==="constant")this.binders[v]=$?new Ln(I.value,T):new vo(I.value,T,P),g.push(`/u_${v}`);else if(I.kind==="source"||$){const K=Pn(v,P,"source");this.binders[v]=$?new Xr(I,P,O,c,K,i.id):new on(I,T,P,K),g.push(`/a_${v}`)}else{const K=Pn(v,P,"composite");this.binders[v]=new en(I,T,P,O,c,K),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const c=this.binders[i];return c instanceof on||c instanceof en?c.maxValue:0}populatePaintArrays(i,c,f,g,v){for(const w in this.binders){const T=this.binders[w];(T instanceof on||T instanceof en||T instanceof Xr)&&T.populatePaintArray(i,c,f,g,v)}}setConstantPatternPositions(i,c){for(const f in this.binders){const g=this.binders[f];g instanceof Ln&&g.setConstantPatternPositions(i,c)}}updatePaintArrays(i,c,f,g,v){let w=!1;for(const T in i){const I=c.getPositions(T);for(const P of I){const O=f.feature(P.index);for(const j in this.binders){const $=this.binders[j];if(($ instanceof on||$ instanceof en||$ instanceof Xr)&&$.expression.isStateDependent===!0){const K=g.paint.get(j);$.expression=K.value,$.updatePaintArray(P.start,P.end,O,i[T],v),w=!0}}}}return w}defines(){const i=[];for(const c in this.binders){const f=this.binders[c];(f instanceof vo||f instanceof Ln)&&i.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof on||f instanceof en)for(let g=0;g<f.paintVertexAttributes.length;g++)i.push(f.paintVertexAttributes[g].name);else if(f instanceof Xr)for(let g=0;g<yt.members.length;g++)i.push(yt.members[g].name)}return i}getBinderUniforms(){const i=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof vo||f instanceof Ln||f instanceof en)for(const g of f.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,c){const f=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof vo||v instanceof Ln||v instanceof en){for(const w of v.uniformNames)if(c[w]){const T=v.getBinding(i,c[w],w);f.push({name:w,property:g,binding:T})}}}return f}setUniforms(i,c,f,g){for(const{name:v,property:w,binding:T}of c)this.binders[w].setUniform(T,g,f.get(w),v)}updatePaintBuffers(i){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(i&&f instanceof Xr){const g=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof on||f instanceof en)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const c in this.binders){const f=this.binders[c];(f instanceof on||f instanceof en||f instanceof Xr)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const c=this.binders[i];(c instanceof on||c instanceof en||c instanceof Xr)&&c.destroy()}}}class sn{constructor(i,c,f=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new An(g,c,f);this.needsUpload=!1,this._featureMap=new Bi,this._bufferOffset=0}populatePaintArrays(i,c,f,g,v,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,c,g,v,w);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,c,f,g){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,c,v,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Kr(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Pn(s,i,c){const f={color:{source:Ea,composite:kl},number:{source:wl,composite:Ea}},g=function(v){return{"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee}}[v]}(s);return g&&g[c]||f[i][c]}Lt("ConstantBinder",vo),Lt("CrossFadedConstantBinder",Ln),Lt("SourceExpressionBinder",on),Lt("CrossFadedCompositeBinder",Xr),Lt("CompositeExpressionBinder",en),Lt("ProgramConfiguration",An,{omit:["_buffers"]}),Lt("ProgramConfigurationSet",sn);const yn=8192,Fc=Math.pow(2,14)-1,Lh=-Fc-1;function ds(s){const i=yn/s.extent,c=s.loadGeometry();for(let f=0;f<c.length;f++){const g=c[f];for(let v=0;v<g.length;v++){const w=g[v],T=Math.round(w.x*i),I=Math.round(w.y*i);w.x=le(T,Lh,Fc),w.y=le(I,Lh,Fc),(T<w.x||T>w.x+1||I<w.y||I>w.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function fs(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?ds(s):[]}}function Sl(s,i,c,f,g){s.emplaceBack(2*i+(f+1)/2,2*c+(g+1)/2)}class Ko{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new J,this.indexArray=new Xe,this.segments=new _t,this.programConfigurations=new sn(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){const g=this.layers[0],v=[];let w=null,T=!1;g.type==="circle"&&(w=g.layout.get("circle-sort-key"),T=!w.isConstant());for(const{feature:I,id:P,index:O,sourceLayerIndex:j}of i){const $=this.layers[0]._featureFilter.needGeometry,K=fs(I,$);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),K,f))continue;const Y=T?w.evaluate(K,{},f):void 0,ae={id:P,properties:I.properties,type:I.type,sourceLayerIndex:j,index:O,geometry:$?K.geometry:ds(I),patterns:{},sortKey:Y};v.push(ae)}T&&v.sort((I,P)=>I.sortKey-P.sortKey);for(const I of v){const{geometry:P,index:O,sourceLayerIndex:j}=I,$=i[O].feature;this.addFeature(I,P,O,f),c.featureIndex.insert($,P,O,j,this.index)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ft),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,c,f,g){for(const v of c)for(const w of v){const T=w.x,I=w.y;if(T<0||T>=yn||I<0||I>=yn)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),O=P.vertexLength;Sl(this.layoutVertexArray,T,I,-1,-1),Sl(this.layoutVertexArray,T,I,1,-1),Sl(this.layoutVertexArray,T,I,1,1),Sl(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},g)}}function Oc(s,i){for(let c=0;c<s.length;c++)if(El(i,s[c]))return!0;for(let c=0;c<i.length;c++)if(El(s,i[c]))return!0;return!!Tl(s,i)}function Ah(s,i,c){return!!El(s,i)||!!Qd(i,s,c)}function Nc(s,i){if(s.length===1)return Wp(i,s[0]);for(let c=0;c<i.length;c++){const f=i[c];for(let g=0;g<f.length;g++)if(El(s,f[g]))return!0}for(let c=0;c<s.length;c++)if(Wp(i,s[c]))return!0;for(let c=0;c<i.length;c++)if(Tl(s,i[c]))return!0;return!1}function jc(s,i,c){if(s.length>1){if(Tl(s,i))return!0;for(let f=0;f<i.length;f++)if(Qd(i[f],s,c))return!0}for(let f=0;f<s.length;f++)if(Qd(s[f],i,c))return!0;return!1}function Tl(s,i){if(s.length===0||i.length===0)return!1;for(let c=0;c<s.length-1;c++){const f=s[c],g=s[c+1];for(let v=0;v<i.length-1;v++)if(Uc(f,g,i[v],i[v+1]))return!0}return!1}function Uc(s,i,c,f){return Ce(s,c,f)!==Ce(i,c,f)&&Ce(s,i,c)!==Ce(s,i,f)}function Qd(s,i,c){const f=c*c;if(i.length===1)return s.distSqr(i[0])<f;for(let g=1;g<i.length;g++)if(Gp(s,i[g-1],i[g])<f)return!0;return!1}function Gp(s,i,c){const f=i.distSqr(c);if(f===0)return s.distSqr(i);const g=((s.x-i.x)*(c.x-i.x)+(s.y-i.y)*(c.y-i.y))/f;return s.distSqr(g<0?i:g>1?c:c.sub(i)._mult(g)._add(i))}function Wp(s,i){let c,f,g,v=!1;for(let w=0;w<s.length;w++){c=s[w];for(let T=0,I=c.length-1;T<c.length;I=T++)f=c[T],g=c[I],f.y>i.y!=g.y>i.y&&i.x<(g.x-f.x)*(i.y-f.y)/(g.y-f.y)+f.x&&(v=!v)}return v}function El(s,i){let c=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const v=s[f],w=s[g];v.y>i.y!=w.y>i.y&&i.x<(w.x-v.x)*(i.y-v.y)/(w.y-v.y)+v.x&&(c=!c)}return c}function i1(s,i,c){const f=c[0],g=c[2];if(s.x<f.x&&i.x<f.x||s.x>g.x&&i.x>g.x||s.y<f.y&&i.y<f.y||s.y>g.y&&i.y>g.y)return!1;const v=Ce(s,i,c[0]);return v!==Ce(s,i,c[1])||v!==Ce(s,i,c[2])||v!==Ce(s,i,c[3])}function Vc(s,i,c){const f=i.paint.get(s).value;return f.kind==="constant"?f.value:c.programConfigurations.get(i.id).getMaxValue(s)}function Ph(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function zh(s,i,c,f,g){if(!i[0]&&!i[1])return s;const v=k.convert(i)._mult(g);c==="viewport"&&v._rotate(-f);const w=[];for(let T=0;T<s.length;T++)w.push(s[T].sub(v));return w}let $p,Hp;Lt("CircleBucket",Ko,{omit:["layers"]});var n1={get paint(){return Hp=Hp||new xr({"circle-radius":new $t(we.paint_circle["circle-radius"]),"circle-color":new $t(we.paint_circle["circle-color"]),"circle-blur":new $t(we.paint_circle["circle-blur"]),"circle-opacity":new $t(we.paint_circle["circle-opacity"]),"circle-translate":new jt(we.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(we.paint_circle["circle-stroke-opacity"])})},get layout(){return $p=$p||new xr({"circle-sort-key":new $t(we.layout_circle["circle-sort-key"])})}},kr=1e-6,Cl=typeof Float32Array<"u"?Float32Array:Array;function ef(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Xp(s,i,c){var f=i[0],g=i[1],v=i[2],w=i[3],T=i[4],I=i[5],P=i[6],O=i[7],j=i[8],$=i[9],K=i[10],Y=i[11],ae=i[12],ge=i[13],xe=i[14],Fe=i[15],Se=c[0],ze=c[1],Ye=c[2],tt=c[3];return s[0]=Se*f+ze*T+Ye*j+tt*ae,s[1]=Se*g+ze*I+Ye*$+tt*ge,s[2]=Se*v+ze*P+Ye*K+tt*xe,s[3]=Se*w+ze*O+Ye*Y+tt*Fe,s[4]=(Se=c[4])*f+(ze=c[5])*T+(Ye=c[6])*j+(tt=c[7])*ae,s[5]=Se*g+ze*I+Ye*$+tt*ge,s[6]=Se*v+ze*P+Ye*K+tt*xe,s[7]=Se*w+ze*O+Ye*Y+tt*Fe,s[8]=(Se=c[8])*f+(ze=c[9])*T+(Ye=c[10])*j+(tt=c[11])*ae,s[9]=Se*g+ze*I+Ye*$+tt*ge,s[10]=Se*v+ze*P+Ye*K+tt*xe,s[11]=Se*w+ze*O+Ye*Y+tt*Fe,s[12]=(Se=c[12])*f+(ze=c[13])*T+(Ye=c[14])*j+(tt=c[15])*ae,s[13]=Se*g+ze*I+Ye*$+tt*ge,s[14]=Se*v+ze*P+Ye*K+tt*xe,s[15]=Se*w+ze*O+Ye*Y+tt*Fe,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var qc,r1=Xp;function Dh(s,i,c){var f=i[0],g=i[1],v=i[2],w=i[3];return s[0]=c[0]*f+c[4]*g+c[8]*v+c[12]*w,s[1]=c[1]*f+c[5]*g+c[9]*v+c[13]*w,s[2]=c[2]*f+c[6]*g+c[10]*v+c[14]*w,s[3]=c[3]*f+c[7]*g+c[11]*v+c[15]*w,s}qc=new Cl(4),Cl!=Float32Array&&(qc[0]=0,qc[1]=0,qc[2]=0,qc[3]=0);class o1 extends ro{constructor(i){super(i,n1)}createBucket(i){return new Ko(i)}queryRadius(i){const c=i;return Vc("circle-radius",this,c)+Vc("circle-stroke-width",this,c)+Ph(this.paint.get("circle-translate"))}queryIntersectsFeature(i,c,f,g,v,w,T,I){const P=zh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,T),O=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),j=this.paint.get("circle-pitch-alignment")==="map",$=j?P:function(Y,ae){return Y.map(ge=>Kp(ge,ae))}(P,I),K=j?O*T:O;for(const Y of g)for(const ae of Y){const ge=j?ae:Kp(ae,I);let xe=K;const Fe=Dh([],[ae.x,ae.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Fe[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=w.cameraToCenterDistance/Fe[3]),Ah($,ge,xe))return!0}return!1}}function Kp(s,i){const c=Dh([],[s.x,s.y,0,1],i);return new k(c[0]/c[3],c[1]/c[3])}class Jp extends Ko{}let Yp;Lt("HeatmapBucket",Jp,{omit:["layers"]});var s1={get paint(){return Yp=Yp||new xr({"heatmap-radius":new $t(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mc(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(we.paint_heatmap["heatmap-opacity"])})}};function tf(s,{width:i,height:c},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*c*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*c*f}`)}else g=new Uint8Array(i*c*f);return s.width=i,s.height=c,s.data=g,s}function Qp(s,{width:i,height:c},f){if(i===s.width&&c===s.height)return;const g=tf({},{width:i,height:c},f);nf(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,c)},f),s.width=i,s.height=c,s.data=g.data}function nf(s,i,c,f,g,v){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||c.x>s.width-g.width||c.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||f.x>i.width-g.width||f.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,T=i.data;if(w===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const P=((c.y+I)*s.width+c.x)*v,O=((f.y+I)*i.width+f.x)*v;for(let j=0;j<g.width*v;j++)T[O+j]=w[P+j]}return i}class Zc{constructor(i,c){tf(this,i,1,c)}resize(i){Qp(this,i,1)}clone(){return new Zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,f,g,v){nf(i,c,f,g,v,1)}}class oo{constructor(i,c){tf(this,i,4,c)}resize(i){Qp(this,i,4)}replace(i,c){c?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new oo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,f,g,v){nf(i,c,f,g,v,4)}}function em(s){const i={},c=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new oo({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const v=(w,T,I)=>{i[s.evaluationKey]=I;const P=s.expression.evaluate(i);g.data[w+T+0]=Math.floor(255*P.r/P.a),g.data[w+T+1]=Math.floor(255*P.g/P.a),g.data[w+T+2]=Math.floor(255*P.b/P.a),g.data[w+T+3]=Math.floor(255*P.a)};if(s.clips)for(let w=0,T=0;w<f;++w,T+=4*c)for(let I=0,P=0;I<c;I++,P+=4){const O=I/(c-1),{start:j,end:$}=s.clips[w];v(T,P,j*(1-O)+$*O)}else for(let w=0,T=0;w<c;w++,T+=4)v(0,T,w/(c-1));return g}Lt("AlphaImage",Zc),Lt("RGBAImage",oo);class a1 extends ro{createBucket(i){return new Jp(i)}constructor(i){super(i,s1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=em({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let tm;var l1={get paint(){return tm=tm||new xr({"hillshade-illumination-direction":new jt(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(we.paint_hillshade["hillshade-accent-color"])})}};class c1 extends ro{constructor(i){super(i,l1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const u1=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:h1}=u1;var rf={exports:{}};function Rh(s,i,c){c=c||2;var f,g,v,w,T,I,P,O=i&&i.length,j=O?i[0]*c:s.length,$=im(s,0,j,c,!0),K=[];if(!$||$.next===$.prev)return K;if(O&&($=function(ae,ge,xe,Fe){var Se,ze,Ye,tt=[];for(Se=0,ze=ge.length;Se<ze;Se++)(Ye=im(ae,ge[Se]*Fe,Se<ze-1?ge[Se+1]*Fe:ae.length,Fe,!1))===Ye.next&&(Ye.steiner=!0),tt.push(b1(Ye));for(tt.sort(g1),Se=0;Se<tt.length;Se++)xe=_1(tt[Se],xe);return xe}(s,i,$,c)),s.length>80*c){f=v=s[0],g=w=s[1];for(var Y=c;Y<j;Y+=c)(T=s[Y])<f&&(f=T),(I=s[Y+1])<g&&(g=I),T>v&&(v=T),I>w&&(w=I);P=(P=Math.max(v-f,w-g))!==0?32767/P:0}return Gc($,K,c,f,g,P,0),K}function im(s,i,c,f,g){var v,w;if(g===af(s,i,c,f)>0)for(v=i;v<c;v+=f)w=om(v,s[v],s[v+1],w);else for(v=c-f;v>=i;v-=f)w=om(v,s[v],s[v+1],w);return w&&Bh(w,w.next)&&($c(w),w=w.next),w}function La(s,i){if(!s)return s;i||(i=s);var c,f=s;do if(c=!1,f.steiner||!Bh(f,f.next)&&Tn(f.prev,f,f.next)!==0)f=f.next;else{if($c(f),(f=i=f.prev)===f.next)break;c=!0}while(c||f!==i);return i}function Gc(s,i,c,f,g,v,w){if(s){!w&&v&&function(O,j,$,K){var Y=O;do Y.z===0&&(Y.z=of(Y.x,Y.y,j,$,K)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==O);Y.prevZ.nextZ=null,Y.prevZ=null,function(ae){var ge,xe,Fe,Se,ze,Ye,tt,Ct,Bt=1;do{for(xe=ae,ae=null,ze=null,Ye=0;xe;){for(Ye++,Fe=xe,tt=0,ge=0;ge<Bt&&(tt++,Fe=Fe.nextZ);ge++);for(Ct=Bt;tt>0||Ct>0&&Fe;)tt!==0&&(Ct===0||!Fe||xe.z<=Fe.z)?(Se=xe,xe=xe.nextZ,tt--):(Se=Fe,Fe=Fe.nextZ,Ct--),ze?ze.nextZ=Se:ae=Se,Se.prevZ=ze,ze=Se;xe=Fe}ze.nextZ=null,Bt*=2}while(Ye>1)}(Y)}(s,f,g,v);for(var T,I,P=s;s.prev!==s.next;)if(T=s.prev,I=s.next,v?f1(s,f,g,v):d1(s))i.push(T.i/c|0),i.push(s.i/c|0),i.push(I.i/c|0),$c(s),s=I.next,P=I.next;else if((s=I)===P){w?w===1?Gc(s=p1(La(s),i,c),i,c,f,g,v,2):w===2&&m1(s,i,c,f,g,v):Gc(La(s),i,c,f,g,v,1);break}}}function d1(s){var i=s.prev,c=s,f=s.next;if(Tn(i,c,f)>=0)return!1;for(var g=i.x,v=c.x,w=f.x,T=i.y,I=c.y,P=f.y,O=g<v?g<w?g:w:v<w?v:w,j=T<I?T<P?T:P:I<P?I:P,$=g>v?g>w?g:w:v>w?v:w,K=T>I?T>P?T:P:I>P?I:P,Y=f.next;Y!==i;){if(Y.x>=O&&Y.x<=$&&Y.y>=j&&Y.y<=K&&Ml(g,T,v,I,w,P,Y.x,Y.y)&&Tn(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function f1(s,i,c,f){var g=s.prev,v=s,w=s.next;if(Tn(g,v,w)>=0)return!1;for(var T=g.x,I=v.x,P=w.x,O=g.y,j=v.y,$=w.y,K=T<I?T<P?T:P:I<P?I:P,Y=O<j?O<$?O:$:j<$?j:$,ae=T>I?T>P?T:P:I>P?I:P,ge=O>j?O>$?O:$:j>$?j:$,xe=of(K,Y,i,c,f),Fe=of(ae,ge,i,c,f),Se=s.prevZ,ze=s.nextZ;Se&&Se.z>=xe&&ze&&ze.z<=Fe;){if(Se.x>=K&&Se.x<=ae&&Se.y>=Y&&Se.y<=ge&&Se!==g&&Se!==w&&Ml(T,O,I,j,P,$,Se.x,Se.y)&&Tn(Se.prev,Se,Se.next)>=0||(Se=Se.prevZ,ze.x>=K&&ze.x<=ae&&ze.y>=Y&&ze.y<=ge&&ze!==g&&ze!==w&&Ml(T,O,I,j,P,$,ze.x,ze.y)&&Tn(ze.prev,ze,ze.next)>=0))return!1;ze=ze.nextZ}for(;Se&&Se.z>=xe;){if(Se.x>=K&&Se.x<=ae&&Se.y>=Y&&Se.y<=ge&&Se!==g&&Se!==w&&Ml(T,O,I,j,P,$,Se.x,Se.y)&&Tn(Se.prev,Se,Se.next)>=0)return!1;Se=Se.prevZ}for(;ze&&ze.z<=Fe;){if(ze.x>=K&&ze.x<=ae&&ze.y>=Y&&ze.y<=ge&&ze!==g&&ze!==w&&Ml(T,O,I,j,P,$,ze.x,ze.y)&&Tn(ze.prev,ze,ze.next)>=0)return!1;ze=ze.nextZ}return!0}function p1(s,i,c){var f=s;do{var g=f.prev,v=f.next.next;!Bh(g,v)&&nm(g,f,f.next,v)&&Wc(g,v)&&Wc(v,g)&&(i.push(g.i/c|0),i.push(f.i/c|0),i.push(v.i/c|0),$c(f),$c(f.next),f=s=v),f=f.next}while(f!==s);return La(f)}function m1(s,i,c,f,g,v){var w=s;do{for(var T=w.next.next;T!==w.prev;){if(w.i!==T.i&&v1(w,T)){var I=rm(w,T);return w=La(w,w.next),I=La(I,I.next),Gc(w,i,c,f,g,v,0),void Gc(I,i,c,f,g,v,0)}T=T.next}w=w.next}while(w!==s)}function g1(s,i){return s.x-i.x}function _1(s,i){var c=function(g,v){var w,T=v,I=g.x,P=g.y,O=-1/0;do{if(P<=T.y&&P>=T.next.y&&T.next.y!==T.y){var j=T.x+(P-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(j<=I&&j>O&&(O=j,w=T.x<T.next.x?T:T.next,j===I))return w}T=T.next}while(T!==v);if(!w)return null;var $,K=w,Y=w.x,ae=w.y,ge=1/0;T=w;do I>=T.x&&T.x>=Y&&I!==T.x&&Ml(P<ae?I:O,P,Y,ae,P<ae?O:I,P,T.x,T.y)&&($=Math.abs(P-T.y)/(I-T.x),Wc(T,g)&&($<ge||$===ge&&(T.x>w.x||T.x===w.x&&y1(w,T)))&&(w=T,ge=$)),T=T.next;while(T!==K);return w}(s,i);if(!c)return i;var f=rm(c,s);return La(f,f.next),La(c,c.next)}function y1(s,i){return Tn(s.prev,s,i.prev)<0&&Tn(i.next,s,s.next)<0}function of(s,i,c,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function b1(s){var i=s,c=s;do(i.x<c.x||i.x===c.x&&i.y<c.y)&&(c=i),i=i.next;while(i!==s);return c}function Ml(s,i,c,f,g,v,w,T){return(g-w)*(i-T)>=(s-w)*(v-T)&&(s-w)*(f-T)>=(c-w)*(i-T)&&(c-w)*(v-T)>=(g-w)*(f-T)}function v1(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(c,f){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==f.i&&g.next.i!==f.i&&nm(g,g.next,c,f))return!0;g=g.next}while(g!==c);return!1}(s,i)&&(Wc(s,i)&&Wc(i,s)&&function(c,f){var g=c,v=!1,w=(c.x+f.x)/2,T=(c.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&w<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==c);return v}(s,i)&&(Tn(s.prev,s,i.prev)||Tn(s,i.prev,i))||Bh(s,i)&&Tn(s.prev,s,s.next)>0&&Tn(i.prev,i,i.next)>0)}function Tn(s,i,c){return(i.y-s.y)*(c.x-i.x)-(i.x-s.x)*(c.y-i.y)}function Bh(s,i){return s.x===i.x&&s.y===i.y}function nm(s,i,c,f){var g=Oh(Tn(s,i,c)),v=Oh(Tn(s,i,f)),w=Oh(Tn(c,f,s)),T=Oh(Tn(c,f,i));return g!==v&&w!==T||!(g!==0||!Fh(s,c,i))||!(v!==0||!Fh(s,f,i))||!(w!==0||!Fh(c,s,f))||!(T!==0||!Fh(c,i,f))}function Fh(s,i,c){return i.x<=Math.max(s.x,c.x)&&i.x>=Math.min(s.x,c.x)&&i.y<=Math.max(s.y,c.y)&&i.y>=Math.min(s.y,c.y)}function Oh(s){return s>0?1:s<0?-1:0}function Wc(s,i){return Tn(s.prev,s,s.next)<0?Tn(s,i,s.next)>=0&&Tn(s,s.prev,i)>=0:Tn(s,i,s.prev)<0||Tn(s,s.next,i)<0}function rm(s,i){var c=new sf(s.i,s.x,s.y),f=new sf(i.i,i.x,i.y),g=s.next,v=i.prev;return s.next=i,i.prev=s,c.next=g,g.prev=c,f.next=c,c.prev=f,v.next=f,f.prev=v,f}function om(s,i,c,f){var g=new sf(s,i,c);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function $c(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function sf(s,i,c){this.i=s,this.x=i,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function af(s,i,c,f){for(var g=0,v=i,w=c-f;v<c;v+=f)g+=(s[w]-s[v])*(s[v+1]+s[w+1]),w=v;return g}rf.exports=Rh,rf.exports.default=Rh,Rh.deviation=function(s,i,c,f){var g=i&&i.length,v=Math.abs(af(s,0,g?i[0]*c:s.length,c));if(g)for(var w=0,T=i.length;w<T;w++)v-=Math.abs(af(s,i[w]*c,w<T-1?i[w+1]*c:s.length,c));var I=0;for(w=0;w<f.length;w+=3){var P=f[w]*c,O=f[w+1]*c,j=f[w+2]*c;I+=Math.abs((s[P]-s[j])*(s[O+1]-s[P+1])-(s[P]-s[O])*(s[j+1]-s[P+1]))}return v===0&&I===0?0:Math.abs((I-v)/v)},Rh.flatten=function(s){for(var i=s[0][0].length,c={vertices:[],holes:[],dimensions:i},f=0,g=0;g<s.length;g++){for(var v=0;v<s[g].length;v++)for(var w=0;w<i;w++)c.vertices.push(s[g][v][w]);g>0&&c.holes.push(f+=s[g-1].length)}return c};var sm=_(rf.exports);function w1(s,i,c,f,g){am(s,i,c||0,f||s.length-1,g||x1)}function am(s,i,c,f,g){for(;f>c;){if(f-c>600){var v=f-c+1,w=i-c+1,T=Math.log(v),I=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*I*(v-I)/v)*(w-v/2<0?-1:1);am(s,i,Math.max(c,Math.floor(i-w*I/v+P)),Math.min(f,Math.floor(i+(v-w)*I/v+P)),g)}var O=s[i],j=c,$=f;for(Hc(s,c,i),g(s[f],O)>0&&Hc(s,c,f);j<$;){for(Hc(s,j,$),j++,$--;g(s[j],O)<0;)j++;for(;g(s[$],O)>0;)$--}g(s[c],O)===0?Hc(s,c,$):Hc(s,++$,f),$<=i&&(c=$+1),i<=$&&(f=$-1)}}function Hc(s,i,c){var f=s[i];s[i]=s[c],s[c]=f}function x1(s,i){return s<i?-1:s>i?1:0}function lf(s,i){const c=s.length;if(c<=1)return[s];const f=[];let g,v;for(let w=0;w<c;w++){const T=et(s[w]);T!==0&&(s[w].area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(g&&f.push(g),g=[s[w]]):g.push(s[w]))}if(g&&f.push(g),i>1)for(let w=0;w<f.length;w++)f[w].length<=i||(w1(f[w],i,1,f[w].length-1,k1),f[w]=f[w].slice(0,i));return f}function k1(s,i){return i.area-s.area}function cf(s,i,c){const f=c.patternDependencies;let g=!1;for(const v of i){const w=v.paint.get(`${s}-pattern`);w.isConstant()||(g=!0);const T=w.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function uf(s,i,c,f,g){const v=g.patternDependencies;for(const w of i){const T=w.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:f-1},c,{},g.availableImages),P=T.evaluate({zoom:f},c,{},g.availableImages),O=T.evaluate({zoom:f+1},c,{},g.availableImages);I=I&&I.name?I.name:I,P=P&&P.name?P.name:P,O=O&&O.name?O.name:O,v[I]=!0,v[P]=!0,v[O]=!0,c.patterns[w.id]={min:I,mid:P,max:O}}}return c}class hf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pe,this.indexArray=new Xe,this.indexArray2=new nt,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new _t,this.segments2=new _t,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){this.hasPattern=cf("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),w=[];for(const{feature:T,id:I,index:P,sourceLayerIndex:O}of i){const j=this.layers[0]._featureFilter.needGeometry,$=fs(T,j);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),$,f))continue;const K=v?g.evaluate($,{},f,c.availableImages):void 0,Y={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:P,geometry:j?$.geometry:ds(T),patterns:{},sortKey:K};w.push(Y)}v&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:P,sourceLayerIndex:O}=T;if(this.hasPattern){const j=uf("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,I,P,f,{});c.featureIndex.insert(i[P].feature,I,P,O,this.index)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}addFeatures(i,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,h1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,c,f,g,v){for(const w of lf(c,500)){let T=0;for(const K of w)T+=K.length;const I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=I.vertexLength,O=[],j=[];for(const K of w){if(K.length===0)continue;K!==w[0]&&j.push(O.length/2);const Y=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),ae=Y.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(ae+K.length-1,ae),O.push(K[0].x),O.push(K[0].y);for(let ge=1;ge<K.length;ge++)this.layoutVertexArray.emplaceBack(K[ge].x,K[ge].y),this.indexArray2.emplaceBack(ae+ge-1,ae+ge),O.push(K[ge].x),O.push(K[ge].y);Y.vertexLength+=K.length,Y.primitiveLength+=K.length}const $=sm(O,j);for(let K=0;K<$.length;K+=3)this.indexArray.emplaceBack(P+$[K],P+$[K+1],P+$[K+2]);I.vertexLength+=T,I.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,v,g)}}let lm,cm;Lt("FillBucket",hf,{omit:["layers","patternFeatures"]});var S1={get paint(){return cm=cm||new xr({"fill-antialias":new jt(we.paint_fill["fill-antialias"]),"fill-opacity":new $t(we.paint_fill["fill-opacity"]),"fill-color":new $t(we.paint_fill["fill-color"]),"fill-outline-color":new $t(we.paint_fill["fill-outline-color"]),"fill-translate":new jt(we.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new gl(we.paint_fill["fill-pattern"])})},get layout(){return lm=lm||new xr({"fill-sort-key":new $t(we.layout_fill["fill-sort-key"])})}};class T1 extends ro{constructor(i){super(i,S1)}recalculate(i,c){super.recalculate(i,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new hf(i)}queryRadius(){return Ph(this.paint.get("fill-translate"))}queryIntersectsFeature(i,c,f,g,v,w,T){return Nc(zh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,T),g)}isTileClipped(){return!0}}const E1=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),C1=Sn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:M1}=E1;var Zs={},I1=x,um=Il;function Il(s,i,c,f,g){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(L1,this,i)}function L1(s,i,c){s==1?i.id=c.readVarint():s==2?function(f,g){for(var v=f.readVarint()+f.pos;f.pos<v;){var w=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[w]=T}}(c,i):s==3?i.type=c.readVarint():s==4&&(i._geometry=c.pos)}function A1(s){for(var i,c,f=0,g=0,v=s.length,w=v-1;g<v;w=g++)f+=((c=s[w]).x-(i=s[g]).x)*(i.y+c.y);return f}Il.types=["Unknown","Point","LineString","Polygon"],Il.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,c=s.readVarint()+s.pos,f=1,g=0,v=0,w=0,T=[];s.pos<c;){if(g<=0){var I=s.readVarint();f=7&I,g=I>>3}if(g--,f===1||f===2)v+=s.readSVarint(),w+=s.readSVarint(),f===1&&(i&&T.push(i),i=[]),i.push(new I1(v,w));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&T.push(i),T},Il.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,c=1,f=0,g=0,v=0,w=1/0,T=-1/0,I=1/0,P=-1/0;s.pos<i;){if(f<=0){var O=s.readVarint();c=7&O,f=O>>3}if(f--,c===1||c===2)(g+=s.readSVarint())<w&&(w=g),g>T&&(T=g),(v+=s.readSVarint())<I&&(I=v),v>P&&(P=v);else if(c!==7)throw new Error("unknown command "+c)}return[w,I,T,P]},Il.prototype.toGeoJSON=function(s,i,c){var f,g,v=this.extent*Math.pow(2,c),w=this.extent*s,T=this.extent*i,I=this.loadGeometry(),P=Il.types[this.type];function O(K){for(var Y=0;Y<K.length;Y++){var ae=K[Y];K[Y]=[360*(ae.x+w)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+T)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(f=0;f<I.length;f++)j[f]=I[f][0];O(I=j);break;case 2:for(f=0;f<I.length;f++)O(I[f]);break;case 3:for(I=function(K){var Y=K.length;if(Y<=1)return[K];for(var ae,ge,xe=[],Fe=0;Fe<Y;Fe++){var Se=A1(K[Fe]);Se!==0&&(ge===void 0&&(ge=Se<0),ge===Se<0?(ae&&xe.push(ae),ae=[K[Fe]]):ae.push(K[Fe]))}return ae&&xe.push(ae),xe}(I),f=0;f<I.length;f++)for(g=0;g<I[f].length;g++)O(I[f][g])}I.length===1?I=I[0]:P="Multi"+P;var $={type:"Feature",geometry:{type:P,coordinates:I},properties:this.properties};return"id"in this&&($.id=this.id),$};var P1=um,hm=dm;function dm(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(z1,this,i),this.length=this._features.length}function z1(s,i,c){s===15?i.version=c.readVarint():s===1?i.name=c.readString():s===5?i.extent=c.readVarint():s===2?i._features.push(c.pos):s===3?i._keys.push(c.readString()):s===4&&i._values.push(function(f){for(var g=null,v=f.readVarint()+f.pos;f.pos<v;){var w=f.readVarint()>>3;g=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return g}(c))}dm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new P1(this._pbf,i,this.extent,this._keys,this._values)};var D1=hm;function R1(s,i,c){if(s===3){var f=new D1(c,c.readVarint()+c.pos);f.length&&(i[f.name]=f)}}Zs.VectorTile=function(s,i){this.layers=s.readFields(R1,{},i)},Zs.VectorTileFeature=um,Zs.VectorTileLayer=hm;const B1=Zs.VectorTileFeature.types,df=Math.pow(2,13);function Xc(s,i,c,f,g,v,w,T){s.emplaceBack(i,c,2*Math.floor(f*df)+w,g*df*2,v*df*2,Math.round(T))}class ff{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new Z,this.indexArray=new Xe,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new _t,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){this.features=[],this.hasPattern=cf("fill-extrusion",this.layers,c);for(const{feature:g,id:v,index:w,sourceLayerIndex:T}of i){const I=this.layers[0]._featureFilter.needGeometry,P=fs(g,I);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),P,f))continue;const O={id:v,sourceLayerIndex:T,index:w,geometry:I?P.geometry:ds(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(uf("fill-extrusion",this.layers,O,this.zoom,c)):this.addFeature(O,O.geometry,w,f,{}),c.featureIndex.insert(g,O.geometry,w,T,this.index,!0)}}addFeatures(i,c,f){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,c,f)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,M1),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,C1.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,c,f,g,v){const w={x:0,y:0,vertexCount:0};for(const T of lf(c,500)){let I=0;for(const Y of T)I+=Y.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Y of T){if(Y.length===0||O1(Y))continue;let ae=0;for(let ge=0;ge<Y.length;ge++){const xe=Y[ge];if(ge>=1){const Fe=Y[ge-1];if(!F1(xe,Fe)){P.vertexLength+4>_t.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Se=xe.sub(Fe)._perp()._unit(),ze=Fe.dist(xe);ae+ze>32768&&(ae=0),Xc(this.layoutVertexArray,xe.x,xe.y,Se.x,Se.y,0,0,ae),Xc(this.layoutVertexArray,xe.x,xe.y,Se.x,Se.y,0,1,ae),w.x+=2*xe.x,w.y+=2*xe.y,w.vertexCount+=2,ae+=ze,Xc(this.layoutVertexArray,Fe.x,Fe.y,Se.x,Se.y,0,0,ae),Xc(this.layoutVertexArray,Fe.x,Fe.y,Se.x,Se.y,0,1,ae),w.x+=2*Fe.x,w.y+=2*Fe.y,w.vertexCount+=2;const Ye=P.vertexLength;this.indexArray.emplaceBack(Ye,Ye+2,Ye+1),this.indexArray.emplaceBack(Ye+1,Ye+2,Ye+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+I>_t.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),B1[i.type]!=="Polygon")continue;const O=[],j=[],$=P.vertexLength;for(const Y of T)if(Y.length!==0){Y!==T[0]&&j.push(O.length/2);for(let ae=0;ae<Y.length;ae++){const ge=Y[ae];Xc(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),w.x+=ge.x,w.y+=ge.y,w.vertexCount+=1,O.push(ge.x),O.push(ge.y)}}const K=sm(O,j);for(let Y=0;Y<K.length;Y+=3)this.indexArray.emplaceBack($+K[Y],$+K[Y+2],$+K[Y+1]);P.primitiveLength+=K.length/3,P.vertexLength+=I}for(let T=0;T<w.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,v,g)}}function F1(s,i){return s.x===i.x&&(s.x<0||s.x>yn)||s.y===i.y&&(s.y<0||s.y>yn)}function O1(s){return s.every(i=>i.x<0)||s.every(i=>i.x>yn)||s.every(i=>i.y<0)||s.every(i=>i.y>yn)}let fm;Lt("FillExtrusionBucket",ff,{omit:["layers","features"]});var N1={get paint(){return fm=fm||new xr({"fill-extrusion-opacity":new jt(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $t(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class j1 extends ro{constructor(i){super(i,N1)}createBucket(i){return new ff(i)}queryRadius(){return Ph(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,c,f,g,v,w,T,I){const P=zh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,T),O=this.paint.get("fill-extrusion-height").evaluate(c,f),j=this.paint.get("fill-extrusion-base").evaluate(c,f),$=function(Y,ae,ge,xe){const Fe=[];for(const Se of Y){const ze=[Se.x,Se.y,0,1];Dh(ze,ze,ae),Fe.push(new k(ze[0]/ze[3],ze[1]/ze[3]))}return Fe}(P,I),K=function(Y,ae,ge,xe){const Fe=[],Se=[],ze=xe[8]*ae,Ye=xe[9]*ae,tt=xe[10]*ae,Ct=xe[11]*ae,Bt=xe[8]*ge,Tt=xe[9]*ge,wt=xe[10]*ge,mt=xe[11]*ge;for(const zt of Y){const bt=[],at=[];for(const Wt of zt){const Nt=Wt.x,mi=Wt.y,Hi=xe[0]*Nt+xe[4]*mi+xe[12],tn=xe[1]*Nt+xe[5]*mi+xe[13],Vn=xe[2]*Nt+xe[6]*mi+xe[14],Jr=xe[3]*Nt+xe[7]*mi+xe[15],Sr=Vn+tt,zn=Jr+Ct,Qn=Hi+Bt,sr=tn+Tt,Tr=Vn+wt,Er=Jr+mt,qn=new k((Hi+ze)/zn,(tn+Ye)/zn);qn.z=Sr/zn,bt.push(qn);const Zn=new k(Qn/Er,sr/Er);Zn.z=Tr/Er,at.push(Zn)}Fe.push(bt),Se.push(at)}return[Fe,Se]}(g,j,O,I);return function(Y,ae,ge){let xe=1/0;Nc(ge,ae)&&(xe=pm(ge,ae[0]));for(let Fe=0;Fe<ae.length;Fe++){const Se=ae[Fe],ze=Y[Fe];for(let Ye=0;Ye<Se.length-1;Ye++){const tt=Se[Ye],Ct=[tt,Se[Ye+1],ze[Ye+1],ze[Ye],tt];Oc(ge,Ct)&&(xe=Math.min(xe,pm(ge,Ct)))}}return xe!==1/0&&xe}(K[0],K[1],$)}}function Kc(s,i){return s.x*i.x+s.y*i.y}function pm(s,i){if(s.length===1){let c=0;const f=i[c++];let g;for(;!g||f.equals(g);)if(g=i[c++],!g)return 1/0;for(;c<i.length;c++){const v=i[c],w=s[0],T=g.sub(f),I=v.sub(f),P=w.sub(f),O=Kc(T,T),j=Kc(T,I),$=Kc(I,I),K=Kc(P,T),Y=Kc(P,I),ae=O*$-j*j,ge=($*K-j*Y)/ae,xe=(O*Y-j*K)/ae,Fe=f.z*(1-ge-xe)+g.z*ge+v.z*xe;if(isFinite(Fe))return Fe}return 1/0}{let c=1/0;for(const f of i)c=Math.min(c,f.z);return c}}const U1=Sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:V1}=U1,q1=Sn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Z1}=q1,G1=Zs.VectorTileFeature.types,W1=Math.cos(Math.PI/180*37.5),mm=Math.pow(2,14)/.5;class pf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new _e,this.layoutVertexArray2=new se,this.indexArray=new Xe,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new _t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){this.hasPattern=cf("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),w=[];for(const{feature:T,id:I,index:P,sourceLayerIndex:O}of i){const j=this.layers[0]._featureFilter.needGeometry,$=fs(T,j);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),$,f))continue;const K=v?g.evaluate($,{},f):void 0,Y={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:P,geometry:j?$.geometry:ds(T),patterns:{},sortKey:K};w.push(Y)}v&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:P,sourceLayerIndex:O}=T;if(this.hasPattern){const j=uf("line",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,I,P,f,{});c.featureIndex.insert(i[P].feature,I,P,O,this.index)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}addFeatures(i,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Z1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,V1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,c,f,g,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),I=w.get("line-cap"),P=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const j of c)this.addLine(j,i,T,I,P,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,v,g)}addLine(i,c,f,g,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<i.length-1;xe++)this.totalDistance+=i[xe].dist(i[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=G1[c.type]==="Polygon";let I=i.length;for(;I>=2&&i[I-1].equals(i[I-2]);)I--;let P=0;for(;P<I-1&&i[P].equals(i[P+1]);)P++;if(I<(T?3:2))return;f==="bevel"&&(v=1.05);const O=this.overscaling<=16?15*yn/(512*this.overscaling):0,j=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let $,K,Y,ae,ge;this.e1=this.e2=-1,T&&($=i[I-2],ge=i[P].sub($)._unit()._perp());for(let xe=P;xe<I;xe++){if(Y=xe===I-1?T?i[P+1]:void 0:i[xe+1],Y&&i[xe].equals(Y))continue;ge&&(ae=ge),$&&(K=$),$=i[xe],ge=Y?Y.sub($)._unit()._perp():ae,ae=ae||ge;let Fe=ae.add(ge);Fe.x===0&&Fe.y===0||Fe._unit();const Se=ae.x*ge.x+ae.y*ge.y,ze=Fe.x*ge.x+Fe.y*ge.y,Ye=ze!==0?1/ze:1/0,tt=2*Math.sqrt(2-2*ze),Ct=ze<W1&&K&&Y,Bt=ae.x*ge.y-ae.y*ge.x>0;if(Ct&&xe>P){const mt=$.dist(K);if(mt>2*O){const zt=$.sub($.sub(K)._mult(O/mt)._round());this.updateDistance(K,zt),this.addCurrentVertex(zt,ae,0,0,j),K=zt}}const Tt=K&&Y;let wt=Tt?f:T?"butt":g;if(Tt&&wt==="round"&&(Ye<w?wt="miter":Ye<=2&&(wt="fakeround")),wt==="miter"&&Ye>v&&(wt="bevel"),wt==="bevel"&&(Ye>2&&(wt="flipbevel"),Ye<v&&(wt="miter")),K&&this.updateDistance(K,$),wt==="miter")Fe._mult(Ye),this.addCurrentVertex($,Fe,0,0,j);else if(wt==="flipbevel"){if(Ye>100)Fe=ge.mult(-1);else{const mt=Ye*ae.add(ge).mag()/ae.sub(ge).mag();Fe._perp()._mult(mt*(Bt?-1:1))}this.addCurrentVertex($,Fe,0,0,j),this.addCurrentVertex($,Fe.mult(-1),0,0,j)}else if(wt==="bevel"||wt==="fakeround"){const mt=-Math.sqrt(Ye*Ye-1),zt=Bt?mt:0,bt=Bt?0:mt;if(K&&this.addCurrentVertex($,ae,zt,bt,j),wt==="fakeround"){const at=Math.round(180*tt/Math.PI/20);for(let Wt=1;Wt<at;Wt++){let Nt=Wt/at;if(Nt!==.5){const Hi=Nt-.5;Nt+=Nt*Hi*(Nt-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*Hi*Hi+(.848013+Se*(.215638*Se-1.06021)))}const mi=ge.sub(ae)._mult(Nt)._add(ae)._unit()._mult(Bt?-1:1);this.addHalfVertex($,mi.x,mi.y,!1,Bt,0,j)}}Y&&this.addCurrentVertex($,ge,-zt,-bt,j)}else if(wt==="butt")this.addCurrentVertex($,Fe,0,0,j);else if(wt==="square"){const mt=K?1:-1;this.addCurrentVertex($,Fe,mt,mt,j)}else wt==="round"&&(K&&(this.addCurrentVertex($,ae,0,0,j),this.addCurrentVertex($,ae,1,1,j,!0)),Y&&(this.addCurrentVertex($,ge,-1,-1,j,!0),this.addCurrentVertex($,ge,0,0,j)));if(Ct&&xe<I-1){const mt=$.dist(Y);if(mt>2*O){const zt=$.add(Y.sub($)._mult(O/mt)._round());this.updateDistance($,zt),this.addCurrentVertex(zt,ge,0,0,j),$=zt}}}}addCurrentVertex(i,c,f,g,v,w=!1){const T=c.y*g-c.x,I=-c.y-c.x*g;this.addHalfVertex(i,c.x+c.y*f,c.y-c.x*f,w,!1,f,v),this.addHalfVertex(i,T,I,w,!0,-g,v),this.distance>mm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,c,f,g,v,w))}addHalfVertex({x:i,y:c},f,g,v,w,T,I){const P=.5*(this.lineClips?this.scaledDistance*(mm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(v?1:0),(c<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),I.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,c){this.distance+=i.dist(c),this.updateScaledDistance()}}let gm,_m;Lt("LineBucket",pf,{omit:["layers","patternFeatures"]});var ym={get paint(){return _m=_m||new xr({"line-opacity":new $t(we.paint_line["line-opacity"]),"line-color":new $t(we.paint_line["line-color"]),"line-translate":new jt(we.paint_line["line-translate"]),"line-translate-anchor":new jt(we.paint_line["line-translate-anchor"]),"line-width":new $t(we.paint_line["line-width"]),"line-gap-width":new $t(we.paint_line["line-gap-width"]),"line-offset":new $t(we.paint_line["line-offset"]),"line-blur":new $t(we.paint_line["line-blur"]),"line-dasharray":new ka(we.paint_line["line-dasharray"]),"line-pattern":new gl(we.paint_line["line-pattern"]),"line-gradient":new Mc(we.paint_line["line-gradient"])})},get layout(){return gm=gm||new xr({"line-cap":new jt(we.layout_line["line-cap"]),"line-join":new $t(we.layout_line["line-join"]),"line-miter-limit":new jt(we.layout_line["line-miter-limit"]),"line-round-limit":new jt(we.layout_line["line-round-limit"]),"line-sort-key":new $t(we.layout_line["line-sort-key"])})}};class $1 extends $t{possiblyEvaluate(i,c){return c=new Qi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(i,c)}evaluate(i,c,f,g){return c=H({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(i,c,f,g)}}let Nh;class H1 extends ro{constructor(i){super(i,ym),this.gradientVersion=0,Nh||(Nh=new $1(ym.paint.properties["line-width"].specification),Nh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,c){super.recalculate(i,c),this.paint._values["line-floorwidth"]=Nh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new pf(i)}queryRadius(i){const c=i,f=bm(Vc("line-width",this,c),Vc("line-gap-width",this,c)),g=Vc("line-offset",this,c);return f/2+Math.abs(g)+Ph(this.paint.get("line-translate"))}queryIntersectsFeature(i,c,f,g,v,w,T){const I=zh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,T),P=T/2*bm(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),O=this.paint.get("line-offset").evaluate(c,f);return O&&(g=function(j,$){const K=[];for(let Y=0;Y<j.length;Y++){const ae=j[Y],ge=[];for(let xe=0;xe<ae.length;xe++){const Fe=ae[xe-1],Se=ae[xe],ze=ae[xe+1],Ye=xe===0?new k(0,0):Se.sub(Fe)._unit()._perp(),tt=xe===ae.length-1?new k(0,0):ze.sub(Se)._unit()._perp(),Ct=Ye._add(tt)._unit(),Bt=Ct.x*tt.x+Ct.y*tt.y;Bt!==0&&Ct._mult(1/Bt),ge.push(Ct._mult($)._add(Se))}K.push(ge)}return K}(g,O*T)),function(j,$,K){for(let Y=0;Y<$.length;Y++){const ae=$[Y];if(j.length>=3){for(let ge=0;ge<ae.length;ge++)if(El(j,ae[ge]))return!0}if(jc(j,ae,K))return!0}return!1}(I,g,P)}isTileClipped(){return!0}}function bm(s,i){return i>0?i+2*s:s}const X1=Sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),K1=Sn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const J1=Sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Sn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vm=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Y1=Sn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Q1(s,i,c){return s.sections.forEach(f=>{f.text=function(g,v,w){const T=v.layout.get("text-transform").evaluate(w,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),$o.applyArabicShaping&&(g=$o.applyArabicShaping(g)),g}(f.text,i,c)}),s}Sn([{name:"triangle",components:3,type:"Uint16"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Sn([{type:"Float32",name:"offsetX"}]),Sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Sn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Jc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Un=24,wm=Fi,xm=function(s,i,c,f,g){var v,w,T=8*g-f-1,I=(1<<T)-1,P=I>>1,O=-7,j=c?g-1:0,$=c?-1:1,K=s[i+j];for(j+=$,v=K&(1<<-O)-1,K>>=-O,O+=T;O>0;v=256*v+s[i+j],j+=$,O-=8);for(w=v&(1<<-O)-1,v>>=-O,O+=f;O>0;w=256*w+s[i+j],j+=$,O-=8);if(v===0)v=1-P;else{if(v===I)return w?NaN:1/0*(K?-1:1);w+=Math.pow(2,f),v-=P}return(K?-1:1)*w*Math.pow(2,v-f)},km=function(s,i,c,f,g,v){var w,T,I,P=8*v-g-1,O=(1<<P)-1,j=O>>1,$=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=f?0:v-1,Y=f?1:-1,ae=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(T=isNaN(i)?1:0,w=O):(w=Math.floor(Math.log(i)/Math.LN2),i*(I=Math.pow(2,-w))<1&&(w--,I*=2),(i+=w+j>=1?$/I:$*Math.pow(2,1-j))*I>=2&&(w++,I/=2),w+j>=O?(T=0,w=O):w+j>=1?(T=(i*I-1)*Math.pow(2,g),w+=j):(T=i*Math.pow(2,j-1)*Math.pow(2,g),w=0));g>=8;s[c+K]=255&T,K+=Y,T/=256,g-=8);for(w=w<<g|T,P+=g;P>0;s[c+K]=255&w,K+=Y,w/=256,P-=8);s[c+K-Y]|=128*ae};function Fi(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Fi.Varint=0,Fi.Fixed64=1,Fi.Bytes=2,Fi.Fixed32=5;var mf=4294967296,Sm=1/mf,Tm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ps(s){return s.type===Fi.Bytes?s.readVarint()+s.pos:s.pos+1}function Ll(s,i,c){return c?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function Em(s,i,c){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));c.realloc(f);for(var g=c.pos-1;g>=s;g--)c.buf[g+f]=c.buf[g]}function eb(s,i){for(var c=0;c<s.length;c++)i.writeVarint(s[c])}function tb(s,i){for(var c=0;c<s.length;c++)i.writeSVarint(s[c])}function ib(s,i){for(var c=0;c<s.length;c++)i.writeFloat(s[c])}function nb(s,i){for(var c=0;c<s.length;c++)i.writeDouble(s[c])}function rb(s,i){for(var c=0;c<s.length;c++)i.writeBoolean(s[c])}function ob(s,i){for(var c=0;c<s.length;c++)i.writeFixed32(s[c])}function sb(s,i){for(var c=0;c<s.length;c++)i.writeSFixed32(s[c])}function ab(s,i){for(var c=0;c<s.length;c++)i.writeFixed64(s[c])}function lb(s,i){for(var c=0;c<s.length;c++)i.writeSFixed64(s[c])}function jh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Al(s,i,c){s[c]=i,s[c+1]=i>>>8,s[c+2]=i>>>16,s[c+3]=i>>>24}function Cm(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}Fi.prototype={destroy:function(){this.buf=null},readFields:function(s,i,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),g=f>>3,v=this.pos;this.type=7&f,s(g,i,this),this.pos===v&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=jh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Cm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=jh(this.buf,this.pos)+jh(this.buf,this.pos+4)*mf;return this.pos+=8,s},readSFixed64:function(){var s=jh(this.buf,this.pos)+Cm(this.buf,this.pos+4)*mf;return this.pos+=8,s},readFloat:function(){var s=xm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=xm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,c,f=this.buf;return i=127&(c=f[this.pos++]),c<128?i:(i|=(127&(c=f[this.pos++]))<<7,c<128?i:(i|=(127&(c=f[this.pos++]))<<14,c<128?i:(i|=(127&(c=f[this.pos++]))<<21,c<128?i:function(g,v,w){var T,I,P=w.buf;if(T=(112&(I=P[w.pos++]))>>4,I<128||(T|=(127&(I=P[w.pos++]))<<3,I<128)||(T|=(127&(I=P[w.pos++]))<<10,I<128)||(T|=(127&(I=P[w.pos++]))<<17,I<128)||(T|=(127&(I=P[w.pos++]))<<24,I<128)||(T|=(1&(I=P[w.pos++]))<<31,I<128))return Ll(g,T,v);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(c=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&Tm?function(c,f,g){return Tm.decode(c.subarray(f,g))}(this.buf,i,s):function(c,f,g){for(var v="",w=f;w<g;){var T,I,P,O=c[w],j=null,$=O>239?4:O>223?3:O>191?2:1;if(w+$>g)break;$===1?O<128&&(j=O):$===2?(192&(T=c[w+1]))==128&&(j=(31&O)<<6|63&T)<=127&&(j=null):$===3?(I=c[w+2],(192&(T=c[w+1]))==128&&(192&I)==128&&((j=(15&O)<<12|(63&T)<<6|63&I)<=2047||j>=55296&&j<=57343)&&(j=null)):$===4&&(I=c[w+2],P=c[w+3],(192&(T=c[w+1]))==128&&(192&I)==128&&(192&P)==128&&((j=(15&O)<<18|(63&T)<<12|(63&I)<<6|63&P)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,$=1):j>65535&&(j-=65536,v+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),v+=String.fromCharCode(j),w+=$}return v}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Fi.Bytes)return s.push(this.readVarint(i));var c=ps(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Fi.Bytes)return s.push(this.readSVarint());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Fi.Bytes)return s.push(this.readBoolean());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Fi.Bytes)return s.push(this.readFloat());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Fi.Bytes)return s.push(this.readDouble());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Fi.Bytes)return s.push(this.readFixed32());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Fi.Bytes)return s.push(this.readSFixed32());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Fi.Bytes)return s.push(this.readFixed64());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Fi.Bytes)return s.push(this.readSFixed64());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Fi.Varint)for(;this.buf[this.pos++]>127;);else if(i===Fi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Fi.Fixed32)this.pos+=4;else{if(i!==Fi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var c=new Uint8Array(i);c.set(this.buf),this.buf=c,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Al(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Al(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Al(this.buf,-1&s,this.pos),Al(this.buf,Math.floor(s*Sm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Al(this.buf,-1&s,this.pos),Al(this.buf,Math.floor(s*Sm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,c){var f,g;if(i>=0?(f=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(v,w,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)}(f,0,c),function(v,w){var T=(7&v)<<4;w.buf[w.pos++]|=T|((v>>>=3)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v)))))}(g,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,g,v){for(var w,T,I=0;I<g.length;I++){if((w=g.charCodeAt(I))>55295&&w<57344){if(!T){w>56319||I+1===g.length?(f[v++]=239,f[v++]=191,f[v++]=189):T=w;continue}if(w<56320){f[v++]=239,f[v++]=191,f[v++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(f[v++]=239,f[v++]=191,f[v++]=189,T=null);w<128?f[v++]=w:(w<2048?f[v++]=w>>6|192:(w<65536?f[v++]=w>>12|224:(f[v++]=w>>18|240,f[v++]=w>>12&63|128),f[v++]=w>>6&63|128),f[v++]=63&w|128)}return v}(this.buf,s,this.pos);var c=this.pos-i;c>=128&&Em(i,c,this),this.pos=i-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),km(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),km(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var c=0;c<i;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,i){this.pos++;var c=this.pos;s(i,this);var f=this.pos-c;f>=128&&Em(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,c){this.writeTag(s,Fi.Bytes),this.writeRawMessage(i,c)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,eb,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,tb,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,rb,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,ib,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,nb,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,ob,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,sb,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,ab,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,lb,i)},writeBytesField:function(s,i){this.writeTag(s,Fi.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Fi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Fi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Fi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Fi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Fi.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Fi.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Fi.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Fi.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Fi.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var gf=_(wm);const _f=3;function cb(s,i,c){s===1&&c.readMessage(ub,i)}function ub(s,i,c){if(s===3){const{id:f,bitmap:g,width:v,height:w,left:T,top:I,advance:P}=c.readMessage(hb,{});i.push({id:f,bitmap:new Zc({width:v+2*_f,height:w+2*_f},g),metrics:{width:v,height:w,left:T,top:I,advance:P}})}}function hb(s,i,c){s===1?i.id=c.readVarint():s===2?i.bitmap=c.readBytes():s===3?i.width=c.readVarint():s===4?i.height=c.readVarint():s===5?i.left=c.readSVarint():s===6?i.top=c.readSVarint():s===7&&(i.advance=c.readVarint())}const Mm=_f;function Im(s){let i=0,c=0;for(const w of s)i+=w.w*w.h,c=Math.max(c,w.w);s.sort((w,T)=>T.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),c),h:1/0}];let g=0,v=0;for(const w of s)for(let T=f.length-1;T>=0;T--){const I=f[T];if(!(w.w>I.w||w.h>I.h)){if(w.x=I.x,w.y=I.y,v=Math.max(v,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===I.w&&w.h===I.h){const P=f.pop();T<f.length&&(f[T]=P)}else w.h===I.h?(I.x+=w.w,I.w-=w.w):w.w===I.w?(I.y+=w.h,I.h-=w.h):(f.push({x:I.x+w.w,y:I.y,w:I.w-w.w,h:w.h}),I.y+=w.h,I.h-=w.h);break}}return{w:g,h:v,fill:i/(g*v)||0}}const Fr=1;class yf{constructor(i,{pixelRatio:c,version:f,stretchX:g,stretchY:v,content:w}){this.paddedRect=i,this.pixelRatio=c,this.stretchX=g,this.stretchY=v,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+Fr,this.paddedRect.y+Fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fr,this.paddedRect.y+this.paddedRect.h-Fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Fr)/this.pixelRatio,(this.paddedRect.h-2*Fr)/this.pixelRatio]}}class Lm{constructor(i,c){const f={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(i,f,v),this.addImages(c,g,v);const{w,h:T}=Im(v),I=new oo({width:w||1,height:T||1});for(const P in i){const O=i[P],j=f[P].paddedRect;oo.copy(O.data,I,{x:0,y:0},{x:j.x+Fr,y:j.y+Fr},O.data)}for(const P in c){const O=c[P],j=g[P].paddedRect,$=j.x+Fr,K=j.y+Fr,Y=O.data.width,ae=O.data.height;oo.copy(O.data,I,{x:0,y:0},{x:$,y:K},O.data),oo.copy(O.data,I,{x:0,y:ae-1},{x:$,y:K-1},{width:Y,height:1}),oo.copy(O.data,I,{x:0,y:0},{x:$,y:K+ae},{width:Y,height:1}),oo.copy(O.data,I,{x:Y-1,y:0},{x:$-1,y:K},{width:1,height:ae}),oo.copy(O.data,I,{x:0,y:0},{x:$+Y,y:K},{width:1,height:ae})}this.image=I,this.iconPositions=f,this.patternPositions=g}addImages(i,c,f){for(const g in i){const v=i[g],w={x:0,y:0,w:v.data.width+2*Fr,h:v.data.height+2*Fr};f.push(w),c[g]=new yf(w,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,c){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),c)}patchUpdatedImage(i,c,f){if(!i||!c||i.version===c.version)return;i.version=c.version;const[g,v]=i.tl;f.update(c.data,void 0,{x:g,y:v})}}var Gs;Lt("ImagePosition",yf),Lt("ImageAtlas",Lm),d.ah=void 0,(Gs=d.ah||(d.ah={}))[Gs.none=0]="none",Gs[Gs.horizontal=1]="horizontal",Gs[Gs.vertical=2]="vertical",Gs[Gs.horizontalOnly=3]="horizontalOnly";const Yc=-17;class Qc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,c){const f=new Qc;return f.scale=i||1,f.fontStack=c,f}static forImage(i){const c=new Qc;return c.imageName=i,c}}class Pl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,c){const f=new Pl;for(let g=0;g<i.sections.length;g++){const v=i.sections[g];v.image?f.addImageSection(v):f.addTextSection(v,c)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let c="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,v=i.charCodeAt(f-1)||null;c+=g&&Ec(g)&&!Jc[i[f+1]]||v&&Ec(v)&&!Jc[i[f-1]]||!Jc[i[f]]?i[f]:Jc[i[f]]}return c}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&Vh[this.text.charCodeAt(f)];f++)i++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Vh[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(i,c),this.sectionIndex=this.sectionIndex.slice(i,c)}substring(i,c){const f=new Pl;return f.text=this.text.substring(i,c),f.sectionIndex=this.sectionIndex.slice(i,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,c)=>Math.max(i,this.sections[c].scale),0)}addTextSection(i,c){this.text+=i.text,this.sections.push(Qc.forText(i.scale,i.fontStack||c));const f=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(f)}addImageSection(i){const c=i.image?i.image.name:"";if(c.length===0)return void Ke("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Qc.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Uh(s,i,c,f,g,v,w,T,I,P,O,j,$,K,Y,ae){const ge=Pl.fromFeature(s,g);let xe;j===d.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Fe,processStyledBidirectionalText:Se}=$o;if(Fe&&ge.sections.length===1){xe=[];const tt=Fe(ge.toString(),bf(ge,P,v,i,f,K,Y));for(const Ct of tt){const Bt=new Pl;Bt.text=Ct,Bt.sections=ge.sections;for(let Tt=0;Tt<Ct.length;Tt++)Bt.sectionIndex.push(0);xe.push(Bt)}}else if(Se){xe=[];const tt=Se(ge.text,ge.sectionIndex,bf(ge,P,v,i,f,K,Y));for(const Ct of tt){const Bt=new Pl;Bt.text=Ct[0],Bt.sectionIndex=Ct[1],Bt.sections=ge.sections,xe.push(Bt)}}else xe=function(tt,Ct){const Bt=[],Tt=tt.text;let wt=0;for(const mt of Ct)Bt.push(tt.substring(wt,mt)),wt=mt;return wt<Tt.length&&Bt.push(tt.substring(wt,Tt.length)),Bt}(ge,bf(ge,P,v,i,f,K,Y));const ze=[],Ye={positionedLines:ze,text:ge.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(tt,Ct,Bt,Tt,wt,mt,zt,bt,at,Wt,Nt,mi){let Hi=0,tn=Yc,Vn=0,Jr=0;const Sr=bt==="right"?1:bt==="left"?0:.5;let zn=0;for(const qn of wt){qn.trim();const Zn=qn.getMaxScale(),fr=(Zn-1)*Un,Cr={positionedGlyphs:[],lineOffset:0};tt.positionedLines[zn]=Cr;const pr=Cr.positionedGlyphs;let Or=0;if(!qn.length()){tn+=mt,++zn;continue}for(let Gn=0;Gn<qn.length();Gn++){const vi=qn.getSection(Gn),mr=qn.getSectionIndex(Gn),ar=qn.getCharCode(Gn);let Wn=0,wo=null,zo=null,Do=null,ms=Un;const xo=!(at===d.ah.horizontal||!Nt&&!fl(ar)||Nt&&(Vh[ar]||(Qn=ar,St.Arabic(Qn)||St["Arabic Supplement"](Qn)||St["Arabic Extended-A"](Qn)||St["Arabic Presentation Forms-A"](Qn)||St["Arabic Presentation Forms-B"](Qn))));if(vi.imageName){const ao=Tt[vi.imageName];if(!ao)continue;Do=vi.imageName,tt.iconsInText=tt.iconsInText||!0,zo=ao.paddedRect;const jr=ao.displaySize;vi.scale=vi.scale*Un/mi,wo={width:jr[0],height:jr[1],left:Fr,top:-Mm,advance:xo?jr[1]:jr[0]},Wn=fr+(Un-jr[1]*vi.scale),ms=wo.advance;const gs=xo?jr[0]*vi.scale-Un*Zn:jr[1]*vi.scale-Un*Zn;gs>0&&gs>Or&&(Or=gs)}else{const ao=Bt[vi.fontStack],jr=ao&&ao[ar];if(jr&&jr.rect)zo=jr.rect,wo=jr.metrics;else{const gs=Ct[vi.fontStack],ru=gs&&gs[ar];if(!ru)continue;wo=ru.metrics}Wn=(Zn-vi.scale)*Un}xo?(tt.verticalizable=!0,pr.push({glyph:ar,imageName:Do,x:Hi,y:tn+Wn,vertical:xo,scale:vi.scale,fontStack:vi.fontStack,sectionIndex:mr,metrics:wo,rect:zo}),Hi+=ms*vi.scale+Wt):(pr.push({glyph:ar,imageName:Do,x:Hi,y:tn+Wn,vertical:xo,scale:vi.scale,fontStack:vi.fontStack,sectionIndex:mr,metrics:wo,rect:zo}),Hi+=wo.advance*vi.scale+Wt)}pr.length!==0&&(Vn=Math.max(Hi-Wt,Vn),pb(pr,0,pr.length-1,Sr,Or)),Hi=0;const Nr=mt*Zn+Or;Cr.lineOffset=Math.max(Or,fr),tn+=Nr,Jr=Math.max(Nr,Jr),++zn}var Qn;const sr=tn-Yc,{horizontalAlign:Tr,verticalAlign:Er}=vf(zt);(function(qn,Zn,fr,Cr,pr,Or,Nr,Gn,vi){const mr=(Zn-fr)*pr;let ar=0;ar=Or!==Nr?-Gn*Cr-Yc:(-Cr*vi+.5)*Nr;for(const Wn of qn)for(const wo of Wn.positionedGlyphs)wo.x+=mr,wo.y+=ar})(tt.positionedLines,Sr,Tr,Er,Vn,Jr,mt,sr,wt.length),tt.top+=-Er*sr,tt.bottom=tt.top+sr,tt.left+=-Tr*Vn,tt.right=tt.left+Vn}(Ye,i,c,f,xe,w,T,I,j,P,$,ae),!function(tt){for(const Ct of tt)if(Ct.positionedGlyphs.length!==0)return!1;return!0}(ze)&&Ye}const Vh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},db={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Am(s,i,c,f,g,v){if(i.imageName){const w=f[i.imageName];return w?w.displaySize[0]*i.scale*Un/v+g:0}{const w=c[i.fontStack],T=w&&w[s];return T?T.metrics.advance*i.scale+g:0}}function Pm(s,i,c,f){const g=Math.pow(s-i,2);return f?s<i?g/2:2*g:g+Math.abs(c)*c}function fb(s,i,c){let f=0;return s===10&&(f-=1e4),c&&(f+=150),s!==40&&s!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function zm(s,i,c,f,g,v){let w=null,T=Pm(i,c,g,v);for(const I of f){const P=Pm(i-I.x,c,g,v)+I.badness;P<=T&&(w=I,T=P)}return{index:s,x:i,priorBreak:w,badness:T}}function Dm(s){return s?Dm(s.priorBreak).concat(s.index):[]}function bf(s,i,c,f,g,v,w){if(v!=="point")return[];if(!s)return[];const T=[],I=function($,K,Y,ae,ge,xe){let Fe=0;for(let Se=0;Se<$.length();Se++){const ze=$.getSection(Se);Fe+=Am($.getCharCode(Se),ze,ae,ge,K,xe)}return Fe/Math.max(1,Math.ceil(Fe/Y))}(s,i,c,f,g,w),P=s.text.indexOf("​")>=0;let O=0;for(let $=0;$<s.length();$++){const K=s.getSection($),Y=s.getCharCode($);if(Vh[Y]||(O+=Am(Y,K,f,g,i,w)),$<s.length()-1){const ae=!((j=Y)<11904||!(St["Bopomofo Extended"](j)||St.Bopomofo(j)||St["CJK Compatibility Forms"](j)||St["CJK Compatibility Ideographs"](j)||St["CJK Compatibility"](j)||St["CJK Radicals Supplement"](j)||St["CJK Strokes"](j)||St["CJK Symbols and Punctuation"](j)||St["CJK Unified Ideographs Extension A"](j)||St["CJK Unified Ideographs"](j)||St["Enclosed CJK Letters and Months"](j)||St["Halfwidth and Fullwidth Forms"](j)||St.Hiragana(j)||St["Ideographic Description Characters"](j)||St["Kangxi Radicals"](j)||St["Katakana Phonetic Extensions"](j)||St.Katakana(j)||St["Vertical Forms"](j)||St["Yi Radicals"](j)||St["Yi Syllables"](j)));(db[Y]||ae||K.imageName)&&T.push(zm($+1,O,I,T,fb(Y,s.getCharCode($+1),ae&&P),!1))}}var j;return Dm(zm(s.length(),O,I,T,0,!0))}function vf(s){let i=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:i,verticalAlign:c}}function pb(s,i,c,f,g){if(!f&&!g)return;const v=s[c],w=(s[c].x+v.metrics.advance*v.scale)*f;for(let T=i;T<=c;T++)s[T].x-=w,s[T].y+=g}function mb(s,i,c){const{horizontalAlign:f,verticalAlign:g}=vf(c),v=i[0]-s.displaySize[0]*f,w=i[1]-s.displaySize[1]*g;return{image:s,top:w,bottom:w+s.displaySize[1],left:v,right:v+s.displaySize[0]}}function Rm(s,i,c,f,g,v){const w=s.image;let T;if(w.content){const ge=w.content,xe=w.pixelRatio||1;T=[ge[0]/xe,ge[1]/xe,w.displaySize[0]-ge[2]/xe,w.displaySize[1]-ge[3]/xe]}const I=i.left*v,P=i.right*v;let O,j,$,K;c==="width"||c==="both"?(K=g[0]+I-f[3],j=g[0]+P+f[1]):(K=g[0]+(I+P-w.displaySize[0])/2,j=K+w.displaySize[0]);const Y=i.top*v,ae=i.bottom*v;return c==="height"||c==="both"?(O=g[1]+Y-f[0],$=g[1]+ae+f[2]):(O=g[1]+(Y+ae-w.displaySize[1])/2,$=O+w.displaySize[1]),{image:w,top:O,right:j,bottom:$,left:K,collisionPadding:T}}const eu=255,Jo=128,Ws=eu*Jo;function Bm(s,i){const{expression:c}=i;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Qi(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=c;let v=0;for(;v<f.length&&f[v]<=s;)v++;v=Math.max(0,v-1);let w=v;for(;w<f.length&&f[w]<s+1;)w++;w=Math.min(f.length-1,w);const T=f[v],I=f[w];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:I,minSize:c.evaluate(new Qi(T)),maxSize:c.evaluate(new Qi(I)),interpolationType:g}}}function wf(s,i,c){let f="never";const g=s.get(i);return g?f=g:s.get(c)&&(f="always"),f}const gb=Zs.VectorTileFeature.types,_b=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qh(s,i,c,f,g,v,w,T,I,P,O,j,$){const K=T?Math.min(Ws,Math.round(T[0])):0,Y=T?Math.min(Ws,Math.round(T[1])):0;s.emplaceBack(i,c,Math.round(32*f),Math.round(32*g),v,w,(K<<1)+(I?1:0),Y,16*P,16*O,256*j,256*$)}function xf(s,i,c){s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c)}function yb(s){for(const i of s.sections)if(Yd(i.text))return!0;return!1}class kf{constructor(i){this.layoutVertexArray=new Ze,this.indexArray=new Xe,this.programConfigurations=i,this.segments=new _t,this.dynamicLayoutVertexArray=new ve,this.opacityVertexArray=new De,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,c,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,X1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,K1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,_b,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Lt("SymbolBuffers",kf);class Sf{constructor(i,c,f){this.layoutVertexArray=new i,this.layoutAttributes=c,this.indexArray=new f,this.segments=new _t,this.collisionVertexArray=new He}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,J1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Lt("CollisionBuffers",Sf);class zl{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(w=>w.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ef([]),this.placementViewportMatrix=ef([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bm(this.zoom,c["text-size"]),this.iconSizeData=Bm(this.zoom,c["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=wf(f,"text-overlap","text-allow-overlap")!=="never"||wf(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>d.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=i.sourceID}createArrays(){this.text=new kf(new sn(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new kf(new sn(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new b,this.lineVertexArray=new E,this.symbolInstances=new m,this.textAnchorOffsets=new A}calculateGlyphDependencies(i,c,f,g,v){for(let w=0;w<i.length;w++)if(c[i.charCodeAt(w)]=!0,(f||g)&&v){const T=Jc[i.charAt(w)];T&&(c[T.charCodeAt(0)]=!0)}}populate(i,c,f){const g=this.layers[0],v=g.layout,w=v.get("text-font"),T=v.get("text-field"),I=v.get("icon-image"),P=(T.value.kind!=="constant"||T.value.value instanceof Pr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,j=v.get("symbol-sort-key");if(this.features=[],!P&&!O)return;const $=c.iconDependencies,K=c.glyphDependencies,Y=c.availableImages,ae=new Qi(this.zoom);for(const{feature:ge,id:xe,index:Fe,sourceLayerIndex:Se}of i){const ze=g._featureFilter.needGeometry,Ye=fs(ge,ze);if(!g._featureFilter.filter(ae,Ye,f))continue;let tt,Ct;if(ze||(Ye.geometry=ds(ge)),P){const Tt=g.getValueAndResolveTokens("text-field",Ye,f,Y),wt=Pr.factory(Tt),mt=this.hasRTLText=this.hasRTLText||yb(wt);(!mt||$o.getRTLTextPluginStatus()==="unavailable"||mt&&$o.isParsed())&&(tt=Q1(wt,g,Ye))}if(O){const Tt=g.getValueAndResolveTokens("icon-image",Ye,f,Y);Ct=Tt instanceof Hr?Tt:Hr.fromString(Tt)}if(!tt&&!Ct)continue;const Bt=this.sortFeaturesByKey?j.evaluate(Ye,{},f):void 0;if(this.features.push({id:xe,text:tt,icon:Ct,index:Fe,sourceLayerIndex:Se,geometry:Ye.geometry,properties:ge.properties,type:gb[ge.type],sortKey:Bt}),Ct&&($[Ct.name]=!0),tt){const Tt=w.evaluate(Ye,{},f).join(","),wt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const mt of tt.sections)if(mt.image)$[mt.image.name]=!0;else{const zt=Vs(tt.toString()),bt=mt.fontStack||Tt,at=K[bt]=K[bt]||{};this.calculateGlyphDependencies(mt.text,at,wt,this.allowVerticalPlacement,zt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ge){const xe={},Fe={},Se=[];let ze=0;function Ye(Tt){Se.push(ge[Tt]),ze++}function tt(Tt,wt,mt){const zt=Fe[Tt];return delete Fe[Tt],Fe[wt]=zt,Se[zt].geometry[0].pop(),Se[zt].geometry[0]=Se[zt].geometry[0].concat(mt[0]),zt}function Ct(Tt,wt,mt){const zt=xe[wt];return delete xe[wt],xe[Tt]=zt,Se[zt].geometry[0].shift(),Se[zt].geometry[0]=mt[0].concat(Se[zt].geometry[0]),zt}function Bt(Tt,wt,mt){const zt=mt?wt[0][wt[0].length-1]:wt[0][0];return`${Tt}:${zt.x}:${zt.y}`}for(let Tt=0;Tt<ge.length;Tt++){const wt=ge[Tt],mt=wt.geometry,zt=wt.text?wt.text.toString():null;if(!zt){Ye(Tt);continue}const bt=Bt(zt,mt),at=Bt(zt,mt,!0);if(bt in Fe&&at in xe&&Fe[bt]!==xe[at]){const Wt=Ct(bt,at,mt),Nt=tt(bt,at,Se[Wt].geometry);delete xe[bt],delete Fe[at],Fe[Bt(zt,Se[Nt].geometry,!0)]=Nt,Se[Wt].geometry=null}else bt in Fe?tt(bt,at,mt):at in xe?Ct(bt,at,mt):(Ye(Tt),xe[bt]=ze-1,Fe[at]=ze-1)}return Se.filter(Tt=>Tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,xe)=>ge.sortKey-xe.sortKey)}update(i,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,c){const f=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(c[i.segment+1]),v=i.dist(c[i.segment]);const w={};for(let T=i.segment+1;T<c.length;T++)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=i.segment||0;T>=0;T--)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:v},T>0&&(v+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const I=w[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,c,f,g,v,w,T,I,P,O,j,$){const K=i.indexArray,Y=i.layoutVertexArray,ae=i.segments.prepareSegment(4*c.length,Y,K,this.canOverlap?w.sortKey:void 0),ge=this.glyphOffsetArray.length,xe=ae.vertexLength,Fe=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,Se=w.text&&w.text.sections;for(let ze=0;ze<c.length;ze++){const{tl:Ye,tr:tt,bl:Ct,br:Bt,tex:Tt,pixelOffsetTL:wt,pixelOffsetBR:mt,minFontScaleX:zt,minFontScaleY:bt,glyphOffset:at,isSDF:Wt,sectionIndex:Nt}=c[ze],mi=ae.vertexLength,Hi=at[1];qh(Y,I.x,I.y,Ye.x,Hi+Ye.y,Tt.x,Tt.y,f,Wt,wt.x,wt.y,zt,bt),qh(Y,I.x,I.y,tt.x,Hi+tt.y,Tt.x+Tt.w,Tt.y,f,Wt,mt.x,wt.y,zt,bt),qh(Y,I.x,I.y,Ct.x,Hi+Ct.y,Tt.x,Tt.y+Tt.h,f,Wt,wt.x,mt.y,zt,bt),qh(Y,I.x,I.y,Bt.x,Hi+Bt.y,Tt.x+Tt.w,Tt.y+Tt.h,f,Wt,mt.x,mt.y,zt,bt),xf(i.dynamicLayoutVertexArray,I,Fe),K.emplaceBack(mi,mi+1,mi+2),K.emplaceBack(mi+1,mi+2,mi+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),ze!==c.length-1&&Nt===c[ze+1].sectionIndex||i.programConfigurations.populatePaintArrays(Y.length,w,w.index,{},$,Se&&Se[Nt])}i.placedSymbolArray.emplaceBack(I.x,I.y,ge,this.glyphOffsetArray.length-ge,xe,P,O,I.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,j)}_addCollisionDebugVertex(i,c,f,g,v,w){return c.emplaceBack(0,0),i.emplaceBack(f.x,f.y,g,v,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(i,c,f,g,v,w,T){const I=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),P=I.vertexLength,O=v.layoutVertexArray,j=v.collisionVertexArray,$=T.anchorX,K=T.anchorY;this._addCollisionDebugVertex(O,j,w,$,K,new k(i,c)),this._addCollisionDebugVertex(O,j,w,$,K,new k(f,c)),this._addCollisionDebugVertex(O,j,w,$,K,new k(f,g)),this._addCollisionDebugVertex(O,j,w,$,K,new k(i,g)),I.vertexLength+=4;const Y=v.indexArray;Y.emplaceBack(P,P+1),Y.emplaceBack(P+1,P+2),Y.emplaceBack(P+2,P+3),Y.emplaceBack(P+3,P),I.primitiveLength+=4}addDebugCollisionBoxes(i,c,f,g){for(let v=i;v<c;v++){const w=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,g?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sf(We,vm.members,nt),this.iconCollisionBox=new Sf(We,vm.members,nt);for(let i=0;i<this.symbolInstances.length;i++){const c=this.symbolInstances.get(i);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(i,c,f,g,v,w,T,I,P){const O={};for(let j=c;j<f;j++){const $=i.get(j);O.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.textFeatureIndex=$.featureIndex;break}for(let j=g;j<v;j++){const $=i.get(j);O.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.verticalTextFeatureIndex=$.featureIndex;break}for(let j=w;j<T;j++){const $=i.get(j);O.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.iconFeatureIndex=$.featureIndex;break}for(let j=I;j<P;j++){const $=i.get(j);O.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},O.verticalIconFeatureIndex=$.featureIndex;break}return O}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,c){const f=i.placedSymbolArray.get(c),g=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<g;v+=4)i.indexArray.emplaceBack(v,v+1,v+2),i.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(i),f=Math.cos(i),g=[],v=[],w=[];for(let T=0;T<this.symbolInstances.length;++T){w.push(T);const I=this.symbolInstances.get(T);g.push(0|Math.round(c*I.anchorX+f*I.anchorY)),v.push(I.featureIndex)}return w.sort((T,I)=>g[T]-g[I]||v[I]-v[T]),w}addToSortKeyRanges(i,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,v,w)=>{g>=0&&w.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Fm,Om;Lt("SymbolBucket",zl,{omit:["layers","collisionBoxArray","features","compareText"]}),zl.MAX_GLYPHS=65535,zl.addDynamicAttributes=xf;var Tf={get paint(){return Om=Om||new xr({"icon-opacity":new $t(we.paint_symbol["icon-opacity"]),"icon-color":new $t(we.paint_symbol["icon-color"]),"icon-halo-color":new $t(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(we.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new $t(we.paint_symbol["text-opacity"]),"text-color":new $t(we.paint_symbol["text-color"],{runtimeType:Zi,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new $t(we.paint_symbol["text-halo-color"]),"text-halo-width":new $t(we.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(we.paint_symbol["text-halo-blur"]),"text-translate":new jt(we.paint_symbol["text-translate"]),"text-translate-anchor":new jt(we.paint_symbol["text-translate-anchor"])})},get layout(){return Fm=Fm||new xr({"symbol-placement":new jt(we.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(we.layout_symbol["icon-size"]),"icon-text-fit":new jt(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(we.layout_symbol["icon-image"]),"icon-rotate":new $t(we.layout_symbol["icon-rotate"]),"icon-padding":new $t(we.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(we.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(we.layout_symbol["icon-offset"]),"icon-anchor":new $t(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(we.layout_symbol["text-rotation-alignment"]),"text-field":new $t(we.layout_symbol["text-field"]),"text-font":new $t(we.layout_symbol["text-font"]),"text-size":new $t(we.layout_symbol["text-size"]),"text-max-width":new $t(we.layout_symbol["text-max-width"]),"text-line-height":new jt(we.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(we.layout_symbol["text-letter-spacing"]),"text-justify":new $t(we.layout_symbol["text-justify"]),"text-radial-offset":new $t(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new $t(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new $t(we.layout_symbol["text-anchor"]),"text-max-angle":new jt(we.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(we.layout_symbol["text-writing-mode"]),"text-rotate":new $t(we.layout_symbol["text-rotate"]),"text-padding":new jt(we.layout_symbol["text-padding"]),"text-keep-upright":new jt(we.layout_symbol["text-keep-upright"]),"text-transform":new $t(we.layout_symbol["text-transform"]),"text-offset":new $t(we.layout_symbol["text-offset"]),"text-allow-overlap":new jt(we.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(we.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(we.layout_symbol["text-ignore-placement"]),"text-optional":new jt(we.layout_symbol["text-optional"])})}};class Nm{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:qi,this.defaultValue=i}evaluate(i){if(i.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(i.formattedSection))return c.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt("FormatSectionOverride",Nm,{omit:["defaultValue"]});class Zh extends ro{constructor(i){super(i,Tf)}recalculate(i,c){if(super.recalculate(i,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const v of f)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,c,f,g){const v=this.layout.get(i).evaluate(c,{},f,g),w=this._unevaluatedLayout._values[i];return w.isDataDriven()||Gi(w.value)||!v?v:function(T,I){return I.replace(/{([^{}]+)}/g,(P,O)=>T&&O in T?String(T[O]):"")}(c.properties,v)}createBucket(i){return new zl(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Tf.paint.overridableProperties){if(!Zh.hasPaintOverride(this.layout,i))continue;const c=this.paint.get(i),f=new Nm(c),g=new $i(f,c.property.specification);let v=null;v=c.value.kind==="constant"||c.value.kind==="source"?new il("source",g):new _c("composite",g,c.value.zoomStops),this.paint._values[i]=new no(c.property,v,c.parameters)}}_handleOverridablePaintPropertyUpdate(i,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&Zh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,c){const f=i.get("text-field"),g=Tf.paint.properties[c];let v=!1;const w=T=>{for(const I of T)if(g.overrides&&g.overrides.hasOverride(I))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Pr)w(f.value.value.sections);else if(f.value.kind==="source"){const T=P=>{v||(P instanceof Vo&&In(P.value)===cn?w(P.value.sections):P instanceof el?w(P.sections):P.eachChild(T))},I=f.value;I._styleExpression&&T(I._styleExpression.expression)}return v}}let jm;var bb={get paint(){return jm=jm||new xr({"background-color":new jt(we.paint_background["background-color"]),"background-pattern":new ka(we.paint_background["background-pattern"]),"background-opacity":new jt(we.paint_background["background-opacity"])})}};class vb extends ro{constructor(i){super(i,bb)}}let Um;var wb={get paint(){return Um=Um||new xr({"raster-opacity":new jt(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(we.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(we.paint_raster["raster-saturation"]),"raster-contrast":new jt(we.paint_raster["raster-contrast"]),"raster-resampling":new jt(we.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(we.paint_raster["raster-fade-duration"])})}};class xb extends ro{constructor(i){super(i,wb)}}class kb extends ro{constructor(i){super(i,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Sb{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Ef=63710088e-1;class $s{constructor(i,c){if(isNaN(i)||isNaN(c))throw new Error(`Invalid LngLat object: (${i}, ${c})`);if(this.lng=+i,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $s(oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const c=Math.PI/180,f=this.lat*c,g=i.lat*c,v=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((i.lng-this.lng)*c);return Ef*Math.acos(Math.min(v,1))}static convert(i){if(i instanceof $s)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new $s(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new $s(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Vm=2*Math.PI*Ef;function qm(s){return Vm*Math.cos(s*Math.PI/180)}function Zm(s){return(180+s)/360}function Gm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Wm(s,i){return s/qm(i)}function Cf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Gh{constructor(i,c,f=0){this.x=+i,this.y=+c,this.z=+f}static fromLngLat(i,c=0){const f=$s.convert(i);return new Gh(Zm(f.lng),Gm(f.lat),Wm(c,f.lat))}toLngLat(){return new $s(360*this.x-180,Cf(this.y))}toAltitude(){return this.z*qm(Cf(this.y))}meterInMercatorCoordinateUnits(){return 1/Vm*(i=Cf(this.y),1/Math.cos(i*Math.PI/180));var i}}function $m(s,i,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Mf{constructor(i,c,f){if(i<0||i>25||f<0||f>=Math.pow(2,i)||c<0||c>=Math.pow(2,i))throw new Error(`x=${c}, y=${f}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=c,this.y=f,this.key=tu(0,i,i,c,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,c,f){const g=(w=this.y,T=this.z,I=$m(256*(v=this.x),256*(w=Math.pow(2,T)-w-1),T),P=$m(256*(v+1),256*(w+1),T),I[0]+","+I[1]+","+P[0]+","+P[1]);var v,w,T,I,P;const O=function(j,$,K){let Y,ae="";for(let ge=j;ge>0;ge--)Y=1<<ge-1,ae+=($&Y?1:0)+(K&Y?2:0);return ae}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const c=this.z-i.z;return c>0&&i.x===this.x>>c&&i.y===this.y>>c}getTilePoint(i){const c=Math.pow(2,this.z);return new k((i.x*c-this.x)*yn,(i.y*c-this.y)*yn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hm{constructor(i,c){this.wrap=i,this.canonical=c,this.key=tu(i,c.z,c.z,c.x,c.y)}}class so{constructor(i,c,f,g,v){if(i<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${f}`);this.overscaledZ=i,this.wrap=c,this.canonical=new Mf(f,+g,+v),this.key=tu(c,i,f,g,v)}clone(){return new so(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-i;return i>this.canonical.z?new so(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new so(i,this.wrap,i,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(i,c){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-i;return i>this.canonical.z?tu(this.wrap*+c,i,this.canonical.z,this.canonical.x,this.canonical.y):tu(this.wrap*+c,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const c=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>c&&i.canonical.y===this.canonical.y>>c}children(i){if(this.overscaledZ>=i)return[new so(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new so(c,this.wrap,c,f,g),new so(c,this.wrap,c,f+1,g),new so(c,this.wrap,c,f,g+1),new so(c,this.wrap,c,f+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new so(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new so(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Gh(i.x-this.wrap,i.y))}}function tu(s,i,c,f,g){(s*=2)<0&&(s=-1*s-1);const v=1<<c;return(v*v*s+v*g+f).toString(36)+c.toString(36)+i.toString(36)}Lt("CanonicalTileID",Mf),Lt("OverscaledTileID",so,{omit:["posMatrix"]});class Xm{constructor(i,c,f,g=1,v=1,w=1,T=0){if(this.uid=i,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ke(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const I=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=v,this.blueFactor=w,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<I;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(I,P)]=this.data[this._idx(I-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,I)]=this.data[this._idx(P,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<I;P++)for(let O=0;O<I;O++){const j=this.get(P,O);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(i,c){const f=new Uint8Array(this.data.buffer),g=4*this._idx(i,c);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,c){if(i<-1||i>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(i+1)}unpack(i,c,f){return i*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new oo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,c,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,v=c*this.dim+this.dim,w=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:g=v-1;break;case 1:v=g+1}switch(f){case-1:w=T-1;break;case 1:T=w+1}const I=-c*this.dim,P=-f*this.dim;for(let O=w;O<T;O++)for(let j=g;j<v;j++)this.data[this._idx(j,O)]=i.data[this._idx(j+I,O+P)]}}Lt("DEMData",Xm);class Km{constructor(i){this._stringToNumber={},this._numberToString=[];for(let c=0;c<i.length;c++){const f=i[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Jm{constructor(i,c,f,g,v){this.type="Feature",this._vectorTileFeature=i,i._z=c,i._x=f,i._y=g,this.properties=i.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(i[c]=this[c]);return i}}class Ym{constructor(i,c){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new va(yn,16,0),this.grid3D=new va(yn,16,0),this.featureIndexArray=new q,this.promoteId=c}insert(i,c,f,g,v,w){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,v);const I=w?this.grid3D:this.grid;for(let P=0;P<c.length;P++){const O=c[P],j=[1/0,1/0,-1/0,-1/0];for(let $=0;$<O.length;$++){const K=O[$];j[0]=Math.min(j[0],K.x),j[1]=Math.min(j[1],K.y),j[2]=Math.max(j[2],K.x),j[3]=Math.max(j[3],K.y)}j[0]<yn&&j[1]<yn&&j[2]>=0&&j[3]>=0&&I.insert(T,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Zs.VectorTile(new gf(this.rawTileData)).layers,this.sourceLayerCoder=new Km(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,c,f,g){this.loadVTLayers();const v=i.params||{},w=yn/i.tileSize/i.scale,T=sl(v.filter),I=i.queryGeometry,P=i.queryPadding*w,O=eg(I),j=this.grid.query(O.minX-P,O.minY-P,O.maxX+P,O.maxY+P),$=eg(i.cameraQueryGeometry),K=this.grid3D.query($.minX-P,$.minY-P,$.maxX+P,$.maxY+P,(ge,xe,Fe,Se)=>function(ze,Ye,tt,Ct,Bt){for(const wt of ze)if(Ye<=wt.x&&tt<=wt.y&&Ct>=wt.x&&Bt>=wt.y)return!0;const Tt=[new k(Ye,tt),new k(Ye,Bt),new k(Ct,Bt),new k(Ct,tt)];if(ze.length>2){for(const wt of Tt)if(El(ze,wt))return!0}for(let wt=0;wt<ze.length-1;wt++)if(i1(ze[wt],ze[wt+1],Tt))return!0;return!1}(i.cameraQueryGeometry,ge-P,xe-P,Fe+P,Se+P));for(const ge of K)j.push(ge);j.sort(Tb);const Y={};let ae;for(let ge=0;ge<j.length;ge++){const xe=j[ge];if(xe===ae)continue;ae=xe;const Fe=this.featureIndexArray.get(xe);let Se=null;this.loadMatchingFeature(Y,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,T,v.layers,v.availableImages,c,f,g,(ze,Ye,tt)=>(Se||(Se=ds(ze)),Ye.queryIntersectsFeature(I,ze,tt,Se,this.z,i.transform,w,i.pixelPosMatrix)))}return Y}loadMatchingFeature(i,c,f,g,v,w,T,I,P,O,j){const $=this.bucketLayerIDs[c];if(w&&!function(ge,xe){for(let Fe=0;Fe<ge.length;Fe++)if(xe.indexOf(ge[Fe])>=0)return!0;return!1}(w,$))return;const K=this.sourceLayerCoder.decode(f),Y=this.vtLayers[K].feature(g);if(v.needGeometry){const ge=fs(Y,!0);if(!v.filter(new Qi(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!v.filter(new Qi(this.tileID.overscaledZ),Y))return;const ae=this.getId(Y,K);for(let ge=0;ge<$.length;ge++){const xe=$[ge];if(w&&w.indexOf(xe)<0)continue;const Fe=I[xe];if(!Fe)continue;let Se={};ae&&O&&(Se=O.getState(Fe.sourceLayer||"_geojsonTileLayer",ae));const ze=H({},P[xe]);ze.paint=Qm(ze.paint,Fe.paint,Y,Se,T),ze.layout=Qm(ze.layout,Fe.layout,Y,Se,T);const Ye=!j||j(Y,Fe,Se);if(!Ye)continue;const tt=new Jm(Y,this.z,this.x,this.y,ae);tt.layer=ze;let Ct=i[xe];Ct===void 0&&(Ct=i[xe]=[]),Ct.push({featureIndex:g,feature:tt,intersectionZ:Ye})}}lookupSymbolFeatures(i,c,f,g,v,w,T,I){const P={};this.loadVTLayers();const O=sl(v);for(const j of i)this.loadMatchingFeature(P,f,g,j,O,w,T,I,c);return P}hasLayer(i){for(const c of this.bucketLayerIDs)for(const f of c)if(i===f)return!0;return!1}getId(i,c){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function Qm(s,i,c,f,g){return be(s,(v,w)=>{const T=i instanceof xa?i.get(w):null;return T&&T.evaluate?T.evaluate(c,f,g):T})}function eg(s){let i=1/0,c=1/0,f=-1/0,g=-1/0;for(const v of s)i=Math.min(i,v.x),c=Math.min(c,v.y),f=Math.max(f,v.x),g=Math.max(g,v.y);return{minX:i,minY:c,maxX:f,maxY:g}}function Tb(s,i){return i-s}function tg(s,i,c,f,g){const v=[];for(let w=0;w<s.length;w++){const T=s[w];let I;for(let P=0;P<T.length-1;P++){let O=T[P],j=T[P+1];O.x<i&&j.x<i||(O.x<i?O=new k(i,O.y+(i-O.x)/(j.x-O.x)*(j.y-O.y))._round():j.x<i&&(j=new k(i,O.y+(i-O.x)/(j.x-O.x)*(j.y-O.y))._round()),O.y<c&&j.y<c||(O.y<c?O=new k(O.x+(c-O.y)/(j.y-O.y)*(j.x-O.x),c)._round():j.y<c&&(j=new k(O.x+(c-O.y)/(j.y-O.y)*(j.x-O.x),c)._round()),O.x>=f&&j.x>=f||(O.x>=f?O=new k(f,O.y+(f-O.x)/(j.x-O.x)*(j.y-O.y))._round():j.x>=f&&(j=new k(f,O.y+(f-O.x)/(j.x-O.x)*(j.y-O.y))._round()),O.y>=g&&j.y>=g||(O.y>=g?O=new k(O.x+(g-O.y)/(j.y-O.y)*(j.x-O.x),g)._round():j.y>=g&&(j=new k(O.x+(g-O.y)/(j.y-O.y)*(j.x-O.x),g)._round()),I&&O.equals(I[I.length-1])||(I=[O],v.push(I)),I.push(j)))))}}return v}Lt("FeatureIndex",Ym,{omit:["rawTileData","sourceLayerCoder"]});class Hs extends k{constructor(i,c,f,g){super(i,c),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Hs(this.x,this.y,this.angle,this.segment)}}function ig(s,i,c,f,g){if(i.segment===void 0||c===0)return!0;let v=i,w=i.segment+1,T=0;for(;T>-c/2;){if(w--,w<0)return!1;T-=s[w].dist(v),v=s[w]}T+=s[w].dist(s[w+1]),w++;const I=[];let P=0;for(;T<c/2;){const O=s[w],j=s[w+1];if(!j)return!1;let $=s[w-1].angleTo(O)-O.angleTo(j);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:$}),P+=$;T-I[0].distance>f;)P-=I.shift().angleDelta;if(P>g)return!1;w++,T+=O.dist(j)}return!0}function ng(s){let i=0;for(let c=0;c<s.length-1;c++)i+=s[c].dist(s[c+1]);return i}function rg(s,i,c){return s?.6*i*c:0}function og(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function Eb(s,i,c,f,g,v){const w=rg(c,g,v),T=og(c,f)*v;let I=0;const P=ng(s)/2;for(let O=0;O<s.length-1;O++){const j=s[O],$=s[O+1],K=j.dist($);if(I+K>P){const Y=(P-I)/K,ae=hr.number(j.x,$.x,Y),ge=hr.number(j.y,$.y,Y),xe=new Hs(ae,ge,$.angleTo(j),O);return xe._round(),!w||ig(s,xe,T,w,i)?xe:void 0}I+=K}}function Cb(s,i,c,f,g,v,w,T,I){const P=rg(f,v,w),O=og(f,g),j=O*w,$=s[0].x===0||s[0].x===I||s[0].y===0||s[0].y===I;return i-j<i/4&&(i=j+i/4),sg(s,$?i/2*T%i:(O/2+2*v)*w*T%i,i,P,c,j,$,!1,I)}function sg(s,i,c,f,g,v,w,T,I){const P=v/2,O=ng(s);let j=0,$=i-c,K=[];for(let Y=0;Y<s.length-1;Y++){const ae=s[Y],ge=s[Y+1],xe=ae.dist(ge),Fe=ge.angleTo(ae);for(;$+c<j+xe;){$+=c;const Se=($-j)/xe,ze=hr.number(ae.x,ge.x,Se),Ye=hr.number(ae.y,ge.y,Se);if(ze>=0&&ze<I&&Ye>=0&&Ye<I&&$-P>=0&&$+P<=O){const tt=new Hs(ze,Ye,Fe,Y);tt._round(),f&&!ig(s,tt,v,f,g)||K.push(tt)}}j+=xe}return T||K.length||w||(K=sg(s,j/2,c,f,g,v,w,!0,I)),K}Lt("Anchor",Hs);const Dl=Fr;function ag(s,i,c,f){const g=[],v=s.image,w=v.pixelRatio,T=v.paddedRect.w-2*Dl,I=v.paddedRect.h-2*Dl,P=s.right-s.left,O=s.bottom-s.top,j=v.stretchX||[[0,T]],$=v.stretchY||[[0,I]],K=(mt,zt)=>mt+zt[1]-zt[0],Y=j.reduce(K,0),ae=$.reduce(K,0),ge=T-Y,xe=I-ae;let Fe=0,Se=Y,ze=0,Ye=ae,tt=0,Ct=ge,Bt=0,Tt=xe;if(v.content&&f){const mt=v.content;Fe=Wh(j,0,mt[0]),ze=Wh($,0,mt[1]),Se=Wh(j,mt[0],mt[2]),Ye=Wh($,mt[1],mt[3]),tt=mt[0]-Fe,Bt=mt[1]-ze,Ct=mt[2]-mt[0]-Se,Tt=mt[3]-mt[1]-Ye}const wt=(mt,zt,bt,at)=>{const Wt=$h(mt.stretch-Fe,Se,P,s.left),Nt=Hh(mt.fixed-tt,Ct,mt.stretch,Y),mi=$h(zt.stretch-ze,Ye,O,s.top),Hi=Hh(zt.fixed-Bt,Tt,zt.stretch,ae),tn=$h(bt.stretch-Fe,Se,P,s.left),Vn=Hh(bt.fixed-tt,Ct,bt.stretch,Y),Jr=$h(at.stretch-ze,Ye,O,s.top),Sr=Hh(at.fixed-Bt,Tt,at.stretch,ae),zn=new k(Wt,mi),Qn=new k(tn,mi),sr=new k(tn,Jr),Tr=new k(Wt,Jr),Er=new k(Nt/w,Hi/w),qn=new k(Vn/w,Sr/w),Zn=i*Math.PI/180;if(Zn){const pr=Math.sin(Zn),Or=Math.cos(Zn),Nr=[Or,-pr,pr,Or];zn._matMult(Nr),Qn._matMult(Nr),Tr._matMult(Nr),sr._matMult(Nr)}const fr=mt.stretch+mt.fixed,Cr=zt.stretch+zt.fixed;return{tl:zn,tr:Qn,bl:Tr,br:sr,tex:{x:v.paddedRect.x+Dl+fr,y:v.paddedRect.y+Dl+Cr,w:bt.stretch+bt.fixed-fr,h:at.stretch+at.fixed-Cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Er,pixelOffsetBR:qn,minFontScaleX:Ct/w/P,minFontScaleY:Tt/w/O,isSDF:c}};if(f&&(v.stretchX||v.stretchY)){const mt=lg(j,ge,Y),zt=lg($,xe,ae);for(let bt=0;bt<mt.length-1;bt++){const at=mt[bt],Wt=mt[bt+1];for(let Nt=0;Nt<zt.length-1;Nt++)g.push(wt(at,zt[Nt],Wt,zt[Nt+1]))}}else g.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return g}function Wh(s,i,c){let f=0;for(const g of s)f+=Math.max(i,Math.min(c,g[1]))-Math.max(i,Math.min(c,g[0]));return f}function lg(s,i,c){const f=[{fixed:-Dl,stretch:0}];for(const[g,v]of s){const w=f[f.length-1];f.push({fixed:g-w.stretch,stretch:w.stretch}),f.push({fixed:g-w.stretch,stretch:w.stretch+(v-g)})}return f.push({fixed:i+Dl,stretch:c}),f}function $h(s,i,c,f){return s/i*c+f}function Hh(s,i,c,f){return s-i*c/f}class Xh{constructor(i,c,f,g,v,w,T,I,P,O){if(this.boxStartIndex=i.length,P){let j=w.top,$=w.bottom;const K=w.collisionPadding;K&&(j-=K[1],$+=K[3]);let Y=$-j;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{let j=w.top*T-I[0],$=w.bottom*T+I[2],K=w.left*T-I[3],Y=w.right*T+I[1];const ae=w.collisionPadding;if(ae&&(K-=ae[0]*T,j-=ae[1]*T,Y+=ae[2]*T,$+=ae[3]*T),O){const ge=new k(K,j),xe=new k(Y,j),Fe=new k(K,$),Se=new k(Y,$),ze=O*Math.PI/180;ge._rotate(ze),xe._rotate(ze),Fe._rotate(ze),Se._rotate(ze),K=Math.min(ge.x,xe.x,Fe.x,Se.x),Y=Math.max(ge.x,xe.x,Fe.x,Se.x),j=Math.min(ge.y,xe.y,Fe.y,Se.y),$=Math.max(ge.y,xe.y,Fe.y,Se.y)}i.emplaceBack(c.x,c.y,K,j,Y,$,f,g,v)}this.boxEndIndex=i.length}}class Mb{constructor(i=[],c=Ib){if(this.data=i,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:c,compare:f}=this,g=c[i];for(;i>0;){const v=i-1>>1,w=c[v];if(f(g,w)>=0)break;c[i]=w,i=v}c[i]=g}_down(i){const{data:c,compare:f}=this,g=this.length>>1,v=c[i];for(;i<g;){let w=1+(i<<1),T=c[w];const I=w+1;if(I<this.length&&f(c[I],T)<0&&(w=I,T=c[I]),f(T,v)>=0)break;c[i]=T,i=w}c[i]=v}}function Ib(s,i){return s<i?-1:s>i?1:0}function Lb(s,i=1,c=!1){let f=1/0,g=1/0,v=-1/0,w=-1/0;const T=s[0];for(let K=0;K<T.length;K++){const Y=T[K];(!K||Y.x<f)&&(f=Y.x),(!K||Y.y<g)&&(g=Y.y),(!K||Y.x>v)&&(v=Y.x),(!K||Y.y>w)&&(w=Y.y)}const I=Math.min(v-f,w-g);let P=I/2;const O=new Mb([],Ab);if(I===0)return new k(f,g);for(let K=f;K<v;K+=I)for(let Y=g;Y<w;Y+=I)O.push(new Rl(K+P,Y+P,P,s));let j=function(K){let Y=0,ae=0,ge=0;const xe=K[0];for(let Fe=0,Se=xe.length,ze=Se-1;Fe<Se;ze=Fe++){const Ye=xe[Fe],tt=xe[ze],Ct=Ye.x*tt.y-tt.x*Ye.y;ae+=(Ye.x+tt.x)*Ct,ge+=(Ye.y+tt.y)*Ct,Y+=3*Ct}return new Rl(ae/Y,ge/Y,0,K)}(s),$=O.length;for(;O.length;){const K=O.pop();(K.d>j.d||!j.d)&&(j=K,c&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,$)),K.max-j.d<=i||(P=K.h/2,O.push(new Rl(K.p.x-P,K.p.y-P,P,s)),O.push(new Rl(K.p.x+P,K.p.y-P,P,s)),O.push(new Rl(K.p.x-P,K.p.y+P,P,s)),O.push(new Rl(K.p.x+P,K.p.y+P,P,s)),$+=4)}return c&&(console.log(`num probes: ${$}`),console.log(`best distance: ${j.d}`)),j.p}function Ab(s,i){return i.max-s.max}function Rl(s,i,c,f){this.p=new k(s,i),this.h=c,this.d=function(g,v){let w=!1,T=1/0;for(let I=0;I<v.length;I++){const P=v[I];for(let O=0,j=P.length,$=j-1;O<j;$=O++){const K=P[O],Y=P[$];K.y>g.y!=Y.y>g.y&&g.x<(Y.x-K.x)*(g.y-K.y)/(Y.y-K.y)+K.x&&(w=!w),T=Math.min(T,Gp(g,K,Y))}}return(w?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var or;d.ap=void 0,(or=d.ap||(d.ap={}))[or.center=1]="center",or[or.left=2]="left",or[or.right=3]="right",or[or.top=4]="top",or[or.bottom=5]="bottom",or[or["top-left"]=6]="top-left",or[or["top-right"]=7]="top-right",or[or["bottom-left"]=8]="bottom-left",or[or["bottom-right"]=9]="bottom-right";const Xs=7,If=Number.POSITIVE_INFINITY;function cg(s,i){return i[1]!==If?function(c,f,g){let v=0,w=0;switch(f=Math.abs(f),g=Math.abs(g),c){case"top-right":case"top-left":case"top":w=g-Xs;break;case"bottom-right":case"bottom-left":case"bottom":w=-g+Xs}switch(c){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,w]}(s,i[0],i[1]):function(c,f){let g=0,v=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(c){case"top-right":case"top-left":v=w-Xs;break;case"bottom-right":case"bottom-left":v=-w+Xs;break;case"bottom":v=-f+Xs;break;case"top":v=f-Xs}switch(c){case"top-right":case"bottom-right":g=-w;break;case"top-left":case"bottom-left":g=w;break;case"left":g=f;break;case"right":g=-f}return[g,v]}(s,i[0])}function ug(s,i,c){var f;const g=s.layout,v=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(i,{},c);if(v){const T=v.values,I=[];for(let P=0;P<T.length;P+=2){const O=I[P]=T[P],j=T[P+1].map($=>$*Un);O.startsWith("top")?j[1]-=Xs:O.startsWith("bottom")&&(j[1]+=Xs),I[P+1]=j}return new $r(I)}const w=g.get("text-variable-anchor");if(w){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},c)*Un,If]:g.get("text-offset").evaluate(i,{},c).map(P=>P*Un);const I=[];for(const P of w)I.push(P,cg(P,T));return new $r(I)}return null}function Lf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pb(s,i,c,f,g,v,w,T,I,P,O){let j=v.textMaxSize.evaluate(i,{});j===void 0&&(j=w);const $=s.layers[0].layout,K=$.get("icon-offset").evaluate(i,{},O),Y=dg(c.horizontal),ae=w/24,ge=s.tilePixelRatio*ae,xe=s.tilePixelRatio*j/24,Fe=s.tilePixelRatio*T,Se=s.tilePixelRatio*$.get("symbol-spacing"),ze=$.get("text-padding")*s.tilePixelRatio,Ye=function(at,Wt,Nt,mi=1){const Hi=at.get("icon-padding").evaluate(Wt,{},Nt),tn=Hi&&Hi.values;return[tn[0]*mi,tn[1]*mi,tn[2]*mi,tn[3]*mi]}($,i,O,s.tilePixelRatio),tt=$.get("text-max-angle")/180*Math.PI,Ct=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",Bt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Tt=$.get("symbol-placement"),wt=Se/2,mt=$.get("icon-text-fit");let zt;f&&mt!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(zt=Rm(f,c.vertical,mt,$.get("icon-text-fit-padding"),K,ae)),Y&&(f=Rm(f,Y,mt,$.get("icon-text-fit-padding"),K,ae)));const bt=(at,Wt)=>{Wt.x<0||Wt.x>=yn||Wt.y<0||Wt.y>=yn||function(Nt,mi,Hi,tn,Vn,Jr,Sr,zn,Qn,sr,Tr,Er,qn,Zn,fr,Cr,pr,Or,Nr,Gn,vi,mr,ar,Wn,wo){const zo=Nt.addToLineVertexArray(mi,Hi);let Do,ms,xo,ao,jr=0,gs=0,ru=0,gg=0,Of=-1,Nf=-1;const _s={};let _g=fn("");if(Nt.allowVerticalPlacement&&tn.vertical){const gr=zn.layout.get("text-rotate").evaluate(vi,{},Wn)+90;xo=new Xh(Qn,mi,sr,Tr,Er,tn.vertical,qn,Zn,fr,gr),Sr&&(ao=new Xh(Qn,mi,sr,Tr,Er,Sr,pr,Or,fr,gr))}if(Vn){const gr=zn.layout.get("icon-rotate").evaluate(vi,{}),lo=zn.layout.get("icon-text-fit")!=="none",Aa=ag(Vn,gr,ar,lo),Bo=Sr?ag(Sr,gr,ar,lo):void 0;ms=new Xh(Qn,mi,sr,Tr,Er,Vn,pr,Or,!1,gr),jr=4*Aa.length;const Pa=Nt.iconSizeData;let Yo=null;Pa.kind==="source"?(Yo=[Jo*zn.layout.get("icon-size").evaluate(vi,{})],Yo[0]>Ws&&Ke(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)):Pa.kind==="composite"&&(Yo=[Jo*mr.compositeIconSizes[0].evaluate(vi,{},Wn),Jo*mr.compositeIconSizes[1].evaluate(vi,{},Wn)],(Yo[0]>Ws||Yo[1]>Ws)&&Ke(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)),Nt.addSymbols(Nt.icon,Aa,Yo,Gn,Nr,vi,d.ah.none,mi,zo.lineStartIndex,zo.lineLength,-1,Wn),Of=Nt.icon.placedSymbolArray.length-1,Bo&&(gs=4*Bo.length,Nt.addSymbols(Nt.icon,Bo,Yo,Gn,Nr,vi,d.ah.vertical,mi,zo.lineStartIndex,zo.lineLength,-1,Wn),Nf=Nt.icon.placedSymbolArray.length-1)}const yg=Object.keys(tn.horizontal);for(const gr of yg){const lo=tn.horizontal[gr];if(!Do){_g=fn(lo.text);const Bo=zn.layout.get("text-rotate").evaluate(vi,{},Wn);Do=new Xh(Qn,mi,sr,Tr,Er,lo,qn,Zn,fr,Bo)}const Aa=lo.positionedLines.length===1;if(ru+=hg(Nt,mi,lo,Jr,zn,fr,vi,Cr,zo,tn.vertical?d.ah.horizontal:d.ah.horizontalOnly,Aa?yg:[gr],_s,Of,mr,Wn),Aa)break}tn.vertical&&(gg+=hg(Nt,mi,tn.vertical,Jr,zn,fr,vi,Cr,zo,d.ah.vertical,["vertical"],_s,Nf,mr,Wn));const Rb=Do?Do.boxStartIndex:Nt.collisionBoxArray.length,Bb=Do?Do.boxEndIndex:Nt.collisionBoxArray.length,Fb=xo?xo.boxStartIndex:Nt.collisionBoxArray.length,Ob=xo?xo.boxEndIndex:Nt.collisionBoxArray.length,Nb=ms?ms.boxStartIndex:Nt.collisionBoxArray.length,jb=ms?ms.boxEndIndex:Nt.collisionBoxArray.length,Ub=ao?ao.boxStartIndex:Nt.collisionBoxArray.length,Vb=ao?ao.boxEndIndex:Nt.collisionBoxArray.length;let Ro=-1;const Jh=(gr,lo)=>gr&&gr.circleDiameter?Math.max(gr.circleDiameter,lo):lo;Ro=Jh(Do,Ro),Ro=Jh(xo,Ro),Ro=Jh(ms,Ro),Ro=Jh(ao,Ro);const bg=Ro>-1?1:0;bg&&(Ro*=wo/Un),Nt.glyphOffsetArray.length>=zl.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vi.sortKey!==void 0&&Nt.addToSortKeyRanges(Nt.symbolInstances.length,vi.sortKey);const qb=ug(zn,vi,Wn),[Zb,Gb]=function(gr,lo){const Aa=gr.length,Bo=lo==null?void 0:lo.values;if((Bo==null?void 0:Bo.length)>0)for(let Pa=0;Pa<Bo.length;Pa+=2){const Yo=Bo[Pa+1];gr.emplaceBack(d.ap[Bo[Pa]],Yo[0],Yo[1])}return[Aa,gr.length]}(Nt.textAnchorOffsets,qb);Nt.symbolInstances.emplaceBack(mi.x,mi.y,_s.right>=0?_s.right:-1,_s.center>=0?_s.center:-1,_s.left>=0?_s.left:-1,_s.vertical||-1,Of,Nf,_g,Rb,Bb,Fb,Ob,Nb,jb,Ub,Vb,sr,ru,gg,jr,gs,bg,0,qn,Ro,Zb,Gb)}(s,Wt,at,c,f,g,zt,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,ge,[ze,ze,ze,ze],Ct,I,Fe,Ye,Bt,K,i,v,P,O,w)};if(Tt==="line")for(const at of tg(i.geometry,0,0,yn,yn)){const Wt=Cb(at,Se,tt,c.vertical||Y,f,24,xe,s.overscaling,yn);for(const Nt of Wt)Y&&zb(s,Y.text,wt,Nt)||bt(at,Nt)}else if(Tt==="line-center"){for(const at of i.geometry)if(at.length>1){const Wt=Eb(at,tt,c.vertical||Y,f,24,xe);Wt&&bt(at,Wt)}}else if(i.type==="Polygon")for(const at of lf(i.geometry,0)){const Wt=Lb(at,16);bt(at[0],new Hs(Wt.x,Wt.y,0))}else if(i.type==="LineString")for(const at of i.geometry)bt(at,new Hs(at[0].x,at[0].y,0));else if(i.type==="Point")for(const at of i.geometry)for(const Wt of at)bt([Wt],new Hs(Wt.x,Wt.y,0))}function hg(s,i,c,f,g,v,w,T,I,P,O,j,$,K,Y){const ae=function(Fe,Se,ze,Ye,tt,Ct,Bt,Tt){const wt=Ye.layout.get("text-rotate").evaluate(Ct,{})*Math.PI/180,mt=[];for(const zt of Se.positionedLines)for(const bt of zt.positionedGlyphs){if(!bt.rect)continue;const at=bt.rect||{};let Wt=Mm+1,Nt=!0,mi=1,Hi=0;const tn=(tt||Tt)&&bt.vertical,Vn=bt.metrics.advance*bt.scale/2;if(Tt&&Se.verticalizable&&(Hi=zt.lineOffset/2-(bt.imageName?-(Un-bt.metrics.width*bt.scale)/2:(bt.scale-1)*Un)),bt.imageName){const Gn=Bt[bt.imageName];Nt=Gn.sdf,mi=Gn.pixelRatio,Wt=Fr/mi}const Jr=tt?[bt.x+Vn,bt.y]:[0,0];let Sr=tt?[0,0]:[bt.x+Vn+ze[0],bt.y+ze[1]-Hi],zn=[0,0];tn&&(zn=Sr,Sr=[0,0]);const Qn=bt.metrics.isDoubleResolution?2:1,sr=(bt.metrics.left-Wt)*bt.scale-Vn+Sr[0],Tr=(-bt.metrics.top-Wt)*bt.scale+Sr[1],Er=sr+at.w/Qn*bt.scale/mi,qn=Tr+at.h/Qn*bt.scale/mi,Zn=new k(sr,Tr),fr=new k(Er,Tr),Cr=new k(sr,qn),pr=new k(Er,qn);if(tn){const Gn=new k(-Vn,Vn-Yc),vi=-Math.PI/2,mr=Un/2-Vn,ar=new k(5-Yc-mr,-(bt.imageName?mr:0)),Wn=new k(...zn);Zn._rotateAround(vi,Gn)._add(ar)._add(Wn),fr._rotateAround(vi,Gn)._add(ar)._add(Wn),Cr._rotateAround(vi,Gn)._add(ar)._add(Wn),pr._rotateAround(vi,Gn)._add(ar)._add(Wn)}if(wt){const Gn=Math.sin(wt),vi=Math.cos(wt),mr=[vi,-Gn,Gn,vi];Zn._matMult(mr),fr._matMult(mr),Cr._matMult(mr),pr._matMult(mr)}const Or=new k(0,0),Nr=new k(0,0);mt.push({tl:Zn,tr:fr,bl:Cr,br:pr,tex:at,writingMode:Se.writingMode,glyphOffset:Jr,sectionIndex:bt.sectionIndex,isSDF:Nt,pixelOffsetTL:Or,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return mt}(0,c,T,g,v,w,f,s.allowVerticalPlacement),ge=s.textSizeData;let xe=null;ge.kind==="source"?(xe=[Jo*g.layout.get("text-size").evaluate(w,{})],xe[0]>Ws&&Ke(`${s.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)):ge.kind==="composite"&&(xe=[Jo*K.compositeTextSizes[0].evaluate(w,{},Y),Jo*K.compositeTextSizes[1].evaluate(w,{},Y)],(xe[0]>Ws||xe[1]>Ws)&&Ke(`${s.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)),s.addSymbols(s.text,ae,xe,T,v,w,P,i,I.lineStartIndex,I.lineLength,$,Y);for(const Fe of O)j[Fe]=s.text.placedSymbolArray.length-1;return 4*ae.length}function dg(s){for(const i in s)return s[i];return null}function zb(s,i,c,f){const g=s.compareText;if(i in g){const v=g[i];for(let w=v.length-1;w>=0;w--)if(f.dist(v[w])<c)return!0}else g[i]=[];return g[i].push(f),!1}const fg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Af{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(i,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const v=fg[15&f];if(!v)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(i,2,1),[T]=new Uint32Array(i,4,1);return new Af(T,w,v,i)}constructor(i,c=64,f=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const v=fg.indexOf(this.ArrayType),w=2*i*this.ArrayType.BYTES_PER_ELEMENT,T=i*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+w+T+I),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=i)}add(i,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=c,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Pf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,c,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:w,nodeSize:T}=this,I=[0,v.length-1,0],P=[];for(;I.length;){const O=I.pop()||0,j=I.pop()||0,$=I.pop()||0;if(j-$<=T){for(let ge=$;ge<=j;ge++){const xe=w[2*ge],Fe=w[2*ge+1];xe>=i&&xe<=f&&Fe>=c&&Fe<=g&&P.push(v[ge])}continue}const K=$+j>>1,Y=w[2*K],ae=w[2*K+1];Y>=i&&Y<=f&&ae>=c&&ae<=g&&P.push(v[K]),(O===0?i<=Y:c<=ae)&&(I.push($),I.push(K-1),I.push(1-O)),(O===0?f>=Y:g>=ae)&&(I.push(K+1),I.push(j),I.push(1-O))}return P}within(i,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:w}=this,T=[0,g.length-1,0],I=[],P=f*f;for(;T.length;){const O=T.pop()||0,j=T.pop()||0,$=T.pop()||0;if(j-$<=w){for(let ge=$;ge<=j;ge++)mg(v[2*ge],v[2*ge+1],i,c)<=P&&I.push(g[ge]);continue}const K=$+j>>1,Y=v[2*K],ae=v[2*K+1];mg(Y,ae,i,c)<=P&&I.push(g[K]),(O===0?i-f<=Y:c-f<=ae)&&(T.push($),T.push(K-1),T.push(1-O)),(O===0?i+f>=Y:c+f>=ae)&&(T.push(K+1),T.push(j),T.push(1-O))}return I}}function Pf(s,i,c,f,g,v){if(g-f<=c)return;const w=f+g>>1;pg(s,i,w,f,g,v),Pf(s,i,c,f,w-1,1-v),Pf(s,i,c,w+1,g,1-v)}function pg(s,i,c,f,g,v){for(;g>f;){if(g-f>600){const P=g-f+1,O=c-f+1,j=Math.log(P),$=.5*Math.exp(2*j/3),K=.5*Math.sqrt(j*$*(P-$)/P)*(O-P/2<0?-1:1);pg(s,i,c,Math.max(f,Math.floor(c-O*$/P+K)),Math.min(g,Math.floor(c+(P-O)*$/P+K)),v)}const w=i[2*c+v];let T=f,I=g;for(iu(s,i,f,c),i[2*g+v]>w&&iu(s,i,f,g);T<I;){for(iu(s,i,T,I),T++,I--;i[2*T+v]<w;)T++;for(;i[2*I+v]>w;)I--}i[2*f+v]===w?iu(s,i,f,I):(I++,iu(s,i,I,g)),I<=c&&(f=I+1),c<=I&&(g=I-1)}}function iu(s,i,c,f){zf(s,c,f),zf(i,2*c,2*f),zf(i,2*c+1,2*f+1)}function zf(s,i,c){const f=s[i];s[i]=s[c],s[c]=f}function mg(s,i,c,f){const g=s-c,v=i-f;return g*g+v*v}var Df;d.bd=void 0,(Df=d.bd||(d.bd={})).create="create",Df.load="load",Df.fullLoad="fullLoad";let Kh=null,nu=[];const Rf=1e3/60,Bf="loadTime",Ff="fullLoadTime",Db={mark(s){performance.mark(s)},frame(s){const i=s;Kh!=null&&nu.push(i-Kh),Kh=i},clearMetrics(){Kh=null,nu=[],performance.clearMeasures(Bf),performance.clearMeasures(Ff);for(const s in d.bd)performance.clearMarks(d.bd[s])},getPerformanceMetrics(){performance.measure(Bf,d.bd.create,d.bd.load),performance.measure(Ff,d.bd.create,d.bd.fullLoad);const s=performance.getEntriesByName(Bf)[0].duration,i=performance.getEntriesByName(Ff)[0].duration,c=nu.length,f=1/(nu.reduce((v,w)=>v+w,0)/c/1e3),g=nu.filter(v=>v>Rf).reduce((v,w)=>v+(w-Rf)/Rf,0);return{loadTime:s,fullLoadTime:i,fps:f,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};d.$=_t,d.A=Cl,d.B=function(s){if(pt==null){const i=s.navigator?s.navigator.userAgent:null;pt=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return pt},d.C=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Sb(()=>this.process()),this.subscription=function(c,f,g,v){return c.addEventListener(f,g,!1),{unsubscribe:()=>{c.removeEventListener(f,g,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=vt(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((c,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:c,reject:f},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const v=[],w=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:js(s.data,v)});this.target.postMessage(w,{transfer:v})})}receive(s){const i=s.data,c=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(vt(self)||i.mustQueue)return this.tasks[c]=i,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Us(i.error)):g.resolve(Us(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Us(i.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,c,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,c){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?js(i):null,data:js(c,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.D=jt,d.E=xt,d.F=function(){var s=new Cl(16);return Cl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.G=hi,d.H=function(s,i,c){var f,g,v,w,T,I,P,O,j,$,K,Y,ae=c[0],ge=c[1],xe=c[2];return i===s?(s[12]=i[0]*ae+i[4]*ge+i[8]*xe+i[12],s[13]=i[1]*ae+i[5]*ge+i[9]*xe+i[13],s[14]=i[2]*ae+i[6]*ge+i[10]*xe+i[14],s[15]=i[3]*ae+i[7]*ge+i[11]*xe+i[15]):(g=i[1],v=i[2],w=i[3],T=i[4],I=i[5],P=i[6],O=i[7],j=i[8],$=i[9],K=i[10],Y=i[11],s[0]=f=i[0],s[1]=g,s[2]=v,s[3]=w,s[4]=T,s[5]=I,s[6]=P,s[7]=O,s[8]=j,s[9]=$,s[10]=K,s[11]=Y,s[12]=f*ae+T*ge+j*xe+i[12],s[13]=g*ae+I*ge+$*xe+i[13],s[14]=v*ae+P*ge+K*xe+i[14],s[15]=w*ae+O*ge+Y*xe+i[15]),s},d.I=yf,d.J=function(s,i,c){var f=c[0],g=c[1],v=c[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*v,s[9]=i[9]*v,s[10]=i[10]*v,s[11]=i[11]*v,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},d.K=Xp,d.L=function(s,i){const c={};for(let f=0;f<i.length;f++){const g=i[f];g in s&&(c[g]=s[g])}return c},d.M=$s,d.N=Zm,d.O=Gm,d.P=k,d.Q=so,d.R=oo,d.S=B,d.T=Cc,d.U=N,d.V=ii,d.W=yn,d.X=Sn,d.Y=Gh,d.Z=class extends Lc{},d._=a,d.a=ei,d.a$=function(s,i,c){return s[0]=i[0]*c[0],s[1]=i[1]*c[1],s[2]=i[2]*c[2],s[3]=i[3]*c[3],s},d.a0=Mf,d.a1=ut,d.a2=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(c=>{i.onloadstart=()=>{c(i)};for(const f of s){const g=window.document.createElement("source");ct(f)||(i.crossOrigin="Anonymous"),g.src=f,i.appendChild(g)}})},d.a3=function(){return ee++},d.a4=y,d.a5=zl,d.a6=sl,d.a7=fs,d.a8=Qi,d.a9=Jm,d.aA=ne,d.aB=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let c=[];try{if(!$e(s.version,i.version))return[{command:"setStyle",args:[i]}];$e(s.center,i.center)||c.push({command:"setCenter",args:[i.center]}),$e(s.zoom,i.zoom)||c.push({command:"setZoom",args:[i.zoom]}),$e(s.bearing,i.bearing)||c.push({command:"setBearing",args:[i.bearing]}),$e(s.pitch,i.pitch)||c.push({command:"setPitch",args:[i.pitch]}),$e(s.sprite,i.sprite)||c.push({command:"setSprite",args:[i.sprite]}),$e(s.glyphs,i.glyphs)||c.push({command:"setGlyphs",args:[i.glyphs]}),$e(s.transition,i.transition)||c.push({command:"setTransition",args:[i.transition]}),$e(s.light,i.light)||c.push({command:"setLight",args:[i.light]}),$e(s.terrain,i.terrain)||c.push({command:"setTerrain",args:[i.terrain]}),$e(s.sky,i.sky)||c.push({command:"setSky",args:[i.sky]});const f={},g=[];(function(w,T,I,P){let O;for(O in T=T||{},w=w||{})Object.prototype.hasOwnProperty.call(w,O)&&(Object.prototype.hasOwnProperty.call(T,O)||wn(O,I,P));for(O in T)Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(w,O)?$e(w[O],T[O])||(w[O].type==="geojson"&&T[O].type==="geojson"&&ir(w,T,O)?kt(I,{command:"setGeoJSONSourceData",args:[O,T[O].data]}):Cn(O,T,I,P)):vn(O,T,I))})(s.sources,i.sources,g,f);const v=[];s.layers&&s.layers.forEach(w=>{"source"in w&&f[w.source]?c.push({command:"removeLayer",args:[w.id]}):v.push(w)}),c=c.concat(g),function(w,T,I){T=T||[];const P=(w=w||[]).map(Uo),O=T.map(Uo),j=w.reduce(Ji,{}),$=T.reduce(Ji,{}),K=P.slice(),Y=Object.create(null);let ae,ge,xe,Fe,Se;for(let ze=0,Ye=0;ze<P.length;ze++)ae=P[ze],Object.prototype.hasOwnProperty.call($,ae)?Ye++:(kt(I,{command:"removeLayer",args:[ae]}),K.splice(K.indexOf(ae,Ye),1));for(let ze=0,Ye=0;ze<O.length;ze++)ae=O[O.length-1-ze],K[K.length-1-ze]!==ae&&(Object.prototype.hasOwnProperty.call(j,ae)?(kt(I,{command:"removeLayer",args:[ae]}),K.splice(K.lastIndexOf(ae,K.length-Ye),1)):Ye++,Fe=K[K.length-ze],kt(I,{command:"addLayer",args:[$[ae],Fe]}),K.splice(K.length-ze,0,ae),Y[ae]=!0);for(let ze=0;ze<O.length;ze++)if(ae=O[ze],ge=j[ae],xe=$[ae],!Y[ae]&&!$e(ge,xe))if($e(ge.source,xe.source)&&$e(ge["source-layer"],xe["source-layer"])&&$e(ge.type,xe.type)){for(Se in nr(ge.layout,xe.layout,I,ae,null,"setLayoutProperty"),nr(ge.paint,xe.paint,I,ae,null,"setPaintProperty"),$e(ge.filter,xe.filter)||kt(I,{command:"setFilter",args:[ae,xe.filter]}),$e(ge.minzoom,xe.minzoom)&&$e(ge.maxzoom,xe.maxzoom)||kt(I,{command:"setLayerZoomRange",args:[ae,xe.minzoom,xe.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?nr(ge[Se],xe[Se],I,ae,Se.slice(6),"setPaintProperty"):$e(ge[Se],xe[Se])||kt(I,{command:"setLayerProperty",args:[ae,Se,xe[Se]]}));for(Se in xe)Object.prototype.hasOwnProperty.call(xe,Se)&&!Object.prototype.hasOwnProperty.call(ge,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?nr(ge[Se],xe[Se],I,ae,Se.slice(6),"setPaintProperty"):$e(ge[Se],xe[Se])||kt(I,{command:"setLayerProperty",args:[ae,Se,xe[Se]]}))}else kt(I,{command:"removeLayer",args:[ae]}),Fe=K[K.lastIndexOf(ae)+1],kt(I,{command:"addLayer",args:[xe,Fe]})}(v,i.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[i]}]}return c},d.aC=function(s){const i=[],c=s.id;return c===void 0&&i.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),i},d.aD=function s(i,c){if(Array.isArray(i)){if(!Array.isArray(c)||i.length!==c.length)return!1;for(let f=0;f<i.length;f++)if(!s(i[f],c[f]))return!1;return!0}if(typeof i=="object"&&i!==null&&c!==null){if(typeof c!="object"||Object.keys(i).length!==Object.keys(c).length)return!1;for(const f in i)if(!s(i[f],c[f]))return!1;return!0}return i===c},d.aE=be,d.aF=Oe,d.aG=class extends jn{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.aH=Br,d.aI=class extends jn{constructor(s,i){super(s,i),this.current=Ia}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.aJ=bo,d.aK=class extends jn{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.aL=class extends jn{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.aM=Ho,d.aN=function(s,i,c,f,g,v,w){var T=1/(i-c),I=1/(f-g),P=1/(v-w);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*P,s[11]=0,s[12]=(i+c)*T,s[13]=(g+f)*I,s[14]=(w+v)*P,s[15]=1,s},d.aO=Di,d.aP=r1,d.aQ=class extends bl{},d.aR=Y1,d.aS=class extends vl{},d.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},d.aU=em,d.aV=Z,d.aW=class extends Bc{},d.aX=Xe,d.aY=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},d.aZ=function(s,i){var c=s[0],f=s[1],g=s[2],v=s[3],w=s[4],T=s[5],I=s[6],P=s[7],O=s[8],j=s[9],$=s[10],K=s[11],Y=s[12],ae=s[13],ge=s[14],xe=s[15],Fe=i[0],Se=i[1],ze=i[2],Ye=i[3],tt=i[4],Ct=i[5],Bt=i[6],Tt=i[7],wt=i[8],mt=i[9],zt=i[10],bt=i[11],at=i[12],Wt=i[13],Nt=i[14],mi=i[15];return Math.abs(c-Fe)<=kr*Math.max(1,Math.abs(c),Math.abs(Fe))&&Math.abs(f-Se)<=kr*Math.max(1,Math.abs(f),Math.abs(Se))&&Math.abs(g-ze)<=kr*Math.max(1,Math.abs(g),Math.abs(ze))&&Math.abs(v-Ye)<=kr*Math.max(1,Math.abs(v),Math.abs(Ye))&&Math.abs(w-tt)<=kr*Math.max(1,Math.abs(w),Math.abs(tt))&&Math.abs(T-Ct)<=kr*Math.max(1,Math.abs(T),Math.abs(Ct))&&Math.abs(I-Bt)<=kr*Math.max(1,Math.abs(I),Math.abs(Bt))&&Math.abs(P-Tt)<=kr*Math.max(1,Math.abs(P),Math.abs(Tt))&&Math.abs(O-wt)<=kr*Math.max(1,Math.abs(O),Math.abs(wt))&&Math.abs(j-mt)<=kr*Math.max(1,Math.abs(j),Math.abs(mt))&&Math.abs($-zt)<=kr*Math.max(1,Math.abs($),Math.abs(zt))&&Math.abs(K-bt)<=kr*Math.max(1,Math.abs(K),Math.abs(bt))&&Math.abs(Y-at)<=kr*Math.max(1,Math.abs(Y),Math.abs(at))&&Math.abs(ae-Wt)<=kr*Math.max(1,Math.abs(ae),Math.abs(Wt))&&Math.abs(ge-Nt)<=kr*Math.max(1,Math.abs(ge),Math.abs(Nt))&&Math.abs(xe-mi)<=kr*Math.max(1,Math.abs(xe),Math.abs(mi))},d.a_=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},d.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,g,v)=>{const w=g||v;return i[f]=!w||w.toLowerCase(),""}),i["max-age"]){const c=parseInt(i["max-age"],10);isNaN(c)?delete i["max-age"]:i["max-age"]=c}return i},d.ab=function(s,i){const c=[];for(const f in s)f in i||c.push(f);return c},d.ac=le,d.ad=function(s,i,c){var f=Math.sin(c),g=Math.cos(c),v=i[0],w=i[1],T=i[2],I=i[3],P=i[4],O=i[5],j=i[6],$=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=v*g+P*f,s[1]=w*g+O*f,s[2]=T*g+j*f,s[3]=I*g+$*f,s[4]=P*g-v*f,s[5]=O*g-w*f,s[6]=j*g-T*f,s[7]=$*g-I*f,s},d.ae=function(s){var i=new Cl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},d.af=Dh,d.ag=function(s,i){let c=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:w}=s,T=g?le(rr.interpolationFactor(g,i,v,w),0,1):0;s.kind==="camera"?f=hr.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(s,{uSize:i,uSizeT:c},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/Jo:s.kind==="composite"?hr.number(f/Jo,g/Jo,c):i},d.aj=xf,d.ak=function(s,i,c,f){const g=i.y-s.y,v=i.x-s.x,w=f.y-c.y,T=f.x-c.x,I=w*v-T*g;if(I===0)return null;const P=(T*(s.y-c.y)-w*(s.x-c.x))/I;return new k(s.x+P*v,s.y+P*g)},d.al=tg,d.am=Oc,d.an=ef,d.ao=Un,d.aq=wf,d.ar=function(s,i){var c=i[0],f=i[1],g=i[2],v=i[3],w=i[4],T=i[5],I=i[6],P=i[7],O=i[8],j=i[9],$=i[10],K=i[11],Y=i[12],ae=i[13],ge=i[14],xe=i[15],Fe=c*T-f*w,Se=c*I-g*w,ze=c*P-v*w,Ye=f*I-g*T,tt=f*P-v*T,Ct=g*P-v*I,Bt=O*ae-j*Y,Tt=O*ge-$*Y,wt=O*xe-K*Y,mt=j*ge-$*ae,zt=j*xe-K*ae,bt=$*xe-K*ge,at=Fe*bt-Se*zt+ze*mt+Ye*wt-tt*Tt+Ct*Bt;return at?(s[0]=(T*bt-I*zt+P*mt)*(at=1/at),s[1]=(g*zt-f*bt-v*mt)*at,s[2]=(ae*Ct-ge*tt+xe*Ye)*at,s[3]=($*tt-j*Ct-K*Ye)*at,s[4]=(I*wt-w*bt-P*Tt)*at,s[5]=(c*bt-g*wt+v*Tt)*at,s[6]=(ge*ze-Y*Ct-xe*Se)*at,s[7]=(O*Ct-$*ze+K*Se)*at,s[8]=(w*zt-T*wt+P*Bt)*at,s[9]=(f*wt-c*zt-v*Bt)*at,s[10]=(Y*tt-ae*ze+xe*Fe)*at,s[11]=(j*ze-O*tt-K*Fe)*at,s[12]=(T*Tt-w*mt-I*Bt)*at,s[13]=(c*mt-f*Tt+g*Bt)*at,s[14]=(ae*Se-Y*Ye-ge*Fe)*at,s[15]=(O*Ye-j*Se+$*Fe)*at,s):null},d.as=Lf,d.at=vf,d.au=Af,d.av=function(){const s={},i=we.$version;for(const c in we.$root){const f=we.$root[c];if(f.required){let g=null;g=c==="version"?i:f.type==="array"?[]:{},g!=null&&(s[c]=g)}}return s},d.aw=vh,d.ax=gi,d.ay=function(s){s=s.slice();const i=Object.create(null);for(let c=0;c<s.length;c++)i[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=Ve(s[c],i[s[c].ref]));return s},d.az=function(s){if(s.type==="custom")return new kb(s);switch(s.type){case"background":return new vb(s);case"circle":return new o1(s);case"fill":return new T1(s);case"fill-extrusion":return new j1(s);case"heatmap":return new a1(s);case"hillshade":return new c1(s);case"line":return new H1(s);case"raster":return new xb(s);case"symbol":return new Zh(s)}},d.b=st,d.b0=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},d.b1=oe,d.b2=Hm,d.b3=Wm,d.b4=function(s,i,c,f,g){var v,w=1/Math.tan(i/2);return s[0]=w/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(v=1/(f-g)),s[14]=2*g*f*v):(s[10]=-1,s[14]=-2*f),s},d.b5=function(s,i,c){var f=Math.sin(c),g=Math.cos(c),v=i[4],w=i[5],T=i[6],I=i[7],P=i[8],O=i[9],j=i[10],$=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=v*g+P*f,s[5]=w*g+O*f,s[6]=T*g+j*f,s[7]=I*g+$*f,s[8]=P*g-v*f,s[9]=O*g-w*f,s[10]=j*g-T*f,s[11]=$*g-I*f,s},d.b6=V,d.b7=U,d.b8=function(s){return s*Math.PI/180},d.b9=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.bA=$o,d.ba=class extends Ao{},d.bb=Ef,d.bc=Db,d.be=xi,d.bf=function(s,i){ei.REGISTERED_PROTOCOLS[s]=i},d.bg=function(s){delete ei.REGISTERED_PROTOCOLS[s]},d.bh=function(s,i){const c={};for(let g=0;g<s.length;g++){const v=i&&i[s[g].id]||Xd(s[g]);i&&(i[s[g].id]=v);let w=c[v];w||(w=c[v]=[]),w.push(s[g])}const f=[];for(const g in c)f.push(c[g]);return f},d.bi=Lt,d.bj=Km,d.bk=Ym,d.bl=Lm,d.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=yn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],c=i.layout,f=i._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new Qi(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Qi(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Qi(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:O}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Qi(P),s.canonical),f["text-size"].possiblyEvaluate(new Qi(O),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:O}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Qi(P),s.canonical),f["icon-size"].possiblyEvaluate(new Qi(O),s.canonical)]}const v=c.get("text-line-height")*Un,w=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),I=c.get("text-size");for(const P of s.bucket.features){const O=c.get("text-font").evaluate(P,{},s.canonical).join(","),j=I.evaluate(P,{},s.canonical),$=g.layoutTextSize.evaluate(P,{},s.canonical),K=g.layoutIconSize.evaluate(P,{},s.canonical),Y={horizontal:{},vertical:void 0},ae=P.text;let ge,xe=[0,0];if(ae){const ze=ae.toString(),Ye=c.get("text-letter-spacing").evaluate(P,{},s.canonical)*Un,tt=wh(ze)?Ye:0,Ct=c.get("text-anchor").evaluate(P,{},s.canonical),Bt=ug(i,P,s.canonical);if(!Bt){const bt=c.get("text-radial-offset").evaluate(P,{},s.canonical);xe=bt?cg(Ct,[bt*Un,If]):c.get("text-offset").evaluate(P,{},s.canonical).map(at=>at*Un)}let Tt=w?"center":c.get("text-justify").evaluate(P,{},s.canonical);const wt=c.get("symbol-placement"),mt=wt==="point"?c.get("text-max-width").evaluate(P,{},s.canonical)*Un:0,zt=()=>{s.bucket.allowVerticalPlacement&&Vs(ze)&&(Y.vertical=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,v,Ct,"left",tt,xe,d.ah.vertical,!0,wt,$,j))};if(!w&&Bt){const bt=new Set;if(Tt==="auto")for(let Wt=0;Wt<Bt.values.length;Wt+=2)bt.add(Lf(Bt.values[Wt]));else bt.add(Tt);let at=!1;for(const Wt of bt)if(!Y.horizontal[Wt])if(at)Y.horizontal[Wt]=Y.horizontal[0];else{const Nt=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,v,"center",Wt,tt,xe,d.ah.horizontal,!1,wt,$,j);Nt&&(Y.horizontal[Wt]=Nt,at=Nt.positionedLines.length===1)}zt()}else{Tt==="auto"&&(Tt=Lf(Ct));const bt=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,v,Ct,Tt,tt,xe,d.ah.horizontal,!1,wt,$,j);bt&&(Y.horizontal[Tt]=bt),zt(),Vs(ze)&&w&&T&&(Y.vertical=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,v,Ct,Tt,tt,xe,d.ah.vertical,!1,wt,$,j))}}let Fe=!1;if(P.icon&&P.icon.name){const ze=s.imageMap[P.icon.name];ze&&(ge=mb(s.imagePositions[P.icon.name],c.get("icon-offset").evaluate(P,{},s.canonical),c.get("icon-anchor").evaluate(P,{},s.canonical)),Fe=!!ze.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Fe:s.bucket.sdfIcons!==Fe&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Se=dg(Y.horizontal)||Y.vertical;s.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||ge)&&Pb(s.bucket,P,Y,ge,s.imageMap,g,$,K,xe,Fe,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},d.bn=pf,d.bo=hf,d.bp=ff,d.bq=Zs,d.br=gf,d.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},d.bt=function(s,i,c,f,g){return a(this,void 0,void 0,function*(){if(N())try{return yield ii(s,i,c,f,g)}catch{}return function(v,w,T,I,P){const O=v.width,j=v.height;Ot&&Pt||(Ot=new OffscreenCanvas(O,j),Pt=Ot.getContext("2d",{willReadFrequently:!0})),Ot.width=O,Ot.height=j,Pt.drawImage(v,0,0,O,j);const $=Pt.getImageData(w,T,I,P);return Pt.clearRect(0,0,O,j),$.data}(s,i,c,f,g)})},d.bu=Xm,d.bv=_,d.bw=x,d.bx=wm,d.by=as,d.bz=function(s){return s.message===Jt},d.c=Mt,d.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=H,d.f=s=>new Promise((i,c)=>{const f=new Image;f.onload=()=>{i(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Ht})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):Ht}),d.g=Vt,d.h=(s,i)=>Pi(H(s,{type:"json"}),i),d.i=vt,d.j=rt,d.k=je,d.l=(s,i)=>Pi(H(s,{type:"arrayBuffer"}),i),d.m=Pi,d.n=function(s){return new gf(s).readFields(cb,[])},d.o=Zc,d.p=Im,d.q=xr,d.r=Kd,d.s=ct,d.t=Ns,d.u=St,d.v=we,d.w=Ke,d.x=cs,d.y=function([s,i,c]){return i+=90,i*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(c),y:s*Math.sin(i)*Math.sin(c),z:s*Math.cos(c)}},d.z=hr}),l("worker",["./shared"],function(d){class a{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const de of W){this._layerConfigs[de.id]=de;const Me=this._layers[de.id]=d.az(de);Me._featureFilter=d.a6(Me.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of X)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const te=d.bh(Object.values(this._layerConfigs),this.keyCache);for(const de of te){const Me=de.map(qe=>this._layers[qe.id]),Ie=Me[0];if(Ie.visibility==="none")continue;const Be=Ie.source||"";let ke=this.familiesBySource[Be];ke||(ke=this.familiesBySource[Be]={});const G=Ie.sourceLayer||"_geojsonTileLayer";let Ue=ke[G];Ue||(Ue=ke[G]=[]),Ue.push(Me)}}}class _{constructor(W){const X={},te=[];for(const Be in W){const ke=W[Be],G=X[Be]={};for(const Ue in ke){const qe=ke[+Ue];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Ge={x:0,y:0,w:qe.bitmap.width+2,h:qe.bitmap.height+2};te.push(Ge),G[Ue]={rect:Ge,metrics:qe.metrics}}}const{w:de,h:Me}=d.p(te),Ie=new d.o({width:de||1,height:Me||1});for(const Be in W){const ke=W[Be];for(const G in ke){const Ue=ke[+G];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const qe=X[Be][G].rect;d.o.copy(Ue.bitmap,Ie,{x:0,y:0},{x:qe.x+1,y:qe.y+1},Ue.bitmap)}}this.image=Ie,this.positions=X}}d.bi("GlyphAtlas",_);class x{constructor(W){this.tileID=new d.Q(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,X,te,de){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new d.a4;const Me=new d.bj(Object.keys(W.layers).sort()),Ie=new d.bk(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Be={},ke={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},G=X.familiesBySource[this.source];for(const li in G){const un=W.layers[li];if(!un)continue;un.version===1&&d.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const On=Me.encode(li),ur=[];for(let br=0;br<un.length;br++){const Kn=un.feature(br),po=Ie.getId(Kn,li);ur.push({feature:Kn,id:po,index:br,sourceLayerIndex:On})}for(const br of G[li]){const Kn=br[0];Kn.source!==this.source&&d.w(`layer.source = ${Kn.source} does not equal this.source = ${this.source}`),Kn.minzoom&&this.zoom<Math.floor(Kn.minzoom)||Kn.maxzoom&&this.zoom>=Kn.maxzoom||Kn.visibility!=="none"&&(S(br,this.zoom,te),(Be[Kn.id]=Kn.createBucket({index:Ie.bucketLayerIDs.length,layers:br,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:On,sourceID:this.source})).populate(ur,ke,this.tileID.canonical),Ie.bucketLayerIDs.push(br.map(po=>po.id)))}}const Ue=d.aE(ke.glyphDependencies,li=>Object.keys(li).map(Number));this.inFlightDependencies.forEach(li=>li==null?void 0:li.abort()),this.inFlightDependencies=[];let qe=Promise.resolve({});if(Object.keys(Ue).length){const li=new AbortController;this.inFlightDependencies.push(li),qe=de.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},li)}const Ge=Object.keys(ke.iconDependencies);let Je=Promise.resolve({});if(Ge.length){const li=new AbortController;this.inFlightDependencies.push(li),Je=de.sendAsync({type:"GI",data:{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"}},li)}const ht=Object.keys(ke.patternDependencies);let Rt=Promise.resolve({});if(ht.length){const li=new AbortController;this.inFlightDependencies.push(li),Rt=de.sendAsync({type:"GI",data:{icons:ht,source:this.source,tileID:this.tileID,type:"patterns"}},li)}const[Xt,ai,bi]=yield Promise.all([qe,Je,Rt]),Yi=new _(Xt),Mn=new d.bl(ai,bi);for(const li in Be){const un=Be[li];un instanceof d.a5?(S(un.layers,this.zoom,te),d.bm({bucket:un,glyphMap:Xt,glyphPositions:Yi.positions,imageMap:ai,imagePositions:Mn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):un.hasPattern&&(un instanceof d.bn||un instanceof d.bo||un instanceof d.bp)&&(S(un.layers,this.zoom,te),un.addFeatures(ke,this.tileID.canonical,Mn.patternPositions))}return this.status="done",{buckets:Object.values(Be).filter(li=>!li.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yi.image,imageAtlas:Mn,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?ai:null,glyphPositions:this.returnDependencies?Yi.positions:null}})}}function S(me,W,X){const te=new d.a8(W);for(const de of me)de.recalculate(te,X)}class k{constructor(W,X,te){this.actor=W,this.layerIndex=X,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return d._(this,void 0,void 0,function*(){const te=yield d.l(W.request,X);try{return{vectorTile:new d.bq.VectorTile(new d.br(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(de){const Me=new Uint8Array(te.data);let Ie=`Unable to parse the tile at ${W.request.url}, `;throw Ie+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.messge}`,new Error(Ie)}})}loadTile(W){return d._(this,void 0,void 0,function*(){const X=W.uid,te=!!(W&&W.request&&W.request.collectResourceTiming)&&new d.bs(W.request),de=new x(W);this.loading[X]=de;const Me=new AbortController;de.abort=Me;try{const Ie=yield this.loadVectorTile(W,Me);if(delete this.loading[X],!Ie)return null;const Be=Ie.rawData,ke={};Ie.expires&&(ke.expires=Ie.expires),Ie.cacheControl&&(ke.cacheControl=Ie.cacheControl);const G={};if(te){const qe=te.finish();qe&&(G.resourceTiming=JSON.parse(JSON.stringify(qe)))}de.vectorTile=Ie.vectorTile;const Ue=de.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=de,this.fetching[X]={rawTileData:Be,cacheControl:ke,resourceTiming:G};try{const qe=yield Ue;return d.e({rawTileData:Be.slice(0)},qe,ke,G)}finally{delete this.fetching[X]}}catch(Ie){throw delete this.loading[X],de.status="done",this.loaded[X]=de,Ie}})}reloadTile(W){return d._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[X];if(te.showCollisionBoxes=W.showCollisionBoxes,te.status==="parsing"){const de=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[X]){const{rawTileData:Ie,cacheControl:Be,resourceTiming:ke}=this.fetching[X];delete this.fetching[X],Me=d.e({rawTileData:Ie.slice(0)},de,Be,ke)}else Me=de;return Me}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return d._(this,void 0,void 0,function*(){const X=this.loading,te=W.uid;X&&X[te]&&X[te].abort&&(X[te].abort.abort(),delete X[te])})}removeTile(W){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class C{constructor(){this.loaded={}}loadTile(W){return d._(this,void 0,void 0,function*(){const{uid:X,encoding:te,rawImageData:de,redFactor:Me,greenFactor:Ie,blueFactor:Be,baseShift:ke}=W,G=de.width+2,Ue=de.height+2,qe=d.b(de)?new d.R({width:G,height:Ue},yield d.bt(de,-1,-1,G,Ue)):de,Ge=new d.bu(X,qe,te,Me,Ie,Be,ke);return this.loaded=this.loaded||{},this.loaded[X]=Ge,Ge})}removeTile(W){const X=this.loaded,te=W.uid;X&&X[te]&&delete X[te]}}function L(me,W){if(me.length!==0){z(me[0],W);for(var X=1;X<me.length;X++)z(me[X],!W)}}function z(me,W){for(var X=0,te=0,de=0,Me=me.length,Ie=Me-1;de<Me;Ie=de++){var Be=(me[de][0]-me[Ie][0])*(me[Ie][1]+me[de][1]),ke=X+Be;te+=Math.abs(X)>=Math.abs(Be)?X-ke+Be:Be-ke+X,X=ke}X+te>=0!=!!W&&me.reverse()}var R=d.bv(function me(W,X){var te,de=W&&W.type;if(de==="FeatureCollection")for(te=0;te<W.features.length;te++)me(W.features[te],X);else if(de==="GeometryCollection")for(te=0;te<W.geometries.length;te++)me(W.geometries[te],X);else if(de==="Feature")me(W.geometry,X);else if(de==="Polygon")L(W.coordinates,X);else if(de==="MultiPolygon")for(te=0;te<W.coordinates.length;te++)L(W.coordinates[te],X);return W});const D=d.bq.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},N=d.bw,V=d.bq.VectorTileFeature,U=le;function le(me,W){this.options=W||{},this.features=me,this.length=me.length}function oe(me,W){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=W||4096}le.prototype.feature=function(me){return new oe(this.features[me],this.options.extent)},oe.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var W=0;W<me.length;W++){for(var X=me[W],te=[],de=0;de<X.length;de++)te.push(new N(X[de][0],X[de][1]));this.geometry.push(te)}return this.geometry},oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,W=1/0,X=-1/0,te=1/0,de=-1/0,Me=0;Me<me.length;Me++)for(var Ie=me[Me],Be=0;Be<Ie.length;Be++){var ke=Ie[Be];W=Math.min(W,ke.x),X=Math.max(X,ke.x),te=Math.min(te,ke.y),de=Math.max(de,ke.y)}return[W,te,X,de]},oe.prototype.toGeoJSON=V.prototype.toGeoJSON;var H=d.bx,ee=U;function be(me){var W=new H;return function(X,te){for(var de in X.layers)te.writeMessage(3,Oe,X.layers[de])}(me,W),W.finish()}function Oe(me,W){var X;W.writeVarintField(15,me.version||1),W.writeStringField(1,me.name||""),W.writeVarintField(5,me.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<me.length;X++)te.feature=me.feature(X),W.writeMessage(2,ne,te);var de=te.keys;for(X=0;X<de.length;X++)W.writeStringField(3,de[X]);var Me=te.values;for(X=0;X<Me.length;X++)W.writeMessage(4,vt,Me[X])}function ne(me,W){var X=me.feature;X.id!==void 0&&W.writeVarintField(1,X.id),W.writeMessage(2,ye,me),W.writeVarintField(3,X.type),W.writeMessage(4,et,X)}function ye(me,W){var X=me.feature,te=me.keys,de=me.values,Me=me.keycache,Ie=me.valuecache;for(var Be in X.properties){var ke=X.properties[Be],G=Me[Be];if(ke!==null){G===void 0&&(te.push(Be),Me[Be]=G=te.length-1),W.writeVarint(G);var Ue=typeof ke;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(ke=JSON.stringify(ke));var qe=Ue+":"+ke,Ge=Ie[qe];Ge===void 0&&(de.push(ke),Ie[qe]=Ge=de.length-1),W.writeVarint(Ge)}}}function Ke(me,W){return(W<<3)+(7&me)}function Ce(me){return me<<1^me>>31}function et(me,W){for(var X=me.loadGeometry(),te=me.type,de=0,Me=0,Ie=X.length,Be=0;Be<Ie;Be++){var ke=X[Be],G=1;te===1&&(G=ke.length),W.writeVarint(Ke(1,G));for(var Ue=te===3?ke.length-1:ke.length,qe=0;qe<Ue;qe++){qe===1&&te!==1&&W.writeVarint(Ke(2,Ue-1));var Ge=ke[qe].x-de,Je=ke[qe].y-Me;W.writeVarint(Ce(Ge)),W.writeVarint(Ce(Je)),de+=Ge,Me+=Je}te===3&&W.writeVarint(Ke(7,1))}}function vt(me,W){var X=typeof me;X==="string"?W.writeStringField(1,me):X==="boolean"?W.writeBooleanField(7,me):X==="number"&&(me%1!=0?W.writeDoubleField(3,me):me<0?W.writeSVarintField(6,me):W.writeVarintField(5,me))}B.exports=be,B.exports.fromVectorTileJs=be,B.exports.fromGeojsonVt=function(me,W){W=W||{};var X={};for(var te in me)X[te]=new ee(me[te].features,W),X[te].name=te,X[te].version=W.version,X[te].extent=W.extent;return be({layers:X})},B.exports.GeoJSONWrapper=ee;var pt=d.bv(B.exports);const st={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},Ht=Math.fround||(ii=new Float32Array(1),me=>(ii[0]=+me,ii[0]));var ii;const Ot=3,Pt=5,Jt=6;class Mt{constructor(W){this.options=Object.assign(Object.create(st),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:te,maxZoom:de}=this.options;X&&console.time("total time");const Me=`prepare ${W.length} points`;X&&console.time(Me),this.points=W;const Ie=[];for(let ke=0;ke<W.length;ke++){const G=W[ke];if(!G.geometry)continue;const[Ue,qe]=G.geometry.coordinates,Ge=Ht(hi(Ue)),Je=Ht(xi(qe));Ie.push(Ge,Je,1/0,ke,-1,1),this.options.reduce&&Ie.push(0)}let Be=this.trees[de+1]=this._createTree(Ie);X&&console.timeEnd(Me);for(let ke=de;ke>=te;ke--){const G=+Date.now();Be=this.trees[ke]=this._createTree(this._cluster(Be,ke)),X&&console.log("z%d: %d clusters in %dms",ke,Be.numItems,+Date.now()-G)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let te=((W[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,W[1]));let Me=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)te=-180,Me=180;else if(te>Me){const qe=this.getClusters([te,de,180,Ie],X),Ge=this.getClusters([-180,de,Me,Ie],X);return qe.concat(Ge)}const Be=this.trees[this._limitZoom(X)],ke=Be.range(hi(te),xi(Ie),hi(Me),xi(de)),G=Be.data,Ue=[];for(const qe of ke){const Ge=this.stride*qe;Ue.push(G[Ge+Pt]>1?ei(G,Ge,this.clusterProps):this.points[G[Ge+Ot]])}return Ue}getChildren(W){const X=this._getOriginId(W),te=this._getOriginZoom(W),de="No cluster with the specified id.",Me=this.trees[te];if(!Me)throw new Error(de);const Ie=Me.data;if(X*this.stride>=Ie.length)throw new Error(de);const Be=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ke=Me.within(Ie[X*this.stride],Ie[X*this.stride+1],Be),G=[];for(const Ue of ke){const qe=Ue*this.stride;Ie[qe+4]===W&&G.push(Ie[qe+Pt]>1?ei(Ie,qe,this.clusterProps):this.points[Ie[qe+Ot]])}if(G.length===0)throw new Error(de);return G}getLeaves(W,X,te){const de=[];return this._appendLeaves(de,W,X=X||10,te=te||0,0),de}getTile(W,X,te){const de=this.trees[this._limitZoom(W)],Me=Math.pow(2,W),{extent:Ie,radius:Be}=this.options,ke=Be/Ie,G=(te-ke)/Me,Ue=(te+1+ke)/Me,qe={features:[]};return this._addTileFeatures(de.range((X-ke)/Me,G,(X+1+ke)/Me,Ue),de.data,X,te,Me,qe),X===0&&this._addTileFeatures(de.range(1-ke/Me,G,1,Ue),de.data,Me,te,Me,qe),X===Me-1&&this._addTileFeatures(de.range(0,G,ke/Me,Ue),de.data,-1,te,Me,qe),qe.features.length?qe:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const te=this.getChildren(W);if(X++,te.length!==1)break;W=te[0].properties.cluster_id}return X}_appendLeaves(W,X,te,de,Me){const Ie=this.getChildren(X);for(const Be of Ie){const ke=Be.properties;if(ke&&ke.cluster?Me+ke.point_count<=de?Me+=ke.point_count:Me=this._appendLeaves(W,ke.cluster_id,te,de,Me):Me<de?Me++:W.push(Be),W.length===te)break}return Me}_createTree(W){const X=new d.au(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<W.length;te+=this.stride)X.add(W[te],W[te+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,te,de,Me,Ie){for(const Be of W){const ke=Be*this.stride,G=X[ke+Pt]>1;let Ue,qe,Ge;if(G)Ue=Vt(X,ke,this.clusterProps),qe=X[ke],Ge=X[ke+1];else{const Rt=this.points[X[ke+Ot]];Ue=Rt.properties;const[Xt,ai]=Rt.geometry.coordinates;qe=hi(Xt),Ge=xi(ai)}const Je={type:1,geometry:[[Math.round(this.options.extent*(qe*Me-te)),Math.round(this.options.extent*(Ge*Me-de))]],tags:Ue};let ht;ht=G||this.options.generateId?X[ke+Ot]:this.points[X[ke+Ot]].id,ht!==void 0&&(Je.id=ht),Ie.features.push(Je)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:te,extent:de,reduce:Me,minPoints:Ie}=this.options,Be=te/(de*Math.pow(2,X)),ke=W.data,G=[],Ue=this.stride;for(let qe=0;qe<ke.length;qe+=Ue){if(ke[qe+2]<=X)continue;ke[qe+2]=X;const Ge=ke[qe],Je=ke[qe+1],ht=W.within(ke[qe],ke[qe+1],Be),Rt=ke[qe+Pt];let Xt=Rt;for(const ai of ht){const bi=ai*Ue;ke[bi+2]>X&&(Xt+=ke[bi+Pt])}if(Xt>Rt&&Xt>=Ie){let ai,bi=Ge*Rt,Yi=Je*Rt,Mn=-1;const li=((qe/Ue|0)<<5)+(X+1)+this.points.length;for(const un of ht){const On=un*Ue;if(ke[On+2]<=X)continue;ke[On+2]=X;const ur=ke[On+Pt];bi+=ke[On]*ur,Yi+=ke[On+1]*ur,ke[On+4]=li,Me&&(ai||(ai=this._map(ke,qe,!0),Mn=this.clusterProps.length,this.clusterProps.push(ai)),Me(ai,this._map(ke,On)))}ke[qe+4]=li,G.push(bi/Xt,Yi/Xt,1/0,li,-1,Xt),Me&&G.push(Mn)}else{for(let ai=0;ai<Ue;ai++)G.push(ke[qe+ai]);if(Xt>1)for(const ai of ht){const bi=ai*Ue;if(!(ke[bi+2]<=X)){ke[bi+2]=X;for(let Yi=0;Yi<Ue;Yi++)G.push(ke[bi+Yi])}}}}return G}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,te){if(W[X+Pt]>1){const Ie=this.clusterProps[W[X+Jt]];return te?Object.assign({},Ie):Ie}const de=this.points[W[X+Ot]].properties,Me=this.options.map(de);return te&&Me===de?Object.assign({},Me):Me}}function ei(me,W,X){return{type:"Feature",id:me[W+Ot],properties:Vt(me,W,X),geometry:{type:"Point",coordinates:[(te=me[W],360*(te-.5)),gi(me[W+1])]}};var te}function Vt(me,W,X){const te=me[W+Pt],de=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,Me=me[W+Jt],Ie=Me===-1?{}:Object.assign({},X[Me]);return Object.assign(Ie,{cluster:!0,cluster_id:me[W+Ot],point_count:te,point_count_abbreviated:de})}function hi(me){return me/360+.5}function xi(me){const W=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function gi(me){const W=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Pi(me,W,X,te){for(var de,Me=te,Ie=X-W>>1,Be=X-W,ke=me[W],G=me[W+1],Ue=me[X],qe=me[X+1],Ge=W+3;Ge<X;Ge+=3){var Je=ct(me[Ge],me[Ge+1],ke,G,Ue,qe);if(Je>Me)de=Ge,Me=Je;else if(Je===Me){var ht=Math.abs(Ge-Ie);ht<Be&&(de=Ge,Be=ht)}}Me>te&&(de-W>3&&Pi(me,W,de,te),me[de+2]=Me,X-de>3&&Pi(me,de,X,te))}function ct(me,W,X,te,de,Me){var Ie=de-X,Be=Me-te;if(Ie!==0||Be!==0){var ke=((me-X)*Ie+(W-te)*Be)/(Ie*Ie+Be*Be);ke>1?(X=de,te=Me):ke>0&&(X+=Ie*ke,te+=Be*ke)}return(Ie=me-X)*Ie+(Be=W-te)*Be}function It(me,W,X,te){var de={id:me===void 0?null:me,type:W,geometry:X,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var Ie=Me.geometry,Be=Me.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")Ne(Me,Ie);else if(Be==="Polygon"||Be==="MultiLineString")for(var ke=0;ke<Ie.length;ke++)Ne(Me,Ie[ke]);else if(Be==="MultiPolygon")for(ke=0;ke<Ie.length;ke++)for(var G=0;G<Ie[ke].length;G++)Ne(Me,Ie[ke][G])}(de),de}function Ne(me,W){for(var X=0;X<W.length;X+=3)me.minX=Math.min(me.minX,W[X]),me.minY=Math.min(me.minY,W[X+1]),me.maxX=Math.max(me.maxX,W[X]),me.maxY=Math.max(me.maxY,W[X+1])}function je(me,W,X,te){if(W.geometry){var de=W.geometry.coordinates,Me=W.geometry.type,Ie=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Be=[],ke=W.id;if(X.promoteId?ke=W.properties[X.promoteId]:X.generateId&&(ke=te||0),Me==="Point")rt(de,Be);else if(Me==="MultiPoint")for(var G=0;G<de.length;G++)rt(de[G],Be);else if(Me==="LineString")xt(de,Be,Ie,!1);else if(Me==="MultiLineString"){if(X.lineMetrics){for(G=0;G<de.length;G++)xt(de[G],Be=[],Ie,!1),me.push(It(ke,"LineString",Be,W.properties));return}we(de,Be,Ie,!1)}else if(Me==="Polygon")we(de,Be,Ie,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(G=0;G<W.geometry.geometries.length;G++)je(me,{id:ke,geometry:W.geometry.geometries[G],properties:W.properties},X,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(G=0;G<de.length;G++){var Ue=[];we(de[G],Ue,Ie,!0),Be.push(Ue)}}me.push(It(ke,Me,Be,W.properties))}}function rt(me,W){W.push(di(me[0])),W.push(Ve(me[1])),W.push(0)}function xt(me,W,X,te){for(var de,Me,Ie=0,Be=0;Be<me.length;Be++){var ke=di(me[Be][0]),G=Ve(me[Be][1]);W.push(ke),W.push(G),W.push(0),Be>0&&(Ie+=te?(de*G-ke*Me)/2:Math.sqrt(Math.pow(ke-de,2)+Math.pow(G-Me,2))),de=ke,Me=G}var Ue=W.length-3;W[2]=1,Pi(W,0,Ue,X),W[Ue+2]=1,W.size=Math.abs(Ie),W.start=0,W.end=W.size}function we(me,W,X,te){for(var de=0;de<me.length;de++){var Me=[];xt(me[de],Me,X,te),W.push(Me)}}function di(me){return me/360+.5}function Ve(me){var W=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function $e(me,W,X,te,de,Me,Ie,Be){if(te/=W,Me>=(X/=W)&&Ie<te)return me;if(Ie<X||Me>=te)return null;for(var ke=[],G=0;G<me.length;G++){var Ue=me[G],qe=Ue.geometry,Ge=Ue.type,Je=de===0?Ue.minX:Ue.minY,ht=de===0?Ue.maxX:Ue.maxY;if(Je>=X&&ht<te)ke.push(Ue);else if(!(ht<X||Je>=te)){var Rt=[];if(Ge==="Point"||Ge==="MultiPoint")kt(qe,Rt,X,te,de);else if(Ge==="LineString")vn(qe,Rt,X,te,de,!1,Be.lineMetrics);else if(Ge==="MultiLineString")Cn(qe,Rt,X,te,de,!1);else if(Ge==="Polygon")Cn(qe,Rt,X,te,de,!0);else if(Ge==="MultiPolygon")for(var Xt=0;Xt<qe.length;Xt++){var ai=[];Cn(qe[Xt],ai,X,te,de,!0),ai.length&&Rt.push(ai)}if(Rt.length){if(Be.lineMetrics&&Ge==="LineString"){for(Xt=0;Xt<Rt.length;Xt++)ke.push(It(Ue.id,Ge,Rt[Xt],Ue.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(Rt.length===1?(Ge="LineString",Rt=Rt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=Rt.length===3?"Point":"MultiPoint"),ke.push(It(Ue.id,Ge,Rt,Ue.tags))}}}return ke.length?ke:null}function kt(me,W,X,te,de){for(var Me=0;Me<me.length;Me+=3){var Ie=me[Me+de];Ie>=X&&Ie<=te&&(W.push(me[Me]),W.push(me[Me+1]),W.push(me[Me+2]))}}function vn(me,W,X,te,de,Me,Ie){for(var Be,ke,G=wn(me),Ue=de===0?nr:Uo,qe=me.start,Ge=0;Ge<me.length-3;Ge+=3){var Je=me[Ge],ht=me[Ge+1],Rt=me[Ge+2],Xt=me[Ge+3],ai=me[Ge+4],bi=de===0?Je:ht,Yi=de===0?Xt:ai,Mn=!1;Ie&&(Be=Math.sqrt(Math.pow(Je-Xt,2)+Math.pow(ht-ai,2))),bi<X?Yi>X&&(ke=Ue(G,Je,ht,Xt,ai,X),Ie&&(G.start=qe+Be*ke)):bi>te?Yi<te&&(ke=Ue(G,Je,ht,Xt,ai,te),Ie&&(G.start=qe+Be*ke)):ir(G,Je,ht,Rt),Yi<X&&bi>=X&&(ke=Ue(G,Je,ht,Xt,ai,X),Mn=!0),Yi>te&&bi<=te&&(ke=Ue(G,Je,ht,Xt,ai,te),Mn=!0),!Me&&Mn&&(Ie&&(G.end=qe+Be*ke),W.push(G),G=wn(me)),Ie&&(qe+=Be)}var li=me.length-3;Je=me[li],ht=me[li+1],Rt=me[li+2],(bi=de===0?Je:ht)>=X&&bi<=te&&ir(G,Je,ht,Rt),li=G.length-3,Me&&li>=3&&(G[li]!==G[0]||G[li+1]!==G[1])&&ir(G,G[0],G[1],G[2]),G.length&&W.push(G)}function wn(me){var W=[];return W.size=me.size,W.start=me.start,W.end=me.end,W}function Cn(me,W,X,te,de,Me){for(var Ie=0;Ie<me.length;Ie++)vn(me[Ie],W,X,te,de,Me,!1)}function ir(me,W,X,te){me.push(W),me.push(X),me.push(te)}function nr(me,W,X,te,de,Me){var Ie=(Me-W)/(te-W);return me.push(Me),me.push(X+(de-X)*Ie),me.push(1),Ie}function Uo(me,W,X,te,de,Me){var Ie=(Me-X)/(de-X);return me.push(W+(te-W)*Ie),me.push(Me),me.push(1),Ie}function Ji(me,W){for(var X=[],te=0;te<me.length;te++){var de,Me=me[te],Ie=Me.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")de=ut(Me.geometry,W);else if(Ie==="MultiLineString"||Ie==="Polygon"){de=[];for(var Be=0;Be<Me.geometry.length;Be++)de.push(ut(Me.geometry[Be],W))}else if(Ie==="MultiPolygon")for(de=[],Be=0;Be<Me.geometry.length;Be++){for(var ke=[],G=0;G<Me.geometry[Be].length;G++)ke.push(ut(Me.geometry[Be][G],W));de.push(ke)}X.push(It(Me.id,Ie,de,Me.tags))}return X}function ut(me,W){var X=[];X.size=me.size,me.start!==void 0&&(X.start=me.start,X.end=me.end);for(var te=0;te<me.length;te+=3)X.push(me[te]+W,me[te+1],me[te+2]);return X}function Xn(me,W){if(me.transformed)return me;var X,te,de,Me=1<<me.z,Ie=me.x,Be=me.y;for(X=0;X<me.features.length;X++){var ke=me.features[X],G=ke.geometry,Ue=ke.type;if(ke.geometry=[],Ue===1)for(te=0;te<G.length;te+=2)ke.geometry.push(xn(G[te],G[te+1],W,Me,Ie,Be));else for(te=0;te<G.length;te++){var qe=[];for(de=0;de<G[te].length;de+=2)qe.push(xn(G[te][de],G[te][de+1],W,Me,Ie,Be));ke.geometry.push(qe)}}return me.transformed=!0,me}function xn(me,W,X,te,de,Me){return[Math.round(X*(me*te-de)),Math.round(X*(W*te-Me))]}function Lo(me,W,X,te,de){for(var Me=W===de.maxZoom?0:de.tolerance/((1<<W)*de.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:te,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<me.length;Be++){Ie.numFeatures++,qi(Ie,me[Be],Me,de);var ke=me[Be].minX,G=me[Be].minY,Ue=me[Be].maxX,qe=me[Be].maxY;ke<Ie.minX&&(Ie.minX=ke),G<Ie.minY&&(Ie.minY=G),Ue>Ie.maxX&&(Ie.maxX=Ue),qe>Ie.maxY&&(Ie.maxY=qe)}return Ie}function qi(me,W,X,te){var de=W.geometry,Me=W.type,Ie=[];if(Me==="Point"||Me==="MultiPoint")for(var Be=0;Be<de.length;Be+=3)Ie.push(de[Be]),Ie.push(de[Be+1]),me.numPoints++,me.numSimplified++;else if(Me==="LineString")gt(Ie,de,me,X,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(Be=0;Be<de.length;Be++)gt(Ie,de[Be],me,X,Me==="Polygon",Be===0);else if(Me==="MultiPolygon")for(var ke=0;ke<de.length;ke++){var G=de[ke];for(Be=0;Be<G.length;Be++)gt(Ie,G[Be],me,X,!0,Be===0)}if(Ie.length){var Ue=W.tags||null;if(Me==="LineString"&&te.lineMetrics){for(var qe in Ue={},W.tags)Ue[qe]=W.tags[qe];Ue.mapbox_clip_start=de.start/de.size,Ue.mapbox_clip_end=de.end/de.size}var Ge={geometry:Ie,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ue};W.id!==null&&(Ge.id=W.id),me.features.push(Ge)}}function gt(me,W,X,te,de,Me){var Ie=te*te;if(te>0&&W.size<(de?Ie:te))X.numPoints+=W.length/3;else{for(var Be=[],ke=0;ke<W.length;ke+=3)(te===0||W[ke+2]>Ie)&&(X.numSimplified++,Be.push(W[ke]),Be.push(W[ke+1])),X.numPoints++;de&&function(G,Ue){for(var qe=0,Ge=0,Je=G.length,ht=Je-2;Ge<Je;ht=Ge,Ge+=2)qe+=(G[Ge]-G[ht])*(G[Ge+1]+G[ht+1]);if(qe>0===Ue)for(Ge=0,Je=G.length;Ge<Je/2;Ge+=2){var Rt=G[Ge],Xt=G[Ge+1];G[Ge]=G[Je-2-Ge],G[Ge+1]=G[Je-1-Ge],G[Je-2-Ge]=Rt,G[Je-1-Ge]=Xt}}(Be,Me),me.push(Be)}}function ni(me,W){var X=(W=this.options=function(de,Me){for(var Ie in Me)de[Ie]=Me[Ie];return de}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(de,Me){var Ie=[];if(de.type==="FeatureCollection")for(var Be=0;Be<de.features.length;Be++)je(Ie,de.features[Be],Me,Be);else je(Ie,de.type==="Feature"?de:{geometry:de},Me);return Ie}(me,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(de,Me){var Ie=Me.buffer/Me.extent,Be=de,ke=$e(de,1,-1-Ie,Ie,0,-1,2,Me),G=$e(de,1,1-Ie,2+Ie,0,-1,2,Me);return(ke||G)&&(Be=$e(de,1,-Ie,1+Ie,0,-1,2,Me)||[],ke&&(Be=Ji(ke,1).concat(Be)),G&&(Be=Be.concat(Ji(G,-1)))),Be}(te,W),te.length&&this.splitTile(te,0,0,0),X&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yt(me,W,X){return 32*((1<<me)*X+W)+me}function Zi(me,W){return W?me.properties[W]:me.id}function yr(me,W){if(me==null)return!0;if(me.type==="Feature")return Zi(me,W)!=null;if(me.type==="FeatureCollection"){const X=new Set;for(const te of me.features){const de=Zi(te,W);if(de==null||X.has(de))return!1;X.add(de)}return!0}return!1}function ti(me,W){const X=new Map;if(me!=null)if(me.type==="Feature")X.set(Zi(me,W),me);else for(const te of me.features)X.set(Zi(te,W),te);return X}ni.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ni.prototype.splitTile=function(me,W,X,te,de,Me,Ie){for(var Be=[me,W,X,te],ke=this.options,G=ke.debug;Be.length;){te=Be.pop(),X=Be.pop(),W=Be.pop(),me=Be.pop();var Ue=1<<W,qe=Yt(W,X,te),Ge=this.tiles[qe];if(!Ge&&(G>1&&console.time("creation"),Ge=this.tiles[qe]=Lo(me,W,X,te,ke),this.tileCoords.push({z:W,x:X,y:te}),G)){G>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,te,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Je="z"+W;this.stats[Je]=(this.stats[Je]||0)+1,this.total++}if(Ge.source=me,de){if(W===ke.maxZoom||W===de)continue;var ht=1<<de-W;if(X!==Math.floor(Me/ht)||te!==Math.floor(Ie/ht))continue}else if(W===ke.indexMaxZoom||Ge.numPoints<=ke.indexMaxPoints)continue;if(Ge.source=null,me.length!==0){G>1&&console.time("clipping");var Rt,Xt,ai,bi,Yi,Mn,li=.5*ke.buffer/ke.extent,un=.5-li,On=.5+li,ur=1+li;Rt=Xt=ai=bi=null,Yi=$e(me,Ue,X-li,X+On,0,Ge.minX,Ge.maxX,ke),Mn=$e(me,Ue,X+un,X+ur,0,Ge.minX,Ge.maxX,ke),me=null,Yi&&(Rt=$e(Yi,Ue,te-li,te+On,1,Ge.minY,Ge.maxY,ke),Xt=$e(Yi,Ue,te+un,te+ur,1,Ge.minY,Ge.maxY,ke),Yi=null),Mn&&(ai=$e(Mn,Ue,te-li,te+On,1,Ge.minY,Ge.maxY,ke),bi=$e(Mn,Ue,te+un,te+ur,1,Ge.minY,Ge.maxY,ke),Mn=null),G>1&&console.timeEnd("clipping"),Be.push(Rt||[],W+1,2*X,2*te),Be.push(Xt||[],W+1,2*X,2*te+1),Be.push(ai||[],W+1,2*X+1,2*te),Be.push(bi||[],W+1,2*X+1,2*te+1)}}},ni.prototype.getTile=function(me,W,X){var te=this.options,de=te.extent,Me=te.debug;if(me<0||me>24)return null;var Ie=1<<me,Be=Yt(me,W=(W%Ie+Ie)%Ie,X);if(this.tiles[Be])return Xn(this.tiles[Be],de);Me>1&&console.log("drilling down to z%d-%d-%d",me,W,X);for(var ke,G=me,Ue=W,qe=X;!ke&&G>0;)G--,Ue=Math.floor(Ue/2),qe=Math.floor(qe/2),ke=this.tiles[Yt(G,Ue,qe)];return ke&&ke.source?(Me>1&&console.log("found parent tile z%d-%d-%d",G,Ue,qe),Me>1&&console.time("drilling down"),this.splitTile(ke.source,G,Ue,qe,me,W,X),Me>1&&console.timeEnd("drilling down"),this.tiles[Be]?Xn(this.tiles[Be],de):null):null};class eo extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return d._(this,void 0,void 0,function*(){const te=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!de)return null;const Me=new class{constructor(Be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.W,this.length=Be.length,this._features=Be}feature(Be){return new class{constructor(ke){this._feature=ke,this.extent=d.W,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const G of this._feature.geometry)ke.push([new d.P(G[0],G[1])]);return ke}{const ke=[];for(const G of this._feature.geometry){const Ue=[];for(const qe of G)Ue.push(new d.P(qe[0],qe[1]));ke.push(Ue)}return ke}}toGeoJSON(ke,G,Ue){return D.call(this,ke,G,Ue)}}(this._features[Be])}}(de.features);let Ie=pt(Me);return Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),{vectorTile:Me,rawData:Ie.buffer}})}loadData(W){return d._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const te=!!(W&&W.request&&W.request.collectResourceTiming)&&new d.bs(W.request);this._pendingRequest=new AbortController;try{let de=yield this.loadGeoJSON(W,this._pendingRequest);if(delete this._pendingRequest,typeof de!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(R(de,!0),W.filter){const Ie=d.by(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(ke=>Ie.value.evaluate({zoom:0},ke))}}this._geoJSONIndex=W.cluster?new Mt(function({superclusterOptions:Ie,clusterProperties:Be}){if(!Be||!Ie)return Ie;const ke={},G={},Ue={accumulated:null,zoom:0},qe={properties:null},Ge=Object.keys(Be);for(const Je of Ge){const[ht,Rt]=Be[Je],Xt=d.by(Rt),ai=d.by(typeof ht=="string"?[ht,["accumulated"],["get",Je]]:ht);ke[Je]=Xt.value,G[Je]=ai.value}return Ie.map=Je=>{qe.properties=Je;const ht={};for(const Rt of Ge)ht[Rt]=ke[Rt].evaluate(Ue,qe);return ht},Ie.reduce=(Je,ht)=>{qe.properties=ht;for(const Rt of Ge)Ue.accumulated=Je[Rt],Je[Rt]=G[Rt].evaluate(Ue,qe)},Ie}(W)).load(de.features):function(Ie,Be){return new ni(Ie,Be)}(de,W.geojsonVtOptions),this.loaded={};const Me={};if(te){const Ie=te.finish();Ie&&(Me.resourceTiming={},Me.resourceTiming[W.source]=JSON.parse(JSON.stringify(Ie)))}return Me}catch(de){if(delete this._pendingRequest,d.bz(de))return{abandoned:!0};throw de}})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadGeoJSON(W,X){return d._(this,void 0,void 0,function*(){const{promoteId:te}=W;if(W.request){const de=yield d.h(W.request,X);return this._dataUpdateable=yr(de.data,te)?ti(de.data,te):void 0,de.data}if(typeof W.data=="string")try{const de=JSON.parse(W.data);return this._dataUpdateable=yr(de,te)?ti(de,te):void 0,de}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(de,Me,Ie){var Be,ke,G,Ue;if(Me.removeAll&&de.clear(),Me.remove)for(const qe of Me.remove)de.delete(qe);if(Me.add)for(const qe of Me.add){const Ge=Zi(qe,Ie);Ge!=null&&de.set(Ge,qe)}if(Me.update)for(const qe of Me.update){let Ge=de.get(qe.id);if(Ge==null)continue;const Je=!qe.removeAllProperties&&(((Be=qe.removeProperties)===null||Be===void 0?void 0:Be.length)>0||((ke=qe.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((qe.newGeometry||qe.removeAllProperties||Je)&&(Ge=Object.assign({},Ge),de.set(qe.id,Ge),Je&&(Ge.properties=Object.assign({},Ge.properties))),qe.newGeometry&&(Ge.geometry=qe.newGeometry),qe.removeAllProperties)Ge.properties={};else if(((G=qe.removeProperties)===null||G===void 0?void 0:G.length)>0)for(const ht of qe.removeProperties)Object.prototype.hasOwnProperty.call(Ge.properties,ht)&&delete Ge.properties[ht];if(((Ue=qe.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:ht,value:Rt}of qe.addOrUpdateProperties)Ge.properties[ht]=Rt}}(this._dataUpdateable,W.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class cn{constructor(W){this.self=W,this.actor=new d.C(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,te)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=te},this.self.addProtocol=d.bf,this.self.removeProtocol=d.bg,this.self.registerRTLTextPlugin=X=>{if(d.bA.isParsed())throw new Error("RTL text plugin already registered.");d.bA.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,te)=>this._getDEMWorkerSource(X,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(X,te)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(X,te)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(X,te)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(X,te)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(X,te)=>this._getWorkerSource(X,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("LT",(X,te)=>this._getWorkerSource(X,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(X,te)=>this._getWorkerSource(X,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(X,te)=>this._getWorkerSource(X,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(X,te)=>this._getWorkerSource(X,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(X,te)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][te.type]||!this.workerSources[X][te.type][te.source])return;const de=this.workerSources[X][te.type][te.source];delete this.workerSources[X][te.type][te.source],de.removeSource!==void 0&&de.removeSource(te)})),this.actor.registerMessageHandler("RM",X=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,te)=>d._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(X,te)=>this._syncRTLPluginState(X,te)),this.actor.registerMessageHandler("IS",(X,te)=>d._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(X,te)=>this._setImages(X,te)),this.actor.registerMessageHandler("UL",(X,te)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(te.layers,te.removedIds)})),this.actor.registerMessageHandler("SL",(X,te)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(te)}))}_setImages(W,X){return d._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const te in this.workerSources[W]){const de=this.workerSources[W][te];for(const Me in de)de[Me].availableImages=X}})}_syncRTLPluginState(W,X){return d._(this,void 0,void 0,function*(){if(d.bA.isParsed())return d.bA.getState();if(X.pluginStatus!=="loading")return d.bA.setState(X),X;const te=X.pluginURL;if(this.self.importScripts(te),d.bA.isParsed()){const de={pluginStatus:"loaded",pluginURL:te};return d.bA.setState(de),de}throw d.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${te}`)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new a),X}_getWorkerSource(W,X,te){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][te]){const de={sendAsync:(Me,Ie)=>(Me.targetMapId=W,this.actor.sendAsync(Me,Ie))};switch(X){case"vector":this.workerSources[W][X][te]=new k(de,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][te]=new eo(de,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][te]=new this.externalWorkerSourceTypes[X](de,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][te]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new C),this.demWorkerSources[W][X]}}return d.i(self)&&(self.worker=new cn(self)),cn}),l("index",["exports","./shared"],function(d,a){var _="4.1.3";let x,S;const k={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((r,h)=>{const p=requestAnimationFrame(r);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(y,r=0){return this.getImageCanvasContext(y).getImageData(-r,-r,y.width+2*r,y.height+2*r)},getImageCanvasContext(y){const r=window.document.createElement("canvas"),h=r.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return r.width=y.width,r.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(x||(x=document.createElement("a")),x.href=y,x.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class C{static testProp(r){if(!C.docStyle)return r[0];for(let h=0;h<r.length;h++)if(r[h]in C.docStyle)return r[h];return r[0]}static create(r,h,p){const m=window.document.createElement(r);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(r,h){return window.document.createElementNS(r,h)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(r,h){r.style[C.transformProp]=h}static addEventListener(r,h,p,m={}){r.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(r,h,p,m={}){r.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(r){const h=r.getBoundingClientRect();return{x:h.width/r.offsetWidth||1,y:h.height/r.offsetHeight||1,boundingClientRect:h}}static getPoint(r,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-r.clientLeft,(p.clientY-m.top)/h.y-r.clientTop)}static mousePos(r,h){const p=C.getScale(r);return C.getPoint(r,p,h)}static touchPos(r,h){const p=[],m=C.getScale(r);for(let b=0;b<h.length;b++)p.push(C.getPoint(r,m,h[b]));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(y){!D&&R&&(B?N(y):z=y)}};let z,R,D=!1,B=!1;function N(y){const r=y.createTexture();y.bindTexture(y.TEXTURE_2D,r);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,R),y.isContextLost())return;L.supported=!0}catch{}y.deleteTexture(r),D=!0}var V;typeof document<"u"&&(R=document.createElement("img"),R.onload=function(){z&&N(z),z=null,B=!0},R.onerror=function(){D=!0,z=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let r,h,p,m;y.resetRequestQueue=()=>{r=[],h=0,p=0,m={}},y.addThrottleControl=A=>{const F=p++;return m[F]=A,F},y.removeThrottleControl=A=>{delete m[A],E()},y.getImage=(A,F,q=!0)=>new Promise((Z,J)=>{L.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),a.e(A,{type:"image"}),r.push({abortController:F,requestParameters:A,supportImageRefresh:q,state:"queued",onError:pe=>{J(pe)},onSuccess:pe=>{Z(pe)}}),E()});const b=A=>a._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:F,supportImageRefresh:q,onError:Z,onSuccess:J,abortController:pe}=A,fe=q===!1&&!a.i(self)&&!a.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((Ee,Ze)=>Ee&&Ze==="accept",!0));h++;const _e=fe?M(F,pe):a.m(F,pe);try{const Ee=yield _e;delete A.abortController,A.state="completed",Ee.data instanceof HTMLImageElement||a.b(Ee.data)?J(Ee):Ee.data&&J({data:yield(se=Ee.data,typeof createImageBitmap=="function"?a.d(se):a.f(se)),cacheControl:Ee.cacheControl,expires:Ee.expires})}catch(Ee){delete A.abortController,Z(Ee)}finally{h--,E()}var se}),E=()=>{const A=(()=>{for(const F of Object.keys(m))if(m[F]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=h;F<A&&r.length>0;F++){const q=r.shift();q.abortController.signal.aborted?F--:b(q)}},M=(A,F)=>new Promise((q,Z)=>{const J=new Image,pe=A.url,fe=A.credentials;fe&&fe==="include"?J.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!a.s(pe))&&(J.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{J.src="",Z(a.c())}),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,q({data:J})},J.onerror=()=>{J.onerror=J.onload=null,F.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=pe})}(V||(V={})),V.resetRequestQueue();class U{constructor(r){this._transformRequestFn=r}transformRequest(r,h){return this._transformRequestFn&&this._transformRequestFn(r,h)||{url:r}}normalizeSpriteURL(r,h,p){const m=function(b){const E=b.match(le);if(!E)throw new Error(`Unable to parse URL "${b}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(r);return m.path+=`${h}${p}`,function(b){const E=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${E}`}(m)}setTransformRequest(r){this._transformRequestFn=r}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function oe(y){var r=new a.A(3);return r[0]=y[0],r[1]=y[1],r[2]=y[2],r}var H,ee=function(y,r,h){return y[0]=r[0]-h[0],y[1]=r[1]-h[1],y[2]=r[2]-h[2],y};H=new a.A(3),a.A!=Float32Array&&(H[0]=0,H[1]=0,H[2]=0);var be=function(y){var r=y[0],h=y[1];return r*r+h*h};function Oe(y){const r=[];if(typeof y=="string")r.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:p,url:m}of y){const b=`${p}${m}`;h.indexOf(b)===-1&&(h.push(b),r.push({id:p,url:m}))}}return r}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class ne{constructor(r,h,p,m){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(h,m)}update(r,h,p){const{width:m,height:b}=r,E=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:M}=this,{gl:A}=M;if(this.useMipmap=!!(h&&h.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[m,b],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,m,b,0,this.format,A.UNSIGNED_BYTE,r.data);else{const{x:F,y:q}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?A.texSubImage2D(A.TEXTURE_2D,0,F,q,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,F,q,m,b,A.RGBA,A.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(r,h,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),r!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,r),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||r),this.filter=r),h!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function ye(y){const{userImage:r}=y;return!!(r&&r.render&&r.render())&&(y.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ke extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(r){const h=this.images[r];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(r,h){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,h)&&(this.images[r]=h)}_validate(r,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,h){if(!r)return!0;let p=0;for(const m of r){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(r,h){if(!r)return!0;if(r.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,b=p&&p.height||h.data.height;return!(r[0]<0||m<r[0]||r[1]<0||b<r[1]||r[2]<0||m<r[2]||r[3]<0||b<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,h,p=!0){const m=this.getImage(r);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[r]=h,this.updatedImages[r]=!0}removeImage(r){const h=this.images[r];delete this.images[r],delete this.patterns[r],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const b of r)this.images[b]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:h})})}_getImagesForIds(r){const h={};for(const p of r){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:r,height:h}=this.atlasImage;return{width:r,height:h}}getPattern(r){const h=this.patterns[r],p=this.getImage(r);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new a.I(m,p);this.patterns[r]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const h=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ne(r,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const b in this.patterns)r.push(this.patterns[b].bin);const{w:h,h:p}=a.p(r),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],M=E.x+1,A=E.y+1,F=this.getImage(b).data,q=F.width,Z=F.height;a.R.copy(F,m,{x:0,y:0},{x:M,y:A},{width:q,height:Z}),a.R.copy(F,m,{x:0,y:Z-1},{x:M,y:A-1},{width:q,height:1}),a.R.copy(F,m,{x:0,y:0},{x:M,y:A+Z},{width:q,height:1}),a.R.copy(F,m,{x:q-1,y:0},{x:M-1,y:A},{width:1,height:Z}),a.R.copy(F,m,{x:0,y:0},{x:M+q,y:A},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const h of r){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ye(p)&&this.updateImage(h,p)}}}const Ce=1e20;function et(y,r,h,p,m,b,E,M,A){for(let F=r;F<r+p;F++)vt(y,h*b+F,b,m,E,M,A);for(let F=h;F<h+m;F++)vt(y,F*b+r,1,p,E,M,A)}function vt(y,r,h,p,m,b,E){b[0]=0,E[0]=-Ce,E[1]=Ce,m[0]=y[r];for(let M=1,A=0,F=0;M<p;M++){m[M]=y[r+M*h];const q=M*M;do{const Z=b[A];F=(m[M]-m[Z]+q-Z*Z)/(M-Z)/2}while(F<=E[A]&&--A>-1);A++,b[A]=M,E[A]=F,E[A+1]=Ce}for(let M=0,A=0;M<p;M++){for(;E[A+1]<M;)A++;const F=b[A],q=M-F;y[r+M*h]=m[F]+q*q}}class pt{constructor(r,h){this.requestManager=r,this.localIdeographFontFamily=h,this.entries={}}setURL(r){this.url=r}getGlyphs(r){return a._(this,void 0,void 0,function*(){const h=[];for(const b in r)for(const E of r[b])h.push(this._getAndCacheGlyphsPromise(b,E));const p=yield Promise.all(h),m={};for(const{stack:b,id:E,glyph:M}of p)m[b]||(m[b]={}),m[b][E]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return m})}_getAndCacheGlyphsPromise(r,h){return a._(this,void 0,void 0,function*(){let p=this.entries[r];p||(p=this.entries[r]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:r,id:h,glyph:m};if(m=this._tinySDF(p,r,h),m)return p.glyphs[h]=m,{stack:r,id:h,glyph:m};const b=Math.floor(h/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:r,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const M=pt.loadGlyphRange(r,b,this.url,this.requestManager);p.requests[b]=M}const E=yield p.requests[b];for(const M in E)this._doesCharSupportLocalGlyph(+M)||(p.glyphs[+M]=E[+M]);return p.ranges[b]=!0,{stack:r,id:h,glyph:E[h]||null}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](r)||a.u["Hangul Syllables"](r)||a.u.Hiragana(r)||a.u.Katakana(r))}_tinySDF(r,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=r.tinySDF;if(!b){let M="400";/bold/i.test(h)?M="900":/medium/i.test(h)?M="500":/light/i.test(h)&&(M="200"),b=r.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:M})}const E=b.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(y,r,h,p){return a._(this,void 0,void 0,function*(){const m=256*r,b=m+255,E=p.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${b}`),"Glyphs"),M=yield a.l(E,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${r}, ${m}-${b}`);const A={};for(const F of a.n(M.data))A[F.id]=F;return A})},pt.TinySDF=class{constructor({fontSize:y=24,buffer:r=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:E="normal"}={}){this.buffer=r,this.cutoff=p,this.radius=h;const M=this.size=y+4*r,A=this._createCanvas(M),F=this.ctx=A.getContext("2d",{willReadFrequently:!0});F.font=`${E} ${b} ${y}px ${m}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(y){const r=document.createElement("canvas");return r.width=r.height=y,r}draw(y){const{width:r,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(y),E=Math.ceil(h),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),A=Math.min(this.size-this.buffer,E+Math.ceil(p)),F=M+2*this.buffer,q=A+2*this.buffer,Z=Math.max(F*q,0),J=new Uint8ClampedArray(Z),pe={data:J,width:F,height:q,glyphWidth:M,glyphHeight:A,glyphTop:E,glyphLeft:0,glyphAdvance:r};if(M===0||A===0)return pe;const{ctx:fe,buffer:_e,gridInner:se,gridOuter:Ee}=this;fe.clearRect(_e,_e,M,A),fe.fillText(y,_e,_e+E);const Ze=fe.getImageData(_e,_e,M,A);Ee.fill(Ce,0,Z),se.fill(0,0,Z);for(let ve=0;ve<A;ve++)for(let De=0;De<M;De++){const We=Ze.data[4*(ve*M+De)+3]/255;if(We===0)continue;const He=(ve+_e)*F+De+_e;if(We===1)Ee[He]=0,se[He]=Ce;else{const Xe=.5-We;Ee[He]=Xe>0?Xe*Xe:0,se[He]=Xe<0?Xe*Xe:0}}et(Ee,0,0,F,q,F,this.f,this.v,this.z),et(se,_e,_e,M,A,F,this.f,this.v,this.z);for(let ve=0;ve<Z;ve++){const De=Math.sqrt(Ee[ve])-Math.sqrt(se[ve]);J[ve]=Math.round(255-255*(De/this.radius+this.cutoff))}return pe}};class st{constructor(){this.specification=a.v.light.position}possiblyEvaluate(r,h){return a.y(r.expression.evaluate(h))}interpolate(r,h,p){return{x:a.z.number(r.x,h.x,p),y:a.z.number(r.y,h.y,p),z:a.z.number(r.z,h.z,p)}}}let Ht;class ii extends a.E{constructor(r){super(),Ht=Ht||new a.q({anchor:new a.D(a.v.light.anchor),position:new st,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ht),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h={}){if(!this._validate(a.r,r,h))for(const p in r){const m=r[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,p){return(!p||p.validate!==!1)&&a.t(this,r.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Ot{constructor(r,h){this.width=r,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,h){const p=r.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(r,h)),this.dashEntry[p]}getDashRanges(r,h,p){const m=[];let b=r.length%2==1?-r[r.length-1]*p:0,E=r[0]*p,M=!0;m.push({left:b,right:E,isDash:M,zeroLength:r[0]===0});let A=r[0];for(let F=1;F<r.length;F++){M=!M;const q=r[F];b=A*p,A+=q,E=A*p,m.push({left:b,right:E,isDash:M,zeroLength:q===0})}return m}addRoundDash(r,h,p){const m=h/2;for(let b=-p;b<=p;b++){const E=this.width*(this.nextRow+p+b);let M=0,A=r[M];for(let F=0;F<this.width;F++){F/A.right>1&&(A=r[++M]);const q=Math.abs(F-A.left),Z=Math.abs(F-A.right),J=Math.min(q,Z);let pe;const fe=b/p*(m+1);if(A.isDash){const _e=m-Math.abs(fe);pe=Math.sqrt(J*J+_e*_e)}else pe=m-Math.sqrt(J*J+fe*fe);this.data[E+F]=Math.max(0,Math.min(255,pe+128))}}}addRegularDash(r){for(let M=r.length-1;M>=0;--M){const A=r[M],F=r[M+1];A.zeroLength?r.splice(M,1):F&&F.isDash===A.isDash&&(F.left=A.left,r.splice(M,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let b=0,E=r[b];for(let M=0;M<this.width;M++){M/E.right>1&&(E=r[++b]);const A=Math.abs(M-E.left),F=Math.abs(M-E.right),q=Math.min(A,F);this.data[m+M]=Math.max(0,Math.min(255,(E.isDash?q:-q)+128))}}addDash(r,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let M=0;M<r.length;M++)b+=r[M];if(b!==0){const M=this.width/b,A=this.getDashRanges(r,this.width,M);h?this.addRoundDash(A,M,p):this.addRegularDash(A)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,E}bind(r){const h=r.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const Mt=Math.floor(k.hardwareConcurrency/2);let ei,Vt;function hi(){return ei||(ei=new Jt),ei}Jt.workerCount=a.B(globalThis)?Math.max(Math.min(Mt,3),1):1;class xi{constructor(r,h){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const b=new a.C(p[m],h);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:r,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,h){for(const p of this.actors)p.registerMessageHandler(r,h)}}function gi(){return Vt||(Vt=new xi(hi(),a.G),Vt.registerMessageHandler("GR",(y,r,h)=>a.m(r,h))),Vt}function Pi(y,r){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*y.width,.5*y.height,1]),a.K(h,h,y.calculatePosMatrix(r.toUnwrapped()))}function ct(y,r,h,p,m,b){const E=function(Z,J,pe){if(Z)for(const fe of Z){const _e=J[fe];if(_e&&_e.source===pe&&_e.type==="fill-extrusion")return!0}else for(const fe in J){const _e=J[fe];if(_e.source===pe&&_e.type==="fill-extrusion")return!0}return!1}(m&&m.layers,r,y.id),M=b.maxPitchScaleFactor(),A=y.tilesIn(p,M,E);A.sort(It);const F=[];for(const Z of A)F.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(r,h,y._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,m,b,M,Pi(y.transform,Z.tileID))});const q=function(Z){const J={},pe={};for(const fe of Z){const _e=fe.queryResults,se=fe.wrappedTileID,Ee=pe[se]=pe[se]||{};for(const Ze in _e){const ve=_e[Ze],De=Ee[Ze]=Ee[Ze]||{},We=J[Ze]=J[Ze]||[];for(const He of ve)De[He.featureIndex]||(De[He.featureIndex]=!0,We.push(He))}}return J}(F);for(const Z in q)q[Z].forEach(J=>{const pe=J.feature,fe=y.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=fe});return q}function It(y,r){const h=y.tileID,p=r.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function Ne(y,r,h){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(r.transformRequest(y.url,"Source"),h)).data:yield k.frameAsync(h),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class je{constructor(r,h){r&&(h?this.setSouthWest(r).setNorthEast(h):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}setSouthWest(r){return this._sw=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}extend(r){const h=this._sw,p=this._ne;let m,b;if(r instanceof a.M)m=r,b=r;else{if(!(r instanceof je))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(je.convert(r)):this.extend(a.M.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(a.M.convert(r)):this;if(m=r._sw,b=r._ne,!m||!b)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(b.lng,b.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:h,lat:p}=a.M.convert(r);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(r){return r instanceof je?r:r&&new je(r)}static fromLngLat(r,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*r.lat);return new je(new a.M(r.lng-m,r.lat-p),new a.M(r.lng+m,r.lat+p))}}class rt{constructor(r,h,p){this.bounds=je.convert(this.validateBounds(r)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const h=Math.pow(2,r.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),b=Math.ceil(a.N(this.bounds.getEast())*h),E=Math.ceil(a.O(this.bounds.getSouth())*h);return r.x>=p&&r.x<b&&r.y>=m&&r.y<E}}class xt extends a.E{constructor(r,h,p,m){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(a.e(this,r),r.bounds&&(this.tileBounds=new rt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((b,E)=>{r.reloadPromise={resolve:b,reject:E}})}else r.actor=this.dispatcher.getActor(),m="LT";r.abortController=new AbortController;try{const b=yield r.actor.sendAsync({type:m,data:p},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,b)}catch(b){if(delete r.abortController,r.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(r,null)}})}_afterTileLoadWorkerResponse(r,h){if(h&&h.resourceTiming&&(r.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&r.setExpiryData(h),r.loadVectorData(h,this.map.painter),r.reloadPromise){const p=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(p.resolve).catch(p.reject)}}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class we extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(a.e(this,r),r.bounds&&(this.tileBounds=new rt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return a.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const p=yield V.getImage(this.map._requestManager.transformRequest(h,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&r.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,E=p.data;r.texture=this.map.painter.getTileTexture(E.width),r.texture?r.texture.update(E,{useMipmap:!0}):(r.texture=new ne(m,E,b.RGBA,{useMipmap:!0}),r.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),r.state="loaded"}}catch(p){if(delete r.abortController,r.aborted)r.state="unloaded";else if(p)throw r.state="errored",p}})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class di extends we{constructor(r,h,p,m){super(r,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const m=yield V.getImage(p,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&r.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=a.b(b)&&a.S()?b:yield this.readImageNow(b),M={type:this.type,uid:r.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const A=yield r.actor.sendAsync({type:"LDT",data:M});r.dem=A,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(m){if(delete r.abortController,r.aborted)r.state="unloaded";else if(m)throw r.state="errored",m}})}readImageNow(r){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=r.width+2,p=r.height+2;try{return new a.R({width:h,height:p},yield a.V(r,-1,-1,h,p))}catch{}}return k.getImageData(r,1)})}_getNeighboringTiles(r){const h=r.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,b=h.x===0?r.wrap-1:r.wrap,E=(h.x+1+p)%p,M=h.x+1===p?r.wrap+1:r.wrap,A={};return A[new a.Q(r.overscaledZ,b,h.z,m,h.y).key]={backfilled:!1},A[new a.Q(r.overscaledZ,M,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(A[new a.Q(r.overscaledZ,b,h.z,m,h.y-1).key]={backfilled:!1},A[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},A[new a.Q(r.overscaledZ,M,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(A[new a.Q(r.overscaledZ,b,h.z,m,h.y+1).key]={backfilled:!1},A[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},A[new a.Q(r.overscaledZ,M,h.z,E,h.y+1).key]={backfilled:!1}),A}unloadTile(r){return a._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}class Ve extends a.E{constructor(r,h,p,m){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const b=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*b,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*b,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:h,offset:p}})}_updateWorkerData(r){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);r?h.dataDiff=r:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(k.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(b,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.actor?"RT":"LT";r.actor=this.actor;const p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var $e=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kt extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(r){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield V.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,r&&(this.coordinates=r),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const h=r.map(a.Y.fromLngLat);this.tileID=function(m){let b=1/0,E=1/0,M=-1/0,A=-1/0;for(const J of m)b=Math.min(b,J.x),E=Math.min(E,J.y),M=Math.max(M,J.x),A=Math.max(A,J.y);const F=Math.max(M-b,A-E),q=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),Z=Math.pow(2,q);return new a.a0(q,Math.floor((b+M)/2*Z),Math.floor((E+A)/2*Z))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ne(r,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class vn extends kt{constructor(r,h,p,m){super(r,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const h of r.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const h=this.video.seekable;r<h.start(0)||r>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ne(r,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wn extends kt{constructor(r,h,p,m){super(r,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ne(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const E=this.tiles[b];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Cn={},ir=y=>{switch(y){case"geojson":return Ve;case"image":return kt;case"raster":return we;case"raster-dem":return di;case"vector":return xt;case"video":return vn;case"canvas":return wn}return Cn[y]},nr="RTLPluginLoaded";class Uo extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=gi()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=k.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(nr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ji=null;function ut(){return Ji||(Ji=new Uo),Ji}class Xn{constructor(r,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const h=r+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(m,b){const E={};if(!b)return E;for(const M of m){const A=M.layerIds.map(F=>b.getLayer(F)).filter(Boolean);if(A.length!==0){M.layers=A,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(F=>A.filter(q=>q.id===F)[0]));for(const F of A)E[F.id]=M}}return E}(r.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5&&b.hasRTLText){this.hasRTLText=!0,ut().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(b))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(r)}const h=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ne(r,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ne(r,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,h,p,m,b,E,M,A,F,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:q,transform:A,params:M,queryPadding:this.queryPadding*F},r,h,p):{}}querySourceFeatures(r,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=h&&h.sourceLayer?h.sourceLayer:"",E=m._geojsonTileLayer||m[b];if(!E)return;const M=a.a6(h&&h.filter),{z:A,x:F,y:q}=this.tileID.canonical,Z={z:A,x:F,y:q};for(let J=0;J<E.length;J++){const pe=E.feature(J);if(M.needGeometry){const se=a.a7(pe,!0);if(!M.filter(new a.a8(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!M.filter(new a.a8(this.tileID.overscaledZ),pe))continue;const fe=p.getId(pe,b),_e=new a.a9(pe,A,F,q,fe);_e.tile=Z,r.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const h=this.expirationTime;if(r.cacheControl){const p=a.aa(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const b=this.expirationTime-h;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const b=this.buckets[m],E=b.layers[0].sourceLayer||"_geojsonTileLayer",M=p[E],A=r[E];if(!M||!A||Object.keys(A).length===0)continue;b.update(A,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=h&&h.style&&h.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<k.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=k.now()+r}setDependencies(r,h){const p={};for(const m of h)p[m]=!0;this.dependencies[r]=p}hasDependency(r,h){for(const p of r){const m=this.dependencies[p];if(m){for(const b of h)if(m[b])return!0}}return!1}}class xn{constructor(r,h){this.max=r,this.onRemove=h,this.reset()}reset(){for(const r in this.data)for(const h of this.data[r])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(r,h,p){const m=r.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:h,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(r,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const h=this.data[r].shift();return h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),h.value}getByKey(r){const h=this.data[r];return h?h[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,h){if(!this.has(r))return this;const p=r.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(r){const h=[];for(const p in this.data)for(const m of this.data[p])r(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Lo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,h,p){const m=String(h);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][m]=this.stateChanges[r][m]||{},a.e(this.stateChanges[r][m],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const b in this.state[r])b!==m&&(this.deletedStates[r][b]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][m]===null){this.deletedStates[r][m]={};for(const b in this.state[r][m])p[b]||(this.deletedStates[r][m][b]=null)}else for(const b in p)this.deletedStates[r]&&this.deletedStates[r][m]&&this.deletedStates[r][m][b]===null&&delete this.deletedStates[r][m][b]}removeFeatureState(r,h,p){if(this.deletedStates[r]===null)return;const m=String(h);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&h!==void 0)this.deletedStates[r][m]!==null&&(this.deletedStates[r][m]=this.deletedStates[r][m]||{},this.deletedStates[r][m][p]=null);else if(h!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][m])for(p in this.deletedStates[r][m]={},this.stateChanges[r][m])this.deletedStates[r][m][p]=null;else this.deletedStates[r][m]=null;else this.deletedStates[r]=null}getState(r,h){const p=String(h),m=a.e({},(this.state[r]||{})[p],(this.stateChanges[r]||{})[p]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const b=this.deletedStates[r][h];if(b===null)return{};for(const E in b)delete m[E]}return m}initializeTileState(r,h){r.setFeatureState(this.state,h)}coalesceChanges(r,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),a.e(this.state[m][E],this.stateChanges[m][E]),b[E]=this.state[m][E];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const E in this.state[m])b[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const M of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][M];b[E]=this.state[m][E]}p[m]=p[m]||{},a.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in r)r[m].setFeatureState(p,h)}}class qi extends a.E{constructor(r,h,p){super(),this.id=r,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,E,M)=>{const A=new(ir(b.type))(m,b,E,M);if(A.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${A.id}`);return A})(r,h,p,this),this._tiles={},this._cache=new xn(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lo,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const h=this._tiles[r];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,h,p)}catch(m){r.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new a.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(r),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(gt).map(r=>r.key)}getRenderableIds(r){const h=[];for(const p in this._tiles)this._isIdRenderable(p,r)&&h.push(this._tiles[p]);return r?h.sort((p,m)=>{const b=p.tileID,E=m.tileID,M=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),A=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-E.overscaledZ||A.y-M.y||A.x-M.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(gt).map(p=>p.key)}hasRenderableParent(r){const h=this.findLoadedParent(r,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(r,h){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(h||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,r,h))})}_tileLoaded(r,h,p){r.timeAdded=k.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(h,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const b=h[m];if(r.neighboringTiles&&r.neighboringTiles[b]){const E=this.getTileByID(b);p(r,E),p(E,r)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=b.tileID.canonical.x-m.tileID.canonical.x;const M=b.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),F=b.tileID.key;E===0&&M===0||Math.abs(M)>1||(Math.abs(E)>1&&(Math.abs(E+A)===1?E+=A:Math.abs(E-A)===1&&(E-=A)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,E,M),m.neighboringTiles&&m.neighboringTiles[F]&&(m.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,h,p,m){for(const b in this._tiles){let E=this._tiles[b];if(m[b]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let M=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const F=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[F.key],E&&E.hasData()&&(M=F)}let A=M;for(;A.overscaledZ>h;)if(A=A.scaledTo(A.overscaledZ-1),r[A.key]){m[M.key]=M;break}}}findLoadedParent(r,h){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=r.overscaledZ-1;p>=h;p--){const m=r.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}_getLoadedTile(r){const h=this._tiles[r.key];return h&&h.hasData()?h:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const h=Math.ceil(r.width/this._source.tileSize)+1,p=Math.ceil(r.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(r){const h=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,h){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(r,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=r,this.terrain=h,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new a.Q(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(p=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(q=>this._source.hasTile(q)))):p=[];const m=r.coveringZoomLevel(this._source),b=Math.max(m-qi.maxOverzooming,this._source.minzoom),E=Math.max(m+qi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const Z of p)if(Z.canonical.z>this._source.minzoom){const J=Z.scaledTo(Z.canonical.z-1);q[J.key]=J;const pe=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));q[pe.key]=pe}p=p.concat(Object.values(q))}const M=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(p,m);if(ni(this._source.type)){const q={},Z={},J=Object.keys(A),pe=k.now();for(const fe of J){const _e=A[fe],se=this._tiles[fe];if(!se||se.fadeEndTime!==0&&se.fadeEndTime<=pe)continue;const Ee=this.findLoadedParent(_e,b);Ee&&(this._addTile(Ee.tileID),q[Ee.tileID.key]=Ee.tileID),Z[fe]=_e}this._retainLoadedChildren(Z,m,E,A);for(const fe in q)A[fe]||(this._coveredTiles[fe]=!0,A[fe]=q[fe]);if(h){const fe={},_e={};for(const se of p)this._tiles[se.key].hasData()?fe[se.key]=se:_e[se.key]=se;for(const se in _e){const Ee=_e[se].children(this._source.maxzoom);this._tiles[Ee[0].key]&&this._tiles[Ee[1].key]&&this._tiles[Ee[2].key]&&this._tiles[Ee[3].key]&&(fe[Ee[0].key]=A[Ee[0].key]=Ee[0],fe[Ee[1].key]=A[Ee[1].key]=Ee[1],fe[Ee[2].key]=A[Ee[2].key]=Ee[2],fe[Ee[3].key]=A[Ee[3].key]=Ee[3],delete _e[se])}for(const se in _e){const Ee=this.findLoadedParent(_e[se],this._source.minzoom);if(Ee){fe[Ee.tileID.key]=A[Ee.tileID.key]=Ee.tileID;for(const Ze in fe)fe[Ze].isChildOf(Ee.tileID)&&delete fe[Ze]}}for(const se in this._tiles)fe[se]||(this._coveredTiles[se]=!0)}}for(const q in A)this._tiles[q].clearFadeHold();const F=a.ab(this._tiles,A);for(const q of F){const Z=this._tiles[q];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,h){const p={},m={},b=Math.max(h-qi.maxOverzooming,this._source.minzoom),E=Math.max(h+qi.maxUnderzooming,this._source.minzoom),M={};for(const A of r){const F=this._addTile(A);p[A.key]=A,F.hasData()||h<this._source.maxzoom&&(M[A.key]=A)}this._retainLoadedChildren(M,h,E,p);for(const A of r){let F=this._tiles[A.key];if(F.hasData())continue;if(h+1>this._source.maxzoom){const Z=A.children(this._source.maxzoom)[0],J=this.getTile(Z);if(J&&J.hasData()){p[Z.key]=Z;continue}}else{const Z=A.children(this._source.maxzoom);if(p[Z[0].key]&&p[Z[1].key]&&p[Z[2].key]&&p[Z[3].key])continue}let q=F.wasRequested();for(let Z=A.overscaledZ-1;Z>=b;--Z){const J=A.scaledTo(Z);if(m[J.key])break;if(m[J.key]=!0,F=this.getTile(J),!F&&q&&(F=this._addTile(J)),F){const pe=F.hasData();if((q||pe)&&(p[J.key]=J),q=F.wasRequested(),pe)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const h=[];let p,m=this._tiles[r].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of h)this._loadedParentTiles[b]=p}}_addTile(r){let h=this._tiles[r.key];if(h)return h;h=this._cache.getAndRemove(r),h&&(this._setTileReloadTimer(r.key,h),h.tileID=r,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,h)));const p=h;return h||(h=new Xn(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(h,r.key,h.state)),h.uses++,this._tiles[r.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(r,h){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=h.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const h=this._tiles[r];h&&(h.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(r){const h=r.sourceDataType;r.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,h,p){const m=[],b=this.transform;if(!b)return m;const E=p?b.getCameraQueryGeometry(r):r,M=r.map(fe=>b.pointCoordinate(fe,this.terrain)),A=E.map(fe=>b.pointCoordinate(fe,this.terrain)),F=this.getIds();let q=1/0,Z=1/0,J=-1/0,pe=-1/0;for(const fe of A)q=Math.min(q,fe.x),Z=Math.min(Z,fe.y),J=Math.max(J,fe.x),pe=Math.max(pe,fe.y);for(let fe=0;fe<F.length;fe++){const _e=this._tiles[F[fe]];if(_e.holdingForFade())continue;const se=_e.tileID,Ee=Math.pow(2,b.zoom-_e.tileID.overscaledZ),Ze=h*_e.queryPadding*a.W/_e.tileSize/Ee,ve=[se.getTilePoint(new a.Y(q,Z)),se.getTilePoint(new a.Y(J,pe))];if(ve[0].x-Ze<a.W&&ve[0].y-Ze<a.W&&ve[1].x+Ze>=0&&ve[1].y+Ze>=0){const De=M.map(He=>se.getTilePoint(He)),We=A.map(He=>se.getTilePoint(He));m.push({tile:_e,tileID:se,queryGeometry:De,cameraQueryGeometry:We,scale:Ee})}}return m}getVisibleCoordinates(r){const h=this.getRenderableIds(r).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ni(this._source.type)){const r=k.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=r)return!0}return!1}setFeatureState(r,h,p){this._state.updateState(r=r||"_geojsonTileLayer",h,p)}removeFeatureState(r,h,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",h,p)}getFeatureState(r,h){return this._state.getState(r=r||"_geojsonTileLayer",h)}setDependencies(r,h,p){const m=this._tiles[r];m&&m.setDependencies(h,p)}reloadTilesForDependencies(r,h){for(const p in this._tiles)this._tiles[p].hasDependency(r,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(r,h))}}function gt(y,r){const h=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return y.overscaledZ-r.overscaledZ||p-h||r.canonical.y-y.canonical.y||r.canonical.x-y.canonical.x}function ni(y){return y==="raster"||y==="image"||y==="video"}qi.maxOverzooming=10,qi.maxUnderzooming=3;class Yt{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.ac(r,0,1);let h=1,p=this._distances[h];const m=r*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const b=h-1,E=this._distances[b],M=p-E,A=M>0?(m-E)/M:0;return this.points[b].mult(1-A).add(this.points[h].mult(A))}}function Zi(y,r){let h=!0;return y==="always"||y!=="never"&&r!=="never"||(h=!1),h}class yr{constructor(r,h,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,p,m,b){this._forEachCell(h,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(r,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(r,h,p,m,b,E){this.boxCells[b].push(E)}_insertCircleCell(r,h,p,m,b,E){this.circleCells[b].push(E)}_query(r,h,p,m,b,E,M){if(p<0||r>this.width||m<0||h>this.height)return[];const A=[];if(r<=0&&h<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:r,y1:h,x2:p,y2:m}];for(let F=0;F<this.boxKeys.length;F++)A.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const q=this.circles[3*F],Z=this.circles[3*F+1],J=this.circles[3*F+2];A.push({key:this.circleKeys[F],x1:q-J,y1:Z-J,x2:q+J,y2:Z+J})}}else this._forEachCell(r,h,p,m,this._queryCell,A,{hitTest:b,overlapMode:E,seenUids:{box:{},circle:{}}},M);return A}query(r,h,p,m){return this._query(r,h,p,m,!1,null)}hitTest(r,h,p,m,b,E){return this._query(r,h,p,m,!0,b,E).length>0}hitTestCircle(r,h,p,m,b){const E=r-p,M=r+p,A=h-p,F=h+p;if(M<0||E>this.width||F<0||A>this.height)return!1;const q=[];return this._forEachCell(E,A,M,F,this._queryCellCircle,q,{hitTest:!0,overlapMode:m,circle:{x:r,y:h,radius:p},seenUids:{box:{},circle:{}}},b),q.length>0}_queryCell(r,h,p,m,b,E,M,A){const{seenUids:F,hitTest:q,overlapMode:Z}=M,J=this.boxCells[b];if(J!==null){const fe=this.bboxes;for(const _e of J)if(!F.box[_e]){F.box[_e]=!0;const se=4*_e,Ee=this.boxKeys[_e];if(r<=fe[se+2]&&h<=fe[se+3]&&p>=fe[se+0]&&m>=fe[se+1]&&(!A||A(Ee))&&(!q||!Zi(Z,Ee.overlapMode))&&(E.push({key:Ee,x1:fe[se],y1:fe[se+1],x2:fe[se+2],y2:fe[se+3]}),q))return!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!F.circle[_e]){F.circle[_e]=!0;const se=3*_e,Ee=this.circleKeys[_e];if(this._circleAndRectCollide(fe[se],fe[se+1],fe[se+2],r,h,p,m)&&(!A||A(Ee))&&(!q||!Zi(Z,Ee.overlapMode))){const Ze=fe[se],ve=fe[se+1],De=fe[se+2];if(E.push({key:Ee,x1:Ze-De,y1:ve-De,x2:Ze+De,y2:ve+De}),q)return!0}}}return!1}_queryCellCircle(r,h,p,m,b,E,M,A){const{circle:F,seenUids:q,overlapMode:Z}=M,J=this.boxCells[b];if(J!==null){const fe=this.bboxes;for(const _e of J)if(!q.box[_e]){q.box[_e]=!0;const se=4*_e,Ee=this.boxKeys[_e];if(this._circleAndRectCollide(F.x,F.y,F.radius,fe[se+0],fe[se+1],fe[se+2],fe[se+3])&&(!A||A(Ee))&&!Zi(Z,Ee.overlapMode))return E.push(!0),!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!q.circle[_e]){q.circle[_e]=!0;const se=3*_e,Ee=this.circleKeys[_e];if(this._circlesCollide(fe[se],fe[se+1],fe[se+2],F.x,F.y,F.radius)&&(!A||A(Ee))&&!Zi(Z,Ee.overlapMode))return E.push(!0),!0}}}_forEachCell(r,h,p,m,b,E,M,A){const F=this._convertToXCellCoord(r),q=this._convertToYCellCoord(h),Z=this._convertToXCellCoord(p),J=this._convertToYCellCoord(m);for(let pe=F;pe<=Z;pe++)for(let fe=q;fe<=J;fe++)if(b.call(this,r,h,p,m,this.xCellCount*fe+pe,E,M,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,p,m,b,E){const M=m-r,A=b-h,F=p+E;return F*F>M*M+A*A}_circleAndRectCollide(r,h,p,m,b,E,M){const A=(E-m)/2,F=Math.abs(r-(m+A));if(F>A+p)return!1;const q=(M-b)/2,Z=Math.abs(h-(b+q));if(Z>q+p)return!1;if(F<=A||Z<=q)return!0;const J=F-A,pe=Z-q;return J*J+pe*pe<=p*p}}function ti(y,r,h,p,m){const b=a.F();return r?(a.J(b,b,[1/m,1/m,1]),h||a.ad(b,b,p.angle)):a.K(b,p.labelPlaneMatrix,y),b}function eo(y,r,h,p,m){if(r){const b=a.ae(y);return a.J(b,b,[m,m,1]),h||a.ad(b,b,-p.angle),b}return p.glCoordMatrix}function cn(y,r,h){let p;h?(p=[y.x,y.y,h(y.x,y.y),1],a.af(p,p,r)):(p=[y.x,y.y,0,1],Je(p,p,r));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function me(y,r){return .5+y/r*.5}function W(y,r){const h=y[0]/y[3],p=y[1]/y[3];return h>=-r[0]&&h<=r[0]&&p>=-r[1]&&p<=r[1]}function X(y,r,h,p,m,b,E,M,A,F){const q=p?y.textSizeData:y.iconSizeData,Z=a.ag(q,h.transform.zoom),J=[256/h.width*2+1,256/h.height*2+1],pe=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;pe.clear();const fe=y.lineVertexArray,_e=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,se=h.transform.width/h.transform.height;let Ee=!1;for(let Ze=0;Ze<_e.length;Ze++){const ve=_e.get(Ze);if(ve.hidden||ve.writingMode===a.ah.vertical&&!Ee){Ge(ve.numGlyphs,pe);continue}let De;if(Ee=!1,F?(De=[ve.anchorX,ve.anchorY,F(ve.anchorX,ve.anchorY),1],a.af(De,De,r)):(De=[ve.anchorX,ve.anchorY,0,1],Je(De,De,r)),!W(De,J)){Ge(ve.numGlyphs,pe);continue}const We=me(h.transform.cameraToCenterDistance,De[3]),He=a.ai(q,Z,ve),Xe=E?He/We:He*We,nt=new a.P(ve.anchorX,ve.anchorY),it=cn(nt,m,F).point,ft={projections:{},offsets:{}},_t=Me(ve,Xe,!1,M,r,m,b,y.glyphOffsetArray,fe,pe,it,nt,ft,se,A,F);Ee=_t.useVertical,(_t.notEnoughRoom||Ee||_t.needsFlipping&&Me(ve,Xe,!0,M,r,m,b,y.glyphOffsetArray,fe,pe,it,nt,ft,se,A,F).notEnoughRoom)&&Ge(ve.numGlyphs,pe)}p?y.text.dynamicLayoutVertexBuffer.updateData(pe):y.icon.dynamicLayoutVertexBuffer.updateData(pe)}function te(y,r,h,p,m,b,E,M,A,F,q,Z,J){const pe=M.glyphStartIndex+M.numGlyphs,fe=M.lineStartIndex,_e=M.lineStartIndex+M.lineLength,se=r.getoffsetX(M.glyphStartIndex),Ee=r.getoffsetX(pe-1),Ze=Ue(y*se,h,p,m,b,E,M.segment,fe,_e,A,F,q,Z,J);if(!Ze)return null;const ve=Ue(y*Ee,h,p,m,b,E,M.segment,fe,_e,A,F,q,Z,J);return ve?{first:Ze,last:ve}:null}function de(y,r,h,p){return y===a.ah.horizontal&&Math.abs(h.y-r.y)>Math.abs(h.x-r.x)*p?{useVertical:!0}:(y===a.ah.vertical?r.y<h.y:r.x>h.x)?{needsFlipping:!0}:null}function Me(y,r,h,p,m,b,E,M,A,F,q,Z,J,pe,fe,_e){const se=r/24,Ee=y.lineOffsetX*se,Ze=y.lineOffsetY*se;let ve;if(y.numGlyphs>1){const De=y.glyphStartIndex+y.numGlyphs,We=y.lineStartIndex,He=y.lineStartIndex+y.lineLength,Xe=te(se,M,Ee,Ze,h,q,Z,y,A,b,J,fe,_e);if(!Xe)return{notEnoughRoom:!0};const nt=cn(Xe.first.point,E,_e).point,it=cn(Xe.last.point,E,_e).point;if(p&&!h){const ft=de(y.writingMode,nt,it,pe);if(ft)return ft}ve=[Xe.first];for(let ft=y.glyphStartIndex+1;ft<De-1;ft++)ve.push(Ue(se*M.getoffsetX(ft),Ee,Ze,h,q,Z,y.segment,We,He,A,b,J,fe,_e));ve.push(Xe.last)}else{if(p&&!h){const We=cn(Z,m,_e).point,He=y.lineStartIndex+y.segment+1,Xe=new a.P(A.getx(He),A.gety(He)),nt=cn(Xe,m,_e),it=nt.signedDistanceFromCamera>0?nt.point:Ie(Z,Xe,We,1,m,_e),ft=de(y.writingMode,We,it,pe);if(ft)return ft}const De=Ue(se*M.getoffsetX(y.glyphStartIndex),Ee,Ze,h,q,Z,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,A,b,J,fe,_e);if(!De)return{notEnoughRoom:!0};ve=[De]}for(const De of ve)a.aj(F,De.point,De.angle);return{}}function Ie(y,r,h,p,m,b){const E=cn(y.add(y.sub(r)._unit()),m,b).point,M=h.sub(E);return h.add(M._mult(p/M.mag()))}function Be(y,r){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:b,distanceFromAnchor:E,getElevation:M,previousVertex:A,direction:F,absOffsetX:q}=r;if(h.projections[y])return h.projections[y];const Z=new a.P(p.getx(y),p.gety(y)),J=cn(Z,m,M);if(J.signedDistanceFromCamera>0)return h.projections[y]=J.point,J.point;const pe=y-F;return Ie(E===0?b:new a.P(p.getx(pe),p.gety(pe)),Z,A,q-E+1,m,M)}function ke(y,r,h){return y._unit()._perp()._mult(r*h)}function G(y,r,h,p,m,b,E,M){const{projectionCache:A,direction:F}=M;if(A.offsets[y])return A.offsets[y];const q=h.add(r);if(y+F<p||y+F>=m)return A.offsets[y]=q,q;const Z=Be(y+F,M),J=ke(Z.sub(h),E,F),pe=h.add(J),fe=Z.add(J);return A.offsets[y]=a.ak(b,q,pe,fe)||q,A.offsets[y]}function Ue(y,r,h,p,m,b,E,M,A,F,q,Z,J,pe){const fe=p?y-r:y+r;let _e=fe>0?1:-1,se=0;p&&(_e*=-1,se=Math.PI),_e<0&&(se+=Math.PI);let Ee,Ze,ve=_e>0?M+E:M+E+1,De=m,We=m,He=0,Xe=0;const nt=Math.abs(fe),it=[];let ft;for(;He+Xe<=nt;){if(ve+=_e,ve<M||ve>=A)return null;He+=Xe,We=De,Ze=Ee;const yt={projectionCache:Z,lineVertexArray:F,labelPlaneMatrix:q,tileAnchorPoint:b,distanceFromAnchor:He,getElevation:pe,previousVertex:We,direction:_e,absOffsetX:nt};if(De=Be(ve,yt),h===0)it.push(We),ft=De.sub(We);else{let Kt;const si=De.sub(We);Kt=si.mag()===0?ke(Be(ve+_e,yt).sub(De),h,_e):ke(si,h,_e),Ze||(Ze=We.add(Kt)),Ee=G(ve,Kt,De,M,A,Ze,h,yt),it.push(Ze),ft=Ee.sub(Ze)}Xe=ft.mag()}const _t=ft._mult((nt-He)/Xe)._add(Ze||We),oi=se+Math.atan2(De.y-We.y,De.x-We.x);return it.push(_t),{point:_t,angle:J?oi:0,path:it}}const qe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ge(y,r){for(let h=0;h<y;h++){const p=r.length;r.resize(p+4),r.float32.set(qe,3*p)}}function Je(y,r,h){const p=r[0],m=r[1];return y[0]=h[0]*p+h[4]*m+h[12],y[1]=h[1]*p+h[5]*m+h[13],y[3]=h[3]*p+h[7]*m+h[15],y}const ht=100;class Rt{constructor(r,h=new yr(r.width+200,r.height+200,25),p=new yr(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ht,this.screenBottomBoundary=r.height+ht,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,h,p,m,b,E){const M=this.projectAndGetPerspectiveRatio(m,r.anchorPointX,r.anchorPointY,E),A=p*M.perspectiveRatio,F=r.x1*A+M.point.x,q=r.y1*A+M.point.y,Z=r.x2*A+M.point.x,J=r.y2*A+M.point.y;return!this.isInsideGrid(F,q,Z,J)||h!=="always"&&this.grid.hitTest(F,q,Z,J,h,b)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,q,Z,J],offscreen:this.isOffscreen(F,q,Z,J)}}placeCollisionCircles(r,h,p,m,b,E,M,A,F,q,Z,J,pe,fe){const _e=[],se=new a.P(h.anchorX,h.anchorY),Ee=cn(se,E,fe),Ze=me(this.transform.cameraToCenterDistance,Ee.signedDistanceFromCamera),ve=(q?b/Ze:b*Ze)/a.ao,De=cn(se,M,fe).point,We=te(ve,m,h.lineOffsetX*ve,h.lineOffsetY*ve,!1,De,se,h,p,M,{projections:{},offsets:{}},!1,fe);let He=!1,Xe=!1,nt=!0;if(We){const it=.5*J*Ze+pe,ft=new a.P(-100,-100),_t=new a.P(this.screenRightBoundary,this.screenBottomBoundary),oi=new Yt,yt=We.first,Kt=We.last;let si=[];for(let ci=yt.path.length-1;ci>=1;ci--)si.push(yt.path[ci]);for(let ci=1;ci<Kt.path.length;ci++)si.push(Kt.path[ci]);const Si=2.5*it;if(A){const ci=si.map(pi=>cn(pi,A,fe));si=ci.some(pi=>pi.signedDistanceFromCamera<=0)?[]:ci.map(pi=>pi.point)}let Qt=[];if(si.length>0){const ci=si[0].clone(),pi=si[0].clone();for(let fn=1;fn<si.length;fn++)ci.x=Math.min(ci.x,si[fn].x),ci.y=Math.min(ci.y,si[fn].y),pi.x=Math.max(pi.x,si[fn].x),pi.y=Math.max(pi.y,si[fn].y);Qt=ci.x>=ft.x&&pi.x<=_t.x&&ci.y>=ft.y&&pi.y<=_t.y?[si]:pi.x<ft.x||ci.x>_t.x||pi.y<ft.y||ci.y>_t.y?[]:a.al([si],ft.x,ft.y,_t.x,_t.y)}for(const ci of Qt){oi.reset(ci,.25*it);let pi=0;pi=oi.length<=.5*it?1:Math.ceil(oi.paddedLength/Si)+1;for(let fn=0;fn<pi;fn++){const Bi=fn/Math.max(pi-1,1),Rr=oi.lerp(Bi),Nn=Rr.x+ht,rn=Rr.y+ht;_e.push(Nn,rn,it,0);const jn=Nn-it,Br=rn-it,bo=Nn+it,Ho=rn+it;if(nt=nt&&this.isOffscreen(jn,Br,bo,Ho),Xe=Xe||this.isInsideGrid(jn,Br,bo,Ho),r!=="always"&&this.grid.hitTestCircle(Nn,rn,it,r,Z)&&(He=!0,!F))return{circles:[],offscreen:!1,collisionDetected:He}}}}return{circles:!F&&He||!Xe||Ze<this.perspectiveRatioCutoff?[]:_e,offscreen:nt,collisionDetected:He}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,b=-1/0,E=-1/0;for(const q of r){const Z=new a.P(q.x+ht,q.y+ht);p=Math.min(p,Z.x),m=Math.min(m,Z.y),b=Math.max(b,Z.x),E=Math.max(E,Z.y),h.push(Z)}const M=this.grid.query(p,m,b,E).concat(this.ignoredGrid.query(p,m,b,E)),A={},F={};for(const q of M){const Z=q.key;if(A[Z.bucketInstanceId]===void 0&&(A[Z.bucketInstanceId]={}),A[Z.bucketInstanceId][Z.featureIndex])continue;const J=[new a.P(q.x1,q.y1),new a.P(q.x2,q.y1),new a.P(q.x2,q.y2),new a.P(q.x1,q.y2)];a.am(h,J)&&(A[Z.bucketInstanceId][Z.featureIndex]=!0,F[Z.bucketInstanceId]===void 0&&(F[Z.bucketInstanceId]=[]),F[Z.bucketInstanceId].push(Z.featureIndex))}return F}insertCollisionBox(r,h,p,m,b,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:h},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,p,m,b,E){const M=p?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:h};for(let F=0;F<r.length;F+=4)M.insertCircle(A,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,h,p,m){let b;return m?(b=[h,p,m(h,p),1],a.af(b,b,r)):(b=[h,p,0,1],Je(b,b,r)),{point:new a.P((b[0]/b[3]+1)/2*this.transform.width+ht,(-b[1]/b[3]+1)/2*this.transform.height+ht),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(r,h,p,m){return p<ht||r>=this.screenRightBoundary||m<ht||h>this.screenBottomBoundary}isInsideGrid(r,h,p,m){return p>=0&&r<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const r=a.an([]);return a.H(r,r,[-100,-100,0]),r}}function Xt(y,r,h){return r*(a.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class ai{constructor(r,h,p,m){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class bi{constructor(r,h,p,m,b){this.text=new ai(r?r.text:null,h,p,b),this.icon=new ai(r?r.icon:null,h,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yi{constructor(r,h,p){this.text=r,this.icon=h,this.skipFade=p}}class Mn{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class li{constructor(r,h,p,m,b){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class un{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[r]}}function On(y,r,h,p,m){const{horizontalAlign:b,verticalAlign:E}=a.at(y);return new a.P(-(b-.5)*r+p[0]*m,-(E-.5)*h+p[1]*m)}function ur(y,r,h,p,m,b){const{x1:E,x2:M,y1:A,y2:F,anchorPointX:q,anchorPointY:Z}=y,J=new a.P(r,h);return p&&J._rotate(m?b:-b),{x1:E+J.x,y1:A+J.y,x2:M+J.x,y2:F+J.y,anchorPointX:q,anchorPointY:Z}}class br{constructor(r,h,p,m,b){this.transform=r.clone(),this.terrain=h,this.collisionIndex=new Rt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new un(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,h,p,m){const b=p.getBucket(h),E=p.latestFeatureIndex;if(!b||!E||h.id!==b.layerIds[0])return;const M=p.collisionBoxArray,A=b.layers[0].layout,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),q=p.tileSize/a.W,Z=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),J=A.get("text-pitch-alignment")==="map",pe=A.get("text-rotation-alignment")==="map",fe=Xt(p,1,this.transform.zoom),_e=ti(Z,J,pe,this.transform,fe);let se=null;if(J){const Ze=eo(Z,J,pe,this.transform,fe);se=a.K([],this.transform.labelPlaneMatrix,Ze)}this.retainedQueryData[b.bucketInstanceId]=new li(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,p.tileID);const Ee={bucket:b,layout:A,posMatrix:Z,textLabelPlaneMatrix:_e,labelToScreenMatrix:se,scale:F,textPixelRatio:q,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const Ze of b.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:De,symbolInstanceEnd:We}=Ze;r.push({sortKey:ve,symbolInstanceStart:De,symbolInstanceEnd:We,parameters:Ee})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(r,h,p,m,b,E,M,A,F,q,Z,J,pe,fe,_e,se){const Ee=a.ap[r.textAnchor],Ze=[r.textOffset0,r.textOffset1],ve=On(Ee,p,m,Ze,b),De=this.collisionIndex.placeCollisionBox(ur(h,ve.x,ve.y,E,M,this.transform.angle),Z,A,F,q.predicate,se);if((!_e||this.collisionIndex.placeCollisionBox(ur(_e,ve.x,ve.y,E,M,this.transform.angle),Z,A,F,q.predicate,se).box.length!==0)&&De.box.length>0){let We;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(We=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:Ze,width:p,height:m,anchor:Ee,textBoxScale:b,prevAnchor:We},this.markUsedJustification(pe,Ee,J,fe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,fe,J),this.placedOrientations[J.crossTileID]=fe),{shift:ve,placedGlyphBoxes:De}}}placeLayerBucketPart(r,h,p){const{bucket:m,layout:b,posMatrix:E,textLabelPlaneMatrix:M,labelToScreenMatrix:A,textPixelRatio:F,holdingForFade:q,collisionBoxArray:Z,partiallyEvaluatedTextSize:J,collisionGroup:pe}=r.parameters,fe=b.get("text-optional"),_e=b.get("icon-optional"),se=a.aq(b,"text-overlap","text-allow-overlap"),Ee=se==="always",Ze=a.aq(b,"icon-overlap","icon-allow-overlap"),ve=Ze==="always",De=b.get("text-rotation-alignment")==="map",We=b.get("text-pitch-alignment")==="map",He=b.get("icon-text-fit")!=="none",Xe=b.get("symbol-z-order")==="viewport-y",nt=Ee&&(ve||!m.hasIconData()||_e),it=ve&&(Ee||!m.hasTextData()||fe);!m.collisionArrays&&Z&&m.deserializeCollisionBoxes(Z);const ft=this.retainedQueryData[m.bucketInstanceId].tileID,_t=this.terrain?(yt,Kt)=>this.terrain.getElevation(ft,yt,Kt):null,oi=(yt,Kt)=>{var si,Si;if(h[yt.crossTileID])return;if(q)return void(this.placements[yt.crossTileID]=new Yi(!1,!1,!1));let Qt=!1,ci=!1,pi=!0,fn=null,Bi={box:null,offscreen:null},Rr={box:null,offscreen:null},Nn=null,rn=null,jn=null,Br=0,bo=0,Ho=0;Kt.textFeatureIndex?Br=Kt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(Br=yt.featureIndex),Kt.verticalTextFeatureIndex&&(bo=Kt.verticalTextFeatureIndex);const Ia=Kt.textBox;if(Ia){const Ln=An=>{let sn=a.ah.horizontal;if(m.allowVerticalPlacement&&!An&&this.prevPlacement){const Kr=this.prevPlacement.placedOrientations[yt.crossTileID];Kr&&(this.placedOrientations[yt.crossTileID]=Kr,sn=Kr,this.markUsedOrientation(m,sn,yt))}return sn},on=(An,sn)=>{if(m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Kt.verticalTextBox){for(const Kr of m.writingModes)if(Kr===a.ah.vertical?(Bi=sn(),Rr=Bi):Bi=An(),Bi&&Bi.box&&Bi.box.length)break}else Bi=An()},en=yt.textAnchorOffsetStartIndex,Xr=yt.textAnchorOffsetEndIndex;if(Xr===en){const An=(sn,Kr)=>{const Pn=this.collisionIndex.placeCollisionBox(sn,se,F,E,pe.predicate,_t);return Pn&&Pn.box&&Pn.box.length&&(this.markUsedOrientation(m,Kr,yt),this.placedOrientations[yt.crossTileID]=Kr),Pn};on(()=>An(Ia,a.ah.horizontal),()=>{const sn=Kt.verticalTextBox;return m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&sn?An(sn,a.ah.vertical):{box:null,offscreen:null}}),Ln(Bi&&Bi.box&&Bi.box.length)}else{let An=a.ap[(Si=(si=this.prevPlacement)===null||si===void 0?void 0:si.variableOffsets[yt.crossTileID])===null||Si===void 0?void 0:Si.anchor];const sn=(Pn,yn,Fc)=>{const Lh=Pn.x2-Pn.x1,ds=Pn.y2-Pn.y1,fs=yt.textBoxScale,Sl=He&&Ze==="never"?yn:null;let Ko={box:[],offscreen:!1},Oc=se==="never"?1:2,Ah="never";An&&Oc++;for(let Nc=0;Nc<Oc;Nc++){for(let jc=en;jc<Xr;jc++){const Tl=m.textAnchorOffsets.get(jc);if(An&&Tl.textAnchor!==An)continue;const Uc=this.attemptAnchorPlacement(Tl,Pn,Lh,ds,fs,De,We,F,E,pe,Ah,yt,m,Fc,Sl,_t);if(Uc&&(Ko=Uc.placedGlyphBoxes,Ko&&Ko.box&&Ko.box.length))return Qt=!0,fn=Uc.shift,Ko}An?An=null:Ah=se}return Ko};on(()=>sn(Ia,Kt.iconBox,a.ah.horizontal),()=>{const Pn=Kt.verticalTextBox;return m.allowVerticalPlacement&&!(Bi&&Bi.box&&Bi.box.length)&&yt.numVerticalGlyphVertices>0&&Pn?sn(Pn,Kt.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Bi&&(Qt=Bi.box,pi=Bi.offscreen);const Kr=Ln(Bi&&Bi.box);if(!Qt&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[yt.crossTileID];Pn&&(this.variableOffsets[yt.crossTileID]=Pn,this.markUsedJustification(m,Pn.anchor,yt,Kr))}}}if(Nn=Bi,Qt=Nn&&Nn.box&&Nn.box.length>0,pi=Nn&&Nn.offscreen,yt.useRuntimeCollisionCircles){const Ln=m.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),on=a.ai(m.textSizeData,J,Ln),en=b.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(se,Ln,m.lineVertexArray,m.glyphOffsetArray,on,E,M,A,p,We,pe.predicate,yt.collisionCircleDiameter,en,_t),rn.circles.length&&rn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),Qt=Ee||rn.circles.length>0&&!rn.collisionDetected,pi=pi&&rn.offscreen}if(Kt.iconFeatureIndex&&(Ho=Kt.iconFeatureIndex),Kt.iconBox){const Ln=on=>{const en=He&&fn?ur(on,fn.x,fn.y,De,We,this.transform.angle):on;return this.collisionIndex.placeCollisionBox(en,Ze,F,E,pe.predicate,_t)};Rr&&Rr.box&&Rr.box.length&&Kt.verticalIconBox?(jn=Ln(Kt.verticalIconBox),ci=jn.box.length>0):(jn=Ln(Kt.iconBox),ci=jn.box.length>0),pi=pi&&jn.offscreen}const Xo=fe||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,vo=_e||yt.numIconVertices===0;if(Xo||vo?vo?Xo||(ci=ci&&Qt):Qt=ci&&Qt:ci=Qt=ci&&Qt,Qt&&Nn&&Nn.box&&this.collisionIndex.insertCollisionBox(Nn.box,se,b.get("text-ignore-placement"),m.bucketInstanceId,Rr&&Rr.box&&bo?bo:Br,pe.ID),ci&&jn&&this.collisionIndex.insertCollisionBox(jn.box,Ze,b.get("icon-ignore-placement"),m.bucketInstanceId,Ho,pe.ID),rn&&(Qt&&this.collisionIndex.insertCollisionCircles(rn.circles,se,b.get("text-ignore-placement"),m.bucketInstanceId,Br,pe.ID),p)){const Ln=m.bucketInstanceId;let on=this.collisionCircleArrays[Ln];on===void 0&&(on=this.collisionCircleArrays[Ln]=new Mn);for(let en=0;en<rn.circles.length;en+=4)on.circles.push(rn.circles[en+0]),on.circles.push(rn.circles[en+1]),on.circles.push(rn.circles[en+2]),on.circles.push(rn.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new Yi(Qt||nt,ci||it,pi||m.justReloaded),h[yt.crossTileID]=!0};if(Xe){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=m.getSortedSymbolIndexes(this.transform.angle);for(let Kt=yt.length-1;Kt>=0;--Kt){const si=yt[Kt];oi(m.symbolInstances.get(si),m.collisionArrays[si])}}else for(let yt=r.symbolInstanceStart;yt<r.symbolInstanceEnd;yt++)oi(m.symbolInstances.get(yt),m.collisionArrays[yt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(yt.invProjMatrix,E),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(r,h,p,m){let b;b=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const M of E)M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:p.crossTileID)}markUsedOrientation(r,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,b=h===a.ah.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const M of E)r.text.placedSymbolArray.get(M).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(r):1,b=h?h.opacities:{},E=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const A in this.placements){const F=this.placements[A],q=b[A];q?(this.opacities[A]=new bi(q,m,F.text,F.icon),p=p||F.text!==q.text.placed||F.icon!==q.icon.placed):(this.opacities[A]=new bi(null,m,F.text,F.icon,F.skipFade),p=p||F.text||F.icon)}for(const A in b){const F=b[A];if(!this.opacities[A]){const q=new bi(F,m,!1,!1);q.isHidden()||(this.opacities[A]=q,p=p||F.text.placed||F.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h){const p={};for(const m of h){const b=m.getBucket(r);b&&m.latestFeatureIndex&&r.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,m.collisionBoxArray)}}updateBucketOpacities(r,h,p){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const m=r.layers[0],b=m.layout,E=new bi(null,0,!1,!1,!0),M=b.get("text-allow-overlap"),A=b.get("icon-allow-overlap"),F=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=b.get("text-rotation-alignment")==="map",Z=b.get("text-pitch-alignment")==="map",J=b.get("icon-text-fit")!=="none",pe=new bi(null,0,M&&(A||!r.hasIconData()||b.get("icon-optional")),A&&(M||!r.hasTextData()||b.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const fe=(_e,se,Ee)=>{for(let Ze=0;Ze<se/4;Ze++)_e.opacityVertexArray.emplaceBack(Ee);_e.hasVisibleVertices=_e.hasVisibleVertices||Ee!==aa};for(let _e=0;_e<r.symbolInstances.length;_e++){const se=r.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Ze,crossTileID:ve}=se;let De=this.opacities[ve];h[ve]?De=E:De||(De=pe,this.opacities[ve]=De),h[ve]=!0;const We=se.numIconVertices>0,He=this.placedOrientations[se.crossTileID],Xe=He===a.ah.vertical,nt=He===a.ah.horizontal||He===a.ah.horizontalOnly;if(Ee>0||Ze>0){const it=vr(De.text);fe(r.text,Ee,Xe?aa:it),fe(r.text,Ze,nt?aa:it);const ft=De.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(r.text.placedSymbolArray.get(yt).hidden=ft||Xe?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=ft||nt?1:0);const _t=this.variableOffsets[se.crossTileID];_t&&this.markUsedJustification(r,_t.anchor,se,He);const oi=this.placedOrientations[se.crossTileID];oi&&(this.markUsedJustification(r,"left",se,oi),this.markUsedOrientation(r,oi,se))}if(We){const it=vr(De.icon),ft=!(J&&se.verticalPlacedIconSymbolIndex&&Xe);se.placedIconSymbolIndex>=0&&(fe(r.icon,se.numIconVertices,ft?it:aa),r.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=De.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(fe(r.icon,se.numVerticalIconVertices,ft?aa:it),r.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=De.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const it=r.collisionArrays[_e];if(it){let ft=new a.P(0,0);if(it.textBox||it.verticalTextBox){let oi=!0;if(F){const yt=this.variableOffsets[ve];yt?(ft=On(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),q&&ft._rotate(Z?this.transform.angle:-this.transform.angle)):oi=!1}it.textBox&&Kn(r.textCollisionBox.collisionVertexArray,De.text.placed,!oi||Xe,ft.x,ft.y),it.verticalTextBox&&Kn(r.textCollisionBox.collisionVertexArray,De.text.placed,!oi||nt,ft.x,ft.y)}const _t=!!(!nt&&it.verticalIconBox);it.iconBox&&Kn(r.iconCollisionBox.collisionVertexArray,De.icon.placed,_t,J?ft.x:0,J?ft.y:0),it.verticalIconBox&&Kn(r.iconCollisionBox.collisionVertexArray,De.icon.placed,!_t,J?ft.x:0,J?ft.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=_e.invProjMatrix,r.placementViewportMatrix=_e.viewportMatrix,r.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Kn(y,r,h,p,m){y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0)}const po=Math.pow(2,25),$u=Math.pow(2,24),Dd=Math.pow(2,17),Di=Math.pow(2,16),oc=Math.pow(2,9),sc=Math.pow(2,8),Pr=Math.pow(2,1);function vr(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const r=y.placed?1:0,h=Math.floor(127*y.opacity);return h*po+r*$u+h*Dd+r*Di+h*oc+r*sc+h*Pr+r}const aa=0;class $r{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,h,p,m,b){const E=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(E,m,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((M,A)=>M.sortKey-A.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Hr{constructor(r,h,p,m,b,E,M,A){this.placement=new br(r,h,E,M,A),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(r,h,p){const m=k.now(),b=()=>!this._forceFullPlacement&&k.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=h[r[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=M)&&(!E.maxzoom||E.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new $r(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const As=512/a.W/2;class Na{constructor(r,h,p){this.tileID=r,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<h.length;b++){const E=h.get(b),M=E.key,A=m.get(M);A?A.push(E):m.set(M,[E])}for(const[b,E]of m){const M={positions:E.map(A=>({x:Math.floor(A.anchorX*As),y:Math.floor(A.anchorY*As)})),crossTileIDs:E.map(A=>A.crossTileID)};if(M.positions.length>128){const A=new a.au(M.positions.length,16,Uint16Array);for(const{x:F,y:q}of M.positions)A.add(F,q);A.finish(),delete M.positions,M.index=A}this._symbolsByKey[b]=M}}getScaledCoordinates(r,h){const{x:p,y:m,z:b}=this.tileID.canonical,{x:E,y:M,z:A}=h.canonical,F=As/Math.pow(2,A-b),q=(M*a.W+r.anchorY)*F,Z=m*a.W*As;return{x:Math.floor((E*a.W+r.anchorX)*F-p*a.W*As),y:Math.floor(q-Z)}}findMatches(r,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<r.length;b++){const E=r.get(b);if(E.crossTileID)continue;const M=this._symbolsByKey[E.key];if(!M)continue;const A=this.getScaledCoordinates(E,h);if(M.index){const F=M.index.range(A.x-m,A.y-m,A.x+m,A.y+m).sort();for(const q of F){const Z=M.crossTileIDs[q];if(!p[Z]){p[Z]=!0,E.crossTileID=Z;break}}}else if(M.positions)for(let F=0;F<M.positions.length;F++){const q=M.positions[F],Z=M.crossTileIDs[F];if(Math.abs(q.x-A.x)<=m&&Math.abs(q.y-A.y)<=m&&!p[Z]){p[Z]=!0,E.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class In{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class la{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const h=Math.round((r-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const E in m){const M=m[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),b[M.tileID.key]=M}this.indexes[p]=b}this.lng=r}addBucket(r,h,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const m=this.usedCrossTileIDs[r.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>r.overscaledZ)for(const M in E){const A=E[M];A.tileID.isChildOf(r)&&A.findMatches(h.symbolInstances,r,m)}else{const M=E[r.scaledTo(Number(b)).key];M&&M.findMatches(h.symbolInstances,r,m)}}for(let b=0;b<h.symbolInstances.length;b++){const E=h.symbolInstances.get(b);E.crossTileID||(E.crossTileID=p.generate(),m[E.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Na(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[r][m]}removeStaleBuckets(r){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)r[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],h=!0)}return h}}class Vo{constructor(){this.layerIndexes={},this.crossTileIDs=new In,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,p){let m=this.layerIndexes[r.id];m===void 0&&(m=this.layerIndexes[r.id]=new la);let b=!1;const E={};m.handleWrapJump(p);for(const M of h){const A=M.getBucket(r);A&&r.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(M.tileID,A,this.crossTileIDs)&&(b=!0),E[A.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(r){const h={};r.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const nn=(y,r)=>a.t(y,r&&r.filter(h=>h.identifier!=="source.canvas")),ja=a.av();class zr extends a.E{constructor(r,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=r,this.dispatcher=new xi(hi(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Ke,this.imageManager.setEventedParent(this),this.glyphManager=new pt(r._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ot(256,512),this.crossTileSymbolIndex=new Vo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),ut().on(nr,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===b.id&&this._validateLayer(M)}})}loadURL(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,h,p)}).catch(b=>{this._loadStyleRequest=null,b&&this.fire(new a.j(b))})}loadJSON(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(r,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(ja,{validate:!1})}_load(r,h,p){var m;const b=h.transformStyle?h.transformStyle(p,r):r;if(!h.validate||!nn(this,a.x(b))){this._loaded=!0,this.stylesheet=b;for(const E in b.sources)this.addSource(E,b.sources[E],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new ii(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const r=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",r),this._order=r.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of r){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(r,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,E,M,A){return a._(this,void 0,void 0,function*(){const F=Oe(b),q=M>1?"@2x":"",Z={},J={};for(const{id:pe,url:fe}of F){const _e=E.transformRequest(E.normalizeSpriteURL(fe,q,".json"),"SpriteJSON");Z[pe]=a.h(_e,A);const se=E.transformRequest(E.normalizeSpriteURL(fe,q,".png"),"SpriteImage");J[pe]=V.getImage(se,A)}return yield Promise.all([...Object.values(Z),...Object.values(J)]),function(pe,fe){return a._(this,void 0,void 0,function*(){const _e={};for(const se in pe){_e[se]={};const Ee=k.getImageCanvasContext((yield fe[se]).data),Ze=(yield pe[se]).data;for(const ve in Ze){const{width:De,height:We,x:He,y:Xe,sdf:nt,pixelRatio:it,stretchX:ft,stretchY:_t,content:oi}=Ze[ve];_e[se][ve]={data:null,pixelRatio:it,sdf:nt,stretchX:ft,stretchY:_t,content:oi,spriteData:{width:De,height:We,x:He,y:Xe,context:Ee}}}}return _e})}(Z,J)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const E in b){this._spritesImagesIds[E]=[];const M=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(A=>!(A in b)):[];for(const A of M)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in b[E]){const F=E==="default"?A:`${E}:${A}`;this._spritesImagesIds[E].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,b[E][A],!1):this.imageManager.addImage(F,b[E][A]),h&&(this._changedImages[F]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(r){const h=this.sourceCaches[r.source];if(!h)return;const p=r.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const h=this._serializedAllLayers();if(!r||r.length===0)return Object.values(h);const p=[];for(const m of r)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(r[p]=m.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const E in this._updatedSources){const M=this._updatedSources[E];if(M==="reload")this._reloadSource(E);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(r,this._availableImages),!b.isHidden(r.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(r),this.z=r.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,h={}){var p;this._checkLoaded();const m=this.serialize();if(r=h.transformStyle?h.transformStyle(m,r):r,((p=h.validate)===null||p===void 0||p)&&nn(this,a.x(r)))return!1;(r=a.aA(r)).layers=a.ay(r.layers);const b=a.aB(m,r),E=this._getOperationsToPerform(b);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const M of E.operations)M();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const h=[],p=[];for(const m of r)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(r,h){if(this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,h),this._afterImageUpdated(r)}updateImage(r,h){this.imageManager.updateImage(r,h)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,h,p={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${r}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[r]=new qi(r,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:r})),m.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===r)return this.fire(new a.j(new Error(`Source "${r}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,h){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const p=this.sourceCaches[r].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,h,p={}){this._checkLoaded();const m=r.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(r.type==="custom"){if(nn(this,a.aC(r)))return;b=a.az(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(m,r.source),r=a.aA(r),r=a.e(r,{source:m})),this._validate(a.x.layer,`layers.${m}`,r,{arrayIndex:-1},p))return;b=a.az(r),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(r,h){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===h)return;const p=this._order.indexOf(r);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${r}" before non-existing layer "${h}".`))):(this._order.splice(m,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const h=this._layers[r];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${r}".`)));h.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=h,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],h.onRemove&&h.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,h,p){this._checkLoaded();const m=this.getLayer(r);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,h,p={}){this._checkLoaded();const m=this.getLayer(r);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return a.aA(this.getLayer(r).filter)}setLayoutProperty(r,h,p,m={}){this._checkLoaded();const b=this.getLayer(r);b?a.aD(b.getLayoutProperty(h),p)||(b.setLayoutProperty(h,p,m),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,h){const p=this.getLayer(r);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,h,p,m={}){this._checkLoaded();const b=this.getLayer(r);b?a.aD(b.getPaintProperty(h),p)||(b.setPaintProperty(h,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[r]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,h){return this.getLayer(r).getPaintProperty(h)}setFeatureState(r,h){this._checkLoaded();const p=r.source,m=r.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const E=b.getSource().type;E==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,r.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,h){this._checkLoaded();const p=r.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,E=b==="vector"?r.sourceLayer:void 0;b!=="vector"||E?h&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,r.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const h=r.source,p=r.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,r.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=a.aE(this.sourceCaches,b=>b.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:r,layers:h,terrain:p},b=>b!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const h=E=>this._layers[E].type==="fill-extrusion",p={},m=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(h(M)){p[M]=E;for(const A of r){const F=A[M];if(F)for(const q of F)m.push(q)}}}m.sort((E,M)=>M.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(h(M))for(let A=m.length-1;A>=0;A--){const F=m[A].feature;if(p[F.layer.id]<E)break;b.push(F),m.pop()}else for(const A of r){const F=A[M];if(F)for(const q of F)b.push(q.feature)}}return b}queryRenderedFeatures(r,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const M of h.layers){const A=this._layers[M];if(!A)return this.fire(new a.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];m[A.source]=!0}}const b=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const M in this.sourceCaches)h.layers&&!m[M]||b.push(ct(this.sourceCaches[M],this._layers,E,r,h,p));return this.placement&&b.push(function(M,A,F,q,Z,J,pe){const fe={},_e=J.queryRenderedSymbols(q),se=[];for(const Ee of Object.keys(_e).map(Number))se.push(pe[Ee]);se.sort(It);for(const Ee of se){const Ze=Ee.featureIndex.lookupSymbolFeatures(_e[Ee.bucketInstanceId],A,Ee.bucketIndex,Ee.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,M);for(const ve in Ze){const De=fe[ve]=fe[ve]||[],We=Ze[ve];We.sort((He,Xe)=>{const nt=Ee.featureSortOrder;if(nt){const it=nt.indexOf(He.featureIndex);return nt.indexOf(Xe.featureIndex)-it}return Xe.featureIndex-He.featureIndex});for(const He of We)De.push(He)}}for(const Ee in fe)fe[Ee].forEach(Ze=>{const ve=Ze.feature,De=F[M[Ee].source].getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=De});return fe}(this._layers,E,this.sourceCaches,r,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(r,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[r];return p?function(m,b){const E=m.getRenderableIds().map(F=>m.getTileByID(F)),M=[],A={};for(let F=0;F<E.length;F++){const q=E[F],Z=q.tileID.canonical.key;A[Z]||(A[Z]=!0,q.querySourceFeatures(M,b))}return M}(p,h):[]}getLight(){return this.light.getLight()}setLight(r,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const E in r)if(!a.aD(r[E],p[E])){m=!0;break}if(!m)return;const b={now:k.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,h),this.light.updateTransitions(b)}_validate(r,h,p,m,b={}){return(!b||b.validate!==!1)&&nn(this,r.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ut().off(nr,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const h in this.sourceCaches)this.sourceCaches[h].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,h,p,m,b=!1){let E=!1,M=!1;const A={};for(const F of this._order){const q=this._layers[F];if(q.type!=="symbol")continue;if(!A[q.source]){const J=this.sourceCaches[q.source];A[q.source]=J.getRenderableIds(!0).map(pe=>J.getTileByID(pe)).sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(q,A[q.source],r.center.lng);E=E||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(k.now(),r.zoom))&&(this.pauseablePlacement=new Hr(r,this.map.terrain,this._order,b,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(k.now()),M=!0),E&&this.pauseablePlacement.placement.setStale()),M||E)for(const F of this._order){const q=this._layers[F];q.type==="symbol"&&this.placement.updateLayerOpacities(q,A[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(k.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,h={}){this._checkLoaded(),r&&this._validate(a.x.glyphs,"glyphs",r,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,h,p={},m){this._checkLoaded();const b=[{id:r,url:h}],E=[...Oe(this.stylesheet.sprite),...b];this._validate(a.x.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(b,!0,m))}removeSprite(r){this._checkLoaded();const h=Oe(this.stylesheet.sprite);if(h.find(p=>p.id===r)){if(this._spritesImagesIds[r])for(const p of this._spritesImagesIds[r])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===r),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Oe(this.stylesheet.sprite)}setSprite(r,h={},p){this._checkLoaded(),r&&this._validate(a.x.sprite,"sprite",r,null,h)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,p):(this._unloadSprite(),p&&p(null)))}}var Ua=a.X([{name:"a_pos",type:"Int16",components:2}]),mo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ca={prelude:Ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ri(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ri(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ri("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ri(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ri("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ri("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ri(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ri(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ri(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ri(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ri(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ri("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",mo),terrainDepth:Ri("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",mo),terrainCoords:Ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",mo)};function Ri(y,r){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=b?b.concat(m):m,M={};return{fragmentSource:y=y.replace(h,(A,F,q,Z,J)=>(M[J]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
varying ${q} ${Z} ${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = u_${J};
#endif
`)),vertexSource:r=r.replace(h,(A,F,q,Z,J)=>{const pe=Z==="float"?"vec2":"vec4",fe=J.match(/color/)?"color":pe;return M[J]?F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${q} ${pe} a_${J};
varying ${q} ${Z} ${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${q} ${pe} a_${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = a_${J};
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`}),staticAttributes:p,staticUniforms:E}}class Va{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,h,p,m,b,E,M,A,F){this.context=r;let q=this.boundPaintVertexBuffers.length!==m.length;for(let Z=0;!q&&Z<m.length;Z++)this.boundPaintVertexBuffers[Z]!==m[Z]&&(q=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||q||this.boundIndexBuffer!==b||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==F?this.freshBind(h,p,m,b,E,M,A,F):(r.bindVertexArray.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),A&&A.bind(),F&&F.bind())}freshBind(r,h,p,m,b,E,M,A){const F=r.numAttributes,q=this.context,Z=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=A,h.enableAttributes(Z,r);for(const J of p)J.enableAttributes(Z,r);E&&E.enableAttributes(Z,r),M&&M.enableAttributes(Z,r),A&&A.enableAttributes(Z,r),h.bind(),h.setVertexAttribPointers(Z,r,b);for(const J of p)J.bind(),J.setVertexAttribPointers(Z,r,b);E&&(E.bind(),E.setVertexAttribPointers(Z,r,b)),m&&m.bind(),M&&(M.bind(),M.setVertexAttribPointers(Z,r,b)),A&&(A.bind(),A.setVertexAttribPointers(Z,r,b)),q.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ps(y){const r=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const p=y[h].split(" ");r.push(p.pop())}return r}class qo{constructor(r,h,p,m,b,E){const M=r.gl;this.program=M.createProgram();const A=Ps(h.staticAttributes),F=p?p.getBinderAttributes():[],q=A.concat(F),Z=ca.prelude.staticUniforms?Ps(ca.prelude.staticUniforms):[],J=h.staticUniforms?Ps(h.staticUniforms):[],pe=p?p.getBinderUniforms():[],fe=Z.concat(J).concat(pe),_e=[];for(const He of fe)_e.indexOf(He)<0&&_e.push(He);const se=p?p.defines():[];b&&se.push("#define OVERDRAW_INSPECTOR;"),E&&se.push("#define TERRAIN3D;");const Ee=se.concat(ca.prelude.fragmentSource,h.fragmentSource).join(`
`),Ze=se.concat(ca.prelude.vertexSource,h.vertexSource).join(`
`),ve=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(ve,Ee),M.compileShader(ve),!M.getShaderParameter(ve,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(ve)}`);M.attachShader(this.program,ve);const De=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(De,Ze),M.compileShader(De),!M.getShaderParameter(De,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(De)}`);M.attachShader(this.program,De),this.attributes={};const We={};this.numAttributes=q.length;for(let He=0;He<this.numAttributes;He++)q[He]&&(M.bindAttribLocation(this.program,He,q[He]),this.attributes[q[He]]=He);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(De),M.deleteShader(ve);for(let He=0;He<_e.length;He++){const Xe=_e[He];if(Xe&&!We[Xe]){const nt=M.getUniformLocation(this.program,Xe);nt&&(We[Xe]=nt)}}this.fixedUniforms=m(r,We),this.terrainUniforms=((He,Xe)=>({u_depth:new a.aG(He,Xe.u_depth),u_terrain:new a.aG(He,Xe.u_terrain),u_terrain_dim:new a.aH(He,Xe.u_terrain_dim),u_terrain_matrix:new a.aI(He,Xe.u_terrain_matrix),u_terrain_unpack:new a.aJ(He,Xe.u_terrain_unpack),u_terrain_exaggeration:new a.aH(He,Xe.u_terrain_exaggeration)}))(r,We),this.binderUniforms=p?p.getUniforms(r,We):[]}draw(r,h,p,m,b,E,M,A,F,q,Z,J,pe,fe,_e,se,Ee,Ze){const ve=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(m),r.setColorMode(b),r.setCullFace(E),A){r.activeTexture.set(ve.TEXTURE2),ve.bindTexture(ve.TEXTURE_2D,A.depthTexture),r.activeTexture.set(ve.TEXTURE3),ve.bindTexture(ve.TEXTURE_2D,A.texture);for(const We in this.terrainUniforms)this.terrainUniforms[We].set(A[We])}for(const We in this.fixedUniforms)this.fixedUniforms[We].set(M[We]);_e&&_e.setUniforms(r,this.binderUniforms,pe,{zoom:fe});let De=0;switch(h){case ve.LINES:De=2;break;case ve.TRIANGLES:De=3;break;case ve.LINE_STRIP:De=1}for(const We of J.get()){const He=We.vaos||(We.vaos={});(He[F]||(He[F]=new Va)).bind(r,this,q,_e?_e.getPaintVertexBuffers():[],Z,We.vertexOffset,se,Ee,Ze),ve.drawElements(h,We.primitiveLength*De,ve.UNSIGNED_SHORT,We.primitiveOffset*De*2)}}}function qa(y,r,h){const p=1/Xt(h,1,r.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,r.transform.tileZoom)/m,E=b*(h.tileID.canonical.x+h.tileID.wrap*m),M=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,M>>16],u_pixel_coord_lower:[65535&E,65535&M]}}const ua=(y,r,h,p)=>{const m=r.style.light,b=m.properties.get("position"),E=[b.x,b.y,b.z],M=function(){var F=new a.A(9);return a.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();m.properties.get("anchor")==="viewport"&&function(F,q){var Z=Math.sin(q),J=Math.cos(q);F[0]=J,F[1]=Z,F[2]=0,F[3]=-Z,F[4]=J,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(M,-r.transform.angle),function(F,q,Z){var J=q[0],pe=q[1],fe=q[2];F[0]=J*Z[0]+pe*Z[3]+fe*Z[6],F[1]=J*Z[1]+pe*Z[4]+fe*Z[7],F[2]=J*Z[2]+pe*Z[5]+fe*Z[8]}(E,E,M);const A=m.properties.get("color");return{u_matrix:y,u_lightpos:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+h,u_opacity:p}},Rd=(y,r,h,p,m,b,E)=>a.e(ua(y,r,h,p),qa(b,r,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),Hu=y=>({u_matrix:y}),Za=(y,r,h,p)=>a.e(Hu(y),qa(h,r,p)),Bd=(y,r)=>({u_matrix:y,u_world:r}),Xu=(y,r,h,p,m)=>a.e(Za(y,r,h,p),{u_world:m}),Fd=(y,r,h,p)=>{const m=y.transform;let b,E;if(p.paint.get("circle-pitch-alignment")==="map"){const M=Xt(h,1,m.zoom);b=!0,E=[M,M]}else b=!1,E=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(r.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E}},Ku=(y,r,h)=>{const p=Xt(h,1,r.zoom),m=Math.pow(2,r.zoom-h.tileID.overscaledZ),b=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[r.pixelsToGLUnits[0]/(p*m),r.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:b}},Ju=(y,r,h=1)=>({u_matrix:y,u_color:r,u_overlay:0,u_overlay_scale:h}),Ga=y=>({u_matrix:y}),Yu=(y,r,h,p)=>({u_matrix:y,u_extrude_scale:Xt(r,1,h),u_intensity:p});function Qu(y,r){const h=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const Wa=(y,r,h,p)=>{const m=y.transform;return{u_matrix:ha(y,r,h,p),u_ratio:1/Xt(r,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},eh=(y,r,h,p,m)=>a.e(Wa(y,r,h,m),{u_image:0,u_image_height:p}),rs=(y,r,h,p,m)=>{const b=y.transform,E=Dr(r,b);return{u_matrix:ha(y,r,h,m),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Xt(r,1,b.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},$a=(y,r,h,p,m,b)=>{const E=y.lineAtlas,M=Dr(r,y.transform),A=h.layout.get("line-cap")==="round",F=E.getDash(p.from,A),q=E.getDash(p.to,A),Z=F.width*m.fromScale,J=q.width*m.toScale;return a.e(Wa(y,r,h,b),{u_patternscale_a:[M/Z,-F.height/2],u_patternscale_b:[M/J,-q.height/2],u_sdfgamma:E.width/(256*Math.min(Z,J)*y.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:q.y,u_mix:m.t})};function Dr(y,r){return 1/Xt(y,1,r.tileZoom)}function ha(y,r,h,p){return y.translatePosMatrix(p?p.posMatrix:r.tileID.posMatrix,r,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ha=(y,r,h,p,m)=>{return{u_matrix:y,u_tl_parent:r,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:da(m.paint.get("raster-hue-rotate"))};var b,E};function da(y){y*=Math.PI/180;const r=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}const fa=(y,r,h,p,m,b,E,M,A,F)=>{const q=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:q.width/q.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+A,u_pitch_with_map:+p,u_texsize:F,u_texture:0}},pa=(y,r,h,p,m,b,E,M,A,F,q)=>{const Z=m.transform;return a.e(fa(y,r,h,p,m,b,E,M,A,F),{u_gamma_scale:p?Math.cos(Z._pitch)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+q})},ma=(y,r,h,p,m,b,E,M,A,F)=>a.e(pa(y,r,h,p,m,b,E,M,!0,A,!0),{u_texsize_icon:F,u_texture_icon:1}),Od=(y,r,h)=>({u_matrix:y,u_opacity:r,u_color:h}),Nd=(y,r,h,p,m,b)=>a.e(function(E,M,A,F){const q=A.imageManager.getPattern(E.from.toString()),Z=A.imageManager.getPattern(E.to.toString()),{width:J,height:pe}=A.imageManager.getPixelSize(),fe=Math.pow(2,F.tileID.overscaledZ),_e=F.tileSize*Math.pow(2,A.transform.tileZoom)/fe,se=_e*(F.tileID.canonical.x+F.tileID.wrap*fe),Ee=_e*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[J,pe],u_mix:M.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Xt(F,1,A.transform.tileZoom),u_pixel_coord_upper:[se>>16,Ee>>16],u_pixel_coord_lower:[65535&se,65535&Ee]}}(p,b,h,m),{u_matrix:y,u_opacity:r}),th={fillExtrusion:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_opacity:new a.aH(y,r.u_opacity)}),fillExtrusionPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_height_factor:new a.aH(y,r.u_height_factor),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade),u_opacity:new a.aH(y,r.u_opacity)}),fill:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),fillPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),fillOutline:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world)}),fillOutlinePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),circle:(y,r)=>({u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,r.u_scale_with_map),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_matrix:new a.aI(y,r.u_matrix)}),collisionBox:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,r.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_overscale_factor:new a.aH(y,r.u_overscale_factor)}),collisionCircle:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_inv_matrix:new a.aI(y,r.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_viewport_size:new a.aL(y,r.u_viewport_size)}),debug:(y,r)=>({u_color:new a.aM(y,r.u_color),u_matrix:new a.aI(y,r.u_matrix),u_overlay:new a.aG(y,r.u_overlay),u_overlay_scale:new a.aH(y,r.u_overlay_scale)}),clippingMask:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),heatmap:(y,r)=>({u_extrude_scale:new a.aH(y,r.u_extrude_scale),u_intensity:new a.aH(y,r.u_intensity),u_matrix:new a.aI(y,r.u_matrix)}),heatmapTexture:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_color_ramp:new a.aG(y,r.u_color_ramp),u_opacity:new a.aH(y,r.u_opacity)}),hillshade:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_latrange:new a.aL(y,r.u_latrange),u_light:new a.aL(y,r.u_light),u_shadow:new a.aM(y,r.u_shadow),u_highlight:new a.aM(y,r.u_highlight),u_accent:new a.aM(y,r.u_accent)}),hillshadePrepare:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_dimension:new a.aL(y,r.u_dimension),u_zoom:new a.aH(y,r.u_zoom),u_unpack:new a.aJ(y,r.u_unpack)}),line:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels)}),lineGradient:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_image:new a.aG(y,r.u_image),u_image_height:new a.aH(y,r.u_image_height)}),linePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texsize:new a.aL(y,r.u_texsize),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_image:new a.aG(y,r.u_image),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),lineSDF:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_patternscale_a:new a.aL(y,r.u_patternscale_a),u_patternscale_b:new a.aL(y,r.u_patternscale_b),u_sdfgamma:new a.aH(y,r.u_sdfgamma),u_image:new a.aG(y,r.u_image),u_tex_y_a:new a.aH(y,r.u_tex_y_a),u_tex_y_b:new a.aH(y,r.u_tex_y_b),u_mix:new a.aH(y,r.u_mix)}),raster:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_tl_parent:new a.aL(y,r.u_tl_parent),u_scale_parent:new a.aH(y,r.u_scale_parent),u_buffer_scale:new a.aH(y,r.u_buffer_scale),u_fade_t:new a.aH(y,r.u_fade_t),u_opacity:new a.aH(y,r.u_opacity),u_image0:new a.aG(y,r.u_image0),u_image1:new a.aG(y,r.u_image1),u_brightness_low:new a.aH(y,r.u_brightness_low),u_brightness_high:new a.aH(y,r.u_brightness_high),u_saturation_factor:new a.aH(y,r.u_saturation_factor),u_contrast_factor:new a.aH(y,r.u_contrast_factor),u_spin_weights:new a.aK(y,r.u_spin_weights)}),symbolIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture)}),symbolSDF:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),symbolTextAndIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texsize_icon:new a.aL(y,r.u_texsize_icon),u_texture:new a.aG(y,r.u_texture),u_texture_icon:new a.aG(y,r.u_texture_icon),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),background:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_color:new a.aM(y,r.u_color)}),backgroundPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_image:new a.aG(y,r.u_image),u_pattern_tl_a:new a.aL(y,r.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,r.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,r.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,r.u_pattern_br_b),u_texsize:new a.aL(y,r.u_texsize),u_mix:new a.aH(y,r.u_mix),u_pattern_size_a:new a.aL(y,r.u_pattern_size_a),u_pattern_size_b:new a.aL(y,r.u_pattern_size_b),u_scale_a:new a.aH(y,r.u_scale_a),u_scale_b:new a.aH(y,r.u_scale_b),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,r.u_tile_units_to_pixels)}),terrain:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainDepth:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainCoords:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_terrain_coords_id:new a.aH(y,r.u_terrain_coords_id),u_ele_delta:new a.aH(y,r.u_ele_delta)})};class jd{constructor(r,h,p){this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const os={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xa{constructor(r,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=r;const b=r.gl;this.buffer=b.createBuffer(),r.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&r.enableVertexAttribArray(m)}}setVertexAttribPointers(r,h,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],E=h.attributes[b.name];E!==void 0&&r.vertexAttribPointer(E,b.components,r[os[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hr=new WeakMap;function rr(y){var r;if(hr.has(y))return hr.get(y);{const h=(r=y.getParameter(y.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return hr.set(y,h),h}}class Ii{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ka extends Ii{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ja extends Ii{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ac extends Ii{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class lc extends Ii{getDefault(){return[!0,!0,!0,!0]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ya extends Ii{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class cc extends Ii{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class uc extends Ii{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Qa extends Ii{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ih extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class nh extends Ii{getDefault(){return[0,1]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class zs extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ud extends Ii{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Vd extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class qd extends Ii{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Zd extends Ii{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Gd extends Ii{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Wd extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class hc extends Ii{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class el extends Ii{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class dc extends Ii{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class fc extends Ii{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ds extends Ii{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class rh extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class oh extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class pc extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ss extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class sh extends Ii{getDefault(){return null}set(r){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Rs extends Ii{getDefault(){return null}set(r){var h;if(r===this.current&&!this.dirty)return;const p=this.gl;rr(p)?p.bindVertexArray(r):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Bs extends Ii{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class ah extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class mc extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ci extends Ii{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class tl extends Ci{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class $d extends Ci{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class lh extends Ci{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ga{constructor(r,h,p,m,b){this.context=r,this.width=h,this.height=p;const E=r.gl,M=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new tl(r,M),m)this.depthAttachment=b?new lh(r,M):new $d(r,M);else if(b)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,h=this.colorAttachment.get();if(h&&r.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class kn{constructor(r,h,p){this.blendFunction=r,this.blendColor=h,this.mask=p}}kn.Replace=[1,0],kn.disabled=new kn(kn.Replace,a.aO.transparent,[!1,!1,!1,!1]),kn.unblended=new kn(kn.Replace,a.aO.transparent,[!0,!0,!0,!0]),kn.alphaBlended=new kn([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Hd{constructor(r){var h,p;if(this.gl=r,this.clearColor=new Ka(this),this.clearDepth=new Ja(this),this.clearStencil=new ac(this),this.colorMask=new lc(this),this.depthMask=new Ya(this),this.stencilMask=new cc(this),this.stencilFunc=new uc(this),this.stencilOp=new Qa(this),this.stencilTest=new ih(this),this.depthRange=new nh(this),this.depthTest=new zs(this),this.depthFunc=new Ud(this),this.blend=new Vd(this),this.blendFunc=new qd(this),this.blendColor=new Zd(this),this.blendEquation=new Gd(this),this.cullFace=new Wd(this),this.cullFaceSide=new hc(this),this.frontFace=new el(this),this.program=new dc(this),this.activeTexture=new fc(this),this.viewport=new Ds(this),this.bindFramebuffer=new rh(this),this.bindRenderbuffer=new oh(this),this.bindTexture=new pc(this),this.bindVertexBuffer=new ss(this),this.bindElementBuffer=new sh(this),this.bindVertexArray=new Rs(this),this.pixelStoreUnpack=new Bs(this),this.pixelStoreUnpackPremultiplyAlpha=new ah(this),this.pixelStoreUnpackFlipY=new mc(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),rr(r)){this.HALF_FLOAT=r.HALF_FLOAT;const m=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=r.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=r.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const m=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h){return new jd(this,r,h)}createVertexBuffer(r,h,p){return new Xa(this,r,h,p)}createRenderbuffer(r,h,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,r,h,p),this.bindRenderbuffer.set(null),b}createFramebuffer(r,h,p,m){return new ga(this,r,h,p,m)}clear({color:r,depth:h,stencil:p}){const m=this.gl;let b=0;r&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){a.aD(r.blendFunction,kn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return rr(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var h;return rr(this.gl)?this.gl.deleteVertexArray(r):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class ki{constructor(r,h,p){this.func=r,this.mask=h,this.range=p}}ki.ReadOnly=!1,ki.ReadWrite=!0,ki.disabled=new ki(519,ki.ReadOnly,[0,1]);const gc=7680;class $i{constructor(r,h,p,m,b,E){this.test=r,this.ref=h,this.mask=p,this.fail=m,this.depthFail=b,this.pass=E}}$i.disabled=new $i({func:519,mask:0},0,0,gc,gc,gc);class Gi{constructor(r,h,p){this.enable=r,this.mode=h,this.frontFace=p}}let as;function il(y,r,h,p,m,b,E){const M=y.context,A=M.gl,F=y.useProgram("collisionBox"),q=[];let Z=0,J=0;for(let ve=0;ve<p.length;ve++){const De=p[ve],We=r.getTile(De),He=We.getBucket(h);if(!He)continue;let Xe=De.posMatrix;m[0]===0&&m[1]===0||(Xe=y.translatePosMatrix(De.posMatrix,We,m,b));const nt=E?He.textCollisionBox:He.iconCollisionBox,it=He.collisionCircleArray;if(it.length>0){const ft=a.F(),_t=Xe;a.aP(ft,He.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(ft,ft,He.placementViewportMatrix),q.push({circleArray:it,circleOffset:J,transform:_t,invTransform:ft,coord:De}),Z+=it.length/4,J=Z}nt&&F.draw(M,A.LINES,ki.disabled,$i.disabled,y.colorModeForRenderPass(),Gi.disabled,Ku(Xe,y.transform,We),y.style.map.terrain&&y.style.map.terrain.getTerrainData(De),h.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,y.transform.zoom,null,null,nt.collisionVertexBuffer)}if(!E||!q.length)return;const pe=y.useProgram("collisionCircle"),fe=new a.aQ;fe.resize(4*Z),fe._trim();let _e=0;for(const ve of q)for(let De=0;De<ve.circleArray.length/4;De++){const We=4*De,He=ve.circleArray[We+0],Xe=ve.circleArray[We+1],nt=ve.circleArray[We+2],it=ve.circleArray[We+3];fe.emplace(_e++,He,Xe,nt,it,0),fe.emplace(_e++,He,Xe,nt,it,1),fe.emplace(_e++,He,Xe,nt,it,2),fe.emplace(_e++,He,Xe,nt,it,3)}(!as||as.length<2*Z)&&(as=function(ve){const De=2*ve,We=new a.aS;We.resize(De),We._trim();for(let He=0;He<De;He++){const Xe=6*He;We.uint16[Xe+0]=4*He+0,We.uint16[Xe+1]=4*He+1,We.uint16[Xe+2]=4*He+2,We.uint16[Xe+3]=4*He+2,We.uint16[Xe+4]=4*He+3,We.uint16[Xe+5]=4*He+0}return We}(Z));const se=M.createIndexBuffer(as,!0),Ee=M.createVertexBuffer(fe,a.aR.members,!0);for(const ve of q){const De={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(Ze=y.transform).cameraToCenterDistance,u_viewport_size:[Ze.width,Ze.height]};pe.draw(M,A.TRIANGLES,ki.disabled,$i.disabled,y.colorModeForRenderPass(),Gi.disabled,De,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ve.coord),h.id,Ee,se,a.$.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ze;Ee.destroy(),se.destroy()}Gi.disabled=new Gi(!1,1029,2305),Gi.backCCW=new Gi(!0,1029,2305);const _c=a.an(new Float32Array(16));function ch(y,r,h,p,m,b){const{horizontalAlign:E,verticalAlign:M}=a.at(y);return new a.P((-(E-.5)*r/m+p[0])*b,(-(M-.5)*h/m+p[1])*b)}function nl(y,r,h,p,m,b,E,M,A,F,q){const Z=y.text.placedSymbolArray,J=y.text.dynamicLayoutVertexArray,pe=y.icon.dynamicLayoutVertexArray,fe={};J.clear();for(let _e=0;_e<Z.length;_e++){const se=Z.get(_e),Ee=se.hidden||!se.crossTileID||y.allowVerticalPlacement&&!se.placedOrientation?null:p[se.crossTileID];if(Ee){const Ze=new a.P(se.anchorX,se.anchorY),ve=cn(Ze,h?E:b,q),De=me(m.cameraToCenterDistance,ve.signedDistanceFromCamera);let We=a.ai(y.textSizeData,A,se)*De/a.ao;h&&(We*=y.tilePixelRatio/M);const{width:He,height:Xe,anchor:nt,textOffset:it,textBoxScale:ft}=Ee,_t=ch(nt,He,Xe,it,ft,We),oi=h?cn(Ze.add(_t),b,q).point:ve.point.add(r?_t.rotate(-m.angle):_t),yt=y.allowVerticalPlacement&&se.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Kt=0;Kt<se.numGlyphs;Kt++)a.aj(J,oi,yt);F&&se.associatedIconIndex>=0&&(fe[se.associatedIconIndex]={shiftedAnchor:oi,angle:yt})}else Ge(se.numGlyphs,J)}if(F){pe.clear();const _e=y.icon.placedSymbolArray;for(let se=0;se<_e.length;se++){const Ee=_e.get(se);if(Ee.hidden)Ge(Ee.numGlyphs,pe);else{const Ze=fe[se];if(Ze)for(let ve=0;ve<Ee.numGlyphs;ve++)a.aj(pe,Ze.shiftedAnchor,Ze.angle);else Ge(Ee.numGlyphs,pe)}}y.icon.dynamicLayoutVertexBuffer.updateData(pe)}y.text.dynamicLayoutVertexBuffer.updateData(J)}function rl(y,r,h){return h.iconsInText&&r?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function ol(y,r,h,p,m,b,E,M,A,F,q,Z){const J=y.context,pe=J.gl,fe=y.transform,_e=M==="map",se=A==="map",Ee=M!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ze=_e&&!se&&!Ee,ve=!h.layout.get("symbol-sort-key").isConstant();let De=!1;const We=y.depthModeForSublayer(0,ki.ReadOnly),He=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xe=[];for(const nt of p){const it=r.getTile(nt),ft=it.getBucket(h);if(!ft)continue;const _t=m?ft.text:ft.icon;if(!_t||!_t.segments.get().length||!_t.hasVisibleVertices)continue;const oi=_t.programConfigurations.get(h.id),yt=m||ft.sdfIcons,Kt=m?ft.textSizeData:ft.iconSizeData,si=se||fe.pitch!==0,Si=y.useProgram(rl(yt,m,ft),oi),Qt=a.ag(Kt,fe.zoom),ci=y.style.map.terrain&&y.style.map.terrain.getTerrainData(nt);let pi,fn,Bi,Rr,Nn=[0,0],rn=null;if(m)fn=it.glyphAtlasTexture,Bi=pe.LINEAR,pi=it.glyphAtlasTexture.size,ft.iconsInText&&(Nn=it.imageAtlasTexture.size,rn=it.imageAtlasTexture,Rr=si||y.options.rotating||y.options.zooming||Kt.kind==="composite"||Kt.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const An=h.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;fn=it.imageAtlasTexture,Bi=yt||y.options.rotating||y.options.zooming||An||si?pe.LINEAR:pe.NEAREST,pi=it.imageAtlasTexture.size}const jn=Xt(it,1,y.transform.zoom),Br=ti(nt.posMatrix,se,_e,y.transform,jn),bo=eo(nt.posMatrix,se,_e,y.transform,jn),Ho=He&&ft.hasTextData(),Ia=h.layout.get("icon-text-fit")!=="none"&&Ho&&ft.hasIconData();if(Ee){const An=y.style.map.terrain?(Kr,Pn)=>y.style.map.terrain.getElevation(nt,Kr,Pn):null,sn=h.layout.get("text-rotation-alignment")==="map";X(ft,nt.posMatrix,y,m,Br,bo,se,F,sn,An)}const Xo=y.translatePosMatrix(nt.posMatrix,it,b,E),vo=Ee||m&&He||Ia?_c:Br,Ln=y.translatePosMatrix(bo,it,b,E,!0),on=yt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let en;en=yt?ft.iconsInText?ma(Kt.kind,Qt,Ze,se,y,Xo,vo,Ln,pi,Nn):pa(Kt.kind,Qt,Ze,se,y,Xo,vo,Ln,m,pi,!0):fa(Kt.kind,Qt,Ze,se,y,Xo,vo,Ln,m,pi);const Xr={program:Si,buffers:_t,uniformValues:en,atlasTexture:fn,atlasTextureIcon:rn,atlasInterpolation:Bi,atlasInterpolationIcon:Rr,isSDF:yt,hasHalo:on};if(ve&&ft.canOverlap){De=!0;const An=_t.segments.get();for(const sn of An)Xe.push({segments:new a.$([sn]),sortKey:sn.sortKey,state:Xr,terrainData:ci})}else Xe.push({segments:_t.segments,sortKey:0,state:Xr,terrainData:ci})}De&&Xe.sort((nt,it)=>nt.sortKey-it.sortKey);for(const nt of Xe){const it=nt.state;if(J.activeTexture.set(pe.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,pe.CLAMP_TO_EDGE),it.atlasTextureIcon&&(J.activeTexture.set(pe.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),it.isSDF){const ft=it.uniformValues;it.hasHalo&&(ft.u_is_halo=1,uh(it.buffers,nt.segments,h,y,it.program,We,q,Z,ft,nt.terrainData)),ft.u_is_halo=0}uh(it.buffers,nt.segments,h,y,it.program,We,q,Z,it.uniformValues,nt.terrainData)}}function uh(y,r,h,p,m,b,E,M,A,F){const q=p.context;m.draw(q,q.gl.TRIANGLES,b,E,M,Gi.disabled,A,F,h.id,y.layoutVertexBuffer,y.indexBuffer,r,h.paint,p.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function sl(y,r,h,p,m){if(!h||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let E=b[h.to.toString()],M=b[h.from.toString()];if(!E&&M&&(E=M),!M&&E&&(M=E),!E||!M){const A=m.getPaintProperty(r);E=b[A],M=b[A]}E&&M&&y.setConstantPatternPositions(E,M)}function hh(y,r,h,p,m,b,E){const M=y.context.gl,A="fill-pattern",F=h.paint.get(A),q=F&&F.constantOr(1),Z=h.getCrossfadeParameters();let J,pe,fe,_e,se;E?(pe=q&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=M.LINES):(pe=q?"fillPattern":"fill",J=M.TRIANGLES);const Ee=F.constantOr(null);for(const Ze of p){const ve=r.getTile(Ze);if(q&&!ve.patternsLoaded())continue;const De=ve.getBucket(h);if(!De)continue;const We=De.programConfigurations.get(h.id),He=y.useProgram(pe,We),Xe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ze);q&&(y.context.activeTexture.set(M.TEXTURE0),ve.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),We.updatePaintBuffers(Z)),sl(We,A,Ee,ve,h);const nt=Xe?Ze:null,it=y.translatePosMatrix(nt?nt.posMatrix:Ze.posMatrix,ve,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){_e=De.indexBuffer2,se=De.segments2;const ft=[M.drawingBufferWidth,M.drawingBufferHeight];fe=pe==="fillOutlinePattern"&&q?Xu(it,y,Z,ve,ft):Bd(it,ft)}else _e=De.indexBuffer,se=De.segments,fe=q?Za(it,y,Z,ve):Hu(it);He.draw(y.context,J,m,y.stencilModeForClipping(Ze),b,Gi.disabled,fe,Xe,h.id,De.layoutVertexBuffer,_e,se,h.paint,y.transform.zoom,We)}}function al(y,r,h,p,m,b,E){const M=y.context,A=M.gl,F="fill-extrusion-pattern",q=h.paint.get(F),Z=q.constantOr(1),J=h.getCrossfadeParameters(),pe=h.paint.get("fill-extrusion-opacity"),fe=q.constantOr(null);for(const _e of p){const se=r.getTile(_e),Ee=se.getBucket(h);if(!Ee)continue;const Ze=y.style.map.terrain&&y.style.map.terrain.getTerrainData(_e),ve=Ee.programConfigurations.get(h.id),De=y.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",ve);Z&&(y.context.activeTexture.set(A.TEXTURE0),se.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ve.updatePaintBuffers(J)),sl(ve,F,fe,se,h);const We=y.translatePosMatrix(_e.posMatrix,se,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),Xe=Z?Rd(We,y,He,pe,_e,J,se):ua(We,y,He,pe);De.draw(M,M.gl.TRIANGLES,m,b,E,Gi.backCCW,Xe,Ze,h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,y.transform.zoom,ve,y.style.map.terrain&&Ee.centroidVertexBuffer)}}function ll(y,r,h,p,m,b,E){const M=y.context,A=M.gl,F=h.fbo;if(!F)return;const q=y.useProgram("hillshade"),Z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(r);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),q.draw(M,A.TRIANGLES,m,b,E,Gi.disabled,((J,pe,fe,_e)=>{const se=fe.paint.get("hillshade-shadow-color"),Ee=fe.paint.get("hillshade-highlight-color"),Ze=fe.paint.get("hillshade-accent-color");let ve=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=J.transform.angle);const De=!J.options.moving;return{u_matrix:_e?_e.posMatrix:J.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),De),u_image:0,u_latrange:Qu(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),ve],u_shadow:se,u_highlight:Ee,u_accent:Ze}})(y,h,p,Z?r:null),Z,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function yc(y,r,h,p,m,b){const E=y.context,M=E.gl,A=r.dem;if(A&&A.data){const F=A.dim,q=A.stride,Z=A.getPixels();if(E.activeTexture.set(M.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||y.getTileTexture(q),r.demTexture){const pe=r.demTexture;pe.update(Z,{premultiply:!1}),pe.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else r.demTexture=new ne(E,Z,M.RGBA,{premultiply:!1}),r.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);E.activeTexture.set(M.TEXTURE0);let J=r.fbo;if(!J){const pe=new ne(E,{width:F,height:F,data:null},M.RGBA);pe.bind(M.LINEAR,M.CLAMP_TO_EDGE),J=r.fbo=E.createFramebuffer(F,F,!0,!1),J.colorAttachment.set(pe.texture)}E.bindFramebuffer.set(J.framebuffer),E.viewport.set([0,0,F,F]),y.useProgram("hillshadePrepare").draw(E,M.TRIANGLES,p,m,b,Gi.disabled,((pe,fe)=>{const _e=fe.stride,se=a.F();return a.aN(se,0,a.W,-a.W,0,0,1),a.H(se,se,[0,-a.W,0]),{u_matrix:se,u_image:1,u_dimension:[_e,_e],u_zoom:pe.overscaledZ,u_unpack:fe.getUnpackVector()}})(r.tileID,A),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function dh(y,r,h,p,m,b){const E=p.paint.get("raster-fade-duration");if(!b&&E>0){const M=k.now(),A=(M-y.timeAdded)/E,F=r?(M-r.timeAdded)/E:-1,q=h.getSource(),Z=m.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),J=!r||Math.abs(r.tileID.overscaledZ-Z)>Math.abs(y.tileID.overscaledZ-Z),pe=J&&y.refreshedUponExpiration?1:a.ac(J?A:1-F,0,1);return y.refreshedUponExpiration&&A>=1&&(y.refreshedUponExpiration=!1),r?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}const fh=new a.aO(1,0,0,1),cl=new a.aO(0,1,0,1),bc=new a.aO(0,0,1,1),Xd=new a.aO(1,0,1,1),ph=new a.aO(0,1,1,1);function hn(y,r,h,p){dr(y,0,r+h/2,y.transform.width,h,p)}function Zo(y,r,h,p){dr(y,r-h/2,0,h,y.transform.height,p)}function dr(y,r,h,p,m,b){const E=y.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(r*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),E.clear({color:b}),M.disable(M.SCISSOR_TEST)}function vc(y,r,h){const p=y.context,m=p.gl,b=h.posMatrix,E=y.useProgram("debug"),M=ki.disabled,A=$i.disabled,F=y.colorModeForRenderPass(),q="$debug",Z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const J=r.getTileByID(h.key).latestRawTileData,pe=Math.floor((J&&J.byteLength||0)/1024),fe=r.getTile(h).tileSize,_e=512/Math.min(fe,512)*(h.overscaledZ/y.transform.zoom)*.5;let se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(se+=` => ${h.overscaledZ}`),function(Ee,Ze){Ee.initDebugOverlayCanvas();const ve=Ee.debugOverlayCanvas,De=Ee.context.gl,We=Ee.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,ve.width,ve.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(Ze,5,5),We.strokeText(Ze,5,5),Ee.debugOverlayTexture.update(ve),Ee.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(y,`${se} ${pe}kB`),E.draw(p,m.TRIANGLES,M,A,kn.alphaBlended,Gi.disabled,Ju(b,a.aO.transparent,_e),null,q,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),E.draw(p,m.LINE_STRIP,M,A,F,Gi.disabled,Ju(b,a.aO.red),Z,q,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function ul(y,r,h){const p=y.context,m=p.gl,b=y.colorModeForRenderPass(),E=new ki(m.LEQUAL,ki.ReadWrite,y.depthRangeFor3D),M=y.useProgram("terrain"),A=r.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const F of h){const q=y.renderToTexture.getTexture(F),Z=r.getTerrainData(F.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,q.texture);const J={u_matrix:y.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(y.transform.zoom)};M.draw(p,m.TRIANGLES,E,$i.disabled,b,Gi.backCCW,J,Z,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class mh{constructor(r,h){this.context=new Hd(r),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=qi.maxUnderzooming+qi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vo}resize(r,h,p){if(this.width=Math.floor(r*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const r=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=r.createVertexBuffer(h,Ua.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=r.createVertexBuffer(p,Ua.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=r.createVertexBuffer(m,$e.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const b=new a.aV;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(b,Ua.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(E);const M=new a.aX;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(M);const A=this.context.gl;this.stencilClearMode=new $i({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const r=this.context,h=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,h.TRIANGLES,ki.disabled,this.stencilClearMode,kn.disabled,Gi.disabled,Ga(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,h){if(this.currentStencilSource===r.source||!r.isTileClipped()||!h||!h.length)return;this.currentStencilSource=r.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(kn.disabled),p.setDepthMode(ki.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const M=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);b.draw(p,m.TRIANGLES,ki.disabled,new $i({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),kn.disabled,Gi.disabled,Ga(E.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,h=this.context.gl;return new $i({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){const h=this.context.gl;return new $i({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(r){const h=this.context.gl,p=r.sort((E,M)=>M.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let M=0;M<b;M++)E[M+m]=new $i({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[E,p]}return[{[m]:$i.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new kn([r.CONSTANT_COLOR,r.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?kn.unblended:kn.alphaBlended}depthModeForSublayer(r,h,p){if(!this.opaquePassEnabledForLayer())return ki.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new ki(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,h){this.style=r,this.options=h,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(k.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},E={},M={};for(const A in m){const F=m[A];F.used&&F.prepare(this.context),b[A]=F.getVisibleCoordinates(),E[A]=b[A].slice().reverse(),M[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of p){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const q=E[F.source];(F.type==="custom"||q.length)&&this.renderLayer(this,m[F.source],F,q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],F=m[A.source],q=b[A.source];this._renderTileClippingMasks(A,q),this.renderLayer(this,F,A,q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],F=m[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const q=(A.type==="symbol"?M:E)[A.source];this._renderTileClippingMasks(A,b[A.source]),this.renderLayer(this,F,A,q)}if(this.options.showTileBoundaries){const A=function(F,q){let Z=null;const J=Object.values(F._layers).flatMap(se=>se.source&&!se.isHidden(q)?[F.sourceCaches[se.source]]:[]),pe=J.filter(se=>se.getSource().type==="vector"),fe=J.filter(se=>se.getSource().type!=="vector"),_e=se=>{(!Z||Z.getSource().maxzoom<se.getSource().maxzoom)&&(Z=se)};return pe.forEach(se=>_e(se)),Z||fe.forEach(se=>_e(se)),Z}(this.style,this.transform.zoom);A&&function(F,q,Z){for(let J=0;J<Z.length;J++)vc(F,q,Z[J])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;hn(A,A.transform.height-(F.top||0),3,fh),hn(A,F.bottom||0,3,cl),Zo(A,F.left||0,3,bc),Zo(A,A.transform.width-(F.right||0),3,Xd);const q=A.transform.centerPoint;(function(Z,J,pe,fe){dr(Z,J-1,pe-10,2,20,fe),dr(Z,J-10,pe-1,20,2,fe)})(A,q.x,A.transform.height-q.y,ph)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=r?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,E){const M=b.context,A=M.gl,F=kn.unblended,q=new ki(A.LEQUAL,ki.ReadWrite,[0,1]),Z=E.getTerrainMesh(),J=E.sourceCache.getRenderableTiles(),pe=b.useProgram("terrainDepth");M.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1});for(const fe of J){const _e=E.getTerrainData(fe.tileID),se={u_matrix:b.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(b.transform.zoom)};pe.draw(M,A.TRIANGLES,q,$i.disabled,F,Gi.backCCW,se,_e,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,E){const M=b.context,A=M.gl,F=kn.unblended,q=new ki(A.LEQUAL,ki.ReadWrite,[0,1]),Z=E.getTerrainMesh(),J=E.getCoordsTexture(),pe=E.sourceCache.getRenderableTiles(),fe=b.useProgram("terrainCoords");M.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const _e of pe){const se=E.getTerrainData(_e.tileID);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,J.texture);const Ee={u_matrix:b.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(b.transform.zoom)};fe.draw(M,A.TRIANGLES,q,$i.disabled,F,Gi.backCCW,Ee,se,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),E.coordsIndex.push(_e.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(r,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,E,M,A,F){if(b.renderPass!=="translucent")return;const q=$i.disabled,Z=b.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(J,pe,fe,_e,se,Ee,Ze){const ve=pe.transform,De=se==="map",We=Ee==="map";for(const He of J){const Xe=_e.getTile(He),nt=Xe.getBucket(fe);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const it=a.ag(nt.textSizeData,ve.zoom),ft=Xt(Xe,1,pe.transform.zoom),_t=ti(He.posMatrix,We,De,pe.transform,ft),oi=fe.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(it){const yt=Math.pow(2,ve.zoom-Xe.tileID.overscaledZ);nl(nt,De,We,Ze,ve,_t,He.posMatrix,yt,it,oi,pe.style.map.terrain?(Kt,si)=>pe.style.map.terrain.getElevation(He,Kt,si):null)}}}(A,b,M,E,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),F),M.paint.get("icon-opacity").constantOr(1)!==0&&ol(b,E,M,A,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),q,Z),M.paint.get("text-opacity").constantOr(1)!==0&&ol(b,E,M,A,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),q,Z),E.map.showCollisionBoxes&&(il(b,E,M,A,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),il(b,E,M,A,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(r,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,E,M,A){if(b.renderPass!=="translucent")return;const F=M.paint.get("circle-opacity"),q=M.paint.get("circle-stroke-width"),Z=M.paint.get("circle-stroke-opacity"),J=!M.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(q.constantOr(1)===0||Z.constantOr(1)===0))return;const pe=b.context,fe=pe.gl,_e=b.depthModeForSublayer(0,ki.ReadOnly),se=$i.disabled,Ee=b.colorModeForRenderPass(),Ze=[];for(let ve=0;ve<A.length;ve++){const De=A[ve],We=E.getTile(De),He=We.getBucket(M);if(!He)continue;const Xe=He.programConfigurations.get(M.id),nt=b.useProgram("circle",Xe),it=He.layoutVertexBuffer,ft=He.indexBuffer,_t=b.style.map.terrain&&b.style.map.terrain.getTerrainData(De),oi={programConfiguration:Xe,program:nt,layoutVertexBuffer:it,indexBuffer:ft,uniformValues:Fd(b,De,We,M),terrainData:_t};if(J){const yt=He.segments.get();for(const Kt of yt)Ze.push({segments:new a.$([Kt]),sortKey:Kt.sortKey,state:oi})}else Ze.push({segments:He.segments,sortKey:0,state:oi})}J&&Ze.sort((ve,De)=>ve.sortKey-De.sortKey);for(const ve of Ze){const{programConfiguration:De,program:We,layoutVertexBuffer:He,indexBuffer:Xe,uniformValues:nt,terrainData:it}=ve.state;We.draw(pe,fe.TRIANGLES,_e,se,Ee,Gi.disabled,nt,it,M.id,He,Xe,ve.segments,M.paint,b.transform.zoom,De)}})(r,h,p,m);break;case"heatmap":(function(b,E,M,A){if(M.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const F=b.context,q=F.gl,Z=$i.disabled,J=new kn([q.ONE,q.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(pe,fe,_e){const se=pe.gl;pe.activeTexture.set(se.TEXTURE1),pe.viewport.set([0,0,fe.width/4,fe.height/4]);let Ee=_e.heatmapFbo;if(Ee)se.bindTexture(se.TEXTURE_2D,Ee.colorAttachment.get()),pe.bindFramebuffer.set(Ee.framebuffer);else{const Ze=se.createTexture();se.bindTexture(se.TEXTURE_2D,Ze),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.LINEAR),Ee=_e.heatmapFbo=pe.createFramebuffer(fe.width/4,fe.height/4,!1,!1),function(ve,De,We,He){var Xe,nt;const it=ve.gl,ft=(Xe=ve.HALF_FLOAT)!==null&&Xe!==void 0?Xe:it.UNSIGNED_BYTE,_t=(nt=ve.RGBA16F)!==null&&nt!==void 0?nt:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,_t,De.width/4,De.height/4,0,it.RGBA,ft,null),He.colorAttachment.set(We)}(pe,fe,Ze,Ee)}})(F,b,M),F.clear({color:a.aO.transparent});for(let pe=0;pe<A.length;pe++){const fe=A[pe];if(E.hasRenderableParent(fe))continue;const _e=E.getTile(fe),se=_e.getBucket(M);if(!se)continue;const Ee=se.programConfigurations.get(M.id),Ze=b.useProgram("heatmap",Ee),{zoom:ve}=b.transform;Ze.draw(F,q.TRIANGLES,ki.disabled,Z,J,Gi.disabled,Yu(fe.posMatrix,_e,ve,M.paint.get("heatmap-intensity")),null,M.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,M.paint,b.transform.zoom,Ee)}F.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(F,q){const Z=F.context,J=Z.gl,pe=q.heatmapFbo;if(!pe)return;Z.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,pe.colorAttachment.get()),Z.activeTexture.set(J.TEXTURE1);let fe=q.colorRampTexture;fe||(fe=q.colorRampTexture=new ne(Z,q.colorRamp,J.RGBA)),fe.bind(J.LINEAR,J.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(Z,J.TRIANGLES,ki.disabled,$i.disabled,F.colorModeForRenderPass(),Gi.disabled,((_e,se,Ee,Ze)=>{const ve=a.F();a.aN(ve,0,_e.width,_e.height,0,0,1);const De=_e.context.gl;return{u_matrix:ve,u_world:[De.drawingBufferWidth,De.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:se.paint.get("heatmap-opacity")}})(F,q),null,q.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,q.paint,F.transform.zoom)}(b,M))})(r,h,p,m);break;case"line":(function(b,E,M,A){if(b.renderPass!=="translucent")return;const F=M.paint.get("line-opacity"),q=M.paint.get("line-width");if(F.constantOr(1)===0||q.constantOr(1)===0)return;const Z=b.depthModeForSublayer(0,ki.ReadOnly),J=b.colorModeForRenderPass(),pe=M.paint.get("line-dasharray"),fe=M.paint.get("line-pattern"),_e=fe.constantOr(1),se=M.paint.get("line-gradient"),Ee=M.getCrossfadeParameters(),Ze=_e?"linePattern":pe?"lineSDF":se?"lineGradient":"line",ve=b.context,De=ve.gl;let We=!0;for(const He of A){const Xe=E.getTile(He);if(_e&&!Xe.patternsLoaded())continue;const nt=Xe.getBucket(M);if(!nt)continue;const it=nt.programConfigurations.get(M.id),ft=b.context.program.get(),_t=b.useProgram(Ze,it),oi=We||_t.program!==ft,yt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),Kt=fe.constantOr(null);if(Kt&&Xe.imageAtlas){const Qt=Xe.imageAtlas,ci=Qt.patternPositions[Kt.to.toString()],pi=Qt.patternPositions[Kt.from.toString()];ci&&pi&&it.setConstantPatternPositions(ci,pi)}const si=yt?He:null,Si=_e?rs(b,Xe,M,Ee,si):pe?$a(b,Xe,M,pe,Ee,si):se?eh(b,Xe,M,nt.lineClipsArray.length,si):Wa(b,Xe,M,si);if(_e)ve.activeTexture.set(De.TEXTURE0),Xe.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),it.updatePaintBuffers(Ee);else if(pe&&(oi||b.lineAtlas.dirty))ve.activeTexture.set(De.TEXTURE0),b.lineAtlas.bind(ve);else if(se){const Qt=nt.gradients[M.id];let ci=Qt.texture;if(M.gradientVersion!==Qt.version){let pi=256;if(M.stepInterpolant){const fn=E.getSource().maxzoom,Bi=He.canonical.z===fn?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;pi=a.ac(a.aT(nt.maxLineLength/a.W*1024*Bi),256,ve.maxTextureSize)}Qt.gradient=a.aU({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:Qt.gradient||void 0,clips:nt.lineClipsArray}),Qt.texture?Qt.texture.update(Qt.gradient):Qt.texture=new ne(ve,Qt.gradient,De.RGBA),Qt.version=M.gradientVersion,ci=Qt.texture}ve.activeTexture.set(De.TEXTURE0),ci.bind(M.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}_t.draw(ve,De.TRIANGLES,Z,b.stencilModeForClipping(He),J,Gi.disabled,Si,yt,M.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,M.paint,b.transform.zoom,it,nt.layoutVertexBuffer2),We=!1}})(r,h,p,m);break;case"fill":(function(b,E,M,A){const F=M.paint.get("fill-color"),q=M.paint.get("fill-opacity");if(q.constantOr(1)===0)return;const Z=b.colorModeForRenderPass(),J=M.paint.get("fill-pattern"),pe=b.opaquePassEnabledForLayer()&&!J.constantOr(1)&&F.constantOr(a.aO.transparent).a===1&&q.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===pe){const fe=b.depthModeForSublayer(1,b.renderPass==="opaque"?ki.ReadWrite:ki.ReadOnly);hh(b,E,M,A,fe,Z,!1)}if(b.renderPass==="translucent"&&M.paint.get("fill-antialias")){const fe=b.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,ki.ReadOnly);hh(b,E,M,A,fe,Z,!0)}})(r,h,p,m);break;case"fill-extrusion":(function(b,E,M,A){const F=M.paint.get("fill-extrusion-opacity");if(F!==0&&b.renderPass==="translucent"){const q=new ki(b.context.gl.LEQUAL,ki.ReadWrite,b.depthRangeFor3D);if(F!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))al(b,E,M,A,q,$i.disabled,kn.disabled),al(b,E,M,A,q,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const Z=b.colorModeForRenderPass();al(b,E,M,A,q,$i.disabled,Z)}}})(r,h,p,m);break;case"hillshade":(function(b,E,M,A){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const F=b.context,q=b.depthModeForSublayer(0,ki.ReadOnly),Z=b.colorModeForRenderPass(),[J,pe]=b.renderPass==="translucent"?b.stencilConfigForOverlap(A):[{},A];for(const fe of pe){const _e=E.getTile(fe);_e.needsHillshadePrepare!==void 0&&_e.needsHillshadePrepare&&b.renderPass==="offscreen"?yc(b,_e,M,q,$i.disabled,Z):b.renderPass==="translucent"&&ll(b,fe,_e,M,q,J[fe.overscaledZ],Z)}F.viewport.set([0,0,b.width,b.height])})(r,h,p,m);break;case"raster":(function(b,E,M,A){if(b.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!A.length)return;const F=b.context,q=F.gl,Z=E.getSource(),J=b.useProgram("raster"),pe=b.colorModeForRenderPass(),[fe,_e]=Z instanceof kt?[{},A]:b.stencilConfigForOverlap(A),se=_e[_e.length-1].overscaledZ,Ee=!b.options.moving;for(const Ze of _e){const ve=b.depthModeForSublayer(Ze.overscaledZ-se,M.paint.get("raster-opacity")===1?ki.ReadWrite:ki.ReadOnly,q.LESS),De=E.getTile(Ze);De.registerFadeDuration(M.paint.get("raster-fade-duration"));const We=E.findLoadedParent(Ze,0),He=dh(De,We,E,M,b.transform,b.style.map.terrain);let Xe,nt;const it=M.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;F.activeTexture.set(q.TEXTURE0),De.texture.bind(it,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(q.TEXTURE1),We?(We.texture.bind(it,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,We.tileID.overscaledZ-De.tileID.overscaledZ),nt=[De.tileID.canonical.x*Xe%1,De.tileID.canonical.y*Xe%1]):De.texture.bind(it,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);const ft=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ze),_t=ft?Ze:null,oi=_t?_t.posMatrix:b.transform.calculatePosMatrix(Ze.toUnwrapped(),Ee),yt=Ha(oi,nt||[0,0],Xe||1,He,M);Z instanceof kt?J.draw(F,q.TRIANGLES,ve,$i.disabled,pe,Gi.disabled,yt,ft,M.id,Z.boundsBuffer,b.quadTriangleIndexBuffer,Z.boundsSegments):J.draw(F,q.TRIANGLES,ve,fe[Ze.overscaledZ],pe,Gi.disabled,yt,ft,M.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(r,h,p,m);break;case"background":(function(b,E,M,A){const F=M.paint.get("background-color"),q=M.paint.get("background-opacity");if(q===0)return;const Z=b.context,J=Z.gl,pe=b.transform,fe=pe.tileSize,_e=M.paint.get("background-pattern");if(b.isPatternMissing(_e))return;const se=!_e&&F.a===1&&q===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==se)return;const Ee=$i.disabled,Ze=b.depthModeForSublayer(0,se==="opaque"?ki.ReadWrite:ki.ReadOnly),ve=b.colorModeForRenderPass(),De=b.useProgram(_e?"backgroundPattern":"background"),We=A||pe.coveringTiles({tileSize:fe,terrain:b.style.map.terrain});_e&&(Z.activeTexture.set(J.TEXTURE0),b.imageManager.bind(b.context));const He=M.getCrossfadeParameters();for(const Xe of We){const nt=A?Xe.posMatrix:b.transform.calculatePosMatrix(Xe.toUnwrapped()),it=_e?Nd(nt,q,b,_e,{tileID:Xe,tileSize:fe},He):Od(nt,q,F),ft=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Xe);De.draw(Z,J.TRIANGLES,Ze,Ee,ve,Gi.disabled,it,ft,M.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(r,0,p,m);break;case"custom":(function(b,E,M){const A=b.context,F=M.implementation;if(b.renderPass==="offscreen"){const q=F.prerender;q&&(b.setCustomLayerDefaults(),A.setColorMode(b.colorModeForRenderPass()),q.call(F,A.gl,b.transform.customLayerMatrix()),A.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),A.setColorMode(b.colorModeForRenderPass()),A.setStencilMode($i.disabled);const q=F.renderingMode==="3d"?new ki(b.context.gl.LEQUAL,ki.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,ki.ReadOnly);A.setDepthMode(q),F.render(A.gl,b.transform.customLayerMatrix()),A.setDirty(),b.setBaseState(),A.bindFramebuffer.set(null)}})(r,0,p)}}translatePosMatrix(r,h,p,m,b){if(!p[0]&&!p[1])return r;const E=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(E){const F=Math.sin(E),q=Math.cos(E);p=[p[0]*q-p[1]*F,p[0]*F+p[1]*q]}const M=[b?p[0]:Xt(h,p[0],this.transform.zoom),b?p[1]:Xt(h,p[1],this.transform.zoom),0],A=new Float32Array(16);return a.H(A,r,M),A}saveTileTexture(r){const h=this._tileTextures[r.size[0]];h?h.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const h=this._tileTextures[r];return h&&h.length>0?h.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const h=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!h||!p}useProgram(r,h){this.cache=this.cache||{};const p=r+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new qo(this.context,ca[r],h,th[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ne(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:h}=this.context.gl;return this.width!==r||this.height!==h}}class Go{constructor(r,h){this.points=r,this.planes=h}static fromInvProjectionMatrix(r,h,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const A=1/(M=a.af([],M,r))[3]/h*m;return a.a$(M,M,[A,A,1/M[3],A])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const A=function(J,pe){var fe=pe[0],_e=pe[1],se=pe[2],Ee=fe*fe+_e*_e+se*se;return Ee>0&&(Ee=1/Math.sqrt(Ee)),J[0]=pe[0]*Ee,J[1]=pe[1]*Ee,J[2]=pe[2]*Ee,J}([],function(J,pe,fe){var _e=pe[0],se=pe[1],Ee=pe[2],Ze=fe[0],ve=fe[1],De=fe[2];return J[0]=se*De-Ee*ve,J[1]=Ee*Ze-_e*De,J[2]=_e*ve-se*Ze,J}([],ee([],b[M[0]],b[M[1]]),ee([],b[M[2]],b[M[1]]))),F=-((q=A)[0]*(Z=b[M[1]])[0]+q[1]*Z[1]+q[2]*Z[2]);var q,Z;return A.concat(F)});return new Go(b,E)}}class Wo{constructor(r,h){this.min=r,this.max=h,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(r){const h=[r%2==0,r<2],p=oe(this.min),m=oe(this.max);for(let b=0;b<h.length;b++)p[b]=h[b]?this.min[b]:this.center[b],m[b]=h[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new Wo(p,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<r.planes.length;m++){const b=r.planes[m];let E=0;for(let M=0;M<h.length;M++)a.b0(b,h[M])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let M=0;M<r.points.length;M++){const A=r.points[M][m]-this.min[m];b=Math.min(b,A),E=Math.max(E,A)}if(E<0||b>this.max[m]-this.min[m])return 0}return 1}}class Fs{constructor(r=0,h=0,p=0,m=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=p,this.right=m}interpolate(r,h,p){return h.top!=null&&r.top!=null&&(this.top=a.z.number(r.top,h.top,p)),h.bottom!=null&&r.bottom!=null&&(this.bottom=a.z.number(r.bottom,h.bottom,p)),h.left!=null&&r.left!=null&&(this.left=a.z.number(r.left,h.left,p)),h.right!=null&&r.right!=null&&(this.right=a.z.number(r.right,h.right,p)),this}getCenter(r,h){const p=a.ac((this.left+r-this.right)/2,0,r),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wc=85.051129;class hl{constructor(r,h,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=r||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const r=new hl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this.minElevationForCurrentTile=r.minElevationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const h=-a.b1(r,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var E=m[0],M=m[1],A=m[2],F=m[3],q=Math.sin(b),Z=Math.cos(b);p[0]=E*Z+A*q,p[1]=M*Z+F*q,p[2]=E*-q+A*Z,p[3]=M*-q+F*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const h=a.ac(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const h=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,p){this._unmodified=!1,this._edgeInsets.interpolate(r,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const h=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(r){const h=[new a.b2(0,r)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),M=Math.floor(Math.min(p.x,m.x,b.x,E.x)),A=Math.floor(Math.max(p.x,m.x,b.x,E.x)),F=1;for(let q=M-F;q<=A+F;q++)q!==0&&h.push(new a.b2(q,r))}return h}coveringTiles(r){var h,p;let m=this.coveringZoomLevel(r);const b=m;if(r.minzoom!==void 0&&m<r.minzoom)return[];r.maxzoom!==void 0&&m>r.maxzoom&&(m=r.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),M=a.Y.fromLngLat(this.center),A=Math.pow(2,m),F=[A*E.x,A*E.y,0],q=[A*M.x,A*M.y,0],Z=Go.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let J=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(J=m);const pe=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,fe=ve=>({aabb:new Wo([ve*A,0,0],[(ve+1)*A,A,0]),zoom:0,x:0,y:0,wrap:ve,fullyVisible:!1}),_e=[],se=[],Ee=m,Ze=r.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let ve=1;ve<=3;ve++)_e.push(fe(-ve)),_e.push(fe(ve));for(_e.push(fe(0));_e.length>0;){const ve=_e.pop(),De=ve.x,We=ve.y;let He=ve.fullyVisible;if(!He){const _t=ve.aabb.intersects(Z);if(_t===0)continue;He=_t===2}const Xe=r.terrain?F:q,nt=ve.aabb.distanceX(Xe),it=ve.aabb.distanceY(Xe),ft=Math.max(Math.abs(nt),Math.abs(it));if(ve.zoom===Ee||ft>pe+(1<<Ee-ve.zoom)-2&&ve.zoom>=J){const _t=Ee-ve.zoom,oi=F[0]-.5-(De<<_t),yt=F[1]-.5-(We<<_t);se.push({tileID:new a.Q(ve.zoom===Ee?Ze:ve.zoom,ve.wrap,ve.zoom,De,We),distanceSq:be([q[0]-.5-De,q[1]-.5-We]),tileDistanceToCamera:Math.sqrt(oi*oi+yt*yt)})}else for(let _t=0;_t<4;_t++){const oi=(De<<1)+_t%2,yt=(We<<1)+(_t>>1),Kt=ve.zoom+1;let si=ve.aabb.quadrant(_t);if(r.terrain){const Si=new a.Q(Kt,ve.wrap,Kt,oi,yt),Qt=r.terrain.getMinMaxElevation(Si),ci=(h=Qt.minElevation)!==null&&h!==void 0?h:this.elevation,pi=(p=Qt.maxElevation)!==null&&p!==void 0?p:this.elevation;si=new Wo([si.min[0],si.min[1],ci],[si.max[0],si.max[1],pi])}_e.push({aabb:si,zoom:Kt,x:oi,y:yt,wrap:ve.wrap,fullyVisible:He})}}return se.sort((ve,De)=>ve.distanceSq-De.distanceSq).map(ve=>ve.tileID)}resize(r,h){this.width=r,this.height=h,this.pixelsToGLUnits=[2/r,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const h=a.ac(r.lat,-85.051129,wc);return new a.P(a.N(r.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(r){return new a.Y(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,r),b=r.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const E=p+h-b,M=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,m.lat),A=this.scaleZoom(M/this.tileSize);this._elevation=b,this._center=m,this.zoom=A}setLocationAtPoint(r,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(r),E=new a.Y(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,h){return h?this.coordinatePoint(this.locationCoordinate(r),h.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,h){return this.coordinateLocation(this.pointCoordinate(r,h))}locationCoordinate(r){return a.Y.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,h){if(h){const J=h.pointCoordinate(r);if(J!=null)return J}const p=[r.x,r.y,0,1],m=[r.x,r.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const b=p[3],E=m[3],M=p[1]/b,A=m[1]/E,F=p[2]/b,q=m[2]/E,Z=F===q?0:(0-F)/(q-F);return new a.Y(a.z.number(p[0]/b,m[0]/E,Z)/this.worldSize,a.z.number(M,A,Z)/this.worldSize)}coordinatePoint(r,h=0,p=this.pixelMatrix){const m=[r.x*this.worldSize,r.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new je().extend(this.pointLocation(new a.P(0,r))).extend(this.pointLocation(new a.P(this.width,r))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,wc])}calculatePosMatrix(r,h=!1){const p=r.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=r.canonical,E=this.worldSize/this.zoomScale(b.z),M=b.x+Math.pow(2,b.z)*r.wrap,A=a.an(new Float64Array(16));return a.H(A,A,[M*E,b.y*E,0]),a.J(A,A,[E/a.W,E/a.W,1]),a.K(A,h?this.alignedProjMatrix:this.projMatrix,A),m[p]=new Float32Array(A),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(r,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(r.lng,r.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const ve=179.9999999999;m=[-ve,ve]}const b=this.tileSize*this.zoomScale(p.zoom);let E=0,M=b,A=0,F=b,q=0,Z=0;const{x:J,y:pe}=this.size;if(this.latRange){const ve=this.latRange;E=a.O(ve[1])*b,M=a.O(ve[0])*b,M-E<pe&&(q=pe/(M-E))}m&&(A=a.b1(a.N(m[0])*b,0,b),F=a.b1(a.N(m[1])*b,0,b),F<A&&(F+=b),F-A<J&&(Z=J/(F-A)));const{x:fe,y:_e}=this.project.call({worldSize:b},r);let se,Ee;const Ze=Math.max(Z||0,q||0);if(Ze){const ve=new a.P(Z?(F+A)/2:fe,q?(M+E)/2:_e);return p.center=this.unproject.call({worldSize:b},ve).wrap(),p.zoom+=this.scaleZoom(Ze),p}if(this.latRange){const ve=pe/2;_e-ve<E&&(Ee=E+ve),_e+ve>M&&(Ee=M-ve)}if(m){const ve=(A+F)/2;let De=fe;this._renderWorldCopies&&(De=a.b1(fe,ve-b/2,ve+b/2));const We=J/2;De-We<A&&(se=A+We),De+We>F&&(se=F-We)}if(se!==void 0||Ee!==void 0){const ve=new a.P(se??fe,Ee??_e);p.center=this.unproject.call({worldSize:b},ve).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=r,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),M=b-E*this._pixelPerMeter/Math.cos(this._pitch),A=E<0?M:b,F=Math.PI/2+this._pitch,q=this._fov*(.5+r.y/this.height),Z=Math.sin(q)*A/Math.sin(a.ac(Math.PI-F-q,.01,Math.PI-.01)),J=this.getHorizon(),pe=2*Math.atan(J/this.cameraToCenterDistance)*(.5+r.y/(2*J)),fe=Math.sin(pe)*A/Math.sin(a.ac(Math.PI-F-pe,.01,Math.PI-.01)),_e=Math.min(Z,fe),se=1.01*(Math.cos(Math.PI/2-this._pitch)*_e+A),Ee=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Ee,se),m[8]=2*-r.x/this.width,m[9]=2*r.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const Ze=this.width%2/2,ve=this.height%2/2,De=Math.cos(this.angle),We=Math.sin(this.angle),He=h-Math.round(h)+De*Ze+We*ve,Xe=p-Math.round(p)+De*ve+We*Ze,nt=new Float64Array(m);if(a.H(nt,nt,[He>.5?He-1:He,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=nt,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new a.P(0,0)),h=[r.x*this.worldSize,r.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,r))}getCameraQueryGeometry(r){const h=this.getCameraPoint();if(r.length===1)return[r[0],h];{let p=h.x,m=h.y,b=h.x,E=h.y;for(const M of r)p=Math.min(p,M.x),m=Math.min(m,M.y),b=Math.max(b,M.x),E=Math.max(E,M.y);return[new a.P(p,m),new a.P(b,m),new a.P(b,E),new a.P(p,E),new a.P(p,m)]}}lngLatToCameraDepth(r,h){const p=this.locationCoordinate(r),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function xc(y,r){let h,p=!1,m=null,b=null;const E=()=>{m=null,p&&(y.apply(b,h),m=setTimeout(E,r),p=!1)};return(...M)=>(p=!0,b=this,h=M,m||E(),m)}class kc{constructor(r){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=xc(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),E=Math.round(h.lng*b)/b,M=Math.round(h.lat*b)/b,A=this._map.getBearing(),F=this._map.getPitch();let q="";if(q+=r?`/${E}/${M}/${p}`:`${p}/${M}/${E}`,(A||F)&&(q+="/"+Math.round(10*A)/10),F&&(q+=`/${Math.round(F)}`),this._hashName){const Z=this._hashName;let J=!1;const pe=window.location.hash.slice(1).split("&").map(fe=>{const _e=fe.split("=")[0];return _e===Z?(J=!0,`${_e}=${q}`):fe}).filter(fe=>fe);return J||pe.push(`${Z}=${q}`),`#${pe.join("&")}`}return`#${q}`}}const _a={linearity:.3,easing:a.b6(0,0,.3,1)},ls=a.e({deceleration:2500,maxSpeed:1400},_a),gh=a.e({deceleration:20,maxSpeed:1400},_a),_h=a.e({deceleration:1e3,maxSpeed:360},_a),yh=a.e({deceleration:1e3,maxSpeed:90},_a);class bh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:k.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,h=k.now();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const b=ba(h.pan.mag(),p,a.e({},ls,r||{}));m.offset=h.pan.mult(b.amount/h.pan.mag()),m.center=this._map.transform.center,ya(m,b)}if(h.zoom){const b=ba(h.zoom,p,gh);m.zoom=this._map.transform.zoom+b.amount,ya(m,b)}if(h.bearing){const b=ba(h.bearing,p,_h);m.bearing=this._map.transform.bearing+a.ac(b.amount,-179,179),ya(m,b)}if(h.pitch){const b=ba(h.pitch,p,yh);m.pitch=this._map.transform.pitch+b.amount,ya(m,b)}if(m.zoom||m.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ya(y,r){(!y.duration||y.duration<r.duration)&&(y.duration=r.duration,y.easing=r.easing)}function ba(y,r,h){const{maxSpeed:p,linearity:m,deceleration:b}=h,E=a.ac(y*m/(r/1e3),-p,p),M=Math.abs(E)/(b*m);return{easing:h.easing,duration:1e3*M,amount:E*(M/2)}}class wr extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p,m={}){const b=C.mousePos(h.getCanvas(),p),E=h.unproject(b);super(r,a.e({point:b,lngLat:E,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class go extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){const m=r==="touchend"?p.changedTouches:p.touches,b=C.touchPos(h.getCanvasContainer(),m),E=b.map(A=>h.unproject(A)),M=b.reduce((A,F,q,Z)=>A.add(F.div(Z.length)),new a.P(0,0));super(r,{points:b,point:M,lngLats:E,lngLat:h.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class Sc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class to{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Sc(r.type,this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new wr(r.type,this._map,r))}mouseup(r){this._map.fire(new wr(r.type,this._map,r))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new wr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new wr(r.type,this._map,r))}mouseover(r){this._map.fire(new wr(r.type,this._map,r))}mouseout(r){this._map.fire(new wr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new go(r.type,this._map,r))}touchmove(r){this._map.fire(new go(r.type,this._map,r))}touchend(r){this._map.fire(new go(r.type,this._map,r))}touchcancel(r){this._map.fire(new go(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _o{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new wr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new wr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(a.P.convert(r),this._map.terrain)}}class io{constructor(r,h){this._map=r,this._tr=new Os(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(C.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const b=Math.min(m.x,p.x),E=Math.max(m.x,p.x),M=Math.min(m.y,p.y),A=Math.max(m.y,p.y);C.setTransform(this._box,`translate(${b}px,${M}px)`),this._box.style.width=E-b+"px",this._box.style.height=A-M+"px"}mouseupWindow(r,h){if(!this._active||r.button!==0)return;const p=this._startPos,m=h;if(this.reset(),C.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:r})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new a.k(r,{originalEvent:h}))}}function cs(y,r){if(y.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${r.length}`);const h={};for(let p=0;p<y.length;p++)h[y[p].identifier]=r[p];return h}class Kd{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new a.P(0,0);for(const E of m)b._add(E);return b.div(m.length)}(h),this.touches=cs(p,h)))}touchmove(r,h,p){if(this.aborted||!this.centroid)return;const m=cs(p,h);for(const b in this.touches){const E=m[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(r,h,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Tc{constructor(r){this.singleTap=new Kd(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,h,p){this.singleTap.touchstart(r,h,p)}touchmove(r,h,p){this.singleTap.touchmove(r,h,p)}touchend(r,h,p){const m=this.singleTap.touchend(r,h,p);if(m){const b=r.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(b&&E||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Jd{constructor(r){this._tr=new Os(r),this._zoomIn=new Tc({numTouches:1,numTaps:2}),this._zoomOut=new Tc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,p){this._zoomIn.touchstart(r,h,p),this._zoomOut.touchstart(r,h,p)}touchmove(r,h,p){this._zoomIn.touchmove(r,h,p),this._zoomOut.touchmove(r,h,p)}touchend(r,h,p){const m=this._zoomIn.touchend(r,h,p),b=this._zoomOut.touchend(r,h,p),E=this._tr;return m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:r})}):b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(b)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const h=this._moveFunction(...r);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(r,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&C.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const va={0:1,2:2};class yo{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const h=C.mouseButton(r);this._eventButton=h}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(h,p){const m=va[p];return h.buttons===void 0||(h.buttons&m)!==m}(r,this._eventButton)}isValidEndEvent(r){return C.mouseButton(r)===this._eventButton}}class Lt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const dl=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(r){r.preventDefault()}},js=({enable:y,clickTolerance:r,bearingDegreesPerPixelMoved:h=.8})=>{const p=new yo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,b)=>({bearingDelta:(b.x-m.x)*h}),moveStateManager:p,enable:y,assignEvents:dl})},Us=({enable:y,clickTolerance:r,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new yo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,b)=>({pitchDelta:(b.y-m.y)*h}),moveStateManager:p,enable:y,assignEvents:dl})};class vh{constructor(r,h){this._clickTolerance=r.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(r,h,p){return this._calculateTransform(r,h,p)}touchmove(r,h,p){if(this._active&&!(p.length<this.minTouchs()))return r.preventDefault(),this._calculateTransform(r,h,p)}touchend(r,h,p){this._calculateTransform(r,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,p){p.length>0&&(this._active=!0);const m=cs(p,h),b=new a.P(0,0),E=new a.P(0,0);let M=0;for(const F in m){const q=m[F],Z=this._touches[F];Z&&(b._add(q),E._add(q.sub(Z)),M++,m[F]=q)}if(this._touches=m,M<this.minTouchs()||!E.mag())return;const A=E.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,p){if(!this._firstTwoTouches)return;r.preventDefault();const[m,b]=this._firstTwoTouches,E=Vs(p,h,m),M=Vs(p,h,b);if(!E||!M)return;const A=this._aroundCenter?null:E.add(M).div(2);return this._move([E,M],A,r)}touchend(r,h,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,E=Vs(p,h,m),M=Vs(p,h,b);E&&M||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Vs(y,r,h){for(let p=0;p<y.length;p++)if(y[p].identifier===h)return r[p]}function wh(y,r){return Math.log(y/r)/Math.LN2}class xh extends St{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(wh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wh(this._distance,p),pinchAround:h}}}function fl(y,r){return 180*y.angleWith(r)/Math.PI}class Ec extends St{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h,p){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fl(this._vector,m),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const h=25/(Math.PI*this._minDiameter)*360,p=fl(r,this._startVector);return Math.abs(p)<h}}function pl(y){return Math.abs(y.y)>Math.abs(y.x)}class kh extends St{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,h,p){super.touchstart(r,h,p),this._currentTouchCount=p.length}_start(r){this._lastPoints=r,pl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=r[0].sub(this._lastPoints[0]),b=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(r,h,p){if(this._valid!==void 0)return this._valid;const m=r.mag()>=2,b=h.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=r.y>0==h.y>0;return pl(r)&&pl(h)&&E}}const Yd={panStep:100,bearingStep:15,pitchStep:10};class $o{constructor(r){this._tr=new Os(r);const h=Yd;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,p=0,m=0,b=0,E=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),b=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),b=1);break;case 38:r.shiftKey?m=1:(r.preventDefault(),E=-1);break;case 40:r.shiftKey?m=-1:(r.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:M=>{const A=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Qi,zoom:h?Math.round(A.zoom)+h*(r.shiftKey?2:1):A.zoom,bearing:A.bearing+p*this._bearingStep,pitch:A.pitch+m*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:A.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qi(y){return y*(2-y)}const wa=4.000244140625;class ml{constructor(r,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=r,this._tr=new Os(r),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!r[this._map.cooperativeGestures._bypassKey])return;let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=k.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%wa==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=C.mousePos(this._map.getCanvas(),r),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>wa?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,p=this._startZoom,m=this._easing;let b,E=!1;if(this._type==="wheel"&&p&&m){const M=Math.min((k.now()-this._lastWheelEventTime)/200,1),A=m(M);b=a.z.number(p,h,A),M<1?this._frameId||(this._frameId=!0):E=!0}else b=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(k.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),E=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-E*E);h=a.b6(E,M,.25,1)}return this._prevEase={start:k.now(),duration:r,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cc{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sh{constructor(r){this._tr=new Os(r),this.reset()}reset(){this._active=!1}dblclick(r,h){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Th{constructor(){this._tap=new Tc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],b=r.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;b&&E?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(r,h,p)}touchmove(r,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,r.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(r,h,p)}touchend(r,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(r,h,p);m&&(this._tapTime=r.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh{constructor(r,h,p){this._el=r,this._mousePan=h,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class no{constructor(r,h,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xa{constructor(r,h,p,m){this._el=r,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class jt{constructor(r,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",r);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(r){this._onCooperativeGesture(r.touches.length===1)}wheel(r){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!r[this._bypassKey])}_onCooperativeGesture(r){this._enabled&&r&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const $t=y=>y.zoom||y.drag||y.pitch||y.rotate;class gl extends a.k{}function ka(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Mc{constructor(r,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=m.type==="renderFrame"?void 0:m,M={needsRenderFrame:!1},A={},F={},q=m.touches,Z=q?this._getMapTouches(q):void 0,J=Z?C.touchPos(this._map.getCanvas(),Z):C.mousePos(this._map.getCanvas(),m);for(const{handlerName:_e,handler:se,allowed:Ee}of this._handlers){if(!se.isEnabled())continue;let Ze;this._blockedByActive(F,Ee,_e)?se.reset():se[b||m.type]&&(Ze=se[b||m.type](m,J,Z),this.mergeHandlerResult(M,A,Ze,_e,E),Ze&&Ze.needsRenderFrame&&this._triggerRenderFrame()),(Ze||se.isActive())&&(F[_e]=se)}const pe={};for(const _e in this._previousActiveHandlers)F[_e]||(pe[_e]=E);this._previousActiveHandlers=F,(Object.keys(pe).length||ka(M))&&(this._changes.push([M,A,pe]),this._triggerRenderFrame()),(Object.keys(F).length||ka(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=M;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bh(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,E]of this._listeners)C.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[r,h,p]of this._listeners)C.removeEventListener(r,h,r===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new to(h,r));const m=h.boxZoom=new io(h,r);this._add("boxZoom",m),r.interactive&&r.boxZoom&&m.enable();const b=h.cooperativeGestures=new jt(h,r.cooperativeGestures);this._add("cooperativeGestures",b),r.cooperativeGestures&&b.enable();const E=new Jd(h),M=new Sh(h);h.doubleClickZoom=new Cc(M,E),this._add("tapZoom",E),this._add("clickZoom",M),r.interactive&&r.doubleClickZoom&&h.doubleClickZoom.enable();const A=new Th;this._add("tapDragZoom",A);const F=h.touchPitch=new kh(h);this._add("touchPitch",F),r.interactive&&r.touchPitch&&h.touchPitch.enable(r.touchPitch);const q=js(r),Z=Us(r);h.dragRotate=new no(r,q,Z),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]),r.interactive&&r.dragRotate&&h.dragRotate.enable();const J=(({enable:Ze,clickTolerance:ve})=>{const De=new yo({checkCorrectEvent:We=>C.mouseButton(We)===0&&!We.ctrlKey});return new Ns({clickTolerance:ve,move:(We,He)=>({around:He,panDelta:He.sub(We)}),activateOnStart:!0,moveStateManager:De,enable:Ze,assignEvents:dl})})(r),pe=new vh(r,h);h.dragPan=new Eh(p,J,pe),this._add("mousePan",J),this._add("touchPan",pe,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&h.dragPan.enable(r.dragPan);const fe=new Ec,_e=new xh;h.touchZoomRotate=new xa(p,_e,fe,A),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&h.touchZoomRotate.enable(r.touchZoomRotate);const se=h.scrollZoom=new ml(h,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),r.interactive&&r.scrollZoom&&h.scrollZoom.enable(r.scrollZoom);const Ee=h.keyboard=new $o(h);this._add("keyboard",Ee),r.interactive&&r.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _o(h))}_add(r,h,p){this._handlers.push({handlerName:r,handler:h,allowed:p}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$t(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,h,p){for(const m in r)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(r){const h=[];for(const p of r)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(r,h,p,m,b){if(!p)return;a.e(r,p);const E={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const r={},h={},p={};for(const[m,b,E]of this._changes)m.panDelta&&(r.panDelta=(r.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(r.around=m.around),m.pinchAround!==void 0&&(r.pinchAround=m.pinchAround),m.noInertia&&(r.noInertia=m.noInertia),a.e(h,b),a.e(p,E);this._updateMapTransform(r,h,p),this._changes=[]}_updateMapTransform(r,h,p){const m=this._map,b=m._getTransformForUpdate(),E=m.terrain;if(!(ka(r)||E&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:M,zoomDelta:A,bearingDelta:F,pitchDelta:q,around:Z,pinchAround:J}=r;J!==void 0&&(Z=J),m._stop(!0),Z=Z||m.transform.centerPoint;const pe=b.pointLocation(M?Z.sub(M):Z);F&&(b.bearing+=F),q&&(b.pitch+=q),A&&(b.zoom+=A),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(M)):b.setLocationAtPoint(pe,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(pe,Z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(m.terrain)})):b.setLocationAtPoint(pe,Z),m._applyUpdatedTransform(b),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,p,!0)}_fireEvents(r,h,p){const m=$t(this._eventsInProgress),b=$t(r),E={};for(const q in r){const{originalEvent:Z}=r[q];this._eventsInProgress[q]||(E[`${q}start`]=Z),this._eventsInProgress[q]=r[q]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const q in E)this._fireEvent(q,E[q]);b&&this._fireEvent("move",b.originalEvent);for(const q in r){const{originalEvent:Z}=r[q];this._fireEvent(q,Z)}const M={};let A;for(const q in this._eventsInProgress){const{handlerName:Z,originalEvent:J}=this._eventsInProgress[q];this._handlersById[Z].isActive()||(delete this._eventsInProgress[q],A=h[Z]||J,M[`${q}end`]=A)}for(const q in M)this._fireEvent(q,M[q]);const F=$t(this._eventsInProgress);if(p&&(m||b)&&!F){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!q||!q.essential&&k.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:A})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(q.bearing||this._map.getBearing())&&(q.bearing=0),q.freezeElevation=!0,this._map.easeTo(q,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new a.k(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new gl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xr extends a.E{constructor(r,h){super(),this._renderFrameCallback=()=>{const p=Math.min((k.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}panBy(r,h,p){return r=a.P.convert(r).mult(-1),this.panTo(this.transform.center,a.e({offset:r},h),p)}panTo(r,h,p){return this.easeTo(a.e({center:r},h),p)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,p){return this.easeTo(a.e({zoom:r},h),p)}zoomIn(r,h){return this.zoomTo(this.getZoom()+1,r,h),this}zoomOut(r,h){return this.zoomTo(this.getZoom()-1,r,h),this}getBearing(){return this.transform.bearing}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,p){return this.easeTo(a.e({bearing:r},h),p)}resetNorth(r,h){return this.rotateTo(0,a.e({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}cameraForBounds(r,h){r=je.convert(r);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,h)}_cameraForBoxAndBearing(r,h,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const _t=m.padding;m.padding={top:_t,bottom:_t,right:_t,left:_t}}m.padding=a.e(b,m.padding);const E=this.transform,M=E.padding,A=new je(r,h),F=E.project(A.getNorthWest()),q=E.project(A.getNorthEast()),Z=E.project(A.getSouthEast()),J=E.project(A.getSouthWest()),pe=a.b8(-p),fe=F.rotate(pe),_e=q.rotate(pe),se=Z.rotate(pe),Ee=J.rotate(pe),Ze=new a.P(Math.max(fe.x,_e.x,Ee.x,se.x),Math.max(fe.y,_e.y,Ee.y,se.y)),ve=new a.P(Math.min(fe.x,_e.x,Ee.x,se.x),Math.min(fe.y,_e.y,Ee.y,se.y)),De=Ze.sub(ve),We=(E.width-(M.left+M.right+m.padding.left+m.padding.right))/De.x,He=(E.height-(M.top+M.bottom+m.padding.top+m.padding.bottom))/De.y;if(He<0||We<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xe=Math.min(E.scaleZoom(E.scale*Math.min(We,He)),m.maxZoom),nt=a.P.convert(m.offset),it=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),ft=nt.add(it).mult(E.scale/E.zoomScale(Xe));return{center:E.unproject(F.add(Z).div(2).sub(ft)),zoom:Xe,bearing:p}}fitBounds(r,h,p){return this._fitInternal(this.cameraForBounds(r,h),h,p)}fitScreenCoordinates(r,h,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(r)),this.transform.pointLocation(a.P.convert(h)),p,m),m,b)}_fitInternal(r,h,p){return r?(delete(h=a.e(r,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(r,h){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,E=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(m=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=a.M.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(b=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(E=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),b&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),E&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(r,h,p,m=0){const b=a.Y.fromLngLat(r,h),E=a.Y.fromLngLat(p,m),M=E.x-b.x,A=E.y-b.y,F=E.z-b.z,q=Math.hypot(M,A,F);if(q===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(M,A),J=this.transform.scaleZoom(this.transform.cameraToCenterDistance/q/this.transform.tileSize),pe=180*Math.atan2(M,-A)/Math.PI;let fe=180*Math.acos(Z/q)/Math.PI;return fe=F<0?90-fe:90+fe,{center:E.toLngLat(),zoom:J,pitch:fe,bearing:pe}}easeTo(r,h){var p;this._stop(!1,r.easeId),((r=a.e({offset:[0,0],duration:500,easing:a.b7},r)).animate===!1||!r.essential&&k.prefersReducedMotion)&&(r.duration=0);const m=this._getTransformForUpdate(),b=this.getZoom(),E=this.getBearing(),M=this.getPitch(),A=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,E):E,q="pitch"in r?+r.pitch:M,Z="padding"in r?r.padding:m.padding,J=a.P.convert(r.offset);let pe=m.centerPoint.add(J);const fe=m.pointLocation(pe),{center:_e,zoom:se}=m.getConstrained(a.M.convert(r.center||fe),(p=r.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ee=m.project(fe),Ze=m.project(_e).sub(Ee),ve=m.zoomScale(se-b);let De,We;r.around&&(De=a.M.convert(r.around),We=m.locationPoint(De));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==b,this._rotating=this._rotating||E!==F,this._pitching=this._pitching||q!==M,this._padding=!m.isPaddingEqual(Z),this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,He),this.terrain&&this._prepareElevation(_e),this._ease(Xe=>{if(this._zooming&&(m.zoom=a.z.number(b,se,Xe)),this._rotating&&(m.bearing=a.z.number(E,F,Xe)),this._pitching&&(m.pitch=a.z.number(M,q,Xe)),this._padding&&(m.interpolatePadding(A,Z,Xe),pe=m.centerPoint.add(J)),this.terrain&&!r.freezeElevation&&this._updateElevation(Xe),De)m.setLocationAtPoint(De,We);else{const nt=m.zoomScale(m.zoom-b),it=se>b?Math.min(2,ve):Math.max(.5,ve),ft=Math.pow(it,1-Xe),_t=m.unproject(Ee.add(Ze.mult(Xe*ft)).mult(nt));m.setLocationAtPoint(m.renderWorldCopies?_t.wrap():_t,pe)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Xe)},r),this}_prepareEase(r,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",r)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(p-(h-(p*r+this._elevationStart))/(1-r)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const h=r.clone(),{center:p,zoom:m,pitch:b,bearing:E,elevation:M}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),b!==void 0&&(h.pitch=b),E!==void 0&&(h.bearing=E),M!==void 0&&(h.elevation=M),this.transform.apply(h)}_fireMoveEvents(r){this.fire(new a.k("move",r)),this._zooming&&this.fire(new a.k("zoom",r)),this._rotating&&this.fire(new a.k("rotate",r)),this._pitching&&this.fire(new a.k("pitch",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",r)),m&&this.fire(new a.k("rotateend",r)),b&&this.fire(new a.k("pitchend",r)),this.fire(new a.k("moveend",r))}flyTo(r,h){var p;if(!r.essential&&k.prefersReducedMotion){const Si=a.L(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Si,h)}this.stop(),r=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},r);const m=this._getTransformForUpdate(),b=this.getZoom(),E=this.getBearing(),M=this.getPitch(),A=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,E):E,q="pitch"in r?+r.pitch:M,Z="padding"in r?r.padding:m.padding,J=a.P.convert(r.offset);let pe=m.centerPoint.add(J);const fe=m.pointLocation(pe),{center:_e,zoom:se}=m.getConstrained(a.M.convert(r.center||fe),(p=r.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ee=m.zoomScale(se-b),Ze=m.project(fe),ve=m.project(_e).sub(Ze);let De=r.curve;const We=Math.max(m.width,m.height),He=We/Ee,Xe=ve.mag();if("minZoom"in r){const Si=a.ac(Math.min(r.minZoom,b,se),m.minZoom,m.maxZoom),Qt=We/m.zoomScale(Si-b);De=Math.sqrt(Qt/Xe*2)}const nt=De*De;function it(Si){const Qt=(He*He-We*We+(Si?-1:1)*nt*nt*Xe*Xe)/(2*(Si?He:We)*nt*Xe);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function ft(Si){return(Math.exp(Si)-Math.exp(-Si))/2}function _t(Si){return(Math.exp(Si)+Math.exp(-Si))/2}const oi=it(!1);let yt=function(Si){return _t(oi)/_t(oi+De*Si)},Kt=function(Si){return We*((_t(oi)*(ft(Qt=oi+De*Si)/_t(Qt))-ft(oi))/nt)/Xe;var Qt},si=(it(!0)-oi)/De;if(Math.abs(Xe)<1e-6||!isFinite(si)){if(Math.abs(We-He)<1e-6)return this.easeTo(r,h);const Si=He<We?-1:1;si=Math.abs(Math.log(He/We))/De,Kt=function(){return 0},yt=function(Qt){return Math.exp(Si*De*Qt)}}return r.duration="duration"in r?+r.duration:1e3*si/("screenSpeed"in r?+r.screenSpeed/De:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=E!==F,this._pitching=q!==M,this._padding=!m.isPaddingEqual(Z),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(_e),this._ease(Si=>{const Qt=Si*si,ci=1/yt(Qt);m.zoom=Si===1?se:b+m.scaleZoom(ci),this._rotating&&(m.bearing=a.z.number(E,F,Si)),this._pitching&&(m.pitch=a.z.number(M,q,Si)),this._padding&&(m.interpolatePadding(A,Z,Si),pe=m.centerPoint.add(J)),this.terrain&&!r.freezeElevation&&this._updateElevation(Si);const pi=Si===1?_e:m.unproject(Ze.add(ve.mult(Kt(Qt))).mult(ci));m.setLocationAtPoint(m.renderWorldCopies?pi.wrap():pi,pe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,h,p){p.animate===!1||p.duration===0?(r(1),h()):(this._easeStart=k.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,h){r=a.b1(r,-180,180);const p=Math.abs(r-h);return Math.abs(r-360-h)<p&&(r-=360),Math.abs(r+360-h)<p&&(r+=360),r}_normalizeCenter(r){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=r.lng-h.center.lng;r.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}const Ic={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ro{constructor(r=Ic){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,h){const p=this._map._getUIString(`AttributionControl.${h}`);r.title=p,r.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const b=h[m];if(b.used||b.usedForTerrain){const E=b.getSource();E.attribution&&r.indexOf(E.attribution)<0&&r.push(E.attribution)}}r=r.filter(m=>String(m).trim()),r.sort((m,b)=>m.length-b.length),r=r.filter((m,b)=>{for(let E=b+1;E<r.length;E++)if(r[E].indexOf(m)>=0)return!1;return!0});const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ch{constructor(r={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const h=C.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===r)return void(m.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var dn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class Sn extends a.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,h){this.sourceCache.update(r,h),this._renderableTilesKeys=[];const p={};for(const m of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Xn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(r){for(const h in this._tiles){const p=this._tiles[h];(!r||p.tileID.equals(r)||p.tileID.isChildOf(r)||r.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(r.canonical)){const b=r.clone();b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),h[p]=b}else if(m.canonical.isChildOf(r.canonical)){const b=r.clone();b.posMatrix=new Float64Array(16);const E=m.canonical.z-r.canonical.z,M=m.canonical.x-(m.canonical.x>>E<<E),A=m.canonical.y-(m.canonical.y>>E<<E),F=a.W>>E;a.aN(b.posMatrix,0,F,0,F,0,1),a.H(b.posMatrix,b.posMatrix,[-M*F,-A*F,0]),h[p]=b}else if(r.canonical.isChildOf(m.canonical)){const b=r.clone();b.posMatrix=new Float64Array(16);const E=r.canonical.z-m.canonical.z,M=r.canonical.x-(r.canonical.x>>E<<E),A=r.canonical.y-(r.canonical.y>>E<<E),F=a.W>>E;a.aN(b.posMatrix,0,a.W,0,a.W,0,1),a.H(b.posMatrix,b.posMatrix,[M*F,A*F,0]),a.J(b.posMatrix,b.posMatrix,[1/2**E,1/2**E,0]),h[p]=b}}return h}getSourceTile(r,h){const p=this.sourceCache._source;let m=r.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!b||!b.dem)&&h)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(r.scaledTo(m--).key);return b}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=r)}}class Mh{constructor(r,h,p){this.painter=r,this.sourceCache=new Sn(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,h,p,m=a.W){var b;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const E=this.getTerrainData(r),M=(b=E.tile)===null||b===void 0?void 0:b.dem;if(!M)return 0;const A=function(fe,_e,se){var Ee=_e[0],Ze=_e[1];return fe[0]=se[0]*Ee+se[4]*Ze+se[12],fe[1]=se[1]*Ee+se[5]*Ze+se[13],fe}([],[h/m*a.W,p/m*a.W],E.u_terrain_matrix),F=[A[0]*M.dim,A[1]*M.dim],q=Math.floor(F[0]),Z=Math.floor(F[1]),J=F[0]-q,pe=F[1]-Z;return M.get(q,Z)*(1-J)*(1-pe)+M.get(q+1,Z)*J*(1-pe)+M.get(q,Z+1)*(1-J)*pe+M.get(q+1,Z+1)*J*pe}getElevationForLngLatZoom(r,h){const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(r,h);return this.getElevation(p,m%a.W,b%a.W,a.W)}getElevation(r,h,p,m=a.W){return this.getDEMElevation(r,h,p,m)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const m=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ne(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ne(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(r,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ne(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+r.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=r.canonical.z-h.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=m?b=r.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=r.canonical.x-(r.canonical.x>>b<<b),M=r.canonical.y-(r.canonical.y>>b<<b),A=a.b9(new Float64Array(16),[1/(a.W<<b),1/(a.W<<b),0]);a.H(A,A,[E*a.W,M*a.W,0]),this._demMatrixCache[r.key]={matrix:A,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(r){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,E=0;b<this._coordsTextureSize;b++)for(let M=0;M<this._coordsTextureSize;M++,E+=4)h[E+0]=255&M,h[E+1]=255&b,h[E+2]=M>>8<<4|b>>8,h[E+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new ne(r,p,r.gl.RGBA,{premultiply:!1});return m.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,M-E-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const A=h[0]+(h[2]>>4<<8),F=h[1]+((15&h[2])<<8),q=this.coordsIndex[255-h[3]],Z=q&&this.sourceCache.getTileByID(q);if(!Z)return null;const J=this._coordsTextureSize,pe=(1<<Z.tileID.canonical.z)*J;return new a.Y((Z.tileID.canonical.x*J+A)/pe+Z.tileID.wrap,(Z.tileID.canonical.y*J+F)/pe,this.getElevation(Z.tileID,A,F,J))}depthAtPoint(r){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,b=a.W/m,E=m*m;for(let Z=0;Z<=m;Z++)for(let J=0;J<=m;J++)h.emplaceBack(J*b,Z*b,0);for(let Z=0;Z<E;Z+=m+1)for(let J=0;J<m;J++)p.emplaceBack(J+Z,m+J+Z+1,m+J+Z+2),p.emplaceBack(J+Z,m+J+Z+2,J+Z+1);const M=h.length,A=M+2*(m+1);for(const Z of[0,1])for(let J=0;J<=m;J++)for(const pe of[0,1])h.emplaceBack(J*b,Z*a.W,pe);for(let Z=0;Z<2*m;Z+=2)p.emplaceBack(A+Z,A+Z+1,A+Z+3),p.emplaceBack(A+Z,A+Z+3,A+Z+2),p.emplaceBack(M+Z,M+Z+3,M+Z+1),p.emplaceBack(M+Z,M+Z+2,M+Z+3);const F=h.length,q=F+2*(m+1);for(const Z of[0,1])for(let J=0;J<=m;J++)for(const pe of[0,1])h.emplaceBack(Z*a.W,J*b,pe);for(let Z=0;Z<2*m;Z+=2)p.emplaceBack(F+Z,F+Z+1,F+Z+3),p.emplaceBack(F+Z,F+Z+3,F+Z+2),p.emplaceBack(q+Z,q+Z+3,q+Z+1),p.emplaceBack(q+Z,q+Z+2,q+Z+3);return this._mesh={indexBuffer:r.createIndexBuffer(p),vertexBuffer:r.createVertexBuffer(h,dn.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*a.bb/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(r,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(r){const h=this.getTerrainData(r).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(r,h){const p=a.Y.fromLngLat(r.wrap()),m=(1<<h)*a.W,b=p.x*m,E=p.y*m,M=Math.floor(b/a.W),A=Math.floor(E/a.W);return{tileID:new a.Q(h,0,h,M,A),mercatorX:b,mercatorY:E}}}class Ta{constructor(r,h,p){this._context=r,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ne(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:r,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>r.id!==h),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Ao={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Lc{constructor(r,h){this.painter=r,this.terrain=h,this.pool=new Ta(r.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(p=>!r._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in r.sourceCaches){this._coordsDescendingInv[p]={};const m=r.sourceCaches[p].getVisibleCoordinates();for(const b of m){const E=this.terrain.sourceCache.getTerrainCoords(b);for(const M in E)this._coordsDescendingInv[p][M]||(this._coordsDescendingInv[p][M]=[]),this._coordsDescendingInv[p][M].push(E[M])}}this._coordsDescendingInvStr={};for(const p of r._order){const m=r._layers[p],b=m.source;if(Ao[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const E in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][E]=this._coordsDescendingInv[b][E].map(M=>M.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const h=r.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Ao[h]&&(this._prevType&&Ao[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(r.id),!m))return!0;if(Ao[this._prevType]||Ao[h]&&m){this._prevType=h;const b=this._stacks.length-1,E=this._stacks[b]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(ul(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[b]){const F=this.pool.getObjectForId(M.rtt[b].id);if(F.stamp===M.rtt[b].stamp){this.pool.useObject(F);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),M.rtt[b]={id:A.id,stamp:A.stamp},p.context.bindFramebuffer.set(A.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let F=0;F<E.length;F++){const q=p.style._layers[E[F]],Z=q.source?this._coordsDescendingInv[q.source][M.tileID.key]:[M.tileID];p.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),p._renderTileClippingMasks(q,Z),p.renderLayer(p,p.style.sourceCaches[q.source],q,Z),q.source&&(M.rttCoords[q.source]=this._coordsDescendingInvStr[q.source][M.tileID.key])}}return ul(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ao[h]}return!1}}const Ac={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Pc=_,Ea={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ic,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},_l=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},zc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dc{constructor(r,h,p=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),C.mousePos(this.element,E)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,C.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=r.dragRotate._mouseRotate.getClickTolerance(),b=r.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=js({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:M,bearingDegreesPerPixelMoved:A=.8})=>{const F=new Lt;return new Ns({clickTolerance:M,move:(q,Z)=>({bearingDelta:(Z.x-q.x)*A}),moveStateManager:F,enable:E,assignEvents:_l})})({clickTolerance:m,enable:!0}),this.map=r,p&&(this.mousePitch=Us({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:M,pitchDegreesPerPixelMoved:A=-.5})=>{const F=new Lt;return new Ns({clickTolerance:M,move:(q,Z)=>({pitchDelta:(Z.y-q.y)*A}),moveStateManager:F,enable:E,assignEvents:_l})})({clickTolerance:b,enable:!0})),C.addEventListener(h,"mousedown",this.mousedown),C.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(h,"touchcancel",this.reset)}startMouse(r,h){this.mouseRotate.dragStart(r,h),this.mousePitch&&this.mousePitch.dragStart(r,h),C.disableDrag()}startTouch(r,h){this.touchRotate.dragStart(r,h),this.touchPitch&&this.touchPitch.dragStart(r,h),C.disableDrag()}moveMouse(r,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(r,h)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(r,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(r,h)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const r=this.element;C.removeEventListener(r,"mousedown",this.mousedown),C.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Po;function yl(y,r,h){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),r){const m=new a.M(y.lng-360,y.lat),b=new a.M(y.lng+360,y.lat),E=h.locationPoint(y).distSqr(r);h.locationPoint(m).distSqr(r)<E?y=m:h.locationPoint(b).distSqr(r)<E&&(y=b)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:p}const Ca={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bl(y,r,h){const p=y.classList;for(const m in Ca)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${r}`)}class Ma extends a.E{constructor(r){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?yl(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${Ca[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${b}`),k.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=a.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const h=C.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=C.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const E=C.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const M=C.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ee of A){const Ze=C.createNS("http://www.w3.org/2000/svg","ellipse");Ze.setAttributeNS(null,"opacity","0.04"),Ze.setAttributeNS(null,"cx","10.5"),Ze.setAttributeNS(null,"cy","5.80029008"),Ze.setAttributeNS(null,"rx",Ee.rx),Ze.setAttributeNS(null,"ry",Ee.ry),M.appendChild(Ze)}const F=C.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const q=C.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(q);const Z=C.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const J=C.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(J);const pe=C.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),pe.setAttributeNS(null,"fill","#FFFFFF");const fe=C.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=C.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const se=C.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),fe.appendChild(_e),fe.appendChild(se),E.appendChild(M),E.appendChild(F),E.appendChild(Z),E.appendChild(pe),E.appendChild(fe),h.appendChild(E),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),bl(this._element,this._anchor,"marker"),r&&r.className)for(const h of r.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.M.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const m=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),E=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,E)-b<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/m.transform._pixelPerMeter,A=Math.sin(m.getPitch()*Math.PI/180)*M,F=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),q=m.transform.lngLatToCameraDepth(this._lngLat,E+A)-F>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=a.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,h){return r===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const vl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qs=0,us=!1;const wl={maxWidth:100,unit:"metric"};function xl(y,r,h){const p=h&&h.maxWidth||100,m=y._container.clientHeight/2,b=y.unproject([0,m]),E=y.unproject([p,m]),M=b.distanceTo(E);if(h&&h.unit==="imperial"){const A=3.2808*M;A>5280?hs(r,p,A/5280,y._getUIString("ScaleControl.Miles")):hs(r,p,A,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?hs(r,p,M/1852,y._getUIString("ScaleControl.NauticalMiles")):M>=1e3?hs(r,p,M/1e3,y._getUIString("ScaleControl.Kilometers")):hs(r,p,M,y._getUIString("ScaleControl.Meters"))}function hs(y,r,h,p){const m=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/E;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(A){const F=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*F)/F}(M),E*M}(h);y.style.width=r*(m/h)+"px",y.innerHTML=`${m}&nbsp;${p}`}const Rc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kl(y){if(y){if(typeof y=="number"){const r=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(r,r),"top-right":new a.P(-r,r),bottom:new a.P(0,-y),"bottom-left":new a.P(r,-r),"bottom-right":new a.P(-r,-r),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const r=a.P.convert(y);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return kl(new a.P(0,0))}const Ih=_;d.AJAXError=a.be,d.Evented=a.E,d.LngLat=a.M,d.MercatorCoordinate=a.Y,d.Point=a.P,d.addProtocol=a.bf,d.config=a.a,d.removeProtocol=a.bg,d.AttributionControl=ro,d.BoxZoomHandler=io,d.CanvasSource=wn,d.CooperativeGesturesHandler=jt,d.DoubleClickZoomHandler=Cc,d.DragPanHandler=Eh,d.DragRotateHandler=no,d.EdgeInsets=Fs,d.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var r;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=h==null?void 0:h.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Ve,d.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const h=new a.M(r.coords.longitude,r.coords.latitude),p=r.coords.accuracy,m=this._map.getBearing(),b=a.e({bearing:m},this.options.fitBoundsOptions),E=je.fromLngLat(h,p);this._map.fitBounds(E,b,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const h=new a.M(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&us)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ma({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ma({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},vl,y)}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(r=!1){if(Po!==void 0&&!r)return Po;if(window.navigator.permissions===void 0)return Po=!!window.navigator.geolocation,Po;try{Po=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Po=!!window.navigator.geolocation}return Po})}().then(r=>this._setupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,qs=0,us=!1}_isOutOfMapMaxBounds(y){const r=this._map.getMaxBounds(),h=y.coords;return r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),r=y.getSouthEast(),h=y.getNorthEast(),p=r.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qs--,us=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qs++,qs>1?(y={maximumAge:6e5,timeout:0},us=!0):(y=this.options.positionOptions,us=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=kc,d.ImageSource=kt,d.KeyboardHandler=$o,d.LngLatBounds=je,d.LogoControl=Ch,d.Map=class extends xr{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},Ea,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Sa,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},Ac,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new U(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const h=xc(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{r?h(p):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Mc(this,y),this._hash=y.hash&&new kc(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new ro(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Ch,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new a.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(y,r){if(r===void 0&&(r=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(y);return r>-1&&this._controls.splice(r,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,r,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,r,h,p)}resize(y){var r;const h=this._containerDimensions(),p=h[0],m=h[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const A=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,A),this.painter.resize(p,m,A)}this.transform.resize(p,m),(r=this._requestedCameraState)===null||r===void 0||r.resize(p,m);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),E&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,r){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=y*m,E=r*m;return Math.min(b>h?h/b:1,E>p?p/E:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(je.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,r,h){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:b=>{const E=this.getLayer(r)?this.queryRenderedFeatures(b.point,{layers:[r]}):[];E.length?p||(p=!0,h.call(this,new wr(y,this,b.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:E=>{(this.getLayer(r)?this.queryRenderedFeatures(E.point,{layers:[r]}):[]).length?p=!0:p&&(p=!1,h.call(this,new wr(y,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new wr(y,this,E.originalEvent)))}}}}{const p=m=>{const b=this.getLayer(r)?this.queryRenderedFeatures(m.point,{layers:[r]}):[];b.length&&(m.features=b,h.call(this,m),delete m.features)};return{layer:r,listener:h,delegates:{[y]:p}}}}on(y,r,h){if(h===void 0)return super.on(y,r);const p=this._createDelegatedListener(y,r,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,r,h){if(h===void 0)return super.once(y,r);const p=this._createDelegatedListener(y,r,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,r,h){return h===void 0?super.off(y,r):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let b=0;b<m.length;b++){const E=m[b];if(E.layer===r&&E.listener===h){for(const M in E.delegates)this.off(M,E.delegates[M]);return m.splice(b,1),this}}})(),this)}queryRenderedFeatures(y,r){if(!this.style)return[];let h;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const b=a.P.convert(m[0]),E=a.P.convert(m[1]);h=[b,new a.P(E.x,b.y),E,new a.P(b.x,E.y),b]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(y,r){return this.style.querySourceFeatures(y,r)}setStyle(y,r){return(r=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(y,r))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const r=this._locale[y];if(r==null)throw new Error(`Missing UI string '${y}'`);return r}_updateStyle(y,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,r));const h=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new zr(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,r,h):this.style.loadJSON(y,r,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,r){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,r)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,r)}_updateDiff(y,r){try{this.style.setState(y,r)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,r){return this._lazyInitEmptyStyle(),this.style.addSource(y,r),this._update(!0)}isSourceLoaded(y){const r=this.style&&this.style.sourceCaches[y];if(r!==void 0)return r.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const r=this.style.sourceCaches[y.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&r.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Mh(this.painter,r,y),this.painter.renderToTexture=new Lc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,r;return(r=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const r in y){const h=y[r]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,r,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:E,content:M}=h;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||a.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:F,data:q}=r,Z=r;return this.style.addImage(y,{data:new a.R({width:A,height:F},new Uint8Array(q)),pixelRatio:p,stretchX:b,stretchY:E,content:M,sdf:m,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,y),this}}{const{width:A,height:F,data:q}=k.getImageData(r);this.style.addImage(y,{data:new a.R({width:A,height:F},q),pixelRatio:p,stretchX:b,stretchY:E,content:M,sdf:m,version:0})}}updateImage(y,r){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof HTMLImageElement||a.b(r)?k.getImageData(r):r,{width:m,height:b,data:E}=p;if(m===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||b!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(r instanceof HTMLImageElement||a.b(r));return h.data.replace(E,M),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return V.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,r){return this._lazyInitEmptyStyle(),this.style.addLayer(y,r),this._update(!0)}moveLayer(y,r){return this.style.moveLayer(y,r),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,r,h){return this.style.setLayerZoomRange(y,r,h),this._update(!0)}setFilter(y,r,h={}){return this.style.setFilter(y,r,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,r,h,p={}){return this.style.setPaintProperty(y,r,h,p),this._update(!0)}getPaintProperty(y,r){return this.style.getPaintProperty(y,r)}setLayoutProperty(y,r,h,p={}){return this.style.setLayoutProperty(y,r,h,p),this._update(!0)}getLayoutProperty(y,r){return this.style.getLayoutProperty(y,r)}setGlyphs(y,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,r,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,r,h,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,r,h=>{h||this._update(!0)}),this}setLight(y,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,r){return this.style.setFeatureState(y,r),this._update()}removeFeatureState(y,r){return this.style.removeFeatureState(y,r),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,r=0;return this._container&&(y=this._container.clientWidth||400,r=this._container.clientHeight||300),[y,r]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const r=this._canvasContainer=C.create("div","maplibregl-canvas-container",y);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=C.create("div","maplibregl-control-container",y),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{b[E]=C.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,r,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*r),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{r={requestedAttributes:y},p&&(r.statusMessage=p.statusMessage,r.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const p="Failed to initialize WebGL";throw r?(r.message=p,new Error(JSON.stringify(r))):new Error(p)}this.painter=new mh(h,this.transform),L.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=k.now();this.style.zoomHistory.update(m,b);const E=new a.a8(m,{now:b,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=E.crossFadingFactor();M===1&&M===this._crossFadingFactor||(h=!0,this._crossFadingFactor=M),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Pc}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=wr,d.MapTouchEvent=go,d.MapWheelEvent=Sc,d.Marker=Ma,d.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const r=this._map.getZoom(),h=r===this._map.getMaxZoom(),p=r===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);r.title=p,r.setAttribute("aria-label",p)},this.options=a.e({},zc,y),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,r){const h=C.create("button",y,this._container);return h.type="button",h.addEventListener("click",r),h}},d.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?yl(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!r)return;const p=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=kl(this.options.offset);if(!m){const M=this._container.offsetWidth,A=this._container.offsetHeight;let F;F=p.y+b.bottom.y<A?["top"]:p.y>this._map.transform.height-A?["bottom"]:[],p.x<M/2?F.push("left"):p.x>this._map.transform.width-M/2&&F.push("right"),m=F.length===0?"bottom":F.join("-")}let E=p.add(b[m]);this.options.subpixelPositioning||(E=E.round()),C.setTransform(this._container,`${Ca[m]} translate(${E.x}px,${E.y}px)`),bl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Rc),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const r=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=y;p=h.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Bc);y&&y.focus()}},d.RasterDEMTileSource=di,d.RasterTileSource=we,d.ScaleControl=class{constructor(y){this._onMove=()=>{xl(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,xl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wl),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=ml,d.Style=zr,d.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=kh,d.TwoFingersTouchRotateHandler=Ec,d.TwoFingersTouchZoomHandler=xh,d.TwoFingersTouchZoomRotateHandler=xa,d.VectorTileSource=xt,d.VideoSource=vn,d.addSourceType=(y,r)=>a._(void 0,void 0,void 0,function*(){if(ir(y))throw new Error(`A source type called "${y}" already exists.`);((h,p)=>{Cn[h]=p})(y,r)}),d.clearPrewarmedResources=function(){const y=ei;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Pt),ei=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return ut().getRTLTextPluginStatus()},d.getVersion=function(){return Ih},d.getWorkerCount=function(){return Jt.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(y){return gi().broadcast("IS",y)},d.prewarm=function(){hi().acquire(Pt)},d.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},d.setRTLTextPlugin=function(y,r){return ut().setRTLTextPlugin(y,r)},d.setWorkerCount=function(y){Jt.workerCount=y},d.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var u=t;return u})})(Jy);var Ts=Jy.exports;const Qr=Ky(Ts),pv=Hb({__proto__:null,default:Qr},[Ts]);let Ut;const Qy=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Qy.decode();let du=null;function vu(){return(du===null||du.byteLength===0)&&(du=new Uint8Array(Ut.memory.buffer)),du}function So(o,e){return o=o>>>0,Qy.decode(vu().subarray(o,o+e))}const vs=new Array(128).fill(void 0);vs.push(void 0,null,!0,!1);let wu=vs.length;function Rn(o){wu===vs.length&&vs.push(vs.length+1);const e=wu;return wu=vs[e],vs[e]=o,e}function Ti(o){return vs[o]}function mv(o){o<132||(vs[o]=wu,wu=o)}function ql(o){const e=Ti(o);return mv(o),e}function Vf(o){return o==null}let fu=null;function gv(){return(fu===null||fu.byteLength===0)&&(fu=new Float64Array(Ut.memory.buffer)),fu}let pu=null;function Li(){return(pu===null||pu.byteLength===0)&&(pu=new Int32Array(Ut.memory.buffer)),pu}let Js=0;const rd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},_v=typeof rd.encodeInto=="function"?function(o,e){return rd.encodeInto(o,e)}:function(o,e){const t=rd.encode(o);return e.set(t),{read:o.length,written:t.length}};function Qh(o,e,t){if(t===void 0){const a=rd.encode(o),_=e(a.length,1)>>>0;return vu().subarray(_,_+a.length).set(a),Js=a.length,_}let n=o.length,l=e(n,1)>>>0;const u=vu();let d=0;for(;d<n;d++){const a=o.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==n){d!==0&&(o=o.slice(d)),l=t(l,n,n=d+o.length*3,1)>>>0;const a=vu().subarray(l+d,l+n),_=_v(o,a);d+=_.written}return Js=d,l}function tp(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=tp(o[0]));for(let d=1;d<l;d++)u+=", "+tp(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function yv(o,e){const t=e(o.length*1,1)>>>0;return vu().set(o,t/1),Js=o.length,t}function qf(o,e){try{return o.apply(this,e)}catch(t){Ut.__wbindgen_exn_store(Rn(t))}}class md{static __wrap(e){e=e>>>0;const t=Object.create(md.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ut.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=Ut.__wbindgen_add_to_stack_pointer(-16),d=yv(e,Ut.__wbindgen_malloc),a=Js;Ut.jsroutesnapper_new(u,d,a);var t=Li()[u/4+0],n=Li()[u/4+1],l=Li()[u/4+2];if(l)throw ql(n);return md.__wrap(t)}finally{Ut.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Ut.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Rn(e))}setAreaMode(){Ut.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_getConfig(u,this.__wbg_ptr);var n=Li()[u/4+0],l=Li()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Li()[n/4+0],t=Li()[n/4+1];let l;return e!==0&&(l=So(e,t).slice(),Ut.__wbindgen_free(e,t*1)),l}finally{Ut.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var n=Li()[u/4+0],l=Li()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}toggleSnapMode(){Ut.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return Ut.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){Ut.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Ut.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Ut.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Ut.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_editExisting(l,this.__wbg_ptr,Rn(e));var t=Li()[l/4+0],n=Li()[l/4+1];if(n)throw ql(t)}finally{Ut.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var n=Li()[u/4+0],l=Li()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var n=Li()[u/4+0],l=Li()[u/4+1];return e=n,t=l,So(n,l)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const S=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_routeNameForWaypoints(S,this.__wbg_ptr,Rn(e));var l=Li()[S/4+0],u=Li()[S/4+1],d=Li()[S/4+2],a=Li()[S/4+3],_=l,x=u;if(a)throw _=0,x=0,ql(d);return t=_,n=x,So(_,x)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){Ut.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Ut.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const S=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_calculateRoute(S,this.__wbg_ptr,Rn(e));var l=Li()[S/4+0],u=Li()[S/4+1],d=Li()[S/4+2],a=Li()[S/4+3],_=l,x=u;if(a)throw _=0,x=0,ql(d);return t=_,n=x,So(_,x)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,l;try{const k=Ut.__wbindgen_add_to_stack_pointer(-16);Ut.jsroutesnapper_getExtraNodes(k,this.__wbg_ptr,Rn(e),Rn(t));var u=Li()[k/4+0],d=Li()[k/4+1],a=Li()[k/4+2],_=Li()[k/4+3],x=u,S=d;if(_)throw x=0,S=0,ql(a);return n=x,l=S,So(x,S)}finally{Ut.__wbindgen_add_to_stack_pointer(16),Ut.__wbindgen_free(n,l,1)}}}async function bv(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function vv(){const o={};return o.wbg={},o.wbg.__wbindgen_string_new=function(e,t){const n=So(e,t);return Rn(n)},o.wbg.__wbindgen_object_drop_ref=function(e){ql(e)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(So(e,t));return Rn(n)},o.wbg.__wbindgen_number_get=function(e,t){const n=Ti(t),l=typeof n=="number"?n:void 0;gv()[e/8+1]=Vf(l)?0:l,Li()[e/4+0]=!Vf(l)},o.wbg.__wbindgen_is_object=function(e){const t=Ti(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_is_undefined=function(e){return Ti(e)===void 0},o.wbg.__wbindgen_in=function(e,t){return Ti(e)in Ti(t)},o.wbg.__wbindgen_boolean_get=function(e){const t=Ti(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ti(e)==Ti(t)},o.wbg.__wbindgen_string_get=function(e,t){const n=Ti(t),l=typeof n=="string"?n:void 0;var u=Vf(l)?0:Qh(l,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),d=Js;Li()[e/4+1]=d,Li()[e/4+0]=u},o.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Ti(t)),l=Qh(n,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),u=Js;Li()[e/4+1]=u,Li()[e/4+0]=l},o.wbg.__wbindgen_object_clone_ref=function(e){const t=Ti(e);return Rn(t)},o.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Ti(e)[Ti(t)];return Rn(n)},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Rn(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ti(t).stack,l=Qh(n,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),u=Js;Li()[e/4+1]=u,Li()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(So(e,t))}finally{Ut.__wbindgen_free(n,l,1)}},o.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ti(e))},o.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ti(e))},o.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ti(e))},o.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ti(e))},o.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ti(e))},o.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Ti(e)[t>>>0];return Rn(n)},o.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ti(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof Ti(e)=="function"},o.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ti(e).next;return Rn(t)},o.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return qf(function(e){const t=Ti(e).next();return Rn(t)},arguments)},o.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ti(e).done},o.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ti(e).value;return Rn(t)},o.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Rn(Symbol.iterator)},o.wbg.__wbg_get_97b561fb56f034b5=function(){return qf(function(e,t){const n=Reflect.get(Ti(e),Ti(t));return Rn(n)},arguments)},o.wbg.__wbg_call_cb65541d95d71282=function(){return qf(function(e,t){const n=Ti(e).call(Ti(t));return Rn(n)},arguments)},o.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ti(e))},o.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ti(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ti(e).buffer;return Rn(t)},o.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ti(e));return Rn(t)},o.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Ti(e).set(Ti(t),n>>>0)},o.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ti(e).length},o.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ti(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_debug_string=function(e,t){const n=tp(Ti(t)),l=Qh(n,Ut.__wbindgen_malloc,Ut.__wbindgen_realloc),u=Js;Li()[e/4+1]=u,Li()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(So(e,t))},o.wbg.__wbindgen_memory=function(){const e=Ut.memory;return Rn(e)},o}function wv(o,e){return Ut=o.exports,e0.__wbindgen_wasm_module=e,fu=null,pu=null,du=null,Ut}async function e0(o){if(Ut!==void 0)return Ut;typeof o>"u"&&(o="/ltn/assets/route_snapper_bg.wasm");const e=vv();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await bv(await o,e);return wv(t,n)}var Ir=63710088e-1,Mp={centimeters:Ir*100,centimetres:Ir*100,degrees:Ir/111325,feet:Ir*3.28084,inches:Ir*39.37,kilometers:Ir/1e3,kilometres:Ir/1e3,meters:Ir,metres:Ir,miles:Ir/1609.344,millimeters:Ir*1e3,millimetres:Ir*1e3,nauticalmiles:Ir/1852,radians:1,yards:Ir*1.0936},xv={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ir,yards:1.0936133},ip={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Io(o,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function kv(o,e,t){switch(o){case"Point":return Yr(e).geometry;case"LineString":return Eo(e).geometry;case"Polygon":return Ip(e).geometry;case"MultiPoint":return i0(e).geometry;case"MultiLineString":return t0(e).geometry;case"MultiPolygon":return n0(e).geometry;default:throw new Error(o+" is invalid")}}function Yr(o,e,t){if(t===void 0&&(t={}),!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!gd(o[0])||!gd(o[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:o};return Io(n,e,t)}function Sv(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Yr(n,e)}),t)}function Ip(o,e,t){t===void 0&&(t={});for(var n=0,l=o;n<l.length;n++){var u=l[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:o};return Io(a,e,t)}function Tv(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Ip(n,e)}),t)}function Eo(o,e,t){if(t===void 0&&(t={}),o.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:o};return Io(n,e,t)}function Ev(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Eo(n,e)}),t)}function Ba(o,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function t0(o,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:o};return Io(n,e,t)}function i0(o,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:o};return Io(n,e,t)}function n0(o,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:o};return Io(n,e,t)}function Cv(o,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:o};return Io(n,e,t)}function Mv(o,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(o*t)/t}function Lp(o,e){e===void 0&&(e="kilometers");var t=Mp[e];if(!t)throw new Error(e+" units is invalid");return o*t}function Cd(o,e){e===void 0&&(e="kilometers");var t=Mp[e];if(!t)throw new Error(e+" units is invalid");return o/t}function Iv(o,e){return Eu(Cd(o,e))}function Lv(o){var e=o%360;return e<0&&(e+=360),e}function Eu(o){var e=o%(2*Math.PI);return e*180/Math.PI}function Co(o){var e=o%360;return e*Math.PI/180}function Av(o,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("length must be a positive number");return Lp(Cd(o,e),t)}function Pv(o,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("area must be a positive number");var n=ip[e];if(!n)throw new Error("invalid original units");var l=ip[t];if(!l)throw new Error("invalid final units");return o/n*l}function gd(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Ap(o){return!!o&&o.constructor===Object}function zv(o){if(!o)throw new Error("bbox is required");if(!Array.isArray(o))throw new Error("bbox must be an Array");if(o.length!==4&&o.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");o.forEach(function(e){if(!gd(e))throw new Error("bbox must only contain numbers")})}function Dv(o){if(!o)throw new Error("id is required");if(["string","number"].indexOf(typeof o)===-1)throw new Error("id must be a number or a string")}const Rv=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:ip,bearingToAzimuth:Lv,convertArea:Pv,convertLength:Av,degreesToRadians:Co,earthRadius:Ir,factors:Mp,feature:Io,featureCollection:Ba,geometry:kv,geometryCollection:Cv,isNumber:gd,isObject:Ap,lengthToDegrees:Iv,lengthToRadians:Cd,lineString:Eo,lineStrings:Ev,multiLineString:t0,multiPoint:i0,multiPolygon:n0,point:Yr,points:Sv,polygon:Ip,polygons:Tv,radiansToDegrees:Eu,radiansToLength:Lp,round:Mv,unitsFactors:xv,validateBBox:zv,validateId:Dv},Symbol.toStringTag,{value:"Module"}));function Cu(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return o.geometry.coordinates;if(o.type==="Point")return o.coordinates}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return o;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ql(o){if(Array.isArray(o))return o;if(o.type==="Feature"){if(o.geometry!==null)return o.geometry.coordinates}else if(o.coordinates)return o.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ou(o,e,t){t===void 0&&(t={});var n=Cu(o),l=Cu(e),u=Co(l[1]-n[1]),d=Co(l[0]-n[0]),a=Co(n[1]),_=Co(l[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return Lp(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}function ju(o,e,t){if(o!==null)for(var n,l,u,d,a,_,x,S=0,k=0,C,L=o.type,z=L==="FeatureCollection",R=L==="Feature",D=z?o.features.length:1,B=0;B<D;B++){x=z?o.features[B].geometry:R?o.geometry:o,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,U=0;if(d=C?x.geometries[N]:x,d!==null){_=d.coordinates;var le=d.type;switch(S=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,k,B,V,U)===!1)return!1;k++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],k,B,V,U)===!1)return!1;k++,le==="MultiPoint"&&V++}le==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-S;l++){if(e(_[n][l],k,B,V,U)===!1)return!1;k++}le==="MultiLineString"&&V++,le==="Polygon"&&U++}le==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-S;u++){if(e(_[n][l][u],k,B,V,U)===!1)return!1;k++}U++}V++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(ju(d.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Bv(o,e,t,n){var l=t;return ju(o,function(u,d,a,_,x){d===0&&t===void 0?l=u:l=e(l,u,d,a,_,x)},n),l}function r0(o,e){var t;switch(o.type){case"FeatureCollection":for(t=0;t<o.features.length&&e(o.features[t].properties,t)!==!1;t++);break;case"Feature":e(o.properties,0);break}}function Fv(o,e,t){var n=t;return r0(o,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function _d(o,e){if(o.type==="Feature")e(o,0);else if(o.type==="FeatureCollection")for(var t=0;t<o.features.length&&e(o.features[t],t)!==!1;t++);}function Ov(o,e,t){var n=t;return _d(o,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function Nv(o){var e=[];return ju(o,function(t){e.push(t)}),e}function Pp(o,e){var t,n,l,u,d,a,_,x,S,k,C=0,L=o.type==="FeatureCollection",z=o.type==="Feature",R=L?o.features.length:1;for(t=0;t<R;t++){for(a=L?o.features[t].geometry:z?o.geometry:o,x=L?o.features[t].properties:z?o.properties:{},S=L?o.features[t].bbox:z?o.bbox:void 0,k=L?o.features[t].id:z?o.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,x,S,k)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,x,S,k)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],C,x,S,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function jv(o,e,t){var n=t;return Pp(o,function(l,u,d,a,_){u===0&&t===void 0?n=l:n=e(n,l,u,d,a,_)}),n}function ic(o,e){Pp(o,function(t,n,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Io(t,l,{bbox:u,id:d}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var S=t.coordinates[x],k={type:_,coordinates:S};if(e(Io(k,l),n,x)===!1)return!1}})}function Uv(o,e,t){var n=t;return ic(o,function(l,u,d){u===0&&d===0&&t===void 0?n=l:n=e(n,l,u,d)}),n}function o0(o,e){ic(o,function(t,n,l){var u=0;if(t.geometry){var d=t.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var a,_=0,x=0,S=0;if(ju(t,function(k,C,L,z,R){if(a===void 0||n>_||z>x||R>S){a=k,_=n,x=z,S=R,u=0;return}var D=Eo([a,k],t.properties);if(e(D,n,l,R,u)===!1)return!1;u++,a=k})===!1)return!1}}})}function Vv(o,e,t){var n=t,l=!1;return o0(o,function(u,d,a,_,x){l===!1&&t===void 0?n=u:n=e(n,u,d,a,_,x),l=!0}),n}function s0(o,e){if(!o)throw new Error("geojson is required");ic(o,function(t,n,l){if(t.geometry!==null){var u=t.geometry.type,d=t.geometry.coordinates;switch(u){case"LineString":if(e(t,n,l,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<d.length;a++)if(e(Eo(d[a],t.properties),n,l,a)===!1)return!1;break}}})}function qv(o,e,t){var n=t;return s0(o,function(l,u,d,a){u===0&&t===void 0?n=l:n=e(n,l,u,d,a)}),n}function Zv(o,e){if(e=e||{},!Ap(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.segmentIndex||0,d=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),d=d||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":d=d||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Eo([_[u],_[u+1]],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u-1),Eo([_[l][u],_[l][u+1]],d,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u-1),Eo([_[n][u],_[n][u+1]],d,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u-1),Eo([_[n][l][u],_[n][l][u+1]],d,e)}throw new Error("geojson is invalid")}function Gv(o,e){if(e=e||{},!Ap(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.coordIndex||0,d=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),d=d||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":d=d||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return Yr(_,d,e);case"MultiPoint":return n<0&&(n=_.length+n),Yr(_[n],d,e);case"LineString":return u<0&&(u=_.length+u),Yr(_[u],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u),Yr(_[l][u],d,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u),Yr(_[n][u],d,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u),Yr(_[n][l][u],d,e)}throw new Error("geojson is invalid")}const Wv=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Nv,coordEach:ju,coordReduce:Bv,featureEach:_d,featureReduce:Ov,findPoint:Gv,findSegment:Zv,flattenEach:ic,flattenReduce:Uv,geomEach:Pp,geomReduce:jv,lineEach:s0,lineReduce:qv,propEach:r0,propReduce:Fv,segmentEach:o0,segmentReduce:Vv},Symbol.toStringTag,{value:"Module"}));function a0(o,e,t){if(t===void 0&&(t={}),t.final===!0)return $v(o,e);var n=Cu(o),l=Cu(e),u=Co(n[0]),d=Co(l[0]),a=Co(n[1]),_=Co(l[1]),x=Math.sin(d-u)*Math.cos(_),S=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return Eu(Math.atan2(x,S))}function $v(o,e){var t=a0(e,o);return t=(t+180)%360,t}function Tg(o,e,t,n){n===void 0&&(n={});var l=Cu(o),u=Co(l[0]),d=Co(l[1]),a=Co(t),_=Cd(e,n.units),x=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),S=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(x)),k=Eu(S),C=Eu(x);return Yr([k,C],n.properties)}function Eg(o){if(!o)throw new Error("geojson is required");var e=[];return ic(o,function(t){Hv(t,e)}),Ba(e)}function Hv(o,e){var t=[],n=o.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ql(n);break;case"LineString":t=[Ql(n)]}t.forEach(function(l){var u=Xv(l,o.properties);u.forEach(function(d){d.id=e.length,e.push(d)})})}}function Xv(o,e){var t=[];return o.reduce(function(n,l){var u=Eo([n,l],e);return u.bbox=Kv(n,l),t.push(u),l}),t}function Kv(o,e){var t=o[0],n=o[1],l=e[0],u=e[1],d=t<l?t:l,a=n<u?n:u,_=t>l?t:l,x=n>u?n:u;return[d,a,_,x]}var zp={exports:{}},l0={exports:{}};(function(o,e){(function(t,n){o.exports=n()})(Xy,function(){function t(N,V,U,le,oe){(function H(ee,be,Oe,ne,ye){for(;ne>Oe;){if(ne-Oe>600){var Ke=ne-Oe+1,Ce=be-Oe+1,et=Math.log(Ke),vt=.5*Math.exp(2*et/3),pt=.5*Math.sqrt(et*vt*(Ke-vt)/Ke)*(Ce-Ke/2<0?-1:1),st=Math.max(Oe,Math.floor(be-Ce*vt/Ke+pt)),Ht=Math.min(ne,Math.floor(be+(Ke-Ce)*vt/Ke+pt));H(ee,be,st,Ht,ye)}var ii=ee[be],Ot=Oe,Pt=ne;for(n(ee,Oe,be),ye(ee[ne],ii)>0&&n(ee,Oe,ne);Ot<Pt;){for(n(ee,Ot,Pt),Ot++,Pt--;ye(ee[Ot],ii)<0;)Ot++;for(;ye(ee[Pt],ii)>0;)Pt--}ye(ee[Oe],ii)===0?n(ee,Oe,Pt):n(ee,++Pt,ne),Pt<=be&&(Oe=Pt+1),be<=Pt&&(ne=Pt-1)}})(N,V,U||0,le||N.length-1,oe||l)}function n(N,V,U){var le=N[V];N[V]=N[U],N[U]=le}function l(N,V){return N<V?-1:N>V?1:0}var u=function(N){N===void 0&&(N=9),this._maxEntries=Math.max(4,N),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function d(N,V,U){if(!U)return V.indexOf(N);for(var le=0;le<V.length;le++)if(U(N,V[le]))return le;return-1}function a(N,V){_(N,0,N.children.length,V,N)}function _(N,V,U,le,oe){oe||(oe=D(null)),oe.minX=1/0,oe.minY=1/0,oe.maxX=-1/0,oe.maxY=-1/0;for(var H=V;H<U;H++){var ee=N.children[H];x(oe,N.leaf?le(ee):ee)}return oe}function x(N,V){return N.minX=Math.min(N.minX,V.minX),N.minY=Math.min(N.minY,V.minY),N.maxX=Math.max(N.maxX,V.maxX),N.maxY=Math.max(N.maxY,V.maxY),N}function S(N,V){return N.minX-V.minX}function k(N,V){return N.minY-V.minY}function C(N){return(N.maxX-N.minX)*(N.maxY-N.minY)}function L(N){return N.maxX-N.minX+(N.maxY-N.minY)}function z(N,V){return N.minX<=V.minX&&N.minY<=V.minY&&V.maxX<=N.maxX&&V.maxY<=N.maxY}function R(N,V){return V.minX<=N.maxX&&V.minY<=N.maxY&&V.maxX>=N.minX&&V.maxY>=N.minY}function D(N){return{children:N,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(N,V,U,le,oe){for(var H=[V,U];H.length;)if(!((U=H.pop())-(V=H.pop())<=le)){var ee=V+Math.ceil((U-V)/le/2)*le;t(N,ee,V,U,oe),H.push(V,ee,ee,U)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(N){var V=this.data,U=[];if(!R(N,V))return U;for(var le=this.toBBox,oe=[];V;){for(var H=0;H<V.children.length;H++){var ee=V.children[H],be=V.leaf?le(ee):ee;R(N,be)&&(V.leaf?U.push(ee):z(N,be)?this._all(ee,U):oe.push(ee))}V=oe.pop()}return U},u.prototype.collides=function(N){var V=this.data;if(!R(N,V))return!1;for(var U=[];V;){for(var le=0;le<V.children.length;le++){var oe=V.children[le],H=V.leaf?this.toBBox(oe):oe;if(R(N,H)){if(V.leaf||z(N,H))return!0;U.push(oe)}}V=U.pop()}return!1},u.prototype.load=function(N){if(!N||!N.length)return this;if(N.length<this._minEntries){for(var V=0;V<N.length;V++)this.insert(N[V]);return this}var U=this._build(N.slice(),0,N.length-1,0);if(this.data.children.length)if(this.data.height===U.height)this._splitRoot(this.data,U);else{if(this.data.height<U.height){var le=this.data;this.data=U,U=le}this._insert(U,this.data.height-U.height-1,!0)}else this.data=U;return this},u.prototype.insert=function(N){return N&&this._insert(N,this.data.height-1),this},u.prototype.clear=function(){return this.data=D([]),this},u.prototype.remove=function(N,V){if(!N)return this;for(var U,le,oe,H=this.data,ee=this.toBBox(N),be=[],Oe=[];H||be.length;){if(H||(H=be.pop(),le=be[be.length-1],U=Oe.pop(),oe=!0),H.leaf){var ne=d(N,H.children,V);if(ne!==-1)return H.children.splice(ne,1),be.push(H),this._condense(be),this}oe||H.leaf||!z(H,ee)?le?(U++,H=le.children[U],oe=!1):H=null:(be.push(H),Oe.push(U),U=0,le=H,H=H.children[0])}return this},u.prototype.toBBox=function(N){return N},u.prototype.compareMinX=function(N,V){return N.minX-V.minX},u.prototype.compareMinY=function(N,V){return N.minY-V.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(N){return this.data=N,this},u.prototype._all=function(N,V){for(var U=[];N;)N.leaf?V.push.apply(V,N.children):U.push.apply(U,N.children),N=U.pop();return V},u.prototype._build=function(N,V,U,le){var oe,H=U-V+1,ee=this._maxEntries;if(H<=ee)return a(oe=D(N.slice(V,U+1)),this.toBBox),oe;le||(le=Math.ceil(Math.log(H)/Math.log(ee)),ee=Math.ceil(H/Math.pow(ee,le-1))),(oe=D([])).leaf=!1,oe.height=le;var be=Math.ceil(H/ee),Oe=be*Math.ceil(Math.sqrt(ee));B(N,V,U,Oe,this.compareMinX);for(var ne=V;ne<=U;ne+=Oe){var ye=Math.min(ne+Oe-1,U);B(N,ne,ye,be,this.compareMinY);for(var Ke=ne;Ke<=ye;Ke+=be){var Ce=Math.min(Ke+be-1,ye);oe.children.push(this._build(N,Ke,Ce,le-1))}}return a(oe,this.toBBox),oe},u.prototype._chooseSubtree=function(N,V,U,le){for(;le.push(V),!V.leaf&&le.length-1!==U;){for(var oe=1/0,H=1/0,ee=void 0,be=0;be<V.children.length;be++){var Oe=V.children[be],ne=C(Oe),ye=(Ke=N,Ce=Oe,(Math.max(Ce.maxX,Ke.maxX)-Math.min(Ce.minX,Ke.minX))*(Math.max(Ce.maxY,Ke.maxY)-Math.min(Ce.minY,Ke.minY))-ne);ye<H?(H=ye,oe=ne<oe?ne:oe,ee=Oe):ye===H&&ne<oe&&(oe=ne,ee=Oe)}V=ee||V.children[0]}var Ke,Ce;return V},u.prototype._insert=function(N,V,U){var le=U?N:this.toBBox(N),oe=[],H=this._chooseSubtree(le,this.data,V,oe);for(H.children.push(N),x(H,le);V>=0&&oe[V].children.length>this._maxEntries;)this._split(oe,V),V--;this._adjustParentBBoxes(le,oe,V)},u.prototype._split=function(N,V){var U=N[V],le=U.children.length,oe=this._minEntries;this._chooseSplitAxis(U,oe,le);var H=this._chooseSplitIndex(U,oe,le),ee=D(U.children.splice(H,U.children.length-H));ee.height=U.height,ee.leaf=U.leaf,a(U,this.toBBox),a(ee,this.toBBox),V?N[V-1].children.push(ee):this._splitRoot(U,ee)},u.prototype._splitRoot=function(N,V){this.data=D([N,V]),this.data.height=N.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(N,V,U){for(var le,oe,H,ee,be,Oe,ne,ye=1/0,Ke=1/0,Ce=V;Ce<=U-V;Ce++){var et=_(N,0,Ce,this.toBBox),vt=_(N,Ce,U,this.toBBox),pt=(oe=et,H=vt,ee=void 0,be=void 0,Oe=void 0,ne=void 0,ee=Math.max(oe.minX,H.minX),be=Math.max(oe.minY,H.minY),Oe=Math.min(oe.maxX,H.maxX),ne=Math.min(oe.maxY,H.maxY),Math.max(0,Oe-ee)*Math.max(0,ne-be)),st=C(et)+C(vt);pt<ye?(ye=pt,le=Ce,Ke=st<Ke?st:Ke):pt===ye&&st<Ke&&(Ke=st,le=Ce)}return le||U-V},u.prototype._chooseSplitAxis=function(N,V,U){var le=N.leaf?this.compareMinX:S,oe=N.leaf?this.compareMinY:k;this._allDistMargin(N,V,U,le)<this._allDistMargin(N,V,U,oe)&&N.children.sort(le)},u.prototype._allDistMargin=function(N,V,U,le){N.children.sort(le);for(var oe=this.toBBox,H=_(N,0,V,oe),ee=_(N,U-V,U,oe),be=L(H)+L(ee),Oe=V;Oe<U-V;Oe++){var ne=N.children[Oe];x(H,N.leaf?oe(ne):ne),be+=L(H)}for(var ye=U-V-1;ye>=V;ye--){var Ke=N.children[ye];x(ee,N.leaf?oe(Ke):Ke),be+=L(ee)}return be},u.prototype._adjustParentBBoxes=function(N,V,U){for(var le=U;le>=0;le--)x(V[le],N)},u.prototype._condense=function(N){for(var V=N.length-1,U=void 0;V>=0;V--)N[V].children.length===0?V>0?(U=N[V-1].children).splice(U.indexOf(N[V]),1):this.clear():a(N[V],this.toBBox)},u})})(l0);var Jv=l0.exports;const Yv=Cp(Rv),Qv=Cp(Wv);function c0(o,e,t){if(o!==null)for(var n,l,u,d,a,_,x,S=0,k=0,C,L=o.type,z=L==="FeatureCollection",R=L==="Feature",D=z?o.features.length:1,B=0;B<D;B++){x=z?o.features[B].geometry:R?o.geometry:o,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,U=0;if(d=C?x.geometries[N]:x,d!==null){_=d.coordinates;var le=d.type;switch(S=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,k,B,V,U)===!1)return!1;k++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],k,B,V,U)===!1)return!1;k++,le==="MultiPoint"&&V++}le==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-S;l++){if(e(_[n][l],k,B,V,U)===!1)return!1;k++}le==="MultiLineString"&&V++,le==="Polygon"&&U++}le==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-S;u++){if(e(_[n][l][u],k,B,V,U)===!1)return!1;k++}U++}V++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(c0(d.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function u0(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return c0(o,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var ew=u0;const tw=Object.freeze(Object.defineProperty({__proto__:null,bbox:u0,default:ew},Symbol.toStringTag,{value:"Module"})),iw=Cp(tw);var Qo=Jv,h0=Yv,d0=Qv,Fl=iw.default,nw=d0.featureEach;d0.coordEach;h0.polygon;var Cg=h0.featureCollection;function f0(o){var e=new Qo(o);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Fl(t),Qo.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Fl(l),n.push(l)}):nw(t,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Fl(l),n.push(l)}),Qo.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Fl(t),Qo.prototype.remove.call(this,t,n)},e.clear=function(){return Qo.prototype.clear.call(this)},e.search=function(t){var n=Qo.prototype.search.call(this,this.toBBox(t));return Cg(n)},e.collides=function(t){return Qo.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Qo.prototype.all.call(this);return Cg(t)},e.toJSON=function(){return Qo.prototype.toJSON.call(this)},e.fromJSON=function(t){return Qo.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Fl(t);else if(t.type==="FeatureCollection")n=Fl(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}zp.exports=f0;zp.exports.default=f0;var rw=zp.exports;const ow=Ky(rw);function sw(o,e){var t={},n=[];if(o.type==="LineString"&&(o=Io(o)),e.type==="LineString"&&(e=Io(e)),o.type==="Feature"&&e.type==="Feature"&&o.geometry!==null&&e.geometry!==null&&o.geometry.type==="LineString"&&e.geometry.type==="LineString"&&o.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Mg(o,e);return l&&n.push(l),Ba(n)}var u=ow();return u.load(Eg(e)),_d(Eg(o),function(d){_d(u.search(d),function(a){var _=Mg(d,a);if(_){var x=Ql(_).join(",");t[x]||(t[x]=!0,n.push(_))}})}),Ba(n)}function Mg(o,e){var t=Ql(o),n=Ql(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=t[0][0],u=t[0][1],d=t[1][0],a=t[1][1],_=n[0][0],x=n[0][1],S=n[1][0],k=n[1][1],C=(k-x)*(d-l)-(S-_)*(a-u),L=(S-_)*(u-x)-(k-x)*(l-_),z=(d-l)*(u-x)-(a-u)*(l-_);if(C===0)return null;var R=L/C,D=z/C;if(R>=0&&R<=1&&D>=0&&D<=1){var B=l+R*(d-l),N=u+R*(a-u);return Yr([B,N])}return null}function aw(o,e,t){t===void 0&&(t={});var n=Yr([1/0,1/0],{dist:1/0}),l=0;return ic(o,function(u){for(var d=Ql(u),a=0;a<d.length-1;a++){var _=Yr(d[a]);_.properties.dist=ou(e,_,t);var x=Yr(d[a+1]);x.properties.dist=ou(e,x,t);var S=ou(_,x,t),k=Math.max(_.properties.dist,x.properties.dist),C=a0(_,x),L=Tg(e,k,C+90,t),z=Tg(e,k,C-90,t),R=sw(Eo([L.geometry.coordinates,z.geometry.coordinates]),Eo([_.geometry.coordinates,x.geometry.coordinates])),D=null;R.features.length>0&&(D=R.features[0],D.properties.dist=ou(e,D,t),D.properties.location=l+ou(_,D,t)),_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a,n.properties.location=l),x.properties.dist<n.properties.dist&&(n=x,n.properties.index=a+1,n.properties.location=l+S),D&&D.properties.dist<n.properties.dist&&(n=D,n.properties.index=a),l+=S}}),n}const lw=30;class cw{constructor(e,t,n,l,u){this.onMouseMove=d=>{if(!this.active)return;const a=[d.point.x-lw,d.point.y],_=this.map.unproject(d.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new md(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Ol=[];function Zf(o,e){return{subscribe:wi(o,e).subscribe}}function wi(o,e=Dt){let t;const n=new Set;function l(a){if(Ft(o,a)&&(o=a,t)){const _=!Ol.length;for(const x of n)x[1](),Ol.push(x,o);if(_){for(let x=0;x<Ol.length;x+=2)Ol[x][0](Ol[x+1]);Ol.length=0}}}function u(a){l(a(o))}function d(a,_=Dt){const x=[a,_];return n.add(x),n.size===1&&(t=e(l,u)||Dt),a(o),()=>{n.delete(x),n.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}const np="MZEJTanw3WpxRvt7qDfo";let es=wi(null),Mu=wi(!1),Es=wi(""),yd=wi(!0),Yn=wi(null),Iu=wi(new Ts.LngLat(0,0)),Lu=wi(new Ts.LngLat(0,0)),od=wi(new Ts.LngLat(0,0)),Ig=wi(1),bs=wi(1),ri=wi({mode:"title",firstLoad:!0}),rp=wi("streets-v2"),op=wi("walk_cycle_only"),Lg=wi(!1),Au=wi(!1),bd=wi("shortcuts"),sp=wi(!1);function ec(){let o=Lr(Es);o||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(o,JSON.stringify(Lr(Yn).toSavefile()))}function Ag(o){let e,t;return e=new Td({props:{$$slots:{default:[uw,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:o}}}),e.$on("close",o[2]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&24&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function uw(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z;function R(){return o[1](o[3])}return{c(){e=ce("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=Re(),n=ce("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=Re(),u=ce("p"),u.textContent="To use this tool, you need to:",d=Re(),a=ce("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Re(),x=ce("p"),x.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,S=Re(),k=ce("center"),C=ce("button"),C.textContent="Start!"},m(D,B){he(D,e,B),he(D,t,B),he(D,n,B),he(D,l,B),he(D,u,B),he(D,d,B),he(D,a,B),he(D,_,B),he(D,x,B),he(D,S,B),he(D,k,B),Q(k,C),L||(z=Et(C,"click",R),L=!0)},p(D,B){o=D},d(D){D&&(ue(e),ue(t),ue(n),ue(l),ue(u),ue(d),ue(a),ue(_),ue(x),ue(S),ue(k)),L=!1,z()}}}function hw(o){let e,t,n=o[0]&&Ag(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=Ag(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function dw(o,e,t){let n;return dt(o,yd,d=>t(0,n=d)),[n,d=>Ei(d).close(),()=>At(yd,n=!1,n)]}class fw extends Gt{constructor(e){super(),Zt(this,e,dw,hw,Ft,{})}}let lt;const ws=new Array(128).fill(void 0);ws.push(void 0,null,!0,!1);function fi(o){return ws[o]}let qr=0,mu=null;function $l(){return(mu===null||mu.byteLength===0)&&(mu=new Uint8Array(lt.memory.buffer)),mu}const sd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},pw=typeof sd.encodeInto=="function"?function(o,e){return sd.encodeInto(o,e)}:function(o,e){const t=sd.encode(o);return e.set(t),{read:o.length,written:t.length}};function Fo(o,e,t){if(t===void 0){const a=sd.encode(o),_=e(a.length,1)>>>0;return $l().subarray(_,_+a.length).set(a),qr=a.length,_}let n=o.length,l=e(n,1)>>>0;const u=$l();let d=0;for(;d<n;d++){const a=o.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==n){d!==0&&(o=o.slice(d)),l=t(l,n,n=d+o.length*3,1)>>>0;const a=$l().subarray(l+d,l+n),_=pw(o,a);d+=_.written}return qr=d,l}function Zl(o){return o==null}let gu=null;function qt(){return(gu===null||gu.byteLength===0)&&(gu=new Int32Array(lt.memory.buffer)),gu}let xu=ws.length;function mw(o){o<132||(ws[o]=xu,xu=o)}function _r(o){const e=fi(o);return mw(o),e}const p0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&p0.decode();function Vr(o,e){return o=o>>>0,p0.decode($l().subarray(o,o+e))}function Wi(o){xu===ws.length&&ws.push(ws.length+1);const e=xu;return xu=ws[e],ws[e]=o,e}let _u=null;function m0(){return(_u===null||_u.byteLength===0)&&(_u=new Float64Array(lt.memory.buffer)),_u}let yu=null;function gw(){return(yu===null||yu.byteLength===0)&&(yu=new BigInt64Array(lt.memory.buffer)),yu}function ap(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=ap(o[0]));for(let d=1;d<l;d++)u+=", "+ap(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function _w(o,e){const t=e(o.length*1,1)>>>0;return $l().set(o,t/1),qr=o.length,t}function yw(o,e){return o=o>>>0,m0().subarray(o/8,o/8+e)}function bw(o,e){return o=o>>>0,$l().subarray(o/1,o/1+e)}function za(o,e){try{return o.apply(this,e)}catch(t){lt.__wbindgen_exn_store(Wi(t))}}class vw{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();lt.__wbg_ltn_free(e)}constructor(e,t,n){try{const x=lt.__wbindgen_add_to_stack_pointer(-16),S=_w(e,lt.__wbindgen_malloc),k=qr;var l=Zl(n)?0:Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;lt.ltn_new(x,S,k,Wi(t),l,u);var d=qt()[x/4+0],a=qt()[x/4+1],_=qt()[x/4+2];if(_)throw _r(a);return this.__wbg_ptr=d>>>0,this}finally{lt.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getInvertedBoundary(x,this.__wbg_ptr);var n=qt()[x/4+0],l=qt()[x/4+1],u=qt()[x/4+2],d=qt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}getBounds(){try{const l=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getBounds(l,this.__wbg_ptr);var e=qt()[l/4+0],t=qt()[l/4+1],n=yw(e,t).slice();return lt.__wbindgen_free(e,t*8,8),n}finally{lt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=qt()[l/4+0],t=qt()[l/4+1],n=bw(e,t).slice();return lt.__wbindgen_free(e,t*1,1),n}finally{lt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toRouteSnapperGj(x,this.__wbg_ptr);var n=qt()[x/4+0],l=qt()[x/4+1],u=qt()[x/4+2],d=qt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderModalFilters(x,this.__wbg_ptr);var n=qt()[x/4+0],l=qt()[x/4+1],u=qt()[x/4+2],d=qt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderNeighbourhood(x,this.__wbg_ptr);var n=qt()[x/4+0],l=qt()[x/4+1],u=qt()[x/4+2],d=qt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderAutoBoundaries(x,this.__wbg_ptr);var n=qt()[x/4+0],l=qt()[x/4+1],u=qt()[x/4+2],d=qt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),d=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,d,a,Wi(t));var n=qt()[u/4+0],l=qt()[u/4+1];if(l)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),n=qr;lt.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),l=qr,u=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),d=qr;lt.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,l,u,d)}setCurrentNeighbourhood(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),d=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,d,a,t);var n=qt()[u/4+0],l=qt()[u/4+1];if(l)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),d=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_addModalFilter(u,this.__wbg_ptr,Wi(e),d,a);var n=qt()[u/4+0],l=qt()[u/4+1];if(l)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),d=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_addManyModalFilters(u,this.__wbg_ptr,Wi(e),d,a);var n=qt()[u/4+0],l=qt()[u/4+1];if(l)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){lt.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){lt.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){lt.ltn_undo(this.__wbg_ptr)}redo(){lt.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const S=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getShortcutsCrossingRoad(S,this.__wbg_ptr,e);var l=qt()[S/4+0],u=qt()[S/4+1],d=qt()[S/4+2],a=qt()[S/4+3],_=l,x=u;if(a)throw _=0,x=0,_r(d);return t=_,n=x,Vr(_,x)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getAllShortcuts(x,this.__wbg_ptr);var n=qt()[x/4+0],l=qt()[x/4+1],u=qt()[x/4+2],d=qt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toSavefile(x,this.__wbg_ptr);var n=qt()[x/4+0],l=qt()[x/4+1],u=qt()[x/4+2],d=qt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_loadSavefile(l,this.__wbg_ptr,Wi(e));var t=qt()[l/4+0],n=qt()[l/4+1];if(n)throw _r(t)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,l,u){let d,a;try{const z=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_compareRoute(z,this.__wbg_ptr,e,t,n,l,u);var _=qt()[z/4+0],x=qt()[z/4+1],S=qt()[z/4+2],k=qt()[z/4+3],C=_,L=x;if(k)throw C=0,L=0,_r(S);return d=C,a=L,Vr(C,L)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(d,a,1)}}impactToOneDestination(e,t){let n,l;try{const k=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_impactToOneDestination(k,this.__wbg_ptr,e,t);var u=qt()[k/4+0],d=qt()[k/4+1],a=qt()[k/4+2],_=qt()[k/4+3],x=u,S=d;if(_)throw x=0,S=0,_r(a);return n=x,l=S,Vr(x,S)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(n,l,1)}}}async function ww(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function xw(){const o={};return o.wbg={},o.wbg.__wbindgen_string_get=function(e,t){const n=fi(t),l=typeof n=="string"?n:void 0;var u=Zl(l)?0:Fo(l,lt.__wbindgen_malloc,lt.__wbindgen_realloc),d=qr;qt()[e/4+1]=d,qt()[e/4+0]=u},o.wbg.__wbindgen_object_drop_ref=function(e){_r(e)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Vr(e,t));return Wi(n)},o.wbg.__wbindgen_string_new=function(e,t){const n=Vr(e,t);return Wi(n)},o.wbg.__wbindgen_boolean_get=function(e){const t=fi(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_is_bigint=function(e){return typeof fi(e)=="bigint"},o.wbg.__wbindgen_number_get=function(e,t){const n=fi(t),l=typeof n=="number"?n:void 0;m0()[e/8+1]=Zl(l)?0:l,qt()[e/4+0]=!Zl(l)},o.wbg.__wbindgen_is_object=function(e){const t=fi(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_in=function(e,t){return fi(e)in fi(t)},o.wbg.__wbindgen_bigint_from_i64=function(e){return Wi(e)},o.wbg.__wbindgen_jsval_eq=function(e,t){return fi(e)===fi(t)},o.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Wi(t)},o.wbg.__wbindgen_is_undefined=function(e){return fi(e)===void 0},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return fi(e)==fi(t)},o.wbg.__wbindgen_object_clone_ref=function(e){const t=fi(e);return Wi(t)},o.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=fi(e)[fi(t)];return Wi(n)},o.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(fi(e))},o.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(fi(e))},o.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(fi(e))},o.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(fi(e))},o.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(fi(e))},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Wi(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=fi(t).stack,l=Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;qt()[e/4+1]=u,qt()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(Vr(e,t))}finally{lt.__wbindgen_free(n,l,1)}},o.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=fi(e).performance;return Wi(t)},o.wbg.__wbg_now_2fd65358804c9485=function(e){return fi(e).now()},o.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=fi(e)[t>>>0];return Wi(n)},o.wbg.__wbg_length_1009b1af0c481d7b=function(e){return fi(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof fi(e)=="function"},o.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Vr(e,t));return Wi(n)},o.wbg.__wbg_next_9b877f231f476d01=function(e){const t=fi(e).next;return Wi(t)},o.wbg.__wbg_next_6529ee0cca8d57ed=function(){return za(function(e){const t=fi(e).next();return Wi(t)},arguments)},o.wbg.__wbg_done_5fe336b092d60cf2=function(e){return fi(e).done},o.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=fi(e).value;return Wi(t)},o.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Wi(Symbol.iterator)},o.wbg.__wbg_get_7b48513de5dc5ea4=function(){return za(function(e,t){const n=Reflect.get(fi(e),fi(t));return Wi(n)},arguments)},o.wbg.__wbg_call_90c26b09837aba1c=function(){return za(function(e,t){const n=fi(e).call(fi(t));return Wi(n)},arguments)},o.wbg.__wbg_self_f0e34d89f33b99fd=function(){return za(function(){const e=self.self;return Wi(e)},arguments)},o.wbg.__wbg_window_d3b084224f4774d7=function(){return za(function(){const e=window.window;return Wi(e)},arguments)},o.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return za(function(){const e=globalThis.globalThis;return Wi(e)},arguments)},o.wbg.__wbg_global_35dfdd59a4da3e74=function(){return za(function(){const e=global.global;return Wi(e)},arguments)},o.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(fi(e))},o.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=fi(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(fi(e))},o.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(fi(e));return Wi(t)},o.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=fi(e).buffer;return Wi(t)},o.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(fi(e));return Wi(t)},o.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){fi(e).set(fi(t),n>>>0)},o.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return fi(e).length},o.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=fi(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=fi(t),l=typeof n=="bigint"?n:void 0;gw()[e/8+1]=Zl(l)?BigInt(0):l,qt()[e/4+0]=!Zl(l)},o.wbg.__wbindgen_debug_string=function(e,t){const n=ap(fi(t)),l=Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;qt()[e/4+1]=u,qt()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(Vr(e,t))},o.wbg.__wbindgen_memory=function(){const e=lt.memory;return Wi(e)},o}function kw(o,e){return lt=o.exports,g0.__wbindgen_wasm_module=e,yu=null,_u=null,gu=null,mu=null,lt}async function g0(o){if(lt!==void 0)return lt;typeof o>"u"&&(o="/ltn/assets/backend_bg.wasm");const e=xw();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await ww(await o,e);return kw(t,n)}let Sw=Date.now();function nc(o){return`${o}-${Sw++}`}const Dp=Symbol.for("svelte-maplibre");function rc(){return Ep(Dp)}function Tw(o){let e=new WeakMap;return t=>{var d;let n=e.get(t.originalEvent);if(n!==void 0)return n;let u=(d=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=o.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function Ew(){let o=new Map;return Tp(Dp,{map:wi(null),source:Zf(null),layer:Zf(null),popupTarget:Zf(null),cluster:wi(),loadedImages:wi(new Set),minzoom:wi(0),maxzoom:wi(24),layerEvent:wi(null),layerInfo:o,eventTopMost:Tw(o),markerClickManager:new Lw})}function Pg(o){return{subscribe:o.subscribe}}function Rp({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=rc(),u=wi(null),d=Pg(u),a={...l,[o]:Pg(u)};if(e&&(a.popupTarget=d),n){let _=wi(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=wi()),Tp(Dp,a),{...l,self:u}}function Cw(){return Rp({key:"source",setCluster:!0})}function Mw(o=!0){return Rp({key:"layer",setPopupTarget:o,setMouseEvent:o})}function Iw(){return Rp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Lw{constructor(){Dn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function zg(o){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&o(n,u,l)}else if(e)for(let n in e)o(n,void 0,e[n]);e=t}}function Aw(o,...e){let t=[o];for(let n of e)if(n)Array.isArray(n)&&n[0]===o?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Pw(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function Fa(o,e){return["case",["boolean",["feature-state","hover"],!1],e,o]}var Oa=zw;function zw(o){var e,t,n;if(o){if(Array.isArray(o)){for(e=[],t=o.length,n=0;n<t;n++){var l=o[n];l!=null&&e.push(l)}return e}if(typeof o=="object"){e={};var u=Object.keys(o);for(t=u.length,n=0;n<t;n++){var d=u[n],a=o[d];a!=null&&(e[d]=a)}return e}}}function Dg(o){let e=o[0],t,n,l=Rg(o);return{c(){l.c(),t=Fn()},m(u,d){l.m(u,d),he(u,t,d),n=!0},p(u,d){d[0]&1&&Ft(e,e=u[0])?(_i(),re(l,1,1,Dt),yi(),l=Rg(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(ie(l),n=!0)},o(u){re(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function Rg(o){let e;const t=o[36].default,n=Ni(t,o,o[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Ui(n,t,l,l[35],e?ji(t,l[35],u,null):Vi(l[35]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function Dw(o){let e,t,n=o[0]&&Dg(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&ie(n,1)):(n=Dg(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function Rw(o,e,t){let n,l,u,d,a,_,x,S,k,C,L,z,{$$slots:R={},$$scope:D}=e,{id:B=nc("layer")}=e,{source:N=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:le=void 0}=e,{type:oe}=e,{paint:H=void 0}=e,{layout:ee=void 0}=e,{filter:be=void 0}=e,{applyToClusters:Oe=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Ce=null}=e,{interactive:et=!0}=e,{hoverCursor:vt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const st=ts(),{map:Ht,source:ii,self:Ot,minzoom:Pt,maxzoom:Jt,eventTopMost:Mt,layerInfo:ei}=Mw();dt(o,Ht,Ne=>t(31,k=Ne)),dt(o,ii,Ne=>t(32,C=Ne)),dt(o,Ot,Ne=>t(0,S=Ne)),dt(o,Pt,Ne=>t(34,z=Ne)),dt(o,Jt,Ne=>t(33,L=Ne)),tr(()=>{S&&k&&(ei.delete(S),k==null||k.removeLayer(S))});let Vt;function hi(Ne){var we,di;if(!et||!S||!k||pt&&Mt(Ne)!==S)return;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt={event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je};st(Ne.type,xt)}function xi(Ne){var we,di;if(!et||!S||!k||pt&&Mt(Ne)!==S)return;vt&&(k.getCanvas().style.cursor=vt);let je=Ne.features??[];t(6,Ce=je[0]??null);let rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;st("mouseenter",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function gi(Ne){var we,di,Ve;if(!et||!k)return;if(pt&&Mt(Ne)!==S){t(6,Ce=null),Ke&&Vt!==void 0&&(k==null||k.setFeatureState({source:a,sourceLayer:V,id:Vt},{hover:!1}),Vt=void 0);return}k.getCanvas().style.cursor=vt;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt=(Ve=je[0])==null?void 0:Ve.id;xt!==Vt&&(Ke&&(Vt!==void 0&&(k==null||k.setFeatureState({source:a,id:Vt,sourceLayer:V},{hover:!1})),k==null||k.setFeatureState({source:a,id:xt,sourceLayer:V},{hover:!0})),Vt=xt,t(6,Ce=je[0]??null)),st("mousemove",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function Pi(Ne){if(!(!et||!S||!k)){if(vt&&(k.getCanvas().style.cursor=""),t(6,Ce=null),Ke&&Vt!==void 0){const je={source:a,id:Vt,sourceLayer:V};k==null||k.setFeatureState(je,{hover:!1}),Vt=void 0}st("mouseleave",{map:k,layer:S,source:a})}}let ct=!0;function It(Ne){k&&(k.off("click",Ne,hi),k.off("dblclick",Ne,hi),k.off("contextmenu",Ne,hi),k.off("mouseenter",Ne,xi),k.off("mousemove",Ne,gi),k.off("mouseleave",Ne,Pi))}return tr(()=>{k&&S&&It(S)}),o.$$set=Ne=>{"id"in Ne&&t(7,B=Ne.id),"source"in Ne&&t(8,N=Ne.source),"sourceLayer"in Ne&&t(9,V=Ne.sourceLayer),"beforeId"in Ne&&t(10,U=Ne.beforeId),"beforeLayerType"in Ne&&t(11,le=Ne.beforeLayerType),"type"in Ne&&t(12,oe=Ne.type),"paint"in Ne&&t(13,H=Ne.paint),"layout"in Ne&&t(14,ee=Ne.layout),"filter"in Ne&&t(15,be=Ne.filter),"applyToClusters"in Ne&&t(16,Oe=Ne.applyToClusters),"minzoom"in Ne&&t(17,ne=Ne.minzoom),"maxzoom"in Ne&&t(18,ye=Ne.maxzoom),"manageHoverState"in Ne&&t(19,Ke=Ne.manageHoverState),"hovered"in Ne&&t(6,Ce=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,vt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,pt=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,D=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,n=Pw(Oe)),o.$$.dirty[0]&1073774592&&t(24,l=Aw("all",n,be)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ne??z),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,d=ye??L),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=N||C),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&k&&S!==B&&a){S&&(It(S),ei.delete(S));let Ne=U;if(!U&&le){let je=k.getStyle().layers,rt=typeof le=="function"?le:we=>we.type===le,xt=je==null?void 0:je.find(rt);xt&&(Ne=xt.id)}At(Ot,S=B,S),k.addLayer(Oa({id:S,type:oe,source:a,"source-layer":V,filter:l,paint:H,layout:ee,minzoom:u,maxzoom:d}),Ne),t(23,ct=!0),k.on("click",S,hi),k.on("dblclick",S,hi),k.on("contextmenu",S,hi),k.on("mouseenter",S,xi),k.on("mousemove",S,gi),k.on("mouseleave",S,Pi)}o.$$.dirty[0]&1048577&&S&&ei.set(S,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=S?zg((Ne,je)=>{k!=null&&k.style._loaded?k.setPaintProperty(S,Ne,je):k==null||k.once("styledata",()=>k==null?void 0:k.setPaintProperty(S,Ne,je))}):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,x=S?zg((Ne,je)=>{k!=null&&k.style._loaded?k.setLayoutProperty(S,Ne,je):k==null||k.once("styledata",()=>k==null?void 0:k.setLayoutProperty(S,Ne,je))}):void 0),o.$$.dirty[0]&268443648&&(_==null||_(H)),o.$$.dirty[0]&134234112&&(x==null||x(ee)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&S&&(k==null||k.setLayerZoomRange(S,u,d)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&S&&(ct?t(23,ct=!1):k==null||k.setFilter(S,l))},[S,Ht,ii,Ot,Pt,Jt,Ce,B,N,V,U,le,oe,H,ee,be,Oe,ne,ye,Ke,et,vt,pt,ct,l,d,u,x,_,a,n,k,C,L,z,D,R]}let Md=class extends Gt{constructor(e){super(),Zt(this,e,Rw,Dw,Ft,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Bw(o){let e;const t=o[16].default,n=Ni(t,o,o[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Ui(n,t,l,l[24],e?ji(t,l[24],u,null):Vi(l[24]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function Fw(o){let e,t,n;function l(d){o[17](d)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Bw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Md({props:u}),Ki.push(()=>Wr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function Ow(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:C=void 0}=e,{applyToClusters:L=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:U=!0}=e;function le(ye){N=ye,t(0,N)}function oe(ye){ui.call(this,o,ye)}function H(ye){ui.call(this,o,ye)}function ee(ye){ui.call(this,o,ye)}function be(ye){ui.call(this,o,ye)}function Oe(ye){ui.call(this,o,ye)}function ne(ye){ui.call(this,o,ye)}return o.$$set=ye=>{"id"in ye&&t(1,u=ye.id),"source"in ye&&t(2,d=ye.source),"sourceLayer"in ye&&t(3,a=ye.sourceLayer),"beforeId"in ye&&t(4,_=ye.beforeId),"beforeLayerType"in ye&&t(5,x=ye.beforeLayerType),"paint"in ye&&t(6,S=ye.paint),"layout"in ye&&t(7,k=ye.layout),"filter"in ye&&t(8,C=ye.filter),"applyToClusters"in ye&&t(9,L=ye.applyToClusters),"minzoom"in ye&&t(10,z=ye.minzoom),"maxzoom"in ye&&t(11,R=ye.maxzoom),"hoverCursor"in ye&&t(12,D=ye.hoverCursor),"manageHoverState"in ye&&t(13,B=ye.manageHoverState),"hovered"in ye&&t(0,N=ye.hovered),"eventsIfTopMost"in ye&&t(14,V=ye.eventsIfTopMost),"interactive"in ye&&t(15,U=ye.interactive),"$$scope"in ye&&t(24,l=ye.$$scope)},[N,u,d,a,_,x,S,k,C,L,z,R,D,B,V,U,n,le,oe,H,ee,be,Oe,ne,l]}let Bp=class extends Gt{constructor(e){super(),Zt(this,e,Ow,Fw,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Nw(o){let e;const t=o[15].default,n=Ni(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Ui(n,t,l,l[23],e?ji(t,l[23],u,null):Vi(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function jw(o){let e,t,n;function l(d){o[16](d)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[Nw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Md({props:u}),Ki.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function Uw(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function le(ne){ui.call(this,o,ne)}function oe(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function be(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,S=ne.paint),"layout"in ne&&t(7,k=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,L=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,x,S,k,C,L,z,R,D,N,V,n,U,le,oe,H,ee,be,Oe,l]}let Cs=class extends Gt{constructor(e){super(),Zt(this,e,Uw,jw,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function Vw(o,e,t){let n;const{map:l}=rc();dt(o,l,_=>t(4,n=_));let{position:u="top-left"}=e,{container:d=void 0}=e,a=null;return tr(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),o.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,d=_.container)},o.$$.update=()=>{if(o.$$.dirty&30&&n&&!a){let _;typeof d=="string"?_=document.querySelector(d)??void 0:_=d,t(3,a=new Qr.FullscreenControl({container:_})),n.addControl(a,u)}},[l,u,d,a,n]}class qw extends Gt{constructor(e){super(),Zt(this,e,Vw,null,Ft,{position:1,container:2})}}function Zw(o,e,t,n,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const d=()=>{n(e)&&(o.addSource(e,t),l())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):d())};a()}else d()}function Gw(o,e,t){Wy().then(()=>{let n=Lr(o);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Bg(o){let e=o[0],t,n,l=Fg(o);return{c(){l.c(),t=Fn()},m(u,d){l.m(u,d),he(u,t,d),n=!0},p(u,d){d&1&&Ft(e,e=u[0])?(_i(),re(l,1,1,Dt),yi(),l=Fg(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(ie(l),n=!0)},o(u){re(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function Fg(o){let e;const t=o[19].default,n=Ni(t,o,o[18],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&262144)&&Ui(n,t,l,l[18],e?ji(t,l[18],u,null):Vi(l[18]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function Ww(o){let e,t,n=o[0]&&Bg(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=Bg(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function $w(o,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{id:_=nc("geojson")}=e,{data:x}=e,{generateId:S=!1}=e,{promoteId:k=void 0}=e,{filter:C=void 0}=e,{lineMetrics:L=void 0}=e,{cluster:z=void 0}=e,{maxzoom:R=void 0}=e,{attribution:D=void 0}=e,{buffer:B=void 0}=e,{tolerance:N=void 0}=e;const{map:V,cluster:U,self:le}=Cw();dt(o,V,ee=>t(17,l=ee)),dt(o,U,ee=>t(20,u=ee)),dt(o,le,ee=>t(0,n=ee));let oe,H=!0;return tr(()=>{n&&oe&&l&&(Gw(V,n,oe),At(le,n=null,n),t(15,oe=void 0))}),o.$$set=ee=>{"id"in ee&&t(4,_=ee.id),"data"in ee&&t(5,x=ee.data),"generateId"in ee&&t(6,S=ee.generateId),"promoteId"in ee&&t(7,k=ee.promoteId),"filter"in ee&&t(8,C=ee.filter),"lineMetrics"in ee&&t(9,L=ee.lineMetrics),"cluster"in ee&&t(10,z=ee.cluster),"maxzoom"in ee&&t(11,R=ee.maxzoom),"attribution"in ee&&t(12,D=ee.attribution),"buffer"in ee&&t(13,B=ee.buffer),"tolerance"in ee&&t(14,N=ee.tolerance),"$$scope"in ee&&t(18,a=ee.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&At(U,u=z,u),o.$$.dirty&196593&&l&&n!==_&&(At(le,n=_,n),Zw(l,n,Oa({type:"geojson",data:x,filter:C,lineMetrics:L,generateId:S,promoteId:k,cluster:!!z,clusterMinPoints:z==null?void 0:z.minPoints,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius,clusterProperties:z==null?void 0:z.properties,maxzoom:R,attribution:D,buffer:B,tolerance:N}),ee=>l&&ee===n,()=>{n&&(t(15,oe=l==null?void 0:l.getSource(n)),t(16,H=!0))})),o.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,oe=l==null?void 0:l.getSource(_))})),o.$$.dirty&98336&&oe&&(H?t(16,H=!1):oe.setData(x)),o.$$.dirty&33792&&(oe==null||oe.setClusterOptions(Oa({cluster:!!z,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius})))},[n,V,U,le,_,x,S,k,C,L,z,R,D,B,N,oe,H,l,a,d]}let Bn=class extends Gt{constructor(e){super(),Zt(this,e,$w,Ww,Ft,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function Hw(o,e,t){let n;const{map:l}=rc();dt(o,l,C=>t(8,n=C));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:x=!0}=e,{showUserLocation:S=!0}=e,{control:k=null}=e;return tr(()=>{n!=null&&n.loaded()&&k&&n.removeControl(k)}),o.$$set=C=>{"position"in C&&t(2,u=C.position),"positionOptions"in C&&t(3,d=C.positionOptions),"fitBoundsOptions"in C&&t(4,a=C.fitBoundsOptions),"trackUserLocation"in C&&t(5,_=C.trackUserLocation),"showAccuracyCircle"in C&&t(6,x=C.showAccuracyCircle),"showUserLocation"in C&&t(7,S=C.showUserLocation),"control"in C&&t(1,k=C.control)},o.$$.update=()=>{o.$$.dirty&510&&n&&!k&&(t(1,k=new Qr.GeolocateControl({positionOptions:d,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:x,showUserLocation:S})),n.addControl(k,u))},[l,k,u,d,a,_,x,S,n]}class Xw extends Gt{constructor(e){super(),Zt(this,e,Hw,null,Ft,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function Kw(o){let e;const t=o[15].default,n=Ni(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Ui(n,t,l,l[23],e?ji(t,l[23],u,null):Vi(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function Jw(o){let e,t,n;function l(d){o[16](d)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[Kw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Md({props:u}),Ki.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function Yw(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function le(ne){ui.call(this,o,ne)}function oe(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function be(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,S=ne.paint),"layout"in ne&&t(7,k=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,L=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,x,S,k,C,L,z,R,D,N,V,n,U,le,oe,H,ee,be,Oe,l]}let fo=class extends Gt{constructor(e){super(),Zt(this,e,Yw,Jw,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function Qw(o,e,t){let n;const l=ts();let{layer:u=void 0}=e;const{map:d}=rc();dt(o,d,S=>t(2,n=S));function a(S){l(S.type,{...S,map:d})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],x=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return tr(()=>{if(n)if(u)for(const S of _)n.off(S,u,a);else for(const S of x)n.off(S,a)}),o.$$set=S=>{"layer"in S&&t(1,u=S.layer)},o.$$.update=()=>{if(o.$$.dirty&6&&n)if(u)for(const S of _)n.on(S,u,a);else for(const S of x)n.on(S,a)},[d,u,n]}class _0 extends Gt{constructor(e){super(),Zt(this,e,Qw,null,Ft,{layer:1})}}function ex(o){let e=o.getCenter(),t=Math.round(o.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,n),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,a=`${t}/${u}/${d}`,_=o.getBearing(),x=o.getPitch();return(_||x)&&(a+=`/${Math.round(_*10)/10}`),x&&(a+=`/${Math.round(x)}`),`#${a}`}function tx(o){return o.replace("#","").split("/").map(parseFloat)}var Nl=Fp;function Fp(o,e){return o===e||o!==o&&e!==e?!0:typeof o!=typeof e||{}.toString.call(o)!={}.toString.call(e)||o!==Object(o)||!o?!1:Array.isArray(o)?Og(o,e):{}.toString.call(o)=="[object Set]"?Og(Array.from(o),Array.from(e)):{}.toString.call(o)=="[object Object]"?nx(o,e):ix(o,e)}function ix(o,e){return o.toString()===e.toString()}function Og(o,e){var t=o.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Fp(o[n],e[n]))return!1;return!0}function nx(o,e){var t=Object.keys(o),n=t.length;if(n!=Object.keys(e).length)return!1;for(var l=0;l<n;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Fp(o[u],e[u])))return!1}return!0}function rx(o,e,t){let n;const{map:l}=rc();dt(o,l,S=>t(6,n=S));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,x=null;return tr(()=>{n!=null&&n.loaded()&&x&&n.removeControl(x)}),o.$$set=S=>{"position"in S&&t(1,u=S.position),"showCompass"in S&&t(2,d=S.showCompass),"showZoom"in S&&t(3,a=S.showZoom),"visualizePitch"in S&&t(4,_=S.visualizePitch)},o.$$.update=()=>{o.$$.dirty&126&&n&&!x&&(t(5,x=new Qr.NavigationControl({showCompass:d,showZoom:a,visualizePitch:_})),n.addControl(x,u))},[l,u,d,a,_,x,n]}class y0 extends Gt{constructor(e){super(),Zt(this,e,rx,null,Ft,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function ox(o,e,t){let n;const{map:l}=rc();dt(o,l,x=>t(5,n=x));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:a="metric"}=e,_=null;return tr(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),o.$$set=x=>{"position"in x&&t(1,u=x.position),"maxWidth"in x&&t(2,d=x.maxWidth),"unit"in x&&t(3,a=x.unit)},o.$$.update=()=>{o.$$.dirty&62&&n&&!_&&(t(4,_=new Qr.ScaleControl({maxWidth:d,unit:a})),n.addControl(_,u))},[l,u,d,a,_,n]}class b0 extends Gt{constructor(e){super(),Zt(this,e,ox,null,Ft,{position:1,maxWidth:2,unit:3})}}const{window:sx}=kd,ax=o=>({map:o[0]&16,loadedImages:o[0]&32,allImagesLoaded:o[0]&64}),Ng=o=>({map:o[4],loadedImages:o[5],allImagesLoaded:o[6]});function jg(o){let e,t,n=o[3]&&Ug(o);const l=o[46].default,u=Ni(l,o,o[45],Ng);return{c(){n&&n.c(),e=Re(),u&&u.c()},m(d,a){n&&n.m(d,a),he(d,e,a),u&&u.m(d,a),t=!0},p(d,a){d[3]?n?(n.p(d,a),a[0]&8&&ie(n,1)):(n=Ug(d),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Ui(u,l,d,d[45],t?ji(l,d[45],a,ax):Vi(d[45]),Ng)},i(d){t||(ie(n),ie(u,d),t=!0)},o(d){re(n),re(u,d),t=!1},d(d){d&&ue(e),n&&n.d(d),u&&u.d(d)}}}function Ug(o){let e,t,n,l,u,d,a,_;return e=new y0({props:{position:o[7]}}),n=new Xw({props:{position:o[7],fitBoundsOptions:{maxZoom:12}}}),u=new qw({props:{position:o[7]}}),a=new b0({props:{position:o[7]}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),d=Re(),Pe(a.$$.fragment)},m(x,S){Le(e,x,S),he(x,t,S),Le(n,x,S),he(x,l,S),Le(u,x,S),he(x,d,S),Le(a,x,S),_=!0},p(x,S){const k={};S[0]&128&&(k.position=x[7]),e.$set(k);const C={};S[0]&128&&(C.position=x[7]),n.$set(C);const L={};S[0]&128&&(L.position=x[7]),u.$set(L);const z={};S[0]&128&&(z.position=x[7]),a.$set(z)},i(x){_||(ie(e.$$.fragment,x),ie(n.$$.fragment,x),ie(u.$$.fragment,x),ie(a.$$.fragment,x),_=!0)},o(x){re(e.$$.fragment,x),re(n.$$.fragment,x),re(u.$$.fragment,x),re(a.$$.fragment,x),_=!1},d(x){x&&(ue(t),ue(l),ue(d)),Ae(e,x),Ae(n,x),Ae(u,x),Ae(a,x)}}}function lx(o){let e,t,n,l,u,d=o[4]&&o[0]&&jg(o);return{c(){e=ce("div"),d&&d.c(),Te(e,"class",t=fd(o[2])+" svelte-p00lfq"),Te(e,"data-testid","map-container"),cr(e,"expand-map",!o[2])},m(a,_){he(a,e,_),d&&d.m(e,null),o[47](e),n=!0,l||(u=[Et(sx,"hashchange",o[11]),Yf(o[10].call(null,e))],l=!0)},p(a,_){a[4]&&a[0]?d?(d.p(a,_),_[0]&17&&ie(d,1)):(d=jg(a),d.c(),ie(d,1),d.m(e,null)):d&&(_i(),re(d,1,1,()=>{d=null}),yi()),(!n||_[0]&4&&t!==(t=fd(a[2])+" svelte-p00lfq"))&&Te(e,"class",t),(!n||_[0]&4)&&cr(e,"expand-map",!a[2])},i(a){n||(ie(d),n=!0)},o(a){re(d),n=!1},d(a){a&&ue(e),d&&d.d(),o[47](null),l=!1,ln(u)}}}function cx(o,e,t){let n,l,u,d,{$$slots:a={},$$scope:_}=e,{map:x=null}=e,{mapContainer:S=void 0}=e,{class:k=void 0}=e,{style:C}=e,{diffStyleUpdates:L=!1}=e,{center:z=void 0}=e,{zoom:R=void 0}=e,{pitch:D=0}=e,{bearing:B=0}=e,{bounds:N=void 0}=e,{hash:V=!1}=e,{updateHash:U=Ve=>{window.history.replaceState(window.history.state,"",Ve)}}=e,{loaded:le=!1}=e,{minZoom:oe=0}=e,{maxZoom:H=22}=e,{minPitch:ee=0}=e,{maxPitch:be=60}=e,{renderWorldCopies:Oe=void 0}=e,{dragPan:ne=void 0}=e,{dragRotate:ye=void 0}=e,{pitchWithRotate:Ke=void 0}=e,{antialias:Ce=void 0}=e,{zoomOnDoubleClick:et=!0}=e,{locale:vt=void 0}=e,{interactive:pt=!0}=e,{attributionControl:st=!0}=e,{cooperativeGestures:Ht=!1}=e,{preserveDrawingBuffer:ii=!1}=e,{maxBounds:Ot=void 0}=e,{images:Pt=[]}=e,{standardControls:Jt=!1}=e,{filterLayers:Mt=void 0}=e,{transformRequest:ei=void 0}=e;const Vt=ts(),{map:hi,loadedImages:xi}=Ew();dt(o,hi,Ve=>t(4,u=Ve)),dt(o,xi,Ve=>t(5,d=Ve));let gi=new Set;async function Pi(Ve,$e=!1){if(u&&!(!u.loaded()&&!$e))if("url"in Ve){gi.add(Ve.id);try{let kt=await u.loadImage(Ve.url);u==null||u.addImage(Ve.id,kt.data,Ve.options),d.add(Ve.id),xi.set(d)}catch(kt){Vt("error",kt)}finally{gi.delete(Ve.id)}}else u.addImage(Ve.id,Ve.data,Ve.options),d.add(Ve.id),xi.set(d)}let ct,It,Ne,je;function rt(Ve){return we(),At(hi,u=new Qr.Map(Oa({container:Ve,style:C,locale:vt,center:z,zoom:R,pitch:D,bearing:B,minZoom:oe,maxZoom:H,minPitch:ee,maxPitch:be,renderWorldCopies:Oe,dragPan:ne,dragRotate:ye,pitchWithRotate:Ke,antialias:Ce,interactive:pt,preserveDrawingBuffer:ii,maxBounds:Ot,bounds:N,attributionControl:st,transformRequest:ei,cooperativeGestures:Ht})),u),u.on("load",$e=>{$e.target.getContainer().setAttribute("data-testid","map"),$e.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,le=!0),Vt("load",u)}),u.on("error",$e=>Vt("error",{...$e,map:u})),u.on("movestart",$e=>Vt("movestart",{...$e,map:u})),u.on("moveend",$e=>{if(t(12,z=$e.target.getCenter()),t(13,R=$e.target.getZoom()),t(14,D=$e.target.getPitch()),t(15,B=$e.target.getBearing()),t(16,N=$e.target.getBounds()),Vt("moveend",{...$e,map:u}),V){let kt=new URL(window.location.href.replace(/(#.+)?$/,ex(u)));U(kt)}}),u.on("click",$e=>Vt("click",{...$e,map:u})),u.on("dblclick",$e=>Vt("dblclick",{...$e,map:u})),u.on("contextmenu",$e=>Vt("contextmenu",{...$e,map:u})),u.on("zoomstart",$e=>Vt("zoomstart",{...$e,map:u})),u.on("zoom",$e=>{Vt("zoom",{...$e,map:u})}),u.on("zoomend",$e=>{Vt("zoomend",{...$e,map:u})}),u.on("style.load",()=>{if(u){const $e=u.getStyle();if(t(42,ct=$e.layers.map(kt=>kt.id)),t(43,It=Object.keys($e.sources)),je)for(const[kt,vn]of Object.entries(je))u.addSource(kt,vn);if(Ne)for(const kt of Ne)u.addLayer(kt);for(const kt of Pt)Pi(kt,!0)}}),u.on("styledata",$e=>{if(u&&Mt){const kt=u.getStyle().layers;if(kt)for(let vn of kt)Mt(vn)||u.setLayoutProperty(vn.id,"visibility","none")}Vt("styledata",{...$e,map:u})}),{destroy(){t(0,le=!1),u==null||u.remove(),At(hi,u=null,u)}}}let xt=C;function we(){if(V){let Ve=tx(window.location.hash);Ve.length>=3&&(t(13,R=Ve[0]),t(12,z=[Ve[2],Ve[1]])),Ve.length==5&&(t(15,B=Ve[3]),t(14,D=Ve[4]))}}function di(Ve){Ki[Ve?"unshift":"push"](()=>{S=Ve,t(1,S)})}return o.$$set=Ve=>{"map"in Ve&&t(17,x=Ve.map),"mapContainer"in Ve&&t(1,S=Ve.mapContainer),"class"in Ve&&t(2,k=Ve.class),"style"in Ve&&t(18,C=Ve.style),"diffStyleUpdates"in Ve&&t(19,L=Ve.diffStyleUpdates),"center"in Ve&&t(12,z=Ve.center),"zoom"in Ve&&t(13,R=Ve.zoom),"pitch"in Ve&&t(14,D=Ve.pitch),"bearing"in Ve&&t(15,B=Ve.bearing),"bounds"in Ve&&t(16,N=Ve.bounds),"hash"in Ve&&t(20,V=Ve.hash),"updateHash"in Ve&&t(21,U=Ve.updateHash),"loaded"in Ve&&t(0,le=Ve.loaded),"minZoom"in Ve&&t(22,oe=Ve.minZoom),"maxZoom"in Ve&&t(23,H=Ve.maxZoom),"minPitch"in Ve&&t(24,ee=Ve.minPitch),"maxPitch"in Ve&&t(25,be=Ve.maxPitch),"renderWorldCopies"in Ve&&t(26,Oe=Ve.renderWorldCopies),"dragPan"in Ve&&t(27,ne=Ve.dragPan),"dragRotate"in Ve&&t(28,ye=Ve.dragRotate),"pitchWithRotate"in Ve&&t(29,Ke=Ve.pitchWithRotate),"antialias"in Ve&&t(30,Ce=Ve.antialias),"zoomOnDoubleClick"in Ve&&t(31,et=Ve.zoomOnDoubleClick),"locale"in Ve&&t(32,vt=Ve.locale),"interactive"in Ve&&t(33,pt=Ve.interactive),"attributionControl"in Ve&&t(34,st=Ve.attributionControl),"cooperativeGestures"in Ve&&t(35,Ht=Ve.cooperativeGestures),"preserveDrawingBuffer"in Ve&&t(36,ii=Ve.preserveDrawingBuffer),"maxBounds"in Ve&&t(37,Ot=Ve.maxBounds),"images"in Ve&&t(38,Pt=Ve.images),"standardControls"in Ve&&t(3,Jt=Ve.standardControls),"filterLayers"in Ve&&t(39,Mt=Ve.filterLayers),"transformRequest"in Ve&&t(40,ei=Ve.transformRequest),"$$scope"in Ve&&t(45,_=Ve.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&8&&t(7,n=typeof Jt=="boolean"?void 0:Jt),o.$$.dirty[0]&16&&t(17,x=u),o.$$.dirty[0]&786448|o.$$.dirty[1]&14336&&u&&!Nl(C,xt)){const Ve=u.getStyle();if(ct&&(Ne=Ve.layers.filter($e=>!ct.includes($e.id))),It){const $e=Object.keys(Ve.sources).filter(kt=>!It.includes(kt));je={};for(const kt of $e)je[kt]=Ve.sources[kt]}t(44,xt=C),u.setStyle(C,{diff:L}),At(xi,d=new Set,d),t(41,gi=new Set)}if(o.$$.dirty[0]&49|o.$$.dirty[1]&1152&&le&&u!=null&&u.loaded())for(let Ve of Pt)!d.has(Ve.id)&&!gi.has(Ve.id)&&!u.hasImage(Ve.id)&&Pi(Ve);if(o.$$.dirty[0]&32|o.$$.dirty[1]&128&&t(6,l=Pt.every(Ve=>d.has(Ve.id))),o.$$.dirty[0]&61456&&u){let Ve={};z!=null&&!Nl(z,u==null?void 0:u.getCenter())&&(Ve.center=z),R!=null&&!Nl(R,u==null?void 0:u.getZoom())&&(Ve.zoom=R),B!=null&&!Nl(B,u==null?void 0:u.getBearing())&&(Ve.bearing=B),D!=null&&!Nl(D,u==null?void 0:u.getPitch())&&(Ve.pitch=D),Object.keys(Ve).length&&u.easeTo(Ve)}o.$$.dirty[0]&65552&&N&&!Nl(N,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(N)),o.$$.dirty[0]&16|o.$$.dirty[1]&1&&(et?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[le,S,k,Jt,u,d,l,n,hi,xi,rt,we,z,R,D,B,N,x,C,L,V,U,oe,H,ee,be,Oe,ne,ye,Ke,Ce,et,vt,pt,st,Ht,ii,Ot,Pt,Mt,ei,gi,ct,It,xt,_,a,di]}class ux extends Gt{constructor(e){super(),Zt(this,e,cx,lx,Ft,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const hx=o=>({marker:o&8}),Vg=o=>({marker:o[3]});function dx(o){let e,t,n,l,u,d,a;const _=o[19].default,x=Ni(_,o,o[18],Vg);return{c(){e=ce("div"),x&&x.c(),Te(e,"tabindex",t=o[1]?0:void 0),Te(e,"role",n=o[1]?"button":void 0),pn(e,"z-index",o[2])},m(S,k){he(S,e,k),x&&x.m(e,null),u=!0,d||(a=[Yf(o[7].call(null,e)),Yf(l=fx.call(null,e,o[0])),Et(e,"click",jf(o[20])),Et(e,"dblclick",jf(o[21])),Et(e,"contextmenu",jf(xp(o[22]))),Et(e,"mouseenter",o[23]),Et(e,"mouseleave",o[24]),Et(e,"mousemove",o[25]),Et(e,"keydown",o[8])],d=!0)},p(S,[k]){x&&x.p&&(!u||k&262152)&&Ui(x,_,S,S[18],u?ji(_,S[18],k,hx):Vi(S[18]),Vg),(!u||k&2&&t!==(t=S[1]?0:void 0))&&Te(e,"tabindex",t),(!u||k&2&&n!==(n=S[1]?"button":void 0))&&Te(e,"role",n),l&&Kl(l.update)&&k&1&&l.update.call(null,S[0]),k&4&&pn(e,"z-index",S[2])},i(S){u||(ie(x,S),u=!0)},o(S){re(x,S),u=!1},d(S){S&&ue(e),x&&x.d(S),d=!1,ln(a)}}}function fx(o,e){const t=o.className;function n(l){l?o.className=`${t} ${l}`:o.className=t}return n(e),{update:n}}function px(o,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:x}=e,{class:S=void 0}=e,{interactive:k=!0}=e,{asButton:C=!1}=e,{draggable:L=!1}=e,{feature:z=null}=e,{offset:R=void 0}=e,{zIndex:D=void 0}=e,{rotation:B=0}=e,{opacity:N=1}=e;const V=ts(),{map:U,layerEvent:le,self:oe,markerClickManager:H}=Iw();dt(o,U,st=>t(27,u=st)),dt(o,le,st=>t(26,n=st)),dt(o,oe,st=>t(3,l=st));function ee(st){At(oe,l=new Qr.Marker({element:st,rotation:B,draggable:L,offset:R,opacity:N.toString()}).setLngLat(x).addTo(u),l),t(11,_=l);const Ht=()=>ne("dragstart"),ii=()=>{be(),ne("drag")},Ot=()=>{be(),ne("dragend")};return L&&(l.on("dragstart",Ht),l.on("drag",ii),l.on("dragend",Ot)),{destroy(){L&&(l==null||l.off("dragstart",Ht),l==null||l.off("drag",ii),l==null||l.off("dragend",Ot)),t(11,_=void 0),l==null||l.remove()}}}function be(){let st=l==null?void 0:l.getLngLat();st&&(Array.isArray(x)?t(10,x=[st.lng,st.lat]):x&&"lon"in x?t(10,x={lon:st.lng,lat:st.lat}):t(10,x=st))}function Oe(st){st.key===" "&&(st.preventDefault(),st.stopPropagation(),ne("click"))}function ne(st){if(!k)return;let Ht=l==null?void 0:l.getLngLat();if(!Ht)return;const ii=[Ht.lng,Ht.lat];let Ot={map:u,marker:l,lngLat:ii,features:[{type:"Feature",properties:(z==null?void 0:z.properties)??{},geometry:{type:"Point",coordinates:ii}}]};(st==="click"||st==="contextmenu")&&H.handleClick(Ot),At(le,n={...Ot,layerType:"marker",type:st},n),V(st,Ot)}const ye=()=>ne("click"),Ke=()=>ne("dblclick"),Ce=()=>{ne("contextmenu")},et=()=>{ne("mouseenter")},vt=()=>{ne("mouseleave")},pt=()=>ne("mousemove");return o.$$set=st=>{"marker"in st&&t(11,_=st.marker),"lngLat"in st&&t(10,x=st.lngLat),"class"in st&&t(0,S=st.class),"interactive"in st&&t(12,k=st.interactive),"asButton"in st&&t(1,C=st.asButton),"draggable"in st&&t(13,L=st.draggable),"feature"in st&&t(14,z=st.feature),"offset"in st&&t(15,R=st.offset),"zIndex"in st&&t(2,D=st.zIndex),"rotation"in st&&t(16,B=st.rotation),"opacity"in st&&t(17,N=st.opacity),"$$scope"in st&&t(18,a=st.$$scope)},o.$$.update=()=>{o.$$.dirty&1032&&(l==null||l.setLngLat(x)),o.$$.dirty&32776&&(l==null||l.setOffset(R??[0,0])),o.$$.dirty&65544&&(l==null||l.setRotation(B)),o.$$.dirty&131080&&(l==null||l.setOpacity(N.toString()))},[S,C,D,l,U,le,oe,ee,Oe,ne,x,_,k,L,z,R,B,N,a,d,ye,Ke,Ce,et,vt,pt]}class Id extends Gt{constructor(e){super(),Zt(this,e,px,dx,Ft,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}var Uu=Uint8Array,v0=Uint16Array,mx=Int32Array,gx=new Uu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_x=new Uu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),w0=function(o,e){for(var t=new v0(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var l=new mx(t[30]),n=1;n<30;++n)for(var u=t[n];u<t[n+1];++u)l[u]=u-t[n]<<5|n;return{b:t,r:l}},x0=w0(gx,2),yx=x0.b,bx=x0.r;yx[28]=258,bx[258]=28;w0(_x,0);var vx=new v0(32768);for(Oi=0;Oi<32768;++Oi)ys=(Oi&43690)>>1|(Oi&21845)<<1,ys=(ys&52428)>>2|(ys&13107)<<2,ys=(ys&61680)>>4|(ys&3855)<<4,vx[Oi]=((ys&65280)>>8|(ys&255)<<8)>>1;var ys,Oi,Ld=new Uu(288);for(Oi=0;Oi<144;++Oi)Ld[Oi]=8;var Oi;for(Oi=144;Oi<256;++Oi)Ld[Oi]=9;var Oi;for(Oi=256;Oi<280;++Oi)Ld[Oi]=7;var Oi;for(Oi=280;Oi<288;++Oi)Ld[Oi]=8;var Oi,wx=new Uu(32);for(Oi=0;Oi<32;++Oi)wx[Oi]=5;var Oi,xx=new Uu(0),kx=typeof TextDecoder<"u"&&new TextDecoder,Sx=0;try{kx.decode(xx,{stream:!0}),Sx=1}catch{}function Tx(o){let e;const t=o[16].default,n=Ni(t,o,o[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Ui(n,t,l,l[24],e?ji(t,l[24],u,null):Vi(l[24]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function Ex(o){let e,t,n;function l(d){o[17](d)}let u={id:o[1],type:"symbol",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Tx]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Md({props:u}),Ki.push(()=>Wr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function Cx(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=nc("symbol")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S=void 0}=e,{layout:k=void 0}=e,{filter:C=void 0}=e,{applyToClusters:L=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:U=!0}=e;function le(ye){N=ye,t(0,N)}function oe(ye){ui.call(this,o,ye)}function H(ye){ui.call(this,o,ye)}function ee(ye){ui.call(this,o,ye)}function be(ye){ui.call(this,o,ye)}function Oe(ye){ui.call(this,o,ye)}function ne(ye){ui.call(this,o,ye)}return o.$$set=ye=>{"id"in ye&&t(1,u=ye.id),"source"in ye&&t(2,d=ye.source),"sourceLayer"in ye&&t(3,a=ye.sourceLayer),"beforeId"in ye&&t(4,_=ye.beforeId),"beforeLayerType"in ye&&t(5,x=ye.beforeLayerType),"paint"in ye&&t(6,S=ye.paint),"layout"in ye&&t(7,k=ye.layout),"filter"in ye&&t(8,C=ye.filter),"applyToClusters"in ye&&t(9,L=ye.applyToClusters),"minzoom"in ye&&t(10,z=ye.minzoom),"maxzoom"in ye&&t(11,R=ye.maxzoom),"hoverCursor"in ye&&t(12,D=ye.hoverCursor),"manageHoverState"in ye&&t(13,B=ye.manageHoverState),"hovered"in ye&&t(0,N=ye.hovered),"eventsIfTopMost"in ye&&t(14,V=ye.eventsIfTopMost),"interactive"in ye&&t(15,U=ye.interactive),"$$scope"in ye&&t(24,l=ye.$$scope)},[N,u,d,a,_,x,S,k,C,L,z,R,D,B,V,U,n,le,oe,H,ee,be,Oe,ne,l]}class k0 extends Gt{constructor(e){super(),Zt(this,e,Cx,Ex,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Mx=Object.defineProperty,S0=o=>{throw TypeError(o)},Ix=(o,e,t)=>e in o?Mx(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,uo=(o,e,t)=>Ix(o,typeof e!="symbol"?e+"":e,t),T0=(o,e,t)=>e.has(o)||S0("Cannot "+t),er=(o,e,t)=>(T0(o,e,"read from private field"),t?t.call(o):e.get(o)),qg=(o,e,t)=>e.has(o)?S0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t),Zg=(o,e,t,n)=>(T0(o,e,"write to private field"),n?n.call(o,t):e.set(o,t),t);function mn(){}function Lx(o,e){for(const t in e)o[t]=e[t];return o}function E0(o){return o()}function Gg(){return Object.create(null)}function Ls(o){o.forEach(E0)}function C0(o){return typeof o=="function"}function na(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let ed;function Ar(o,e){return o===e?!0:(ed||(ed=document.createElement("a")),ed.href=e,o===ed.href)}function Ax(o){return Object.keys(o).length===0}function Px(o,e,t,n){if(o){const l=M0(o,e,t,n);return o[0](l)}}function M0(o,e,t,n){return o[1]&&n?Lx(t.ctx.slice(),o[1](n(e))):t.ctx}function zx(o,e,t,n){if(o[2]&&n){const l=o[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Dx(o,e,t,n,l,u){if(l){const d=M0(e,t,n,u);o.p(d,l)}}function Rx(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function Wg(o){return o??""}function Ai(o,e){o.appendChild(e)}function bn(o,e,t){o.insertBefore(e,t||null)}function _n(o){o.parentNode&&o.parentNode.removeChild(o)}function Xi(o){return document.createElement(o)}function jo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ea(o){return document.createTextNode(o)}function ho(){return ea(" ")}function Bx(){return ea("")}function Zr(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function Fx(o){return function(e){return e.preventDefault(),o.call(this,e)}}function ot(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Ox(o){return Array.from(o.childNodes)}function Pu(o,e){e=""+e,o.data!==e&&(o.data=e)}function $g(o,e){o.value=e??""}function Mo(o,e,t){o.classList.toggle(e,!!t)}function Nx(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let zu;function ku(o){zu=o}function I0(){if(!zu)throw new Error("Function called outside component initialization");return zu}function jx(o){I0().$$.on_destroy.push(o)}function Ux(){const o=I0();return(e,t,{cancelable:n=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=Nx(e,t,{cancelable:n});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function Hg(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Gl=[],lp=[];let Hl=[];const Xg=[],Vx=Promise.resolve();let cp=!1;function qx(){cp||(cp=!0,Vx.then(L0))}function up(o){Hl.push(o)}const Gf=new Set;let jl=0;function L0(){if(jl!==0)return;const o=zu;do{try{for(;jl<Gl.length;){const e=Gl[jl];jl++,ku(e),Zx(e.$$)}}catch(e){throw Gl.length=0,jl=0,e}for(ku(null),Gl.length=0,jl=0;lp.length;)lp.pop()();for(let e=0;e<Hl.length;e+=1){const t=Hl[e];Gf.has(t)||(Gf.add(t),t())}Hl.length=0}while(Gl.length);for(;Xg.length;)Xg.pop()();cp=!1,Gf.clear(),ku(o)}function Zx(o){if(o.fragment!==null){o.update(),Ls(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(up)}}function Gx(o){const e=[],t=[];Hl.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Hl=e}const ad=new Set;let Ra;function ld(){Ra={r:0,c:[],p:Ra}}function cd(){Ra.r||Ls(Ra.c),Ra=Ra.p}function $n(o,e){o&&o.i&&(ad.delete(o),o.i(e))}function lr(o,e,t,n){if(o&&o.o){if(ad.has(o))return;ad.add(o),Ra.c.push(()=>{ad.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function Kg(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Wx(o,e){lr(o,1,1,()=>{e.delete(o.key)})}function $x(o,e,t,n,l,u,d,a,_,x,S,k){let C=o.length,L=u.length,z=C;const R={};for(;z--;)R[o[z].key]=z;const D=[],B=new Map,N=new Map,V=[];for(z=L;z--;){const H=k(l,u,z),ee=t(H);let be=d.get(ee);be?V.push(()=>be.p(H,e)):(be=x(ee,H),be.c()),B.set(ee,D[z]=be),ee in R&&N.set(ee,Math.abs(z-R[ee]))}const U=new Set,le=new Set;function oe(H){$n(H,1),H.m(a,S),d.set(H.key,H),S=H.first,L--}for(;C&&L;){const H=D[L-1],ee=o[C-1],be=H.key,Oe=ee.key;H===ee?(S=H.first,C--,L--):B.has(Oe)?!d.has(be)||U.has(be)?oe(H):le.has(Oe)?C--:N.get(be)>N.get(Oe)?(le.add(be),oe(H)):(U.add(Oe),C--):(_(ee,d),C--)}for(;C--;){const H=o[C];B.has(H.key)||_(H,d)}for(;L;)oe(D[L-1]);return Ls(V),D}function ta(o){o&&o.c()}function Ms(o,e,t){const{fragment:n,after_update:l}=o.$$;n&&n.m(e,t),up(()=>{const u=o.$$.on_mount.map(E0).filter(C0);o.$$.on_destroy?o.$$.on_destroy.push(...u):Ls(u),o.$$.on_mount=[]}),l.forEach(up)}function Is(o,e){const t=o.$$;t.fragment!==null&&(Gx(t.after_update),Ls(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Hx(o,e){o.$$.dirty[0]===-1&&(Gl.push(o),qx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function ra(o,e,t,n,l,u,d=null,a=[-1]){const _=zu;ku(o);const x=o.$$={fragment:null,ctx:[],props:u,update:mn,not_equal:l,bound:Gg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Gg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(x.root);let S=!1;if(x.ctx=t?t(o,e.props||{},(k,C,...L)=>{const z=L.length?L[0]:C;return x.ctx&&l(x.ctx[k],x.ctx[k]=z)&&(!x.skip_bound&&x.bound[k]&&x.bound[k](z),S&&Hx(o,k)),C}):[],x.update(),S=!0,Ls(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const k=Ox(e.target);x.fragment&&x.fragment.l(k),k.forEach(_n)}else x.fragment&&x.fragment.c();e.intro&&$n(o.$$.fragment),Ms(o,e.target,e.anchor),L0()}ku(_)}class oa{constructor(){uo(this,"$$"),uo(this,"$$set")}$destroy(){Is(this,1),this.$destroy=mn}$on(e,t){if(!C0(t))return mn;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!Ax(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Xx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Xx);function Kx(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ot(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ot(e,"viewBox","0 0 14 14"),ot(e,"width","13"),ot(e,"height","13"),ot(e,"class","svelte-en2qvf")},m(n,l){bn(n,e,l),Ai(e,t)},p:mn,i:mn,o:mn,d(n){n&&_n(e)}}}class A0 extends oa{constructor(e){super(),ra(this,e,null,Kx,na,{})}}function Jx(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ot(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ot(e,"viewBox","0 0 30 30"),ot(e,"fill","none"),ot(e,"xmlns","http://www.w3.org/2000/svg"),ot(e,"class","svelte-d2loi5")},m(n,l){bn(n,e,l),Ai(e,t)},p:mn,i:mn,o:mn,d(n){n&&_n(e)}}}class P0 extends oa{constructor(e){super(),ra(this,e,null,Jx,na,{})}}function Yx(o){let e,t;return{c(){e=Xi("img"),Ar(e.src,t=o[3]+"area.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){bn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"area.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function Qx(o){let e,t;return{c(){e=Xi("img"),Ar(e.src,t=o[3]+"reverse.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){bn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"reverse.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function e2(o){let e,t;return{c(){e=Xi("img"),Ar(e.src,t=o[3]+"poi.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){bn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"poi.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function t2(o){let e,t;return{c(){e=Xi("img"),Ar(e.src,t=o[3]+"postal_code.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){bn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"postal_code.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function i2(o){let e,t;return{c(){e=Xi("img"),Ar(e.src,t=o[3]+"street.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){bn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"street.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function n2(o){let e,t;return{c(){e=Xi("img"),Ar(e.src,t=o[3]+"road.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){bn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"road.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function r2(o){let e,t;return{c(){e=Xi("img"),Ar(e.src,t=o[3]+"housenumber.svg")||ot(e,"src",t),ot(e,"alt",o[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){bn(n,e,l)},p(n,l){l&8&&!Ar(e.src,t=n[3]+"housenumber.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function o2(o){let e,t,n,l;return{c(){e=Xi("img"),Ar(e.src,t=o[5])||ot(e,"src",t),ot(e,"alt",o[4]),ot(e,"class","svelte-ltkwvy")},m(u,d){bn(u,e,d),n||(l=Zr(e,"error",o[14]),n=!0)},p(u,d){d&32&&!Ar(e.src,t=u[5])&&ot(e,"src",t),d&16&&ot(e,"alt",u[4])},d(u){u&&_n(e),n=!1,l()}}}function Jg(o){let e,t;return{c(){e=Xi("span"),t=ea(o[6]),ot(e,"class","secondary svelte-ltkwvy")},m(n,l){bn(n,e,l),Ai(e,t)},p(n,l){l&64&&Pu(t,n[6])},d(n){n&&_n(e)}}}function s2(o){let e,t,n,l,u,d,a,_,x,S=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",k,C,L=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],z,R,D=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,V;function U(ee,be){return be&1&&(t=null),be&1&&(n=null),be&1&&(l=null),be&1&&(u=null),ee[5]?o2:ee[0].address?r2:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?n2:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?i2:(l==null&&(l=!!ee[0].id.startsWith("postal_code.")),l?t2:(u==null&&(u=!!ee[0].id.startsWith("poi.")),u?e2:ee[7]?Qx:Yx))))}let le=U(o,-1),oe=le(o),H=L&&Jg(o);return{c(){e=Xi("li"),oe.c(),d=ho(),a=Xi("span"),_=Xi("span"),x=Xi("span"),k=ea(S),C=ho(),H&&H.c(),z=ho(),R=Xi("span"),B=ea(D),ot(x,"class","primary svelte-ltkwvy"),ot(_,"class","svelte-ltkwvy"),ot(R,"class","line2 svelte-ltkwvy"),ot(a,"class","texts svelte-ltkwvy"),ot(e,"tabindex","0"),ot(e,"data-selected",o[1]),ot(e,"class","svelte-ltkwvy"),Mo(e,"selected",o[1])},m(ee,be){bn(ee,e,be),oe.m(e,null),Ai(e,d),Ai(e,a),Ai(a,_),Ai(_,x),Ai(x,k),Ai(_,C),H&&H.m(_,null),Ai(a,z),Ai(a,R),Ai(R,B),N||(V=[Zr(e,"mouseenter",o[12]),Zr(e,"focus",o[13])],N=!0)},p(ee,[be]){le===(le=U(ee,be))&&oe?oe.p(ee,be):(oe.d(1),oe=le(ee),oe&&(oe.c(),oe.m(e,d))),be&1&&S!==(S=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&Pu(k,S),be&37&&(L=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),L?H?H.p(ee,be):(H=Jg(ee),H.c(),H.m(_,null)):H&&(H.d(1),H=null),be&1&&D!==(D=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Pu(B,D),be&2&&ot(e,"data-selected",ee[1]),be&2&&Mo(e,"selected",ee[1])},i:mn,o:mn,d(ee){ee&&_n(e),oe.d(),H&&H.d(),N=!1,Ls(V)}}}function a2(o,e,t){var n;let l,u,{feature:d}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:x}=e,{iconsBaseUrl:S}=e;const k=(n=d.properties)==null?void 0:n.categories;let C,L,z=0,R=d.place_type[0]==="reverse";function D(){L&&x.add(L),t(10,z++,z)}function B(U){Hg.call(this,o,U)}function N(U){Hg.call(this,o,U)}const V=()=>D();return o.$$set=U=>{"feature"in U&&t(0,d=U.feature),"selected"in U&&t(1,a=U.selected),"showPlaceType"in U&&t(2,_=U.showPlaceType),"missingIconsCache"in U&&t(9,x=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,S=U.iconsBaseUrl)},o.$$.update=()=>{var U,le,oe,H;if(o.$$.dirty&3640)do t(11,l--,l),t(4,C=k==null?void 0:k[l]),t(5,L=C?S+C.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!L||x.has(L)));o.$$.dirty&1&&t(6,u=((le=(U=d.properties)==null?void 0:U.categories)==null?void 0:le.join(", "))??((H=(oe=d.properties)==null?void 0:oe.place_type_name)==null?void 0:H[0])??d.place_type[0])},t(11,l=(k==null?void 0:k.length)??0),[d,a,_,S,C,L,u,R,D,x,z,l,B,N,V]}class l2 extends oa{constructor(e){super(),ra(this,e,a2,s2,na,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function c2(o){let e;return{c(){e=Xi("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ot(e,"class","svelte-7cmwmc")},m(t,n){bn(t,e,n)},p:mn,i:mn,o:mn,d(t){t&&_n(e)}}}class u2 extends oa{constructor(e){super(),ra(this,e,null,c2,na,{})}}function h2(o){let e,t,n;return{c(){e=jo("svg"),t=jo("path"),ot(t,"stroke-width","4"),ot(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ot(t,"class","svelte-gzo3ar"),ot(e,"width",n=o[0]==="list"?20:void 0),ot(e,"viewBox","0 0 70 85"),ot(e,"fill","none"),ot(e,"class","svelte-gzo3ar"),Mo(e,"in-map",o[0]!=="list"),Mo(e,"list-icon",o[0]==="list")},m(l,u){bn(l,e,u),Ai(e,t)},p(l,[u]){u&1&&n!==(n=l[0]==="list"?20:void 0)&&ot(e,"width",n),u&1&&Mo(e,"in-map",l[0]!=="list"),u&1&&Mo(e,"list-icon",l[0]==="list")},i:mn,o:mn,d(l){l&&_n(e)}}}function d2(o,e,t){let{displayIn:n}=e;return o.$$set=l=>{"displayIn"in l&&t(0,n=l.displayIn)},[n]}class f2 extends oa{constructor(e){super(),ra(this,e,d2,h2,na,{displayIn:0})}}function p2(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ot(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ot(e,"viewBox","0 0 60.006 21.412"),ot(e,"width","14"),ot(e,"height","20"),ot(e,"class","svelte-en2qvf")},m(n,l){bn(n,e,l),Ai(e,t)},p:mn,i:mn,o:mn,d(n){n&&_n(e)}}}class m2 extends oa{constructor(e){super(),ra(this,e,null,p2,na,{})}}function g2(o){let e,t,n;return{c(){e=jo("svg"),t=jo("circle"),n=jo("path"),ot(t,"cx","4.789"),ot(t,"cy","4.787"),ot(t,"r","3.85"),ot(t,"class","svelte-1aq105l"),ot(n,"d","M12.063 12.063 7.635 7.635"),ot(n,"class","svelte-1aq105l"),ot(e,"xmlns","http://www.w3.org/2000/svg"),ot(e,"width","13"),ot(e,"height","13"),ot(e,"viewBox","0 0 13 13"),ot(e,"class","svelte-1aq105l")},m(l,u){bn(l,e,u),Ai(e,t),Ai(e,n)},p:mn,i:mn,o:mn,d(l){l&&_n(e)}}}class _2 extends oa{constructor(e){super(),ra(this,e,null,g2,na,{})}}function y2(o,e,t){const n=e[1],l=e[0],u=n-l;return o===n&&t?o:((o-l)%u+u)%u+l}function vd(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let su;async function b2(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(su&&l.cachedLocationExpiry&&su.time+l.cachedLocationExpiry>Date.now()){if(!su.coords)break e;return su.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(su={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const v2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Yg=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Qg=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,e_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,t_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,i_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function w2(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(L=>Number(L.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),d=t>0?"N":"S",a=n>0?"E":"W";let _;o=="DD"&&(_=`${l}° ${d}, ${u}° ${a}`);const x=Math.floor(l),S=Math.floor(u),k=(l-x)*60,C=(u-S)*60;if(o=="DM"){let L=n_(k,3).toFixed(3).padStart(6,"0"),z=n_(C,3).toFixed(3).padStart(6,"0");L.endsWith(".000")&&z.endsWith(".000")&&(L=L.replace(/\.000$/,""),z=z.replace(/\.000$/,"")),_=`${x}° ${L}' ${d}, ${S}° ${z}' ${a}`}if(o=="DMS"){const L=Math.floor(k),z=Math.floor(C);let R=((k-L)*60).toFixed(1).padStart(4,"0"),D=((C-z)*60).toFixed(1).padStart(4,"0");const B=L.toString().padStart(2,"0"),N=z.toString().padStart(2,"0");R.endsWith(".0")&&D.endsWith(".0")&&(R=R.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),_=`${x}° ${B}' ${R}" ${d}, ${S}° ${N}' ${D}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function n_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Op(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",d=null,a=[],_=!1;if(v2.test(o))throw new Error("invalid coordinate value");if(Yg.test(o))if(a=Yg.exec(o),_=au(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),d="DM";else throw new Error("invalid coordinate format");else if(Qg.test(o))if(a=Qg.exec(o),_=au(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(e_.test(o))if(a=e_.exec(o),_=au(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(t_.test(o))if(a=t_.exec(o),_=au(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(i_.test(o)){if(a=i_.exec(o),_=au(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(l)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const S=a[0].trim();let k,C;const L=/[,/;\u0020]/g,z=S.match(L);if(z==null){const B=Math.floor(o.length/2);k=S.substring(0,B).trim(),C=S.substring(B).trim()}else{let B;z.length%2==1?B=Math.floor(z.length/2):B=z.length/2-1;let N=0;if(B==0)N=S.indexOf(z[0]),k=S.substring(0,N).trim(),C=S.substring(N+1).trim();else{let V=0,U=0;for(;V<=B;)N=S.indexOf(z[V],U),U=N+1,V++;k=S.substring(0,N).trim(),C=S.substring(N+1).trim()}}const R=k.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const D=C.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(k)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:S,verbatimLatitude:k,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:d,closeEnough:x2,toCoordinateFormat:w2})}else throw new Error("coordinates pattern match failed")}function au(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),x=n.test(d)&&n.test(a),S=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||x||S)continue;return!1}}return!0}function r_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function x2(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return r_(this.decimalLatitude,Number(e[0]))&&r_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const k2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Op.to=k2;const S2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],T2={decimalLatitude:40.123,decimalLongitude:-74.123},E2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],C2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function M2(){const o=[];return S2.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...T2})}),[...o,...E2,...C2]}const I2=M2();Op.formats=I2.map(o=>o.verbatimCoordinates);const L2=Op;function o_(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function s_(o){let e,t;return e=new u2({}),{c(){ta(e.$$.fragment)},m(n,l){Ms(e,n,l),t=!0},i(n){t||($n(e.$$.fragment,n),t=!0)},o(n){lr(e.$$.fragment,n),t=!1},d(n){Is(e,n)}}}function a_(o){let e,t,n,l,u;return t=new m2({}),{c(){e=Xi("button"),ta(t.$$.fragment),ot(e,"type","button"),ot(e,"title",o[9]),ot(e,"class","svelte-bz0zu3"),Mo(e,"active",o[0])},m(d,a){bn(d,e,a),Ms(t,e,null),n=!0,l||(u=Zr(e,"click",o[69]),l=!0)},p(d,a){(!n||a[0]&512)&&ot(e,"title",d[9]),(!n||a[0]&1)&&Mo(e,"active",d[0])},i(d){n||($n(t.$$.fragment,d),n=!0)},o(d){lr(t.$$.fragment,d),n=!1},d(d){d&&_n(e),Is(t),l=!1,u()}}}function A2(o){let e,t=[],n=new Map,l,u,d,a=Kg(o[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let S=o_(o,a,x),k=_(S);n.set(k,t[x]=l_(k,S))}return{c(){e=Xi("ul");for(let x=0;x<t.length;x+=1)t[x].c();ot(e,"class","options svelte-bz0zu3")},m(x,S){bn(x,e,S);for(let k=0;k<t.length;k+=1)t[k]&&t[k].m(e,null);l=!0,u||(d=[Zr(e,"mouseleave",o[73]),Zr(e,"blur",o[74])],u=!0)},p(x,S){S[0]&17880064&&(a=Kg(x[14]),ld(),t=$x(t,S,_,1,x,a,n,e,Wx,l_,null,o_),cd())},i(x){if(!l){for(let S=0;S<a.length;S+=1)$n(t[S]);l=!0}},o(x){for(let S=0;S<t.length;S+=1)lr(t[S]);l=!1},d(x){x&&_n(e);for(let S=0;S<t.length;S+=1)t[S].d();u=!1,Ls(d)}}}function P2(o){let e,t,n,l,u,d;return t=new P0({}),{c(){e=Xi("div"),ta(t.$$.fragment),n=ho(),l=Xi("div"),u=ea(o[7]),ot(l,"class","svelte-bz0zu3"),ot(e,"class","no-results svelte-bz0zu3")},m(a,_){bn(a,e,_),Ms(t,e,null),Ai(e,n),Ai(e,l),Ai(l,u),d=!0},p(a,_){(!d||_[0]&128)&&Pu(u,a[7])},i(a){d||($n(t.$$.fragment,a),d=!0)},o(a){lr(t.$$.fragment,a),d=!1},d(a){a&&_n(e),Is(t)}}}function z2(o){let e="",t;return{c(){t=ea(e)},m(n,l){bn(n,t,l)},p:mn,i:mn,o:mn,d(n){n&&_n(t)}}}function D2(o){let e,t,n,l,u,d,a,_,x,S,k;return t=new P0({}),_=new A0({}),{c(){e=Xi("div"),ta(t.$$.fragment),n=ho(),l=Xi("div"),u=ea(o[6]),d=ho(),a=Xi("button"),ta(_.$$.fragment),ot(l,"class","svelte-bz0zu3"),ot(a,"class","svelte-bz0zu3"),ot(e,"class","error svelte-bz0zu3")},m(C,L){bn(C,e,L),Ms(t,e,null),Ai(e,n),Ai(e,l),Ai(l,u),Ai(e,d),Ai(e,a),Ms(_,a,null),x=!0,S||(k=Zr(a,"click",o[70]),S=!0)},p(C,L){(!x||L[0]&64)&&Pu(u,C[6])},i(C){x||($n(t.$$.fragment,C),$n(_.$$.fragment,C),x=!0)},o(C){lr(t.$$.fragment,C),lr(_.$$.fragment,C),x=!1},d(C){C&&_n(e),Is(t),Is(_),S=!1,k()}}}function l_(o,e){let t,n,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return n=new l2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",d),{key:o,first:null,c(){t=Bx(),ta(n.$$.fragment),this.first=t},m(a,_){bn(a,t,_),Ms(n,a,_),l=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){l||($n(n.$$.fragment,a),l=!0)},o(a){lr(n.$$.fragment,a),l=!1},d(a){a&&_n(t),Is(n,a)}}}function R2(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B,N,V,U,le,oe=!1;u=new _2({}),k=new A0({});let H=o[19]&&s_(),ee=o[5]==="button"&&a_(o);const be=o[61].default,Oe=Px(be,o,o[60],null),ne=[D2,z2,P2,A2],ye=[];function Ke(Ce,et){var vt,pt;return Ce[18]?0:Ce[16]?((vt=Ce[14])==null?void 0:vt.length)===0?2:Ce[16]&&(pt=Ce[14])!=null&&pt.length?3:-1:1}return~(D=Ke(o))&&(B=ye[D]=ne[D](o)),{c(){e=ho(),t=Xi("form"),n=Xi("div"),l=Xi("button"),ta(u.$$.fragment),d=ho(),a=Xi("input"),_=ho(),x=Xi("div"),S=Xi("button"),ta(k.$$.fragment),C=ho(),H&&H.c(),L=ho(),ee&&ee.c(),z=ho(),Oe&&Oe.c(),R=ho(),B&&B.c(),ot(l,"class","search-button svelte-bz0zu3"),ot(l,"type","button"),ot(a,"placeholder",o[8]),ot(a,"aria-label",o[8]),ot(a,"class","svelte-bz0zu3"),ot(S,"type","button"),ot(S,"title",o[3]),ot(S,"class","svelte-bz0zu3"),ot(x,"class","clear-button-container svelte-bz0zu3"),Mo(x,"displayable",o[1]!==""),ot(n,"class","input-group svelte-bz0zu3"),ot(t,"tabindex","0"),ot(t,"class",N=Wg(o[2])+" svelte-bz0zu3"),Mo(t,"can-collapse",o[4]&&o[1]==="")},m(Ce,et){bn(Ce,e,et),bn(Ce,t,et),Ai(t,n),Ai(n,l),Ms(u,l,null),Ai(n,d),Ai(n,a),o[63](a),$g(a,o[1]),Ai(n,_),Ai(n,x),Ai(x,S),Ms(k,S,null),Ai(x,C),H&&H.m(x,null),Ai(n,L),ee&&ee.m(n,null),Ai(n,z),Oe&&Oe.m(n,null),Ai(t,R),~D&&ye[D].m(t,null),V=!0,U||(le=[Zr(l,"click",o[62]),Zr(a,"input",o[64]),Zr(a,"focus",o[65]),Zr(a,"blur",o[66]),Zr(a,"keydown",o[22]),Zr(a,"input",o[67]),Zr(S,"click",o[68]),Zr(t,"submit",Fx(o[21]))],U=!0)},p(Ce,et){(!V||et[0]&256)&&ot(a,"placeholder",Ce[8]),(!V||et[0]&256)&&ot(a,"aria-label",Ce[8]),et[0]&2&&a.value!==Ce[1]&&$g(a,Ce[1]),(!V||et[0]&8)&&ot(S,"title",Ce[3]),Ce[19]?H?et[0]&524288&&$n(H,1):(H=s_(),H.c(),$n(H,1),H.m(x,null)):H&&(ld(),lr(H,1,1,()=>{H=null}),cd()),(!V||et[0]&2)&&Mo(x,"displayable",Ce[1]!==""),Ce[5]==="button"?ee?(ee.p(Ce,et),et[0]&32&&$n(ee,1)):(ee=a_(Ce),ee.c(),$n(ee,1),ee.m(n,z)):ee&&(ld(),lr(ee,1,1,()=>{ee=null}),cd()),Oe&&Oe.p&&(!V||et[1]&536870912)&&Dx(Oe,be,Ce,Ce[60],V?zx(be,Ce[60],et,null):Rx(Ce[60]),null);let vt=D;D=Ke(Ce),D===vt?~D&&ye[D].p(Ce,et):(B&&(ld(),lr(ye[vt],1,1,()=>{ye[vt]=null}),cd()),~D?(B=ye[D],B?B.p(Ce,et):(B=ye[D]=ne[D](Ce),B.c()),$n(B,1),B.m(t,null)):B=null),(!V||et[0]&4&&N!==(N=Wg(Ce[2])+" svelte-bz0zu3"))&&ot(t,"class",N),(!V||et[0]&22)&&Mo(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){V||($n(oe),$n(u.$$.fragment,Ce),$n(k.$$.fragment,Ce),$n(H),$n(ee),$n(Oe,Ce),$n(B),V=!0)},o(Ce){lr(oe),lr(u.$$.fragment,Ce),lr(k.$$.fragment,Ce),lr(H),lr(ee),lr(Oe,Ce),lr(B),V=!1},d(Ce){Ce&&(_n(e),_n(t)),Is(u),o[63](null),Is(k),H&&H.d(),ee&&ee.d(),Oe&&Oe.d(Ce),~D&&ye[D].d(),U=!1,Ls(le)}}}function B2(o,e,t){let n,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:S=void 0}=e,{clearButtonTitle:k="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:L=!1}=e,{country:z=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:D="never"}=e,{errorMessage:B="Something went wrong…"}=e,{filter:N=()=>!0}=e,{flyTo:V=!0}=e,{fuzzyMatch:U=!0}=e,{language:le=void 0}=e,{limit:oe=void 0}=e,{mapController:H=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:be="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Oe="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:ye=D==="always"}=e,{reverseButtonTitle:Ke="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:vt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:st=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:ii=!0}=e,{types:Ot=void 0}=e,{exhaustiveReverseGeocoding:Pt=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Mt=a}=e,{apiUrl:ei="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Vt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:xi=()=>{}}=e;function gi(){Ve.focus()}function Pi(){Ve.blur()}function ct(G,Ue=!0,qe=!1){t(1,Ce=G),Ue?(t(15,$e=-1),ut()):(Yt(!qe,qe),setTimeout(()=>{Ve.focus(),Ve.select()}))}function It(){t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1)}function Ne(){t(55,xt=[]),t(56,we=void 0)}let je=!1,rt,xt,we,di="",Ve,$e=-1,kt,vn=[],wn,Cn,ir,nr;const Uo=new Set,Ji=Ux();jx(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function ut(G){if(Cn&&(clearTimeout(Cn),Cn=void 0),$e>-1&&rt)t(56,we=rt[$e]),t(1,Ce=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,kt=void 0),t(55,xt=void 0),t(15,$e=-1);else if(Ce){const Ue=G||!Xn(Ce);xn(Ce,{exact:!0}).then(()=>{t(55,xt=rt),t(56,we=void 0),Ue&&Lo()}).catch(qe=>t(18,kt=qe))}}function Xn(G){try{return L2(G,6)}catch{return!1}}async function xn(G,{byId:Ue=!1,exact:qe=!1}={}){t(18,kt=void 0),wn==null||wn.abort();const Ge=new AbortController;t(19,wn=Ge);try{const Je=Xn(G),ht=new URLSearchParams;if(le!==void 0&&ht.set("language",Array.isArray(le)?le.join(","):le??""),Ot&&ht.set("types",Ot.join(",")),Jt&&ht.set("excludeTypes",String(Jt)),S&&ht.set("bbox",S.map(bi=>bi.toFixed(6)).join(",")),z&&ht.set("country",Array.isArray(z)?z.join(","):z),!Ue&&!Je){const bi=await b2(H,ne,Ge);bi&&ht.set("proximity",bi),(qe||!pt)&&ht.set("autocomplete","false"),ht.set("fuzzyMatch",String(U))}oe!==void 0&&(Pt||!Je||(Ot==null?void 0:Ot.length)===1)&&ht.set("limit",String(oe)),ht.set("key",x),xi(ht);const Rt=ei+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:G)+".json?"+ht.toString();if(Rt===di){Ue?(t(14,rt=void 0),t(56,we=vn[0])):t(14,rt=vn);return}di=Rt;const Xt=await fetch(Rt,{signal:Ge.signal,...Vt});if(!Xt.ok)throw new Error(await Xt.text());const ai=await Xt.json();Ji("response",{url:Rt,featureCollection:ai}),Ue?(t(14,rt=void 0),t(56,we=ai.features[0]),vn=[we]):(t(14,rt=ai.features.filter(N)),Je&&rt.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),vn=rt,Je&&Ve.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{Ge===wn&&t(19,wn=void 0)}}function Lo(){var G;if(!(xt!=null&&xt.length)||!V)return;const Ue=[180,90,-180,-90],qe=!xt.some(Je=>!Je.matching_text);let Ge;for(const Je of xt){const ht=qi(Je);if(Ge=Ge===void 0?ht:ht===void 0?Ge:Math.max(Ge,ht),qe||!Je.matching_text)for(const Rt of[0,1,2,3])Ue[Rt]=Math[Rt<2?"min":"max"](Ue[Rt],((G=Je.bbox)==null?void 0:G[Rt])??Je.center[Rt%2])}H&&xt.length>0&&(we&&Ue[0]===Ue[2]&&Ue[1]===Ue[3]?H.flyTo(we.center,qi(we)):H.fitBounds(vd(Ue),50,Ge))}function qi(G){var Ue;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const qe=G.id.replace(/\..*/,"");return(Array.isArray((Ue=G.properties)==null?void 0:Ue.categories)?G.properties.categories.reduce((Ge,Je)=>{const ht=Mt[qe+"."+Je];return Ge===void 0?ht:ht===void 0?Ge:Math.max(Ge,ht)},void 0):void 0)??Mt[qe]}function gt(G){t(0,ye=D==="always"),t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1),ct(G[1].toFixed(6)+", "+y2(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ni(G){if(!rt)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&($e===(st?0:-1)&&Ue===-1&&t(15,$e=rt.length),t(15,$e+=Ue),$e>=rt.length&&t(15,$e=-1),$e<0&&st&&t(15,$e=0),G.preventDefault())}function Yt(G=!0,Ue=!1){if(t(18,kt=void 0),pt||Ue){if(Cn&&clearTimeout(Cn),Ce.length<ee)return;const qe=Ce;Cn=window.setTimeout(()=>{xn(qe).catch(Ge=>t(18,kt=Ge))},G?R:0)}else t(14,rt=void 0),t(18,kt=void 0)}function Zi(G){t(56,we=G),t(1,Ce=G.place_name),t(15,$e=-1)}const yr=()=>Ve.focus();function ti(G){lp[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function eo(){Ce=this.value,t(1,Ce),t(13,je),t(28,C)}const cn=()=>t(13,je=!0),me=()=>t(13,je=!1),W=()=>Yt(),X=()=>{t(1,Ce=""),Ve.focus()},te=()=>t(0,ye=!ye),de=()=>t(18,kt=void 0),Me=G=>t(15,$e=G),Ie=G=>Zi(G),Be=()=>{st||t(15,$e=-1)},ke=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,x=G.apiKey),"bbox"in G&&t(27,S=G.bbox),"clearButtonTitle"in G&&t(3,k=G.clearButtonTitle),"clearOnBlur"in G&&t(28,C=G.clearOnBlur),"collapsed"in G&&t(4,L=G.collapsed),"country"in G&&t(29,z=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,D=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,V=G.flyTo),"fuzzyMatch"in G&&t(33,U=G.fuzzyMatch),"language"in G&&t(34,le=G.language),"limit"in G&&t(35,oe=G.limit),"mapController"in G&&t(36,H=G.mapController),"minLength"in G&&t(37,ee=G.minLength),"noResultsMessage"in G&&t(7,be=G.noResultsMessage),"placeholder"in G&&t(8,Oe=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,ye=G.reverseActive),"reverseButtonTitle"in G&&t(9,Ke=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,vt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,st=G.selectFirst),"flyToSelected"in G&&t(41,Ht=G.flyToSelected),"markerOnSelected"in G&&t(42,ii=G.markerOnSelected),"types"in G&&t(43,Ot=G.types),"exhaustiveReverseGeocoding"in G&&t(44,Pt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Mt=G.zoom),"apiUrl"in G&&t(47,ei=G.apiUrl),"fetchParameters"in G&&t(48,Vt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,xi=G.adjustUrlQuery),"$$scope"in G&&t(60,d=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ye=D==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ir=je),C&&!je&&t(1,Ce="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ce.length<ee&&(t(56,we=void 0),t(14,rt=void 0),t(18,kt=void 0),t(55,xt=rt)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&xn(we.id,{byId:!0}).catch(G=>t(18,kt=G)),o.$$.dirty[1]&100663330&&(H&&we&&we.id!==nr&&V&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?H.flyTo(we.center,qi(we)):H.fitBounds(vd(we.bbox),50,qi(we)),t(14,rt=void 0),t(55,xt=void 0),t(15,$e=-1)),t(57,nr=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&st&&rt!=null&&rt.length&&t(15,$e=0),o.$$.dirty[0]&2&&t(15,$e=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&xt!==rt&&t(55,xt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&H&&H.setEventHandler(G=>{switch(G.type){case"mapClick":ye&&gt(G.coordinates);break;case"markerClick":{const Ue=rt==null?void 0:rt.find(qe=>qe.id===G.id);Ue&&Zi(Ue)}break;case"markerMouseEnter":xt&&t(15,$e=ir?(rt==null?void 0:rt.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,$e=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=rt==null?void 0:rt[$e]),o.$$.dirty[1]&134218786&&H&&l&&V&&Ht&&H.flyTo(l.center,qi(l)),o.$$.dirty[1]&256&&t(59,n=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ii||H==null||H.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&H&&ii&&!xt&&(H.setFeatures(l?[l]:void 0,void 0,n),H.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&H&&H.setFeatures(xt,we,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&xt&&H&&H.setSelectedMarker($e),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&H){const G=Xn(Ce);H.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ji("select",{feature:l}),o.$$.dirty[1]&33554432&&Ji("pick",{feature:we}),o.$$.dirty[0]&81920&&Ji("optionsvisibilitychange",{optionsVisible:ir&&!!rt}),o.$$.dirty[0]&16384&&Ji("featureslisted",{features:rt}),o.$$.dirty[1]&16777216&&Ji("featuresmarked",{features:xt}),o.$$.dirty[0]&1&&Ji("reversetoggle",{reverse:ye}),o.$$.dirty[0]&2&&Ji("querychange",{query:Ce}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&H&&H.indicateReverse(ye)},[ye,Ce,_,k,L,D,B,be,Oe,Ke,vt,st,hi,je,rt,$e,ir,Ve,kt,wn,Uo,ut,ni,Yt,Zi,a,x,S,C,z,R,N,V,U,le,oe,H,ee,ne,et,pt,Ht,ii,Ot,Pt,Jt,Mt,ei,Vt,xi,gi,Pi,ct,It,Ne,xt,we,nr,l,n,d,u,yr,ti,eo,cn,me,W,X,te,de,Me,Ie,Be,ke]}let F2=class extends oa{constructor(o){super(),ra(this,o,B2,R2,na,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Du(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function Np(o,e,t={}){for(const n of o){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<n[n.length-1].length;l++)if(n[n.length-1][l]!==n[0][l])throw new Error("First and last Position are not equivalent.")}return Du({type:"Polygon",coordinates:o},e,t)}function Ru(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function z0(o,e,t={}){return Du({type:"MultiPolygon",coordinates:o},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function O2(o,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,l,u,d;return d={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function a(x){return function(S){return _([x,S])}}function _(x){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,l&&(u=x[0]&2?l.return:x[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,x[1])).done)return u;switch(l=0,u&&(x=[x[0]&2,u.value]),x[0]){case 0:case 1:u=x;break;case 4:return t.label++,{value:x[1],done:!1};case 5:t.label++,l=x[1],x=[0];continue;case 7:x=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(x[0]===6||x[0]===2)){t=0;continue}if(x[0]===3&&(!u||x[1]>u[0]&&x[1]<u[3])){t.label=x[1];break}if(x[0]===6&&t.label<u[1]){t.label=u[1],u=x;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(x);break}u[2]&&t.ops.pop(),t.trys.pop();continue}x=e.call(o,t)}catch(S){x=[6,S],l=0}finally{n=u=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var ia=function(){function o(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return o}();function N2(o,e){return o>e?1:o<e?-1:0}function Ks(o,e,t){for(var n=new ia(null,null),l=n,u=n;;){var d=t(o,e.key);if(d<0){if(e.left===null)break;if(t(o,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(o,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=n.right,e.right=n.left,e}function Wf(o,e,t,n){var l=new ia(o,e);if(t===null)return l.left=l.right=null,l;t=Ks(o,t,n);var u=n(o,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function c_(o,e,t){var n=null,l=null;if(e){e=Ks(o,e,t);var u=t(e.key,o);u===0?(n=e.left,l=e.right):u<0?(l=e.right,e.right=null,n=e):(n=e.left,e.left=null,l=e)}return{left:n,right:l}}function j2(o,e,t){return e===null?o:(o===null||(e=Ks(o.key,e,t),e.left=o),e)}function hp(o,e,t,n,l){if(o){n(""+e+(t?"└── ":"├── ")+l(o)+`
`);var u=e+(t?"    ":"│   ");o.left&&hp(o.left,u,!1,n,l),o.right&&hp(o.right,u,!0,n,l)}}var jp=function(){function o(e){e===void 0&&(e=N2),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=Wf(e,t,this._root,this._comparator)},o.prototype.add=function(e,t){var n=new ia(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var l=this._comparator,u=Ks(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(n.left=u.left,n.right=u,u.left=null):d>0&&(n.right=u.right,n.left=u,u.right=null),this._size++,this._root=n),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,n){var l;if(t===null)return null;t=Ks(e,t,n);var u=n(e,t.key);return u===0?(t.left===null?l=t.right:(l=Ks(e,t.left,n),l.right=t.right),this._size--,l):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ks(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=Ks(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},o.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},o.prototype.forEach=function(e,t){for(var n=this._root,l=[],u=!1;!u;)n!==null?(l.push(n),n=n.left):l.length!==0?(n=l.pop(),e.call(t,n),n=n.right):u=!0;return this},o.prototype.range=function(e,t,n,l){for(var u=[],d=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=d(a.key,t),_>0)break;if(d(a.key,e)>=0&&n.call(l,a))return this;a=a.right}return this},o.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},o.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,n=!1,l=0,u=[];!n;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else n=!0;return null},o.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(n=t,t=t.left):t=t.right}return n},o.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(n=t,t=t.right)}return n},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return V2(this._root)},o.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var l=e.length,u=this._comparator;if(n&&pp(e,t,0,l-1,u),this._root===null)this._root=dp(e,t,0,l),this._size=l;else{var d=q2(this.toList(),U2(e,t),u);l=this._size+l,this._root=fp({head:d},0,l)}return this},o.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return hp(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},o.prototype.update=function(e,t,n){var l=this._comparator,u=c_(e,this._root,l),d=u.left,a=u.right;l(e,t)<0?a=Wf(t,n,a,l):d=Wf(t,n,d,l),this._root=j2(d,a,l)},o.prototype.split=function(e){return c_(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var e,t,n;return O2(this,function(l){switch(l.label){case 0:e=this._root,t=[],n=!1,l.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:n=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},o}();function dp(o,e,t,n){var l=n-t;if(l>0){var u=t+Math.floor(l/2),d=o[u],a=e[u],_=new ia(d,a);return _.left=dp(o,e,t,u),_.right=dp(o,e,u+1,n),_}return null}function U2(o,e){for(var t=new ia(null,null),n=t,l=0;l<o.length;l++)n=n.next=new ia(o[l],e[l]);return n.next=null,t.next}function V2(o){for(var e=o,t=[],n=!1,l=new ia(null,null),u=l;!n;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):n=!0;return u.next=null,l.next}function fp(o,e,t){var n=t-e;if(n>0){var l=e+Math.floor(n/2),u=fp(o,e,l),d=o.head;return d.left=u,o.head=o.head.next,d.right=fp(o,l+1,t),d}return null}function q2(o,e,t){for(var n=new ia(null,null),l=n,u=o,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),n.next}function pp(o,e,t,n,l){if(!(t>=n)){for(var u=o[t+n>>1],d=t-1,a=n+1;;){do d++;while(l(o[d],u)<0);do a--;while(l(o[a],u)>0);if(d>=a)break;var _=o[d];o[d]=o[a],o[a]=_,_=e[d],e[d]=e[a],e[a]=_}pp(o,e,t,a,l),pp(o,e,a+1,n,l)}}const ks=11102230246251565e-32,Mr=134217729,Z2=(3+8*ks)*ks;function $f(o,e,t,n,l){let u,d,a,_,x=e[0],S=n[0],k=0,C=0;S>x==S>-x?(u=x,x=e[++k]):(u=S,S=n[++C]);let L=0;if(k<o&&C<t)for(S>x==S>-x?(d=x+u,a=u-(d-x),x=e[++k]):(d=S+u,a=u-(d-S),S=n[++C]),u=d,a!==0&&(l[L++]=a);k<o&&C<t;)S>x==S>-x?(d=u+x,_=d-u,a=u-(d-_)+(x-_),x=e[++k]):(d=u+S,_=d-u,a=u-(d-_)+(S-_),S=n[++C]),u=d,a!==0&&(l[L++]=a);for(;k<o;)d=u+x,_=d-u,a=u-(d-_)+(x-_),x=e[++k],u=d,a!==0&&(l[L++]=a);for(;C<t;)d=u+S,_=d-u,a=u-(d-_)+(S-_),S=n[++C],u=d,a!==0&&(l[L++]=a);return(u!==0||L===0)&&(l[L++]=u),L}function G2(o,e){let t=e[0];for(let n=1;n<o;n++)t+=e[n];return t}function Vu(o){return new Float64Array(o)}const W2=(3+16*ks)*ks,$2=(2+12*ks)*ks,H2=(9+64*ks)*ks*ks,Ul=Vu(4),u_=Vu(8),h_=Vu(12),d_=Vu(16),Ur=Vu(4);function X2(o,e,t,n,l,u,d){let a,_,x,S,k,C,L,z,R,D,B,N,V,U,le,oe,H,ee;const be=o-l,Oe=t-l,ne=e-u,ye=n-u;U=be*ye,C=Mr*be,L=C-(C-be),z=be-L,C=Mr*ye,R=C-(C-ye),D=ye-R,le=z*D-(U-L*R-z*R-L*D),oe=ne*Oe,C=Mr*ne,L=C-(C-ne),z=ne-L,C=Mr*Oe,R=C-(C-Oe),D=Oe-R,H=z*D-(oe-L*R-z*R-L*D),B=le-H,k=le-B,Ul[0]=le-(B+k)+(k-H),N=U+B,k=N-U,V=U-(N-k)+(B-k),B=V-oe,k=V-B,Ul[1]=V-(B+k)+(k-oe),ee=N+B,k=ee-N,Ul[2]=N-(ee-k)+(B-k),Ul[3]=ee;let Ke=G2(4,Ul),Ce=$2*d;if(Ke>=Ce||-Ke>=Ce||(k=o-be,a=o-(be+k)+(k-l),k=t-Oe,x=t-(Oe+k)+(k-l),k=e-ne,_=e-(ne+k)+(k-u),k=n-ye,S=n-(ye+k)+(k-u),a===0&&_===0&&x===0&&S===0)||(Ce=H2*d+Z2*Math.abs(Ke),Ke+=be*S+ye*a-(ne*x+Oe*_),Ke>=Ce||-Ke>=Ce))return Ke;U=a*ye,C=Mr*a,L=C-(C-a),z=a-L,C=Mr*ye,R=C-(C-ye),D=ye-R,le=z*D-(U-L*R-z*R-L*D),oe=_*Oe,C=Mr*_,L=C-(C-_),z=_-L,C=Mr*Oe,R=C-(C-Oe),D=Oe-R,H=z*D-(oe-L*R-z*R-L*D),B=le-H,k=le-B,Ur[0]=le-(B+k)+(k-H),N=U+B,k=N-U,V=U-(N-k)+(B-k),B=V-oe,k=V-B,Ur[1]=V-(B+k)+(k-oe),ee=N+B,k=ee-N,Ur[2]=N-(ee-k)+(B-k),Ur[3]=ee;const et=$f(4,Ul,4,Ur,u_);U=be*S,C=Mr*be,L=C-(C-be),z=be-L,C=Mr*S,R=C-(C-S),D=S-R,le=z*D-(U-L*R-z*R-L*D),oe=ne*x,C=Mr*ne,L=C-(C-ne),z=ne-L,C=Mr*x,R=C-(C-x),D=x-R,H=z*D-(oe-L*R-z*R-L*D),B=le-H,k=le-B,Ur[0]=le-(B+k)+(k-H),N=U+B,k=N-U,V=U-(N-k)+(B-k),B=V-oe,k=V-B,Ur[1]=V-(B+k)+(k-oe),ee=N+B,k=ee-N,Ur[2]=N-(ee-k)+(B-k),Ur[3]=ee;const vt=$f(et,u_,4,Ur,h_);U=a*S,C=Mr*a,L=C-(C-a),z=a-L,C=Mr*S,R=C-(C-S),D=S-R,le=z*D-(U-L*R-z*R-L*D),oe=_*x,C=Mr*_,L=C-(C-_),z=_-L,C=Mr*x,R=C-(C-x),D=x-R,H=z*D-(oe-L*R-z*R-L*D),B=le-H,k=le-B,Ur[0]=le-(B+k)+(k-H),N=U+B,k=N-U,V=U-(N-k)+(B-k),B=V-oe,k=V-B,Ur[1]=V-(B+k)+(k-oe),ee=N+B,k=ee-N,Ur[2]=N-(ee-k)+(B-k),Ur[3]=ee;const pt=$f(vt,h_,4,Ur,d_);return d_[pt-1]}function K2(o,e,t,n,l,u){const d=(e-u)*(t-l),a=(o-l)*(n-u),_=d-a,x=Math.abs(d+a);return Math.abs(_)>=W2*x?_:-X2(o,e,t,n,l,u,x)}const lu=(o,e)=>o.ll.x<=e.x&&e.x<=o.ur.x&&o.ll.y<=e.y&&e.y<=o.ur.y,mp=(o,e)=>{if(e.ur.x<o.ll.x||o.ur.x<e.ll.x||e.ur.y<o.ll.y||o.ur.y<e.ll.y)return null;const t=o.ll.x<e.ll.x?e.ll.x:o.ll.x,n=o.ur.x<e.ur.x?o.ur.x:e.ur.x,l=o.ll.y<e.ll.y?e.ll.y:o.ll.y,u=o.ur.y<e.ur.y?o.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:n,y:u}}};let Ys=Number.EPSILON;Ys===void 0&&(Ys=Math.pow(2,-52));const J2=Ys*Ys,f_=(o,e)=>{if(-Ys<o&&o<Ys&&-Ys<e&&e<Ys)return 0;const t=o-e;return t*t<J2*o*e?0:o<e?-1:1};class Y2{constructor(){this.reset()}reset(){this.xRounder=new p_,this.yRounder=new p_}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class p_{constructor(){this.tree=new jp,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&f_(t.key,n.key)===0)return this.tree.remove(e),n.key;const l=this.tree.next(t);return l!==null&&f_(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const Bu=new Y2,ud=(o,e)=>o.x*e.y-o.y*e.x,D0=(o,e)=>o.x*e.x+o.y*e.y,m_=(o,e,t)=>{const n=K2(o.x,o.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},wd=o=>Math.sqrt(D0(o,o)),Q2=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return ud(l,n)/wd(l)/wd(n)},ek=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return D0(l,n)/wd(l)/wd(n)},g_=(o,e,t)=>e.y===0?null:{x:o.x+e.x/e.y*(t-o.y),y:t},__=(o,e,t)=>e.x===0?null:{x:t,y:o.y+e.y/e.x*(t-o.x)},tk=(o,e,t,n)=>{if(e.x===0)return __(t,n,o.x);if(n.x===0)return __(o,e,t.x);if(e.y===0)return g_(t,n,o.y);if(n.y===0)return g_(o,e,t.y);const l=ud(e,n);if(l==0)return null;const u={x:t.x-o.x,y:t.y-o.y},d=ud(u,e)/l,a=ud(u,n)/l,_=o.x+a*e.x,x=t.x+d*n.x,S=o.y+a*e.y,k=t.y+d*n.y,C=(_+x)/2,L=(S+k)/2;return{x:C,y:L}};class To{static compare(e,t){const n=To.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Qs.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,l=t.length;n<l;n++){const u=t[n];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&n.otherSE.point.events===u.otherSE.point.events&&n.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,n=l=>{const u=l.otherSE;t.set(l,{sine:Q2(this.point,e.point,u.point),cosine:ek(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||n(l),t.has(u)||n(u);const{sine:d,cosine:a}=t.get(l),{sine:_,cosine:x}=t.get(u);return d>=0&&_>=0?a<x?1:a>x?-1:0:d<0&&_<0?a<x?-1:a>x?1:0:_<d?-1:_>d?1:0}}}let ik=0;class Qs{static compare(e,t){const n=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<n)return 1;if(u<l)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,x=e.rightSE.point.y,S=t.rightSE.point.y;if(n<l){if(_<a&&_<x)return 1;if(_>a&&_>x)return-1;const k=e.comparePoint(t.leftSE.point);if(k<0)return 1;if(k>0)return-1;const C=t.comparePoint(e.rightSE.point);return C!==0?C:-1}if(n>l){if(a<_&&a<S)return-1;if(a>_&&a>S)return 1;const k=t.comparePoint(e.leftSE.point);if(k!==0)return k;const C=e.comparePoint(t.rightSE.point);return C<0?1:C>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<d){const k=t.comparePoint(e.rightSE.point);if(k!==0)return k}if(u>d){const k=e.comparePoint(t.rightSE.point);if(k<0)return 1;if(k>0)return-1}if(u!==d){const k=x-a,C=u-n,L=S-_,z=d-l;if(k>C&&L<z)return 1;if(k<C&&L>z)return-1}return u>d?1:u<d||x<S?-1:x>S?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,l){this.id=++ik,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=l}static fromRing(e,t,n){let l,u,d;const a=To.comparePoints(e,t);if(a<0)l=e,u=t,d=1;else if(a>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new To(l,!0),x=new To(u,!1);return new Qs(_,x,[n],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,l=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const a=(e.x-t.x)/l.x,_=t.y+a*l.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),l=mp(t,n);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,x=lu(t,a)&&this.comparePoint(a)===0,S=lu(n,u)&&e.comparePoint(u)===0,k=lu(t,_)&&this.comparePoint(_)===0,C=lu(n,d)&&e.comparePoint(d)===0;if(S&&x)return C&&!k?d:!C&&k?_:null;if(S)return k&&u.x===_.x&&u.y===_.y?null:u;if(x)return C&&d.x===a.x&&d.y===a.y?null:a;if(C&&k)return null;if(C)return d;if(k)return _;const L=tk(u,this.vector(),a,e.vector());return L===null||!lu(l,L)?null:Bu.round(L.x,L.y)}split(e){const t=[],n=e.events!==void 0,l=new To(e,!0),u=new To(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new Qs(l,d,this.rings.slice(),this.windings.slice());return To.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),To.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const l=Qs.compare(t,n);if(l!==0){if(l>0){const u=t;t=n,n=u}if(t.prev===n){const u=t;t=n,n=u}for(let u=0,d=n.rings.length;u<d;u++){const a=n.rings[u],_=n.windings[u],x=t.rings.indexOf(a);x===-1?(t.rings.push(a),t.windings.push(_)):t.windings[x]+=_}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const x=this.rings[a],S=this.windings[a],k=t.indexOf(x);k===-1?(t.push(x),n.push(S)):n[k]+=S}const u=[],d=[];for(let a=0,_=t.length;a<_;a++){if(n[a]===0)continue;const x=t[a],S=x.poly;if(d.indexOf(S)===-1)if(x.isExterior)u.push(S);else{d.indexOf(S)===-1&&d.push(S);const k=u.indexOf(x.poly);k!==-1&&u.splice(k,1)}}for(let a=0,_=u.length;a<_;a++){const x=u[a].multiPoly;l.indexOf(x)===-1&&l.push(x)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Oo.type){case"union":{const n=e.length===0,l=t.length===0;this._isInResult=n!==l;break}case"intersection":{let n,l;e.length<t.length?(n=e.length,l=t.length):(n=t.length,l=e.length),this._isInResult=l===Oo.numMultiPolys&&n<l;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=l=>l.length===1&&l[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${Oo.type}`)}return this._isInResult}}class y_{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=Bu.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,a=e.length;d<a;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=Bu.round(e[d][0],e[d][1]);_.x===u.x&&_.y===u.y||(this.segments.push(Qs.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(Qs.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class nk{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new y_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,l=e.length;n<l;n++){const u=new y_(e[n],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class b_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,l=e.length;n<l;n++){const u=new nk(e[n],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class xd{static factory(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.isInResult()||u.ringOut)continue;let d=null,a=u.leftSE,_=u.rightSE;const x=[a],S=a.point,k=[];for(;d=a,a=_,x.push(a),a.point!==S;)for(;;){const C=a.getAvailableLinkedEvents();if(C.length===0){const R=x[0].point,D=x[x.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(C.length===1){_=C[0].otherSE;break}let L=null;for(let R=0,D=k.length;R<D;R++)if(k[R].point===a.point){L=R;break}if(L!==null){const R=k.splice(L)[0],D=x.splice(R.index);D.unshift(D[0].otherSE),t.push(new xd(D.reverse()));continue}k.push({index:x.length,point:a.point});const z=a.getLeftmostComparator(d);_=C.sort(z)[0].otherSE;break}t.push(new xd(x))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let x=1,S=this.events.length-1;x<S;x++){const k=this.events[x].point,C=this.events[x+1].point;m_(k,e,C)!==0&&(t.push(k),e=k)}if(t.length===1)return null;const n=t[0],l=t[1];m_(n,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let x=d;x!=a;x+=u)_.push([t[x].x,t[x].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];To.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class v_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class rk{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.poly)if(u.isExteriorRing())t.push(new v_(u));else{const d=u.enclosingRing();d.poly||t.push(new v_(d)),d.poly.addInterior(u)}}return t}}class ok{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qs.compare;this.queue=e,this.tree=new jp(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)d=this.tree.next(d),d===null?_=null:d.key.consumedBy===void 0&&(_=d.key);if(e.isLeft){let x=null;if(a){const k=a.getIntersection(t);if(k!==null&&(t.isAnEndpoint(k)||(x=k),!a.isAnEndpoint(k))){const C=this._splitSafely(a,k);for(let L=0,z=C.length;L<z;L++)n.push(C[L])}}let S=null;if(_){const k=_.getIntersection(t);if(k!==null&&(t.isAnEndpoint(k)||(S=k),!_.isAnEndpoint(k))){const C=this._splitSafely(_,k);for(let L=0,z=C.length;L<z;L++)n.push(C[L])}}if(x!==null||S!==null){let k=null;x===null?k=S:S===null?k=x:k=To.comparePoints(x,S)<=0?x:S,this.queue.remove(t.rightSE),n.push(t.rightSE);const C=t.split(k);for(let L=0,z=C.length;L<z;L++)n.push(C[L])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const x=a.getIntersection(_);if(x!==null){if(!a.isAnEndpoint(x)){const S=this._splitSafely(a,x);for(let k=0,C=S.length;k<C;k++)n.push(S[k])}if(!_.isAnEndpoint(x)){const S=this._splitSafely(_,x);for(let k=0,C=S.length;k<C;k++)n.push(S[k])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const l=e.split(t);return l.push(n),e.consumedBy===void 0&&this.tree.add(e),l}}const w_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,sk=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class ak{run(e,t,n){Oo.type=e,Bu.reset();const l=[new b_(t,!0)];for(let S=0,k=n.length;S<k;S++)l.push(new b_(n[S],!1));if(Oo.numMultiPolys=l.length,Oo.type==="difference"){const S=l[0];let k=1;for(;k<l.length;)mp(l[k].bbox,S.bbox)!==null?k++:l.splice(k,1)}if(Oo.type==="intersection")for(let S=0,k=l.length;S<k;S++){const C=l[S];for(let L=S+1,z=l.length;L<z;L++)if(mp(C.bbox,l[L].bbox)===null)return[]}const u=new jp(To.compare);for(let S=0,k=l.length;S<k;S++){const C=l[S].getSweepEvents();for(let L=0,z=C.length;L<z;L++)if(u.insert(C[L]),u.size>w_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new ok(u);let a=u.size,_=u.pop();for(;_;){const S=_.key;if(u.size===a){const C=S.segment;throw new Error(`Unable to pop() ${S.isLeft?"left":"right"} SweepEvent [${S.point.x}, ${S.point.y}] from segment #${C.id} [${C.leftSE.point.x}, ${C.leftSE.point.y}] -> [${C.rightSE.point.x}, ${C.rightSE.point.y}] from queue.`)}if(u.size>w_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>sk)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const k=d.process(S);for(let C=0,L=k.length;C<L;C++){const z=k[C];z.consumedBy===void 0&&u.insert(z)}a=u.size,_=u.pop()}Bu.reset();const x=xd.factory(d.segments);return new rk(x).getGeom()}}const Oo=new ak,lk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("union",o,t)},ck=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("intersection",o,t)},uk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("xor",o,t)},hk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("difference",o,t)};var R0={union:lk,intersection:ck,xor:uk,difference:hk};function B0(o,e,t){if(o!==null)for(var n,l,u,d,a,_,x,S=0,k=0,C,L=o.type,z=L==="FeatureCollection",R=L==="Feature",D=z?o.features.length:1,B=0;B<D;B++){x=z?o.features[B].geometry:R?o.geometry:o,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,U=0;if(d=C?x.geometries[N]:x,d!==null){_=d.coordinates;var le=d.type;switch(S=0,le){case null:break;case"Point":if(e(_,k,B,V,U)===!1)return!1;k++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],k,B,V,U)===!1)return!1;k++,le==="MultiPoint"&&V++}le==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-S;l++){if(e(_[n][l],k,B,V,U)===!1)return!1;k++}le==="MultiLineString"&&V++,le==="Polygon"&&U++}le==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-S;u++){if(e(_[n][l][u],k,B,V,U)===!1)return!1;k++}U++}V++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(B0(d.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Up(o,e){var t,n,l,u,d,a,_,x,S,k,C=0,L=o.type==="FeatureCollection",z=o.type==="Feature",R=L?o.features.length:1;for(t=0;t<R;t++){for(a=L?o.features[t].geometry:z?o.geometry:o,x=L?o.features[t].properties:z?o.properties:{},S=L?o.features[t].bbox:z?o.bbox:void 0,k=L?o.features[t].id:z?o.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,x,S,k)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,x,S,k)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],C,x,S,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function dk(o,e){Up(o,function(t,n,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Du(t,l,{bbox:u,id:d}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var S=t.coordinates[x],k={type:_,coordinates:S};if(e(Du(k,l),n,x)===!1)return!1}})}function fk(o,e={}){const t=[];if(Up(o,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=R0.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?Np(n[0],e.properties):z0(n,e.properties)}var F0=fk;function pk(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return B0(o,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var x_=pk;function mk(o){const e=[];if(Up(o,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=o.features[0].properties||{},n=R0.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?Np(n[0],t):z0(n,t)}var gk=mk;function _k(o){if(!o)throw new Error("geojson is required");var e=[];return dk(o,function(t){e.push(t)}),Ru(e)}var yk=_k;function k_(o,e){const t=gk(Ru([Np([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),o]));if(!t)return;t.properties={isMask:!0};const n=vd(x_(o)),l=(n[2]-n[0])/360/1e3,u=n[0]<-180,d=n[2]>180,a=yk(o);if(a.features.length>1&&(u||d))for(const _ of a.features){const x=vd(x_(_));if(d&&x[0]<-180+l)for(const S of _.geometry.coordinates)for(const k of S)k[0]+=360-l;if(u&&x[2]>180-l)for(const S of _.geometry.coordinates)for(const k of S)k[0]-=360-l}e(Ru([a.features.length<2?o:F0(a)??o,t]))}const S_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},td="mtlr-gc-full-geom",T_="mtlr-gc-full-geom-fill",E_="mtlr-gc-full-geom-line";function O0(o,e,t=!0,n=!0,l={},u={},d=S_){let a;const _=[];let x,S,k;function C(){if(!o.loaded){o.once("load",C);return}const D=d?d===!0?S_:d:void 0;if(!(D!=null&&D.fill)&&!(D!=null&&D.line))return;const B=o.getSource(td);if(B)B.setData(k??Ru([]));else if(k)o.addSource(td,{type:"geojson",data:k});else return;!o.getLayer(T_)&&D!=null&&D.fill&&o.addLayer({...D==null?void 0:D.fill,id:T_,type:"fill",source:td}),!o.getLayer(E_)&&D!=null&&D.line&&o.addLayer({...D==null?void 0:D.line,id:E_,type:"line",source:td})}function L(D){k=D,C()}o.on("styledata",()=>{setTimeout(()=>{k&&C()})});const z=D=>{a==null||a({type:"mapClick",coordinates:[D.lngLat.lng,D.lngLat.lat]})};function R(D=!1){if(!e)throw new Error;const B=document.createElement("div");return D&&B.classList.add("marker-interactive"),new f2({props:{displayIn:"maplibre"},target:B}),new e.Marker({element:B,offset:[1,-13]})}return{setEventHandler(D){D?(a=D,o.on("click",z)):(a=void 0,o.off("click",z))},flyTo(D,B){o.flyTo({center:D,...B?{zoom:B}:{},...l})},fitBounds(D,B,N){o.fitBounds([[D[0],D[1]],[D[2],D[3]]],{padding:B,...N?{maxZoom:N}:{},...u})},indicateReverse(D){o.getCanvasContainer().style.cursor=D?"crosshair":""},setReverseMarker(D){!e||!t||(S?D?S.setLngLat(D):(S.remove(),S=void 0):D&&(t instanceof Function?S=t(o)??void 0:(S=(typeof t=="object"?new e.Marker(t):R()).setLngLat(D).addTo(o),S.getElement().classList.add("marker-reverse"))))},setFeatures(D,B,N){for(const V of _)V.remove();if(_.length=0,L(void 0),!!e){if(B){let V=!1;if(B.geometry.type==="GeometryCollection"){const U=B.geometry.geometries.filter(le=>le.type==="Polygon"||le.type==="MultiPolygon");e:if(U.length>0){const le=F0(Ru(U.map(oe=>Du(oe))));if(!le)break e;k_({...B,geometry:le.geometry},L),V=!0}else{const le=B.geometry.geometries.filter(oe=>oe.type==="LineString"||oe.type==="MultiLineString");le.length>0&&(L({...B,geometry:{type:"GeometryCollection",geometries:le}}),V=!0)}}if(!V){if(B.geometry.type==="Polygon"||B.geometry.type==="MultiPolygon")k_(B,L);else if(B.geometry.type==="LineString"||B.geometry.type==="MultiLineString"){L(B);return}}if(!N&&B.geometry.type!=="Point")return;if(t instanceof Function){const U=t(o,B);U&&_.push(U)}else t&&_.push(typeof t=="object"?new e.Marker(t):R().setLngLat(B.center).addTo(o))}if(n)for(const V of D??[]){if(V===B)continue;let U;if(n instanceof Function){if(U=n(o,V),!U)continue}else U=(typeof n=="object"?new e.Marker(n):R(!0)).setLngLat(V.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(V.place_type[0]==="reverse"?V.place_name:V.place_name.replace(/,.*/,""))).addTo(o);const le=U.getElement();le.addEventListener("click",oe=>{oe.stopPropagation(),a==null||a({type:"markerClick",id:V.id})}),le.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:V.id}),U.togglePopup()}),le.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:V.id}),U.togglePopup()}),_.push(U)}}},setSelectedMarker(D){x&&x.getElement().classList.toggle("marker-selected",!1),x=D>-1?_[D]:void 0,x==null||x.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const D=o.getCenter();return[o.getZoom(),D.lng,D.lat]}}}function bk(o,e,t){var n,l;class u{constructor(D,B){uo(this,"type"),uo(this,"target"),this.type=B,this.target=D}}class d extends u{constructor(D,B){super(D,"select"),uo(this,"feature"),Object.assign(this,B)}}class a extends u{constructor(D,B){super(D,"featureslisted"),uo(this,"features"),this.features=B}}class _ extends u{constructor(D,B){super(D,"featuresmarked"),uo(this,"features"),this.features=B}}class x extends u{constructor(D,B){super(D,"optionsvisibilitychange"),uo(this,"optionsVisible"),this.optionsVisible=B}}class S extends u{constructor(D,B){super(D,"pick"),uo(this,"feature"),this.feature=B}}class k extends u{constructor(D,B){super(D,"querychange"),uo(this,"query"),this.query=B}}class C extends u{constructor(D,B,N){super(D,"response"),uo(this,"url"),uo(this,"featureCollection"),this.url=B,this.featureCollection=N}}class L extends u{constructor(D,B){super(D,"reversetoggle"),uo(this,"reverse"),this.reverse=B}}class z extends o{constructor(D={}){super(),qg(this,n),qg(this,l),Zg(this,l,D)}onAddInt(D){const B=document.createElement("div");B.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:N,showResultMarkers:V,flyTo:U,fullGeometryStyle:le,...oe}=er(this,l),H=typeof U=="boolean"?{}:U,ee={mapController:O0(D,e,N,V,H,H,le),flyTo:U===void 0?!0:!!U,apiKey:"",...t==null?void 0:t(D,B),...oe};if(!ee.apiKey)throw new Error("no apiKey provided");return Zg(this,n,new F2({target:B,props:ee})),er(this,n).$on("select",be=>{this.fire(new d(this,be.detail))}),er(this,n).$on("pick",be=>{this.fire(new S(this,be.detail.feature))}),er(this,n).$on("featureslisted",be=>{this.fire(new a(this,be.detail.features))}),er(this,n).$on("featuresmarked",be=>{this.fire(new _(this,be.detail.features))}),er(this,n).$on("response",be=>{this.fire(new C(this,be.detail.url,be.detail.featureCollection))}),er(this,n).$on("optionsvisibilitychange",be=>{this.fire(new x(this,be.detail.optionsVisible))}),er(this,n).$on("reversetoggle",be=>{this.fire(new L(this,be.detail.reverse))}),er(this,n).$on("querychange",be=>{this.fire(new k(this,be.detail.query))}),B}on(D,B){return super.on(D,B)}once(D,B){return super.once(D,B)}off(D,B){return super.off(D,B)}listens(D){return super.listens(D)}setOptions(D){var B;Object.assign(er(this,l),D);const{marker:N,showResultMarkers:V,flyTo:U,fullGeometryStyle:le,...oe}=er(this,l);(B=er(this,n))==null||B.$set(oe)}setQuery(D,B=!0){var N;(N=er(this,n))==null||N.setQuery(D,B)}clearMap(){var D;(D=er(this,n))==null||D.clearMap()}clearList(){var D;(D=er(this,n))==null||D.clearList()}setReverseMode(D){var B;(B=er(this,n))==null||B.$set({reverseActive:D})}focus(){var D;(D=er(this,n))==null||D.focus()}blur(){var D;(D=er(this,n))==null||D.blur()}onRemove(){var D;(D=er(this,n))==null||D.$destroy()}}return n=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:z,events:{SelectEvent:d,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:x,PickEvent:S,QueryChangeEvent:k,ResponseEvent:C,ReverseToggleEvent:L}}}const{MapLibreBasedGeocodingControl:_C,events:sa}=bk(Ts.Evented,pv);sa.SelectEvent;sa.FeaturesListedEvent;sa.FeaturesMarkedEvent;sa.OptionsVisibilityChangeEvent;sa.PickEvent;sa.QueryChangeEvent;sa.ResponseEvent;sa.ReverseToggleEvent;function vk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Te(e,"viewBox","0 0 14 14"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"class","svelte-en2qvf")},m(n,l){he(n,e,l),Q(e,t)},p:Dt,i:Dt,o:Dt,d(n){n&&ue(e)}}}class N0 extends Gt{constructor(e){super(),Zt(this,e,null,vk,Ft,{})}}function wk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Te(e,"viewBox","0 0 30 30"),Te(e,"fill","none"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"class","svelte-d2loi5")},m(n,l){he(n,e,l),Q(e,t)},p:Dt,i:Dt,o:Dt,d(n){n&&ue(e)}}}class j0 extends Gt{constructor(e){super(),Zt(this,e,null,wk,Ft,{})}}function xk(o){let e,t;return{c(){e=ce("img"),En(e.src,t=o[3]+"area.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"area.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function kk(o){let e,t;return{c(){e=ce("img"),En(e.src,t=o[3]+"reverse.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"reverse.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Sk(o){let e,t;return{c(){e=ce("img"),En(e.src,t=o[3]+"poi.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"poi.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Tk(o){let e,t;return{c(){e=ce("img"),En(e.src,t=o[3]+"postal_code.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"postal_code.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Ek(o){let e,t;return{c(){e=ce("img"),En(e.src,t=o[3]+"street.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"street.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Ck(o){let e,t;return{c(){e=ce("img"),En(e.src,t=o[3]+"road.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"road.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Mk(o){let e,t;return{c(){e=ce("img"),En(e.src,t=o[3]+"housenumber.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){he(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"housenumber.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&ue(e)}}}function Ik(o){let e,t,n,l;return{c(){e=ce("img"),En(e.src,t=o[5])||Te(e,"src",t),Te(e,"alt",o[4]),Te(e,"class","svelte-ltkwvy")},m(u,d){he(u,e,d),n||(l=Et(e,"error",o[14]),n=!0)},p(u,d){d&32&&!En(e.src,t=u[5])&&Te(e,"src",t),d&16&&Te(e,"alt",u[4])},d(u){u&&ue(e),n=!1,l()}}}function C_(o){let e,t;return{c(){e=ce("span"),t=Qe(o[6]),Te(e,"class","secondary svelte-ltkwvy")},m(n,l){he(n,e,l),Q(e,t)},p(n,l){l&64&&Mi(t,n[6])},d(n){n&&ue(e)}}}function Lk(o){let e,t,n,l,u,d,a,_,x,S=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",k,C,L=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],z,R,D=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,V;function U(ee,be){return be&1&&(t=null),be&1&&(n=null),be&1&&(l=null),be&1&&(u=null),ee[5]?Ik:ee[0].address?Mk:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?Ck:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?Ek:(l==null&&(l=!!ee[0].id.startsWith("postal_code.")),l?Tk:(u==null&&(u=!!ee[0].id.startsWith("poi.")),u?Sk:ee[7]?kk:xk))))}let le=U(o,-1),oe=le(o),H=L&&C_(o);return{c(){e=ce("li"),oe.c(),d=Re(),a=ce("span"),_=ce("span"),x=ce("span"),k=Qe(S),C=Re(),H&&H.c(),z=Re(),R=ce("span"),B=Qe(D),Te(x,"class","primary svelte-ltkwvy"),Te(_,"class","svelte-ltkwvy"),Te(R,"class","line2 svelte-ltkwvy"),Te(a,"class","texts svelte-ltkwvy"),Te(e,"tabindex","0"),Te(e,"data-selected",o[1]),Te(e,"class","svelte-ltkwvy"),cr(e,"selected",o[1])},m(ee,be){he(ee,e,be),oe.m(e,null),Q(e,d),Q(e,a),Q(a,_),Q(_,x),Q(x,k),Q(_,C),H&&H.m(_,null),Q(a,z),Q(a,R),Q(R,B),N||(V=[Et(e,"mouseenter",o[12]),Et(e,"focus",o[13])],N=!0)},p(ee,[be]){le===(le=U(ee,be))&&oe?oe.p(ee,be):(oe.d(1),oe=le(ee),oe&&(oe.c(),oe.m(e,d))),be&1&&S!==(S=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&Mi(k,S),be&37&&(L=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),L?H?H.p(ee,be):(H=C_(ee),H.c(),H.m(_,null)):H&&(H.d(1),H=null),be&1&&D!==(D=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Mi(B,D),be&2&&Te(e,"data-selected",ee[1]),be&2&&cr(e,"selected",ee[1])},i:Dt,o:Dt,d(ee){ee&&ue(e),oe.d(),H&&H.d(),N=!1,ln(V)}}}function Ak(o,e,t){var V;let n,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:x}=e;const S=(V=u.properties)==null?void 0:V.categories;let k,C,L=0,z=u.place_type[0]==="reverse";function R(){C&&_.add(C),t(10,L++,L)}function D(U){ui.call(this,o,U)}function B(U){ui.call(this,o,U)}const N=()=>R();return o.$$set=U=>{"feature"in U&&t(0,u=U.feature),"selected"in U&&t(1,d=U.selected),"showPlaceType"in U&&t(2,a=U.showPlaceType),"missingIconsCache"in U&&t(9,_=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,x=U.iconsBaseUrl)},o.$$.update=()=>{var U,le,oe,H;if(o.$$.dirty&3640)do t(11,n--,n),t(4,k=S==null?void 0:S[n]),t(5,C=k?x+k.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!C||_.has(C)));o.$$.dirty&1&&t(6,l=((le=(U=u.properties)==null?void 0:U.categories)==null?void 0:le.join(", "))??((H=(oe=u.properties)==null?void 0:oe.place_type_name)==null?void 0:H[0])??u.place_type[0])},t(11,n=(S==null?void 0:S.length)??0),[u,d,a,x,k,C,l,z,R,_,L,n,D,B,N]}class Pk extends Gt{constructor(e){super(),Zt(this,e,Ak,Lk,Ft,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function zk(o){let e;return{c(){e=ce("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Te(e,"class","svelte-7cmwmc")},m(t,n){he(t,e,n)},p:Dt,i:Dt,o:Dt,d(t){t&&ue(e)}}}class Dk extends Gt{constructor(e){super(),Zt(this,e,null,zk,Ft,{})}}function Rk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Te(e,"viewBox","0 0 60.006 21.412"),Te(e,"width","14"),Te(e,"height","20"),Te(e,"class","svelte-en2qvf")},m(n,l){he(n,e,l),Q(e,t)},p:Dt,i:Dt,o:Dt,d(n){n&&ue(e)}}}class Bk extends Gt{constructor(e){super(),Zt(this,e,null,Rk,Ft,{})}}function Fk(o){let e,t,n;return{c(){e=xs("svg"),t=xs("circle"),n=xs("path"),Te(t,"cx","4.789"),Te(t,"cy","4.787"),Te(t,"r","3.85"),Te(t,"class","svelte-1aq105l"),Te(n,"d","M12.063 12.063 7.635 7.635"),Te(n,"class","svelte-1aq105l"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"viewBox","0 0 13 13"),Te(e,"class","svelte-1aq105l")},m(l,u){he(l,e,u),Q(e,t),Q(e,n)},p:Dt,i:Dt,o:Dt,d(l){l&&ue(e)}}}class Ok extends Gt{constructor(e){super(),Zt(this,e,null,Fk,Ft,{})}}function Nk(o,e,t){const n=e[1],l=e[0],u=n-l;return o===n&&t?o:((o-l)%u+u)%u+l}function M_(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let cu;async function jk(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(cu&&l.cachedLocationExpiry&&cu.time+l.cachedLocationExpiry>Date.now()){if(!cu.coords)break e;return cu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(cu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const Uk=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,I_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,L_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,A_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,P_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,z_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function Vk(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(L=>Number(L.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),d=t>0?"N":"S",a=n>0?"E":"W";let _;o=="DD"&&(_=`${l}° ${d}, ${u}° ${a}`);const x=Math.floor(l),S=Math.floor(u),k=(l-x)*60,C=(u-S)*60;if(o=="DM"){let L=D_(k,3).toFixed(3).padStart(6,"0"),z=D_(C,3).toFixed(3).padStart(6,"0");L.endsWith(".000")&&z.endsWith(".000")&&(L=L.replace(/\.000$/,""),z=z.replace(/\.000$/,"")),_=`${x}° ${L}' ${d}, ${S}° ${z}' ${a}`}if(o=="DMS"){const L=Math.floor(k),z=Math.floor(C);let R=((k-L)*60).toFixed(1).padStart(4,"0"),D=((C-z)*60).toFixed(1).padStart(4,"0");const B=L.toString().padStart(2,"0"),N=z.toString().padStart(2,"0");R.endsWith(".0")&&D.endsWith(".0")&&(R=R.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),_=`${x}° ${B}' ${R}" ${d}, ${S}° ${N}' ${D}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function D_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Vp(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",d=null,a=[],_=!1;if(Uk.test(o))throw new Error("invalid coordinate value");if(I_.test(o))if(a=I_.exec(o),_=uu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),d="DM";else throw new Error("invalid coordinate format");else if(L_.test(o))if(a=L_.exec(o),_=uu(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(A_.test(o))if(a=A_.exec(o),_=uu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(P_.test(o))if(a=P_.exec(o),_=uu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(z_.test(o)){if(a=z_.exec(o),_=uu(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(l)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const S=a[0].trim();let k,C;const L=/[,/;\u0020]/g,z=S.match(L);if(z==null){const B=Math.floor(o.length/2);k=S.substring(0,B).trim(),C=S.substring(B).trim()}else{let B;z.length%2==1?B=Math.floor(z.length/2):B=z.length/2-1;let N=0;if(B==0)N=S.indexOf(z[0]),k=S.substring(0,N).trim(),C=S.substring(N+1).trim();else{let V=0,U=0;for(;V<=B;)N=S.indexOf(z[V],U),U=N+1,V++;k=S.substring(0,N).trim(),C=S.substring(N+1).trim()}}const R=k.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const D=C.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(k)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:S,verbatimLatitude:k,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:d,closeEnough:qk,toCoordinateFormat:Vk})}else throw new Error("coordinates pattern match failed")}function uu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),x=n.test(d)&&n.test(a),S=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||x||S)continue;return!1}}return!0}function R_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function qk(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return R_(this.decimalLatitude,Number(e[0]))&&R_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Zk=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Vp.to=Zk;const Gk=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Wk={decimalLatitude:40.123,decimalLongitude:-74.123},$k=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],Hk=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Xk(){const o=[];return Gk.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...Wk})}),[...o,...$k,...Hk]}const Kk=Xk();Vp.formats=Kk.map(o=>o.verbatimCoordinates);const Jk=Vp;function B_(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function F_(o){let e,t;return e=new Dk({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function O_(o){let e,t,n,l,u;return t=new Bk({}),{c(){e=ce("button"),Pe(t.$$.fragment),Te(e,"type","button"),Te(e,"title",o[9]),Te(e,"class","svelte-bz0zu3"),cr(e,"active",o[0])},m(d,a){he(d,e,a),Le(t,e,null),n=!0,l||(u=Et(e,"click",o[69]),l=!0)},p(d,a){(!n||a[0]&512)&&Te(e,"title",d[9]),(!n||a[0]&1)&&cr(e,"active",d[0])},i(d){n||(ie(t.$$.fragment,d),n=!0)},o(d){re(t.$$.fragment,d),n=!1},d(d){d&&ue(e),Ae(t),l=!1,u()}}}function Yk(o){let e,t=[],n=new Map,l,u,d,a=Jn(o[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let S=B_(o,a,x),k=_(S);n.set(k,t[x]=N_(k,S))}return{c(){e=ce("ul");for(let x=0;x<t.length;x+=1)t[x].c();Te(e,"class","options svelte-bz0zu3")},m(x,S){he(x,e,S);for(let k=0;k<t.length;k+=1)t[k]&&t[k].m(e,null);l=!0,u||(d=[Et(e,"mouseleave",o[73]),Et(e,"blur",o[74])],u=!0)},p(x,S){S[0]&17880064&&(a=Jn(x[14]),_i(),t=iv(t,S,_,1,x,a,n,e,tv,N_,null,B_),yi())},i(x){if(!l){for(let S=0;S<a.length;S+=1)ie(t[S]);l=!0}},o(x){for(let S=0;S<t.length;S+=1)re(t[S]);l=!1},d(x){x&&ue(e);for(let S=0;S<t.length;S+=1)t[S].d();u=!1,ln(d)}}}function Qk(o){let e,t,n,l,u,d;return t=new j0({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("div"),u=Qe(o[7]),Te(l,"class","svelte-bz0zu3"),Te(e,"class","no-results svelte-bz0zu3")},m(a,_){he(a,e,_),Le(t,e,null),Q(e,n),Q(e,l),Q(l,u),d=!0},p(a,_){(!d||_[0]&128)&&Mi(u,a[7])},i(a){d||(ie(t.$$.fragment,a),d=!0)},o(a){re(t.$$.fragment,a),d=!1},d(a){a&&ue(e),Ae(t)}}}function eS(o){let e="",t;return{c(){t=Qe(e)},m(n,l){he(n,t,l)},p:Dt,i:Dt,o:Dt,d(n){n&&ue(t)}}}function tS(o){let e,t,n,l,u,d,a,_,x,S,k;return t=new j0({}),_=new N0({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("div"),u=Qe(o[6]),d=Re(),a=ce("button"),Pe(_.$$.fragment),Te(l,"class","svelte-bz0zu3"),Te(a,"class","svelte-bz0zu3"),Te(e,"class","error svelte-bz0zu3")},m(C,L){he(C,e,L),Le(t,e,null),Q(e,n),Q(e,l),Q(l,u),Q(e,d),Q(e,a),Le(_,a,null),x=!0,S||(k=Et(a,"click",o[70]),S=!0)},p(C,L){(!x||L[0]&64)&&Mi(u,C[6])},i(C){x||(ie(t.$$.fragment,C),ie(_.$$.fragment,C),x=!0)},o(C){re(t.$$.fragment,C),re(_.$$.fragment,C),x=!1},d(C){C&&ue(e),Ae(t),Ae(_),S=!1,k()}}}function N_(o,e){let t,n,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return n=new Pk({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",d),{key:o,first:null,c(){t=Fn(),Pe(n.$$.fragment),this.first=t},m(a,_){he(a,t,_),Le(n,a,_),l=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){l||(ie(n.$$.fragment,a),l=!0)},o(a){re(n.$$.fragment,a),l=!1},d(a){a&&ue(t),Ae(n,a)}}}function iS(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B,N,V,U,le,oe=!1;u=new Ok({}),k=new N0({});let H=o[19]&&F_(),ee=o[5]==="button"&&O_(o);const be=o[61].default,Oe=Ni(be,o,o[60],null),ne=[tS,eS,Qk,Yk],ye=[];function Ke(Ce,et){var vt,pt;return Ce[18]?0:Ce[16]?((vt=Ce[14])==null?void 0:vt.length)===0?2:Ce[16]&&((pt=Ce[14])!=null&&pt.length)?3:-1:1}return~(D=Ke(o))&&(B=ye[D]=ne[D](o)),{c(){e=Re(),t=ce("form"),n=ce("div"),l=ce("button"),Pe(u.$$.fragment),d=Re(),a=ce("input"),_=Re(),x=ce("div"),S=ce("button"),Pe(k.$$.fragment),C=Re(),H&&H.c(),L=Re(),ee&&ee.c(),z=Re(),Oe&&Oe.c(),R=Re(),B&&B.c(),Te(l,"class","search-button svelte-bz0zu3"),Te(l,"type","button"),Te(a,"placeholder",o[8]),Te(a,"aria-label",o[8]),Te(a,"class","svelte-bz0zu3"),Te(S,"type","button"),Te(S,"title",o[3]),Te(S,"class","svelte-bz0zu3"),Te(x,"class","clear-button-container svelte-bz0zu3"),cr(x,"displayable",o[1]!==""),Te(n,"class","input-group svelte-bz0zu3"),Te(t,"tabindex","0"),Te(t,"class",N=fd(o[2])+" svelte-bz0zu3"),cr(t,"can-collapse",o[4]&&o[1]==="")},m(Ce,et){he(Ce,e,et),he(Ce,t,et),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),o[63](a),Hn(a,o[1]),Q(n,_),Q(n,x),Q(x,S),Le(k,S,null),Q(x,C),H&&H.m(x,null),Q(n,L),ee&&ee.m(n,null),Q(n,z),Oe&&Oe.m(n,null),Q(t,R),~D&&ye[D].m(t,null),V=!0,U||(le=[Et(l,"click",o[62]),Et(a,"input",o[64]),Et(a,"focus",o[65]),Et(a,"blur",o[66]),Et(a,"keydown",o[22]),Et(a,"input",o[67]),Et(S,"click",o[68]),Et(t,"submit",xp(o[21]))],U=!0)},p(Ce,et){(!V||et[0]&256)&&Te(a,"placeholder",Ce[8]),(!V||et[0]&256)&&Te(a,"aria-label",Ce[8]),et[0]&2&&a.value!==Ce[1]&&Hn(a,Ce[1]),(!V||et[0]&8)&&Te(S,"title",Ce[3]),Ce[19]?H?et[0]&524288&&ie(H,1):(H=F_(),H.c(),ie(H,1),H.m(x,null)):H&&(_i(),re(H,1,1,()=>{H=null}),yi()),(!V||et[0]&2)&&cr(x,"displayable",Ce[1]!==""),Ce[5]==="button"?ee?(ee.p(Ce,et),et[0]&32&&ie(ee,1)):(ee=O_(Ce),ee.c(),ie(ee,1),ee.m(n,z)):ee&&(_i(),re(ee,1,1,()=>{ee=null}),yi()),Oe&&Oe.p&&(!V||et[1]&536870912)&&Ui(Oe,be,Ce,Ce[60],V?ji(be,Ce[60],et,null):Vi(Ce[60]),null);let vt=D;D=Ke(Ce),D===vt?~D&&ye[D].p(Ce,et):(B&&(_i(),re(ye[vt],1,1,()=>{ye[vt]=null}),yi()),~D?(B=ye[D],B?B.p(Ce,et):(B=ye[D]=ne[D](Ce),B.c()),ie(B,1),B.m(t,null)):B=null),(!V||et[0]&4&&N!==(N=fd(Ce[2])+" svelte-bz0zu3"))&&Te(t,"class",N),(!V||et[0]&22)&&cr(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){V||(ie(oe),ie(u.$$.fragment,Ce),ie(k.$$.fragment,Ce),ie(H),ie(ee),ie(Oe,Ce),ie(B),V=!0)},o(Ce){re(oe),re(u.$$.fragment,Ce),re(k.$$.fragment,Ce),re(H),re(ee),re(Oe,Ce),re(B),V=!1},d(Ce){Ce&&(ue(e),ue(t)),Ae(u),o[63](null),Ae(k),H&&H.d(),ee&&ee.d(),Oe&&Oe.d(Ce),~D&&ye[D].d(),U=!1,ln(le)}}}function nS(o,e,t){let n,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:S=void 0}=e,{clearButtonTitle:k="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:L=!1}=e,{country:z=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:D="never"}=e,{errorMessage:B="Something went wrong…"}=e,{filter:N=()=>!0}=e,{flyTo:V=!0}=e,{fuzzyMatch:U=!0}=e,{language:le=void 0}=e,{limit:oe=void 0}=e,{mapController:H=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:be="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Oe="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:ye=D==="always"}=e,{reverseButtonTitle:Ke="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:vt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:st=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:ii=!0}=e,{types:Ot=void 0}=e,{exhaustiveReverseGeocoding:Pt=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Mt=a}=e,{apiUrl:ei="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Vt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:xi=()=>{}}=e;function gi(){Ve.focus()}function Pi(){Ve.blur()}function ct(G,Ue=!0,qe=!1){t(1,Ce=G),Ue?(t(15,$e=-1),ut()):(Yt(!qe,qe),setTimeout(()=>{Ve.focus(),Ve.select()}))}function It(){t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1)}function Ne(){t(55,xt=[]),t(56,we=void 0)}let je=!1,rt,xt,we,di="",Ve,$e=-1,kt,vn=[],wn,Cn,ir,nr;const Uo=new Set,Ji=ts();tr(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function ut(G){if(Cn&&(clearTimeout(Cn),Cn=void 0),$e>-1&&rt)t(56,we=rt[$e]),t(1,Ce=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,kt=void 0),t(55,xt=void 0),t(15,$e=-1);else if(Ce){const Ue=G||!Xn(Ce);xn(Ce,{exact:!0}).then(()=>{t(55,xt=rt),t(56,we=void 0),Ue&&Lo()}).catch(qe=>t(18,kt=qe))}}function Xn(G){try{return Jk(G,6)}catch{return!1}}async function xn(G,{byId:Ue=!1,exact:qe=!1}={}){t(18,kt=void 0),wn==null||wn.abort();const Ge=new AbortController;t(19,wn=Ge);try{const Je=Xn(G),ht=new URLSearchParams;if(le!==void 0&&ht.set("language",Array.isArray(le)?le.join(","):le??""),Ot&&ht.set("types",Ot.join(",")),Jt&&ht.set("excludeTypes",String(Jt)),S&&ht.set("bbox",S.map(bi=>bi.toFixed(6)).join(",")),z&&ht.set("country",Array.isArray(z)?z.join(","):z),!Ue&&!Je){const bi=await jk(H,ne,Ge);bi&&ht.set("proximity",bi),(qe||!pt)&&ht.set("autocomplete","false"),ht.set("fuzzyMatch",String(U))}oe!==void 0&&(Pt||!Je||(Ot==null?void 0:Ot.length)===1)&&ht.set("limit",String(oe)),ht.set("key",x),xi(ht);const Rt=ei+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:G)+".json?"+ht.toString();if(Rt===di){Ue?(t(14,rt=void 0),t(56,we=vn[0])):t(14,rt=vn);return}di=Rt;const Xt=await fetch(Rt,{signal:Ge.signal,...Vt});if(!Xt.ok)throw new Error(await Xt.text());const ai=await Xt.json();Ji("response",{url:Rt,featureCollection:ai}),Ue?(t(14,rt=void 0),t(56,we=ai.features[0]),vn=[we]):(t(14,rt=ai.features.filter(N)),Je&&rt.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),vn=rt,Je&&Ve.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{Ge===wn&&t(19,wn=void 0)}}function Lo(){var Ge;if(!(xt!=null&&xt.length)||!V)return;const G=[180,90,-180,-90],Ue=!xt.some(Je=>!Je.matching_text);let qe;for(const Je of xt){const ht=qi(Je);if(qe=qe===void 0?ht:ht===void 0?qe:Math.max(qe,ht),Ue||!Je.matching_text)for(const Rt of[0,1,2,3])G[Rt]=Math[Rt<2?"min":"max"](G[Rt],((Ge=Je.bbox)==null?void 0:Ge[Rt])??Je.center[Rt%2])}H&&xt.length>0&&(we&&G[0]===G[2]&&G[1]===G[3]?H.flyTo(we.center,qi(we)):H.fitBounds(M_(G),50,qe))}function qi(G){var qe;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Ue=G.id.replace(/\..*/,"");return(Array.isArray((qe=G.properties)==null?void 0:qe.categories)?G.properties.categories.reduce((Ge,Je)=>{const ht=Mt[Ue+"."+Je];return Ge===void 0?ht:ht===void 0?Ge:Math.max(Ge,ht)},void 0):void 0)??Mt[Ue]}function gt(G){t(0,ye=D==="always"),t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1),ct(G[1].toFixed(6)+", "+Nk(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ni(G){if(!rt)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&($e===(st?0:-1)&&Ue===-1&&t(15,$e=rt.length),t(15,$e+=Ue),$e>=rt.length&&t(15,$e=-1),$e<0&&st&&t(15,$e=0),G.preventDefault())}function Yt(G=!0,Ue=!1){if(t(18,kt=void 0),pt||Ue){if(Cn&&clearTimeout(Cn),Ce.length<ee)return;const qe=Ce;Cn=window.setTimeout(()=>{xn(qe).catch(Ge=>t(18,kt=Ge))},G?R:0)}else t(14,rt=void 0),t(18,kt=void 0)}function Zi(G){t(56,we=G),t(1,Ce=G.place_name),t(15,$e=-1)}const yr=()=>Ve.focus();function ti(G){Ki[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function eo(){Ce=this.value,t(1,Ce),t(13,je),t(28,C)}const cn=()=>t(13,je=!0),me=()=>t(13,je=!1),W=()=>Yt(),X=()=>{t(1,Ce=""),Ve.focus()},te=()=>t(0,ye=!ye),de=()=>t(18,kt=void 0),Me=G=>t(15,$e=G),Ie=G=>Zi(G),Be=()=>{st||t(15,$e=-1)},ke=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,x=G.apiKey),"bbox"in G&&t(27,S=G.bbox),"clearButtonTitle"in G&&t(3,k=G.clearButtonTitle),"clearOnBlur"in G&&t(28,C=G.clearOnBlur),"collapsed"in G&&t(4,L=G.collapsed),"country"in G&&t(29,z=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,D=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,V=G.flyTo),"fuzzyMatch"in G&&t(33,U=G.fuzzyMatch),"language"in G&&t(34,le=G.language),"limit"in G&&t(35,oe=G.limit),"mapController"in G&&t(36,H=G.mapController),"minLength"in G&&t(37,ee=G.minLength),"noResultsMessage"in G&&t(7,be=G.noResultsMessage),"placeholder"in G&&t(8,Oe=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,ye=G.reverseActive),"reverseButtonTitle"in G&&t(9,Ke=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,vt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,st=G.selectFirst),"flyToSelected"in G&&t(41,Ht=G.flyToSelected),"markerOnSelected"in G&&t(42,ii=G.markerOnSelected),"types"in G&&t(43,Ot=G.types),"exhaustiveReverseGeocoding"in G&&t(44,Pt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Mt=G.zoom),"apiUrl"in G&&t(47,ei=G.apiUrl),"fetchParameters"in G&&t(48,Vt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,xi=G.adjustUrlQuery),"$$scope"in G&&t(60,d=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ye=D==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ir=je),C&&!je&&t(1,Ce="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ce.length<ee&&(t(56,we=void 0),t(14,rt=void 0),t(18,kt=void 0),t(55,xt=rt)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&xn(we.id,{byId:!0}).catch(G=>t(18,kt=G)),o.$$.dirty[1]&100663330&&(H&&we&&we.id!==nr&&V&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?H.flyTo(we.center,qi(we)):H.fitBounds(M_(we.bbox),50,qi(we)),t(14,rt=void 0),t(55,xt=void 0),t(15,$e=-1)),t(57,nr=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&st&&rt!=null&&rt.length&&t(15,$e=0),o.$$.dirty[0]&2&&t(15,$e=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&xt!==rt&&t(55,xt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&H&&H.setEventHandler(G=>{switch(G.type){case"mapClick":ye&&gt(G.coordinates);break;case"markerClick":{const Ue=rt==null?void 0:rt.find(qe=>qe.id===G.id);Ue&&Zi(Ue)}break;case"markerMouseEnter":xt&&t(15,$e=ir?(rt==null?void 0:rt.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,$e=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=rt==null?void 0:rt[$e]),o.$$.dirty[1]&134218786&&H&&l&&V&&Ht&&H.flyTo(l.center,qi(l)),o.$$.dirty[1]&256&&t(59,n=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ii||H==null||H.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&H&&ii&&!xt&&(H.setFeatures(l?[l]:void 0,void 0,n),H.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&H&&H.setFeatures(xt,we,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&xt&&H&&H.setSelectedMarker($e),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&H){const G=Xn(Ce);H.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ji("select",{feature:l}),o.$$.dirty[1]&33554432&&Ji("pick",{feature:we}),o.$$.dirty[0]&81920&&Ji("optionsvisibilitychange",{optionsVisible:ir&&!!rt}),o.$$.dirty[0]&16384&&Ji("featureslisted",{features:rt}),o.$$.dirty[1]&16777216&&Ji("featuresmarked",{features:xt}),o.$$.dirty[0]&1&&Ji("reversetoggle",{reverse:ye}),o.$$.dirty[0]&2&&Ji("querychange",{query:Ce}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&H&&H.indicateReverse(ye)},[ye,Ce,_,k,L,D,B,be,Oe,Ke,vt,st,hi,je,rt,$e,ir,Ve,kt,wn,Uo,ut,ni,Yt,Zi,a,x,S,C,z,R,N,V,U,le,oe,H,ee,ne,et,pt,Ht,ii,Ot,Pt,Jt,Mt,ei,Vt,xi,gi,Pi,ct,It,Ne,xt,we,nr,l,n,d,u,yr,ti,eo,cn,me,W,X,te,de,Me,Ie,Be,ke]}class rS extends Gt{constructor(e){super(),Zt(this,e,nS,iS,Ft,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function j_(o){let e,t,n;return t=new rS({props:{mapController:o[2],apiKey:o[0],country:o[1],types:o[3],proximity:[{type:"map-center"}]}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"class","svelte-ixhnie")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const d={};u&4&&(d.mapController=l[2]),u&1&&(d.apiKey=l[0]),u&2&&(d.country=l[1]),t.$set(d)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function oS(o){let e,t,n=o[2]&&j_(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[2]?n?(n.p(l,u),u&4&&ie(n,1)):(n=j_(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function sS(o,e,t){let n,{apiKey:l}=e,{map:u}=e,{country:d}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(x){return x?O0(x,Qr,!0,!0,{duration:1e3},{duration:1e3}):null}return o.$$set=x=>{"apiKey"in x&&t(0,l=x.apiKey),"map"in x&&t(4,u=x.map),"country"in x&&t(1,d=x.country)},o.$$.update=()=>{o.$$.dirty&16&&t(2,n=_(u))},[l,d,n,a,u]}class aS extends Gt{constructor(e){super(),Zt(this,e,sS,oS,Ft,{apiKey:0,map:4,country:1})}}const lS=Symbol.for("svelte-maplibre");function cS(){return Ep(lS)}function uS(o){return"layerType"in o&&o.layerType==="deckgl"}const hS=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),U_=o=>{var e;return{features:o[4],data:(e=o[4])==null?void 0:e[0],map:o[2],close:o[31]}};function V_(o){let e,t,n=(o[4]||o[3]instanceof Qr.Marker)&&q_(o);return{c(){e=ce("div"),n&&n.c()},m(l,u){he(l,e,u),n&&n.m(e,null),o[32](e),t=!0},p(l,u){l[4]||l[3]instanceof Qr.Marker?n?(n.p(l,u),u[0]&24&&ie(n,1)):(n=q_(l),n.c(),ie(n,1),n.m(e,null)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(),o[32](null)}}}function q_(o){let e;const t=o[30].default,n=Ni(t,o,o[29],U_);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[0]&536870933)&&Ui(n,t,l,l[29],e?ji(t,l[29],u,hS):Vi(l[29]),U_)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function dS(o){let e,t,n=o[9].default&&V_(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[9].default?n?(n.p(l,u),u[0]&512&&ie(n,1)):(n=V_(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function fS(o,e,t){let n,l,u,d,a,_,{$$slots:x={},$$scope:S}=e;const k=Kb(x);let{closeButton:C=void 0}=e,{closeOnClickOutside:L=!0}=e,{closeOnClickInside:z=!1}=e,{closeOnMove:R=!1}=e,{openOn:D="click"}=e,{openIfTopMost:B=!0}=e,{focusAfterOpen:N=!0}=e,{anchor:V=void 0}=e,{offset:U=void 0}=e,{popupClass:le=void 0}=e,{maxWidth:oe=void 0}=e,{lngLat:H=void 0}=e,{html:ee=void 0}=e,{open:be=!1}=e;const Oe=ts(),{map:ne,popupTarget:ye,layerEvent:Ke,layer:Ce,eventTopMost:et}=cS();dt(o,ne,je=>t(2,u=je)),dt(o,ye,je=>t(3,a=je)),dt(o,Ke,je=>t(28,d=je)),dt(o,Ce,je=>t(35,_=je));const vt=["click","dblclick","contextmenu"];let pt,st=!1,Ht;function ii(){if(!pt)return;let je=pt.getElement();!je||je===Ht||(Ht=je,D==="hover"&&(Ht.style.pointerEvents="none"),Ht.addEventListener("mouseenter",()=>{t(24,st=!0)},{passive:!0}),Ht.addEventListener("mouseleave",()=>{t(24,st=!1)},{passive:!0}),Ht.addEventListener("click",()=>{z&&t(0,be=!1)},{passive:!0}))}Sd(()=>{if(u)return u.on("click",Pi),u.on("contextmenu",Pi),typeof a=="string"&&(u.on("click",a,Mt),u.on("dblclick",a,Mt),u.on("contextmenu",a,Mt),u.on("mousemove",a,gi),u.on("mouseleave",a,xi),u.on("touchstart",a,Vt),u.on("touchend",a,hi)),()=>{u!=null&&u.loaded()&&(pt==null||pt.remove(),u.off("click",Pi),u.off("contextmenu",Pi),a instanceof Qr.Marker?a.getPopup()===pt&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Mt),u.off("dblclick",a,Mt),u.off("contextmenu",a,Mt),u.off("mousemove",a,gi),u.off("mouseleave",a,xi),u.off("touchstart",a,Vt),u.off("touchend",a,hi)))}});function Ot(je){return B?!("marker"in je)&&!uS(je)&&et(je)!==_:!1}let Pt=null,Jt="normal";function Mt(je){je.type===D&&(Ot(je)||("layerType"in je?je.layerType==="deckgl"?(t(10,H=je.coordinate),t(4,Pt=je.object?[je.object]:null)):(t(10,H=je.lngLat),t(4,Pt=je.features??[])):(t(10,H=je.lngLat),t(4,Pt=je.features??[])),setTimeout(()=>t(0,be=!0))))}let ei=null;function Vt(je){ei=je.point}function hi(je){if(!ei||D!=="hover")return;let rt=ei.dist(je.point);ei=null,rt<3&&(t(10,H=je.lngLat),t(4,Pt=je.features??[]),pt.isOpen()?t(25,Jt="justOpened"):(t(25,Jt="opening"),t(0,be=!0)))}function xi(je){D!=="hover"||ei||Jt!=="normal"||(t(0,be=!1),t(4,Pt=null))}function gi(je){if(!(D!=="hover"||ei||Jt!=="normal")){if(Ot(je)){t(0,be=!1),t(4,Pt=null);return}t(0,be=!0),t(4,Pt=je.features??[]),t(10,H=je.lngLat)}}function Pi(je){if(Jt==="justOpened"){t(25,Jt="normal");return}if(!L)return;let rt=[Ht,a instanceof Qr.Marker?a==null?void 0:a.getElement():null];be&&pt.isOpen()&&!rt.some(xt=>xt==null?void 0:xt.contains(je.originalEvent.target))&&(je.type==="contextmenu"&&D==="contextmenu"||je.type!=="contextmenu")&&t(0,be=!1)}tr(()=>{u&&(pt!=null&&pt.isOpen())&&pt.remove()});let ct;const It=()=>t(0,be=!1);function Ne(je){Ki[je?"unshift":"push"](()=>{ct=je,t(1,ct)})}return o.$$set=je=>{"closeButton"in je&&t(11,C=je.closeButton),"closeOnClickOutside"in je&&t(12,L=je.closeOnClickOutside),"closeOnClickInside"in je&&t(13,z=je.closeOnClickInside),"closeOnMove"in je&&t(14,R=je.closeOnMove),"openOn"in je&&t(15,D=je.openOn),"openIfTopMost"in je&&t(16,B=je.openIfTopMost),"focusAfterOpen"in je&&t(17,N=je.focusAfterOpen),"anchor"in je&&t(18,V=je.anchor),"offset"in je&&t(19,U=je.offset),"popupClass"in je&&t(20,le=je.popupClass),"maxWidth"in je&&t(21,oe=je.maxWidth),"lngLat"in je&&t(10,H=je.lngLat),"html"in je&&t(22,ee=je.html),"open"in je&&t(0,be=je.open),"$$scope"in je&&t(29,S=je.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&t(27,n=C??(!L&&!z)),o.$$.dirty[0]&146685952&&(pt||(t(23,pt=new Qr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:R,focusAfterOpen:N,maxWidth:oe,className:le,anchor:V,offset:U})),Ht=pt.getElement(),pt.on("open",()=>{t(0,be=!0),ii(),Oe("open",pt)}),pt.on("close",()=>{t(0,be=!1),Oe("close",pt)}),pt.on("hover",()=>{Oe("hover",pt)}))),o.$$.dirty[0]&8421384&&pt&&a instanceof Qr.Marker&&(D==="click"?a.setPopup(pt):a.getPopup()===pt&&a.setPopup(void 0)),o.$$.dirty[0]&268468224&&vt.includes(D)&&(d==null?void 0:d.type)===D&&(Mt(d),At(Ke,d=null,d)),o.$$.dirty[0]&268468224&&t(26,l=D==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),o.$$.dirty[0]&352354304&&D==="hover"&&Ke&&(l&&d&&(d.layerType==="deckgl"?(t(10,H=d.coordinate),t(4,Pt=d.object?[d.object]:null)):(t(10,H=d.lngLat),t(4,Pt=d.features??[]))),t(0,be=(l||st)??!1)),o.$$.dirty[0]&12582914&&(ct?pt.setDOMContent(ct):ee&&pt.setHTML(ee)),o.$$.dirty[0]&8389632&&H&&pt.setLngLat(H),o.$$.dirty[0]&41943045&&u){let je=pt.isOpen();be&&!je?(pt.addTo(u),Jt==="opening"&&t(25,Jt="justOpened")):!be&&je&&pt.remove()}},[be,ct,u,a,Pt,ne,ye,Ke,Ce,k,H,C,L,z,R,D,B,N,V,U,le,oe,ee,pt,st,Jt,l,n,d,S,x,It,Ne]}class pS extends Gt{constructor(e){super(),Zt(this,e,fS,dS,Ft,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const mS=o=>({props:o&8}),Z_=o=>({props:yS(o[3])});function gS(o){let e;const t=o[1].default,n=Ni(t,o,o[2],Z_);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&12)&&Ui(n,t,l,l[2],e?ji(t,l[2],u,mS):Vi(l[2]),Z_)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function _S(o){let e,t;return e=new pS({props:{openOn:o[0],$$slots:{default:[gS,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.openOn=n[0]),l&12&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function yS(o){return o?o[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function bS(o,e,t){let{$$slots:n={},$$scope:l}=e,{openOn:u="hover"}=e;return o.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,n,l]}class is extends Gt{constructor(e){super(),Zt(this,e,bS,_S,Ft,{openOn:0})}}const vS=["==",["geometry-type"],"Polygon"],wS=["==",["geometry-type"],"LineString"];function U0(o,e,t){let n=["match",o];for(let[l,u]of Object.entries(e))n.push(l),n.push(u);return n.push(t),n}function Xl(){return{type:"FeatureCollection",features:[]}}const xS=o=>({}),G_=o=>({}),kS=o=>({}),W_=o=>({}),SS=o=>({}),$_=o=>({});function TS(o){let e,t,n,l,u,d;const a=o[1].top,_=Ni(a,o,o[0],$_),x=o[1].left,S=Ni(x,o,o[0],W_),k=o[1].main,C=Ni(k,o,o[0],G_);return{c(){e=ce("div"),_&&_.c(),t=Re(),n=ce("div"),S&&S.c(),l=Re(),u=ce("div"),C&&C.c(),Te(e,"class","top svelte-mpick2"),Te(n,"class","left svelte-mpick2"),Te(u,"class","main svelte-mpick2")},m(L,z){he(L,e,z),_&&_.m(e,null),he(L,t,z),he(L,n,z),S&&S.m(n,null),he(L,l,z),he(L,u,z),C&&C.m(u,null),d=!0},p(L,[z]){_&&_.p&&(!d||z&1)&&Ui(_,a,L,L[0],d?ji(a,L[0],z,SS):Vi(L[0]),$_),S&&S.p&&(!d||z&1)&&Ui(S,x,L,L[0],d?ji(x,L[0],z,kS):Vi(L[0]),W_),C&&C.p&&(!d||z&1)&&Ui(C,k,L,L[0],d?ji(k,L[0],z,xS):Vi(L[0]),G_)},i(L){d||(ie(_,L),ie(S,L),ie(C,L),d=!0)},o(L){re(_,L),re(S,L),re(C,L),d=!1},d(L){L&&(ue(e),ue(t),ue(n),ue(l),ue(u)),_&&_.d(L),S&&S.d(L),C&&C.d(L)}}}function ES(o,e,t){let{$$slots:n={},$$scope:l}=e;return o.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,n]}class CS extends Gt{constructor(e){super(),Zt(this,e,ES,TS,Ft,{})}}const MS=o=>({}),H_=o=>({}),IS=o=>({}),X_=o=>({}),LS=o=>({}),K_=o=>({});function AS(o){let e,t,n,l,u,d;const a=o[4].top,_=Ni(a,o,o[3],K_),x=o[4].sidebar,S=Ni(x,o,o[3],X_),k=o[4].map,C=Ni(k,o,o[3],H_);return{c(){e=ce("div"),_&&_.c(),t=Re(),n=ce("div"),S&&S.c(),l=Re(),u=ce("div"),C&&C.c()},m(L,z){he(L,e,z),_&&_.m(e,null),o[5](e),he(L,t,z),he(L,n,z),S&&S.m(n,null),o[6](n),he(L,l,z),he(L,u,z),C&&C.m(u,null),o[7](u),d=!0},p(L,[z]){_&&_.p&&(!d||z&8)&&Ui(_,a,L,L[3],d?ji(a,L[3],z,LS):Vi(L[3]),K_),S&&S.p&&(!d||z&8)&&Ui(S,x,L,L[3],d?ji(x,L[3],z,IS):Vi(L[3]),X_),C&&C.p&&(!d||z&8)&&Ui(C,k,L,L[3],d?ji(k,L[3],z,MS):Vi(L[3]),H_)},i(L){d||(ie(_,L),ie(S,L),ie(C,L),d=!0)},o(L){re(_,L),re(S,L),re(C,L),d=!1},d(L){L&&(ue(e),ue(t),ue(n),ue(l),ue(u)),_&&_.d(L),o[5](null),S&&S.d(L),o[6](null),C&&C.d(L),o[7](null)}}}function PS(o,e,t){let n,l,u;dt(o,gp,k=>t(0,n=k)),dt(o,_p,k=>t(1,l=k)),dt(o,yp,k=>t(2,u=k));let{$$slots:d={},$$scope:a}=e;function _(k){Ki[k?"unshift":"push"](()=>{n=k,gp.set(n)})}function x(k){Ki[k?"unshift":"push"](()=>{l=k,_p.set(l)})}function S(k){Ki[k?"unshift":"push"](()=>{u=k,yp.set(u)})}return o.$$set=k=>{"$$scope"in k&&t(3,a=k.$$scope)},[n,l,u,a,d,_,x,S]}class ns extends Gt{constructor(e){super(),Zt(this,e,PS,AS,Ft,{})}}let gp=wi(null),_p=wi(null),yp=wi(null);function zS(o){let e,t,n,l,u,d,a,_,x;return{c(){e=ce("label"),t=Qe(`Basemap:
  `),n=ce("select"),l=ce("option"),l.textContent="MapTiler Dataviz",u=ce("option"),u.textContent="MapTiler Streets",d=ce("option"),d.textContent="MapTiler Satellite",a=ce("option"),a.textContent="OS Open Zoomstack",l.__value="dataviz",Hn(l,l.__value),u.__value="streets-v2",Hn(u,u.__value),d.__value="hybrid",Hn(d,d.__value),a.__value="uk-openzoomstack-light",Hn(a,a.__value),o[0]===void 0&&Yl(()=>o[1].call(n))},m(S,k){he(S,e,k),Q(e,t),Q(e,n),Q(n,l),Q(n,u),Q(n,d),Q(n,a),Jl(n,o[0],!0),_||(x=Et(n,"change",o[1]),_=!0)},p(S,[k]){k&1&&Jl(n,S[0])},i:Dt,o:Dt,d(S){S&&ue(e),_=!1,x()}}}function DS(o,e,t){let n;dt(o,rp,u=>t(0,n=u));function l(){n=Sp(this),rp.set(n)}return[n,l]}class RS extends Gt{constructor(e){super(),Zt(this,e,DS,zS,Ft,{})}}let hd=wi(!0);function BS(o){let e,t;return e=new Cs({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:o[0]?"none":"visible"}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.layout={visibility:n[0]?"none":"visible"}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function FS(o){let e,t;return e=new Bn({props:{data:o[1],$$slots:{default:[BS]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&5&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function OS(o,e,t){let n;return dt(o,hd,u=>t(0,n=u)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class NS extends Gt{constructor(e){super(),Zt(this,e,OS,FS,Ft,{})}}function jS(o){let e,t;return e=new Id({props:{lngLat:o[0],$$slots:{default:[VS]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.lngLat=n[0]),l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function US(o){let e,t,n;function l(d){o[3](d)}let u={draggable:!0,$$slots:{default:[qS]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.lngLat=o[0]),e=new Id({props:u}),Ki.push(()=>Wr(e,"lngLat",l)),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,a){const _={};a&16&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.lngLat=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function VS(o){let e,t;const n=o[2].default,l=Ni(n,o,o[4],null);return{c(){e=ce("span"),l&&l.c(),Te(e,"class","dot svelte-1gcxp27")},m(u,d){he(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Ui(l,n,u,u[4],t?ji(n,u[4],d,null):Vi(u[4]),null)},i(u){t||(ie(l,u),t=!0)},o(u){re(l,u),t=!1},d(u){u&&ue(e),l&&l.d(u)}}}function qS(o){let e,t;const n=o[2].default,l=Ni(n,o,o[4],null);return{c(){e=ce("span"),l&&l.c(),Te(e,"class","dot svelte-1gcxp27")},m(u,d){he(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Ui(l,n,u,u[4],t?ji(n,u[4],d,null):Vi(u[4]),null)},i(u){t||(ie(l,u),t=!0)},o(u){re(l,u),t=!1},d(u){u&&ue(e),l&&l.d(u)}}}function ZS(o){let e,t,n,l;const u=[US,jS],d=[];function a(_,x){return _[1]?0:1}return e=a(o),t=d[e]=u[e](o),{c(){t.c(),n=Fn()},m(_,x){d[e].m(_,x),he(_,n,x),l=!0},p(_,[x]){let S=e;e=a(_),e===S?d[e].p(_,x):(_i(),re(d[S],1,1,()=>{d[S]=null}),yi(),t=d[e],t?t.p(_,x):(t=d[e]=u[e](_),t.c()),ie(t,1),t.m(n.parentNode,n))},i(_){l||(ie(t),l=!0)},o(_){re(t),l=!1},d(_){_&&ue(n),d[e].d(_)}}}function GS(o,e,t){let{$$slots:n={},$$scope:l}=e,{lngLat:u}=e,{draggable:d=!1}=e;function a(_){u=_,t(0,u)}return o.$$set=_=>{"lngLat"in _&&t(0,u=_.lngLat),"draggable"in _&&t(1,d=_.draggable),"$$scope"in _&&t(4,l=_.$$scope)},[u,d,n,a,l]}class Fu extends Gt{constructor(e){super(),Zt(this,e,GS,ZS,Ft,{lngLat:0,draggable:1})}}const WS="/ltn/assets/help-d011708a.svg";function J_(o){let e,t;return e=new Td({props:{$$slots:{default:[$S]},$$scope:{ctx:o}}}),e.$on("close",o[3]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function $S(o){let e,t,n;const l=o[1].default,u=Ni(l,o,o[4],null);return{c(){e=ce("h2"),e.textContent="Help",t=Re(),u&&u.c()},m(d,a){he(d,e,a),he(d,t,a),u&&u.m(d,a),n=!0},p(d,a){u&&u.p&&(!n||a&16)&&Ui(u,l,d,d[4],n?ji(l,d[4],a,null):Vi(d[4]),null)},i(d){n||(ie(u,d),n=!0)},o(d){re(u,d),n=!1},d(d){d&&(ue(e),ue(t)),u&&u.d(d)}}}function HS(o){let e,t,n,l,u,d,a=o[0]&&J_(o);return{c(){e=ce("button"),e.innerHTML=`<img src="${WS}" title="Help" alt="Help"/>`,t=Re(),a&&a.c(),n=Fn(),Te(e,"class","svelte-gb6dzm")},m(_,x){he(_,e,x),he(_,t,x),a&&a.m(_,x),he(_,n,x),l=!0,u||(d=Et(e,"click",o[2]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&ie(a,1)):(a=J_(_),a.c(),ie(a,1),a.m(n.parentNode,n)):a&&(_i(),re(a,1,1,()=>{a=null}),yi())},i(_){l||(ie(a),l=!0)},o(_){re(a),l=!1},d(_){_&&(ue(e),ue(t),ue(n)),a&&a.d(_),u=!1,d()}}}function XS(o,e,t){let{$$slots:n={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),a=()=>t(0,u=!1);return o.$$set=_=>{"$$scope"in _&&t(4,l=_.$$scope)},[u,n,d,a,l]}class qp extends Gt{constructor(e){super(),Zt(this,e,XS,HS,Ft,{})}}function KS(o){let e,t,n,l;const u=o[1].default,d=Ni(u,o,o[0],null);return{c(){e=ce("a"),d&&d.c(),Te(e,"href","#")},m(a,_){he(a,e,_),d&&d.m(e,null),t=!0,n||(l=Et(e,"click",xp(o[2])),n=!0)},p(a,[_]){d&&d.p&&(!t||_&1)&&Ui(d,u,a,a[0],t?ji(u,a[0],_,null):Vi(a[0]),null)},i(a){t||(ie(d,a),t=!0)},o(a){re(d,a),t=!1},d(a){a&&ue(e),d&&d.d(a),n=!1,l()}}}function JS(o,e,t){let{$$slots:n={},$$scope:l}=e;function u(d){ui.call(this,o,d)}return o.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,n,u]}class zi extends Gt{constructor(e){super(),Zt(this,e,JS,KS,Ft,{})}}function YS(o,e){let t=new Set(o.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?o.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?o.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:QS}=kd;function e4(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R;return L=qy(o[8][0]),{c(){e=ce("button"),e.textContent="Stop StreetView",t=Re(),n=ce("fieldset"),l=ce("legend"),l.textContent="Source:",u=Re(),d=ce("label"),a=ce("input"),_=Qe(`
      Google Street View`),x=Re(),S=ce("label"),k=ce("input"),C=Qe(`
      Bing Streetside`),Te(e,"class","secondary"),Te(a,"type","radio"),a.__value="google",Hn(a,a.__value),Te(k,"type","radio"),k.__value="bing",Hn(k,k.__value),L.p(a,k)},m(D,B){he(D,e,B),he(D,t,B),he(D,n,B),Q(n,l),Q(n,u),Q(n,d),Q(d,a),a.checked=a.__value===o[0],Q(d,_),Q(n,x),Q(n,S),Q(S,k),k.checked=k.__value===o[0],Q(S,C),z||(R=[Et(e,"click",o[3]),Et(a,"change",o[7]),Et(k,"change",o[9])],z=!0)},p(D,B){B&1&&(a.checked=a.__value===D[0]),B&1&&(k.checked=k.__value===D[0])},d(D){D&&(ue(e),ue(t),ue(n)),L.r(),z=!1,ln(R)}}}function t4(o){let e,t,n;return{c(){e=ce("button"),e.textContent="StreetView",Te(e,"class","secondary")},m(l,u){he(l,e,u),t||(n=Et(e,"click",o[2]),t=!0)},p:Dt,d(l){l&&ue(e),t=!1,n()}}}function i4(o){let e,t,n;function l(a,_){return a[1]?t4:e4}let u=l(o),d=u(o);return{c(){d.c(),e=Fn()},m(a,_){d.m(a,_),he(a,e,_),t||(n=Et(QS,"keydown",o[4]),t=!0)},p(a,[_]){u===(u=l(a))&&d?d.p(a,_):(d.d(1),d=u(a),d&&(d.c(),d.m(e.parentNode,e)))},i:Dt,o:Dt,d(a){a&&ue(e),d.d(a),t=!1,n()}}}function n4(o,e,t){let n;dt(o,hd,R=>t(1,n=R));let{map:l}=e,{maptilerBasemap:u}=e,d="google",a=[];function _(){At(hd,n=!1,n),l.on("click",S),l.getCanvas().style.cursor="crosshair";for(let R of YS(l,u))a.push([R,l.getPaintProperty(R,"line-color")]),l.setPaintProperty(R,"line-color","cyan")}function x(){At(hd,n=!0,n),l.off("click",S),l.getCanvas().style.cursor="inherit";for(let[R,D]of a)l.setPaintProperty(R,"line-color",D);a=[]}tr(x);function S(R){let D=R.lngLat.lng,B=R.lngLat.lat;d=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${D}&cbp=11,0,0,0,0`,"_blank"):d=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${D}&style=x`,"_blank")}function k(R){!n&&R.key=="Escape"&&(R.stopPropagation(),x())}const C=[[]];function L(){d=this.__value,t(0,d)}function z(){d=this.__value,t(0,d)}return o.$$set=R=>{"map"in R&&t(5,l=R.map),"maptilerBasemap"in R&&t(6,u=R.maptilerBasemap)},[d,n,_,x,k,l,u,L,C,z]}class r4 extends Gt{constructor(e){super(),Zt(this,e,n4,i4,Ft,{map:5,maptilerBasemap:6})}}function gn(o,e=!0){return{id:o,beforeId:o4(o),eventsIfTopMost:e}}function o4(o){let e=Lr(es);if(!e){console.warn(`getBeforeId(${o}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let l=Y_.length-1;l>=0;l--){let u=Y_[l];if(u==o){n=!0;break}e.getLayer(u)&&(t=u)}if(!n)throw new Error(`Layer ID ${o} not defined in layerZorder`);return t}let Hf=o=>o,Xf=o=>o;const Y_=[Hf(Xf("Background")),"neighbourhood-boundaries",Hf("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus",Xf("Building"),"draw-area-lines","draw-area-preview","one-ways",Xf("Road labels"),Hf("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function s4(o){return["interpolate",["linear"],["zoom"],5,.5+o,10,1+o,12,1.5+o,14,4+o,16,7+o,20,24+o]}function a4(o){let e;return{c(){e=Qe("Back")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function l4(o){let e,t,n,l;return e=new zi({props:{$$slots:{default:[a4]},$$scope:{ctx:o}}}),e.$on("click",o[2]),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0,n||(l=Et(window,"keydown",o[1]),n=!0)},p(u,[d]){const a={};d&8&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function c4(o){let e=ts();function t(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class qu extends Gt{constructor(e){super(),Zt(this,e,c4,l4,Ft,{})}}function bp(o,e,t){let n=new Set(o.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,t);if(!l)return null;if(n.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function u4(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function h4(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function d4(o){let e,t,n,l,u,d,a,_,x,S,k;return u=new zi({props:{$$slots:{default:[u4]},$$scope:{ctx:o}}}),u.$on("click",o[10]),_=new zi({props:{$$slots:{default:[h4]},$$scope:{ctx:o}}}),_.$on("click",o[11]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),Pe(_.$$.fragment),x=Re(),S=ce("li"),S.textContent="Use an auto-generated boundary",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(C,L){he(C,e,L),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Le(_,a,null),Q(n,x),Q(n,S),k=!0},p(C,L){const z={};L&32768&&(z.$$scope={dirty:L,ctx:C}),u.$set(z);const R={};L&32768&&(R.$$scope={dirty:L,ctx:C}),_.$set(R)},i(C){k||(ie(u.$$.fragment,C),ie(_.$$.fragment,C),k=!0)},o(C){re(u.$$.fragment,C),re(_.$$.fragment,C),k=!1},d(C){C&&ue(e),Ae(u),Ae(_)}}}function f4(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B;return t=new qu({}),t.$on("click",o[7]),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=Re(),d=ce("button"),d.textContent="Export to GeoJSON",a=Re(),_=ce("label"),x=Qe(`Minimum area (km²)
      `),S=ce("input"),k=Re(),C=ce("label"),L=ce("input"),z=Qe(`
      Remove areas not touching a big road`),Te(d,"class","secondary"),Te(S,"type","number"),Te(S,"min","0"),Te(S,"max","1"),Te(S,"step","0.01"),Te(L,"type","checkbox"),Te(e,"slot","sidebar")},m(N,V){he(N,e,V),Le(t,e,null),Q(e,n),Q(e,l),Q(e,u),Q(e,d),Q(e,a),Q(e,_),Q(_,x),Q(_,S),Hn(S,o[0]),Q(e,k),Q(e,C),Q(C,L),L.checked=o[1],Q(C,z),R=!0,D||(B=[Et(d,"click",o[5]),Et(S,"input",o[8]),Et(L,"change",o[9])],D=!0)},p(N,V){V&1&&kp(S.value)!==N[0]&&Hn(S,N[0]),V&2&&(L.checked=N[1])},i(N){R||(ie(t.$$.fragment,N),R=!0)},o(N){re(t.$$.fragment,N),R=!1},d(N){N&&ue(e),Ae(t),D=!1,ln(B)}}}function p4(o){let e,t,n=o[14].area_km2.toFixed(1)+"",l,u,d,a,_,x=o[14].touches_big_road+"",S,k,C=o[14].touches_railway+"",L,z,R=o[14].touches_waterway+"",D;return{c(){e=ce("p"),t=Qe("Area: "),l=Qe(n),u=Qe(" km²"),d=Re(),a=ce("p"),_=Qe("Borders roads = "),S=Qe(x),k=Qe(", railway = "),L=Qe(C),z=Qe(`,
            water = `),D=Qe(R)},m(B,N){he(B,e,N),Q(e,t),Q(e,l),Q(e,u),he(B,d,N),he(B,a,N),Q(a,_),Q(a,S),Q(a,k),Q(a,L),Q(a,z),Q(a,D)},p(B,N){N&16384&&n!==(n=B[14].area_km2.toFixed(1)+"")&&Mi(l,n),N&16384&&x!==(x=B[14].touches_big_road+"")&&Mi(S,x),N&16384&&C!==(C=B[14].touches_railway+"")&&Mi(L,C),N&16384&&R!==(R=B[14].touches_waterway+"")&&Mi(D,R)},d(B){B&&(ue(e),ue(d),ue(a))}}}function m4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[p4,({props:n})=>({14:n}),({props:n})=>n?16384:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&49152&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function g4(o){let e,t,n,l;const u=[gn("auto-boundaries-areas"),{filter:o[6](o[0],o[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":Fa(.3,.7)}},{hoverCursor:"pointer"}];let d={$$slots:{default:[m4]},$$scope:{ctx:o}};for(let x=0;x<u.length;x+=1)d=an(d,u[x]);e=new Cs({props:d}),e.$on("click",o[4]);const a=[gn("auto-boundaries-severances"),{filter:wS},{manageHoverState:!0},{paint:{"line-color":Fa("black","red"),"line-width":3}}];let _={};for(let x=0;x<a.length;x+=1)_=an(_,a[x]);return n=new fo({props:_}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(x,S){Le(e,x,S),he(x,t,S),Le(n,x,S),l=!0},p(x,S){const k=S&67?Tu(u,[u[0],{filter:x[6](x[0],x[1])},u[2],u[3],u[4]]):{};S&32768&&(k.$$scope={dirty:S,ctx:x}),e.$set(k);const C={};n.$set(C)},i(x){l||(ie(e.$$.fragment,x),ie(n.$$.fragment,x),l=!0)},o(x){re(e.$$.fragment,x),re(n.$$.fragment,x),l=!1},d(x){x&&ue(t),Ae(e,x),Ae(n,x)}}}function _4(o){let e,t,n;return t=new Bn({props:{data:o[3],generateId:!0,$$slots:{default:[g4]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","map")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const d={};u&32771&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function y4(o){let e,t;return e=new ns({props:{$$slots:{map:[_4],sidebar:[f4],top:[d4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&32775&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function b4(o,e,t){let n,l,u;dt(o,ri,B=>t(2,n=B)),dt(o,Au,B=>t(12,l=B)),dt(o,Yn,B=>t(13,u=B));let d=u.renderAutoBoundaries(),a=0,_=!0;function x(B){let N=bp(u,"What do you want to name the neighbourhood?","");if(N)try{let V={type:"Feature",properties:{},geometry:d.features[B.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(N,V),ec(),u.setCurrentNeighbourhood(N,l),At(ri,n={mode:"neighbourhood"},n)}catch(V){console.log(V),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function S(){pd("auto_boundaries.geojson",JSON.stringify(d,null,"  "))}function k(B,N){let V=["all",vS,[">=",["get","area_km2"],B]];return N&&V.push(["get","touches_big_road"]),V}const C=()=>At(ri,n={mode:"network"},n);function L(){a=kp(this.value),t(0,a)}function z(){_=this.checked,t(1,_)}return[a,_,n,d,x,S,k,C,L,z,()=>At(ri,n={mode:"title",firstLoad:!1},n),()=>At(ri,n={mode:"network"},n)]}class v4 extends Gt{constructor(e){super(),Zt(this,e,b4,y4,Ft,{})}}function w4(o){let e,t,n,l,u,d;const a=[gn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:o[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let _={};for(let L=0;L<a.length;L+=1)_=an(_,a[L]);e=new Cs({props:_});const x=[gn("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let S={};for(let L=0;L<x.length;L+=1)S=an(S,x[L]);n=new Cs({props:S});const k=[gn("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let C={};for(let L=0;L<k.length;L+=1)C=an(C,k[L]);return u=new fo({props:C}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment)},m(L,z){Le(e,L,z),he(L,t,z),Le(n,L,z),he(L,l,z),Le(u,L,z),d=!0},p(L,[z]){const R=z&1?Tu(a,[a[0],a[1],{layout:{visibility:L[0]=="cells"?"none":"visible"}},a[3]]):{};e.$set(R);const D={};n.$set(D);const B={};u.$set(B)},i(L){d||(ie(e.$$.fragment,L),ie(n.$$.fragment,L),ie(u.$$.fragment,L),d=!0)},o(L){re(e.$$.fragment,L),re(n.$$.fragment,L),re(u.$$.fragment,L),d=!1},d(L){L&&(ue(t),ue(l)),Ae(e,L),Ae(n,L),Ae(u,L)}}}function x4(o,e,t){let n;return dt(o,bd,l=>t(0,n=l)),[n]}class Ad extends Gt{constructor(e){super(),Zt(this,e,x4,w4,Ft,{})}}function k4(o){let e,t;const n=[gn("neighbourhood-boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new Cs({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function S4(o){let e,t;return e=new Bn({props:{data:Q_(o[0]),$$slots:{default:[k4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=Q_(n[0])),l&2&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function Q_(o){let e=o.features.find(t=>t.properties.kind=="boundary");return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],e.geometry.coordinates[0]]}}}function T4(o,e,t){let{gj:n}=e;return o.$$set=l=>{"gj"in l&&t(0,n=l.gj)},[n]}class Pd extends Gt{constructor(e){super(),Zt(this,e,T4,S4,Ft,{gj:0})}}function E4(o){let e;const t=o[3].default,n=Ni(t,o,o[5],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&32)&&Ui(n,t,l,l[5],e?ji(t,l[5],u,null):Vi(l[5]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function C4(o){let e,t;const n=[gn("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let l={$$slots:{default:[E4]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new k0({props:l}),e.$on("click",o[4]),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};d&32&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function M4(o){let e,t;return e=new Bn({props:{data:o[0],generateId:!0,$$slots:{default:[C4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&32&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function I4(o,e,t){let n,l,u;dt(o,Yn,x=>t(1,l=x)),dt(o,bs,x=>t(2,u=x));let{$$slots:d={},$$scope:a}=e;function _(x){ui.call(this,o,x)}return o.$$set=x=>{"$$scope"in x&&t(5,a=x.$$scope)},o.$$.update=()=>{o.$$.dirty&6&&t(0,n=u>0?l.renderModalFilters():Xl())},[n,l,u,d,_,a]}class Zu extends Gt{constructor(e){super(),Zt(this,e,I4,M4,Ft,{})}}function L4(o){let e,t;const n=[gn("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new k0({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}class zd extends Gt{constructor(e){super(),Zt(this,e,null,L4,Ft,{})}}const A4=o=>({}),ey=o=>({});function ty(o){let e;const t=o[7]["line-popup"],n=Ni(t,o,o[9],ey);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&512)&&Ui(n,t,l,l[9],e?ji(t,l[9],u,A4):Vi(l[9]),ey)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function P4(o){let e,t,n=o[1]&&ty(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[1]?n?(n.p(l,u),u&2&&ie(n,1)):(n=ty(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function z4(o){let e,t,n,l;const u=[gn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[3],o[0].maxShortcuts,0),"line-color":"black"}}];let d={};for(let x=0;x<u.length;x+=1)d=an(d,u[x]);e=new fo({props:d});const a=[gn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[3],o[0].maxShortcuts,0),"line-color":o[5](o[4],o[0].maxShortcuts),"line-opacity":Fa(1,.5)}},{manageHoverState:o[1]},{hoverCursor:o[1]?"pointer":void 0}];let _={$$slots:{default:[P4]},$$scope:{ctx:o}};for(let x=0;x<a.length;x+=1)_=an(_,a[x]);return n=new fo({props:_}),n.$on("click",o[8]),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(x,S){Le(e,x,S),he(x,t,S),Le(n,x,S),l=!0},p(x,S){const k=S&73?Tu(u,[u[0],u[1],{paint:{"line-width":x[6](x[3],x[0].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(k);const C=S&123?Tu(a,[a[0],a[1],S&121&&{paint:{"line-width":x[6](x[3],x[0].maxShortcuts,0),"line-color":x[5](x[4],x[0].maxShortcuts),"line-opacity":Fa(1,.5)}},S&2&&{manageHoverState:x[1]},S&2&&{hoverCursor:x[1]?"pointer":void 0}]):{};S&514&&(C.$$scope={dirty:S,ctx:x}),n.$set(C)},i(x){l||(ie(e.$$.fragment,x),ie(n.$$.fragment,x),l=!0)},o(x){re(e.$$.fragment,x),re(n.$$.fragment,x),l=!1},d(x){x&&ue(t),Ae(e,x),Ae(n,x)}}}function D4(o){let e,t;return e=new Bn({props:{data:o[0],generateId:!0,$$slots:{default:[z4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&543&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function R4(o,e,t){let n,l;dt(o,sp,L=>t(3,n=L)),dt(o,bd,L=>t(4,l=L));let{$$slots:u={},$$scope:d}=e,{gj:a}=e,{interactive:_=!0}=e,{onClickLine:x=(L,z)=>{}}=e;function S(L,z){return L=="cells"?["get","color"]:z<=2?Fa("white","blue"):Fa(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",z,"#A32015"],"blue")}function k(L,z,R){return!L||z<=2?s4(R):["interpolate",["linear"],["get","shortcuts"],0,5+R,z,25+R]}const C=L=>_&&x(L.detail.features[0],L.detail.event.lngLat);return o.$$set=L=>{"gj"in L&&t(0,a=L.gj),"interactive"in L&&t(1,_=L.interactive),"onClickLine"in L&&t(2,x=L.onClickLine),"$$scope"in L&&t(9,d=L.$$scope)},[a,_,x,n,l,S,k,u,C,d]}class Gu extends Gt{constructor(e){super(),Zt(this,e,R4,D4,Ft,{gj:0,interactive:1,onClickLine:2})}}function B4(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function F4(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function O4(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function N4(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z;return u=new zi({props:{$$slots:{default:[B4]},$$scope:{ctx:o}}}),u.$on("click",o[4]),_=new zi({props:{$$slots:{default:[F4]},$$scope:{ctx:o}}}),_.$on("click",o[5]),k=new zi({props:{$$slots:{default:[O4]},$$scope:{ctx:o}}}),k.$on("click",o[6]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),Pe(_.$$.fragment),x=Re(),S=ce("li"),Pe(k.$$.fragment),C=Re(),L=ce("li"),L.textContent="Debug mode",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(R,D){he(R,e,D),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Le(_,a,null),Q(n,x),Q(n,S),Le(k,S,null),Q(n,C),Q(n,L),z=!0},p(R,D){const B={};D&256&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const N={};D&256&&(N.$$scope={dirty:D,ctx:R}),_.$set(N);const V={};D&256&&(V.$$scope={dirty:D,ctx:R}),k.$set(V)},i(R){z||(ie(u.$$.fragment,R),ie(_.$$.fragment,R),ie(k.$$.fragment,R),z=!0)},o(R){re(u.$$.fragment,R),re(_.$$.fragment,R),re(k.$$.fragment,R),z=!1},d(R){R&&ue(e),Ae(u),Ae(_),Ae(k)}}}function j4(o){let e,t,n;return t=new qu({}),t.$on("click",o[3]),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","sidebar")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p:Dt,i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function U4(o){let e,t;return e=new Ed({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function V4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[U4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function q4(o){let e,t;return e=new Ed({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function Z4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[q4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function G4(o){let e,t,n,l,u,d,a,_;e=new Ad({}),n=new zd({});const x=[gn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let S={$$slots:{default:[V4]},$$scope:{ctx:o}};for(let L=0;L<x.length;L+=1)S=an(S,x[L]);u=new Bp({props:S});const k=[gn("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let C={$$slots:{default:[Z4]},$$scope:{ctx:o}};for(let L=0;L<k.length;L+=1)C=an(C,k[L]);return a=new fo({props:C}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),d=Re(),Pe(a.$$.fragment)},m(L,z){Le(e,L,z),he(L,t,z),Le(n,L,z),he(L,l,z),Le(u,L,z),he(L,d,z),Le(a,L,z),_=!0},p(L,z){const R={};z&256&&(R.$$scope={dirty:z,ctx:L}),u.$set(R);const D={};z&256&&(D.$$scope={dirty:z,ctx:L}),a.$set(D)},i(L){_||(ie(e.$$.fragment,L),ie(n.$$.fragment,L),ie(u.$$.fragment,L),ie(a.$$.fragment,L),_=!0)},o(L){re(e.$$.fragment,L),re(n.$$.fragment,L),re(u.$$.fragment,L),re(a.$$.fragment,L),_=!1},d(L){L&&(ue(t),ue(l),ue(d)),Ae(e,L),Ae(n,L),Ae(u,L),Ae(a,L)}}}function W4(o){let e,t;return e=new Ed({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function $4(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[W4,({props:l})=>({7:l}),({props:l})=>l?128:0]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const d={};u&384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function H4(o){let e,t;return e=new Ed({props:{properties:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function X4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[H4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function K4(o){let e,t;const n=[gn("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let l={$$slots:{default:[X4]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new Bp({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};d&256&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function J4(o){let e,t,n,l,u,d,a,_,x;return t=new Pd({props:{gj:Ei(o[0]).renderNeighbourhood()}}),l=new Bn({props:{data:Ei(o[0]).renderNeighbourhood(),generateId:!0,$$slots:{default:[G4]},$$scope:{ctx:o}}}),d=new Gu({props:{gj:Ei(o[0]).renderNeighbourhood(),interactive:!0,onClickLine:o[2],$$slots:{"line-popup":[$4]},$$scope:{ctx:o}}}),_=new Bn({props:{data:Ei(o[0]).renderModalFilters(),generateId:!0,$$slots:{default:[K4]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),u=Re(),Pe(d.$$.fragment),a=Re(),Pe(_.$$.fragment),Te(e,"slot","map")},m(S,k){he(S,e,k),Le(t,e,null),Q(e,n),Le(l,e,null),Q(e,u),Le(d,e,null),Q(e,a),Le(_,e,null),x=!0},p(S,k){const C={};k&1&&(C.gj=Ei(S[0]).renderNeighbourhood()),t.$set(C);const L={};k&1&&(L.data=Ei(S[0]).renderNeighbourhood()),k&256&&(L.$$scope={dirty:k,ctx:S}),l.$set(L);const z={};k&1&&(z.gj=Ei(S[0]).renderNeighbourhood()),k&256&&(z.$$scope={dirty:k,ctx:S}),d.$set(z);const R={};k&1&&(R.data=Ei(S[0]).renderModalFilters()),k&256&&(R.$$scope={dirty:k,ctx:S}),_.$set(R)},i(S){x||(ie(t.$$.fragment,S),ie(l.$$.fragment,S),ie(d.$$.fragment,S),ie(_.$$.fragment,S),x=!0)},o(S){re(t.$$.fragment,S),re(l.$$.fragment,S),re(d.$$.fragment,S),re(_.$$.fragment,S),x=!1},d(S){S&&ue(e),Ae(t),Ae(l),Ae(d),Ae(_)}}}function Y4(o){let e,t;return e=new ns({props:{$$slots:{map:[J4],sidebar:[j4],top:[N4]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&259&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function Q4(o,e,t){let n,l;return dt(o,Yn,S=>t(0,n=S)),dt(o,ri,S=>t(1,l=S)),[n,l,(S,k)=>window.open(Ei(S.properties).way,"_blank"),()=>At(ri,l={mode:"neighbourhood"},l),()=>At(ri,l={mode:"title",firstLoad:!1},l),()=>At(ri,l={mode:"network"},l),()=>At(ri,l={mode:"neighbourhood"},l)]}class e3 extends Gt{constructor(e){super(),Zt(this,e,Q4,Y4,Ft,{})}}var co=63710088e-1,V0={centimeters:co*100,centimetres:co*100,degrees:360/(2*Math.PI),feet:co*3.28084,inches:co*39.37,kilometers:co/1e3,kilometres:co/1e3,meters:co,metres:co,miles:co/1609.344,millimeters:co*1e3,millimetres:co*1e3,nauticalmiles:co/1852,radians:1,yards:co*1.0936};function t3(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function vp(o,e,t={}){if(!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!iy(o[0])||!iy(o[1]))throw new Error("coordinates must contain numbers");return t3({type:"Point",coordinates:o},e,t)}function i3(o,e="kilometers"){const t=V0[e];if(!t)throw new Error(e+" units is invalid");return o*t}function n3(o,e="kilometers"){const t=V0[e];if(!t)throw new Error(e+" units is invalid");return o/t}function wp(o){return o%(2*Math.PI)*180/Math.PI}function No(o){return o%360*Math.PI/180}function iy(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Ou(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return[...o.geometry.coordinates];if(o.type==="Point")return[...o.coordinates]}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return[...o];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function r3(o){return o.type==="Feature"?o.geometry:o}function q0(o,e,t={}){if(t.final===!0)return o3(o,e);const n=Ou(o),l=Ou(e),u=No(n[0]),d=No(l[0]),a=No(n[1]),_=No(l[1]),x=Math.sin(d-u)*Math.cos(_),S=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return wp(Math.atan2(x,S))}function o3(o,e){let t=q0(e,o);return t=(t+180)%360,t}function s3(o,e,t,n={}){const l=Ou(o),u=No(l[0]),d=No(l[1]),a=No(t),_=n3(e,n.units),x=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),S=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(x)),k=wp(S),C=wp(x);return vp([k,C],n.properties)}function a3(o,e,t={}){var n=Ou(o),l=Ou(e),u=No(l[1]-n[1]),d=No(l[0]-n[0]),a=No(n[1]),_=No(l[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return i3(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}function l3(o,e,t={}){const l=r3(o).coordinates;let u=0;for(let d=0;d<l.length&&!(e>=u&&d===l.length-1);d++)if(u>=e){const a=e-u;if(a){const _=q0(l[d],l[d-1])-180;return s3(l[d],a,_,t)}else return vp(l[d])}else u+=a3(l[d],l[d+1],t);return vp(l[l.length-1])}var c3=l3;function u3(o){let e,t;const n=[gn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new Bp({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function h3(o){let e,t;return e=new Bn({props:{data:o[0],$$slots:{default:[u3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&1024&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}let d3=50,f3=100,p3=.01;function m3(o,e,t){let{paths:n}=e,l=_(),u=x(),d=k(),a=setInterval(C,f3);tr(()=>clearInterval(a));function _(){return n.features.map(L=>1/L.properties.directness).reduce((L,z)=>L+z,0)}function x(){return n.features.length==0?[]:Array.from({length:d3},S)}function S(){let L=Math.random()*l,z=0;for(let[R,D]of n.features.entries())if(z+=1/D.properties.directness,L<z)return{idx:R,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function k(){return{type:"FeatureCollection",features:u.map(({idx:L,distance:z})=>c3(n.features[L],z,{units:"kilometers"}))}}function C(){for(let[L,z]of u.entries())z.distance+=p3,z.distance>=n.features[z.idx].properties.length_meters/1e3&&(u[L]=S());t(0,d=k())}return o.$$set=L=>{"paths"in L&&t(1,n=L.paths)},o.$$.update=()=>{o.$$.dirty&2&&n&&(l=_(),u=x())},[d,n]}class g3 extends Gt{constructor(e){super(),Zt(this,e,m3,h3,Ft,{paths:1})}}function ny(o,e,t){const n=o.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function ry(o){let e,t,n,l,u,d,a=o[8]+"",_,x,S,k,C;function L(){return o[3](o[7])}return{c(){e=ce("button"),t=ce("img"),l=Re(),u=ce("br"),d=Re(),_=Qe(a),x=Re(),En(t.src,n=`/ltn//filters/${o[7]}_icon.gif`)||Te(t,"src",n),Te(t,"width","80"),Te(t,"alt",o[8]),Te(e,"class","outline"),pn(e,"width","100%"),e.disabled=S=o[0]==o[7]},m(z,R){he(z,e,R),Q(e,t),Q(e,l),Q(e,u),Q(e,d),Q(e,_),Q(e,x),k||(C=Et(e,"click",L),k=!0)},p(z,R){o=z,R&1&&S!==(S=o[0]==o[7])&&(e.disabled=S)},d(z){z&&ue(e),k=!1,C()}}}function _3(o){let e,t,n,l,u,d,a,_,x,S,k,C,L=o[1][2]+"",z,R,D,B,N,V,U=Jn(o[2]),le=[];for(let H=0;H<U.length;H+=1)le[H]=ry(ny(o,U,H));function oe(){return o[4](o[6])}return{c(){e=ce("h3"),e.textContent="Choose a modal filter to place on streets",t=Re(),n=ce("table"),l=ce("tr"),u=ce("td");for(let H=0;H<le.length;H+=1)le[H].c();d=Re(),a=ce("td"),_=ce("img"),k=Re(),C=ce("p"),z=Qe(L),R=Re(),D=ce("center"),B=ce("button"),B.textContent="Confirm",En(_.src,x=`/ltn//filters/${o[0]}.gif`)||Te(_,"src",x),Te(_,"height","300"),Te(_,"alt",S=o[1][1])},m(H,ee){he(H,e,ee),he(H,t,ee),he(H,n,ee),Q(n,l),Q(l,u);for(let be=0;be<le.length;be+=1)le[be]&&le[be].m(u,null);Q(l,d),Q(l,a),Q(a,_),Q(a,k),Q(a,C),Q(C,z),he(H,R,ee),he(H,D,ee),Q(D,B),N||(V=Et(B,"click",oe),N=!0)},p(H,ee){if(o=H,ee&5){U=Jn(o[2]);let be;for(be=0;be<U.length;be+=1){const Oe=ny(o,U,be);le[be]?le[be].p(Oe,ee):(le[be]=ry(Oe),le[be].c(),le[be].m(u,null))}for(;be<le.length;be+=1)le[be].d(1);le.length=U.length}ee&1&&!En(_.src,x=`/ltn//filters/${o[0]}.gif`)&&Te(_,"src",x),ee&2&&S!==(S=o[1][1])&&Te(_,"alt",S),ee&2&&L!==(L=o[1][2]+"")&&Mi(z,L)},d(H){H&&(ue(e),ue(t),ue(n),ue(R),ue(D)),Ss(le,H),N=!1,V()}}}function y3(o){let e,t;return e=new Td({props:{$$slots:{default:[_3,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:o}}}),e.$on("close",o[5]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&4163&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function b3(o,e,t){let n,l;dt(o,op,x=>t(0,l=x));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const d=x=>At(op,l=x,l),a=x=>Ei(x).close();function _(x){ui.call(this,o,x)}return o.$$.update=()=>{o.$$.dirty&1&&t(1,n=u.find(x=>x[0]==l))},[l,n,u,d,a,_]}class v3 extends Gt{constructor(e){super(),Zt(this,e,b3,y3,Ft,{})}}function oy(o){let e,t;return e=new Bn({props:{data:o[0],$$slots:{default:[w3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[0]),l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function w3(o){let e,t;const n=[gn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function x3(o){let e,t,n=o[0]&&oy(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=oy(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function k3(o,e,t){let{map:n}=e,l=null;const u=ts();n.on("dragstart",d),n.on("mousemove",a),n.on("mouseup",_),tr(()=>{n.dragPan.enable(),n.off("dragstart",d),n.off("mousemove",a),n.off("mouseup",_)});function d(){n.dragPan.disable(),t(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(x){l&&(l.geometry.coordinates.push(x.lngLat.toArray()),t(0,l))}function _(){l&&(u("done",l),t(0,l=null))}return o.$$set=x=>{"map"in x&&t(1,n=x.map)},[l,n]}class S3 extends Gt{constructor(e){super(),Zt(this,e,k3,x3,Ft,{map:1})}}function T3(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function E3(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function C3(o){let e;return{c(){e=ce("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function M3(o){let e;return{c(){e=Qe("View shortcuts")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function I3(o){let e;return{c(){e=Qe("Route")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function L3(o){let e;return{c(){e=Qe("Impact routing to one destination")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function A3(o){let e;return{c(){e=Qe("Change this boundary")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function P3(o){let e;return{c(){e=Qe("Debug")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function z3(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B,N,V,U,le,oe,H,ee,be,Oe,ne,ye,Ke,Ce;return u=new zi({props:{$$slots:{default:[T3]},$$scope:{ctx:o}}}),u.$on("click",o[28]),_=new zi({props:{$$slots:{default:[E3]},$$scope:{ctx:o}}}),_.$on("click",o[29]),C=new qp({props:{$$slots:{default:[C3]},$$scope:{ctx:o}}}),B=new zi({props:{$$slots:{default:[M3]},$$scope:{ctx:o}}}),B.$on("click",o[30]),U=new zi({props:{$$slots:{default:[I3]},$$scope:{ctx:o}}}),U.$on("click",o[31]),H=new zi({props:{$$slots:{default:[L3]},$$scope:{ctx:o}}}),H.$on("click",o[32]),Oe=new zi({props:{$$slots:{default:[A3]},$$scope:{ctx:o}}}),Oe.$on("click",o[33]),Ke=new zi({props:{$$slots:{default:[P3]},$$scope:{ctx:o}}}),Ke.$on("click",o[34]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),Pe(_.$$.fragment),x=Re(),S=ce("li"),k=Qe(`Editing
          `),Pe(C.$$.fragment),L=Re(),z=ce("nav"),R=ce("ul"),D=ce("li"),Pe(B.$$.fragment),N=Re(),V=ce("li"),Pe(U.$$.fragment),le=Re(),oe=ce("li"),Pe(H.$$.fragment),ee=Re(),be=ce("li"),Pe(Oe.$$.fragment),ne=Re(),ye=ce("li"),Pe(Ke.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),pn(e,"display","flex"),pn(e,"justify-content","space-between")},m(et,vt){he(et,e,vt),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Le(_,a,null),Q(n,x),Q(n,S),Q(S,k),Le(C,S,null),Q(e,L),Q(e,z),Q(z,R),Q(R,D),Le(B,D,null),Q(R,N),Q(R,V),Le(U,V,null),Q(R,le),Q(R,oe),Le(H,oe,null),Q(R,ee),Q(R,be),Le(Oe,be,null),Q(R,ne),Q(R,ye),Le(Ke,ye,null),Ce=!0},p(et,vt){const pt={};vt[1]&128&&(pt.$$scope={dirty:vt,ctx:et}),u.$set(pt);const st={};vt[1]&128&&(st.$$scope={dirty:vt,ctx:et}),_.$set(st);const Ht={};vt[1]&128&&(Ht.$$scope={dirty:vt,ctx:et}),C.$set(Ht);const ii={};vt[1]&128&&(ii.$$scope={dirty:vt,ctx:et}),B.$set(ii);const Ot={};vt[1]&128&&(Ot.$$scope={dirty:vt,ctx:et}),U.$set(Ot);const Pt={};vt[1]&128&&(Pt.$$scope={dirty:vt,ctx:et}),H.$set(Pt);const Jt={};vt[1]&128&&(Jt.$$scope={dirty:vt,ctx:et}),Oe.$set(Jt);const Mt={};vt[1]&128&&(Mt.$$scope={dirty:vt,ctx:et}),Ke.$set(Mt)},i(et){Ce||(ie(u.$$.fragment,et),ie(_.$$.fragment,et),ie(C.$$.fragment,et),ie(B.$$.fragment,et),ie(U.$$.fragment,et),ie(H.$$.fragment,et),ie(Oe.$$.fragment,et),ie(Ke.$$.fragment,et),Ce=!0)},o(et){re(u.$$.fragment,et),re(_.$$.fragment,et),re(C.$$.fragment,et),re(B.$$.fragment,et),re(U.$$.fragment,et),re(H.$$.fragment,et),re(Oe.$$.fragment,et),re(Ke.$$.fragment,et),Ce=!1},d(et){et&&ue(e),Ae(u),Ae(_),Ae(C),Ae(B),Ae(U),Ae(H),Ae(Oe),Ae(Ke)}}}function sy(o){let e;return{c(){e=ce("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function D3(o){let e,t,n;return{c(){e=Qe("Undo ("),t=Qe(o[4]),n=Qe(")")},m(l,u){he(l,e,u),he(l,t,u),he(l,n,u)},p(l,u){u[0]&16&&Mi(t,l[4])},d(l){l&&(ue(e),ue(t),ue(n))}}}function R3(o){let e;return{c(){e=Qe("Undo")},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function B3(o){let e,t,n;return{c(){e=Qe("Redo ("),t=Qe(o[5]),n=Qe(")")},m(l,u){he(l,e,u),he(l,t,u),he(l,n,u)},p(l,u){u[0]&32&&Mi(t,l[5])},d(l){l&&(ue(e),ue(t),ue(n))}}}function F3(o){let e;return{c(){e=Qe("Redo")},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function ay(o){let e,t;return e=new v3({}),e.$on("close",o[27]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function O3(o){let e,t,n,l,u=Ei(o[6]).properties.name+"",d,a,_=o[1].area_km2.toFixed(1)+"",x,S,k,C,L,z,R,D,B,N,V,U,le,oe,H,ee,be,Oe,ne,ye,Ke,Ce,et,vt,pt,st,Ht,ii,Ot,Pt,Jt,Mt,ei,Vt,hi,xi,gi,Pi,ct,It=o[8]>0&&sy();function Ne($e,kt){return $e[4]==0?R3:D3}let je=Ne(o),rt=je(o);function xt($e,kt){return $e[5]==0?F3:B3}let we=xt(o),di=we(o),Ve=o[3]&&ay(o);return{c(){e=ce("div"),t=ce("p"),n=Qe("Editing neighbourhood "),l=ce("u"),d=Qe(u),a=Qe(`
      , with an area of `),x=Qe(_),S=Qe(" km²"),k=Re(),It&&It.c(),C=Re(),L=ce("div"),z=ce("button"),R=ce("img"),B=Qe(`
        Add a modal filter`),V=Re(),U=ce("button"),le=Qe("Add many modal filters along line"),H=Re(),ee=ce("button"),be=Qe("Reverse directions"),ne=Re(),ye=ce("button"),ye.textContent="Change modal filter type",Ke=Re(),Ce=ce("label"),et=ce("input"),vt=Qe(`
      Animate shortcuts`),pt=Re(),st=ce("label"),Ht=ce("input"),ii=Qe(`
      Include perimeter roads`),Ot=Re(),Pt=ce("div"),Jt=ce("button"),rt.c(),ei=Re(),Vt=ce("button"),di.c(),xi=Re(),Ve&&Ve.c(),En(R.src,D=`/ltn//filters/${o[9]}_icon.gif`)||Te(R,"src",D),Te(R,"width","30"),Te(R,"alt","Add a modal filter"),z.disabled=N=o[0]=="filter",Te(z,"data-tooltip","hotkey 1"),U.disabled=oe=o[0]=="freehand-filters",Te(U,"data-tooltip","hotkey 2"),ee.disabled=Oe=o[0]=="oneway",Te(ee,"data-tooltip","hotkey 3"),pn(L,"display","flex"),pn(L,"justify-content","space-between"),Te(et,"type","checkbox"),Te(Ht,"type","checkbox"),Jt.disabled=Mt=o[4]==0,Te(Jt,"data-tooltip","Ctrl+Z"),Vt.disabled=hi=o[5]==0,Te(Vt,"data-tooltip","Ctrl+Y"),pn(Pt,"display","flex"),pn(Pt,"justify-content","space-between"),Te(e,"slot","sidebar")},m($e,kt){he($e,e,kt),Q(e,t),Q(t,n),Q(t,l),Q(l,d),Q(t,a),Q(t,x),Q(t,S),Q(e,k),It&&It.m(e,null),Q(e,C),Q(e,L),Q(L,z),Q(z,R),Q(z,B),Q(L,V),Q(L,U),Q(U,le),Q(L,H),Q(L,ee),Q(ee,be),Q(e,ne),Q(e,ye),Q(e,Ke),Q(e,Ce),Q(Ce,et),et.checked=o[11],Q(Ce,vt),Q(e,pt),Q(e,st),Q(st,Ht),Ht.checked=o[10],Q(st,ii),Q(e,Ot),Q(e,Pt),Q(Pt,Jt),rt.m(Jt,null),Q(Pt,ei),Q(Pt,Vt),di.m(Vt,null),Q(e,xi),Ve&&Ve.m(e,null),gi=!0,Pi||(ct=[Et(z,"click",o[21]),Et(U,"click",o[22]),Et(ee,"click",o[23]),Et(ye,"click",o[24]),Et(et,"change",o[25]),Et(Ht,"change",o[26]),Et(Ht,"change",o[13]),Et(Jt,"click",o[17]),Et(Vt,"click",o[18])],Pi=!0)},p($e,kt){(!gi||kt[0]&64)&&u!==(u=Ei($e[6]).properties.name+"")&&Mi(d,u),(!gi||kt[0]&2)&&_!==(_=$e[1].area_km2.toFixed(1)+"")&&Mi(x,_),$e[8]>0?It||(It=sy(),It.c(),It.m(e,C)):It&&(It.d(1),It=null),(!gi||kt[0]&512&&!En(R.src,D=`/ltn//filters/${$e[9]}_icon.gif`))&&Te(R,"src",D),(!gi||kt[0]&1&&N!==(N=$e[0]=="filter"))&&(z.disabled=N),(!gi||kt[0]&1&&oe!==(oe=$e[0]=="freehand-filters"))&&(U.disabled=oe),(!gi||kt[0]&1&&Oe!==(Oe=$e[0]=="oneway"))&&(ee.disabled=Oe),kt[0]&2048&&(et.checked=$e[11]),kt[0]&1024&&(Ht.checked=$e[10]),je===(je=Ne($e))&&rt?rt.p($e,kt):(rt.d(1),rt=je($e),rt&&(rt.c(),rt.m(Jt,null))),(!gi||kt[0]&16&&Mt!==(Mt=$e[4]==0))&&(Jt.disabled=Mt),we===(we=xt($e))&&di?di.p($e,kt):(di.d(1),di=we($e),di&&(di.c(),di.m(Vt,null))),(!gi||kt[0]&32&&hi!==(hi=$e[5]==0))&&(Vt.disabled=hi),$e[3]?Ve?(Ve.p($e,kt),kt[0]&8&&ie(Ve,1)):(Ve=ay($e),Ve.c(),ie(Ve,1),Ve.m(e,null)):Ve&&(_i(),re(Ve,1,1,()=>{Ve=null}),yi())},i($e){gi||(ie(Ve),gi=!0)},o($e){re(Ve),gi=!1},d($e){$e&&ue(e),It&&It.d(),rt.d(),di.d(),Ve&&Ve.d(),Pi=!1,ln(ct)}}}function N3(o){let e,t,n,l;return e=new Ad({}),n=new zd({}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,d){Le(e,u,d),he(u,t,d),Le(n,u,d),l=!0},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function ly(o){let e,t=Math.round(o[37].speed_mph)+"",n,l;return{c(){e=Qe("("),n=Qe(t),l=Qe(" mph)")},m(u,d){he(u,e,d),he(u,n,d),he(u,l,d)},p(u,d){d[1]&64&&t!==(t=Math.round(u[37].speed_mph)+"")&&Mi(n,t)},d(u){u&&(ue(e),ue(n),ue(l))}}}function j3(o){let e;return{c(){e=ce("p"),e.textContent="Click to change direction"},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function U3(o){let e,t,n,l;return{c(){e=ce("div"),t=ce("img"),l=Qe(`
              Click to add modal filter`),En(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)||Te(t,"src",n),Te(t,"width","20"),Te(t,"alt","Add modal filter")},m(u,d){he(u,e,d),Q(e,t),Q(e,l)},p(u,d){d[0]&512&&!En(t.src,n=`/ltn//filters/${u[9]}_icon.gif`)&&Te(t,"src",n)},d(u){u&&ue(e)}}}function V3(o){let e,t=o[37].shortcuts+"",n,l,u=(o[37].name??"unnamed road")+"",d,a,_,x,S=o[37].speed_mph&&ly(o);function k(z,R){return z[0]=="filter"?U3:j3}let C=k(o),L=C(o);return{c(){e=ce("p"),n=Qe(t),l=Qe(" shortcuts through "),d=Qe(u),a=Re(),S&&S.c(),_=Re(),L.c(),x=Fn()},m(z,R){he(z,e,R),Q(e,n),Q(e,l),Q(e,d),Q(e,a),S&&S.m(e,null),he(z,_,R),L.m(z,R),he(z,x,R)},p(z,R){R[1]&64&&t!==(t=z[37].shortcuts+"")&&Mi(n,t),R[1]&64&&u!==(u=(z[37].name??"unnamed road")+"")&&Mi(d,u),z[37].speed_mph?S?S.p(z,R):(S=ly(z),S.c(),S.m(e,null)):S&&(S.d(1),S=null),C===(C=k(z))&&L?L.p(z,R):(L.d(1),L=C(z),L&&(L.c(),L.m(x.parentNode,x)))},d(z){z&&(ue(e),ue(_),ue(x)),S&&S.d(),L.d(z)}}}function q3(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[V3,({props:l})=>({37:l}),({props:l})=>[0,l?64:0]]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const d={};u[0]&513|u[1]&192&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function cy(o){let e,t;return e=new g3({props:{paths:o[7]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l[0]&128&&(u.paths=n[7]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function Z3(o){let e;return{c(){e=Qe("Click to delete")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function G3(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[Z3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l[1]&128&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function uy(o){let e,t;return e=new S3({props:{map:Ei(o[2])}}),e.$on("done",o[19]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l[0]&4&&(u.map=Ei(n[2])),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function W3(o){let e,t,n,l,u,d,a,_,x,S,k;t=new Pd({props:{gj:o[1]}}),l=new Bn({props:{data:o[1],generateId:!0,$$slots:{default:[N3]},$$scope:{ctx:o}}}),d=new Gu({props:{gj:o[1],interactive:o[0]=="filter"||o[0]=="oneway",onClickLine:o[14],$$slots:{"line-popup":[q3]},$$scope:{ctx:o}}});let C=o[11]&&cy(o);x=new Zu({props:{$$slots:{default:[G3]},$$scope:{ctx:o}}}),x.$on("click",o[15]);let L=o[0]=="freehand-filters"&&uy(o);return{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),u=Re(),Pe(d.$$.fragment),a=Re(),C&&C.c(),_=Re(),Pe(x.$$.fragment),S=Re(),L&&L.c(),Te(e,"slot","map")},m(z,R){he(z,e,R),Le(t,e,null),Q(e,n),Le(l,e,null),Q(e,u),Le(d,e,null),Q(e,a),C&&C.m(e,null),Q(e,_),Le(x,e,null),Q(e,S),L&&L.m(e,null),k=!0},p(z,R){const D={};R[0]&2&&(D.gj=z[1]),t.$set(D);const B={};R[0]&2&&(B.data=z[1]),R[1]&128&&(B.$$scope={dirty:R,ctx:z}),l.$set(B);const N={};R[0]&2&&(N.gj=z[1]),R[0]&1&&(N.interactive=z[0]=="filter"||z[0]=="oneway"),R[0]&513|R[1]&128&&(N.$$scope={dirty:R,ctx:z}),d.$set(N),z[11]?C?(C.p(z,R),R[0]&2048&&ie(C,1)):(C=cy(z),C.c(),ie(C,1),C.m(e,_)):C&&(_i(),re(C,1,1,()=>{C=null}),yi());const V={};R[1]&128&&(V.$$scope={dirty:R,ctx:z}),x.$set(V),z[0]=="freehand-filters"?L?(L.p(z,R),R[0]&1&&ie(L,1)):(L=uy(z),L.c(),ie(L,1),L.m(e,null)):L&&(_i(),re(L,1,1,()=>{L=null}),yi())},i(z){k||(ie(t.$$.fragment,z),ie(l.$$.fragment,z),ie(d.$$.fragment,z),ie(C),ie(x.$$.fragment,z),ie(L),k=!0)},o(z){re(t.$$.fragment,z),re(l.$$.fragment,z),re(d.$$.fragment,z),re(C),re(x.$$.fragment,z),re(L),k=!1},d(z){z&&ue(e),Ae(t),Ae(l),Ae(d),C&&C.d(),Ae(x),L&&L.d()}}}function $3(o){let e,t,n,l;return e=new ns({props:{$$slots:{map:[W3],sidebar:[O3],top:[z3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0,n||(l=Et(window,"keydown",o[16]),n=!0)},p(u,d){const a={};d[0]&8191|d[1]&128&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function H3(o,e,t){let n,l,u,d,a,_,x,S;dt(o,bs,Mt=>t(20,l=Mt)),dt(o,op,Mt=>t(9,u=Mt)),dt(o,Yn,Mt=>t(35,d=Mt)),dt(o,Au,Mt=>t(10,a=Mt)),dt(o,es,Mt=>t(2,_=Mt)),dt(o,Lg,Mt=>t(11,x=Mt)),dt(o,ri,Mt=>t(12,S=Mt));let k="filter",C=!1,L=0,z=0,R,D,B=d.getAllShortcuts();tr(()=>{_.doubleClickZoom.enable()});function N(Mt){t(1,D=d.renderNeighbourhood()),t(6,R=D.features.find(ei=>ei.properties.kind=="boundary")),t(4,L=D.undo_length),t(5,z=D.redo_length),t(7,B=d.getAllShortcuts()),ec()}function V(){d.setCurrentNeighbourhood(R.properties.name,a),At(bs,l++,l)}function U(Mt,ei){k=="filter"?(d.addModalFilter(ei,u),At(bs,l++,l)):k=="oneway"&&(d.toggleDirection(Mt.properties.road),At(bs,l++,l))}function le(Mt){let ei=Mt.detail.features[0];d.deleteModalFilter(ei.properties.road),At(bs,l++,l)}function oe(Mt){Mt.target.tagName!="INPUT"&&(Mt.ctrlKey&&Mt.key=="z"&&H(),Mt.ctrlKey&&Mt.key=="y"&&ee(),Mt.key=="1"&&t(0,k="filter"),Mt.key=="2"&&t(0,k="freehand-filters"),Mt.key=="3"&&t(0,k="oneway"))}function H(){d.undo(),At(bs,l++,l)}function ee(){d.redo(),At(bs,l++,l)}function be(Mt){let ei=Mt.detail;ei&&(d.addManyModalFilters(ei,u),At(bs,l++,l)),t(0,k="filter")}const Oe=()=>t(0,k="filter"),ne=()=>t(0,k="freehand-filters"),ye=()=>t(0,k="oneway"),Ke=()=>t(3,C=!0);function Ce(){x=this.checked,Lg.set(x)}function et(){a=this.checked,Au.set(a)}const vt=()=>t(3,C=!1),pt=()=>At(ri,S={mode:"title",firstLoad:!1},S),st=()=>At(ri,S={mode:"network"},S),Ht=()=>At(ri,S={mode:"view-shortcuts"},S),ii=()=>At(ri,S={mode:"route",prevMode:"neighbourhood"},S),Ot=()=>At(ri,S={mode:"impact-one-destination"},S),Pt=()=>At(ri,S={mode:"set-boundary",name:Ei(R).properties.name,existing:R},S),Jt=()=>At(ri,S={mode:"debug"},S);return o.$$.update=()=>{o.$$.dirty[0]&5&&(k=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),o.$$.dirty[0]&1048576&&N(),o.$$.dirty[0]&2&&t(8,n=D.features.filter(Mt=>Mt.properties.kind=="cell"&&Mt.properties.cell_color=="disconnected").length)},[k,D,_,C,L,z,R,B,n,u,a,x,S,V,U,le,oe,H,ee,be,l,Oe,ne,ye,Ke,Ce,et,vt,pt,st,Ht,ii,Ot,Pt,Jt]}class X3 extends Gt{constructor(e){super(),Zt(this,e,H3,$3,Ft,{},null,[-1,-1])}}function K3(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function J3(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function Y3(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function Q3(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z;return u=new zi({props:{$$slots:{default:[K3]},$$scope:{ctx:o}}}),u.$on("click",o[12]),_=new zi({props:{$$slots:{default:[J3]},$$scope:{ctx:o}}}),_.$on("click",o[13]),k=new zi({props:{$$slots:{default:[Y3]},$$scope:{ctx:o}}}),k.$on("click",o[6]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),Pe(_.$$.fragment),x=Re(),S=ce("li"),Pe(k.$$.fragment),C=Re(),L=ce("li"),L.textContent="Impact routing to one destination",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(R,D){he(R,e,D),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Le(_,a,null),Q(n,x),Q(n,S),Le(k,S,null),Q(n,C),Q(n,L),z=!0},p(R,D){const B={};D&262144&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const N={};D&262144&&(N.$$scope={dirty:D,ctx:R}),_.$set(N);const V={};D&262144&&(V.$$scope={dirty:D,ctx:R}),k.$set(V)},i(R){z||(ie(u.$$.fragment,R),ie(_.$$.fragment,R),ie(k.$$.fragment,R),z=!0)},o(R){re(u.$$.fragment,R),re(_.$$.fragment,R),re(k.$$.fragment,R),z=!1},d(R){R&&ue(e),Ae(u),Ae(_),Ae(k)}}}function eT(o){let e,t,n,l,u,d,a,_,x,S=o[4].highest_ratio.toFixed(1)+"",k,C;return t=new qu({}),t.$on("click",o[6]),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin aroun to change that destination.`,u=Re(),d=ce("p"),d.textContent="TODO: It's just distance right now, not time",a=Re(),_=ce("p"),x=Qe("Highest ratio is "),k=Qe(S),Te(e,"slot","sidebar")},m(L,z){he(L,e,z),Le(t,e,null),Q(e,n),Q(e,l),Q(e,u),Q(e,d),Q(e,a),Q(e,_),Q(_,x),Q(_,k),C=!0},p(L,z){(!C||z&16)&&S!==(S=L[4].highest_ratio.toFixed(1)+"")&&Mi(k,S)},i(L){C||(ie(t.$$.fragment,L),C=!0)},o(L){re(t.$$.fragment,L),C=!1},d(L){L&&ue(e),Ae(t)}}}function tT(o){let e,t;const n=[gn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new Cs({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function iT(o){let e,t=(o[17].distance_after/o[17].distance_before).toFixed(1)+"",n;return{c(){e=Qe("Ratio "),n=Qe(t)},m(l,u){he(l,e,u),he(l,n,u)},p(l,u){u&131072&&t!==(t=(l[17].distance_after/l[17].distance_before).toFixed(1)+"")&&Mi(n,t)},d(l){l&&(ue(e),ue(n))}}}function nT(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[iT,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&393216&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function rT(o){let e,t,n;const l=[gn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",Math.max(o[4].highest_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function u(a){o[9](a)}let d={$$slots:{default:[nT]},$$scope:{ctx:o}};for(let a=0;a<l.length;a+=1)d=an(d,l[a]);return o[0]!==void 0&&(d.hovered=o[0]),e=new fo({props:d}),Ki.push(()=>Wr(e,"hovered",u)),e.$on("click",o[10]),{c(){Pe(e.$$.fragment)},m(a,_){Le(e,a,_),n=!0},p(a,_){const x=_&16?Tu(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",Math.max(a[4].highest_ratio,1.1),"red"],"line-width":5}},l[2]]):{};_&262144&&(x.$$scope={dirty:_,ctx:a}),!t&&_&1&&(t=!0,x.hovered=a[0],Gr(()=>t=!1)),e.$set(x)},i(a){n||(ie(e.$$.fragment,a),n=!0)},o(a){re(e.$$.fragment,a),n=!1},d(a){Ae(e,a)}}}function oT(o){let e,t;const n=[gn("compare-route"),{paint:{"line-width":10,"line-color":U0(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function sT(o){let e;return{c(){e=Qe("X")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function aT(o){let e,t,n,l,u,d,a,_,x,S,k,C;t=new Bn({props:{data:Ei(o[2]).renderNeighbourhood(),$$slots:{default:[tT]},$$scope:{ctx:o}}}),l=new Bn({props:{data:o[4],generateId:!0,$$slots:{default:[rT]},$$scope:{ctx:o}}}),d=new Bn({props:{data:o[3],$$slots:{default:[oT]},$$scope:{ctx:o}}}),_=new Zu({});function L(R){o[11](R)}let z={draggable:!0,$$slots:{default:[sT]},$$scope:{ctx:o}};return o[1]!==void 0&&(z.lngLat=o[1]),S=new Fu({props:z}),Ki.push(()=>Wr(S,"lngLat",L)),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),u=Re(),Pe(d.$$.fragment),a=Re(),Pe(_.$$.fragment),x=Re(),Pe(S.$$.fragment),Te(e,"slot","map")},m(R,D){he(R,e,D),Le(t,e,null),Q(e,n),Le(l,e,null),Q(e,u),Le(d,e,null),Q(e,a),Le(_,e,null),Q(e,x),Le(S,e,null),C=!0},p(R,D){const B={};D&4&&(B.data=Ei(R[2]).renderNeighbourhood()),D&262144&&(B.$$scope={dirty:D,ctx:R}),t.$set(B);const N={};D&16&&(N.data=R[4]),D&262161&&(N.$$scope={dirty:D,ctx:R}),l.$set(N);const V={};D&8&&(V.data=R[3]),D&262144&&(V.$$scope={dirty:D,ctx:R}),d.$set(V);const U={};D&262144&&(U.$$scope={dirty:D,ctx:R}),!k&&D&2&&(k=!0,U.lngLat=R[1],Gr(()=>k=!1)),S.$set(U)},i(R){C||(ie(t.$$.fragment,R),ie(l.$$.fragment,R),ie(d.$$.fragment,R),ie(_.$$.fragment,R),ie(S.$$.fragment,R),C=!0)},o(R){re(t.$$.fragment,R),re(l.$$.fragment,R),re(d.$$.fragment,R),re(_.$$.fragment,R),re(S.$$.fragment,R),C=!1},d(R){R&&ue(e),Ae(t),Ae(l),Ae(d),Ae(_),Ae(S)}}}function lT(o){let e,t,n,l;return e=new _0({}),e.$on("contextmenu",o[8]),n=new ns({props:{$$slots:{map:[aT],sidebar:[eT],top:[Q3]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,d){Le(e,u,d),he(u,t,d),Le(n,u,d),l=!0},p(u,[d]){const a={};d&262207&&(a.$$scope={dirty:d,ctx:u}),n.$set(a)},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function cT(o,e,t){let n,l,u,d,a,_,x;dt(o,od,U=>t(1,u=U)),dt(o,ri,U=>t(5,d=U)),dt(o,Lu,U=>t(14,a=U)),dt(o,Iu,U=>t(15,_=U)),dt(o,Yn,U=>t(2,x=U));function S(){At(ri,d={mode:"neighbourhood"},d)}let k=null;function C(U){return U?x.compareRoute(new Ts.LngLat(U.properties.pt1_x,U.properties.pt1_y),u,1):Xl()}function L(U){At(Iu,_=new Ts.LngLat(U.properties.pt1_x,U.properties.pt1_y),_),At(Lu,a=u,a),At(ri,d={mode:"route",prevMode:"impact-one-destination"},d)}function z(U){At(od,u=U.detail.lngLat,u)}function R(U){k=U,t(0,k)}const D=U=>L(U.detail.features[0]);function B(U){u=U,od.set(u)}const N=()=>At(ri,d={mode:"title",firstLoad:!1},d),V=()=>At(ri,d={mode:"network"},d);return o.$$.update=()=>{o.$$.dirty&6&&t(4,n=x.impactToOneDestination(u)),o.$$.dirty&1&&t(3,l=C(k))},[k,u,x,l,n,d,S,L,z,R,D,B,N,V]}class uT extends Gt{constructor(e){super(),Zt(this,e,cT,lT,Ft,{})}}const Z0="/ltn/assets/delete-ec75e756.svg",G0="/ltn/assets/edit-f3f51206.svg";function hy(o,e,t){const n=o.slice();return n[20]=e[t],n}function hT(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function dT(o){let e;return{c(){e=ce("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function fT(o){let e;return{c(){e=Qe("Route")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function pT(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R;return u=new zi({props:{$$slots:{default:[hT]},$$scope:{ctx:o}}}),u.$on("click",o[16]),x=new qp({props:{$$slots:{default:[dT]},$$scope:{ctx:o}}}),z=new zi({props:{$$slots:{default:[fT]},$$scope:{ctx:o}}}),z.$on("click",o[17]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),_=Qe(`Pick neighbourhood
          `),Pe(x.$$.fragment),S=Re(),k=ce("nav"),C=ce("ul"),L=ce("li"),Pe(z.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),pn(e,"display","flex"),pn(e,"justify-content","space-between")},m(D,B){he(D,e,B),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Q(a,_),Le(x,a,null),Q(e,S),Q(e,k),Q(k,C),Q(C,L),Le(z,L,null),R=!0},p(D,B){const N={};B&8388608&&(N.$$scope={dirty:B,ctx:D}),u.$set(N);const V={};B&8388608&&(V.$$scope={dirty:B,ctx:D}),x.$set(V);const U={};B&8388608&&(U.$$scope={dirty:B,ctx:D}),z.$set(U)},i(D){R||(ie(u.$$.fragment,D),ie(x.$$.fragment,D),ie(z.$$.fragment,D),R=!0)},o(D){re(u.$$.fragment,D),re(x.$$.fragment,D),re(z.$$.fragment,D),R=!1},d(D){D&&ue(e),Ae(u),Ae(x),Ae(z)}}}function mT(o){let e;return{c(){e=Qe("Draw a new boundary")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function gT(o){let e;return{c(){e=Qe("Use an auto-generated boundary")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function _T(o){let e=o[20]+"",t;return{c(){t=Qe(e)},m(n,l){he(n,t,l)},p(n,l){l&2&&e!==(e=n[20]+"")&&Mi(t,e)},d(n){n&&ue(t)}}}function dy(o){let e,t,n,l,u,d,a,_,x,S,k;function C(){return o[13](o[20])}n=new zi({props:{$$slots:{default:[_T]},$$scope:{ctx:o}}}),n.$on("click",C);function L(){return o[14](o[20])}function z(){return o[15](o[20])}return{c(){e=ce("li"),t=ce("span"),Pe(n.$$.fragment),l=Re(),u=ce("button"),u.innerHTML=`<img src="${G0}" alt="Rename neighbourhood"/>`,d=Re(),a=ce("button"),a.innerHTML=`<img src="${Z0}" alt="Delete neighbourhood"/>`,_=Re(),Te(u,"class","secondary"),Te(a,"class","secondary"),pn(t,"display","flex"),pn(t,"justify-content","space-between")},m(R,D){he(R,e,D),Q(e,t),Le(n,t,null),Q(t,l),Q(t,u),Q(t,d),Q(t,a),Q(e,_),x=!0,S||(k=[Et(u,"click",L),Et(a,"click",z)],S=!0)},p(R,D){o=R;const B={};D&8388610&&(B.$$scope={dirty:D,ctx:o}),n.$set(B)},i(R){x||(ie(n.$$.fragment,R),x=!0)},o(R){re(n.$$.fragment,R),x=!1},d(R){R&&ue(e),Ae(n),S=!1,ln(k)}}}function yT(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B,N,V,U,le;n=new zi({props:{$$slots:{default:[mT]},$$scope:{ctx:o}}}),n.$on("click",o[7]),d=new zi({props:{$$slots:{default:[gT]},$$scope:{ctx:o}}}),d.$on("click",o[12]);let oe=Jn(o[1]),H=[];for(let be=0;be<oe.length;be+=1)H[be]=dy(hy(o,oe,be));const ee=be=>re(H[be],1,1,()=>{H[be]=null});return{c(){e=ce("div"),t=ce("div"),Pe(n.$$.fragment),l=Re(),u=ce("div"),Pe(d.$$.fragment),a=Re(),_=ce("ul");for(let be=0;be<H.length;be+=1)H[be].c();x=Re(),S=ce("hr"),k=Re(),C=ce("p"),L=Qe("Current project: "),z=Qe(o[2]),R=Re(),D=ce("button"),D.textContent="Export project to GeoJSON",B=Re(),N=ce("button"),N.textContent="Debug route-snapper",Te(N,"class","secondary"),Te(e,"slot","sidebar")},m(be,Oe){he(be,e,Oe),Q(e,t),Le(n,t,null),Q(e,l),Q(e,u),Le(d,u,null),Q(e,a),Q(e,_);for(let ne=0;ne<H.length;ne+=1)H[ne]&&H[ne].m(_,null);Q(e,x),Q(e,S),Q(e,k),Q(e,C),Q(C,L),Q(C,z),Q(e,R),Q(e,D),Q(e,B),Q(e,N),V=!0,U||(le=[Et(D,"click",o[8]),Et(N,"click",o[9])],U=!0)},p(be,Oe){const ne={};Oe&8388608&&(ne.$$scope={dirty:Oe,ctx:be}),n.$set(ne);const ye={};if(Oe&8388608&&(ye.$$scope={dirty:Oe,ctx:be}),d.$set(ye),Oe&114){oe=Jn(be[1]);let Ke;for(Ke=0;Ke<oe.length;Ke+=1){const Ce=hy(be,oe,Ke);H[Ke]?(H[Ke].p(Ce,Oe),ie(H[Ke],1)):(H[Ke]=dy(Ce),H[Ke].c(),ie(H[Ke],1),H[Ke].m(_,null))}for(_i(),Ke=oe.length;Ke<H.length;Ke+=1)ee(Ke);yi()}(!V||Oe&4)&&Mi(z,be[2])},i(be){if(!V){ie(n.$$.fragment,be),ie(d.$$.fragment,be);for(let Oe=0;Oe<oe.length;Oe+=1)ie(H[Oe]);V=!0}},o(be){re(n.$$.fragment,be),re(d.$$.fragment,be),H=H.filter(Boolean);for(let Oe=0;Oe<H.length;Oe+=1)re(H[Oe]);V=!1},d(be){be&&ue(e),Ae(n),Ae(d),Ss(H,be),U=!1,ln(le)}}}function bT(o){let e,t=o[19].name+"",n;return{c(){e=ce("p"),n=Qe(t)},m(l,u){he(l,e,u),Q(e,n)},p(l,u){u&524288&&t!==(t=l[19].name+"")&&Mi(n,t)},d(l){l&&ue(e)}}}function vT(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[bT,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&8912896&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function wT(o){let e,t;const n=[gn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":Fa(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[vT]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new Cs({props:l}),e.$on("click",o[11]),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};d&8388608&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function xT(o){let e,t,n,l,u;return t=new Bn({props:{data:o[0],generateId:!0,$$slots:{default:[wT]},$$scope:{ctx:o}}}),l=new Zu({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),Te(e,"slot","map")},m(d,a){he(d,e,a),Le(t,e,null),Q(e,n),Le(l,e,null),u=!0},p(d,a){const _={};a&1&&(_.data=d[0]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(ie(t.$$.fragment,d),ie(l.$$.fragment,d),u=!0)},o(d){re(t.$$.fragment,d),re(l.$$.fragment,d),u=!1},d(d){d&&ue(e),Ae(t),Ae(l)}}}function kT(o){let e,t;return e=new ns({props:{$$slots:{map:[xT],sidebar:[yT],top:[pT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&8388623&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function ST(o,e,t){let n,l,u,d,a,_;dt(o,Yn,oe=>t(10,u=oe)),dt(o,Es,oe=>t(2,d=oe)),dt(o,ri,oe=>t(3,a=oe)),dt(o,Au,oe=>t(18,_=oe));function x(oe){u.setCurrentNeighbourhood(oe,_),At(ri,a={mode:"neighbourhood"},a)}function S(oe){window.confirm(`Really delete neighbourhood ${oe}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(oe),ec(),t(0,n=u.toSavefile()))}function k(oe){let H=bp(u,`Rename neighbourhood ${oe} to what?`,oe);H&&(u.renameNeighbourhoodBoundary(oe,H),ec(),t(0,n=u.toSavefile()))}function C(){let oe=bp(u,"What do you want to name the neighbourhood?","");oe&&At(ri,a={mode:"set-boundary",name:oe,existing:null},a)}function L(){pd(d+".geojson",JSON.stringify(u.toSavefile()))}function z(){pd("debug_route_snapper.geojson",u.toRouteSnapperGj())}const R=oe=>x(Ei(oe.detail.features[0].properties).name),D=()=>At(ri,a={mode:"auto-boundaries"},a),B=oe=>x(oe),N=oe=>k(oe),V=oe=>S(oe),U=()=>At(ri,a={mode:"title",firstLoad:!1},a),le=()=>At(ri,a={mode:"route",prevMode:"network"},a);return o.$$.update=()=>{o.$$.dirty&1024&&t(0,n=u.toSavefile()),o.$$.dirty&1&&t(1,l=n.features.filter(oe=>oe.properties.kind=="boundary").map(oe=>oe.properties.name))},[n,l,d,a,x,S,k,C,L,z,u,R,D,B,N,V,U,le]}class TT extends Gt{constructor(e){super(),Zt(this,e,ST,kT,Ft,{})}}function ET(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function CT(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function fy(o){let e,t,n;return t=new zi({props:{$$slots:{default:[MT]},$$scope:{ctx:o}}}),t.$on("click",o[13]),{c(){e=ce("li"),Pe(t.$$.fragment)},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const d={};u&16384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function MT(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function IT(o){let e,t,n,l,u,d,a,_,x,S,k,C;u=new zi({props:{$$slots:{default:[ET]},$$scope:{ctx:o}}}),u.$on("click",o[11]),_=new zi({props:{$$slots:{default:[CT]},$$scope:{ctx:o}}}),_.$on("click",o[12]);let L=o[0]=="neighbourhood"&&fy(o);return{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),Pe(_.$$.fragment),x=Re(),L&&L.c(),S=Re(),k=ce("li"),k.textContent="Routing",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(z,R){he(z,e,R),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Le(_,a,null),Q(n,x),L&&L.m(n,null),Q(n,S),Q(n,k),C=!0},p(z,R){const D={};R&16384&&(D.$$scope={dirty:R,ctx:z}),u.$set(D);const B={};R&16384&&(B.$$scope={dirty:R,ctx:z}),_.$set(B),z[0]=="neighbourhood"?L?(L.p(z,R),R&1&&ie(L,1)):(L=fy(z),L.c(),ie(L,1),L.m(n,S)):L&&(_i(),re(L,1,1,()=>{L=null}),yi())},i(z){C||(ie(u.$$.fragment,z),ie(_.$$.fragment,z),ie(L),C=!0)},o(z){re(u.$$.fragment,z),re(_.$$.fragment,z),re(L),C=!1},d(z){z&&ue(e),Ae(u),Ae(_),L&&L.d()}}}function LT(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B;return t=new qu({}),t.$on("click",o[7]),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent="Drag markers for a route",u=Re(),d=ce("p"),d.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,a=Re(),_=ce("label"),x=Qe("Slow-down factor for main roads: "),S=Qe(o[1]),k=Re(),C=ce("input"),L=Re(),z=ce("i"),z.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Te(C,"type","range"),Te(C,"min","1.0"),Te(C,"max","5.0"),Te(C,"step","0.1"),Te(e,"slot","sidebar")},m(N,V){he(N,e,V),Le(t,e,null),Q(e,n),Q(e,l),Q(e,u),Q(e,d),Q(e,a),Q(e,_),Q(_,x),Q(_,S),Q(_,k),Q(_,C),Hn(C,o[1]),Q(e,L),Q(e,z),R=!0,D||(B=[Et(C,"change",o[10]),Et(C,"input",o[10])],D=!0)},p(N,V){(!R||V&2)&&Mi(S,N[1]),V&2&&Hn(C,N[1])},i(N){R||(ie(t.$$.fragment,N),R=!0)},o(N){re(t.$$.fragment,N),R=!1},d(N){N&&ue(e),Ae(t),D=!1,ln(B)}}}function py(o){let e,t,n,l,u,d;return e=new Pd({props:{gj:Ei(o[4]).renderNeighbourhood()}}),n=new Bn({props:{data:Ei(o[4]).renderNeighbourhood(),generateId:!0,$$slots:{default:[AT]},$$scope:{ctx:o}}}),u=new Gu({props:{gj:Ei(o[4]).renderNeighbourhood(),interactive:!1}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment)},m(a,_){Le(e,a,_),he(a,t,_),Le(n,a,_),he(a,l,_),Le(u,a,_),d=!0},p(a,_){const x={};_&16&&(x.gj=Ei(a[4]).renderNeighbourhood()),e.$set(x);const S={};_&16&&(S.data=Ei(a[4]).renderNeighbourhood()),_&16384&&(S.$$scope={dirty:_,ctx:a}),n.$set(S);const k={};_&16&&(k.gj=Ei(a[4]).renderNeighbourhood()),u.$set(k)},i(a){d||(ie(e.$$.fragment,a),ie(n.$$.fragment,a),ie(u.$$.fragment,a),d=!0)},o(a){re(e.$$.fragment,a),re(n.$$.fragment,a),re(u.$$.fragment,a),d=!1},d(a){a&&(ue(t),ue(l)),Ae(e,a),Ae(n,a),Ae(u,a)}}}function AT(o){let e,t,n,l;return e=new Ad({}),n=new zd({}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,d){Le(e,u,d),he(u,t,d),Le(n,u,d),l=!0},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function PT(o){let e,t;const n=[gn("compare-route"),{paint:{"line-width":10,"line-color":U0(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function zT(o){let e;return{c(){e=Qe("A")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function DT(o){let e;return{c(){e=Qe("B")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function RT(o){let e,t,n,l,u,d,a,_,x,S,k,C,L=o[0]=="neighbourhood"&&py(o);n=new Zu({}),u=new Bn({props:{data:o[5],$$slots:{default:[PT]},$$scope:{ctx:o}}});function z(N){o[8](N)}let R={draggable:!0,$$slots:{default:[zT]},$$scope:{ctx:o}};o[3]!==void 0&&(R.lngLat=o[3]),a=new Fu({props:R}),Ki.push(()=>Wr(a,"lngLat",z));function D(N){o[9](N)}let B={draggable:!0,$$slots:{default:[DT]},$$scope:{ctx:o}};return o[2]!==void 0&&(B.lngLat=o[2]),S=new Fu({props:B}),Ki.push(()=>Wr(S,"lngLat",D)),{c(){e=ce("div"),L&&L.c(),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),d=Re(),Pe(a.$$.fragment),x=Re(),Pe(S.$$.fragment),Te(e,"slot","map")},m(N,V){he(N,e,V),L&&L.m(e,null),Q(e,t),Le(n,e,null),Q(e,l),Le(u,e,null),Q(e,d),Le(a,e,null),Q(e,x),Le(S,e,null),C=!0},p(N,V){N[0]=="neighbourhood"?L?(L.p(N,V),V&1&&ie(L,1)):(L=py(N),L.c(),ie(L,1),L.m(e,t)):L&&(_i(),re(L,1,1,()=>{L=null}),yi());const U={};V&32&&(U.data=N[5]),V&16384&&(U.$$scope={dirty:V,ctx:N}),u.$set(U);const le={};V&16384&&(le.$$scope={dirty:V,ctx:N}),!_&&V&8&&(_=!0,le.lngLat=N[3],Gr(()=>_=!1)),a.$set(le);const oe={};V&16384&&(oe.$$scope={dirty:V,ctx:N}),!k&&V&4&&(k=!0,oe.lngLat=N[2],Gr(()=>k=!1)),S.$set(oe)},i(N){C||(ie(L),ie(n.$$.fragment,N),ie(u.$$.fragment,N),ie(a.$$.fragment,N),ie(S.$$.fragment,N),C=!0)},o(N){re(L),re(n.$$.fragment,N),re(u.$$.fragment,N),re(a.$$.fragment,N),re(S.$$.fragment,N),C=!1},d(N){N&&ue(e),L&&L.d(),Ae(n),Ae(u),Ae(a),Ae(S)}}}function BT(o){let e,t;return e=new ns({props:{$$slots:{map:[RT],sidebar:[LT],top:[IT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&16511&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function FT(o,e,t){let n,l,u,d,a,_;dt(o,ri,B=>t(6,l=B)),dt(o,Ig,B=>t(1,u=B)),dt(o,Lu,B=>t(2,d=B)),dt(o,Iu,B=>t(3,a=B)),dt(o,Yn,B=>t(4,_=B));let{prevMode:x}=e;function S(){At(ri,l={mode:x},l)}function k(B){a=B,Iu.set(a)}function C(B){d=B,Lu.set(d)}function L(){u=kp(this.value),Ig.set(u)}const z=()=>At(ri,l={mode:"title",firstLoad:!1},l),R=()=>At(ri,l={mode:"network"},l),D=()=>At(ri,l={mode:"neighbourhood"},l);return o.$$set=B=>{"prevMode"in B&&t(0,x=B.prevMode)},o.$$.update=()=>{o.$$.dirty&30&&t(5,n=_.compareRoute(a,d,u))},[x,u,d,a,_,n,l,S,k,C,L,z,R,D]}class OT extends Gt{constructor(e){super(),Zt(this,e,FT,BT,Ft,{prevMode:0})}}let tc=wi(null);const ko=wi([]);function W0(o){if(o.length<3)return JSON.parse(Lr(tc).inner.calculateRoute(o));let e=JSON.parse(JSON.stringify(o));e.push(e[0]);let t=JSON.parse(Lr(tc).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:NT}=kd,jT=o=>({}),my=o=>({}),UT=o=>({}),gy=o=>({});function _y(o,e,t){const n=o.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function yy(o,e,t){const n=o.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function VT(o){let e,t;const n=o[24]["extra-top"],l=Ni(n,o,o[38],my);return{c(){e=ce("div"),l&&l.c(),Te(e,"slot","top")},m(u,d){he(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&128)&&Ui(l,n,u,u[38],t?ji(n,u[38],d,jT):Vi(u[38]),my)},i(u){t||(ie(l,u),t=!0)},o(u){re(l,u),t=!1},d(u){u&&ue(e),l&&l.d(u)}}}function qT(o){let e,t,n,l,u;return{c(){e=ce("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=Re(),n=ce("p"),n.textContent="Keyboard shortcuts:",l=Re(),u=ce("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(d,a){he(d,e,a),he(d,t,a),he(d,n,a),he(d,l,a),he(d,u,a)},p:Dt,d(d){d&&(ue(e),ue(t),ue(n),ue(l),ue(u))}}}function ZT(o){let e,t=o[8].length+"",n,l;return{c(){e=Qe("Undo ("),n=Qe(t),l=Qe(")")},m(u,d){he(u,e,d),he(u,n,d),he(u,l,d)},p(u,d){d[0]&256&&t!==(t=u[8].length+"")&&Mi(n,t)},d(u){u&&(ue(e),ue(n),ue(l))}}}function GT(o){let e;return{c(){e=Qe("Undo")},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function WT(o){let e;return{c(){e=ce("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function $T(o){let e,t,n,l,u,d,a,_,x,S,k,C,L;return k=qy(o[36][0]),{c(){e=ce("fieldset"),t=ce("label"),n=ce("input"),l=Qe(`
          Snap to roads`),u=Re(),d=ce("label"),a=ce("input"),_=Qe(`
          Draw anywhere`),x=Re(),S=ce("p"),S.textContent="Click to add at least 3 points",Te(n,"type","radio"),n.__value="snap",Hn(n,n.__value),Te(a,"type","radio"),a.__value="free",Hn(a,a.__value),k.p(n,a)},m(z,R){he(z,e,R),Q(e,t),Q(t,n),n.checked=n.__value===o[7],Q(t,l),Q(e,u),Q(e,d),Q(d,a),a.checked=a.__value===o[7],Q(d,_),he(z,x,R),he(z,S,R),C||(L=[Et(n,"change",o[35]),Et(a,"change",o[37])],C=!0)},p(z,R){R[0]&128&&(n.checked=n.__value===z[7]),R[0]&128&&(a.checked=a.__value===z[7])},d(z){z&&(ue(e),ue(x),ue(S)),k.r(),C=!1,ln(L)}}}function HT(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B;const N=o[24]["extra-sidebar"],V=Ni(N,o,o[38],gy);S=new qp({props:{$$slots:{default:[qT]},$$scope:{ctx:o}}});function U(Oe,ne){return Oe[8].length==0?GT:ZT}let le=U(o),oe=le(o);function H(Oe,ne){return Oe[5].length<3?$T:WT}let ee=H(o),be=ee(o);return{c(){e=ce("div"),V&&V.c(),t=Re(),n=ce("div"),l=ce("button"),u=Qe("Finish"),a=Re(),_=ce("button"),_.textContent="Cancel",x=Re(),Pe(S.$$.fragment),k=Re(),C=ce("button"),oe.c(),z=Re(),be.c(),l.disabled=d=o[5].length<3,Te(_,"class","secondary"),pn(n,"display","flex"),Te(C,"class","secondary"),C.disabled=L=o[8].length==0,Te(e,"slot","sidebar")},m(Oe,ne){he(Oe,e,ne),V&&V.m(e,null),Q(e,t),Q(e,n),Q(n,l),Q(l,u),Q(n,a),Q(n,_),Q(n,x),Le(S,n,null),Q(e,k),Q(e,C),oe.m(C,null),Q(e,z),be.m(e,null),R=!0,D||(B=[Et(l,"click",function(){Kl(o[0])&&o[0].apply(this,arguments)}),Et(_,"click",function(){Kl(o[1])&&o[1].apply(this,arguments)}),Et(C,"click",o[11])],D=!0)},p(Oe,ne){o=Oe,V&&V.p&&(!R||ne[1]&128)&&Ui(V,N,o,o[38],R?ji(N,o[38],ne,UT):Vi(o[38]),gy),(!R||ne[0]&32&&d!==(d=o[5].length<3))&&(l.disabled=d);const ye={};ne[1]&128&&(ye.$$scope={dirty:ne,ctx:o}),S.$set(ye),le===(le=U(o))&&oe?oe.p(o,ne):(oe.d(1),oe=le(o),oe&&(oe.c(),oe.m(C,null))),(!R||ne[0]&256&&L!==(L=o[8].length==0))&&(C.disabled=L),ee===(ee=H(o))&&be?be.p(o,ne):(be.d(1),be=ee(o),be&&(be.c(),be.m(e,null)))},i(Oe){R||(ie(V,Oe),ie(S.$$.fragment,Oe),R=!0)},o(Oe){re(V,Oe),re(S.$$.fragment,Oe),R=!1},d(Oe){Oe&&ue(e),V&&V.d(Oe),Ae(S),oe.d(),be.d(),D=!1,ln(B)}}}function XT(o){let e;return{c(){e=ce("span"),Te(e,"class","dot svelte-1cj4rwq"),cr(e,"snapped-node",o[47].snapped),cr(e,"free-node",!o[47].snapped),cr(e,"hide",o[4])},m(t,n){he(t,e,n)},p(t,n){n[0]&512&&cr(e,"snapped-node",t[47].snapped),n[0]&512&&cr(e,"free-node",!t[47].snapped),n[0]&16&&cr(e,"hide",t[4])},d(t){t&&ue(e)}}}function by(o){let e,t,n;function l(x){o[25](x,o[47])}function u(){return o[26](o[47])}function d(){return o[27](o[47])}function a(){return o[28](o[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[XT]},$$scope:{ctx:o}};return o[47].point!==void 0&&(_.lngLat=o[47].point),e=new Id({props:_}),Ki.push(()=>Wr(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",o[19]),e.$on("click",a),{c(){Pe(e.$$.fragment)},m(x,S){Le(e,x,S),n=!0},p(x,S){o=x;const k={};S[0]&528|S[1]&128&&(k.$$scope={dirty:S,ctx:o}),!t&&S[0]&512&&(t=!0,k.lngLat=o[47].point,Gr(()=>t=!1)),e.$set(k)},i(x){n||(ie(e.$$.fragment,x),n=!0)},o(x){re(e.$$.fragment,x),n=!1},d(x){Ae(e,x)}}}function KT(o){let e;return{c(){e=ce("span"),e.textContent=`${o[46]+1}`,Te(e,"class","dot svelte-1cj4rwq"),cr(e,"snapped",o[44].snapped)},m(t,n){he(t,e,n)},p(t,n){n[0]&32&&cr(e,"snapped",t[44].snapped)},d(t){t&&ue(e)}}}function vy(o){let e,t,n;function l(_){o[29](_,o[44])}function u(){return o[30](o[46])}function d(){return o[31](o[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[KT]},$$scope:{ctx:o}};return o[44].point!==void 0&&(a.lngLat=o[44].point),e=new Id({props:a}),Ki.push(()=>Wr(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",o[32]),e.$on("mouseleave",o[33]),e.$on("dragstart",o[21]),e.$on("dragend",o[34]),{c(){Pe(e.$$.fragment)},m(_,x){Le(e,_,x),n=!0},p(_,x){o=_;const S={};x[0]&32|x[1]&128&&(S.$$scope={dirty:x,ctx:o}),!t&&x[0]&32&&(t=!0,S.lngLat=o[44].point,Gr(()=>t=!1)),e.$set(S)},i(_){n||(ie(e.$$.fragment,_),n=!0)},o(_){re(e.$$.fragment,_),n=!1},d(_){Ae(e,_)}}}function JT(o){let e,t,n,l;const u=[gn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let d={};for(let x=0;x<u.length;x+=1)d=an(d,u[x]);e=new fo({props:d});const a=[gn("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let x=0;x<a.length;x+=1)_=an(_,a[x]);return n=new Cs({props:_}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(x,S){Le(e,x,S),he(x,t,S),Le(n,x,S),l=!0},p(x,S){const k={};e.$set(k);const C={};n.$set(C)},i(x){l||(ie(e.$$.fragment,x),ie(n.$$.fragment,x),l=!0)},o(x){re(e.$$.fragment,x),re(n.$$.fragment,x),l=!1},d(x){x&&ue(t),Ae(e,x),Ae(n,x)}}}function YT(o){let e,t;return e=new fo({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function QT(o){let e,t,n,l,u,d,a,_,x;t=new _0({}),t.$on("click",o[12]),t.$on("mousemove",o[13]);let S=Jn(o[9]),k=[];for(let D=0;D<S.length;D+=1)k[D]=by(yy(o,S,D));const C=D=>re(k[D],1,1,()=>{k[D]=null});let L=Jn(o[5]),z=[];for(let D=0;D<L.length;D+=1)z[D]=vy(_y(o,L,D));const R=D=>re(z[D],1,1,()=>{z[D]=null});return d=new Bn({props:{data:o[16](o[6],o[5]),generateId:!0,$$slots:{default:[JT]},$$scope:{ctx:o}}}),_=new Bn({props:{data:o[10],$$slots:{default:[YT]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re();for(let D=0;D<k.length;D+=1)k[D].c();l=Re();for(let D=0;D<z.length;D+=1)z[D].c();u=Re(),Pe(d.$$.fragment),a=Re(),Pe(_.$$.fragment),Te(e,"slot","map")},m(D,B){he(D,e,B),Le(t,e,null),Q(e,n);for(let N=0;N<k.length;N+=1)k[N]&&k[N].m(e,null);Q(e,l);for(let N=0;N<z.length;N+=1)z[N]&&z[N].m(e,null);Q(e,u),Le(d,e,null),Q(e,a),Le(_,e,null),x=!0},p(D,B){if(B[0]&918032){S=Jn(D[9]);let U;for(U=0;U<S.length;U+=1){const le=yy(D,S,U);k[U]?(k[U].p(le,B),ie(k[U],1)):(k[U]=by(le),k[U].c(),ie(k[U],1),k[U].m(e,l))}for(_i(),U=S.length;U<k.length;U+=1)C(U);yi()}if(B[0]&2146348){L=Jn(D[5]);let U;for(U=0;U<L.length;U+=1){const le=_y(D,L,U);z[U]?(z[U].p(le,B),ie(z[U],1)):(z[U]=vy(le),z[U].c(),ie(z[U],1),z[U].m(e,u))}for(_i(),U=L.length;U<z.length;U+=1)R(U);yi()}const N={};B[0]&96&&(N.data=D[16](D[6],D[5])),B[1]&128&&(N.$$scope={dirty:B,ctx:D}),d.$set(N);const V={};B[0]&1024&&(V.data=D[10]),B[1]&128&&(V.$$scope={dirty:B,ctx:D}),_.$set(V)},i(D){if(!x){ie(t.$$.fragment,D);for(let B=0;B<S.length;B+=1)ie(k[B]);for(let B=0;B<L.length;B+=1)ie(z[B]);ie(d.$$.fragment,D),ie(_.$$.fragment,D),x=!0}},o(D){re(t.$$.fragment,D),k=k.filter(Boolean);for(let B=0;B<k.length;B+=1)re(k[B]);z=z.filter(Boolean);for(let B=0;B<z.length;B+=1)re(z[B]);re(d.$$.fragment,D),re(_.$$.fragment,D),x=!1},d(D){D&&ue(e),Ae(t),Ss(k,D),Ss(z,D),Ae(d),Ae(_)}}}function e5(o){let e,t,n,l;return e=new ns({props:{$$slots:{map:[QT],sidebar:[HT],top:[VT]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0,n||(l=Et(NT,"keydown",o[20]),n=!0)},p(u,d){const a={};d[0]&2047|d[1]&128&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function t5(o,e,t){let n,l,u;dt(o,ko,ct=>t(5,l=ct)),dt(o,tc,ct=>t(6,u=ct));let{$$slots:d={},$$scope:a}=e,{map:_}=e,{finish:x}=e,{cancel:S}=e;tr(()=>{At(ko,l=[],l),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let k="snap",C=[],L=[],z=null,R=!1,D=!1,B=!1;function N(ct){let It=ct.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=It}function V(){let ct=C.pop();t(8,C),ct&&At(ko,l=ct,l)}function U(){C.length==100&&C.shift(),t(8,C=[...C,JSON.parse(JSON.stringify(l))])}function le(){t(7,k=k=="snap"?"free":"snap"),z&&t(23,z.snapped=k=="snap",z)}function oe(ct){l.length>=3||(U(),ko.update(It=>(It.push({point:ct.detail.lngLat.toArray(),snapped:k=="snap"}),It)))}function H(ct){t(23,z={point:ct.detail.lngLat.toArray(),snapped:k=="snap"})}function ee(ct){U(),ko.update(It=>(It[ct].snapped=!It[ct].snapped,It))}function be(ct){U(),ko.update(It=>(It.splice(ct,1),It)),t(2,R=!1)}function Oe(ct,It){try{if(ct)return W0(It)}catch{}return Xl()}function ne(ct,It,Ne,je){if(je||It.length>=3)return Xl();try{if(ct&&It.length>0&&Ne)return JSON.parse(ct.inner.calculateRoute([It[It.length-1],Ne]))}catch{}return Xl()}function ye(ct,It,Ne){if(Ne)return;if(!ct||It.length<3){t(9,L=[]);return}let je=[],rt=1,xt=JSON.parse(JSON.stringify(It));xt.push(xt[0]);for(let we=0;we<xt.length-1;we++){let di=JSON.parse(ct.inner.getExtraNodes(xt[we],xt[we+1]));for(let[Ve,$e,kt]of di)je.push({point:[Ve,$e],snapped:kt,insertIdx:rt});rt++}t(9,L=je)}function Ke(ct){U(),ko.update(It=>(It.splice(ct.insertIdx,0,{point:ct.point,snapped:ct.snapped}),It)),t(4,B=!0)}function Ce(ct){ko.update(It=>(It[ct.insertIdx].point=ct.point,It))}function et(){t(4,B=!1)}function vt(ct){let It=ct.target.tagName,Ne=It=="INPUT"||It=="TEXTAREA";ct.key=="Enter"&&!Ne||ct.key=="Escape"?(ct.stopPropagation(),l.length>=3?x():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ct.key=="s"&&!Ne?le():ct.key=="z"&&ct.ctrlKey&&(ct.stopPropagation(),V())}function pt(){U(),t(3,D=!0)}const st=[[]];function Ht(ct,It){o.$$.not_equal(It.point,ct)&&(It.point=ct,t(9,L))}const ii=ct=>Ke(ct),Ot=ct=>Ce(ct),Pt=ct=>{Ke(ct),t(4,B=!1)};function Jt(ct,It){o.$$.not_equal(It.point,ct)&&(It.point=ct,ko.set(l))}const Mt=ct=>ee(ct),ei=ct=>be(ct),Vt=()=>t(2,R=!0),hi=()=>t(2,R=!1),xi=()=>t(3,D=!1);function gi(){k=this.__value,t(7,k)}function Pi(){k=this.__value,t(7,k)}return o.$$set=ct=>{"map"in ct&&t(22,_=ct.map),"finish"in ct&&t(0,x=ct.finish),"cancel"in ct&&t(1,S=ct.cancel),"$$scope"in ct&&t(38,a=ct.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&112&&ye(u,l,B),o.$$.dirty[0]&8388716&&t(10,n=ne(u,l,z,R||D)),o.$$.dirty[0]&32&&N(l)},[x,S,R,D,B,l,u,k,C,L,n,V,oe,H,ee,be,Oe,Ke,Ce,et,vt,pt,_,z,d,Ht,ii,Ot,Pt,Jt,Mt,ei,Vt,hi,xi,gi,st,Pi,a]}class i5 extends Gt{constructor(e){super(),Zt(this,e,t5,e5,Ft,{map:22,finish:0,cancel:1},null,[-1,-1])}}function n5(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function r5(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function o5(o){let e;return{c(){e=ce("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){he(t,e,n)},p:Dt,i:Dt,o:Dt,d(t){t&&ue(e)}}}function s5(o){let e,t,n,l,u;return t=new zi({props:{$$slots:{default:[a5]},$$scope:{ctx:o}}}),t.$on("click",o[8]),{c(){e=ce("li"),Pe(t.$$.fragment),n=Re(),l=ce("li"),l.textContent="Changing neighbourhood boundary"},m(d,a){he(d,e,a),Le(t,e,null),he(d,n,a),he(d,l,a),u=!0},p(d,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(ie(t.$$.fragment,d),u=!0)},o(d){re(t.$$.fragment,d),u=!1},d(d){d&&(ue(e),ue(n),ue(l)),Ae(t)}}}function a5(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function l5(o){let e,t,n,l,u,d,a,_,x,S,k,C;u=new zi({props:{$$slots:{default:[n5]},$$scope:{ctx:o}}}),u.$on("click",o[6]),_=new zi({props:{$$slots:{default:[r5]},$$scope:{ctx:o}}}),_.$on("click",o[7]);const L=[s5,o5],z=[];function R(D,B){return D[1]?0:1}return S=R(o),k=z[S]=L[S](o),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),Pe(_.$$.fragment),x=Re(),k.c(),Te(t,"aria-label","breadcrumb"),Te(e,"slot","extra-top")},m(D,B){he(D,e,B),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Le(_,a,null),Q(n,x),z[S].m(n,null),C=!0},p(D,B){const N={};B&4096&&(N.$$scope={dirty:B,ctx:D}),u.$set(N);const V={};B&4096&&(V.$$scope={dirty:B,ctx:D}),_.$set(V);let U=S;S=R(D),S===U?z[S].p(D,B):(_i(),re(z[U],1,1,()=>{z[U]=null}),yi(),k=z[S],k?k.p(D,B):(k=z[S]=L[S](D),k.c()),ie(k,1),k.m(n,null))},i(D){C||(ie(u.$$.fragment,D),ie(_.$$.fragment,D),ie(k),C=!0)},o(D){re(u.$$.fragment,D),re(_.$$.fragment,D),re(k),C=!1},d(D){D&&ue(e),Ae(u),Ae(_),z[S].d()}}}function c5(o){let e,t,n,l;return{c(){e=ce("div"),t=ce("h1"),n=Qe("Draw your neighbourhood boundary for "),l=Qe(o[0]),Te(e,"slot","extra-sidebar")},m(u,d){he(u,e,d),Q(e,t),Q(t,n),Q(t,l)},p(u,d){d&1&&Mi(l,u[0])},d(u){u&&ue(e)}}}function u5(o){let e,t;return e=new i5({props:{map:Ei(o[3]),finish:o[4],cancel:o[5],$$slots:{"extra-sidebar":[c5],"extra-top":[l5]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&8&&(u.map=Ei(n[3])),l&4103&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function h5(o,e,t){let n,l,u,d,a;dt(o,ri,R=>t(2,n=R)),dt(o,Au,R=>t(9,l=R)),dt(o,Yn,R=>t(10,u=R)),dt(o,ko,R=>t(11,d=R)),dt(o,es,R=>t(3,a=R));let{name:_}=e,{existing:x}=e;x&&(x.properties.waypoints?At(ko,d=x.properties.waypoints.map(R=>({point:[R.lon,R.lat],snapped:R.snapped})),d):At(ko,d=x.geometry.coordinates[0].slice(1).map(R=>({point:R,snapped:!1})),d));function S(){if(d.length>=3)try{let R=W0(d);u.setNeighbourhoodBoundary(_,R),ec(),u.setCurrentNeighbourhood(_,l),At(ri,n={mode:"neighbourhood"},n)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),k()}}function k(){x?At(ri,n={mode:"neighbourhood"},n):At(ri,n={mode:"network"},n)}const C=()=>At(ri,n={mode:"title",firstLoad:!1},n),L=()=>At(ri,n={mode:"network"},n),z=()=>At(ri,n={mode:"neighbourhood"},n);return o.$$set=R=>{"name"in R&&t(0,_=R.name),"existing"in R&&t(1,x=R.existing)},[_,x,n,a,S,k,C,L,z]}class d5 extends Gt{constructor(e){super(),Zt(this,e,h5,u5,Ft,{name:0,existing:1})}}const f5="/ltn/assets/settings-342fb430.svg";function wy(o){let e,t;return e=new Td({props:{$$slots:{default:[p5]},$$scope:{ctx:o}}}),e.$on("close",o[7]),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&263&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function p5(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z,R,D,B,N,V;return n=new RS({}),{c(){e=ce("h1"),e.textContent="Settings",t=Re(),Pe(n.$$.fragment),l=Re(),u=ce("label"),d=Qe(`Style for roads in a neighbourhood:
      `),a=ce("select"),_=ce("option"),_.textContent="Show worst shortcuts",x=ce("option"),x.textContent="Show the cell",S=Re(),k=ce("label"),C=ce("input"),L=Qe(`
      Road thickness depends on shortcuts`),z=Re(),R=ce("center"),D=ce("button"),D.textContent="Confirm",_.__value="shortcuts",Hn(_,_.__value),x.__value="cells",Hn(x,x.__value),o[1]===void 0&&Yl(()=>o[4].call(a)),Te(C,"type","checkbox")},m(U,le){he(U,e,le),he(U,t,le),Le(n,U,le),he(U,l,le),he(U,u,le),Q(u,d),Q(u,a),Q(a,_),Q(a,x),Jl(a,o[1],!0),he(U,S,le),he(U,k,le),Q(k,C),C.checked=o[2],Q(k,L),he(U,z,le),he(U,R,le),Q(R,D),B=!0,N||(V=[Et(a,"change",o[4]),Et(C,"change",o[5]),Et(D,"click",o[6])],N=!0)},p(U,le){le&2&&Jl(a,U[1]),le&4&&(C.checked=U[2])},i(U){B||(ie(n.$$.fragment,U),B=!0)},o(U){re(n.$$.fragment,U),B=!1},d(U){U&&(ue(e),ue(t),ue(l),ue(u),ue(S),ue(k),ue(z),ue(R)),Ae(n,U),N=!1,ln(V)}}}function m5(o){let e,t,n,l,u,d,a=o[0]&&wy(o);return{c(){e=ce("button"),e.innerHTML=`<img src="${f5}" alt="Settings"/>`,t=Re(),a&&a.c(),n=Fn(),Te(e,"class","outline")},m(_,x){he(_,e,x),he(_,t,x),a&&a.m(_,x),he(_,n,x),l=!0,u||(d=Et(e,"click",o[3]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&ie(a,1)):(a=wy(_),a.c(),ie(a,1),a.m(n.parentNode,n)):a&&(_i(),re(a,1,1,()=>{a=null}),yi())},i(_){l||(ie(a),l=!0)},o(_){re(a),l=!1},d(_){_&&(ue(e),ue(t),ue(n)),a&&a.d(_),u=!1,d()}}}function g5(o,e,t){let n,l;dt(o,bd,k=>t(1,n=k)),dt(o,sp,k=>t(2,l=k));let u=!1;const d=()=>t(0,u=!0);function a(){n=Sp(this),bd.set(n)}function _(){l=this.checked,sp.set(l)}return[u,n,l,d,a,_,()=>t(0,u=!1),()=>t(0,u=!1)]}class _5 extends Gt{constructor(e){super(),Zt(this,e,g5,m5,Ft,{})}}const y5=["==",["geometry-type"],"Polygon"],b5=["==",["geometry-type"],"LineString"],v5=["==",["geometry-type"],"Point"];function $0(){return{type:"FeatureCollection",features:[]}}function Kf(o){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:H0(o)}}}function H0(o){return[Math.round(o[0]*1e7)/1e7,Math.round(o[1]*1e7)/1e7]}const X0=wi($0()),K0=wi(0),w5=100;class x5{constructor(e){Dn(this,"map");Dn(this,"active");Dn(this,"eventListenersSuccess");Dn(this,"eventListenersUpdated");Dn(this,"eventListenersFailure");Dn(this,"points");Dn(this,"cursor");Dn(this,"hover");Dn(this,"dragFrom");Dn(this,"previousStates");Dn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=t,l[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Dn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(xy(this.points).forEach((n,l)=>{t.push([l+1,aw(n,this.cursor).properties.dist])}),t.sort((n,l)=>n[1]-l[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Dn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Kf(e.lngLat.toArray()),this.onClick(e),this.finish())});Dn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Dn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Dn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Dn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=$0();this.points.forEach((l,u)=>{let d=Kf(l);d.properties.hover=this.hover==u,d.properties.idx=u,e.features.push(d)}),e.features=e.features.concat(xy(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),X0.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,K0.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Kf(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(H0),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>w5&&this.previousStates.shift()}}function xy(o){let e=[];for(let t=0;t<o.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[t],o[t+1]]},properties:{}});return o.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[o.length-1],o[0]]},properties:{}}),e}function k5(o){let e,t,n;return{c(){e=Qe("Undo ("),t=Qe(o[1]),n=Qe(")")},m(l,u){he(l,e,u),he(l,t,u),he(l,n,u)},p(l,u){u&2&&Mi(t,l[1])},d(l){l&&(ue(e),ue(t),ue(n))}}}function S5(o){let e;return{c(){e=Qe("Undo")},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function T5(o){let e,t,n,l,u,d,a,_,x,S,k;function C(R,D){return R[1]==0?S5:k5}let L=C(o),z=L(o);return{c(){e=ce("div"),t=ce("button"),t.textContent="Finish",n=Re(),l=ce("button"),l.textContent="Cancel",u=Re(),d=ce("button"),z.c(),_=Re(),x=ce("ul"),x.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,d.disabled=a=o[1]==0,pn(e,"display","flex"),pn(e,"justify-content","space-between")},m(R,D){he(R,e,D),Q(e,t),Q(e,n),Q(e,l),Q(e,u),Q(e,d),z.m(d,null),he(R,_,D),he(R,x,D),S||(k=[Et(t,"click",o[2]),Et(l,"click",o[3]),Et(d,"click",o[4])],S=!0)},p(R,[D]){L===(L=C(R))&&z?z.p(R,D):(z.d(1),z=L(R),z&&(z.c(),z.m(d,null))),D&2&&a!==(a=R[1]==0)&&(d.disabled=a)},i:Dt,o:Dt,d(R){R&&(ue(e),ue(_),ue(x)),z.d(),S=!1,ln(k)}}}function E5(o,e,t){let n;dt(o,K0,_=>t(1,n=_));let{polygonTool:l}=e;const u=()=>l.finish(),d=()=>l.cancel(),a=()=>l.undo();return o.$$set=_=>{"polygonTool"in _&&t(0,l=_.polygonTool)},[l,n,u,d,a]}class C5 extends Gt{constructor(e){super(),Zt(this,e,E5,T5,Ft,{polygonTool:0})}}let M5=Date.now();function Wu(o){return`${o}-${M5++}`}const J0=Symbol.for("svelte-maplibre");function I5(){return Ep(J0)}function ky(o){return{subscribe:o.subscribe}}function Y0({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=I5(),u=wi(null),d=ky(u),a={...l,[o]:ky(u)};if(e&&(a.popupTarget=d),n){let _=wi(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=wi()),Tp(J0,a),{...l,self:u}}function L5(){return Y0({key:"source",setCluster:!0})}function A5(o=!0){return Y0({key:"layer",setPopupTarget:o,setMouseEvent:o})}function Sy(o){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&o(n,u,l)}else if(e)for(let n in e)o(n,void 0,e[n]);e=t}}function P5(o,...e){let t=[o];for(let n of e)if(n)Array.isArray(n)&&n[0]===o?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function z5(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function Ty(o){let e=o[0],t,n,l=Ey(o);return{c(){l.c(),t=Fn()},m(u,d){l.m(u,d),he(u,t,d),n=!0},p(u,d){d[0]&1&&Ft(e,e=u[0])?(_i(),re(l,1,1,Dt),yi(),l=Ey(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(ie(l),n=!0)},o(u){re(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function Ey(o){let e;const t=o[36].default,n=Ni(t,o,o[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Ui(n,t,l,l[35],e?ji(t,l[35],u,null):Vi(l[35]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function D5(o){let e,t,n=o[0]&&Ty(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&ie(n,1)):(n=Ty(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function R5(o,e,t){let n,l,u,d,a,_,x,S,k,C,L,z,{$$slots:R={},$$scope:D}=e,{id:B=Wu("layer")}=e,{source:N=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:le=void 0}=e,{type:oe}=e,{paint:H=void 0}=e,{layout:ee=void 0}=e,{filter:be=void 0}=e,{applyToClusters:Oe=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Ce=null}=e,{interactive:et=!0}=e,{hoverCursor:vt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const st=ts(),{map:Ht,source:ii,self:Ot,minzoom:Pt,maxzoom:Jt,eventTopMost:Mt,layerInfo:ei}=A5();dt(o,Ht,Ne=>t(31,k=Ne)),dt(o,ii,Ne=>t(32,C=Ne)),dt(o,Ot,Ne=>t(0,S=Ne)),dt(o,Pt,Ne=>t(34,z=Ne)),dt(o,Jt,Ne=>t(33,L=Ne)),tr(()=>{S&&k&&(ei.delete(S),k==null||k.removeLayer(S))});let Vt;function hi(Ne){var we,di;if(!et||!S||!k||pt&&Mt(Ne)!==S)return;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt={event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je};st(Ne.type,xt)}function xi(Ne){var we,di;if(!et||!S||!k||pt&&Mt(Ne)!==S)return;vt&&(k.getCanvas().style.cursor=vt);let je=Ne.features??[];t(6,Ce=je[0]??null);let rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;st("mouseenter",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function gi(Ne){var we,di,Ve;if(!et||!k)return;if(pt&&Mt(Ne)!==S){t(6,Ce=null),Ke&&Vt!==void 0&&(k==null||k.setFeatureState({source:a,sourceLayer:V,id:Vt},{hover:!1}),Vt=void 0);return}k.getCanvas().style.cursor=vt;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt=(Ve=je[0])==null?void 0:Ve.id;xt!==Vt&&(Ke&&(Vt!==void 0&&(k==null||k.setFeatureState({source:a,id:Vt,sourceLayer:V},{hover:!1})),k==null||k.setFeatureState({source:a,id:xt,sourceLayer:V},{hover:!0})),Vt=xt,t(6,Ce=je[0]??null)),st("mousemove",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function Pi(Ne){if(!(!et||!S||!k)){if(vt&&(k.getCanvas().style.cursor=""),t(6,Ce=null),Ke&&Vt!==void 0){const je={source:a,id:Vt,sourceLayer:V};k==null||k.setFeatureState(je,{hover:!1}),Vt=void 0}st("mouseleave",{map:k,layer:S,source:a})}}let ct=!0;function It(Ne){k&&(k.off("click",Ne,hi),k.off("dblclick",Ne,hi),k.off("contextmenu",Ne,hi),k.off("mouseenter",Ne,xi),k.off("mousemove",Ne,gi),k.off("mouseleave",Ne,Pi))}return tr(()=>{k&&S&&It(S)}),o.$$set=Ne=>{"id"in Ne&&t(7,B=Ne.id),"source"in Ne&&t(8,N=Ne.source),"sourceLayer"in Ne&&t(9,V=Ne.sourceLayer),"beforeId"in Ne&&t(10,U=Ne.beforeId),"beforeLayerType"in Ne&&t(11,le=Ne.beforeLayerType),"type"in Ne&&t(12,oe=Ne.type),"paint"in Ne&&t(13,H=Ne.paint),"layout"in Ne&&t(14,ee=Ne.layout),"filter"in Ne&&t(15,be=Ne.filter),"applyToClusters"in Ne&&t(16,Oe=Ne.applyToClusters),"minzoom"in Ne&&t(17,ne=Ne.minzoom),"maxzoom"in Ne&&t(18,ye=Ne.maxzoom),"manageHoverState"in Ne&&t(19,Ke=Ne.manageHoverState),"hovered"in Ne&&t(6,Ce=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,vt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,pt=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,D=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,n=z5(Oe)),o.$$.dirty[0]&1073774592&&t(24,l=P5("all",n,be)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ne??z),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,d=ye??L),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=N||C),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&k&&S!==B&&a){S&&(It(S),ei.delete(S));let Ne=U;if(!U&&le){let je=k.getStyle().layers,rt=typeof le=="function"?le:we=>we.type===le,xt=je==null?void 0:je.find(rt);xt&&(Ne=xt.id)}At(Ot,S=B,S),k.addLayer(Oa({id:S,type:oe,source:a,"source-layer":V,filter:l,paint:H,layout:ee,minzoom:u,maxzoom:d}),Ne),t(23,ct=!0),k.on("click",S,hi),k.on("dblclick",S,hi),k.on("contextmenu",S,hi),k.on("mouseenter",S,xi),k.on("mousemove",S,gi),k.on("mouseleave",S,Pi)}o.$$.dirty[0]&1048577&&S&&ei.set(S,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=S?Sy((Ne,je)=>k==null?void 0:k.setPaintProperty(S,Ne,je)):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,x=S?Sy((Ne,je)=>k==null?void 0:k.setLayoutProperty(S,Ne,je)):void 0),o.$$.dirty[0]&268443648&&(_==null||_(H)),o.$$.dirty[0]&134234112&&(x==null||x(ee)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&S&&(k==null||k.setLayerZoomRange(S,u,d)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&S&&(ct?t(23,ct=!1):k==null||k.setFilter(S,l))},[S,Ht,ii,Ot,Pt,Jt,Ce,B,N,V,U,le,oe,H,ee,be,Oe,ne,ye,Ke,et,vt,pt,ct,l,d,u,x,_,a,n,k,C,L,z,D,R]}class Zp extends Gt{constructor(e){super(),Zt(this,e,R5,D5,Ft,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function B5(o){let e;const t=o[16].default,n=Ni(t,o,o[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Ui(n,t,l,l[24],e?ji(t,l[24],u,null):Vi(l[24]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function F5(o){let e,t,n;function l(d){o[17](d)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[B5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Zp({props:u}),Ki.push(()=>Wr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function O5(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Wu("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:C=void 0}=e,{applyToClusters:L=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:U=!0}=e;function le(ye){N=ye,t(0,N)}function oe(ye){ui.call(this,o,ye)}function H(ye){ui.call(this,o,ye)}function ee(ye){ui.call(this,o,ye)}function be(ye){ui.call(this,o,ye)}function Oe(ye){ui.call(this,o,ye)}function ne(ye){ui.call(this,o,ye)}return o.$$set=ye=>{"id"in ye&&t(1,u=ye.id),"source"in ye&&t(2,d=ye.source),"sourceLayer"in ye&&t(3,a=ye.sourceLayer),"beforeId"in ye&&t(4,_=ye.beforeId),"beforeLayerType"in ye&&t(5,x=ye.beforeLayerType),"paint"in ye&&t(6,S=ye.paint),"layout"in ye&&t(7,k=ye.layout),"filter"in ye&&t(8,C=ye.filter),"applyToClusters"in ye&&t(9,L=ye.applyToClusters),"minzoom"in ye&&t(10,z=ye.minzoom),"maxzoom"in ye&&t(11,R=ye.maxzoom),"hoverCursor"in ye&&t(12,D=ye.hoverCursor),"manageHoverState"in ye&&t(13,B=ye.manageHoverState),"hovered"in ye&&t(0,N=ye.hovered),"eventsIfTopMost"in ye&&t(14,V=ye.eventsIfTopMost),"interactive"in ye&&t(15,U=ye.interactive),"$$scope"in ye&&t(24,l=ye.$$scope)},[N,u,d,a,_,x,S,k,C,L,z,R,D,B,V,U,n,le,oe,H,ee,be,Oe,ne,l]}class N5 extends Gt{constructor(e){super(),Zt(this,e,O5,F5,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function j5(o){let e;const t=o[15].default,n=Ni(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Ui(n,t,l,l[23],e?ji(t,l[23],u,null):Vi(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function U5(o){let e,t,n;function l(d){o[16](d)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[j5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Zp({props:u}),Ki.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function V5(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Wu("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function le(ne){ui.call(this,o,ne)}function oe(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function be(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,S=ne.paint),"layout"in ne&&t(7,k=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,L=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,x,S,k,C,L,z,R,D,N,V,n,U,le,oe,H,ee,be,Oe,l]}class q5 extends Gt{constructor(e){super(),Zt(this,e,V5,U5,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Z5(o,e,t,n,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const d=()=>{n(e)&&(o.addSource(e,t),l())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):d())};a()}else d()}function G5(o,e,t){Wy().then(()=>{let n=Lr(o);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Cy(o){let e=o[0],t,n,l=My(o);return{c(){l.c(),t=Fn()},m(u,d){l.m(u,d),he(u,t,d),n=!0},p(u,d){d&1&&Ft(e,e=u[0])?(_i(),re(l,1,1,Dt),yi(),l=My(u),l.c(),ie(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(ie(l),n=!0)},o(u){re(l),n=!1},d(u){u&&ue(t),l.d(u)}}}function My(o){let e;const t=o[15].default,n=Ni(t,o,o[14],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16384)&&Ui(n,t,l,l[14],e?ji(t,l[14],u,null):Vi(l[14]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function W5(o){let e,t,n=o[0]&&Cy(o);return{c(){n&&n.c(),e=Fn()},m(l,u){n&&n.m(l,u),he(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ie(n,1)):(n=Cy(l),n.c(),ie(n,1),n.m(e.parentNode,e)):n&&(_i(),re(n,1,1,()=>{n=null}),yi())},i(l){t||(ie(n),t=!0)},o(l){re(n),t=!1},d(l){l&&ue(e),n&&n.d(l)}}}function $5(o,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{id:_=Wu("geojson")}=e,{data:x}=e,{generateId:S=!1}=e,{promoteId:k=void 0}=e,{filter:C=void 0}=e,{lineMetrics:L=void 0}=e,{cluster:z=void 0}=e;const{map:R,cluster:D,self:B}=L5();dt(o,R,U=>t(13,l=U)),dt(o,D,U=>t(16,u=U)),dt(o,B,U=>t(0,n=U));let N,V=!0;return tr(()=>{n&&N&&l&&(G5(R,n,N),At(B,n=null,n),t(11,N=void 0))}),o.$$set=U=>{"id"in U&&t(4,_=U.id),"data"in U&&t(5,x=U.data),"generateId"in U&&t(6,S=U.generateId),"promoteId"in U&&t(7,k=U.promoteId),"filter"in U&&t(8,C=U.filter),"lineMetrics"in U&&t(9,L=U.lineMetrics),"cluster"in U&&t(10,z=U.cluster),"$$scope"in U&&t(14,a=U.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&At(D,u=z,u),o.$$.dirty&12273&&l&&n!==_&&(At(B,n=_,n),Z5(l,n,Oa({type:"geojson",data:x,filter:C,lineMetrics:L,generateId:S,promoteId:k,cluster:!!z,clusterMinPoints:z==null?void 0:z.minPoints,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius,clusterProperties:z==null?void 0:z.properties}),U=>l&&U===n,()=>{n&&(t(11,N=l==null?void 0:l.getSource(n)),t(12,V=!0))})),o.$$.dirty&8208&&(l==null||l.on("style.load",()=>{t(11,N=l==null?void 0:l.getSource(_))})),o.$$.dirty&6176&&N&&(V?t(12,V=!1):N.setData(x)),o.$$.dirty&3072&&(N==null||N.setClusterOptions(Oa({cluster:!!z,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius})))},[n,R,D,B,_,x,S,k,C,L,z,N,V,l,a,d]}class H5 extends Gt{constructor(e){super(),Zt(this,e,$5,W5,Ft,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function X5(o){let e;const t=o[15].default,n=Ni(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Ui(n,t,l,l[23],e?ji(t,l[23],u,null):Vi(l[23]),null)},i(l){e||(ie(n,l),e=!0)},o(l){re(n,l),e=!1},d(l){n&&n.d(l)}}}function K5(o){let e,t,n;function l(d){o[16](d)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[X5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Zp({props:u}),Ki.push(()=>Wr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Pe(e.$$.fragment)},m(d,a){Le(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){n||(ie(e.$$.fragment,d),n=!0)},o(d){re(e.$$.fragment,d),n=!1},d(d){Ae(e,d)}}}function J5(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Wu("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function le(ne){ui.call(this,o,ne)}function oe(ne){ui.call(this,o,ne)}function H(ne){ui.call(this,o,ne)}function ee(ne){ui.call(this,o,ne)}function be(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,S=ne.paint),"layout"in ne&&t(7,k=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,L=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,x,S,k,C,L,z,R,D,N,V,n,U,le,oe,H,ee,be,Oe,l]}class Y5 extends Gt{constructor(e){super(),Zt(this,e,J5,K5,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Q5(o){let e,t,n,l,u,d;return e=new q5({props:{id:"edit-polygon-fill",filter:y5,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new Y5({props:{id:"edit-polygon-lines",filter:b5,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new N5({props:{id:"edit-polygon-vertices",filter:v5,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment)},m(a,_){Le(e,a,_),he(a,t,_),Le(n,a,_),he(a,l,_),Le(u,a,_),d=!0},p:Dt,i(a){d||(ie(e.$$.fragment,a),ie(n.$$.fragment,a),ie(u.$$.fragment,a),d=!0)},o(a){re(e.$$.fragment,a),re(n.$$.fragment,a),re(u.$$.fragment,a),d=!1},d(a){a&&(ue(t),ue(l)),Ae(e,a),Ae(n,a),Ae(u,a)}}}function eE(o){let e,t;return e=new H5({props:{data:o[0],$$slots:{default:[Q5]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&2&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function tE(o,e,t){let n;return dt(o,X0,l=>t(0,n=l)),[n]}class iE extends Gt{constructor(e){super(),Zt(this,e,tE,eE,Ft,{})}}function nE(o){let e,t,n,l,u,d,a;return{c(){e=ce("button"),e.textContent="Import current view",t=Re(),n=ce("i"),n.textContent="or...",l=Re(),u=ce("button"),u.textContent="Draw an area to import on the map",Te(e,"type","button"),Te(u,"type","button")},m(_,x){he(_,e,x),he(_,t,x),he(_,n,x),he(_,l,x),he(_,u,x),d||(a=[Et(e,"click",o[2]),Et(u,"click",o[3])],d=!0)},p:Dt,i:Dt,o:Dt,d(_){_&&(ue(e),ue(t),ue(n),ue(l),ue(u)),d=!1,ln(a)}}}function rE(o){let e,t;return e=new C5({props:{polygonTool:o[0]}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.polygonTool=n[0]),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function oE(o){let e,t,n,l,u,d,a,_,x;const S=[rE,nE],k=[];function C(L,z){return L[0]?0:1}return e=C(o),t=k[e]=S[e](o),{c(){t.c(),n=Re(),l=ce("label"),u=ce("input"),d=Qe(`Save a copy of the osm.xml
  after importing`),Te(u,"type","checkbox")},m(L,z){k[e].m(L,z),he(L,n,z),he(L,l,z),Q(l,u),u.checked=o[1],Q(l,d),a=!0,_||(x=Et(u,"change",o[5]),_=!0)},p(L,[z]){let R=e;e=C(L),e===R?k[e].p(L,z):(_i(),re(k[R],1,1,()=>{k[R]=null}),yi(),t=k[e],t?t.p(L,z):(t=k[e]=S[e](L),t.c()),ie(t,1),t.m(n.parentNode,n)),z&2&&(u.checked=L[1])},i(L){a||(ie(t),a=!0)},o(L){re(t),a=!1},d(L){L&&(ue(n),ue(l)),k[e].d(L),_=!1,x()}}}function hu(o){return[o.lng,o.lat]}function sE(o,e,t){let{map:n}=e;const l=ts();let u=null,d=!1;async function a(C){try{l("loading","Loading from Overpass");let z=await(await fetch(Q0(C))).text();d&&pd("osm.xml",z),l("gotXml",{xml:z,boundary:C})}catch(L){l("error",L.toString())}}function _(){let C=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[hu(C.getSouthWest()),hu(C.getNorthWest()),hu(C.getNorthEast()),hu(C.getSouthEast()),hu(C.getSouthWest())]],type:"Polygon"}}}async function x(){if(n){if(n.getZoom()<13){l("error","Zoom in more to import");return}await a(_())}}function S(){n&&(t(0,u=new x5(n)),u.startNew(),u.addEventListenerSuccess(async C=>{t(0,u=null),await a(C)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function k(){d=this.checked,t(1,d)}return o.$$set=C=>{"map"in C&&t(4,n=C.map)},[u,d,x,S,n,k]}class aE extends Gt{constructor(e){super(),Zt(this,e,sE,oE,Ft,{map:4})}}function Q0(o){let e='poly:"';for(let[n,l]of o.geometry.coordinates[0])e+=`${l} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class e1{constructor(e,t,n){Dn(this,"inner");this.inner=new vw(e,t,n)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=lE(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}toggleDirection(e){this.inner.toggleDirection(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}}function lE(o){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of o.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return o}async function dd(o){Es.set(o);try{let e=JSON.parse(window.localStorage.getItem(o));console.time("get OSM input");let[t,n]=await cE(e);console.timeEnd("get OSM input"),console.time("load"),Yn.set(new e1(new Uint8Array(t),n,e.study_area_name||void 0)),Lr(Yn).loadSavefile(e),console.timeEnd("load"),t1()}catch(e){window.alert(`Couldn't open project: ${e}`),Es.set("")}}async function cE(o){if(o.study_area_name){let e=Lr(Mu)?`/osm/${o.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${o.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let n=await(await fetch(e)).arrayBuffer(),l=Lr(Mu)?`/boundaries/${o.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${o.study_area_name}.geojson`,d=await(await fetch(l)).json();return[n,d]}else{console.log("Grabbing from Overpass");let e=o.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await fetch(Q0(e))).arrayBuffer(),e]}}function t1(){ri.set({mode:"network"}),tc.set(new cw(Lr(es),Lr(Yn).toRouteSnapper(),wi(Xl()),wi(!0),wi(0))),Lr(es).fitBounds(Lr(Yn).getBounds(),{animate:!1}),Iu.set(Jf()),Lu.set(Jf()),od.set(Jf());let o=new URL(window.location.href);o.searchParams.set("project",Lr(Es)),window.history.replaceState(null,"",o.toString())}function Jf(){let o=Lr(Yn).getBounds(),e=o[0]+Math.random()*(o[2]-o[0]),t=o[1]+Math.random()*(o[3]-o[1]);return new Ts.LngLat(e,t)}function Iy(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function Ly(o,e,t){const n=o.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function uE(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function hE(o){let e,t,n,l,u,d,a,_;return u=new zi({props:{$$slots:{default:[uE]},$$scope:{ctx:o}}}),u.$on("click",o[13]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),a.textContent="New project",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(x,S){he(x,e,S),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),_=!0},p(x,S){const k={};S&33554432&&(k.$$scope={dirty:S,ctx:x}),u.$set(k)},i(x){_||(ie(u.$$.fragment,x),_=!0)},o(x){re(u.$$.fragment,x),_=!1},d(x){x&&ue(e),Ae(u)}}}function Ay(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z;e=new Hy({props:{loading:o[4]}});let R=Jn(o[3]),D=[];for(let B=0;B<R.length;B+=1)D[B]=zy(Iy(o,R,B));return k=new aE({props:{map:o[5]}}),k.$on("gotXml",o[7]),k.$on("loading",o[11]),k.$on("error",o[12]),{c(){Pe(e.$$.fragment),t=Re(),n=ce("label"),l=Qe(`Load a built-in area:
        `),u=ce("select"),d=ce("option");for(let B=0;B<D.length;B+=1)D[B].c();a=Re(),_=ce("i"),_.textContent="or...",x=Re(),S=ce("div"),Pe(k.$$.fragment),d.__value="",Hn(d,d.__value),o[2]===void 0&&Yl(()=>o[9].call(u))},m(B,N){Le(e,B,N),he(B,t,N),he(B,n,N),Q(n,l),Q(n,u),Q(u,d);for(let V=0;V<D.length;V+=1)D[V]&&D[V].m(u,null);Jl(u,o[2],!0),he(B,a,N),he(B,_,N),he(B,x,N),he(B,S,N),Le(k,S,null),C=!0,L||(z=[Et(u,"change",o[9]),Et(u,"change",o[10])],L=!0)},p(B,N){const V={};if(N&16&&(V.loading=B[4]),e.$set(V),N&8){R=Jn(B[3]);let le;for(le=0;le<R.length;le+=1){const oe=Iy(B,R,le);D[le]?D[le].p(oe,N):(D[le]=zy(oe),D[le].c(),D[le].m(u,null))}for(;le<D.length;le+=1)D[le].d(1);D.length=R.length}N&12&&Jl(u,B[2]);const U={};N&32&&(U.map=B[5]),k.$set(U)},i(B){C||(ie(e.$$.fragment,B),ie(k.$$.fragment,B),C=!0)},o(B){re(e.$$.fragment,B),re(k.$$.fragment,B),C=!1},d(B){B&&(ue(t),ue(n),ue(a),ue(_),ue(x),ue(S)),Ae(e,B),Ss(D,B),Ae(k),L=!1,ln(z)}}}function Py(o){let e,t=o[22]+"",n,l;return{c(){e=ce("option"),n=Qe(t),e.__value=l=o[21],Hn(e,e.__value)},m(u,d){he(u,e,d),Q(e,n)},p(u,d){d&8&&t!==(t=u[22]+"")&&Mi(n,t),d&8&&l!==(l=u[21])&&(e.__value=l,Hn(e,e.__value))},d(u){u&&ue(e)}}}function zy(o){let e,t,n=Jn(o[18]),l=[];for(let u=0;u<n.length;u+=1)l[u]=Py(Ly(o,n,u));return{c(){e=ce("optgroup");for(let u=0;u<l.length;u+=1)l[u].c();Te(e,"label",t=o[17])},m(u,d){he(u,e,d);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(u,d){if(d&8){n=Jn(u[18]);let a;for(a=0;a<n.length;a+=1){const _=Ly(u,n,a);l[a]?l[a].p(_,d):(l[a]=Py(_),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}d&8&&t!==(t=u[17])&&Te(e,"label",t)},d(u){u&&ue(e),Ss(l,u)}}}function dE(o){let e,t,n,l,u,d,a,_,x,S=o[1]&&Ay(o);return{c(){e=ce("div"),t=ce("div"),n=ce("label"),l=Qe(`Project name:
        `),u=ce("input"),d=Re(),S&&S.c(),Te(u,"type","text"),Te(e,"slot","sidebar")},m(k,C){he(k,e,C),Q(e,t),Q(t,n),Q(n,l),Q(n,u),Hn(u,o[1]),Q(e,d),S&&S.m(e,null),a=!0,_||(x=Et(u,"input",o[8]),_=!0)},p(k,C){C&2&&u.value!==k[1]&&Hn(u,k[1]),k[1]?S?(S.p(k,C),C&2&&ie(S,1)):(S=Ay(k),S.c(),ie(S,1),S.m(e,null)):S&&(_i(),re(S,1,1,()=>{S=null}),yi())},i(k){a||(ie(S),a=!0)},o(k){re(S),a=!1},d(k){k&&ue(e),S&&S.d(),_=!1,x()}}}function fE(o){let e,t,n;return t=new iE({}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","map")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p:Dt,i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function pE(o){let e,t;return e=new ns({props:{$$slots:{map:[fE],sidebar:[dE],top:[hE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,[l]){const u={};l&33554558&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function mE(o,e,t){let n,l,u,d,a;dt(o,Es,U=>t(14,n=U)),dt(o,Yn,U=>t(15,l=U)),dt(o,Mu,U=>t(16,u=U)),dt(o,es,U=>t(5,d=U)),dt(o,ri,U=>t(6,a=U));let _="",x="",S=[],k="";Sd(async()=>{let U=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,S=await U.json())});function C(U){t(4,k="Loading OSM");try{At(Yn,l=new e1(new TextEncoder().encode(U.detail.xml),U.detail.boundary,void 0),l),At(Es,n=`ltn_${_}`,n),t1(),ec()}catch(le){window.alert(`Couldn't import from Overpass: ${le}`)}t(4,k="")}async function L(){if(x=="")return;let U=`ltn_${_}`;window.localStorage.setItem(U,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:x})),t(4,k=`Loading pre-clipped OSM area ${x}`),await dd(U),t(4,k="")}function z(){_=this.value,t(1,_)}function R(){x=Sp(this),t(2,x),t(3,S)}return[L,_,x,S,k,d,a,C,z,R,()=>L(),U=>t(4,k=U.detail),U=>window.alert(U.detail),()=>At(ri,a={mode:"title",firstLoad:!1},a)]}class gE extends Gt{constructor(e){super(),Zt(this,e,mE,pE,Ft,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Dy(o,e,t){const n=o.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function Ry(o,e,t){const n=o.slice();return n[23]=e[t],n}function _E(o){let e;return{c(){e=ce("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',Te(e,"slot","top")},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function yE(o){let e;return{c(){e=ce("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){he(t,e,n)},p:Dt,i:Dt,o:Dt,d(t){t&&ue(e)}}}function bE(o){let e,t,n,l,u,d,a,_,x,S,k,C,L;t=new zi({props:{$$slots:{default:[vE]},$$scope:{ctx:o}}}),t.$on("click",o[11]);let z=Jn(o[2]),R=[];for(let B=0;B<z.length;B+=1)R[B]=Fy(Dy(o,z,B));const D=B=>re(R[B],1,1,()=>{R[B]=null});return{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),l=ce("p"),l.textContent="Load a saved project:",u=Re(),d=ce("ul");for(let B=0;B<R.length;B+=1)R[B].c();a=Re(),_=ce("label"),x=Qe(`Load a project from a file
        `),S=ce("input"),Te(S,"type","file")},m(B,N){he(B,e,N),Le(t,e,null),he(B,n,N),he(B,l,N),he(B,u,N),he(B,d,N);for(let V=0;V<R.length;V+=1)R[V]&&R[V].m(d,null);he(B,a,N),he(B,_,N),Q(_,x),Q(_,S),o[15](S),k=!0,C||(L=Et(S,"change",o[6]),C=!0)},p(B,N){const V={};if(N&67108864&&(V.$$scope={dirty:N,ctx:B}),t.$set(V),N&900){z=Jn(B[2]);let U;for(U=0;U<z.length;U+=1){const le=Dy(B,z,U);R[U]?(R[U].p(le,N),ie(R[U],1)):(R[U]=Fy(le),R[U].c(),ie(R[U],1),R[U].m(d,null))}for(_i(),U=z.length;U<R.length;U+=1)D(U);yi()}},i(B){if(!k){ie(t.$$.fragment,B);for(let N=0;N<z.length;N+=1)ie(R[N]);k=!0}},o(B){re(t.$$.fragment,B),R=R.filter(Boolean);for(let N=0;N<R.length;N+=1)re(R[N]);k=!1},d(B){B&&(ue(e),ue(n),ue(l),ue(u),ue(d),ue(a),ue(_)),Ae(t),Ss(R,B),o[15](null),C=!1,L()}}}function vE(o){let e;return{c(){e=Qe("New project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function wE(o){let e=o[23].slice(4)+"",t;return{c(){t=Qe(e)},m(n,l){he(n,t,l)},p(n,l){l&4&&e!==(e=n[23].slice(4)+"")&&Mi(t,e)},d(n){n&&ue(t)}}}function By(o){let e,t,n,l,u,d,a,_,x,S,k;function C(){return o[12](o[23])}n=new zi({props:{$$slots:{default:[wE]},$$scope:{ctx:o}}}),n.$on("click",C);function L(){return o[13](o[23])}function z(){return o[14](o[23])}return{c(){e=ce("li"),t=ce("span"),Pe(n.$$.fragment),l=Re(),u=ce("button"),u.innerHTML=`<img src="${G0}" alt="Rename project"/>`,d=Re(),a=ce("button"),a.innerHTML=`<img src="${Z0}" alt="Delete project"/>`,_=Re(),Te(u,"class","secondary"),Te(a,"class","secondary"),pn(t,"display","flex"),pn(t,"justify-content","space-between")},m(R,D){he(R,e,D),Q(e,t),Le(n,t,null),Q(t,l),Q(t,u),Q(t,d),Q(t,a),Q(e,_),x=!0,S||(k=[Et(u,"click",L),Et(a,"click",z)],S=!0)},p(R,D){o=R;const B={};D&67108868&&(B.$$scope={dirty:D,ctx:o}),n.$set(B)},i(R){x||(ie(n.$$.fragment,R),x=!0)},o(R){re(n.$$.fragment,R),x=!1},d(R){R&&ue(e),Ae(n),S=!1,ln(k)}}}function Fy(o){let e,t=(o[19]??"custom area")+"",n,l,u,d,a=Jn(o[20]),_=[];for(let S=0;S<a.length;S+=1)_[S]=By(Ry(o,a,S));const x=S=>re(_[S],1,1,()=>{_[S]=null});return{c(){e=ce("u"),n=Qe(t),l=Re();for(let S=0;S<_.length;S+=1)_[S].c();u=Fn()},m(S,k){he(S,e,k),Q(e,n),he(S,l,k);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(S,k);he(S,u,k),d=!0},p(S,k){if((!d||k&4)&&t!==(t=(S[19]??"custom area")+"")&&Mi(n,t),k&900){a=Jn(S[20]);let C;for(C=0;C<a.length;C+=1){const L=Ry(S,a,C);_[C]?(_[C].p(L,k),ie(_[C],1)):(_[C]=By(L),_[C].c(),ie(_[C],1),_[C].m(u.parentNode,u))}for(_i(),C=a.length;C<_.length;C+=1)x(C);yi()}},i(S){if(!d){for(let k=0;k<a.length;k+=1)ie(_[k]);d=!0}},o(S){_=_.filter(Boolean);for(let k=0;k<_.length;k+=1)re(_[k]);d=!1},d(S){S&&(ue(e),ue(l),ue(u)),Ss(_,S)}}}function xE(o){let e,t,n,l;const u=[bE,yE],d=[];function a(_,x){return _[4]&&_[0]?0:1}return t=a(o),n=d[t]=u[t](o),{c(){e=ce("div"),n.c(),Te(e,"slot","sidebar")},m(_,x){he(_,e,x),d[t].m(e,null),l=!0},p(_,x){let S=t;t=a(_),t===S?d[t].p(_,x):(_i(),re(d[S],1,1,()=>{d[S]=null}),yi(),n=d[t],n?n.p(_,x):(n=d[t]=u[t](_),n.c()),ie(n,1),n.m(e,null))},i(_){l||(ie(n),l=!0)},o(_){re(n),l=!1},d(_){_&&ue(e),d[t].d()}}}function kE(o){let e,t,n,l;return e=new Hy({props:{loading:o[1]}}),n=new ns({props:{$$slots:{sidebar:[xE],top:[_E]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,d){Le(e,u,d),he(u,t,d),Le(n,u,d),l=!0},p(u,[d]){const a={};d&2&&(a.loading=u[1]),e.$set(a);const _={};d&67108925&&(_.$$scope={dirty:d,ctx:u}),n.$set(_)},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function id(){let o=new Map,e=[];for(let n=0;n<window.localStorage.length;n++){let l=window.localStorage.key(n);if(l.startsWith("ltn_")){let u="";try{u=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}u&&u.length>0?(o.has(u)||o.set(u,[]),o.get(u).push(l)):e.push(l)}}let t=[...o.entries()];return t.sort((n,l)=>n[0].localeCompare(l[0])),t.push(["custom",e]),t}function SE(o,e,t){let n,l,u,d,a;dt(o,Es,oe=>t(16,n=oe)),dt(o,tc,oe=>t(17,l=oe)),dt(o,Yn,oe=>t(18,u=oe)),dt(o,es,oe=>t(4,d=oe)),dt(o,ri,oe=>t(5,a=oe));let{wasmReady:_}=e,{firstLoad:x}=e,S="";if(At(Yn,u=null,u),At(tc,l=null,l),At(Es,n="",n),x){let H=new URLSearchParams(window.location.search).get("project");H&&dd(H)}else{let oe=new URL(window.location.href);oe.searchParams.delete("project"),window.history.replaceState(null,"",oe.toString())}let k=id(),C;async function L(oe){let H="ltn_"+C.files[0].name;t(1,S=`Loading from file ${H}`),window.localStorage.setItem(H,await C.files[0].text()),t(2,k=id()),await dd(H),t(1,S="")}function z(oe){window.confirm(`Really delete project ${oe}? You can't undo this.`)&&(window.localStorage.removeItem(oe),t(2,k=id()))}function R(oe){let H=window.prompt(`Rename project ${oe} to what?`,oe);if(H){H.startsWith("ltn_")||(H=`ltn_${H}`);let ee=window.localStorage.getItem(oe);window.localStorage.setItem(H,ee),window.localStorage.removeItem(oe),t(2,k=id())}}async function D(oe){t(1,S=`Loading project ${oe}`),await dd(oe),t(1,S="")}const B=()=>At(ri,a={mode:"new-project"},a),N=oe=>D(oe),V=oe=>R(oe),U=oe=>z(oe);function le(oe){Ki[oe?"unshift":"push"](()=>{C=oe,t(3,C)})}return o.$$set=oe=>{"wasmReady"in oe&&t(0,_=oe.wasmReady),"firstLoad"in oe&&t(10,x=oe.firstLoad)},[_,S,k,C,d,a,L,z,R,D,x,B,N,V,U,le]}class TE extends Gt{constructor(e){super(),Zt(this,e,SE,kE,Ft,{wasmReady:0,firstLoad:10})}}const{window:EE}=kd;function CE(o){let e;return{c(){e=Qe("Choose project")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function ME(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function IE(o){let e;return{c(){e=Qe("Editing")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function LE(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z;return u=new zi({props:{$$slots:{default:[CE]},$$scope:{ctx:o}}}),u.$on("click",o[9]),_=new zi({props:{$$slots:{default:[ME]},$$scope:{ctx:o}}}),_.$on("click",o[10]),k=new zi({props:{$$slots:{default:[IE]},$$scope:{ctx:o}}}),k.$on("click",o[5]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Pe(u.$$.fragment),d=Re(),a=ce("li"),Pe(_.$$.fragment),x=Re(),S=ce("li"),Pe(k.$$.fragment),C=Re(),L=ce("li"),L.textContent="Viewing shortcuts",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(R,D){he(R,e,D),Q(e,t),Q(t,n),Q(n,l),Le(u,l,null),Q(n,d),Q(n,a),Le(_,a,null),Q(n,x),Q(n,S),Le(k,S,null),Q(n,C),Q(n,L),z=!0},p(R,D){const B={};D&8192&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const N={};D&8192&&(N.$$scope={dirty:D,ctx:R}),_.$set(N);const V={};D&8192&&(V.$$scope={dirty:D,ctx:R}),k.$set(V)},i(R){z||(ie(u.$$.fragment,R),ie(_.$$.fragment,R),ie(k.$$.fragment,R),z=!0)},o(R){re(u.$$.fragment,R),re(_.$$.fragment,R),re(k.$$.fragment,R),z=!1},d(R){R&&ue(e),Ae(u),Ae(_),Ae(k)}}}function AE(o){let e,t,n,l,u,d,a,_,x,S=o[0].shortcutIndex+1+"",k,C,L=o[0].gj.features.length+"",z,R,D,B,N,V,U,le,oe,H=Ei(o[0].gj.features[o[0].shortcutIndex].properties).directness.toFixed(1)+"",ee,be,Oe,ne,ye;return{c(){e=ce("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=Re(),n=ce("button"),n.textContent="Pick a different road",l=Re(),u=ce("div"),d=ce("button"),a=Qe("Previous"),x=Re(),k=Qe(S),C=Qe(" / "),z=Qe(L),R=Re(),D=ce("button"),B=Qe("Next"),V=Re(),U=ce("p"),le=Qe("This shortcut is "),oe=ce("b"),ee=Qe(H),be=Qe("x"),Oe=Qe(`
        the length of the shortest route using all roads, not just this neighbourhood`),d.disabled=_=o[0].shortcutIndex==0,Te(d,"data-tooltip","Left"),D.disabled=N=o[0].shortcutIndex==o[0].gj.features.length-1,Te(D,"data-tooltip","Right"),pn(u,"display","flex"),pn(u,"justify-content","space-between")},m(Ke,Ce){he(Ke,e,Ce),he(Ke,t,Ce),he(Ke,n,Ce),he(Ke,l,Ce),he(Ke,u,Ce),Q(u,d),Q(d,a),Q(u,x),Q(u,k),Q(u,C),Q(u,z),Q(u,R),Q(u,D),Q(D,B),he(Ke,V,Ce),he(Ke,U,Ce),Q(U,le),Q(U,oe),Q(oe,ee),Q(oe,be),Q(U,Oe),ne||(ye=[Et(n,"click",o[8]),Et(d,"click",o[6]),Et(D,"click",o[7])],ne=!0)},p(Ke,Ce){Ce&1&&_!==(_=Ke[0].shortcutIndex==0)&&(d.disabled=_),Ce&1&&S!==(S=Ke[0].shortcutIndex+1+"")&&Mi(k,S),Ce&1&&L!==(L=Ke[0].gj.features.length+"")&&Mi(z,L),Ce&1&&N!==(N=Ke[0].shortcutIndex==Ke[0].gj.features.length-1)&&(D.disabled=N),Ce&1&&H!==(H=Ei(Ke[0].gj.features[Ke[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Mi(ee,H)},d(Ke){Ke&&(ue(e),ue(t),ue(n),ue(l),ue(u),ue(V),ue(U)),ne=!1,ln(ye)}}}function PE(o){let e;return{c(){e=ce("p"),e.textContent="Click a road to see shortcuts"},m(t,n){he(t,e,n)},p:Dt,d(t){t&&ue(e)}}}function zE(o){let e,t,n,l;t=new qu({}),t.$on("click",o[5]);function u(_,x){if(_[0].state=="neutral")return PE;if(_[0].state=="chose-road")return AE}let d=u(o),a=d&&d(o);return{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),a&&a.c(),Te(e,"slot","sidebar")},m(_,x){he(_,e,x),Le(t,e,null),Q(e,n),a&&a.m(e,null),l=!0},p(_,x){d===(d=u(_))&&a?a.p(_,x):(a&&a.d(1),a=d&&d(_),a&&(a.c(),a.m(e,null)))},i(_){l||(ie(t.$$.fragment,_),l=!0)},o(_){re(t.$$.fragment,_),l=!1},d(_){_&&ue(e),Ae(t),a&&a.d()}}}function DE(o){let e,t,n,l;return e=new Ad({}),n=new zd({}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,d){Le(e,u,d),he(u,t,d),Le(n,u,d),l=!0},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function RE(o){let e,t,n,l,u,d,a,_,x,S;return e=new Gu({props:{gj:Ei(o[2]).renderNeighbourhood(),interactive:!1}}),n=new Bn({props:{data:o[0].gj.features[o[0].shortcutIndex],$$slots:{default:[FE]},$$scope:{ctx:o}}}),u=new Bn({props:{data:o[0].roadGj,$$slots:{default:[OE]},$$scope:{ctx:o}}}),a=new Fu({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[NE]},$$scope:{ctx:o}}}),x=new Fu({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[o[0].gj.features[o[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[jE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),d=Re(),Pe(a.$$.fragment),_=Re(),Pe(x.$$.fragment)},m(k,C){Le(e,k,C),he(k,t,C),Le(n,k,C),he(k,l,C),Le(u,k,C),he(k,d,C),Le(a,k,C),he(k,_,C),Le(x,k,C),S=!0},p(k,C){const L={};C&4&&(L.gj=Ei(k[2]).renderNeighbourhood()),e.$set(L);const z={};C&1&&(z.data=k[0].gj.features[k[0].shortcutIndex]),C&8192&&(z.$$scope={dirty:C,ctx:k}),n.$set(z);const R={};C&1&&(R.data=k[0].roadGj),C&8192&&(R.$$scope={dirty:C,ctx:k}),u.$set(R);const D={};C&1&&(D.lngLat=k[0].gj.features[k[0].shortcutIndex].geometry.coordinates[0]),C&8192&&(D.$$scope={dirty:C,ctx:k}),a.$set(D);const B={};C&1&&(B.lngLat=k[0].gj.features[k[0].shortcutIndex].geometry.coordinates[k[0].gj.features[k[0].shortcutIndex].geometry.coordinates.length-1]),C&8192&&(B.$$scope={dirty:C,ctx:k}),x.$set(B)},i(k){S||(ie(e.$$.fragment,k),ie(n.$$.fragment,k),ie(u.$$.fragment,k),ie(a.$$.fragment,k),ie(x.$$.fragment,k),S=!0)},o(k){re(e.$$.fragment,k),re(n.$$.fragment,k),re(u.$$.fragment,k),re(a.$$.fragment,k),re(x.$$.fragment,k),S=!1},d(k){k&&(ue(t),ue(l),ue(d),ue(_)),Ae(e,k),Ae(n,k),Ae(u,k),Ae(a,k),Ae(x,k)}}}function BE(o){let e,t;return e=new Gu({props:{gj:Ei(o[2]).renderNeighbourhood(),onClickLine:o[3],$$slots:{"line-popup":[VE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&4&&(u.gj=Ei(n[2]).renderNeighbourhood()),l&8192&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function FE(o){let e,t;const n=[gn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function OE(o){let e,t;const n=[gn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new fo({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function NE(o){let e;return{c(){e=Qe("A")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function jE(o){let e;return{c(){e=Qe("B")},m(t,n){he(t,e,n)},d(t){t&&ue(e)}}}function UE(o){let e,t=o[12].shortcuts+"",n,l,u=(o[12].name??"unnamed road")+"",d;return{c(){e=ce("p"),n=Qe(t),l=Qe(" shortcuts through "),d=Qe(u)},m(a,_){he(a,e,_),Q(e,n),Q(e,l),Q(e,d)},p(a,_){_&4096&&t!==(t=a[12].shortcuts+"")&&Mi(n,t),_&4096&&u!==(u=(a[12].name??"unnamed road")+"")&&Mi(d,u)},d(a){a&&ue(e)}}}function VE(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[UE,({props:l})=>({12:l}),({props:l})=>l?4096:0]},$$scope:{ctx:o}}}),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){he(l,e,u),Le(t,e,null),n=!0},p(l,u){const d={};u&12288&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(ie(t.$$.fragment,l),n=!0)},o(l){re(t.$$.fragment,l),n=!1},d(l){l&&ue(e),Ae(t)}}}function qE(o){let e,t,n,l,u,d,a,_,x,S;t=new Pd({props:{gj:Ei(o[2]).renderNeighbourhood()}}),l=new Bn({props:{data:Ei(o[2]).renderNeighbourhood(),generateId:!0,$$slots:{default:[DE]},$$scope:{ctx:o}}});const k=[BE,RE],C=[];function L(z,R){return z[0].state=="neutral"?0:z[0].state=="chose-road"?1:-1}return~(d=L(o))&&(a=C[d]=k[d](o)),x=new Zu({}),{c(){e=ce("div"),Pe(t.$$.fragment),n=Re(),Pe(l.$$.fragment),u=Re(),a&&a.c(),_=Re(),Pe(x.$$.fragment),Te(e,"slot","map")},m(z,R){he(z,e,R),Le(t,e,null),Q(e,n),Le(l,e,null),Q(e,u),~d&&C[d].m(e,null),Q(e,_),Le(x,e,null),S=!0},p(z,R){const D={};R&4&&(D.gj=Ei(z[2]).renderNeighbourhood()),t.$set(D);const B={};R&4&&(B.data=Ei(z[2]).renderNeighbourhood()),R&8192&&(B.$$scope={dirty:R,ctx:z}),l.$set(B);let N=d;d=L(z),d===N?~d&&C[d].p(z,R):(a&&(_i(),re(C[N],1,1,()=>{C[N]=null}),yi()),~d?(a=C[d],a?a.p(z,R):(a=C[d]=k[d](z),a.c()),ie(a,1),a.m(e,_)):a=null)},i(z){S||(ie(t.$$.fragment,z),ie(l.$$.fragment,z),ie(a),ie(x.$$.fragment,z),S=!0)},o(z){re(t.$$.fragment,z),re(l.$$.fragment,z),re(a),re(x.$$.fragment,z),S=!1},d(z){z&&ue(e),Ae(t),Ae(l),~d&&C[d].d(),Ae(x)}}}function ZE(o){let e,t,n,l;return e=new ns({props:{$$slots:{map:[qE],sidebar:[zE],top:[LE]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0,n||(l=Et(EE,"keydown",o[4]),n=!0)},p(u,[d]){const a={};d&8199&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u),n=!1,l()}}}function GE(o,e,t){let n,l,u;dt(o,ri,R=>t(1,n=R)),dt(o,es,R=>t(11,l=R)),dt(o,Yn,R=>t(2,u=R));let d={state:"neutral"};function a(R,D){let B=u.getShortcutsCrossingRoad(R.properties.id);if(B.features.length==0){window.alert("No shortcuts here");return}t(0,d={state:"chose-road",roadGj:R,gj:B,shortcutIndex:0})}Sd(()=>{l==null||l.keyboard.disable()}),tr(()=>{l==null||l.keyboard.enable()});function _(R){d.state=="chose-road"&&(R.key=="ArrowLeft"&&d.shortcutIndex>0&&(R.stopPropagation(),t(0,d.shortcutIndex--,d)),R.key=="ArrowRight"&&(R.stopPropagation(),d.shortcutIndex!=d.gj.features.length-1&&t(0,d.shortcutIndex++,d)))}function x(){At(ri,n={mode:"neighbourhood"},n)}function S(){d.state=="chose-road"&&t(0,d.shortcutIndex--,d)}function k(){d.state=="chose-road"&&t(0,d.shortcutIndex++,d)}return[d,n,u,a,_,x,S,k,()=>t(0,d={state:"neutral"}),()=>At(ri,n={mode:"title",firstLoad:!1},n),()=>At(ri,n={mode:"network"},n)]}class WE extends Gt{constructor(e){super(),Zt(this,e,GE,ZE,Ft,{})}}function $E(o){let e,t,n,l,u,d,a,_,x;return l=new _5({}),{c(){e=ce("div"),t=ce("button"),t.innerHTML=`<img src="${sv}" style="height: 6vh;" alt="A/B Street logo"/>`,n=Re(),Pe(l.$$.fragment),u=Re(),d=ce("span"),Te(t,"class","outline"),pn(d,"width","100%"),Te(e,"slot","top"),pn(e,"display","flex")},m(S,k){he(S,e,k),Q(e,t),Q(e,n),Le(l,e,null),Q(e,u),Q(e,d),o[19](d),a=!0,_||(x=Et(t,"click",o[18]),_=!0)},p:Dt,i(S){a||(ie(l.$$.fragment,S),a=!0)},o(S){re(l.$$.fragment,S),a=!1},d(S){S&&ue(e),Ae(l),o[19](null),_=!1,x()}}}function Oy(o){let e,t,n,l,u,d;return n=new r4({props:{map:Ei(o[6]),maptilerBasemap:o[7]}}),{c(){e=ce("button"),e.textContent="Zoom to fit study area",t=Re(),Pe(n.$$.fragment),Te(e,"class","secondary")},m(a,_){he(a,e,_),he(a,t,_),Le(n,a,_),l=!0,u||(d=Et(e,"click",o[10]),u=!0)},p(a,_){const x={};_&64&&(x.map=Ei(a[6])),_&128&&(x.maptilerBasemap=a[7]),n.$set(x)},i(a){l||(ie(n.$$.fragment,a),l=!0)},o(a){re(n.$$.fragment,a),l=!1},d(a){a&&(ue(e),ue(t)),Ae(n,a),u=!1,d()}}}function HE(o){let e,t,n,l,u,d,a=o[5]&&Oy(o);return{c(){e=ce("div"),t=ce("div"),n=Re(),l=ce("hr"),u=Re(),a&&a.c(),Te(e,"slot","left")},m(_,x){he(_,e,x),Q(e,t),o[17](t),Q(e,n),Q(e,l),Q(e,u),a&&a.m(e,null),d=!0},p(_,x){_[5]?a?(a.p(_,x),x&32&&ie(a,1)):(a=Oy(_),a.c(),ie(a,1),a.m(e,null)):a&&(_i(),re(a,1,1,()=>{a=null}),yi())},i(_){d||(ie(a),d=!0)},o(_){re(a),d=!1},d(_){_&&ue(e),o[17](null),a&&a.d()}}}function XE(o){let e,t;return e=new gE({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function KE(o){let e,t;return e=new TE({props:{wasmReady:o[4],firstLoad:o[8].firstLoad}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.wasmReady=n[4]),l&256&&(u.firstLoad=n[8].firstLoad),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function Ny(o){let e,t,n,l,u,d;e=new Bn({props:{data:o[5].getInvertedBoundary(),$$slots:{default:[JE]},$$scope:{ctx:o}}});const a=[oC,rC,nC,iC,tC,eC,QE,YE],_=[];function x(S,k){return S[8].mode=="network"?0:S[8].mode=="set-boundary"?1:S[8].mode=="auto-boundaries"?2:S[8].mode=="neighbourhood"?3:S[8].mode=="view-shortcuts"?4:S[8].mode=="impact-one-destination"?5:S[8].mode=="route"?6:S[8].mode=="debug"?7:-1}return~(n=x(o))&&(l=_[n]=a[n](o)),{c(){Pe(e.$$.fragment),t=Re(),l&&l.c(),u=Fn()},m(S,k){Le(e,S,k),he(S,t,k),~n&&_[n].m(S,k),he(S,u,k),d=!0},p(S,k){const C={};k&32&&(C.data=S[5].getInvertedBoundary()),k&2097152&&(C.$$scope={dirty:k,ctx:S}),e.$set(C);let L=n;n=x(S),n===L?~n&&_[n].p(S,k):(l&&(_i(),re(_[L],1,1,()=>{_[L]=null}),yi()),~n?(l=_[n],l?l.p(S,k):(l=_[n]=a[n](S),l.c()),ie(l,1),l.m(u.parentNode,u)):l=null)},i(S){d||(ie(e.$$.fragment,S),ie(l),d=!0)},o(S){re(e.$$.fragment,S),re(l),d=!1},d(S){S&&(ue(t),ue(u)),Ae(e,S),~n&&_[n].d(S)}}}function JE(o){let e,t;const n=[gn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=an(l,n[u]);return e=new Cs({props:l}),{c(){Pe(e.$$.fragment)},m(u,d){Le(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(ie(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Ae(e,u)}}}function YE(o){let e,t;return e=new e3({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function QE(o){let e,t;return e=new OT({props:{prevMode:o[8].prevMode}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.prevMode=n[8].prevMode),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function eC(o){let e,t;return e=new uT({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function tC(o){let e,t;return e=new WE({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function iC(o){let e,t;return e=new X3({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function nC(o){let e,t;return e=new v4({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function rC(o){let e,t;return e=new d5({props:{name:o[8].name,existing:o[8].existing}}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.name=n[8].name),l&256&&(u.existing=n[8].existing),e.$set(u)},i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function oC(o){let e,t;return e=new TT({}),{c(){Pe(e.$$.fragment)},m(n,l){Le(e,n,l),t=!0},p:Dt,i(n){t||(ie(e.$$.fragment,n),t=!0)},o(n){re(e.$$.fragment,n),t=!1},d(n){Ae(e,n)}}}function sC(o){let e,t,n,l,u,d,a,_,x,S,k,C,L,z;e=new y0({}),n=new b0({}),u=new aS({props:{map:o[0],apiKey:np,country:void 0}});const R=[KE,XE],D=[];function B(V,U){return V[8].mode=="title"?0:V[8].mode=="new-project"?1:-1}~(x=B(o))&&(S=D[x]=R[x](o));let N=o[5]&&Ny(o);return L=new NS({}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment),l=Re(),Pe(u.$$.fragment),d=Re(),a=ce("div"),_=Re(),S&&S.c(),k=Re(),N&&N.c(),C=Re(),Pe(L.$$.fragment)},m(V,U){Le(e,V,U),he(V,t,U),Le(n,V,U),he(V,l,U),Le(u,V,U),he(V,d,U),he(V,a,U),o[14](a),he(V,_,U),~x&&D[x].m(V,U),he(V,k,U),N&&N.m(V,U),he(V,C,U),Le(L,V,U),z=!0},p(V,U){const le={};U&1&&(le.map=V[0]),u.$set(le);let oe=x;x=B(V),x===oe?~x&&D[x].p(V,U):(S&&(_i(),re(D[oe],1,1,()=>{D[oe]=null}),yi()),~x?(S=D[x],S?S.p(V,U):(S=D[x]=R[x](V),S.c()),ie(S,1),S.m(k.parentNode,k)):S=null),V[5]?N?(N.p(V,U),U&32&&ie(N,1)):(N=Ny(V),N.c(),ie(N,1),N.m(C.parentNode,C)):N&&(_i(),re(N,1,1,()=>{N=null}),yi())},i(V){z||(ie(e.$$.fragment,V),ie(n.$$.fragment,V),ie(u.$$.fragment,V),ie(S),ie(N),ie(L.$$.fragment,V),z=!0)},o(V){re(e.$$.fragment,V),re(n.$$.fragment,V),re(u.$$.fragment,V),re(S),re(N),re(L.$$.fragment,V),z=!1},d(V){V&&(ue(t),ue(l),ue(d),ue(a),ue(_),ue(k),ue(C)),Ae(e,V),Ae(n,V),Ae(u,V),o[14](null),~x&&D[x].d(V),N&&N.d(V),Ae(L,V)}}}function aC(o){let e,t,n,l;function u(a){o[15](a)}let d={style:`https://api.maptiler.com/maps/${o[7]}/style.json?key=${np}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:ov}],$$slots:{default:[sC]},$$scope:{ctx:o}};return o[0]!==void 0&&(d.map=o[0]),t=new ux({props:d}),Ki.push(()=>Wr(t,"map",u)),t.$on("error",o[16]),{c(){e=ce("div"),Pe(t.$$.fragment),Te(e,"slot","main"),pn(e,"position","relative"),pn(e,"width","100%"),pn(e,"height","100%")},m(a,_){he(a,e,_),Le(t,e,null),l=!0},p(a,_){const x={};_&128&&(x.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${np}`),_&2097465&&(x.$$scope={dirty:_,ctx:a}),!n&&_&1&&(n=!0,x.map=a[0],Gr(()=>n=!1)),t.$set(x)},i(a){l||(ie(t.$$.fragment,a),l=!0)},o(a){re(t.$$.fragment,a),l=!1},d(a){a&&ue(e),Ae(t)}}}function lC(o){let e,t,n,l;return e=new fw({}),n=new CS({props:{$$slots:{main:[aC],left:[HE],top:[$E]},$$scope:{ctx:o}}}),{c(){Pe(e.$$.fragment),t=Re(),Pe(n.$$.fragment)},m(u,d){Le(e,u,d),he(u,t,d),Le(n,u,d),l=!0},p(u,[d]){const a={};d&2098175&&(a.$$scope={dirty:d,ctx:u}),n.$set(a)},i(u){l||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(n.$$.fragment,u),l=!1},d(u){u&&ue(t),Ae(e,u),Ae(n,u)}}}function cC(o,e,t){let n,l,u,d,a,_,x,S,k;dt(o,yp,ee=>t(11,n=ee)),dt(o,_p,ee=>t(12,l=ee)),dt(o,gp,ee=>t(13,u=ee)),dt(o,Yn,ee=>t(5,d=ee)),dt(o,es,ee=>t(6,a=ee)),dt(o,Mu,ee=>t(20,_=ee)),dt(o,rp,ee=>t(7,x=ee)),dt(o,ri,ee=>t(8,S=ee)),dt(o,yd,ee=>t(9,k=ee));let C=!1;Sd(async()=>{await g0(),await e0(),t(4,C=!0);try{(await fetch("/osm/areas.json")).ok&&(At(Mu,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let L=null;function z(){a.fitBounds(d.getBounds(),{animate:!1})}let R,D,B;function N(ee){Ki[ee?"unshift":"push"](()=>{B=ee,t(3,B),t(11,n)})}function V(ee){L=ee,t(0,L)}const U=ee=>{console.log(ee.detail.error)};function le(ee){Ki[ee?"unshift":"push"](()=>{D=ee,t(2,D),t(12,l)})}const oe=()=>At(yd,k=!0,k);function H(ee){Ki[ee?"unshift":"push"](()=>{R=ee,t(1,R),t(13,u)})}return o.$$.update=()=>{o.$$.dirty&1&&L&&es.set(L),o.$$.dirty&8194&&R&&u&&(t(1,R.innerHTML="",R),R.appendChild(u)),o.$$.dirty&4100&&D&&l&&(t(2,D.innerHTML="",D),D.appendChild(l)),o.$$.dirty&2056&&B&&n&&(t(3,B.innerHTML="",B),B.appendChild(n))},[L,R,D,B,C,d,a,x,S,k,z,n,l,u,N,V,U,le,oe,H]}class uC extends Gt{constructor(e){super(),Zt(this,e,cC,lC,Ft,{})}}new uC({target:document.getElementById("app")});
