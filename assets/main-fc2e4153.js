var xs=Object.defineProperty;var ea=(r,e,t)=>e in r?xs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var pt=(r,e,t)=>(ea(r,typeof e!="symbol"?e+"":e,t),t);import{S as le,i as ie,s as oe,e as Je,a as $,n as Y,d as k,b as h,t as B,c as T,f as j,g as m,h as ne,j as V,k as Be,l as x,u as Re,m as De,o as Ue,p as b,q as C,r as ft,v as ze,w as Te,x as Me,y as ut,z as ta,A as go,B as na,C as ye,D as ve,E as Z,F as wr,G as F,H as P,I,J as te,K as de,L as Jt,M as yr,N as Po,O as Dt,P as Yi,Q as We,R as qe,T as ho,U as mt,V as bo,W as Tt,X as ra,Y as pn,Z as Io,_ as Ur,$ as Zi,a0 as Xr,a1 as oa,a2 as Vt,a3 as Ki,a4 as Mr,a5 as la,a6 as ia,a7 as sa,a8 as aa,a9 as vr,aa as fa,ab as Oe,ac as fn,ad as vt,ae as Vr,af as un,ag as Mt,ah as Ve,ai as At,aj as xt,ak as Xi,al as Vi,am as Wt,an as $t,ao as nt,ap as xe,aq as Eo,ar as ua,as as ca,at as da,au as _a,av as ht,aw as ot,ax as yn,ay as Ce,az as Zt,aA as ue,aB as Jn,aC as tt,aD as Mn,aE as $r,aF as Qr,aG as wo,aH as Nt,aI as Qi,aJ as xr,aK as jo,aL as pr,aM as Yn,aN as Zn,aO as eo,aP as No,aQ as pa,aR as to,aS as ma,aT as zo,aU as ga,aV as ha}from"./pico.conditional.jade.min-d94910b9.js";function He(r,e){const t={},n={},o={$$scope:1};let l=r.length;for(;l--;){const i=r[l],s=e[l];if(s){for(const a in i)a in s||(n[a]=1);for(const a in s)o[a]||(t[a]=s[a],o[a]=1);r[l]=s}else for(const a in i)o[a]=1}for(const i in n)i in t||(t[i]=void 0);return t}function xn(r){return typeof r=="object"&&r!==null?r:{}}const ba="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",wa="/ltn/assets/logo-97f2d067.svg",xi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function Oo(r){let e,t,n,o=r[1]!=null&&Bo(r);return{c(){e=h("div"),t=B(r[0]),n=T(),o&&o.c(),j(e,"class","cover svelte-1w7hi45")},m(l,i){$(l,e,i),m(e,t),m(e,n),o&&o.m(e,null)},p(l,i){i&1&&ne(t,l[0]),l[1]!=null?o?o.p(l,i):(o=Bo(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&k(e),o&&o.d()}}}function Bo(r){let e,t;return{c(){e=h("div"),t=h("progress"),t.value=r[1],V(t,"width","100%")},m(n,o){$(n,e,o),m(e,t)},p(n,o){o&2&&(t.value=n[1])},d(n){n&&k(e)}}}function ya(r){let e,t=r[0]&&Oo(r);return{c(){t&&t.c(),e=Je()},m(n,o){t&&t.m(n,o),$(n,e,o)},p(n,[o]){n[0]?t?t.p(n,o):(t=Oo(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Y,o:Y,d(n){n&&k(e),t&&t.d(n)}}}function va(r,e,t){let{loading:n}=e,{progress:o=null}=e;return r.$$set=l=>{"loading"in l&&t(0,n=l.loading),"progress"in l&&t(1,o=l.progress)},[n,o]}class es extends le{constructor(e){super(),ie(this,e,va,ya,oe,{loading:0,progress:1})}}const $a=r=>({dialog:r&1}),Ro=r=>({dialog:r[0]});function ka(r){let e,t,n,o,l;const i=r[4].default,s=Be(i,r,r[3],Ro);return{c(){e=h("dialog"),t=h("article"),s&&s.c(),e.open=!0},m(a,f){$(a,e,f),m(e,t),s&&s.m(t,null),r[6](e),n=!0,o||(l=[x(window,"click",r[1]),x(window,"keydown",r[2]),x(e,"close",r[5])],o=!0)},p(a,[f]){s&&s.p&&(!n||f&9)&&Re(s,i,a,a[3],n?Ue(i,a[3],f,$a):De(a[3]),Ro)},i(a){n||(b(s,a),n=!0)},o(a){C(s,a),n=!1},d(a){a&&k(e),s&&s.d(a),r[6](null),o=!1,ft(l)}}}function Sa(r,e,t){let{$$slots:n={},$$scope:o}=e,l;function i(u){l.open&&u.target==l&&l.close()}function s(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),l.close())}function a(u){ze.call(this,r,u)}function f(u){Te[u?"unshift":"push"](()=>{l=u,t(0,l)})}return r.$$set=u=>{"$$scope"in u&&t(3,o=u.$$scope)},[l,i,s,o,n,a,f]}class Tr extends le{constructor(e){super(),ie(this,e,Sa,ka,oe,{})}}function Do(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function Uo(r){let e,t,n=r[1]+"",o,l,i,s=r[2]+"",a,f;return{c(){e=h("tr"),t=h("td"),o=B(n),l=T(),i=h("td"),a=B(s),f=T()},m(u,c){$(u,e,c),m(e,t),m(t,o),m(e,l),m(e,i),m(i,a),m(e,f)},p(u,c){c&1&&n!==(n=u[1]+"")&&ne(o,n),c&1&&s!==(s=u[2]+"")&&ne(a,s)},d(u){u&&k(e)}}}function La(r){let e,t,n=Me(Object.entries(r[0])),o=[];for(let l=0;l<n.length;l+=1)o[l]=Uo(Do(r,n,l));return{c(){e=h("table"),t=h("tbody");for(let l=0;l<o.length;l+=1)o[l].c();j(e,"class","svelte-lh2o9l")},m(l,i){$(l,e,i),m(e,t);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(t,null)},p(l,[i]){if(i&1){n=Me(Object.entries(l[0]));let s;for(s=0;s<n.length;s+=1){const a=Do(l,n,s);o[s]?o[s].p(a,i):(o[s]=Uo(a),o[s].c(),o[s].m(t,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},i:Y,o:Y,d(l){l&&k(e),ut(o,l)}}}function Ca(r,e,t){let{properties:n}=e;return r.$$set=o=>{"properties"in o&&t(0,n=o.properties)},[n]}class er extends le{constructor(e){super(),ie(this,e,Ca,La,oe,{properties:0})}}function Ho(r,e,t){const n=r.slice();return n[2]=e[t][0],n[6]=e[t][1],n}function Go(r,e,t){const n=r.slice();return n[2]=e[t][0],n[3]=e[t][1],n}function Wo(r,e,t){const n=r.slice();return n[3]=e[t][0],n[6]=e[t][1],n}function Ma(r){let e,t=Me(Object.entries(r[0])),n=[];for(let o=0;o<t.length;o+=1)n[o]=qo(Ho(r,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=Je()},m(o,l){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,l);$(o,e,l)},p(o,l){if(l&1){t=Me(Object.entries(o[0]));let i;for(i=0;i<t.length;i+=1){const s=Ho(o,t,i);n[i]?n[i].p(s,l):(n[i]=qo(s),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&k(e),ut(n,o)}}}function Ta(r){let e,t,n,o=Me(Object.entries(r[0])),l=[];for(let a=0;a<o.length;a+=1)l[a]=Jo(Wo(r,o,a));let i=Me(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=Yo(Go(r,i,a));return{c(){e=h("div");for(let a=0;a<l.length;a+=1)l[a].c();t=T(),n=h("div");for(let a=0;a<s.length;a+=1)s[a].c();V(e,"display","flex"),V(n,"display","flex"),V(n,"justify-content","space-between")},m(a,f){$(a,e,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);$(a,t,f),$(a,n,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(n,null)},p(a,f){if(f&1){o=Me(Object.entries(a[0]));let u;for(u=0;u<o.length;u+=1){const c=Wo(a,o,u);l[u]?l[u].p(c,f):(l[u]=Jo(c),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(f&1){i=Me(Object.entries(a[0]));let u;for(u=0;u<i.length;u+=1){const c=Go(a,i,u);s[u]?s[u].p(c,f):(s[u]=Yo(c),s[u].c(),s[u].m(n,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},d(a){a&&(k(e),k(t),k(n)),ut(l,a),ut(s,a)}}}function qo(r){let e,t,n,o=r[2]+"",l,i;return{c(){e=h("div"),t=h("span"),n=T(),l=B(o),i=T(),j(t,"class","vertical-block svelte-rl95zk"),V(t,"background",r[6])},m(s,a){$(s,e,a),m(e,t),m(e,n),m(e,l),m(e,i)},p(s,a){a&1&&V(t,"background",s[6]),a&1&&o!==(o=s[2]+"")&&ne(l,o)},d(s){s&&k(e)}}}function Jo(r){let e,t;return{c(){e=h("span"),t=B(` 
      `),V(e,"background",r[6]),V(e,"width","100%"),V(e,"border","1px solid black")},m(n,o){$(n,e,o),m(e,t)},p(n,o){o&1&&V(e,"background",n[6])},d(n){n&&k(e)}}}function Yo(r){let e,t=r[2]+"",n;return{c(){e=h("span"),n=B(t)},m(o,l){$(o,e,l),m(e,n)},p(o,l){l&1&&t!==(t=o[2]+"")&&ne(n,t)},d(o){o&&k(e)}}}function Aa(r){let e;function t(l,i){return l[1]?Ta:Ma}let n=t(r),o=n(r);return{c(){o.c(),e=Je()},m(l,i){o.m(l,i),$(l,e,i)},p(l,[i]){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},i:Y,o:Y,d(l){l&&k(e),o.d(l)}}}function Fa(r,e,t){let{colors:n}=e,{horiz:o=!1}=e;return r.$$set=l=>{"colors"in l&&t(0,n=l.colors),"horiz"in l&&t(1,o=l.horiz)},[n,o]}class Ar extends le{constructor(e){super(),ie(this,e,Fa,Aa,oe,{colors:0,horiz:1})}}function Zo(r,e,t){const n=r.slice();return n[3]=e[t],n}function Ko(r,e,t){const n=r.slice();return n[6]=e[t],n}function Xo(r){let e,t;return{c(){e=h("span"),t=B(` 
    `),V(e,"background",r[6]),V(e,"width","100%"),V(e,"border","1px solid black")},m(n,o){$(n,e,o),m(e,t)},p(n,o){o&1&&V(e,"background",n[6])},d(n){n&&k(e)}}}function Pa(r){let e,t=r[3]+"",n;return{c(){e=h("span"),n=B(t)},m(o,l){$(o,e,l),m(e,n)},p(o,l){l&2&&t!==(t=o[3]+"")&&ne(n,t)},d(o){o&&k(e)}}}function Ia(r){let e,t=r[3].toFixed(r[2])+"",n;return{c(){e=h("span"),n=B(t)},m(o,l){$(o,e,l),m(e,n)},p(o,l){l&6&&t!==(t=o[3].toFixed(o[2])+"")&&ne(n,t)},d(o){o&&k(e)}}}function Vo(r){let e;function t(l,i){return l[2]>0?Ia:Pa}let n=t(r),o=n(r);return{c(){o.c(),e=Je()},m(l,i){o.m(l,i),$(l,e,i)},p(l,i){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&k(e),o.d(l)}}}function Ea(r){let e,t,n,o=Me(r[0]),l=[];for(let a=0;a<o.length;a+=1)l[a]=Xo(Ko(r,o,a));let i=Me(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Vo(Zo(r,i,a));return{c(){e=h("div");for(let a=0;a<l.length;a+=1)l[a].c();t=T(),n=h("div");for(let a=0;a<s.length;a+=1)s[a].c();V(e,"display","flex"),V(n,"display","flex"),V(n,"justify-content","space-between")},m(a,f){$(a,e,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);$(a,t,f),$(a,n,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(n,null)},p(a,[f]){if(f&1){o=Me(a[0]);let u;for(u=0;u<o.length;u+=1){const c=Ko(a,o,u);l[u]?l[u].p(c,f):(l[u]=Xo(c),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(f&6){i=Me(a[1]);let u;for(u=0;u<i.length;u+=1){const c=Zo(a,i,u);s[u]?s[u].p(c,f):(s[u]=Vo(c),s[u].c(),s[u].m(n,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},i:Y,o:Y,d(a){a&&(k(e),k(t),k(n)),ut(l,a),ut(s,a)}}}function ja(r,e,t){let{colorScale:n}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return r.$$set=i=>{"colorScale"in i&&t(0,n=i.colorScale),"limits"in i&&t(1,o=i.limits),"decimalPlaces"in i&&t(2,l=i.decimalPlaces)},[n,o,l]}class mn extends le{constructor(e){super(),ie(this,e,ja,Ea,oe,{colorScale:0,limits:1,decimalPlaces:2})}}function kr(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ct(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let _e;const ts=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ts.decode();let Nn=null;function Hn(){return(Nn===null||Nn.byteLength===0)&&(Nn=new Uint8Array(_e.memory.buffer)),Nn}function Ot(r,e){return r=r>>>0,ts.decode(Hn().subarray(r,r+e))}const nn=new Array(128).fill(void 0);nn.push(void 0,null,!0,!1);let Gn=nn.length;function at(r){Gn===nn.length&&nn.push(nn.length+1);const e=Gn;return Gn=nn[e],nn[e]=r,e}function Fe(r){return nn[r]}function Na(r){r<132||(nn[r]=Gn,Gn=r)}function Sn(r){const e=Fe(r);return Na(r),e}function Hr(r){return r==null}let zn=null;function za(){return(zn===null||zn.byteLength===0)&&(zn=new Float64Array(_e.memory.buffer)),zn}let On=null;function je(){return(On===null||On.byteLength===0)&&(On=new Int32Array(_e.memory.buffer)),On}let cn=0;const mr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Oa=typeof mr.encodeInto=="function"?function(r,e){return mr.encodeInto(r,e)}:function(r,e){const t=mr.encode(r);return e.set(t),{read:r.length,written:t.length}};function ur(r,e,t){if(t===void 0){const s=mr.encode(r),a=e(s.length,1)>>>0;return Hn().subarray(a,a+s.length).set(s),cn=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=Hn();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=Hn().subarray(o+i,o+n),a=Oa(r,s);i+=a.written}return cn=i,o}function no(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=no(r[0]));for(let i=1;i<o;i++)l+=", "+no(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ba(r,e){const t=e(r.length*1,1)>>>0;return Hn().set(r,t/1),cn=r.length,t}function Gr(r,e){try{return r.apply(this,e)}catch(t){_e.__wbindgen_exn_store(at(t))}}class Sr{static __wrap(e){e=e>>>0;const t=Object.create(Sr.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();_e.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=_e.__wbindgen_add_to_stack_pointer(-16),i=Ba(e,_e.__wbindgen_malloc),s=cn;_e.jsroutesnapper_new(l,i,s);var t=je()[l/4+0],n=je()[l/4+1],o=je()[l/4+2];if(o)throw Sn(n);return Sr.__wrap(t)}finally{_e.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){_e.jsroutesnapper_setRouteConfig(this.__wbg_ptr,at(e))}setAreaMode(){_e.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const l=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_getConfig(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=je()[n/4+0],t=je()[n/4+1];let o;return e!==0&&(o=Ot(e,t).slice(),_e.__wbindgen_free(e,t*1)),o}finally{_e.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const l=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,t,1)}}toggleSnapMode(){_e.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return _e.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){_e.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return _e.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return _e.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){_e.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_editExisting(o,this.__wbg_ptr,at(e));var t=je()[o/4+0],n=je()[o/4+1];if(n)throw Sn(t)}finally{_e.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const l=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const l=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const u=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,at(e));var o=je()[u/4+0],l=je()[u/4+1],i=je()[u/4+2],s=je()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Sn(i);return t=a,n=f,Ot(a,f)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){_e.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){_e.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const u=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,at(e));var o=je()[u/4+0],l=je()[u/4+1],i=je()[u/4+2],s=je()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Sn(i);return t=a,n=f,Ot(a,f)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,o;try{const c=_e.__wbindgen_add_to_stack_pointer(-16);_e.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,at(e),at(t));var l=je()[c/4+0],i=je()[c/4+1],s=je()[c/4+2],a=je()[c/4+3],f=l,u=i;if(a)throw f=0,u=0,Sn(s);return n=f,o=u,Ot(f,u)}finally{_e.__wbindgen_add_to_stack_pointer(16),_e.__wbindgen_free(n,o,1)}}}async function Ra(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Da(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ot(e,t);return at(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Sn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ot(e,t));return at(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Fe(t),o=typeof n=="number"?n:void 0;za()[e/8+1]=Hr(o)?0:o,je()[e/4+0]=!Hr(o)},r.wbg.__wbindgen_is_object=function(e){const t=Fe(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Fe(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Fe(e)in Fe(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Fe(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Fe(e)==Fe(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Fe(t),o=typeof n=="string"?n:void 0;var l=Hr(o)?0:ur(o,_e.__wbindgen_malloc,_e.__wbindgen_realloc),i=cn;je()[e/4+1]=i,je()[e/4+0]=l},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Fe(t)),o=ur(n,_e.__wbindgen_malloc,_e.__wbindgen_realloc),l=cn;je()[e/4+1]=l,je()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Fe(e);return at(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Fe(e)[Fe(t)];return at(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return at(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Fe(t).stack,o=ur(n,_e.__wbindgen_malloc,_e.__wbindgen_realloc),l=cn;je()[e/4+1]=l,je()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(Ot(e,t))}finally{_e.__wbindgen_free(n,o,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Fe(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Fe(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Fe(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Fe(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Fe(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Fe(e)[t>>>0];return at(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Fe(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Fe(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Fe(e).next;return at(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Gr(function(e){const t=Fe(e).next();return at(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Fe(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Fe(e).value;return at(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return at(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Gr(function(e,t){const n=Reflect.get(Fe(e),Fe(t));return at(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Gr(function(e,t){const n=Fe(e).call(Fe(t));return at(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Fe(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Fe(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Fe(e).buffer;return at(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Fe(e));return at(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Fe(e).set(Fe(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Fe(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Fe(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=no(Fe(t)),o=ur(n,_e.__wbindgen_malloc,_e.__wbindgen_realloc),l=cn;je()[e/4+1]=l,je()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ot(e,t))},r.wbg.__wbindgen_memory=function(){const e=_e.memory;return at(e)},r}function Ua(r,e){return _e=r.exports,ns.__wbindgen_wasm_module=e,zn=null,On=null,Nn=null,_e}async function ns(r){if(_e!==void 0)return _e;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Da();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ra(await r,e);return Ua(t,n)}var yt=63710088e-1,yo={centimeters:yt*100,centimetres:yt*100,degrees:yt/111325,feet:yt*3.28084,inches:yt*39.37,kilometers:yt/1e3,kilometres:yt/1e3,meters:yt,metres:yt,miles:yt/1609.344,millimeters:yt*1e3,millimetres:yt*1e3,nauticalmiles:yt/1852,radians:1,yards:yt*1.0936},Ha={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/yt,yards:1.0936133},ro={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ut(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ga(r,e,t){switch(r){case"Point":return Ct(e).geometry;case"LineString":return Bt(e).geometry;case"Polygon":return vo(e).geometry;case"MultiPoint":return os(e).geometry;case"MultiLineString":return rs(e).geometry;case"MultiPolygon":return ls(e).geometry;default:throw new Error(r+" is invalid")}}function Ct(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Lr(r[0])||!Lr(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Ut(n,e,t)}function Wa(r,e,t){return t===void 0&&(t={}),vn(r.map(function(n){return Ct(n,e)}),t)}function vo(r,e,t){t===void 0&&(t={});for(var n=0,o=r;n<o.length;n++){var l=o[n];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<l[l.length-1].length;i++)if(l[l.length-1][i]!==l[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return Ut(s,e,t)}function qa(r,e,t){return t===void 0&&(t={}),vn(r.map(function(n){return vo(n,e)}),t)}function Bt(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Ut(n,e,t)}function Ja(r,e,t){return t===void 0&&(t={}),vn(r.map(function(n){return Bt(n,e)}),t)}function vn(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function rs(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return Ut(n,e,t)}function os(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return Ut(n,e,t)}function ls(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return Ut(n,e,t)}function Ya(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return Ut(n,e,t)}function Za(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function $o(r,e){e===void 0&&(e="kilometers");var t=yo[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Fr(r,e){e===void 0&&(e="kilometers");var t=yo[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ka(r,e){return Kn(Fr(r,e))}function Xa(r){var e=r%360;return e<0&&(e+=360),e}function Kn(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Rt(r){var e=r%360;return e*Math.PI/180}function Va(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return $o(Fr(r,e),t)}function Qa(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=ro[e];if(!n)throw new Error("invalid original units");var o=ro[t];if(!o)throw new Error("invalid final units");return r/n*o}function Lr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function ko(r){return!!r&&r.constructor===Object}function xa(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Lr(e))throw new Error("bbox must only contain numbers")})}function ef(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const tf=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:ro,bearingToAzimuth:Xa,convertArea:Qa,convertLength:Va,degreesToRadians:Rt,earthRadius:yt,factors:yo,feature:Ut,featureCollection:vn,geometry:Ga,geometryCollection:Ya,isNumber:Lr,isObject:ko,lengthToDegrees:Ka,lengthToRadians:Fr,lineString:Bt,lineStrings:Ja,multiLineString:rs,multiPoint:os,multiPolygon:ls,point:Ct,points:Wa,polygon:vo,polygons:qa,radiansToDegrees:Kn,radiansToLength:$o,round:Za,unitsFactors:Ha,validateBBox:xa,validateId:ef},Symbol.toStringTag,{value:"Module"}));function Xn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Tn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function In(r,e,t){t===void 0&&(t={});var n=Xn(r),o=Xn(e),l=Rt(o[1]-n[1]),i=Rt(o[0]-n[0]),s=Rt(n[1]),a=Rt(o[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return $o(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function tr(r,e,t){if(r!==null)for(var n,o,l,i,s,a,f,u=0,c=0,_,d=r.type,p=d==="FeatureCollection",g=d==="Feature",w=p?r.features.length:1,S=0;S<w;S++){f=p?r.features[S].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var y=0;y<s;y++){var v=0,L=0;if(i=_?f.geometries[y]:f,i!==null){a=i.coordinates;var A=i.type;switch(u=t&&(A==="Polygon"||A==="MultiPolygon")?1:0,A){case null:break;case"Point":if(e(a,c,S,v,L)===!1)return!1;c++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,S,v,L)===!1)return!1;c++,A==="MultiPoint"&&v++}A==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-u;o++){if(e(a[n][o],c,S,v,L)===!1)return!1;c++}A==="MultiLineString"&&v++,A==="Polygon"&&L++}A==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(L=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-u;l++){if(e(a[n][o][l],c,S,v,L)===!1)return!1;c++}L++}v++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(tr(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function nf(r,e,t,n){var o=t;return tr(r,function(l,i,s,a,f){i===0&&t===void 0?o=l:o=e(o,l,i,s,a,f)},n),o}function is(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function rf(r,e,t){var n=t;return is(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function Cr(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function of(r,e,t){var n=t;return Cr(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function lf(r){var e=[];return tr(r,function(t){e.push(t)}),e}function So(r,e){var t,n,o,l,i,s,a,f,u,c,_=0,d=r.type==="FeatureCollection",p=r.type==="Feature",g=d?r.features.length:1;for(t=0;t<g;t++){for(s=d?r.features[t].geometry:p?r.geometry:r,f=d?r.features[t].properties:p?r.properties:{},u=d?r.features[t].bbox:p?r.bbox:void 0,c=d?r.features[t].id:p?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,o=0;o<i;o++){if(l=a?s.geometries[o]:s,l===null){if(e(null,_,f,u,c)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,_,f,u,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(e(l.geometries[n],_,f,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function sf(r,e,t){var n=t;return So(r,function(o,l,i,s,a){l===0&&t===void 0?n=o:n=e(n,o,l,i,s,a)}),n}function Fn(r,e){So(r,function(t,n,o,l,i){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Ut(t,o,{bbox:l,id:i}),n,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var u=t.coordinates[f],c={type:a,coordinates:u};if(e(Ut(c,o),n,f)===!1)return!1}})}function af(r,e,t){var n=t;return Fn(r,function(o,l,i){l===0&&i===0&&t===void 0?n=o:n=e(n,o,l,i)}),n}function ss(r,e){Fn(r,function(t,n,o){var l=0;if(t.geometry){var i=t.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,f=0,u=0;if(tr(t,function(c,_,d,p,g){if(s===void 0||n>a||p>f||g>u){s=c,a=n,f=p,u=g,l=0;return}var w=Bt([s,c],t.properties);if(e(w,n,o,g,l)===!1)return!1;l++,s=c})===!1)return!1}}})}function ff(r,e,t){var n=t,o=!1;return ss(r,function(l,i,s,a,f){o===!1&&t===void 0?n=l:n=e(n,l,i,s,a,f),o=!0}),n}function as(r,e){if(!r)throw new Error("geojson is required");Fn(r,function(t,n,o){if(t.geometry!==null){var l=t.geometry.type,i=t.geometry.coordinates;switch(l){case"LineString":if(e(t,n,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Bt(i[s],t.properties),n,o,s)===!1)return!1;break}}})}function uf(r,e,t){var n=t;return as(r,function(o,l,i,s){l===0&&t===void 0?n=o:n=e(n,o,l,i,s)}),n}function cf(r,e){if(e=e||{},!ko(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=a.length+l-1),Bt([a[l],a[l+1]],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l-1),Bt([a[o][l],a[o][l+1]],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l-1),Bt([a[n][l],a[n][l+1]],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l-1),Bt([a[n][o][l],a[n][o][l+1]],i,e)}throw new Error("geojson is invalid")}function df(r,e){if(e=e||{},!ko(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return Ct(a,i,e);case"MultiPoint":return n<0&&(n=a.length+n),Ct(a[n],i,e);case"LineString":return l<0&&(l=a.length+l),Ct(a[l],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l),Ct(a[o][l],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l),Ct(a[n][l],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l),Ct(a[n][o][l],i,e)}throw new Error("geojson is invalid")}const _f=Object.freeze(Object.defineProperty({__proto__:null,coordAll:lf,coordEach:tr,coordReduce:nf,featureEach:Cr,featureReduce:of,findPoint:df,findSegment:cf,flattenEach:Fn,flattenReduce:af,geomEach:So,geomReduce:sf,lineEach:as,lineReduce:uf,propEach:is,propReduce:rf,segmentEach:ss,segmentReduce:ff},Symbol.toStringTag,{value:"Module"}));function fs(r,e,t){if(t===void 0&&(t={}),t.final===!0)return pf(r,e);var n=Xn(r),o=Xn(e),l=Rt(n[0]),i=Rt(o[0]),s=Rt(n[1]),a=Rt(o[1]),f=Math.sin(i-l)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return Kn(Math.atan2(f,u))}function pf(r,e){var t=fs(e,r);return t=(t+180)%360,t}function Qo(r,e,t,n){n===void 0&&(n={});var o=Xn(r),l=Rt(o[0]),i=Rt(o[1]),s=Rt(t),a=Fr(e,n.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=Kn(u),_=Kn(f);return Ct([c,_],n.properties)}function xo(r){if(!r)throw new Error("geojson is required");var e=[];return Fn(r,function(t){mf(t,e)}),vn(e)}function mf(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Tn(n);break;case"LineString":t=[Tn(n)]}t.forEach(function(o){var l=gf(o,r.properties);l.forEach(function(i){i.id=e.length,e.push(i)})})}}function gf(r,e){var t=[];return r.reduce(function(n,o){var l=Bt([n,o],e);return l.bbox=hf(n,o),t.push(l),o}),t}function hf(r,e){var t=r[0],n=r[1],o=e[0],l=e[1],i=t<o?t:o,s=n<l?n:l,a=t>o?t:o,f=n>l?n:l;return[i,s,a,f]}var Lo={exports:{}},us={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(ta,function(){function t(y,v,L,A,E){(function M(N,z,D,O,R){for(;O>D;){if(O-D>600){var H=O-D+1,q=z-D+1,X=Math.log(H),se=.5*Math.exp(2*X/3),ce=.5*Math.sqrt(X*se*(H-se)/H)*(q-H/2<0?-1:1),U=Math.max(D,Math.floor(z-q*se/H+ce)),be=Math.min(O,Math.floor(z+(H-q)*se/H+ce));M(N,z,U,be,R)}var ge=N[z],ae=D,we=O;for(n(N,D,z),R(N[O],ge)>0&&n(N,D,O);ae<we;){for(n(N,ae,we),ae++,we--;R(N[ae],ge)<0;)ae++;for(;R(N[we],ge)>0;)we--}R(N[D],ge)===0?n(N,D,we):n(N,++we,O),we<=z&&(D=we+1),z<=we&&(O=we-1)}})(y,v,L||0,A||y.length-1,E||o)}function n(y,v,L){var A=y[v];y[v]=y[L],y[L]=A}function o(y,v){return y<v?-1:y>v?1:0}var l=function(y){y===void 0&&(y=9),this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(y,v,L){if(!L)return v.indexOf(y);for(var A=0;A<v.length;A++)if(L(y,v[A]))return A;return-1}function s(y,v){a(y,0,y.children.length,v,y)}function a(y,v,L,A,E){E||(E=w(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var M=v;M<L;M++){var N=y.children[M];f(E,y.leaf?A(N):N)}return E}function f(y,v){return y.minX=Math.min(y.minX,v.minX),y.minY=Math.min(y.minY,v.minY),y.maxX=Math.max(y.maxX,v.maxX),y.maxY=Math.max(y.maxY,v.maxY),y}function u(y,v){return y.minX-v.minX}function c(y,v){return y.minY-v.minY}function _(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function d(y){return y.maxX-y.minX+(y.maxY-y.minY)}function p(y,v){return y.minX<=v.minX&&y.minY<=v.minY&&v.maxX<=y.maxX&&v.maxY<=y.maxY}function g(y,v){return v.minX<=y.maxX&&v.minY<=y.maxY&&v.maxX>=y.minX&&v.maxY>=y.minY}function w(y){return{children:y,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function S(y,v,L,A,E){for(var M=[v,L];M.length;)if(!((L=M.pop())-(v=M.pop())<=A)){var N=v+Math.ceil((L-v)/A/2)*A;t(y,N,v,L,E),M.push(v,N,N,L)}}return l.prototype.all=function(){return this._all(this.data,[])},l.prototype.search=function(y){var v=this.data,L=[];if(!g(y,v))return L;for(var A=this.toBBox,E=[];v;){for(var M=0;M<v.children.length;M++){var N=v.children[M],z=v.leaf?A(N):N;g(y,z)&&(v.leaf?L.push(N):p(y,z)?this._all(N,L):E.push(N))}v=E.pop()}return L},l.prototype.collides=function(y){var v=this.data;if(!g(y,v))return!1;for(var L=[];v;){for(var A=0;A<v.children.length;A++){var E=v.children[A],M=v.leaf?this.toBBox(E):E;if(g(y,M)){if(v.leaf||p(y,M))return!0;L.push(E)}}v=L.pop()}return!1},l.prototype.load=function(y){if(!y||!y.length)return this;if(y.length<this._minEntries){for(var v=0;v<y.length;v++)this.insert(y[v]);return this}var L=this._build(y.slice(),0,y.length-1,0);if(this.data.children.length)if(this.data.height===L.height)this._splitRoot(this.data,L);else{if(this.data.height<L.height){var A=this.data;this.data=L,L=A}this._insert(L,this.data.height-L.height-1,!0)}else this.data=L;return this},l.prototype.insert=function(y){return y&&this._insert(y,this.data.height-1),this},l.prototype.clear=function(){return this.data=w([]),this},l.prototype.remove=function(y,v){if(!y)return this;for(var L,A,E,M=this.data,N=this.toBBox(y),z=[],D=[];M||z.length;){if(M||(M=z.pop(),A=z[z.length-1],L=D.pop(),E=!0),M.leaf){var O=i(y,M.children,v);if(O!==-1)return M.children.splice(O,1),z.push(M),this._condense(z),this}E||M.leaf||!p(M,N)?A?(L++,M=A.children[L],E=!1):M=null:(z.push(M),D.push(L),L=0,A=M,M=M.children[0])}return this},l.prototype.toBBox=function(y){return y},l.prototype.compareMinX=function(y,v){return y.minX-v.minX},l.prototype.compareMinY=function(y,v){return y.minY-v.minY},l.prototype.toJSON=function(){return this.data},l.prototype.fromJSON=function(y){return this.data=y,this},l.prototype._all=function(y,v){for(var L=[];y;)y.leaf?v.push.apply(v,y.children):L.push.apply(L,y.children),y=L.pop();return v},l.prototype._build=function(y,v,L,A){var E,M=L-v+1,N=this._maxEntries;if(M<=N)return s(E=w(y.slice(v,L+1)),this.toBBox),E;A||(A=Math.ceil(Math.log(M)/Math.log(N)),N=Math.ceil(M/Math.pow(N,A-1))),(E=w([])).leaf=!1,E.height=A;var z=Math.ceil(M/N),D=z*Math.ceil(Math.sqrt(N));S(y,v,L,D,this.compareMinX);for(var O=v;O<=L;O+=D){var R=Math.min(O+D-1,L);S(y,O,R,z,this.compareMinY);for(var H=O;H<=R;H+=z){var q=Math.min(H+z-1,R);E.children.push(this._build(y,H,q,A-1))}}return s(E,this.toBBox),E},l.prototype._chooseSubtree=function(y,v,L,A){for(;A.push(v),!v.leaf&&A.length-1!==L;){for(var E=1/0,M=1/0,N=void 0,z=0;z<v.children.length;z++){var D=v.children[z],O=_(D),R=(H=y,q=D,(Math.max(q.maxX,H.maxX)-Math.min(q.minX,H.minX))*(Math.max(q.maxY,H.maxY)-Math.min(q.minY,H.minY))-O);R<M?(M=R,E=O<E?O:E,N=D):R===M&&O<E&&(E=O,N=D)}v=N||v.children[0]}var H,q;return v},l.prototype._insert=function(y,v,L){var A=L?y:this.toBBox(y),E=[],M=this._chooseSubtree(A,this.data,v,E);for(M.children.push(y),f(M,A);v>=0&&E[v].children.length>this._maxEntries;)this._split(E,v),v--;this._adjustParentBBoxes(A,E,v)},l.prototype._split=function(y,v){var L=y[v],A=L.children.length,E=this._minEntries;this._chooseSplitAxis(L,E,A);var M=this._chooseSplitIndex(L,E,A),N=w(L.children.splice(M,L.children.length-M));N.height=L.height,N.leaf=L.leaf,s(L,this.toBBox),s(N,this.toBBox),v?y[v-1].children.push(N):this._splitRoot(L,N)},l.prototype._splitRoot=function(y,v){this.data=w([y,v]),this.data.height=y.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},l.prototype._chooseSplitIndex=function(y,v,L){for(var A,E,M,N,z,D,O,R=1/0,H=1/0,q=v;q<=L-v;q++){var X=a(y,0,q,this.toBBox),se=a(y,q,L,this.toBBox),ce=(E=X,M=se,N=void 0,z=void 0,D=void 0,O=void 0,N=Math.max(E.minX,M.minX),z=Math.max(E.minY,M.minY),D=Math.min(E.maxX,M.maxX),O=Math.min(E.maxY,M.maxY),Math.max(0,D-N)*Math.max(0,O-z)),U=_(X)+_(se);ce<R?(R=ce,A=q,H=U<H?U:H):ce===R&&U<H&&(H=U,A=q)}return A||L-v},l.prototype._chooseSplitAxis=function(y,v,L){var A=y.leaf?this.compareMinX:u,E=y.leaf?this.compareMinY:c;this._allDistMargin(y,v,L,A)<this._allDistMargin(y,v,L,E)&&y.children.sort(A)},l.prototype._allDistMargin=function(y,v,L,A){y.children.sort(A);for(var E=this.toBBox,M=a(y,0,v,E),N=a(y,L-v,L,E),z=d(M)+d(N),D=v;D<L-v;D++){var O=y.children[D];f(M,y.leaf?E(O):O),z+=d(M)}for(var R=L-v-1;R>=v;R--){var H=y.children[R];f(N,y.leaf?E(H):H),z+=d(N)}return z},l.prototype._adjustParentBBoxes=function(y,v,L){for(var A=L;A>=0;A--)f(v[A],y)},l.prototype._condense=function(y){for(var v=y.length-1,L=void 0;v>=0;v--)y[v].children.length===0?v>0?(L=y[v-1].children).splice(L.indexOf(y[v]),1):this.clear():s(y[v],this.toBBox)},l})})(us);var bf=us.exports;const wf=go(tf),yf=go(_f);function cs(r,e,t){if(r!==null)for(var n,o,l,i,s,a,f,u=0,c=0,_,d=r.type,p=d==="FeatureCollection",g=d==="Feature",w=p?r.features.length:1,S=0;S<w;S++){f=p?r.features[S].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var y=0;y<s;y++){var v=0,L=0;if(i=_?f.geometries[y]:f,i!==null){a=i.coordinates;var A=i.type;switch(u=t&&(A==="Polygon"||A==="MultiPolygon")?1:0,A){case null:break;case"Point":if(e(a,c,S,v,L)===!1)return!1;c++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,S,v,L)===!1)return!1;c++,A==="MultiPoint"&&v++}A==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-u;o++){if(e(a[n][o],c,S,v,L)===!1)return!1;c++}A==="MultiLineString"&&v++,A==="Polygon"&&L++}A==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(L=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-u;l++){if(e(a[n][o][l],c,S,v,L)===!1)return!1;c++}L++}v++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(cs(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ds(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return cs(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var vf=ds;const $f=Object.freeze(Object.defineProperty({__proto__:null,bbox:ds,default:vf},Symbol.toStringTag,{value:"Module"})),kf=go($f);var Xt=bf,_s=wf,ps=yf,kn=kf.default,Sf=ps.featureEach;ps.coordEach;_s.polygon;var el=_s.featureCollection;function ms(r){var e=new Xt(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:kn(t),Xt.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:kn(o),n.push(o)}):Sf(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:kn(o),n.push(o)}),Xt.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:kn(t),Xt.prototype.remove.call(this,t,n)},e.clear=function(){return Xt.prototype.clear.call(this)},e.search=function(t){var n=Xt.prototype.search.call(this,this.toBBox(t));return el(n)},e.collides=function(t){return Xt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Xt.prototype.all.call(this);return el(t)},e.toJSON=function(){return Xt.prototype.toJSON.call(this)},e.fromJSON=function(t){return Xt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=kn(t);else if(t.type==="FeatureCollection")n=kn(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Lo.exports=ms;Lo.exports.default=ms;var Lf=Lo.exports;const Cf=na(Lf);function Mf(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Ut(r)),e.type==="LineString"&&(e=Ut(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=tl(r,e);return o&&n.push(o),vn(n)}var l=Cf();return l.load(xo(e)),Cr(xo(r),function(i){Cr(l.search(i),function(s){var a=tl(i,s);if(a){var f=Tn(a).join(",");t[f]||(t[f]=!0,n.push(a))}})}),vn(n)}function tl(r,e){var t=Tn(r),n=Tn(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],l=t[0][1],i=t[1][0],s=t[1][1],a=n[0][0],f=n[0][1],u=n[1][0],c=n[1][1],_=(c-f)*(i-o)-(u-a)*(s-l),d=(u-a)*(l-f)-(c-f)*(o-a),p=(i-o)*(l-f)-(s-l)*(o-a);if(_===0)return null;var g=d/_,w=p/_;if(g>=0&&g<=1&&w>=0&&w<=1){var S=o+g*(i-o),y=l+g*(s-l);return Ct([S,y])}return null}function Tf(r,e,t){t===void 0&&(t={});var n=Ct([1/0,1/0],{dist:1/0}),o=0;return Fn(r,function(l){for(var i=Tn(l),s=0;s<i.length-1;s++){var a=Ct(i[s]);a.properties.dist=In(e,a,t);var f=Ct(i[s+1]);f.properties.dist=In(e,f,t);var u=In(a,f,t),c=Math.max(a.properties.dist,f.properties.dist),_=fs(a,f),d=Qo(e,c,_+90,t),p=Qo(e,c,_-90,t),g=Mf(Bt([d.geometry.coordinates,p.geometry.coordinates]),Bt([a.geometry.coordinates,f.geometry.coordinates])),w=null;g.features.length>0&&(w=g.features[0],w.properties.dist=In(e,w,t),w.properties.location=o+In(a,w,t)),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=s,n.properties.location=o),f.properties.dist<n.properties.dist&&(n=f,n.properties.index=s+1,n.properties.location=o+u),w&&w.properties.dist<n.properties.dist&&(n=w,n.properties.index=s),o+=u}}),n}const Af=30;class Ff{constructor(e,t,n,o,l){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-Af,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Sr(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}function nl(r){let e,t;return e=new Tr({props:{$$slots:{default:[Pf,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Pf(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p;function g(){return r[1](r[3])}return{c(){e=h("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=T(),n=h("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,o=T(),l=h("p"),l.textContent="To use this tool, you need to:",i=T(),s=h("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,a=T(),f=h("p"),f.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,u=T(),c=h("center"),_=h("button"),_.textContent="Start!"},m(w,S){$(w,e,S),$(w,t,S),$(w,n,S),$(w,o,S),$(w,l,S),$(w,i,S),$(w,s,S),$(w,a,S),$(w,f,S),$(w,u,S),$(w,c,S),m(c,_),d||(p=x(_,"click",g),d=!0)},p(w,S){r=w},d(w){w&&(k(e),k(t),k(n),k(o),k(l),k(i),k(s),k(a),k(f),k(u),k(c)),d=!1,p()}}}function If(r){let e,t,n=r[0]&&nl(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=nl(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function Ef(r,e,t){let n;return Z(r,wr,i=>t(0,n=i)),[n,i=>ct(i).close(),()=>te(wr,n=!1,n)]}class jf extends le{constructor(e){super(),ie(this,e,Ef,If,oe,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Nf={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},rl=Nf;function ol(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Wr(r){let e,t=[r[12]],n={};for(let o=0;o<t.length;o+=1)n=de(n,t[o]);return{c(){e=Jt(r[11]),yr(e,n)},m(o,l){$(o,e,l)},p(o,l){yr(e,n=He(t,[l&32&&o[12]]))},d(o){o&&k(e)}}}function ll(r){let e=r[11],t,n=r[11]&&Wr(r);return{c(){n&&n.c(),t=Je()},m(o,l){n&&n.m(o,l),$(o,t,l)},p(o,l){o[11]?e?oe(e,o[11])?(n.d(1),n=Wr(o),e=o[11],n.c(),n.m(t.parentNode,t)):n.p(o,l):(n=Wr(o),e=o[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=o[11])},d(o){o&&k(t),n&&n.d(o)}}}function zf(r){let e,t,n,o,l,i=Me(r[5]),s=[];for(let _=0;_<i.length;_+=1)s[_]=ll(ol(r,i,_));const a=r[10].default,f=Be(a,r,r[9],null);let u=[rl,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:o=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],c={};for(let _=0;_<u.length;_+=1)c=de(c,u[_]);return{c(){e=Jt("svg");for(let _=0;_<s.length;_+=1)s[_].c();t=Je(),f&&f.c(),yr(e,c)},m(_,d){$(_,e,d);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(e,null);m(e,t),f&&f.m(e,null),l=!0},p(_,[d]){if(d&32){i=Me(_[5]);let p;for(p=0;p<i.length;p+=1){const g=ol(_,i,p);s[p]?s[p].p(g,d):(s[p]=ll(g),s[p].c(),s[p].m(e,t))}for(;p<s.length;p+=1)s[p].d(1);s.length=i.length}f&&f.p&&(!l||d&512)&&Re(f,a,_,_[9],l?Ue(a,_[9],d,null):De(_[9]),null),yr(e,c=He(u,[rl,d&128&&_[7],(!l||d&4)&&{width:_[2]},(!l||d&4)&&{height:_[2]},(!l||d&2)&&{stroke:_[1]},(!l||d&28&&n!==(n=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":n},(!l||d&257&&o!==(o=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:o}]))},i(_){l||(b(f,_),l=!0)},o(_){C(f,_),l=!1},d(_){_&&k(e),ut(s,_),f&&f.d(_)}}}function Of(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let o=Po(e,n),{$$slots:l={},$$scope:i}=e,{name:s=void 0}=e,{color:a="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:c=!1}=e,{iconNode:_=[]}=e;const d=(...p)=>p.filter((g,w,S)=>!!g&&S.indexOf(g)===w).join(" ");return r.$$set=p=>{t(8,e=de(de({},e),Dt(p))),t(7,o=Po(e,n)),"name"in p&&t(0,s=p.name),"color"in p&&t(1,a=p.color),"size"in p&&t(2,f=p.size),"strokeWidth"in p&&t(3,u=p.strokeWidth),"absoluteStrokeWidth"in p&&t(4,c=p.absoluteStrokeWidth),"iconNode"in p&&t(5,_=p.iconNode),"$$scope"in p&&t(9,i=p.$$scope)},e=Dt(e),[s,a,f,u,c,_,d,o,e,i,l]}class Bf extends le{constructor(e){super(),ie(this,e,Of,zf,oe,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const nr=Bf;function Rf(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?Ue(t,o[3],l,null):De(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Df(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[Rf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nr({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&xn(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Uf(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=i=>{t(1,e=de(de({},e),Dt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Dt(e),[l,e,n,o]}class Hf extends le{constructor(e){super(),ie(this,e,Uf,Df,oe,{})}}const Gf=Hf;function Wf(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?Ue(t,o[3],l,null):De(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function qf(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[Wf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nr({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&xn(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Jf(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=i=>{t(1,e=de(de({},e),Dt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Dt(e),[l,e,n,o]}class Yf extends le{constructor(e){super(),ie(this,e,Jf,qf,oe,{})}}const Zf=Yf;function Kf(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?Ue(t,o[3],l,null):De(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Xf(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[Kf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nr({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&xn(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Vf(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=i=>{t(1,e=de(de({},e),Dt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Dt(e),[l,e,n,o]}class Qf extends le{constructor(e){super(),ie(this,e,Vf,Xf,oe,{})}}const xf=Qf;function eu(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?Ue(t,o[3],l,null):De(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function tu(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[eu]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nr({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&xn(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function nu(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=i=>{t(1,e=de(de({},e),Dt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Dt(e),[l,e,n,o]}class ru extends le{constructor(e){super(),ie(this,e,nu,tu,oe,{})}}const Co=ru;function ou(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?Ue(t,o[3],l,null):De(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function lu(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[ou]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nr({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&xn(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function iu(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=i=>{t(1,e=de(de({},e),Dt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Dt(e),[l,e,n,o]}class su extends le{constructor(e){super(),ie(this,e,iu,lu,oe,{})}}const gs=su;function au(r){let e;const t=r[16].default,n=Be(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Re(n,t,o,o[24],e?Ue(t,o[24],l,null):De(o[24]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function fu(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[au]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Yi({props:l}),Te.push(()=>We(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],qe(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){I(e,i)}}}function uu(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=ho("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:w=void 0}=e,{manageHoverState:S=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:L=!0}=e;function A(R){y=R,t(0,y)}function E(R){ze.call(this,r,R)}function M(R){ze.call(this,r,R)}function N(R){ze.call(this,r,R)}function z(R){ze.call(this,r,R)}function D(R){ze.call(this,r,R)}function O(R){ze.call(this,r,R)}return r.$$set=R=>{"id"in R&&t(1,l=R.id),"source"in R&&t(2,i=R.source),"sourceLayer"in R&&t(3,s=R.sourceLayer),"beforeId"in R&&t(4,a=R.beforeId),"beforeLayerType"in R&&t(5,f=R.beforeLayerType),"paint"in R&&t(6,u=R.paint),"layout"in R&&t(7,c=R.layout),"filter"in R&&t(8,_=R.filter),"applyToClusters"in R&&t(9,d=R.applyToClusters),"minzoom"in R&&t(10,p=R.minzoom),"maxzoom"in R&&t(11,g=R.maxzoom),"hoverCursor"in R&&t(12,w=R.hoverCursor),"manageHoverState"in R&&t(13,S=R.manageHoverState),"hovered"in R&&t(0,y=R.hovered),"eventsIfTopMost"in R&&t(14,v=R.eventsIfTopMost),"interactive"in R&&t(15,L=R.interactive),"$$scope"in R&&t(24,o=R.$$scope)},[y,l,i,s,a,f,u,c,_,d,p,g,w,S,v,L,n,A,E,M,N,z,D,O,o]}let ln=class extends le{constructor(e){super(),ie(this,e,uu,fu,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function cu(r){let e,t;const n=r[7].default,o=Be(n,r,r[6],null);return{c(){e=h("div"),o&&o.c(),j(e,"class",r[1]),mt(e,"maplibregl-ctrl",r[0])},m(l,i){$(l,e,i),o&&o.m(e,null),r[8](e),t=!0},p(l,[i]){o&&o.p&&(!t||i&64)&&Re(o,n,l,l[6],t?Ue(n,l[6],i,null):De(l[6]),null),(!t||i&2)&&j(e,"class",l[1]),(!t||i&3)&&mt(e,"maplibregl-ctrl",l[0])},i(l){t||(b(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&k(e),o&&o.d(l),r[8](null)}}}function du(r,e,t){let n,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:f}=bo();Z(r,f,d=>t(5,n=d));let u,c={onAdd(){return u},onRemove(){var d;(d=u==null?void 0:u.parentNode)==null||d.removeChild(u)}};Tt(()=>{n==null||n.removeControl(c)});function _(d){Te[d?"unshift":"push"](()=>{u=d,t(2,u)})}return r.$$set=d=>{"defaultStyling"in d&&t(0,i=d.defaultStyling),"position"in d&&t(4,s=d.position),"class"in d&&t(1,a=d.class),"$$scope"in d&&t(6,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&u&&n.addControl(c,s)},[i,a,u,f,s,n,l,o,_]}class _u extends le{constructor(e){super(),ie(this,e,du,cu,oe,{defaultStyling:0,position:4,class:1})}}function pu(r,e,t){let n,o,{data:l}=e,{idCol:i}=e,{sourceLayer:s=void 0}=e,a=new Set;const{map:f,source:u}=ra();return Z(r,f,c=>t(6,n=c)),Z(r,u,c=>t(7,o=c)),r.$$set=c=>{"data"in c&&t(2,l=c.data),"idCol"in c&&t(3,i=c.idCol),"sourceLayer"in c&&t(4,s=c.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&l&&n&&o){let c=new Set;for(const _ of l){const d=_[i];if(!d)continue;a.delete(d),c.add(d);const p={id:d,source:o,sourceLayer:s},g=n.getFeatureState(p);let w=!1;for(const S of Object.keys(_))if(g[S]!==_[S]){w=!0;break}w&&n.setFeatureState(p,_)}for(const _ of a){const d={id:_,source:o,sourceLayer:s},p=n.getFeatureState(d);for(const g of Object.keys(p))n.removeFeatureState(d,g)}t(5,a=c)}},[f,u,l,i,s,a,n,o]}class mu extends le{constructor(e){super(),ie(this,e,pu,null,oe,{data:2,idCol:3,sourceLayer:4})}}function gu(r,e,t){let n;const o=pn();let{layer:l=void 0}=e;const{map:i}=bo();Z(r,i,u=>t(2,n=u));function s(u){o(u.type,{...u,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Tt(()=>{if(n)if(l)for(const u of a)n.off(u,l,s);else for(const u of f)n.off(u,s)}),r.$$set=u=>{"layer"in u&&t(1,l=u.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(l)for(const u of a)n.on(u,l,s);else for(const u of f)n.on(u,s)},[i,l,n]}class hs extends le{constructor(e){super(),ie(this,e,gu,null,oe,{layer:1})}}const hu=r=>({marker:r&8}),il=r=>({marker:r[3]});function bu(r){let e,t,n,o,l,i,s;const a=r[19].default,f=Be(a,r,r[18],il);return{c(){e=h("div"),f&&f.c(),j(e,"tabindex",t=r[1]?0:void 0),j(e,"role",n=r[1]?"button":void 0),V(e,"z-index",r[2])},m(u,c){$(u,e,c),f&&f.m(e,null),l=!0,i||(s=[Io(r[7].call(null,e)),Io(o=wu.call(null,e,r[0])),x(e,"click",Ur(r[20])),x(e,"dblclick",Ur(r[21])),x(e,"contextmenu",Ur(Zi(r[22]))),x(e,"mouseenter",r[23]),x(e,"mouseleave",r[24]),x(e,"mousemove",r[25]),x(e,"keydown",r[8])],i=!0)},p(u,[c]){f&&f.p&&(!l||c&262152)&&Re(f,a,u,u[18],l?Ue(a,u[18],c,hu):De(u[18]),il),(!l||c&2&&t!==(t=u[1]?0:void 0))&&j(e,"tabindex",t),(!l||c&2&&n!==(n=u[1]?"button":void 0))&&j(e,"role",n),o&&Xr(o.update)&&c&1&&o.update.call(null,u[0]),c&4&&V(e,"z-index",u[2])},i(u){l||(b(f,u),l=!0)},o(u){C(f,u),l=!1},d(u){u&&k(e),f&&f.d(u),i=!1,ft(s)}}}function wu(r,e){const t=r.className;function n(o){o?r.className=`${t} ${o}`:r.className=t}return n(e),{update:n}}function yu(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:f}=e,{class:u=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:p=null}=e,{offset:g=void 0}=e,{zIndex:w=void 0}=e,{rotation:S=0}=e,{opacity:y=1}=e;const v=pn(),{map:L,layerEvent:A,self:E,markerClickManager:M}=oa();Z(r,L,U=>t(27,l=U)),Z(r,A,U=>t(26,n=U)),Z(r,E,U=>t(3,o=U));function N(U){te(E,o=new Vt.Marker({element:U,rotation:S,draggable:d,offset:g,opacity:y.toString()}).setLngLat(f).addTo(l),o),t(11,a=o);const be=()=>O("dragstart"),ge=()=>{z(),O("drag")},ae=()=>{z(),O("dragend")};return d&&(o.on("dragstart",be),o.on("drag",ge),o.on("dragend",ae)),{destroy(){d&&(o==null||o.off("dragstart",be),o==null||o.off("drag",ge),o==null||o.off("dragend",ae)),t(11,a=void 0),o==null||o.remove()}}}function z(){let U=o==null?void 0:o.getLngLat();U&&(Array.isArray(f)?t(10,f=[U.lng,U.lat]):f&&"lon"in f?t(10,f={lon:U.lng,lat:U.lat}):t(10,f=U))}function D(U){U.key===" "&&(U.preventDefault(),U.stopPropagation(),O("click"))}function O(U){if(!c)return;let be=o==null?void 0:o.getLngLat();if(!be)return;const ge=[be.lng,be.lat];let ae={map:l,marker:o,lngLat:ge,features:[{type:"Feature",properties:(p==null?void 0:p.properties)??{},geometry:{type:"Point",coordinates:ge}}]};(U==="click"||U==="contextmenu")&&M.handleClick(ae),te(A,n={...ae,layerType:"marker",type:U},n),v(U,ae)}const R=()=>O("click"),H=()=>O("dblclick"),q=()=>{O("contextmenu")},X=()=>{O("mouseenter")},se=()=>{O("mouseleave")},ce=()=>O("mousemove");return r.$$set=U=>{"marker"in U&&t(11,a=U.marker),"lngLat"in U&&t(10,f=U.lngLat),"class"in U&&t(0,u=U.class),"interactive"in U&&t(12,c=U.interactive),"asButton"in U&&t(1,_=U.asButton),"draggable"in U&&t(13,d=U.draggable),"feature"in U&&t(14,p=U.feature),"offset"in U&&t(15,g=U.offset),"zIndex"in U&&t(2,w=U.zIndex),"rotation"in U&&t(16,S=U.rotation),"opacity"in U&&t(17,y=U.opacity),"$$scope"in U&&t(18,s=U.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(o==null||o.setLngLat(f)),r.$$.dirty&32776&&(o==null||o.setOffset(g??[0,0])),r.$$.dirty&65544&&(o==null||o.setRotation(S)),r.$$.dirty&131080&&(o==null||o.setOpacity(y.toString()))},[u,_,w,o,L,A,E,N,D,O,f,a,c,d,p,g,S,y,s,i,R,H,q,X,se,ce]}class Pr extends le{constructor(e){super(),ie(this,e,yu,bu,oe,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const vu=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),sl=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function al(r){var o;let e,t,n=(((o=r[4])==null?void 0:o.length)||r[3]instanceof Vt.Marker)&&fl(r);return{c(){e=h("div"),n&&n.c()},m(l,i){$(l,e,i),n&&n.m(e,null),r[32](e),t=!0},p(l,i){var s;(s=l[4])!=null&&s.length||l[3]instanceof Vt.Marker?n?(n.p(l,i),i[0]&24&&b(n,1)):(n=fl(l),n.c(),b(n,1),n.m(e,null)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(l){t||(b(n),t=!0)},o(l){C(n),t=!1},d(l){l&&k(e),n&&n.d(),r[32](null)}}}function fl(r){let e;const t=r[30].default,n=Be(t,r,r[29],sl);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[0]&536870933)&&Re(n,t,o,o[29],e?Ue(t,o[29],l,vu):De(o[29]),sl)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function $u(r){let e,t,n=r[9].default&&al(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,l){o[9].default?n?(n.p(o,l),l[0]&512&&b(n,1)):(n=al(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function ku(r,e,t){let n,o,l,i,s,a,{$$slots:f={},$$scope:u}=e;const c=Ki(f);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:p=!1}=e,{closeOnMove:g=!1}=e,{openOn:w="click"}=e,{openIfTopMost:S=!0}=e,{focusAfterOpen:y=!0}=e,{anchor:v=void 0}=e,{offset:L=void 0}=e,{popupClass:A=void 0}=e,{maxWidth:E=void 0}=e,{lngLat:M=void 0}=e,{html:N=void 0}=e,{open:z=!1}=e;const D=pn(),{map:O,popupTarget:R,layerEvent:H,layer:q,eventTopMost:X,markerClickManager:se}=bo();Z(r,O,W=>t(2,l=W)),Z(r,R,W=>t(3,s=W)),Z(r,H,W=>t(28,i=W)),Z(r,q,W=>t(35,a=W));const ce=["click","dblclick","contextmenu"];let U,be=!1,ge;function ae(){if(!U)return;let W=U.getElement();!W||W===ge||(ge=W,w==="hover"&&(ge.style.pointerEvents="none"),ge.addEventListener("mouseenter",()=>{t(24,be=!0)},{passive:!0}),ge.addEventListener("mouseleave",()=>{t(24,be=!1)},{passive:!0}),ge.addEventListener("click",()=>{p&&t(0,z=!1)},{passive:!0}))}Mr(()=>{if(l)return l.on("click",pe),l.on("contextmenu",pe),se.add(Q),typeof s=="string"&&(l.on("click",s,Ae),l.on("dblclick",s,Ae),l.on("contextmenu",s,Ae),l.on("mousemove",s,K),l.on("mouseleave",s,ke),l.on("touchstart",s,Ke),l.on("touchend",s,Ne)),()=>{l!=null&&l.loaded()&&(U==null||U.remove(),l.off("click",pe),l.off("contextmenu",pe),se.remove(Q),s instanceof Vt.Marker?s.getPopup()===U&&s.setPopup(void 0):typeof s=="string"&&(l.off("click",s,Ae),l.off("dblclick",s,Ae),l.off("contextmenu",s,Ae),l.off("mousemove",s,K),l.off("mouseleave",s,ke),l.off("touchstart",s,Ke),l.off("touchend",s,Ne)))}});function we(W){return S?!("marker"in W)&&!la(W)&&X(W)!==a:!1}let fe=null,Pe="normal";function Xe(W){"layerType"in W&&W.layerType==="deckgl"?(t(10,M=W.coordinate),t(4,fe=W.object?[W.object]:null)):(t(10,M=W.lngLat),t(4,fe=W.features??[]))}function Ae(W){W.type!==w||we(W)||(Xe(W),setTimeout(()=>t(0,z=!0)))}let re=null;function Ke(W){re=W.point}function Ne(W){if(!re||w!=="hover")return;let dt=re.dist(W.point);re=null,dt<3&&(t(10,M=W.lngLat),t(4,fe=W.features??[]),U.isOpen()?t(25,Pe="justOpened"):(t(25,Pe="opening"),t(0,z=!0)))}function ke(W){w!=="hover"||re||Pe!=="normal"||(t(0,z=!1),t(4,fe=null))}function K(W){if(!(w!=="hover"||re||Pe!=="normal")){if(we(W)){t(0,z=!1),t(4,fe=null);return}t(0,z=!0),t(4,fe=W.features??[]),t(10,M=W.lngLat)}}function pe(W){if(Pe==="justOpened"){t(25,Pe="normal");return}if(!d)return;let dt=[ge,s instanceof Vt.Marker?s==null?void 0:s.getElement():null];z&&U.isOpen()&&!dt.some(Ge=>Ge==null?void 0:Ge.contains(W.originalEvent.target))&&(W.type==="contextmenu"&&w==="contextmenu"||W.type!=="contextmenu")&&t(0,z=!1)}function Q(W){d&&z&&U.isOpen()&&W.marker!==s&&t(0,z=!1)}Tt(()=>{l&&(U!=null&&U.isOpen())&&U.remove()});let me;const he=()=>t(0,z=!1);function Se(W){Te[W?"unshift":"push"](()=>{me=W,t(1,me)})}return r.$$set=W=>{"closeButton"in W&&t(11,_=W.closeButton),"closeOnClickOutside"in W&&t(12,d=W.closeOnClickOutside),"closeOnClickInside"in W&&t(13,p=W.closeOnClickInside),"closeOnMove"in W&&t(14,g=W.closeOnMove),"openOn"in W&&t(15,w=W.openOn),"openIfTopMost"in W&&t(16,S=W.openIfTopMost),"focusAfterOpen"in W&&t(17,y=W.focusAfterOpen),"anchor"in W&&t(18,v=W.anchor),"offset"in W&&t(19,L=W.offset),"popupClass"in W&&t(20,A=W.popupClass),"maxWidth"in W&&t(21,E=W.maxWidth),"lngLat"in W&&t(10,M=W.lngLat),"html"in W&&t(22,N=W.html),"open"in W&&t(0,z=W.open),"$$scope"in W&&t(29,u=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=_??(!d&&!p)),r.$$.dirty[0]&146685952&&(U||(t(23,U=new Vt.Popup({closeButton:n,closeOnClick:!1,closeOnMove:g,focusAfterOpen:y,maxWidth:E,className:A,anchor:v,offset:L})),ge=U.getElement(),U.on("open",()=>{t(0,z=!0),ae(),D("open",U)}),U.on("close",()=>{t(0,z=!1),D("close",U)}),U.on("hover",()=>{D("hover",U)}))),r.$$.dirty[0]&8421384&&U&&s instanceof Vt.Marker&&(w==="click"?s.setPopup(U):s.getPopup()===U&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&ce.includes(w)&&(i==null?void 0:i.type)===w&&(Ae(i),te(H,i=null,i)),r.$$.dirty[0]&268468224&&t(26,o=w==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&w==="hover"&&H&&(o&&i&&Xe(i),t(0,z=(o||be)??!1)),r.$$.dirty[0]&12582914&&(me?U.setDOMContent(me):N&&U.setHTML(N)),r.$$.dirty[0]&8389632&&M&&U.setLngLat(M),r.$$.dirty[0]&41943045&&l){let W=U.isOpen();z&&!W?(U.addTo(l),Pe==="opening"&&t(25,Pe="justOpened")):!z&&W&&U.remove()}},[z,me,l,s,fe,O,R,H,q,c,M,_,d,p,g,w,S,y,v,L,A,E,N,U,be,Pe,o,n,i,u,f,he,Se]}class Su extends le{constructor(e){super(),ie(this,e,ku,$u,oe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Lu(r){let e;const t=r[16].default,n=Be(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Re(n,t,o,o[24],e?Ue(t,o[24],l,null):De(o[24]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Cu(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Lu]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Yi({props:l}),Te.push(()=>We(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],qe(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){I(e,i)}}}function Mu(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=ho("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:w=void 0}=e,{manageHoverState:S=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:L=!0}=e;function A(R){y=R,t(0,y)}function E(R){ze.call(this,r,R)}function M(R){ze.call(this,r,R)}function N(R){ze.call(this,r,R)}function z(R){ze.call(this,r,R)}function D(R){ze.call(this,r,R)}function O(R){ze.call(this,r,R)}return r.$$set=R=>{"id"in R&&t(1,l=R.id),"source"in R&&t(2,i=R.source),"sourceLayer"in R&&t(3,s=R.sourceLayer),"beforeId"in R&&t(4,a=R.beforeId),"beforeLayerType"in R&&t(5,f=R.beforeLayerType),"paint"in R&&t(6,u=R.paint),"layout"in R&&t(7,c=R.layout),"filter"in R&&t(8,_=R.filter),"applyToClusters"in R&&t(9,d=R.applyToClusters),"minzoom"in R&&t(10,p=R.minzoom),"maxzoom"in R&&t(11,g=R.maxzoom),"hoverCursor"in R&&t(12,w=R.hoverCursor),"manageHoverState"in R&&t(13,S=R.manageHoverState),"hovered"in R&&t(0,y=R.hovered),"eventsIfTopMost"in R&&t(14,v=R.eventsIfTopMost),"interactive"in R&&t(15,L=R.interactive),"$$scope"in R&&t(24,o=R.$$scope)},[y,l,i,s,a,f,u,c,_,d,p,g,w,S,v,L,n,A,E,M,N,z,D,O,o]}class Vn extends le{constructor(e){super(),ie(this,e,Mu,Cu,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ul(r){let e=r[0],t,n,o=cl(r);return{c(){o.c(),t=Je()},m(l,i){o.m(l,i),$(l,t,i),n=!0},p(l,i){i&1&&oe(e,e=l[0])?(ye(),C(o,1,1,Y),ve(),o=cl(l),o.c(),b(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(b(o),n=!0)},o(l){C(o),n=!1},d(l){l&&k(t),o.d(l)}}}function cl(r){let e;const t=r[15].default,n=Be(t,r,r[14],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16384)&&Re(n,t,o,o[14],e?Ue(t,o[14],l,null):De(o[14]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Tu(r){let e,t,n=r[0]&&ul(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=ul(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function Au(r,e,t){let n,o,{$$slots:l={},$$scope:i}=e,{id:s=ho("vector")}=e,{url:a=null}=e,{tiles:f=null}=e,{promoteId:u=null}=e,{bounds:c=null}=e,{scheme:_=null}=e,{attribution:d=null}=e,{minzoom:p=null}=e,{maxzoom:g=null}=e,{volatile:w=null}=e;if(a&&a.includes("pmtiles://")&&!Vt.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let L=new fa;Vt.addProtocol("pmtiles",L.tile)}const{map:S,self:y}=ia();Z(r,S,L=>t(13,o=L)),Z(r,y,L=>t(0,n=L));let v;return Tt(()=>{n&&o&&(sa(S,n,v),te(y,n=null,n),v=void 0)}),r.$$set=L=>{"id"in L&&t(3,s=L.id),"url"in L&&t(4,a=L.url),"tiles"in L&&t(5,f=L.tiles),"promoteId"in L&&t(6,u=L.promoteId),"bounds"in L&&t(7,c=L.bounds),"scheme"in L&&t(8,_=L.scheme),"attribution"in L&&t(9,d=L.attribution),"minzoom"in L&&t(10,p=L.minzoom),"maxzoom"in L&&t(11,g=L.maxzoom),"volatile"in L&&t(12,w=L.volatile),"$$scope"in L&&t(14,i=L.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&o&&n!==s&&(te(y,n=s,n),aa(o,n,vr({type:"vector",url:a,tiles:f,promoteId:u,bounds:c,scheme:_,attribution:d,minzoom:p,maxzoom:g,volatile:w}),L=>o&&L===n,()=>{n&&(v=o==null?void 0:o.getSource(n))})),r.$$.dirty&8200&&(o==null||o.on("style.load",()=>{v=o==null?void 0:o.getSource(s)}))},[n,S,y,s,a,f,u,c,_,d,p,g,w,o,i,l]}class rr extends le{constructor(e){super(),ie(this,e,Au,Tu,oe,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}function Fu(r){let e,t,n,o,l,i,s,a,f;return{c(){e=h("label"),t=B(`Basemap:
  `),n=h("select"),o=h("option"),o.textContent="MapTiler Dataviz",l=h("option"),l.textContent="MapTiler Streets",i=h("option"),i.textContent="MapTiler Satellite",s=h("option"),s.textContent="OS Open Zoomstack",o.__value="dataviz",Oe(o,o.__value),l.__value="streets-v2",Oe(l,l.__value),i.__value="hybrid",Oe(i,i.__value),s.__value="uk-openzoomstack-light",Oe(s,s.__value),r[0]===void 0&&fn(()=>r[1].call(n))},m(u,c){$(u,e,c),m(e,t),m(e,n),m(n,o),m(n,l),m(n,i),m(n,s),vt(n,r[0],!0),a||(f=x(n,"change",r[1]),a=!0)},p(u,[c]){c&1&&vt(n,u[0])},i:Y,o:Y,d(u){u&&k(e),a=!1,f()}}}function Pu(r,e,t){let n;Z(r,Vr,l=>t(0,n=l));function o(){n=un(this),Vr.set(n)}return[n,o]}class Iu extends le{constructor(e){super(),ie(this,e,Pu,Fu,oe,{})}}let gr=Mt(!0);function Eu(r){let e,t;return e=new At({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.layout={visibility:n[0]?"none":"visible"}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function ju(r){let e,t;return e=new Ve({props:{data:r[1],$$slots:{default:[Eu]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Nu(r,e,t){let n;return Z(r,gr,l=>t(0,n=l)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class zu extends le{constructor(e){super(),ie(this,e,Nu,ju,oe,{})}}function Ou(r){let e,t;return e=new Pr({props:{lngLat:r[0],$$slots:{default:[Ru]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.lngLat=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Bu(r){let e,t,n;function o(i){r[3](i)}let l={draggable:!0,$$slots:{default:[Du]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.lngLat=r[0]),e=new Pr({props:l}),Te.push(()=>We(e,"lngLat",o)),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),n=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.lngLat=i[0],qe(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){I(e,i)}}}function Ru(r){let e,t;const n=r[2].default,o=Be(n,r,r[4],null);return{c(){e=h("span"),o&&o.c(),j(e,"class","dot svelte-1gcxp27")},m(l,i){$(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Re(o,n,l,l[4],t?Ue(n,l[4],i,null):De(l[4]),null)},i(l){t||(b(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&k(e),o&&o.d(l)}}}function Du(r){let e,t;const n=r[2].default,o=Be(n,r,r[4],null);return{c(){e=h("span"),o&&o.c(),j(e,"class","dot svelte-1gcxp27")},m(l,i){$(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Re(o,n,l,l[4],t?Ue(n,l[4],i,null):De(l[4]),null)},i(l){t||(b(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&k(e),o&&o.d(l)}}}function Uu(r){let e,t,n,o;const l=[Bu,Ou],i=[];function s(a,f){return a[1]?0:1}return e=s(r),t=i[e]=l[e](r),{c(){t.c(),n=Je()},m(a,f){i[e].m(a,f),$(a,n,f),o=!0},p(a,[f]){let u=e;e=s(a),e===u?i[e].p(a,f):(ye(),C(i[u],1,1,()=>{i[u]=null}),ve(),t=i[e],t?t.p(a,f):(t=i[e]=l[e](a),t.c()),b(t,1),t.m(n.parentNode,n))},i(a){o||(b(t),o=!0)},o(a){C(t),o=!1},d(a){a&&k(n),i[e].d(a)}}}function Hu(r,e,t){let{$$slots:n={},$$scope:o}=e,{lngLat:l}=e,{draggable:i=!1}=e;function s(a){l=a,t(0,l)}return r.$$set=a=>{"lngLat"in a&&t(0,l=a.lngLat),"draggable"in a&&t(1,i=a.draggable),"$$scope"in a&&t(4,o=a.$$scope)},[l,i,n,s,o]}class $n extends le{constructor(e){super(),ie(this,e,Hu,Uu,oe,{lngLat:0,draggable:1})}}function dl(r){let e,t;return e=new Tr({props:{$$slots:{default:[Gu]},$$scope:{ctx:r}}}),e.$on("close",r[4]),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&32&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Gu(r){let e,t,n;const o=r[2].default,l=Be(o,r,r[5],null);return{c(){e=h("h2"),e.textContent="Help",t=T(),l&&l.c()},m(i,s){$(i,e,s),$(i,t,s),l&&l.m(i,s),n=!0},p(i,s){l&&l.p&&(!n||s&32)&&Re(l,o,i,i[5],n?Ue(o,i[5],s,null):De(i[5]),null)},i(i){n||(b(l,i),n=!0)},o(i){C(l,i),n=!1},d(i){i&&(k(e),k(t)),l&&l.d(i)}}}function Wu(r){let e,t,n,o,l,i,s;t=new Gf({props:{color:r[0]}});let a=r[1]&&dl(r);return{c(){e=h("button"),F(t.$$.fragment),n=T(),a&&a.c(),o=Je(),j(e,"class","icon-btn help svelte-my65h"),j(e,"aria-label","Help")},m(f,u){$(f,e,u),P(t,e,null),$(f,n,u),a&&a.m(f,u),$(f,o,u),l=!0,i||(s=x(e,"click",r[3]),i=!0)},p(f,[u]){const c={};u&1&&(c.color=f[0]),t.$set(c),f[1]?a?(a.p(f,u),u&2&&b(a,1)):(a=dl(f),a.c(),b(a,1),a.m(o.parentNode,o)):a&&(ye(),C(a,1,1,()=>{a=null}),ve())},i(f){l||(b(t.$$.fragment,f),b(a),l=!0)},o(f){C(t.$$.fragment,f),C(a),l=!1},d(f){f&&(k(e),k(n),k(o)),I(t),a&&a.d(f),i=!1,s()}}}function qu(r,e,t){let{$$slots:n={},$$scope:o}=e,l=!1,{color:i="black"}=e;const s=()=>t(1,l=!0),a=()=>t(1,l=!1);return r.$$set=f=>{"color"in f&&t(0,i=f.color),"$$scope"in f&&t(5,o=f.$$scope)},[i,l,n,s,a,o]}class Ir extends le{constructor(e){super(),ie(this,e,qu,Wu,oe,{color:0})}}function Ju(r){let e,t,n,o,l,i=r[0]+1+"",s,a,f=r[1].length+"",u,c,_,d,p,g,w;return{c(){e=h("div"),t=h("button"),n=B("Previous"),l=T(),s=B(i),a=B(" / "),u=B(f),c=T(),_=h("button"),d=B("Next"),t.disabled=o=r[0]==0,j(t,"data-tooltip","Left"),_.disabled=p=r[0]==r[1].length-1,j(_,"data-tooltip","Right"),V(e,"display","flex"),V(e,"justify-content","space-between"),V(e,"align-items","center")},m(S,y){$(S,e,y),m(e,t),m(t,n),m(e,l),m(e,s),m(e,a),m(e,u),m(e,c),m(e,_),m(_,d),g||(w=[x(window,"keydown",r[2]),x(t,"click",r[3]),x(_,"click",r[4])],g=!0)},p(S,[y]){y&1&&o!==(o=S[0]==0)&&(t.disabled=o),y&1&&i!==(i=S[0]+1+"")&&ne(s,i),y&2&&f!==(f=S[1].length+"")&&ne(u,f),y&3&&p!==(p=S[0]==S[1].length-1)&&(_.disabled=p)},i:Y,o:Y,d(S){S&&k(e),g=!1,ft(w)}}}function Yu(r,e,t){let n;Z(r,xt,f=>t(5,n=f));let{list:o}=e,{idx:l=0}=e;Mr(()=>{n==null||n.keyboard.disable()}),Tt(()=>{n==null||n.keyboard.enable()});function i(f){f.key=="ArrowLeft"&&(f.stopPropagation(),s()),f.key=="ArrowRight"&&(f.stopPropagation(),a())}function s(){l!=0&&t(0,l--,l)}function a(){l!=o.length-1&&t(0,l++,l)}return r.$$set=f=>{"list"in f&&t(1,o=f.list),"idx"in f&&t(0,l=f.idx)},[l,o,i,s,a]}class Er extends le{constructor(e){super(),ie(this,e,Yu,Ju,oe,{list:1,idx:0})}}function Zu(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:Ku}=Xi;function Xu(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g;return d=Vi(r[8][0]),{c(){e=h("button"),e.textContent="Stop StreetView",t=T(),n=h("fieldset"),o=h("legend"),o.textContent="Source:",l=T(),i=h("label"),s=h("input"),a=B(`
      Google Street View`),f=T(),u=h("label"),c=h("input"),_=B(`
      Bing Streetside`),j(e,"class","secondary"),j(s,"type","radio"),s.__value="google",Oe(s,s.__value),j(c,"type","radio"),c.__value="bing",Oe(c,c.__value),d.p(s,c)},m(w,S){$(w,e,S),$(w,t,S),$(w,n,S),m(n,o),m(n,l),m(n,i),m(i,s),s.checked=s.__value===r[0],m(i,a),m(n,f),m(n,u),m(u,c),c.checked=c.__value===r[0],m(u,_),p||(g=[x(e,"click",r[3]),x(s,"change",r[7]),x(c,"change",r[9])],p=!0)},p(w,S){S&1&&(s.checked=s.__value===w[0]),S&1&&(c.checked=c.__value===w[0])},d(w){w&&(k(e),k(t),k(n)),d.r(),p=!1,ft(g)}}}function Vu(r){let e,t,n;return{c(){e=h("button"),e.textContent="StreetView",j(e,"class","secondary")},m(o,l){$(o,e,l),t||(n=x(e,"click",r[2]),t=!0)},p:Y,d(o){o&&k(e),t=!1,n()}}}function Qu(r){let e,t,n;function o(s,a){return s[1]?Vu:Xu}let l=o(r),i=l(r);return{c(){i.c(),e=Je()},m(s,a){i.m(s,a),$(s,e,a),t||(n=x(Ku,"keydown",r[4]),t=!0)},p(s,[a]){l===(l=o(s))&&i?i.p(s,a):(i.d(1),i=l(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Y,o:Y,d(s){s&&k(e),i.d(s),t=!1,n()}}}function xu(r,e,t){let n;Z(r,gr,g=>t(1,n=g));let{map:o}=e,{maptilerBasemap:l}=e,i="google",s=[];function a(){te(gr,n=!1,n),o.on("click",u),o.getCanvas().style.cursor="crosshair";for(let g of Zu(o,l))s.push([g,o.getPaintProperty(g,"line-color")]),o.setPaintProperty(g,"line-color","cyan")}function f(){te(gr,n=!0,n),o.off("click",u),o.getCanvas().style.cursor="inherit";for(let[g,w]of s)o.setPaintProperty(g,"line-color",w);s=[]}Tt(f);function u(g){let w=g.lngLat.lng,S=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${S},${w}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${S}~${w}&style=x`,"_blank")}function c(g){!n&&g.key=="Escape"&&(g.stopPropagation(),f())}const _=[[]];function d(){i=this.__value,t(0,i)}function p(){i=this.__value,t(0,i)}return r.$$set=g=>{"map"in g&&t(5,o=g.map),"maptilerBasemap"in g&&t(6,l=g.maptilerBasemap)},[i,n,a,f,c,o,l,d,_,p]}class ec extends le{constructor(e){super(),ie(this,e,xu,Qu,oe,{map:5,maptilerBasemap:6})}}function $e(r,e=!0){return{id:r,beforeId:tc(r),eventsIfTopMost:e}}function tc(r){let e=Wt(xt);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let o=_l.length-1;o>=0;o--){let l=_l[o];if(l==r){n=!0;break}e.getLayer(l)&&(t=l)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let qr=r=>r,Jr=r=>r;const _l=[qr(Jr("Background")),"neighbourhood-boundaries",qr("Ferry line"),"neighbourhood-boundaries-outline","debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",Jr("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-gp-practices","context-hospitals","context-schools","context-railway-stations","context-stats19",Jr("Road labels"),qr("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function an(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function dn(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function _n(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function oo(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function sn(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function pl(r){return r.reduce((e,t)=>e+t,0)}const nc=r=>({}),ml=r=>({}),rc=r=>({}),gl=r=>({});function hl(r){let e,t;return e=new Ir({props:{color:"var(--pico-secondary-inverse)",$$slots:{default:[oc]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&64&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function oc(r){let e,t;const n=r[3].help,o=Be(n,r,r[6],gl);return{c(){e=h("div"),o&&o.c(),j(e,"class","context-layer-help-content")},m(l,i){$(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&64)&&Re(o,n,l,l[6],t?Ue(n,l[6],i,rc):De(l[6]),gl)},i(l){t||(b(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&k(e),o&&o.d(l)}}}function bl(r){let e,t;const n=r[3].legend,o=Be(n,r,r[6],ml);return{c(){e=h("div"),o&&o.c(),j(e,"class","legend svelte-jkm5u7")},m(l,i){$(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&64)&&Re(o,n,l,l[6],t?Ue(n,l[6],i,nc):De(l[6]),ml)},i(l){t||(b(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&k(e),o&&o.d(l)}}}function lc(r){let e,t,n,o,l,i,s,a,f,u,c=r[2].help&&hl(r),_=r[0]&&r[2].legend&&bl(r);return{c(){e=h("button"),t=h("input"),n=T(),o=B(r[1]),l=T(),c&&c.c(),i=T(),_&&_.c(),s=Je(),j(t,"type","checkbox"),V(e,"display","flex"),V(e,"align-items","center"),V(e,"justify-content","leading"),V(e,"gap","8px"),V(e,"text-align","left"),j(e,"class","secondary")},m(d,p){$(d,e,p),m(e,t),t.checked=r[0],m(e,n),m(e,o),m(e,l),c&&c.m(e,null),$(d,i,p),_&&_.m(d,p),$(d,s,p),a=!0,f||(u=[x(t,"change",r[4]),x(e,"click",r[5])],f=!0)},p(d,[p]){p&1&&(t.checked=d[0]),(!a||p&2)&&ne(o,d[1]),d[2].help?c?(c.p(d,p),p&4&&b(c,1)):(c=hl(d),c.c(),b(c,1),c.m(e,null)):c&&(ye(),C(c,1,1,()=>{c=null}),ve()),d[0]&&d[2].legend?_?(_.p(d,p),p&5&&b(_,1)):(_=bl(d),_.c(),b(_,1),_.m(s.parentNode,s)):_&&(ye(),C(_,1,1,()=>{_=null}),ve())},i(d){a||(b(c),b(_),a=!0)},o(d){C(c),C(_),a=!1},d(d){d&&(k(e),k(i),k(s)),c&&c.d(),_&&_.d(d),f=!1,ft(u)}}}function ic(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=Ki(n);let{label:i}=e,{show:s=!1}=e;function a(){s=this.checked,t(0,s)}const f=()=>t(0,s=!s);return r.$$set=u=>{"label"in u&&t(1,i=u.label),"show"in u&&t(0,s=u.show),"$$scope"in u&&t(6,o=u.$$scope)},[s,i,l,n,a,f,o]}class Qt extends le{constructor(e){super(),ie(this,e,ic,lc,oe,{label:1,show:0})}}function sc(r){let e;return{c(){e=h("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function ac(r){let e,t;const n=[$e("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":an(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i&1?He(n,[n[0],n[1],n[2],{layout:{visibility:l[0]?"visible":"none"}}]):{};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function fc(r){let e,t,n,o,l;function i(a){r[1](a)}let s={label:"Bus routes",$$slots:{help:[sc]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new Qt({props:s}),Te.push(()=>We(e,"show",i)),o=new rr({props:{url:`pmtiles://${$t("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[ac]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment)},m(a,f){P(e,a,f),$(a,n,f),P(o,a,f),l=!0},p(a,[f]){const u={};f&4&&(u.$$scope={dirty:f,ctx:a}),!t&&f&1&&(t=!0,u.show=a[0],qe(()=>t=!1)),e.$set(u);const c={};f&5&&(c.$$scope={dirty:f,ctx:a}),o.$set(c)},i(a){l||(b(e.$$.fragment,a),b(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&k(n),I(e,a),I(o,a)}}}function uc(r,e,t){let n=!1;function o(l){n=l,t(0,n)}return[n,o]}class cc extends le{constructor(e){super(),ie(this,e,uc,fc,oe,{})}}function dc(r){let e,t;return{c(){e=Jt("svg"),t=Jt("path"),j(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),j(e,"viewBox","0 0 14 14"),j(e,"width","13"),j(e,"height","13"),j(e,"class","svelte-en2qvf")},m(n,o){$(n,e,o),m(e,t)},p:Y,i:Y,o:Y,d(n){n&&k(e)}}}class bs extends le{constructor(e){super(),ie(this,e,null,dc,oe,{})}}function _c(r){let e,t;return{c(){e=Jt("svg"),t=Jt("path"),j(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),j(e,"viewBox","0 0 30 30"),j(e,"fill","none"),j(e,"xmlns","http://www.w3.org/2000/svg"),j(e,"class","svelte-d2loi5")},m(n,o){$(n,e,o),m(e,t)},p:Y,i:Y,o:Y,d(n){n&&k(e)}}}class ws extends le{constructor(e){super(),ie(this,e,null,_c,oe,{})}}function pc(r){let e,t;return{c(){e=h("img"),xe(e.src,t=r[3]+"area.svg")||j(e,"src",t),j(e,"alt",r[6]),j(e,"class","svelte-ltkwvy")},m(n,o){$(n,e,o)},p(n,o){o&8&&!xe(e.src,t=n[3]+"area.svg")&&j(e,"src",t),o&64&&j(e,"alt",n[6])},d(n){n&&k(e)}}}function mc(r){let e,t;return{c(){e=h("img"),xe(e.src,t=r[3]+"reverse.svg")||j(e,"src",t),j(e,"alt",r[6]),j(e,"class","svelte-ltkwvy")},m(n,o){$(n,e,o)},p(n,o){o&8&&!xe(e.src,t=n[3]+"reverse.svg")&&j(e,"src",t),o&64&&j(e,"alt",n[6])},d(n){n&&k(e)}}}function gc(r){let e,t;return{c(){e=h("img"),xe(e.src,t=r[3]+"poi.svg")||j(e,"src",t),j(e,"alt",r[6]),j(e,"class","svelte-ltkwvy")},m(n,o){$(n,e,o)},p(n,o){o&8&&!xe(e.src,t=n[3]+"poi.svg")&&j(e,"src",t),o&64&&j(e,"alt",n[6])},d(n){n&&k(e)}}}function hc(r){let e,t;return{c(){e=h("img"),xe(e.src,t=r[3]+"postal_code.svg")||j(e,"src",t),j(e,"alt",r[6]),j(e,"class","svelte-ltkwvy")},m(n,o){$(n,e,o)},p(n,o){o&8&&!xe(e.src,t=n[3]+"postal_code.svg")&&j(e,"src",t),o&64&&j(e,"alt",n[6])},d(n){n&&k(e)}}}function bc(r){let e,t;return{c(){e=h("img"),xe(e.src,t=r[3]+"street.svg")||j(e,"src",t),j(e,"alt",r[6]),j(e,"class","svelte-ltkwvy")},m(n,o){$(n,e,o)},p(n,o){o&8&&!xe(e.src,t=n[3]+"street.svg")&&j(e,"src",t),o&64&&j(e,"alt",n[6])},d(n){n&&k(e)}}}function wc(r){let e,t;return{c(){e=h("img"),xe(e.src,t=r[3]+"road.svg")||j(e,"src",t),j(e,"alt",r[6]),j(e,"class","svelte-ltkwvy")},m(n,o){$(n,e,o)},p(n,o){o&8&&!xe(e.src,t=n[3]+"road.svg")&&j(e,"src",t),o&64&&j(e,"alt",n[6])},d(n){n&&k(e)}}}function yc(r){let e,t;return{c(){e=h("img"),xe(e.src,t=r[3]+"housenumber.svg")||j(e,"src",t),j(e,"alt",r[6]),j(e,"class","svelte-ltkwvy")},m(n,o){$(n,e,o)},p(n,o){o&8&&!xe(e.src,t=n[3]+"housenumber.svg")&&j(e,"src",t),o&64&&j(e,"alt",n[6])},d(n){n&&k(e)}}}function vc(r){let e,t,n,o;return{c(){e=h("img"),xe(e.src,t=r[5])||j(e,"src",t),j(e,"alt",r[4]),j(e,"class","svelte-ltkwvy")},m(l,i){$(l,e,i),n||(o=x(e,"error",r[14]),n=!0)},p(l,i){i&32&&!xe(e.src,t=l[5])&&j(e,"src",t),i&16&&j(e,"alt",l[4])},d(l){l&&k(e),n=!1,o()}}}function wl(r){let e,t;return{c(){e=h("span"),t=B(r[6]),j(e,"class","secondary svelte-ltkwvy")},m(n,o){$(n,e,o),m(e,t)},p(n,o){o&64&&ne(t,n[6])},d(n){n&&k(e)}}}function $c(r){let e,t,n,o,l,i,s,a,f,u=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],p,g,w=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",S,y,v;function L(N,z){return z&1&&(t=null),z&1&&(n=null),z&1&&(o=null),z&1&&(l=null),N[5]?vc:N[0].address?yc:(t==null&&(t=!!N[0].id.startsWith("road.")),t?wc:(n==null&&(n=!!N[0].id.startsWith("address.")),n?bc:(o==null&&(o=!!N[0].id.startsWith("postal_code.")),o?hc:(l==null&&(l=!!N[0].id.startsWith("poi.")),l?gc:N[7]?mc:pc))))}let A=L(r,-1),E=A(r),M=d&&wl(r);return{c(){e=h("li"),E.c(),i=T(),s=h("span"),a=h("span"),f=h("span"),c=B(u),_=T(),M&&M.c(),p=T(),g=h("span"),S=B(w),j(f,"class","primary svelte-ltkwvy"),j(a,"class","svelte-ltkwvy"),j(g,"class","line2 svelte-ltkwvy"),j(s,"class","texts svelte-ltkwvy"),j(e,"tabindex","0"),j(e,"data-selected",r[1]),j(e,"class","svelte-ltkwvy"),mt(e,"selected",r[1])},m(N,z){$(N,e,z),E.m(e,null),m(e,i),m(e,s),m(s,a),m(a,f),m(f,c),m(a,_),M&&M.m(a,null),m(s,p),m(s,g),m(g,S),y||(v=[x(e,"mouseenter",r[12]),x(e,"focus",r[13])],y=!0)},p(N,[z]){A===(A=L(N,z))&&E?E.p(N,z):(E.d(1),E=A(N),E&&(E.c(),E.m(e,i))),z&1&&u!==(u=(N[7]?N[0].place_name:N[0].place_name.replace(/,.*/,""))+"")&&ne(c,u),z&37&&(d=N[2]==="always"||N[2]!=="never"&&!N[0].address&&!N[0].id.startsWith("road.")&&!N[0].id.startsWith("address.")&&!N[0].id.startsWith("postal_code.")&&(!N[0].id.startsWith("poi.")||!N[5])&&!N[7]),d?M?M.p(N,z):(M=wl(N),M.c(),M.m(a,null)):M&&(M.d(1),M=null),z&1&&w!==(w=(N[7]?"":N[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&ne(S,w),z&2&&j(e,"data-selected",N[1]),z&2&&mt(e,"selected",N[1])},i:Y,o:Y,d(N){N&&k(e),E.d(),M&&M.d(),y=!1,ft(v)}}}function kc(r,e,t){var v;let n,o,{feature:l}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:f}=e;const u=(v=l.properties)==null?void 0:v.categories;let c,_,d=0,p=l.place_type[0]==="reverse";function g(){_&&a.add(_),t(10,d++,d)}function w(L){ze.call(this,r,L)}function S(L){ze.call(this,r,L)}const y=()=>g();return r.$$set=L=>{"feature"in L&&t(0,l=L.feature),"selected"in L&&t(1,i=L.selected),"showPlaceType"in L&&t(2,s=L.showPlaceType),"missingIconsCache"in L&&t(9,a=L.missingIconsCache),"iconsBaseUrl"in L&&t(3,f=L.iconsBaseUrl)},r.$$.update=()=>{var L,A,E,M;if(r.$$.dirty&3640)do t(11,n--,n),t(4,c=u==null?void 0:u[n]),t(5,_=c?f+c.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!_||a.has(_)));r.$$.dirty&1&&t(6,o=((A=(L=l.properties)==null?void 0:L.categories)==null?void 0:A.join(", "))??((M=(E=l.properties)==null?void 0:E.place_type_name)==null?void 0:M[0])??l.place_type[0])},t(11,n=(u==null?void 0:u.length)??0),[l,i,s,f,c,_,o,p,g,a,d,n,w,S,y]}class Sc extends le{constructor(e){super(),ie(this,e,kc,$c,oe,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Lc(r){let e;return{c(){e=h("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',j(e,"class","svelte-7cmwmc")},m(t,n){$(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&k(e)}}}class Cc extends le{constructor(e){super(),ie(this,e,null,Lc,oe,{})}}function Mc(r){let e,t;return{c(){e=Jt("svg"),t=Jt("path"),j(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),j(e,"viewBox","0 0 60.006 21.412"),j(e,"width","14"),j(e,"height","20"),j(e,"class","svelte-en2qvf")},m(n,o){$(n,e,o),m(e,t)},p:Y,i:Y,o:Y,d(n){n&&k(e)}}}class Tc extends le{constructor(e){super(),ie(this,e,null,Mc,oe,{})}}function Ac(r){let e,t,n;return{c(){e=Jt("svg"),t=Jt("circle"),n=Jt("path"),j(t,"cx","4.789"),j(t,"cy","4.787"),j(t,"r","3.85"),j(t,"class","svelte-1aq105l"),j(n,"d","M12.063 12.063 7.635 7.635"),j(n,"class","svelte-1aq105l"),j(e,"xmlns","http://www.w3.org/2000/svg"),j(e,"width","13"),j(e,"height","13"),j(e,"viewBox","0 0 13 13"),j(e,"class","svelte-1aq105l")},m(o,l){$(o,e,l),m(e,t),m(e,n)},p:Y,i:Y,o:Y,d(o){o&&k(e)}}}class Fc extends le{constructor(e){super(),ie(this,e,null,Ac,oe,{})}}function Pc(r,e,t){const n=e[1],o=e[0],l=n-o;return r===n&&t?r:((r-o)%l+l)%l+o}function yl(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let En;async function Ic(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const o of e??[])if(!(n&&(o.minZoom!=null&&o.minZoom>n[0]||o.maxZoom!=null&&o.maxZoom<n[0]))){if(o.type==="fixed")return o.coordinates.join(",");e:if(o.type==="client-geolocation"){if(En&&o.cachedLocationExpiry&&En.time+o.cachedLocationExpiry>Date.now()){if(!En.coords)break e;return En.coords}let l;try{return l=await new Promise((i,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(f=>f.toFixed(6)).join(","))},a=>{s(a)},o)}),l}catch{}finally{o.cachedLocationExpiry&&(En={time:Date.now(),coords:l})}if(t.signal.aborted)return}if(o.type==="server-geolocation")return"ip";if(n&&o.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}function vl(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function $l(r){let e,t;return e=new Cc({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function kl(r){let e,t,n,o,l;return t=new Tc({}),{c(){e=h("button"),F(t.$$.fragment),j(e,"type","button"),j(e,"title",r[9]),j(e,"class","svelte-bz0zu3"),mt(e,"active",r[0])},m(i,s){$(i,e,s),P(t,e,null),n=!0,o||(l=x(e,"click",r[69]),o=!0)},p(i,s){(!n||s[0]&512)&&j(e,"title",i[9]),(!n||s[0]&1)&&mt(e,"active",i[0])},i(i){n||(b(t.$$.fragment,i),n=!0)},o(i){C(t.$$.fragment,i),n=!1},d(i){i&&k(e),I(t),o=!1,l()}}}function Ec(r){let e,t=[],n=new Map,o,l,i,s=Me(r[14]);const a=f=>f[84].id+(f[84].address?","+f[84].address:"");for(let f=0;f<s.length;f+=1){let u=vl(r,s,f),c=a(u);n.set(c,t[f]=Sl(c,u))}return{c(){e=h("ul");for(let f=0;f<t.length;f+=1)t[f].c();j(e,"class","options svelte-bz0zu3")},m(f,u){$(f,e,u);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);o=!0,l||(i=[x(e,"mouseleave",r[73]),x(e,"blur",r[74])],l=!0)},p(f,u){u[0]&17880064&&(s=Me(f[14]),ye(),t=ca(t,u,a,1,f,s,n,e,da,Sl,null,vl),ve())},i(f){if(!o){for(let u=0;u<s.length;u+=1)b(t[u]);o=!0}},o(f){for(let u=0;u<t.length;u+=1)C(t[u]);o=!1},d(f){f&&k(e);for(let u=0;u<t.length;u+=1)t[u].d();l=!1,ft(i)}}}function jc(r){let e,t,n,o,l,i;return t=new ws({}),{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("div"),l=B(r[7]),j(o,"class","svelte-bz0zu3"),j(e,"class","no-results svelte-bz0zu3")},m(s,a){$(s,e,a),P(t,e,null),m(e,n),m(e,o),m(o,l),i=!0},p(s,a){(!i||a[0]&128)&&ne(l,s[7])},i(s){i||(b(t.$$.fragment,s),i=!0)},o(s){C(t.$$.fragment,s),i=!1},d(s){s&&k(e),I(t)}}}function Nc(r){let e="",t;return{c(){t=B(e)},m(n,o){$(n,t,o)},p:Y,i:Y,o:Y,d(n){n&&k(t)}}}function zc(r){let e,t,n,o,l,i,s,a,f,u,c;return t=new ws({}),a=new bs({}),{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("div"),l=B(r[6]),i=T(),s=h("button"),F(a.$$.fragment),j(o,"class","svelte-bz0zu3"),j(s,"class","svelte-bz0zu3"),j(e,"class","error svelte-bz0zu3")},m(_,d){$(_,e,d),P(t,e,null),m(e,n),m(e,o),m(o,l),m(e,i),m(e,s),P(a,s,null),f=!0,u||(c=x(s,"click",r[70]),u=!0)},p(_,d){(!f||d[0]&64)&&ne(l,_[6])},i(_){f||(b(t.$$.fragment,_),b(a.$$.fragment,_),f=!0)},o(_){C(t.$$.fragment,_),C(a.$$.fragment,_),f=!1},d(_){_&&k(e),I(t),I(a),u=!1,c()}}}function Sl(r,e){let t,n,o;function l(){return e[71](e[86])}function i(){return e[72](e[84])}return n=new Sc({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",l),n.$on("focus",i),{key:r,first:null,c(){t=Je(),F(n.$$.fragment),this.first=t},m(s,a){$(s,t,a),P(n,s,a),o=!0},p(s,a){e=s;const f={};a[0]&16384&&(f.feature=e[84]),a[0]&1024&&(f.showPlaceType=e[10]),a[0]&49152&&(f.selected=e[15]===e[86]),a[0]&4096&&(f.iconsBaseUrl=e[12]),n.$set(f)},i(s){o||(b(n.$$.fragment,s),o=!0)},o(s){C(n.$$.fragment,s),o=!1},d(s){s&&k(t),I(n,s)}}}function Oc(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w,S,y,v,L,A,E=!1;l=new Fc({}),c=new bs({});let M=r[19]&&$l(),N=r[5]==="button"&&kl(r);const z=r[61].default,D=Be(z,r,r[60],null),O=[zc,Nc,jc,Ec],R=[];function H(q,X){var se,ce;return q[18]?0:q[16]?((se=q[14])==null?void 0:se.length)===0?2:q[16]&&((ce=q[14])!=null&&ce.length)?3:-1:1}return~(w=H(r))&&(S=R[w]=O[w](r)),{c(){e=T(),t=h("form"),n=h("div"),o=h("button"),F(l.$$.fragment),i=T(),s=h("input"),a=T(),f=h("div"),u=h("button"),F(c.$$.fragment),_=T(),M&&M.c(),d=T(),N&&N.c(),p=T(),D&&D.c(),g=T(),S&&S.c(),j(o,"class","search-button svelte-bz0zu3"),j(o,"type","button"),j(s,"placeholder",r[8]),j(s,"aria-label",r[8]),j(s,"class","svelte-bz0zu3"),j(u,"type","button"),j(u,"title",r[3]),j(u,"class","svelte-bz0zu3"),j(f,"class","clear-button-container svelte-bz0zu3"),mt(f,"displayable",r[1]!==""),j(n,"class","input-group svelte-bz0zu3"),j(t,"tabindex","0"),j(t,"class",y=Eo(r[2])+" svelte-bz0zu3"),mt(t,"can-collapse",r[4]&&r[1]==="")},m(q,X){$(q,e,X),$(q,t,X),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),r[63](s),Oe(s,r[1]),m(n,a),m(n,f),m(f,u),P(c,u,null),m(f,_),M&&M.m(f,null),m(n,d),N&&N.m(n,null),m(n,p),D&&D.m(n,null),m(t,g),~w&&R[w].m(t,null),v=!0,L||(A=[x(o,"click",r[62]),x(s,"input",r[64]),x(s,"focus",r[65]),x(s,"blur",r[66]),x(s,"keydown",r[22]),x(s,"input",r[67]),x(u,"click",r[68]),x(t,"submit",Zi(r[21]))],L=!0)},p(q,X){(!v||X[0]&256)&&j(s,"placeholder",q[8]),(!v||X[0]&256)&&j(s,"aria-label",q[8]),X[0]&2&&s.value!==q[1]&&Oe(s,q[1]),(!v||X[0]&8)&&j(u,"title",q[3]),q[19]?M?X[0]&524288&&b(M,1):(M=$l(),M.c(),b(M,1),M.m(f,null)):M&&(ye(),C(M,1,1,()=>{M=null}),ve()),(!v||X[0]&2)&&mt(f,"displayable",q[1]!==""),q[5]==="button"?N?(N.p(q,X),X[0]&32&&b(N,1)):(N=kl(q),N.c(),b(N,1),N.m(n,p)):N&&(ye(),C(N,1,1,()=>{N=null}),ve()),D&&D.p&&(!v||X[1]&536870912)&&Re(D,z,q,q[60],v?Ue(z,q[60],X,null):De(q[60]),null);let se=w;w=H(q),w===se?~w&&R[w].p(q,X):(S&&(ye(),C(R[se],1,1,()=>{R[se]=null}),ve()),~w?(S=R[w],S?S.p(q,X):(S=R[w]=O[w](q),S.c()),b(S,1),S.m(t,null)):S=null),(!v||X[0]&4&&y!==(y=Eo(q[2])+" svelte-bz0zu3"))&&j(t,"class",y),(!v||X[0]&22)&&mt(t,"can-collapse",q[4]&&q[1]==="")},i(q){v||(b(E),b(l.$$.fragment,q),b(c.$$.fragment,q),b(M),b(N),b(D,q),b(S),v=!0)},o(q){C(E),C(l.$$.fragment,q),C(c.$$.fragment,q),C(M),C(N),C(D,q),C(S),v=!1},d(q){q&&(k(e),k(t)),I(l),r[63](null),I(c),M&&M.d(),N&&N.d(),D&&D.d(q),~w&&R[w].d(),L=!1,ft(A)}}}function Bc(r,e,t){let n,o,{$$slots:l={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:f}=e,{bbox:u=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:p=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:w="never"}=e,{errorMessage:S="Something went wrong…"}=e,{filter:y=()=>!0}=e,{flyTo:v=!0}=e,{fuzzyMatch:L=!0}=e,{language:A=void 0}=e,{limit:E=void 0}=e,{mapController:M=void 0}=e,{minLength:N=2}=e,{noResultsMessage:z="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:D="Search"}=e,{proximity:O=[{type:"server-geolocation"}]}=e,{reverseActive:R=w==="always"}=e,{reverseButtonTitle:H="toggle reverse geocoding"}=e,{searchValue:q=""}=e,{pickedResultStyle:X="full-geometry"}=e,{showPlaceType:se="if-needed"}=e,{showResultsWhileTyping:ce=!0}=e,{selectFirst:U=!0}=e,{flyToSelected:be=!1}=e,{markerOnSelected:ge=!0}=e,{types:ae=void 0}=e,{exhaustiveReverseGeocoding:we=!1}=e,{excludeTypes:fe=!1}=e,{zoom:Pe=s}=e,{apiUrl:Xe="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ae={}}=e,{iconsBaseUrl:re="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Ke=()=>{}}=e;function Ne(){Ge.focus()}function ke(){Ge.blur()}function K(J,rt=!0,gt=!1){t(1,q=J),rt?(t(15,Ye=-1),It()):(Or(!gt,gt),setTimeout(()=>{Ge.focus(),Ge.select()}))}function pe(){t(14,he=void 0),t(56,W=void 0),t(15,Ye=-1)}function Q(){t(55,Se=[]),t(56,W=void 0)}let me=!1,he,Se,W,dt="",Ge,Ye=-1,kt,bt=[],et,en,tn,Lt;const ar=new Set,Pt=pn();Tt(()=>{M&&(M.setEventHandler(void 0),M.indicateReverse(!1),M.setSelectedMarker(-1),M.setFeatures(void 0,void 0,!1))});function It(J){if(en&&(clearTimeout(en),en=void 0),Ye>-1&&he)t(56,W=he[Ye]),t(1,q=W.place_type[0]==="reverse"?W.place_name:W.place_name.replace(/,.*/,"")),t(18,kt=void 0),t(55,Se=void 0),t(15,Ye=-1);else if(q){const rt=J||!lt(q);Ie(q,{exact:!0}).then(()=>{t(55,Se=he),t(56,W=void 0),rt&&it()}).catch(gt=>t(18,kt=gt))}}function lt(J){try{return ua(J,6)}catch{return!1}}async function Ie(J,{byId:rt=!1,exact:gt=!1}={}){t(18,kt=void 0),et==null||et.abort();const Et=new AbortController;t(19,et=Et);try{const Ee=lt(J),_t=new URLSearchParams;if(A!==void 0&&_t.set("language",Array.isArray(A)?A.join(","):A??""),ae&&_t.set("types",ae.join(",")),fe&&_t.set("excludeTypes",String(fe)),u&&_t.set("bbox",u.map(fr=>fr.toFixed(6)).join(",")),p&&_t.set("country",Array.isArray(p)?p.join(","):p),!rt&&!Ee){const fr=await Ic(M,O,Et);fr&&_t.set("proximity",fr),(gt||!ce)&&_t.set("autocomplete","false"),_t.set("fuzzyMatch",String(L))}E!==void 0&&(we||!Ee||(ae==null?void 0:ae.length)===1)&&_t.set("limit",String(E)),_t.set("key",f),Ke(_t);const Kt=Xe+"/"+encodeURIComponent(Ee?Ee.decimalLongitude+","+Ee.decimalLatitude:J)+".json?"+_t.toString();if(Kt===dt){rt?(t(14,he=void 0),t(56,W=bt[0])):t(14,he=bt);return}dt=Kt;const Rr=await fetch(Kt,{signal:Et.signal,...Ae});if(!Rr.ok)throw new Error(await Rr.text());const Dr=await Rr.json();Pt("response",{url:Kt,featureCollection:Dr}),rt?(t(14,he=void 0),t(56,W=Dr.features[0]),bt=[W]):(t(14,he=Dr.features.filter(y)),Ee&&he.unshift({type:"Feature",properties:{},id:"reverse_"+Ee.decimalLongitude+"_"+Ee.decimalLatitude,text:Ee.decimalLatitude+", "+Ee.decimalLongitude,place_name:Ee.decimalLatitude+", "+Ee.decimalLongitude,place_type:["reverse"],center:[Ee.decimalLongitude,Ee.decimalLatitude],bbox:[Ee.decimalLongitude,Ee.decimalLatitude,Ee.decimalLongitude,Ee.decimalLatitude],geometry:{type:"Point",coordinates:[Ee.decimalLongitude,Ee.decimalLatitude]}}),bt=he,Ee&&Ge.focus())}catch(Ee){if(Ee&&typeof Ee=="object"&&"name"in Ee&&Ee.name==="AbortError")return;throw Ee}finally{Et===et&&t(19,et=void 0)}}function it(){var Et;if(!(Se!=null&&Se.length)||!v)return;const J=[180,90,-180,-90],rt=!Se.some(Ee=>!Ee.matching_text);let gt;for(const Ee of Se){const _t=Pn(Ee);if(gt=gt===void 0?_t:_t===void 0?gt:Math.max(gt,_t),rt||!Ee.matching_text)for(const Kt of[0,1,2,3])J[Kt]=Math[Kt<2?"min":"max"](J[Kt],((Et=Ee.bbox)==null?void 0:Et[Kt])??Ee.center[Kt%2])}M&&Se.length>0&&(W&&J[0]===J[2]&&J[1]===J[3]?M.flyTo(W.center,Pn(W)):M.fitBounds(yl(J),50,gt))}function Pn(J){var gt;if(!J.bbox||J.bbox[0]!==J.bbox[2]&&J.bbox[1]!==J.bbox[3])return;const rt=J.id.replace(/\..*/,"");return(Array.isArray((gt=J.properties)==null?void 0:gt.categories)?J.properties.categories.reduce((Et,Ee)=>{const _t=Pe[rt+"."+Ee];return Et===void 0?_t:_t===void 0?Et:Math.max(Et,_t)},void 0):void 0)??Pe[rt]}function Bs(J){t(0,R=w==="always"),t(14,he=void 0),t(56,W=void 0),t(15,Ye=-1),K(J[1].toFixed(6)+", "+Pc(J[0],[-180,180],!0).toFixed(6),!1,!0)}function Rs(J){if(!he)return;let rt=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;rt&&(Ye===(U?0:-1)&&rt===-1&&t(15,Ye=he.length),t(15,Ye+=rt),Ye>=he.length&&t(15,Ye=-1),Ye<0&&U&&t(15,Ye=0),J.preventDefault())}function Or(J=!0,rt=!1){if(t(18,kt=void 0),ce||rt){if(en&&clearTimeout(en),q.length<N)return;const gt=q;en=window.setTimeout(()=>{Ie(gt).catch(Et=>t(18,kt=Et))},J?g:0)}else t(14,he=void 0),t(18,kt=void 0)}function Br(J){t(56,W=J),t(1,q=J.place_name),t(15,Ye=-1)}const Ds=()=>Ge.focus();function Us(J){Te[J?"unshift":"push"](()=>{Ge=J,t(17,Ge)})}function Hs(){q=this.value,t(1,q),t(13,me),t(28,_)}const Gs=()=>t(13,me=!0),Ws=()=>t(13,me=!1),qs=()=>Or(),Js=()=>{t(1,q=""),Ge.focus()},Ys=()=>t(0,R=!R),Zs=()=>t(18,kt=void 0),Ks=J=>t(15,Ye=J),Xs=J=>Br(J),Vs=()=>{U||t(15,Ye=-1)},Qs=()=>{};return r.$$set=J=>{"class"in J&&t(2,a=J.class),"apiKey"in J&&t(26,f=J.apiKey),"bbox"in J&&t(27,u=J.bbox),"clearButtonTitle"in J&&t(3,c=J.clearButtonTitle),"clearOnBlur"in J&&t(28,_=J.clearOnBlur),"collapsed"in J&&t(4,d=J.collapsed),"country"in J&&t(29,p=J.country),"debounceSearch"in J&&t(30,g=J.debounceSearch),"enableReverse"in J&&t(5,w=J.enableReverse),"errorMessage"in J&&t(6,S=J.errorMessage),"filter"in J&&t(31,y=J.filter),"flyTo"in J&&t(32,v=J.flyTo),"fuzzyMatch"in J&&t(33,L=J.fuzzyMatch),"language"in J&&t(34,A=J.language),"limit"in J&&t(35,E=J.limit),"mapController"in J&&t(36,M=J.mapController),"minLength"in J&&t(37,N=J.minLength),"noResultsMessage"in J&&t(7,z=J.noResultsMessage),"placeholder"in J&&t(8,D=J.placeholder),"proximity"in J&&t(38,O=J.proximity),"reverseActive"in J&&t(0,R=J.reverseActive),"reverseButtonTitle"in J&&t(9,H=J.reverseButtonTitle),"searchValue"in J&&t(1,q=J.searchValue),"pickedResultStyle"in J&&t(39,X=J.pickedResultStyle),"showPlaceType"in J&&t(10,se=J.showPlaceType),"showResultsWhileTyping"in J&&t(40,ce=J.showResultsWhileTyping),"selectFirst"in J&&t(11,U=J.selectFirst),"flyToSelected"in J&&t(41,be=J.flyToSelected),"markerOnSelected"in J&&t(42,ge=J.markerOnSelected),"types"in J&&t(43,ae=J.types),"exhaustiveReverseGeocoding"in J&&t(44,we=J.exhaustiveReverseGeocoding),"excludeTypes"in J&&t(45,fe=J.excludeTypes),"zoom"in J&&t(46,Pe=J.zoom),"apiUrl"in J&&t(47,Xe=J.apiUrl),"fetchParameters"in J&&t(48,Ae=J.fetchParameters),"iconsBaseUrl"in J&&t(12,re=J.iconsBaseUrl),"adjustUrlQuery"in J&&t(49,Ke=J.adjustUrlQuery),"$$scope"in J&&t(60,i=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,R=w==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,tn=me),_&&!me&&t(1,q="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&q.length<N&&(t(56,W=void 0),t(14,he=void 0),t(18,kt=void 0),t(55,Se=he)),r.$$.dirty[1]&33554688&&X!=="marker-only"&&W&&!W.address&&W.geometry.type==="Point"&&W.place_type[0]!=="reverse"&&Ie(W.id,{byId:!0}).catch(J=>t(18,kt=J)),r.$$.dirty[1]&100663330&&(M&&W&&W.id!==Lt&&v&&(!W.bbox||W.bbox[0]===W.bbox[2]&&W.bbox[1]===W.bbox[3]?M.flyTo(W.center,Pn(W)):M.fitBounds(yl(W.bbox),50,Pn(W)),t(14,he=void 0),t(55,Se=void 0),t(15,Ye=-1)),t(57,Lt=W==null?void 0:W.id)),r.$$.dirty[0]&18432&&U&&he!=null&&he.length&&t(15,Ye=0),r.$$.dirty[0]&2&&t(15,Ye=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Se!==he&&t(55,Se=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&M&&M.setEventHandler(J=>{switch(J.type){case"mapClick":R&&Bs(J.coordinates);break;case"markerClick":{const rt=he==null?void 0:he.find(gt=>gt.id===J.id);rt&&Br(rt)}break;case"markerMouseEnter":Se&&t(15,Ye=tn?(he==null?void 0:he.findIndex(rt=>rt.id===J.id))??-1:-1);break;case"markerMouseLeave":Se&&t(15,Ye=-1);break}}),r.$$.dirty[0]&49152&&t(58,o=he==null?void 0:he[Ye]),r.$$.dirty[1]&134218786&&M&&o&&v&&be&&M.flyTo(o.center,Pn(o)),r.$$.dirty[1]&256&&t(59,n=X==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ge||M==null||M.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&M&&ge&&!Se&&(M.setFeatures(o?[o]:void 0,void 0,n),M.setSelectedMarker(o?0:-1)),r.$$.dirty[1]&318767136&&M&&M.setFeatures(Se,W,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Se&&M&&M.setSelectedMarker(Ye),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&M){const J=lt(q);M.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Pt("select",{feature:o}),r.$$.dirty[1]&33554432&&Pt("pick",{feature:W}),r.$$.dirty[0]&81920&&Pt("optionsvisibilitychange",{optionsVisible:tn&&!!he}),r.$$.dirty[0]&16384&&Pt("featureslisted",{features:he}),r.$$.dirty[1]&16777216&&Pt("featuresmarked",{features:Se}),r.$$.dirty[0]&1&&Pt("reversetoggle",{reverse:R}),r.$$.dirty[0]&2&&Pt("querychange",{query:q}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&M&&M.indicateReverse(R)},[R,q,a,c,d,w,S,z,D,H,se,U,re,me,he,Ye,tn,Ge,kt,et,ar,It,Rs,Or,Br,s,f,u,_,p,g,y,v,L,A,E,M,N,O,X,ce,be,ge,ae,we,fe,Pe,Xe,Ae,Ke,Ne,ke,K,pe,Q,Se,W,Lt,o,n,i,l,Ds,Us,Hs,Gs,Ws,qs,Js,Ys,Zs,Ks,Xs,Vs,Qs]}class Rc extends le{constructor(e){super(),ie(this,e,Bc,Oc,oe,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function Ll(r){let e,t,n;return t=new Rc({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"class","svelte-ixhnie")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p(o,l){const i={};l&4&&(i.mapController=o[2]),l&1&&(i.apiKey=o[0]),l&2&&(i.country=o[1]),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function Dc(r){let e,t,n=r[2]&&Ll(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,[l]){o[2]?n?(n.p(o,l),l&4&&b(n,1)):(n=Ll(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function Uc(r,e,t){let n,{apiKey:o}=e,{map:l}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(f){return f?_a(f,Vt,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=f=>{"apiKey"in f&&t(0,o=f.apiKey),"map"in f&&t(4,l=f.map),"country"in f&&t(1,i=f.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=a(l))},[o,i,n,s,l]}class Hc extends le{constructor(e){super(),ie(this,e,Uc,Dc,oe,{apiKey:0,map:4,country:1})}}function Gt(r,e,t){let n=["match",r];for(let[o,l]of Object.entries(e))n.push(o),n.push(l);return n.push(t),n}function St(r,e,t){let n=["step",r];for(let o=1;o<e.length;o++)n.push(t[o-1]),n.push(e[o]);return n.push(t[t.length-1]),n}function Yt(){return{type:"FeatureCollection",features:[]}}function Gc(r){let e,t,n;return t=new mn({props:{colorScale:r[3].colorScale,limits:r[3].limits}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","legend")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p:Y,i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function Wc(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function qc(r){let e,t,n;return t=new Ar({props:{colors:r[4],horiz:!0}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","legend")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p:Y,i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function Jc(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Yc(r){let e,t,n;return t=new Ar({props:{colors:r[5],horiz:!0}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","legend")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p:Y,i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function Zc(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Kc(r){let e,t,n,o,l,i;const s=[$e("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Gt(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":an(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={};for(let d=0;d<s.length;d+=1)a=de(a,s[d]);e=new nt({props:a});const f=[$e("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Gt(["get","Level of Service"],r[4],"cyan"),"line-width":an(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={};for(let d=0;d<f.length;d+=1)u=de(u,f[d]);n=new nt({props:u});const c=[$e("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Gt(["get","Infrastructure type"],r[5],"cyan"),"line-width":an(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return l=new nt({props:_}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment)},m(d,p){P(e,d,p),$(d,t,p),P(n,d,p),$(d,o,p),P(l,d,p),i=!0},p(d,p){const g=p&9?He(s,[s[0],s[1],s[2],p&8&&{paint:{"line-color":Gt(["get","Traffic volume category"],{"0 to 1999":d[3].colorScale[0],"2000 to 3999":d[3].colorScale[1],"4000+":d[3].colorScale[2]},"cyan"),"line-width":an(0)}},p&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};e.$set(g);const w=p&18?He(f,[f[0],f[1],p&16&&{paint:{"line-color":Gt(["get","Level of Service"],d[4],"cyan"),"line-width":an(1)}},p&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};n.$set(w);const S=p&36?He(c,[c[0],c[1],c[2],p&32&&{paint:{"line-color":Gt(["get","Infrastructure type"],d[5],"cyan"),"line-width":an(1)}},p&4&&{layout:{visibility:d[2]?"visible":"none"}}]):{};l.$set(S)},i(d){i||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),i=!1},d(d){d&&(k(t),k(o)),I(e,d),I(n,d),I(l,d)}}}function Xc(r){let e,t,n,o,l,i,s,a,f,u,c;function _(y){r[6](y)}let d={label:"Traffic",$$slots:{help:[Wc],legend:[Gc]},$$scope:{ctx:r}};r[0]!==void 0&&(d.show=r[0]),e=new Qt({props:d}),Te.push(()=>We(e,"show",_));function p(y){r[7](y)}let g={label:"Level of Service",$$slots:{help:[Jc],legend:[qc]},$$scope:{ctx:r}};r[1]!==void 0&&(g.show=r[1]),o=new Qt({props:g}),Te.push(()=>We(o,"show",p));function w(y){r[8](y)}let S={label:"Cycle infrastructure",$$slots:{help:[Zc],legend:[Yc]},$$scope:{ctx:r}};return r[2]!==void 0&&(S.show=r[2]),s=new Qt({props:S}),Te.push(()=>We(s,"show",w)),u=new rr({props:{url:`pmtiles://${$t("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[Kc]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment),i=T(),F(s.$$.fragment),f=T(),F(u.$$.fragment)},m(y,v){P(e,y,v),$(y,n,v),P(o,y,v),$(y,i,v),P(s,y,v),$(y,f,v),P(u,y,v),c=!0},p(y,[v]){const L={};v&512&&(L.$$scope={dirty:v,ctx:y}),!t&&v&1&&(t=!0,L.show=y[0],qe(()=>t=!1)),e.$set(L);const A={};v&512&&(A.$$scope={dirty:v,ctx:y}),!l&&v&2&&(l=!0,A.show=y[1],qe(()=>l=!1)),o.$set(A);const E={};v&512&&(E.$$scope={dirty:v,ctx:y}),!a&&v&4&&(a=!0,E.show=y[2],qe(()=>a=!1)),s.$set(E);const M={};v&519&&(M.$$scope={dirty:v,ctx:y}),u.$set(M)},i(y){c||(b(e.$$.fragment,y),b(o.$$.fragment,y),b(s.$$.fragment,y),b(u.$$.fragment,y),c=!0)},o(y){C(e.$$.fragment,y),C(o.$$.fragment,y),C(s.$$.fragment,y),C(u.$$.fragment,y),c=!1},d(y){y&&(k(n),k(i),k(f)),I(e,y),I(o,y),I(s,y),I(u,y)}}}function Vc(r,e,t){let n=!1,o=!1,l=!1,i={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},s={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},a={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function f(_){n=_,t(0,n)}function u(_){o=_,t(1,o)}function c(_){l=_,t(2,l)}return[n,o,l,i,s,a,f,u,c]}class Qc extends le{constructor(e){super(),ie(this,e,Vc,Xc,oe,{})}}function xc(r){let e,t,n;return t=new Ar({props:{colors:r[1],horiz:!0}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","legend")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p:Y,i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function ed(r){let e;return{c(){e=h("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    .`,j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function td(r){let e=r[3].name+"",t;return{c(){t=B(e)},m(n,o){$(n,t,o)},p(n,o){o&8&&e!==(e=n[3].name+"")&&ne(t,e)},d(n){n&&k(t)}}}function nd(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[td,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function rd(r){let e,t;const n=[$e("context-gp-practices"),{paint:{"circle-color":r[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[nd]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new ln({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i&3?He(n,[n[0],i&2&&{paint:{"circle-color":l[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function od(r){let e=r[3].name+"",t;return{c(){t=B(e)},m(n,o){$(n,t,o)},p(n,o){o&8&&e!==(e=n[3].name+"")&&ne(t,e)},d(n){n&&k(t)}}}function ld(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[od,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function id(r){let e,t;const n=[$e("context-hospitals"),{paint:{"circle-color":r[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[ld]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new ln({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i&3?He(n,[n[0],i&2&&{paint:{"circle-color":l[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function sd(r){let e=r[3].name+"",t,n,o=r[3].pupils+"",l,i;return{c(){t=B(e),n=B(" with "),l=B(o),i=B(" pupils")},m(s,a){$(s,t,a),$(s,n,a),$(s,l,a),$(s,i,a)},p(s,a){a&8&&e!==(e=s[3].name+"")&&ne(t,e),a&8&&o!==(o=s[3].pupils+"")&&ne(l,o)},d(s){s&&(k(t),k(n),k(l),k(i))}}}function ad(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[sd,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function fd(r){let e,t;const n=[$e("context-schools"),{paint:{"circle-color":r[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[ad]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new ln({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i&3?He(n,[n[0],i&2&&{paint:{"circle-color":l[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function ud(r){let e,t,n,o,l,i,s,a,f;function u(_){r[2](_)}let c={label:"POIs",$$slots:{help:[ed],legend:[xc]},$$scope:{ctx:r}};return r[0]!==void 0&&(c.show=r[0]),e=new Qt({props:c}),Te.push(()=>We(e,"show",u)),o=new Ve({props:{data:$t("cnt_layers/gp_practices.geojson"),generateId:!0,$$slots:{default:[rd]},$$scope:{ctx:r}}}),i=new Ve({props:{data:$t("cnt_layers/hospitals.geojson"),generateId:!0,$$slots:{default:[id]},$$scope:{ctx:r}}}),a=new Ve({props:{data:$t("cnt_layers/schools.geojson"),generateId:!0,$$slots:{default:[fd]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment),l=T(),F(i.$$.fragment),s=T(),F(a.$$.fragment)},m(_,d){P(e,_,d),$(_,n,d),P(o,_,d),$(_,l,d),P(i,_,d),$(_,s,d),P(a,_,d),f=!0},p(_,[d]){const p={};d&16&&(p.$$scope={dirty:d,ctx:_}),!t&&d&1&&(t=!0,p.show=_[0],qe(()=>t=!1)),e.$set(p);const g={};d&17&&(g.$$scope={dirty:d,ctx:_}),o.$set(g);const w={};d&17&&(w.$$scope={dirty:d,ctx:_}),i.$set(w);const S={};d&17&&(S.$$scope={dirty:d,ctx:_}),a.$set(S)},i(_){f||(b(e.$$.fragment,_),b(o.$$.fragment,_),b(i.$$.fragment,_),b(a.$$.fragment,_),f=!0)},o(_){C(e.$$.fragment,_),C(o.$$.fragment,_),C(i.$$.fragment,_),C(a.$$.fragment,_),f=!1},d(_){_&&(k(n),k(l),k(s)),I(e,_),I(o,_),I(i,_),I(a,_)}}}function cd(r,e,t){let n=!1,o={Schools:"#7fc97f",GPs:"#beaed4",Hospitals:"#fdc086"};function l(i){n=i,t(0,n)}return[n,o,l]}class dd extends le{constructor(e){super(),ie(this,e,cd,ud,oe,{})}}let ys=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],vs=[20,30,40,50,60,70],on=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],or=[0,20,40,60,80,100];const wn={mapFeature:{hover:{backgroundColor:"blue"}}};let Wn=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],Mo=[0,.3,.6,1,1.5,2],To=[0,1,10,50,100,1e3],Ao=Wn;function _d(r){let e,t,n,o,l;return t=new mn({props:{colorScale:on,limits:or}}),{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent="Darker colours are more deprived",j(e,"slot","legend")},m(i,s){$(i,e,s),P(t,e,null),m(e,n),m(e,o),l=!0},p:Y,i(i){l||(b(t.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),l=!1},d(i){i&&k(e),I(t)}}}function pd(r){let e;return{c(){e=h("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function md(r){let e,t,n,o,l;return t=new mn({props:{colorScale:r[2],limits:r[3]}}),{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent="Darker colours are denser",j(e,"slot","legend")},m(i,s){$(i,e,s),P(t,e,null),m(e,n),m(e,o),l=!0},p:Y,i(i){l||(b(t.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),l=!1},d(i){i&&k(e),I(t)}}}function gd(r){let e;return{c(){e=h("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function hd(r){let e,t,n=r[6].id+"",o,l,i=r[6].population.toLocaleString()+"",s,a,f=r[6].imd_rank+"",u,c,_=r[6].imd_percentile+"",d,p;return{c(){e=h("p"),t=B("Data zone "),o=B(n),l=B(`
        has `),s=B(i),a=B(`
        people, and a SIMD rank of `),u=B(f),c=B(", putting it in the "),d=B(_),p=B(`
        percentile.`)},m(g,w){$(g,e,w),m(e,t),m(e,o),m(e,l),m(e,s),m(e,a),m(e,u),m(e,c),m(e,d),m(e,p)},p(g,w){w&64&&n!==(n=g[6].id+"")&&ne(o,n),w&64&&i!==(i=g[6].population.toLocaleString()+"")&&ne(s,i),w&64&&f!==(f=g[6].imd_rank+"")&&ne(u,f),w&64&&_!==(_=g[6].imd_percentile+"")&&ne(d,_)},d(g){g&&k(e)}}}function bd(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[hd,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function wd(r){let e,t,n=r[6].id+"",o,l,i=r[6].population.toLocaleString()+"",s,a,f=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",u,c;return{c(){e=h("p"),t=B("Data zone "),o=B(n),l=B(`
        has `),s=B(i),a=B(`
        people, with a density of `),u=B(f),c=B(" people per square kilometer")},m(_,d){$(_,e,d),m(e,t),m(e,o),m(e,l),m(e,s),m(e,a),m(e,u),m(e,c)},p(_,d){d&64&&n!==(n=_[6].id+"")&&ne(o,n),d&64&&i!==(i=_[6].population.toLocaleString()+"")&&ne(s,i),d&64&&f!==(f=Math.round(_[6].population/(_[6].area/1e6)).toLocaleString()+"")&&ne(u,f)},d(_){_&&k(e)}}}function yd(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[wd,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function vd(r){let e,t,n,o,l,i;const s=[$e("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":St(["get","imd_percentile"],or,on),"fill-opacity":ot(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={$$slots:{default:[bd]},$$scope:{ctx:r}};for(let d=0;d<s.length;d+=1)a=de(a,s[d]);e=new At({props:a});const f=[$e("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":St(["/",["get","population"],["/",["get","area"],1e6]],r[3],r[2]),"fill-opacity":ot(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={$$slots:{default:[yd]},$$scope:{ctx:r}};for(let d=0;d<f.length;d+=1)u=de(u,f[d]);n=new At({props:u});const c=[$e("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return l=new nt({props:_}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment)},m(d,p){P(e,d,p),$(d,t,p),P(n,d,p),$(d,o,p),P(l,d,p),i=!0},p(d,p){const g=p&1?He(s,[s[0],s[1],s[2],s[3],{layout:{visibility:d[0]?"visible":"none"}}]):{};p&128&&(g.$$scope={dirty:p,ctx:d}),e.$set(g);const w=p&14?He(f,[f[0],f[1],f[2],p&12&&{paint:{"fill-color":St(["/",["get","population"],["/",["get","area"],1e6]],d[3],d[2]),"fill-opacity":ot(.7,.9)}},p&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};p&128&&(w.$$scope={dirty:p,ctx:d}),n.$set(w);const S=p&3?He(c,[c[0],c[1],c[2],{layout:{visibility:d[0]||d[1]?"visible":"none"}}]):{};l.$set(S)},i(d){i||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),i=!1},d(d){d&&(k(t),k(o)),I(e,d),I(n,d),I(l,d)}}}function $d(r){let e,t,n,o,l,i,s,a;function f(d){r[4](d)}let u={label:"SIMD",$$slots:{help:[pd],legend:[_d]},$$scope:{ctx:r}};r[0]!==void 0&&(u.show=r[0]),e=new Qt({props:u}),Te.push(()=>We(e,"show",f));function c(d){r[5](d)}let _={label:"Population density",$$slots:{help:[gd],legend:[md]},$$scope:{ctx:r}};return r[1]!==void 0&&(_.show=r[1]),o=new Qt({props:_}),Te.push(()=>We(o,"show",c)),s=new rr({props:{url:`pmtiles://${$t("cnt_layers/population.pmtiles")}`,$$slots:{default:[vd]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment),i=T(),F(s.$$.fragment)},m(d,p){P(e,d,p),$(d,n,p),P(o,d,p),$(d,i,p),P(s,d,p),a=!0},p(d,[p]){const g={};p&128&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],qe(()=>t=!1)),e.$set(g);const w={};p&128&&(w.$$scope={dirty:p,ctx:d}),!l&&p&2&&(l=!0,w.show=d[1],qe(()=>l=!1)),o.$set(w);const S={};p&131&&(S.$$scope={dirty:p,ctx:d}),s.$set(S)},i(d){a||(b(e.$$.fragment,d),b(o.$$.fragment,d),b(s.$$.fragment,d),a=!0)},o(d){C(e.$$.fragment,d),C(o.$$.fragment,d),C(s.$$.fragment,d),a=!1},d(d){d&&(k(n),k(i)),I(e,d),I(o,d),I(s,d)}}}function kd(r,e,t){let n=!1,o=!1,l=on.toReversed(),i=[0,4700,13e3,33e3,94e3,198e4];function s(f){n=f,t(0,n)}function a(f){o=f,t(1,o)}return[n,o,l,i,s,a]}class Sd extends le{constructor(e){super(),ie(this,e,kd,$d,oe,{})}}function Ld(r){let e;return{c(){e=h("div"),e.innerHTML=`<img src="${xi}" alt="National Rail logo"/>
    Station`,j(e,"slot","legend"),V(e,"display","flex"),V(e,"gap","8px"),V(e,"align-items","center")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Cd(r){let e;return{c(){e=h("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Md(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=h("p"),n=B(t)},m(o,l){$(o,e,l),m(e,n)},p(o,l){l&4&&t!==(t=(o[2].name??"Unnamed railway station")+"")&&ne(n,t)},d(o){o&&k(e)}}}function Td(r){let e,t;return e=new ht({props:{$$slots:{default:[Md,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&12&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Ad(r){let e,t;const n=[$e("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[Td]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Vn({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i&1?He(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:l[0]?"visible":"none"}}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Fd(r){let e,t,n,o,l;function i(a){r[1](a)}let s={label:"Railway stations",$$slots:{help:[Cd],legend:[Ld]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new Qt({props:s}),Te.push(()=>We(e,"show",i)),o=new Ve({props:{data:$t("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[Ad]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment)},m(a,f){P(e,a,f),$(a,n,f),P(o,a,f),l=!0},p(a,[f]){const u={};f&8&&(u.$$scope={dirty:f,ctx:a}),!t&&f&1&&(t=!0,u.show=a[0],qe(()=>t=!1)),e.$set(u);const c={};f&9&&(c.$$scope={dirty:f,ctx:a}),o.$set(c)},i(a){l||(b(e.$$.fragment,a),b(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&k(n),I(e,a),I(o,a)}}}function Pd(r,e,t){let n=!1;function o(l){n=l,t(0,n)}return[n,o]}class Id extends le{constructor(e){super(),ie(this,e,Pd,Fd,oe,{})}}function Cl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Ml(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Tl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Al(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Fl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Pl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Ed(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Il(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=B(t),e.__value=r[18],Oe(e,e.__value)},m(o,l){$(o,e,l),m(e,n)},p:Y,d(o){o&&k(e)}}}function El(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=B(t),e.__value=r[18],Oe(e,e.__value)},m(o,l){$(o,e,l),m(e,n)},p:Y,d(o){o&&k(e)}}}function jl(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=B(t),e.__value=r[18],Oe(e,e.__value)},m(o,l){$(o,e,l),m(e,n)},p:Y,d(o){o&&k(e)}}}function Nl(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=B(t),e.__value=r[18],Oe(e,e.__value)},m(o,l){$(o,e,l),m(e,n)},p:Y,d(o){o&&k(e)}}}function jd(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w,S,y,v=Me(r[7]),L=[];for(let O=0;O<v.length;O+=1)L[O]=Il(Pl(r,v,O));let A=Me(r[8]),E=[];for(let O=0;O<A.length;O+=1)E[O]=El(Fl(r,A,O));let M=Me(r[9]),N=[];for(let O=0;O<M.length;O+=1)N[O]=jl(Al(r,M,O));let z=Me(r[10]),D=[];for(let O=0;O<z.length;O+=1)D[O]=Nl(Tl(r,z,O));return{c(){e=h("div"),t=h("label"),n=B(`Trip purpose:
      `),o=h("select");for(let O=0;O<L.length;O+=1)L[O].c();l=T(),i=h("label"),s=B(`Scenario:
      `),a=h("select");for(let O=0;O<E.length;O+=1)E[O].c();f=T(),u=h("label"),c=B(`Network type:
      `),_=h("select");for(let O=0;O<N.length;O+=1)N[O].c();d=T(),p=h("label"),g=B(`Color by:
      `),w=h("select");for(let O=0;O<D.length;O+=1)D[O].c();r[0]===void 0&&fn(()=>r[11].call(o)),r[1]===void 0&&fn(()=>r[12].call(a)),r[2]===void 0&&fn(()=>r[13].call(_)),r[3]===void 0&&fn(()=>r[14].call(w)),j(e,"slot","legend")},m(O,R){$(O,e,R),m(e,t),m(t,n),m(t,o);for(let H=0;H<L.length;H+=1)L[H]&&L[H].m(o,null);vt(o,r[0],!0),m(e,l),m(e,i),m(i,s),m(i,a);for(let H=0;H<E.length;H+=1)E[H]&&E[H].m(a,null);vt(a,r[1],!0),m(e,f),m(e,u),m(u,c),m(u,_);for(let H=0;H<N.length;H+=1)N[H]&&N[H].m(_,null);vt(_,r[2],!0),m(e,d),m(e,p),m(p,g),m(p,w);for(let H=0;H<D.length;H+=1)D[H]&&D[H].m(w,null);vt(w,r[3],!0),S||(y=[x(o,"change",r[11]),x(a,"change",r[12]),x(_,"change",r[13]),x(w,"change",r[14])],S=!0)},p(O,R){if(R[0]&128){v=Me(O[7]);let H;for(H=0;H<v.length;H+=1){const q=Pl(O,v,H);L[H]?L[H].p(q,R):(L[H]=Il(q),L[H].c(),L[H].m(o,null))}for(;H<L.length;H+=1)L[H].d(1);L.length=v.length}if(R[0]&129&&vt(o,O[0]),R[0]&256){A=Me(O[8]);let H;for(H=0;H<A.length;H+=1){const q=Fl(O,A,H);E[H]?E[H].p(q,R):(E[H]=El(q),E[H].c(),E[H].m(a,null))}for(;H<E.length;H+=1)E[H].d(1);E.length=A.length}if(R[0]&258&&vt(a,O[1]),R[0]&512){M=Me(O[9]);let H;for(H=0;H<M.length;H+=1){const q=Al(O,M,H);N[H]?N[H].p(q,R):(N[H]=jl(q),N[H].c(),N[H].m(_,null))}for(;H<N.length;H+=1)N[H].d(1);N.length=M.length}if(R[0]&516&&vt(_,O[2]),R[0]&1024){z=Me(O[10]);let H;for(H=0;H<z.length;H+=1){const q=Tl(O,z,H);D[H]?D[H].p(q,R):(D[H]=Nl(q),D[H].c(),D[H].m(w,null))}for(;H<D.length;H+=1)D[H].d(1);D.length=z.length}R[0]&1032&&vt(w,O[3])},d(O){O&&k(e),ut(L,O),ut(E,O),ut(N,O),ut(D,O),S=!1,ft(y)}}}function zl(r){let e,t,n,o,l=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",p,g;return{c(){e=h("tr"),t=h("th"),t.textContent=`${r[19]}`,n=T(),o=h("td"),i=B(l),s=T(),a=h("td"),u=B(f),c=T(),_=h("td"),p=B(d),g=T()},m(w,S){$(w,e,S),m(e,t),m(e,n),m(e,o),m(o,i),m(e,s),m(e,a),m(a,u),m(e,c),m(e,_),m(_,p),m(e,g)},p(w,S){S[0]&131072&&l!==(l=w[17][`${w[18]}_fastest_bicycle`].toLocaleString()+"")&&ne(i,l),S[0]&131072&&f!==(f=w[17][`${w[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&ne(u,f),S[0]&131072&&d!==(d=w[17][`${w[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&ne(p,d)},d(w){w&&k(e)}}}function Ol(r){let e,t,n,o,l=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",p,g;return{c(){e=h("tr"),t=h("th"),t.textContent=`${r[19]}`,n=T(),o=h("td"),i=B(l),s=T(),a=h("td"),u=B(f),c=T(),_=h("td"),p=B(d),g=T()},m(w,S){$(w,e,S),m(e,t),m(e,n),m(e,o),m(o,i),m(e,s),m(e,a),m(a,u),m(e,c),m(e,_),m(_,p),m(e,g)},p(w,S){S[0]&131072&&l!==(l=w[17][`${w[18]}_quietest_bicycle`].toLocaleString()+"")&&ne(i,l),S[0]&131072&&f!==(f=w[17][`${w[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&ne(u,f),S[0]&131072&&d!==(d=w[17][`${w[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&ne(p,d)},d(w){w&&k(e)}}}function Nd(r){let e,t,n,o=r[17][r[4]].toLocaleString()+"",l,i,s,a,f=r[17].gradient+"",u,c,_,d,p,g=r[17].quietness+"",w,S,y,v,L,A,E,M,N,z,D,O,R,H,q,X,se,ce=Me(r[7]),U=[];for(let ae=0;ae<ce.length;ae+=1)U[ae]=zl(Ml(r,ce,ae));let be=Me(r[7]),ge=[];for(let ae=0;ae<be.length;ae+=1)ge[ae]=Ol(Cl(r,be,ae));return{c(){e=h("div"),t=h("p"),n=B("Cyclists: "),l=B(o),i=T(),s=h("p"),a=B("Gradient: "),u=B(f),c=B("%"),_=T(),d=h("p"),p=B("Cycle-friendliness: "),w=B(g),S=B("%"),y=T(),v=h("details"),L=h("summary"),L.textContent="All network details",A=T(),E=h("p"),E.textContent="Fast/Direct network",M=T(),N=h("table"),z=h("tr"),z.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",D=T();for(let ae=0;ae<U.length;ae+=1)U[ae].c();O=T(),R=h("p"),R.textContent="Quiet/Indirect network",H=T(),q=h("table"),X=h("tr"),X.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",se=T();for(let ae=0;ae<ge.length;ae+=1)ge[ae].c();V(e,"max-width","30vw"),V(e,"max-height","60vh"),V(e,"overflow","auto")},m(ae,we){$(ae,e,we),m(e,t),m(t,n),m(t,l),m(e,i),m(e,s),m(s,a),m(s,u),m(s,c),m(e,_),m(e,d),m(d,p),m(d,w),m(d,S),m(e,y),m(e,v),m(v,L),m(v,A),m(v,E),m(v,M),m(v,N),m(N,z),m(N,D);for(let fe=0;fe<U.length;fe+=1)U[fe]&&U[fe].m(N,null);m(v,O),m(v,R),m(v,H),m(v,q),m(q,X),m(q,se);for(let fe=0;fe<ge.length;fe+=1)ge[fe]&&ge[fe].m(q,null)},p(ae,we){if(we[0]&131088&&o!==(o=ae[17][ae[4]].toLocaleString()+"")&&ne(l,o),we[0]&131072&&f!==(f=ae[17].gradient+"")&&ne(u,f),we[0]&131072&&g!==(g=ae[17].quietness+"")&&ne(w,g),we[0]&131200){ce=Me(ae[7]);let fe;for(fe=0;fe<ce.length;fe+=1){const Pe=Ml(ae,ce,fe);U[fe]?U[fe].p(Pe,we):(U[fe]=zl(Pe),U[fe].c(),U[fe].m(N,null))}for(;fe<U.length;fe+=1)U[fe].d(1);U.length=ce.length}if(we[0]&131200){be=Me(ae[7]);let fe;for(fe=0;fe<be.length;fe+=1){const Pe=Cl(ae,be,fe);ge[fe]?ge[fe].p(Pe,we):(ge[fe]=Ol(Pe),ge[fe].c(),ge[fe].m(q,null))}for(;fe<ge.length;fe+=1)ge[fe].d(1);ge.length=be.length}},d(ae){ae&&k(e),ut(U,ae),ut(ge,ae)}}}function zd(r){let e,t;return e=new ht({props:{openOn:"click",$$slots:{default:[Nd,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o[0]&131088|o[1]&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Od(r){let e,t;const n=[$e("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Bl(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let o={$$slots:{default:[zd]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i[0]&112?He(n,[n[0],n[1],i[0]&80&&{paint:{"line-color":l[6],"line-width":Bl(["get",l[4]])}},i[0]&32&&{layout:{visibility:l[5]?"visible":"none"}},n[4]]):{};i[0]&16|i[1]&2&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Bd(r){let e,t,n,o,l;function i(a){r[15](a)}let s={label:"Route network",$$slots:{legend:[jd],help:[Ed]},$$scope:{ctx:r}};return r[5]!==void 0&&(s.show=r[5]),e=new Qt({props:s}),Te.push(()=>We(e,"show",i)),o=new rr({props:{url:`pmtiles://${$t("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[Od]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment)},m(a,f){P(e,a,f),$(a,n,f),P(o,a,f),l=!0},p(a,f){const u={};f[0]&15|f[1]&2&&(u.$$scope={dirty:f,ctx:a}),!t&&f[0]&32&&(t=!0,u.show=a[5],qe(()=>t=!1)),e.$set(u);const c={};f[0]&112|f[1]&2&&(c.$$scope={dirty:f,ctx:a}),o.$set(c)},i(a){l||(b(e.$$.fragment,a),b(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&k(n),I(e,a),I(o,a)}}}function Bl(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function Rd(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function Dd(r,e,t){let n,o,l=!1,i="all",s="bicycle_go_dutch",a="fastest",f="flow",u=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],c=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],_=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],d=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],p={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function g(){i=un(this),t(0,i),t(7,u)}function w(){s=un(this),t(1,s),t(8,c)}function S(){a=un(this),t(2,a),t(9,_)}function y(){f=un(this),t(3,f),t(10,d)}function v(L){l=L,t(5,l)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${i}_${a}_${s}`),r.$$.dirty[0]&24&&t(6,o={none:"#304ce7",flow:Rd(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:St(["abs",["get","gradient"]],p.limits,p.colorScale)}[f])},[i,s,a,f,n,l,o,u,c,_,d,g,w,S,y,v]}class Ud extends le{constructor(e){super(),ie(this,e,Dd,Bd,oe,{},null,[-1,-1])}}function Hd(r){let e;return{c(){e=h("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data © Crown copyright and database right 2025.</p>`,j(e,"slot","help")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Gd(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w,S,y,v,L,A,E,M;return L=new Ar({props:{colors:r[6],horiz:!0}}),{c(){e=h("div"),t=h("fieldset"),n=h("label"),o=h("input"),l=B(`
        Pedestrians`),i=T(),s=h("label"),a=h("input"),f=B(`
        Cyclists`),u=T(),c=h("fieldset"),_=h("label"),d=B(`From
        `),p=h("input"),g=T(),w=h("label"),S=B(`To
        `),y=h("input"),v=T(),F(L.$$.fragment),j(o,"type","checkbox"),j(o,"class","svelte-rvrx5w"),j(a,"type","checkbox"),j(a,"class","svelte-rvrx5w"),V(t,"display","flex"),V(t,"gap","3em"),j(t,"class","svelte-rvrx5w"),j(p,"type","number"),j(p,"min",2017),j(p,"max",2023),j(p,"class","svelte-rvrx5w"),j(y,"type","number"),j(y,"min",2017),j(y,"max",2023),j(y,"class","svelte-rvrx5w"),j(c,"class","year-filter svelte-rvrx5w"),j(e,"slot","legend")},m(N,z){$(N,e,z),m(e,t),m(t,n),m(n,o),o.checked=r[1].pedestrians,m(n,l),m(t,i),m(t,s),m(s,a),a.checked=r[1].cyclists,m(s,f),m(e,u),m(e,c),m(c,_),m(_,d),m(_,p),Oe(p,r[1].minYear),m(c,g),m(c,w),m(w,S),m(w,y),Oe(y,r[1].maxYear),m(e,v),P(L,e,null),A=!0,E||(M=[x(o,"change",r[7]),x(a,"change",r[8]),x(p,"input",r[9]),x(y,"input",r[10])],E=!0)},p(N,z){z&2&&(o.checked=N[1].pedestrians),z&2&&(a.checked=N[1].cyclists),z&2&&yn(p.value)!==N[1].minYear&&Oe(p,N[1].minYear),z&2&&yn(y.value)!==N[1].maxYear&&Oe(y,N[1].maxYear)},i(N){A||(b(L.$$.fragment,N),A=!0)},o(N){C(L.$$.fragment,N),A=!1},d(N){N&&k(e),I(L),E=!1,ft(M)}}}function Rl(r){let e,t,n,o=r[3][r[12].pedestrian_location]+"",l;return{c(){e=h("p"),t=B("Pedestrian location: "),n=h("b"),l=B(o)},m(i,s){$(i,e,s),m(e,t),m(e,n),m(n,l)},p(i,s){s&4096&&o!==(o=i[3][i[12].pedestrian_location]+"")&&ne(l,o)},d(i){i&&k(e)}}}function Dl(r){let e,t,n,o=r[4][r[12].pedestrian_movement]+"",l;return{c(){e=h("p"),t=B("Pedestrian movement: "),n=h("b"),l=B(o)},m(i,s){$(i,e,s),m(e,t),m(e,n),m(n,l)},p(i,s){s&4096&&o!==(o=i[4][i[12].pedestrian_movement]+"")&&ne(l,o)},d(i){i&&k(e)}}}function Wd(r){let e,t,n,o=r[12].year+"",l,i,s,a,f,u=r[5][r[12].severity]+"",c,_,d,p,g,w=Ul(r[12])+"",S,y,v,L,A,E=r[12].pedestrian_location&&Rl(r),M=r[12].pedestrian_movement&&Dl(r);return{c(){e=h("p"),t=B("Year: "),n=h("b"),l=B(o),i=T(),s=h("p"),a=B("Severity: "),f=h("b"),c=B(u),_=T(),d=h("p"),p=B("Casualties: "),g=h("b"),S=B(w),y=T(),E&&E.c(),v=T(),M&&M.c(),L=T(),A=h("p"),A.textContent="Click to open full report in CycleStreets"},m(N,z){$(N,e,z),m(e,t),m(e,n),m(n,l),$(N,i,z),$(N,s,z),m(s,a),m(s,f),m(f,c),$(N,_,z),$(N,d,z),m(d,p),m(d,g),m(g,S),$(N,y,z),E&&E.m(N,z),$(N,v,z),M&&M.m(N,z),$(N,L,z),$(N,A,z)},p(N,z){z&4096&&o!==(o=N[12].year+"")&&ne(l,o),z&4096&&u!==(u=N[5][N[12].severity]+"")&&ne(c,u),z&4096&&w!==(w=Ul(N[12])+"")&&ne(S,w),N[12].pedestrian_location?E?E.p(N,z):(E=Rl(N),E.c(),E.m(v.parentNode,v)):E&&(E.d(1),E=null),N[12].pedestrian_movement?M?M.p(N,z):(M=Dl(N),M.c(),M.m(L.parentNode,L)):M&&(M.d(1),M=null)},d(N){N&&(k(e),k(i),k(s),k(_),k(d),k(y),k(v),k(L),k(A)),E&&E.d(N),M&&M.d(N)}}}function qd(r){let e,t;return e=new ht({props:{$$slots:{default:[Wd,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&12288&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Jd(r){let e,t;const n=[$e("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":St(["get","severity"],[1,2,3],[lo,io,so]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let o={$$slots:{default:[qd]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new ln({props:o}),e.$on("click",Zd),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i&7?He(n,[n[0],n[1],i&0&&{paint:{"circle-color":St(["get","severity"],[1,2,3],[lo,io,so]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},i&6&&{filter:l[2](l[1])},i&1&&{layout:{visibility:l[0]?"visible":"none"}},n[5]]):{};i&8192&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Yd(r){let e,t,n,o,l;function i(a){r[11](a)}let s={label:"Collisions",$$slots:{legend:[Gd],help:[Hd]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new Qt({props:s}),Te.push(()=>We(e,"show",i)),o=new rr({props:{url:`pmtiles://${$t("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[Jd]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment)},m(a,f){P(e,a,f),$(a,n,f),P(o,a,f),l=!0},p(a,[f]){const u={};f&8194&&(u.$$scope={dirty:f,ctx:a}),!t&&f&1&&(t=!0,u.show=a[0],qe(()=>t=!1)),e.$set(u);const c={};f&8195&&(c.$$scope={dirty:f,ctx:a}),o.$set(c)},i(a){l||(b(e.$$.fragment,a),b(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&k(n),I(e,a),I(o,a)}}}let lo="#080C54",io="#1F9EB7",so="#CDE594";function Ul(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function Zd(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function Kd(r,e,t){let n=!1,o={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function l(g){let w=["any"];return o.pedestrians&&w.push(["get","pedestrian"]),o.cyclists&&w.push(["get","cyclist"]),["all",[">=",["get","year"],o.minYear],["<=",["get","year"],o.maxYear],w]}let i={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},a={1:"Fatal",2:"Serious",3:"Slight"},f={Fatal:lo,Serious:io,Slight:so};function u(){o.pedestrians=this.checked,t(1,o)}function c(){o.cyclists=this.checked,t(1,o)}function _(){o.minYear=yn(this.value),t(1,o)}function d(){o.maxYear=yn(this.value),t(1,o)}function p(g){n=g,t(0,n)}return[n,o,l,i,s,a,f,u,c,_,d,p]}class Xd extends le{constructor(e){super(),ie(this,e,Kd,Yd,oe,{})}}function Hl(r){let e;return{c(){e=B("Layers")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Vd(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w,S,y,v,L,A,E,M,N;o=new xf({props:{color:"#333"}});let z=r[0]&&Hl();return f=new dd({}),c=new Sd({}),d=new Id({}),g=new cc({}),S=new Qc({}),v=new Ud({}),A=new Xd({}),{c(){e=h("div"),t=h("button"),n=h("div"),F(o.$$.fragment),l=T(),z&&z.c(),s=T(),a=h("div"),F(f.$$.fragment),u=T(),F(c.$$.fragment),_=T(),F(d.$$.fragment),p=T(),F(g.$$.fragment),w=T(),F(S.$$.fragment),y=T(),F(v.$$.fragment),L=T(),F(A.$$.fragment),V(n,"display","flex"),V(n,"gap","12px"),V(n,"color","#333"),V(n,"align-items","center"),V(n,"justify-content","center"),j(t,"class",i="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1o5jpn"),j(t,"aria-label","Layers"),V(a,"flex-direction","column"),V(a,"display",r[0]?"flex":"none"),V(a,"background-color","#515f7A"),j(e,"class","pico contextual-layers svelte-1o5jpn"),V(e,"display","flex"),V(e,"flex-direction","column"),V(e,"max-height","80vh"),V(e,"overflow","auto"),V(e,"border-radius","5px"),V(e,"width",r[0]?"300px":"auto")},m(D,O){$(D,e,O),m(e,t),m(t,n),P(o,n,null),m(n,l),z&&z.m(n,null),m(e,s),m(e,a),P(f,a,null),m(a,u),P(c,a,null),m(a,_),P(d,a,null),m(a,p),P(g,a,null),m(a,w),P(S,a,null),m(a,y),P(v,a,null),m(a,L),P(A,a,null),E=!0,M||(N=x(t,"click",r[1]),M=!0)},p(D,O){D[0]?z||(z=Hl(),z.c(),z.m(n,null)):z&&(z.d(1),z=null),(!E||O&1&&i!==(i="show-layers-button icon-btn "+(D[0]?"expanded":"")+" svelte-1o5jpn"))&&j(t,"class",i),O&1&&V(a,"display",D[0]?"flex":"none"),O&1&&V(e,"width",D[0]?"300px":"auto")},i(D){E||(b(o.$$.fragment,D),b(f.$$.fragment,D),b(c.$$.fragment,D),b(d.$$.fragment,D),b(g.$$.fragment,D),b(S.$$.fragment,D),b(v.$$.fragment,D),b(A.$$.fragment,D),E=!0)},o(D){C(o.$$.fragment,D),C(f.$$.fragment,D),C(c.$$.fragment,D),C(d.$$.fragment,D),C(g.$$.fragment,D),C(S.$$.fragment,D),C(v.$$.fragment,D),C(A.$$.fragment,D),E=!1},d(D){D&&k(e),I(o),z&&z.d(),I(f),I(c),I(d),I(g),I(S),I(v),I(A),M=!1,N()}}}function Qd(r){let e,t;return e=new _u({props:{defaultStyling:!0,$$slots:{default:[Vd]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function xd(r,e,t){let n=!1;return[n,()=>t(0,n=!n)]}class e_ extends le{constructor(e){super(),ie(this,e,xd,Qd,oe,{})}}let G;const rn=new Array(128).fill(void 0);rn.push(void 0,null,!0,!1);function Le(r){return rn[r]}let qn=rn.length;function t_(r){r<132||(rn[r]=qn,qn=r)}function Qe(r){const e=Le(r);return t_(r),e}let wt=0,Bn=null;function Cn(){return(Bn===null||Bn.byteLength===0)&&(Bn=new Uint8Array(G.memory.buffer)),Bn}const hr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},n_=typeof hr.encodeInto=="function"?function(r,e){return hr.encodeInto(r,e)}:function(r,e){const t=hr.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ht(r,e,t){if(t===void 0){const s=hr.encode(r),a=e(s.length,1)>>>0;return Cn().subarray(a,a+s.length).set(s),wt=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=Cn();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=Cn().subarray(o+i,o+n),a=n_(r,s);i+=a.written}return wt=i,o}function Ln(r){return r==null}let Rn=null;function ee(){return(Rn===null||Rn.byteLength===0)&&(Rn=new Int32Array(G.memory.buffer)),Rn}let Dn=null;function $s(){return(Dn===null||Dn.byteLength===0)&&(Dn=new Float64Array(G.memory.buffer)),Dn}function Ze(r){qn===rn.length&&rn.push(rn.length+1);const e=qn;return qn=rn[e],rn[e]=r,e}const ks=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ks.decode();function st(r,e){return r=r>>>0,ks.decode(Cn().subarray(r,r+e))}let Un=null;function r_(){return(Un===null||Un.byteLength===0)&&(Un=new BigInt64Array(G.memory.buffer)),Un}function ao(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=ao(r[0]));for(let i=1;i<o;i++)l+=", "+ao(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Yr(r,e){const t=e(r.length*1,1)>>>0;return Cn().set(r,t/1),wt=r.length,t}function o_(r,e){return r=r>>>0,$s().subarray(r/8,r/8+e)}function l_(r,e){return r=r>>>0,Cn().subarray(r/1,r/1+e)}function bn(r,e){try{return r.apply(this,e)}catch(t){G.__wbindgen_exn_store(Ze(t))}}class i_{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();G.__wbg_ltn_free(e)}constructor(e,t,n,o,l){try{const c=G.__wbindgen_add_to_stack_pointer(-16),_=Yr(e,G.__wbindgen_malloc),d=wt,p=Yr(t,G.__wbindgen_malloc),g=wt,w=Yr(n,G.__wbindgen_malloc),S=wt;var i=Ln(l)?0:Ht(l,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_new(c,_,d,p,g,w,S,Ze(o),i,s);var a=ee()[c/4+0],f=ee()[c/4+1],u=ee()[c/4+2];if(u)throw Qe(f);return this.__wbg_ptr=a>>>0,this}finally{G.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getInvertedBoundary(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getBounds(){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getBounds(o,this.__wbg_ptr);var e=ee()[o/4+0],t=ee()[o/4+1],n=o_(e,t).slice();return G.__wbindgen_free(e,t*8,8),n}finally{G.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_toRouteSnapper(o,this.__wbg_ptr);var e=ee()[o/4+0],t=ee()[o/4+1],n=l_(e,t).slice();return G.__wbindgen_free(e,t*1,1),n}finally{G.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_toRouteSnapperGj(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_renderModalFilters(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_renderTurnRestrictions(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_renderNeighbourhood(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_renderAutoBoundaries(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Ht(e,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_setNeighbourhoodBoundary(l,this.__wbg_ptr,i,s,Ze(t));var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Qe(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Ht(e,G.__wbindgen_malloc,G.__wbindgen_realloc),n=wt;G.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Ht(e,G.__wbindgen_malloc,G.__wbindgen_realloc),o=wt,l=Ht(t,G.__wbindgen_malloc,G.__wbindgen_realloc),i=wt;G.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,o,l,i)}setCurrentNeighbourhood(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Ht(e,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_setCurrentNeighbourhood(l,this.__wbg_ptr,i,s,t);var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Qe(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Ht(t,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_addModalFilter(l,this.__wbg_ptr,Ze(e),i,s);var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Qe(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Ht(t,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_addManyModalFilters(l,this.__wbg_ptr,Ze(e),i,s);var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Qe(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){G.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_addDiagonalFilter(o,this.__wbg_ptr,e);var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Qe(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_rotateDiagonalFilter(o,this.__wbg_ptr,e);var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Qe(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_deleteDiagonalFilter(o,this.__wbg_ptr,e);var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Qe(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}toggleTravelFlow(e){G.ltn_toggleTravelFlow(this.__wbg_ptr,e)}undo(){G.ltn_undo(this.__wbg_ptr)}redo(){G.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getShortcutsCrossingRoad(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Qe(i);return t=a,n=f,st(a,f)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getAllShortcuts(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_toSavefile(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_loadSavefile(o,this.__wbg_ptr,Ze(e));var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Qe(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,o,l){let i,s;try{const p=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_compareRoute(p,this.__wbg_ptr,e,t,n,o,l);var a=ee()[p/4+0],f=ee()[p/4+1],u=ee()[p/4+2],c=ee()[p/4+3],_=a,d=f;if(c)throw _=0,d=0,Qe(u);return i=_,s=d,st(_,d)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(i,s,1)}}impactToOneDestination(e,t){let n,o;try{const c=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_impactToOneDestination(c,this.__wbg_ptr,e,t);var l=ee()[c/4+0],i=ee()[c/4+1],s=ee()[c/4+2],a=ee()[c/4+3],f=l,u=i;if(a)throw f=0,u=0,Qe(s);return n=f,o=u,st(f,u)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(n,o,1)}}predictImpact(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_predictImpact(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getImpactsOnRoad(e){let t,n;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getImpactsOnRoad(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Qe(i);return t=a,n=f,st(a,f)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}getAllNeighbourhoods(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getAllNeighbourhoods(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getAllIntersections(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getMovements(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Qe(i);return t=a,n=f,st(a,f)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getDemandModel(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Qe(l);return e=s,t=a,st(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}}async function s_(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function a_(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Qe(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=Le(t),o=typeof n=="string"?n:void 0;var l=Ln(o)?0:Ht(o,G.__wbindgen_malloc,G.__wbindgen_realloc),i=wt;ee()[e/4+1]=i,ee()[e/4+0]=l},r.wbg.__wbindgen_boolean_get=function(e){const t=Le(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Le(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=Le(t),o=typeof n=="number"?n:void 0;$s()[e/8+1]=Ln(o)?0:o,ee()[e/4+0]=!Ln(o)},r.wbg.__wbindgen_is_object=function(e){const t=Le(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return Le(e)in Le(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Ze(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return Le(e)===Le(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Ze(t)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(st(e,t));return Ze(n)},r.wbg.__wbindgen_is_undefined=function(e){return Le(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=st(e,t);return Ze(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Le(e)==Le(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Le(e);return Ze(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=Le(e)[Le(t)];return Ze(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Le(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Le(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Le(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Le(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Le(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Ze(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Le(t).stack,o=Ht(n,G.__wbindgen_malloc,G.__wbindgen_realloc),l=wt;ee()[e/4+1]=l,ee()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(st(e,t))}finally{G.__wbindgen_free(n,o,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=Le(e).performance;return Ze(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Le(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=Le(e)[t>>>0];return Ze(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Le(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Le(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(st(e,t));return Ze(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=Le(e).next;return Ze(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return bn(function(e){const t=Le(e).next();return Ze(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Le(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=Le(e).value;return Ze(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Ze(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return bn(function(e,t){const n=Reflect.get(Le(e),Le(t));return Ze(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return bn(function(e,t){const n=Le(e).call(Le(t));return Ze(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return bn(function(){const e=self.self;return Ze(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return bn(function(){const e=window.window;return Ze(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return bn(function(){const e=globalThis.globalThis;return Ze(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return bn(function(){const e=global.global;return Ze(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Le(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=Le(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Le(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(Le(e));return Ze(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=Le(e).buffer;return Ze(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(Le(e));return Ze(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){Le(e).set(Le(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Le(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=Le(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=Le(t),o=typeof n=="bigint"?n:void 0;r_()[e/8+1]=Ln(o)?BigInt(0):o,ee()[e/4+0]=!Ln(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=ao(Le(t)),o=Ht(n,G.__wbindgen_malloc,G.__wbindgen_realloc),l=wt;ee()[e/4+1]=l,ee()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(st(e,t))},r.wbg.__wbindgen_memory=function(){const e=G.memory;return Ze(e)},r}function f_(r,e){return G=r.exports,Ss.__wbindgen_wasm_module=e,Un=null,Dn=null,Rn=null,Bn=null,G}async function Ss(r){if(G!==void 0)return G;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=a_();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await s_(await r,e);return f_(t,n)}const u_=r=>({}),Gl=r=>({}),c_=r=>({}),Wl=r=>({}),d_=r=>({}),ql=r=>({});function __(r){let e,t,n,o,l,i,s,a;const f=r[1].top,u=Be(f,r,r[0],ql),c=r[1].left,_=Be(c,r,r[0],Wl),d=r[1].main,p=Be(d,r,r[0],Gl);return{c(){e=h("div"),t=h("div"),u&&u.c(),n=T(),o=h("div"),l=h("div"),_&&_.c(),i=T(),s=h("div"),p&&p.c(),j(t,"class","top svelte-29q570"),j(l,"class","left svelte-29q570"),j(s,"class","main svelte-29q570"),j(o,"class","content svelte-29q570"),j(e,"class","flex-container svelte-29q570")},m(g,w){$(g,e,w),m(e,t),u&&u.m(t,null),m(e,n),m(e,o),m(o,l),_&&_.m(l,null),m(o,i),m(o,s),p&&p.m(s,null),a=!0},p(g,[w]){u&&u.p&&(!a||w&1)&&Re(u,f,g,g[0],a?Ue(f,g[0],w,d_):De(g[0]),ql),_&&_.p&&(!a||w&1)&&Re(_,c,g,g[0],a?Ue(c,g[0],w,c_):De(g[0]),Wl),p&&p.p&&(!a||w&1)&&Re(p,d,g,g[0],a?Ue(d,g[0],w,u_):De(g[0]),Gl)},i(g){a||(b(u,g),b(_,g),b(p,g),a=!0)},o(g){C(u,g),C(_,g),C(p,g),a=!1},d(g){g&&k(e),u&&u.d(g),_&&_.d(g),p&&p.d(g)}}}function p_(r,e,t){let{$$slots:n={},$$scope:o}=e;return r.$$set=l=>{"$$scope"in l&&t(0,o=l.$$scope)},[o,n]}class m_ extends le{constructor(e){super(),ie(this,e,p_,__,oe,{})}}const g_=r=>({}),Jl=r=>({}),h_=r=>({}),Yl=r=>({}),b_=r=>({}),Zl=r=>({});function w_(r){let e,t,n,o,l,i;const s=r[4].top,a=Be(s,r,r[3],Zl),f=r[4].sidebar,u=Be(f,r,r[3],Yl),c=r[4].map,_=Be(c,r,r[3],Jl);return{c(){e=h("div"),a&&a.c(),t=T(),n=h("div"),u&&u.c(),o=T(),l=h("div"),_&&_.c()},m(d,p){$(d,e,p),a&&a.m(e,null),r[5](e),$(d,t,p),$(d,n,p),u&&u.m(n,null),r[6](n),$(d,o,p),$(d,l,p),_&&_.m(l,null),r[7](l),i=!0},p(d,[p]){a&&a.p&&(!i||p&8)&&Re(a,s,d,d[3],i?Ue(s,d[3],p,b_):De(d[3]),Zl),u&&u.p&&(!i||p&8)&&Re(u,f,d,d[3],i?Ue(f,d[3],p,h_):De(d[3]),Yl),_&&_.p&&(!i||p&8)&&Re(_,c,d,d[3],i?Ue(c,d[3],p,g_):De(d[3]),Jl)},i(d){i||(b(a,d),b(u,d),b(_,d),i=!0)},o(d){C(a,d),C(u,d),C(_,d),i=!1},d(d){d&&(k(e),k(t),k(n),k(o),k(l)),a&&a.d(d),r[5](null),u&&u.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function y_(r,e,t){let n,o,l;Z(r,fo,c=>t(0,n=c)),Z(r,uo,c=>t(1,o=c)),Z(r,co,c=>t(2,l=c));let{$$slots:i={},$$scope:s}=e;function a(c){Te[c?"unshift":"push"](()=>{n=c,fo.set(n)})}function f(c){Te[c?"unshift":"push"](()=>{o=c,uo.set(o)})}function u(c){Te[c?"unshift":"push"](()=>{l=c,co.set(l)})}return r.$$set=c=>{"$$scope"in c&&t(3,s=c.$$scope)},[n,o,l,s,i,a,f,u]}class Ft extends le{constructor(e){super(),ie(this,e,y_,w_,oe,{})}}let fo=Mt(null),uo=Mt(null),co=Mt(null);function v_(r){let e;return{c(){e=B("Back")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function $_(r){let e,t,n,o;return e=new Ce({props:{$$slots:{default:[v_]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0,n||(o=x(window,"keydown",r[1]),n=!0)},p(l,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l),n=!1,o()}}}function k_(r){let e=pn();function t(o){o.key=="Escape"&&(o.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class gn extends le{constructor(e){super(),ie(this,e,k_,$_,oe,{})}}function _o(r,e,t){let n=new Set(r.toSavefile().features.filter(o=>o.properties.kind=="boundary").map(o=>o.properties.name));for(;;){let o=window.prompt(e,t);if(!o)return null;if(n.has(o))window.alert(`There is already a neighbourhood called ${o}; please pick another name`);else return o}}function S_(r){let e,t;return e=new mn({props:{colorScale:Ao,limits:To}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function L_(r){let e,t;return e=new mn({props:{colorScale:on,limits:Mo}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function C_(r){let e,t;return e=new mn({props:{colorScale:on,limits:or}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function M_(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g;const w=[C_,L_,S_],S=[];function y(v,L){return v[0]=="simd"?0:v[0]=="area"?1:v[0]=="stats19"?2:-1}return~(u=y(r))&&(c=S[u]=w[u](r)),{c(){e=h("div"),t=h("label"),t.textContent="Metric",n=T(),o=h("select"),l=h("option"),l.textContent="None",i=h("option"),i.textContent="Area (km²)",s=h("option"),s.textContent="Fake SIMD (percentile)",a=h("option"),a.textContent="Collisions",f=T(),c&&c.c(),_=Je(),j(t,"for","prioritization-selection"),l.__value="none",Oe(l,l.__value),i.__value="area",Oe(i,i.__value),s.__value="simd",Oe(s,s.__value),a.__value="stats19",Oe(a,a.__value),j(o,"id","prioritization-selection"),r[0]===void 0&&fn(()=>r[1].call(o)),V(e,"display","flex"),V(e,"gap","16px"),V(e,"align-items","center")},m(v,L){$(v,e,L),m(e,t),m(e,n),m(e,o),m(o,l),m(o,i),m(o,s),m(o,a),vt(o,r[0],!0),$(v,f,L),~u&&S[u].m(v,L),$(v,_,L),d=!0,p||(g=x(o,"change",r[1]),p=!0)},p(v,[L]){L&1&&vt(o,v[0]);let A=u;u=y(v),u!==A&&(c&&(ye(),C(S[A],1,1,()=>{S[A]=null}),ve()),~u?(c=S[u],c||(c=S[u]=w[u](v),c.c()),b(c,1),c.m(_.parentNode,_)):c=null)},i(v){d||(b(c),d=!0)},o(v){C(c),d=!1},d(v){v&&(k(e),k(f),k(_)),~u&&S[u].d(v),p=!1,g()}}}function T_(r,e,t){let n;Z(r,Zt,s=>t(2,n=s));let{selectedPrioritization:o}=e;function l(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="area"?t(0,o="area"):s=="simd"?t(0,o="simd"):s=="stats19"&&t(0,o="stats19")}n.startsWith("ltn_cnt/")?l():o="none";function i(){o=un(this),t(0,o)}return r.$$set=s=>{"selectedPrioritization"in s&&t(0,o=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);o=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",o),history.replaceState({},"",s)}},[o,i]}class Ls extends le{constructor(e){super(),ie(this,e,T_,M_,oe,{selectedPrioritization:0})}}function A_(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function F_(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function P_(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[A_]},$$scope:{ctx:r}}}),l.$on("click",r[14]),a=new Ce({props:{$$slots:{default:[F_]},$$scope:{ctx:r}}}),a.$on("click",r[15]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),u.textContent="Use an auto-generated boundary",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(_,d){$(_,e,d),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),c=!0},p(_,d){const p={};d&524288&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&524288&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),I(l),I(a)}}}function Kl(r){let e,t,n,o,l,i,s;function a(u){r[11](u)}let f={};return r[2]!==void 0&&(f.selectedPrioritization=r[2]),l=new Ls({props:f}),Te.push(()=>We(l,"selectedPrioritization",a)),{c(){e=h("h3"),e.textContent="Prioritization",t=T(),n=h("p"),n.textContent="Compare metrics across candidate neighbourhoods.",o=T(),F(l.$$.fragment)},m(u,c){$(u,e,c),$(u,t,c),$(u,n,c),$(u,o,c),P(l,u,c),s=!0},p(u,c){const _={};!i&&c&4&&(i=!0,_.selectedPrioritization=u[2],qe(()=>i=!1)),l.$set(_)},i(u){s||(b(l.$$.fragment,u),s=!0)},o(u){C(l.$$.fragment,u),s=!1},d(u){u&&(k(e),k(t),k(n),k(o)),I(l,u)}}}function Xl(r){let e;return{c(){e=h("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function I_(r){let e,t,n,o,l,i=r[4].startsWith("ltn_cnt/"),s,a,f,u,c,_,d,p,g,w,S,y,v,L;t=new gn({}),t.$on("click",r[10]);let A=i&&Kl(r),E=r[2]=="none"&&Xl();return{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent=`Click an area to use it as the boundary for your neighbourhood. These
      particular boundaries are suggested by finding roads, railways, and water
      that form severances.`,l=T(),A&&A.c(),s=T(),E&&E.c(),a=T(),f=h("button"),f.textContent="Export to GeoJSON",u=T(),c=h("label"),_=B(`Minimum area (km²)
      `),d=h("input"),p=T(),g=h("label"),w=h("input"),S=B(`
      Remove areas not touching a big road`),j(f,"class","secondary"),j(d,"type","number"),j(d,"min","0"),j(d,"max","1"),j(d,"step","0.01"),j(w,"type","checkbox"),j(e,"slot","sidebar")},m(M,N){$(M,e,N),P(t,e,null),m(e,n),m(e,o),m(e,l),A&&A.m(e,null),m(e,s),E&&E.m(e,null),m(e,a),m(e,f),m(e,u),m(e,c),m(c,_),m(c,d),Oe(d,r[0]),m(e,p),m(e,g),m(g,w),w.checked=r[1],m(g,S),y=!0,v||(L=[x(f,"click",r[7]),x(d,"input",r[12]),x(w,"change",r[13])],v=!0)},p(M,N){N&16&&(i=M[4].startsWith("ltn_cnt/")),i?A?(A.p(M,N),N&16&&b(A,1)):(A=Kl(M),A.c(),b(A,1),A.m(e,s)):A&&(ye(),C(A,1,1,()=>{A=null}),ve()),M[2]=="none"?E||(E=Xl(),E.c(),E.m(e,a)):E&&(E.d(1),E=null),N&1&&yn(d.value)!==M[0]&&Oe(d,M[0]),N&2&&(w.checked=M[1])},i(M){y||(b(t.$$.fragment,M),b(A),y=!0)},o(M){C(t.$$.fragment,M),C(A),y=!1},d(M){M&&k(e),I(t),A&&A.d(),E&&E.d(),v=!1,ft(L)}}}function E_(r){let e,t,n=(r[18].number_stats19_collisions/r[18].area_km2).toFixed(1)+"",o;return{c(){e=h("b"),e.textContent=`Density of pedestrian and cyclist collisions (collisions per
              square meter):`,t=T(),o=B(n)},m(l,i){$(l,e,i),$(l,t,i),$(l,o,i)},p(l,i){i&262144&&n!==(n=(l[18].number_stats19_collisions/l[18].area_km2).toFixed(1)+"")&&ne(o,n)},d(l){l&&(k(e),k(t),k(o))}}}function j_(r){let e,t,n=r[18].simd.toFixed(1)+"",o;return{c(){e=h("b"),e.textContent="Fake SIMD:",t=T(),o=B(n)},m(l,i){$(l,e,i),$(l,t,i),$(l,o,i)},p(l,i){i&262144&&n!==(n=l[18].simd.toFixed(1)+"")&&ne(o,n)},d(l){l&&(k(e),k(t),k(o))}}}function N_(r){let e,t,n=r[18].area_km2.toFixed(1)+"",o,l;return{c(){e=h("b"),e.textContent="Area:",t=T(),o=B(n),l=B(" km²")},m(i,s){$(i,e,s),$(i,t,s),$(i,o,s),$(i,l,s)},p(i,s){s&262144&&n!==(n=i[18].area_km2.toFixed(1)+"")&&ne(o,n)},d(i){i&&(k(e),k(t),k(o),k(l))}}}function z_(r){let e;function t(l,i){if(l[2]=="none"||l[2]=="area")return N_;if(l[2]=="simd")return j_;if(l[2]=="stats19")return E_}let n=t(r),o=n&&n(r);return{c(){o&&o.c(),e=Je()},m(l,i){o&&o.m(l,i),$(l,e,i)},p(l,i){n===(n=t(l))&&o?o.p(l,i):(o&&o.d(1),o=n&&n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&k(e),o&&o.d(l)}}}function O_(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[z_,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&786436&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function B_(r){let e,t,n,o;const l=[$e("neighbourhood-boundaries",!1),{filter:cr(r[0],r[1])},{paint:{"fill-color":r[8](r[2]),"fill-opacity":r[9](r[2])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[O_]},$$scope:{ctx:r}};for(let f=0;f<l.length;f+=1)i=de(i,l[f]);e=new At({props:i}),e.$on("click",r[6]);const s=[$e("neighbourhood-boundaries-outline",!1),{filter:cr(r[0],r[1])},{paint:{"line-color":"black","line-width":1}}];let a={};for(let f=0;f<s.length;f+=1)a=de(a,s[f]);return n=new nt({props:a}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),o=!0},p(f,u){const c=u&775?He(l,[l[0],u&3&&{filter:cr(f[0],f[1])},u&772&&{paint:{"fill-color":f[8](f[2]),"fill-opacity":f[9](f[2])}},l[3],l[4]]):{};u&524292&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _=u&3?He(s,[s[0],{filter:cr(f[0],f[1])},s[2]]):{};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),o=!1},d(f){f&&k(t),I(e,f),I(n,f)}}}function R_(r){let e,t,n;return t=new Ve({props:{data:r[5],generateId:!0,$$slots:{default:[B_]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","map")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p(o,l){const i={};l&524295&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function D_(r){let e,t;return e=new Ft({props:{$$slots:{map:[R_],sidebar:[I_],top:[P_]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&524319&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function cr(r,e){let t=["all",[">=",["get","area_km2"],r]];return e&&t.push(["get","touches_big_road"]),t}function U_(r,e,t){let n,o,l,i;Z(r,ue,A=>t(3,n=A)),Z(r,Jn,A=>t(16,o=A)),Z(r,tt,A=>t(17,l=A)),Z(r,Zt,A=>t(4,i=A));let s=l.renderAutoBoundaries(),a=0,f=!0,u="none";function c(A){let E=_o(l,"What do you want to name the neighbourhood?","");if(E)try{let M={type:"Feature",properties:{},geometry:s.features[A.detail.features[0].id].geometry};l.setNeighbourhoodBoundary(E,M),Mn(),l.setCurrentNeighbourhood(E,o),te(ue,n={mode:"neighbourhood"},n)}catch(M){console.log("error when setting auto-generated neighborhood",M),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working.")}}function _(){kr("auto_boundaries.geojson",JSON.stringify(s,null,"  "))}function d(A){return{none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],simd:St(["get","simd"],or,on),area:St(["get","area_km2"],Mo,on),stats19:St(["/",["get","number_stats19_collisions"],["get","area_km2"]],To,Ao)}[A]}function p(A){return{none:ot(.3,.5),simd:ot(.7,.9),area:ot(.7,.9),stats19:ot(.7,.9)}[A]}const g=()=>te(ue,n={mode:"pick-neighbourhood"},n);function w(A){u=A,t(2,u)}function S(){a=yn(this.value),t(0,a)}function y(){f=this.checked,t(1,f)}return[a,f,u,n,i,s,c,_,d,p,g,w,S,y,()=>te(ue,n={mode:"title",firstLoad:!1},n),()=>te(ue,n={mode:"pick-neighbourhood"},n)]}class H_ extends le{constructor(e){super(),ie(this,e,U_,D_,oe,{})}}function G_(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function W_(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function q_(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[G_]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Ce({props:{$$slots:{default:[W_]},$$scope:{ctx:r}}}),a.$on("click",r[12]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),u.textContent="Debug demand model",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(_,d){$(_,e,d),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),c=!0},p(_,d){const p={};d&65536&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&65536&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),I(l),I(a)}}}function J_(r){let e;return{c(){e=h("p"),e.textContent="Hover on a zone"},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Y_(r){let e,t=r[6].properties.name+"",n,o,l,i,s=r[6].properties.sum_from.toLocaleString()+"",a,f,u,c,_=r[6].properties.sum_to.toLocaleString()+"",d,p,g,w,S=r[6].properties.counts_from[r[3]]+"",y;return{c(){e=h("u"),n=B(t),o=T(),l=h("p"),i=B("Total trips from here: "),a=B(s),f=T(),u=h("p"),c=B("Total trips to here: "),d=B(_),p=T(),g=h("p"),w=B("Total intra-zonal trips starting and ending here: "),y=B(S)},m(v,L){$(v,e,L),m(e,n),$(v,o,L),$(v,l,L),m(l,i),m(l,a),$(v,f,L),$(v,u,L),m(u,c),m(u,d),$(v,p,L),$(v,g,L),m(g,w),m(g,y)},p(v,L){L&64&&t!==(t=v[6].properties.name+"")&&ne(n,t),L&64&&s!==(s=v[6].properties.sum_from.toLocaleString()+"")&&ne(a,s),L&64&&_!==(_=v[6].properties.sum_to.toLocaleString()+"")&&ne(d,_),L&72&&S!==(S=v[6].properties.counts_from[v[3]]+"")&&ne(y,S)},d(v){v&&(k(e),k(o),k(l),k(f),k(u),k(p),k(g))}}}function Z_(r){let e,t,n,o,l=r[0].features.length.toLocaleString()+"",i,s,a,f,u,c,_,d,p,g,w=r[1]?"from":"to",S,y,v=r[3]==null?"each zone":"this zone",L,A,E,M,N,z,D,O,R,H;t=new gn({}),t.$on("click",r[9]),M=new mn({props:{colorScale:Wn,limits:r[5]}});function q(ce,U){return ce[6]&&ce[3]!=null?Y_:J_}let X=q(r),se=X(r);return{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),i=B(l),s=B(" zones"),a=T(),f=h("label"),u=B(`Trips from
      `),c=h("input"),_=B(`
      Trips to`),d=T(),p=h("p"),g=B("Trips "),S=B(w),y=T(),L=B(v),A=B(":"),E=T(),F(M.$$.fragment),N=T(),z=h("hr"),D=T(),se.c(),j(c,"type","checkbox"),j(c,"role","switch"),j(e,"slot","sidebar")},m(ce,U){$(ce,e,U),P(t,e,null),m(e,n),m(e,o),m(o,i),m(o,s),m(e,a),m(e,f),m(f,u),m(f,c),c.checked=r[1],m(f,_),m(e,d),m(e,p),m(p,g),m(p,S),m(p,y),m(p,L),m(p,A),m(e,E),P(M,e,null),m(e,N),m(e,z),m(e,D),se.m(e,null),O=!0,R||(H=x(c,"change",r[10]),R=!0)},p(ce,U){(!O||U&1)&&l!==(l=ce[0].features.length.toLocaleString()+"")&&ne(i,l),U&2&&(c.checked=ce[1]),(!O||U&2)&&w!==(w=ce[1]?"from":"to")&&ne(S,w),(!O||U&8)&&v!==(v=ce[3]==null?"each zone":"this zone")&&ne(L,v);const be={};U&32&&(be.limits=ce[5]),M.$set(be),X===(X=q(ce))&&se?se.p(ce,U):(se.d(1),se=X(ce),se&&(se.c(),se.m(e,null)))},i(ce){O||(b(t.$$.fragment,ce),b(M.$$.fragment,ce),O=!0)},o(ce){C(t.$$.fragment,ce),C(M.$$.fragment,ce),O=!1},d(ce){ce&&k(e),I(t),I(M),se.d(),R=!1,H()}}}function K_(r){let e,t,n,o,l;const i=[$e("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":ot(.5,.1)}},{manageHoverState:!0}];function s(c){r[8](c)}let a={};for(let c=0;c<i.length;c+=1)a=de(a,i[c]);r[2]!==void 0&&(a.hovered=r[2]),e=new At({props:a}),Te.push(()=>We(e,"hovered",s));const f=[$e("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let u={};for(let c=0;c<f.length;c+=1)u=de(u,f[c]);return o=new nt({props:u}),{c(){F(e.$$.fragment),n=T(),F(o.$$.fragment)},m(c,_){P(e,c,_),$(c,n,_),P(o,c,_),l=!0},p(c,_){const d=_&16?He(i,[i[0],{paint:{"fill-color":c[4],"fill-opacity":ot(.5,.1)}},i[2]]):{};!t&&_&4&&(t=!0,d.hovered=c[2],qe(()=>t=!1)),e.$set(d);const p={};o.$set(p)},i(c){l||(b(e.$$.fragment,c),b(o.$$.fragment,c),l=!0)},o(c){C(e.$$.fragment,c),C(o.$$.fragment,c),l=!1},d(c){c&&k(n),I(e,c),I(o,c)}}}function X_(r){let e,t,n;return t=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[K_]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","map")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p(o,l){const i={};l&1&&(i.data=o[0]),l&65556&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function V_(r){let e,t;return e=new Ft({props:{$$slots:{map:[X_],sidebar:[Z_],top:[q_]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&65791&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Q_(r,e,t){let n,o,l,i,s,a;Z(r,ue,v=>t(7,s=v)),Z(r,tt,v=>t(13,a=v));let f=Yt();try{f=a.getDemandModel()}catch{window.alert("No demand model for this area"),te(ue,s={mode:"pick-neighbourhood"},s)}let u=!1,c=null;function _(v,L){if(v==null){let A=L?"sum_to":"sum_from",E=Math.max(...f.features.map(N=>N.properties[A])),M=d(E);return[M.map(N=>N.toLocaleString()),St(["get",A],M,Wn)]}else{let A=L?"counts_to":"counts_from",E=[...f.features.map(z=>z.properties[A][v])],M=Math.max(...E),N=d(M);return[N.map(z=>z.toLocaleString()),St(["at",["id"],["literal",E]],N,Wn)]}}function d(v){let L=Wn.length+1;return Array.from(Array(L).keys()).map(A=>Math.round(v/(L-1)*A))}function p(v){c=v,t(2,c)}const g=()=>te(ue,s={mode:"pick-neighbourhood"},s);function w(){u=this.checked,t(1,u)}const S=()=>te(ue,s={mode:"title",firstLoad:!1},s),y=()=>te(ue,s={mode:"pick-neighbourhood"},s);return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=c==null?null:c.id),r.$$.dirty&9&&t(6,o=n!=null?f.features[n]:null),r.$$.dirty&10&&t(5,[l,i]=_(n,u),l,(t(4,i),t(3,n),t(1,u),t(2,c)))},[f,u,c,n,i,l,o,s,p,g,w,S,y]}class x_ extends le{constructor(e){super(),ie(this,e,Q_,V_,oe,{})}}function ep(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function tp(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function np(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[ep]},$$scope:{ctx:r}}}),l.$on("click",r[9]),a=new Ce({props:{$$slots:{default:[tp]},$$scope:{ctx:r}}}),a.$on("click",r[10]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),u.textContent="Debug intersections",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(_,d){$(_,e,d),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),c=!0},p(_,d){const p={};d&2048&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&2048&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),I(l),I(a)}}}function Vl(r){let e,t,n,o,l,i,s;function a(u){r[8](u)}let f={list:r[1].features};return r[2]!==void 0&&(f.idx=r[2]),n=new Er({props:f}),Te.push(()=>We(n,"idx",a)),{c(){e=h("button"),e.textContent="Pick another intersection",t=T(),F(n.$$.fragment),j(e,"class","secondary")},m(u,c){$(u,e,c),$(u,t,c),P(n,u,c),l=!0,i||(s=x(e,"click",r[7]),i=!0)},p(u,c){const _={};c&2&&(_.list=u[1].features),!o&&c&4&&(o=!0,_.idx=u[2],qe(()=>o=!1)),n.$set(_)},i(u){l||(b(n.$$.fragment,u),l=!0)},o(u){C(n.$$.fragment,u),l=!1},d(u){u&&(k(e),k(t)),I(n,u),i=!1,s()}}}function Ql(r){let e,t;return{c(){e=h("a"),t=B("Open OSM"),j(e,"href",r[0]),j(e,"target","_blank")},m(n,o){$(n,e,o),m(e,t)},p(n,o){o&1&&j(e,"href",n[0])},d(n){n&&k(e)}}}function rp(r){let e,t,n,o,l,i,s;t=new gn({}),t.$on("click",r[6]);let a=r[1].features.length>0&&Vl(r),f=r[0]&&Ql(r);return{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent="Purple intersections have some kind of turn restriction.",l=T(),a&&a.c(),i=T(),f&&f.c(),j(e,"slot","sidebar")},m(u,c){$(u,e,c),P(t,e,null),m(e,n),m(e,o),m(e,l),a&&a.m(e,null),m(e,i),f&&f.m(e,null),s=!0},p(u,c){u[1].features.length>0?a?(a.p(u,c),c&2&&b(a,1)):(a=Vl(u),a.c(),b(a,1),a.m(e,i)):a&&(ye(),C(a,1,1,()=>{a=null}),ve()),u[0]?f?f.p(u,c):(f=Ql(u),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i(u){s||(b(t.$$.fragment,u),b(a),s=!0)},o(u){C(t.$$.fragment,u),C(a),s=!1},d(u){u&&k(e),I(t),a&&a.d(),f&&f.d()}}}function op(r){let e,t;const n=[$e("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new ln({props:o}),e.$on("click",r[5]),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function lp(r){let e,t,n,o;const l=[$e("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<l.length;f+=1)i=de(i,l[f]);e=new nt({props:i});const s=[$e("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=de(a,s[f]);return n=new At({props:a}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),o=!0},p(f,u){const c={};e.$set(c);const _=u&4?He(s,[s[0],{filter:["==",["id"],f[2]]},s[2]]):{};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),o=!1},d(f){f&&k(t),I(e,f),I(n,f)}}}function ip(r){let e,t,n,o,l;return t=new Ve({props:{data:ct(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[op]},$$scope:{ctx:r}}}),o=new Ve({props:{data:r[1],generateId:!0,$$slots:{default:[lp]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),j(e,"slot","map")},m(i,s){$(i,e,s),P(t,e,null),m(e,n),P(o,e,null),l=!0},p(i,s){const a={};s&8&&(a.data=ct(i[3]).getAllIntersections()),s&2048&&(a.$$scope={dirty:s,ctx:i}),t.$set(a);const f={};s&2&&(f.data=i[1]),s&2052&&(f.$$scope={dirty:s,ctx:i}),o.$set(f)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&k(e),I(t),I(o)}}}function sp(r){let e,t;return e=new Ft({props:{$$slots:{map:[ip],sidebar:[rp],top:[np]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&2079&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function ap(r,e,t){let n,o;Z(r,tt,p=>t(3,n=p)),Z(r,ue,p=>t(4,o=p));let l=null,i=Yt(),s=0;function a(p){t(0,l=p.detail.features[0].properties.osm),t(1,i=n.getMovements(p.detail.features[0].id)),t(2,s=0)}const f=()=>te(ue,o={mode:"pick-neighbourhood"},o),u=()=>t(1,i=Yt());function c(p){s=p,t(2,s)}return[l,i,s,n,o,a,f,u,c,()=>te(ue,o={mode:"title",firstLoad:!1},o),()=>te(ue,o={mode:"pick-neighbourhood"},o)]}class fp extends le{constructor(e){super(),ie(this,e,ap,sp,oe,{})}}function up(r){let e,t,n,o,l,i;const s=[$e("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=de(a,s[d]);e=new At({props:a});const f=[$e("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let u={};for(let d=0;d<f.length;d+=1)u=de(u,f[d]);n=new At({props:u});const c=[$e("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return l=new nt({props:_}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment)},m(d,p){P(e,d,p),$(d,t,p),P(n,d,p),$(d,o,p),P(l,d,p),i=!0},p(d,[p]){const g=p&1?He(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const w={};n.$set(w);const S={};l.$set(S)},i(d){i||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),i=!1},d(d){d&&(k(t),k(o)),I(e,d),I(n,d),I(l,d)}}}function cp(r,e,t){let n;return Z(r,$r,o=>t(0,n=o)),[n]}class jr extends le{constructor(e){super(),ie(this,e,cp,up,oe,{})}}function dp(r){let e,t;const n=[$e("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new At({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}class Nr extends le{constructor(e){super(),ie(this,e,null,dp,oe,{})}}const _p=r=>({}),xl=r=>({});function ei(r){let e;const t=r[7]["line-popup"],n=Be(t,r,r[9],xl);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&512)&&Re(n,t,o,o[9],e?Ue(t,o[9],l,_p):De(o[9]),xl)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function pp(r){let e,t,n=r[0]&&ei(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=ei(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function mp(r){let e,t,n,o;const l=[$e("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let f=0;f<l.length;f+=1)i=de(i,l[f]);e=new nt({props:i});const s=[$e("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":ot(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[pp]},$$scope:{ctx:r}};for(let f=0;f<s.length;f+=1)a=de(a,s[f]);return n=new nt({props:a}),n.$on("click",r[8]),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),o=!0},p(f,[u]){const c=u&84?He(l,[l[0],l[1],{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=u&125?He(s,[s[0],s[1],u&124&&{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":f[5](f[3],f[4].maxShortcuts),"line-opacity":ot(1,.5)}},u&1&&{manageHoverState:f[0]},u&1&&{hoverCursor:f[0]?"pointer":void 0}]):{};u&513&&(_.$$scope={dirty:u,ctx:f}),n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),o=!1},d(f){f&&k(t),I(e,f),I(n,f)}}}function gp(r,e,t){let n,o;Z(r,Qr,d=>t(2,n=d)),Z(r,$r,d=>t(3,o=d));let{$$slots:l={},$$scope:i}=e,s=wo("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:f=(d,p)=>{}}=e;function u(d,p){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?St(["get","speed_mph"],vs,ys):p<=2?ot("white","blue"):ot(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",p,"#A32015"],wn.mapFeature.hover.backgroundColor)}function c(d,p,g){return!d||p<=2?an(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,p,25+g]}const _=d=>a&&f(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&t(0,a=d.interactive),"onClickLine"in d&&t(1,f=d.onClickLine),"$$scope"in d&&t(9,i=d.$$scope)},[a,f,n,o,s,u,c,l,_,i]}class lr extends le{constructor(e){super(),ie(this,e,gp,mp,oe,{interactive:0,onClickLine:1})}}function hp(r){let e,t,n;const o=[$e("turn-restrictions"),{minzoom:13},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function l(s){r[5](s)}let i={};for(let s=0;s<o.length;s+=1)i=de(i,o[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new Vn({props:i}),Te.push(()=>We(e,"hovered",l)),{c(){F(e.$$.fragment)},m(s,a){P(e,s,a),n=!0},p(s,a){const f={};!t&&a&1&&(t=!0,f.hovered=s[0],qe(()=>t=!1)),e.$set(f)},i(s){n||(b(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){I(e,s)}}}function bp(r){let e,t;const n=[$e("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function wp(r){let e,t,n,o;return e=new Ve({props:{data:r[1],generateId:!0,$$slots:{default:[hp]},$$scope:{ctx:r}}}),n=new Ve({props:{data:r[2],$$slots:{default:[bp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(l,i){P(e,l,i),$(l,t,i),P(n,l,i),o=!0},p(l,[i]){const s={};i&2&&(s.data=l[1]),i&65&&(s.$$scope={dirty:i,ctx:l}),e.$set(s);const a={};i&4&&(a.data=l[2]),i&64&&(a.$$scope={dirty:i,ctx:l}),n.$set(a)},i(l){o||(b(e.$$.fragment,l),b(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&k(t),I(e,l),I(n,l)}}}function yp(r,e,t){let n,o,l,i;Z(r,tt,f=>t(3,l=f)),Z(r,Nt,f=>t(4,i=f));let s=null;function a(f){s=f,t(0,s)}return r.$$.update=()=>{r.$$.dirty&1&&t(2,n=s==null?Yt():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(s.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(s.properties.to_geometry),properties:{}}]}),r.$$.dirty&24&&t(1,o=i>0?l.renderTurnRestrictions():Yt())},[s,o,n,l,i,a]}class vp extends le{constructor(e){super(),ie(this,e,yp,wp,oe,{})}}function $p(r){let e;const t=r[3].default,n=Be(t,r,r[5],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&32)&&Re(n,t,o,o[5],e?Ue(t,o[5],l,null):De(o[5]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function kp(r){let e,t,n,o;const l=[$e("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{minzoom:dr},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[$p]},$$scope:{ctx:r}};for(let f=0;f<l.length;f+=1)i=de(i,l[f]);e=new Vn({props:i}),e.$on("click",r[4]);const s=[$e("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:dr},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let f=0;f<s.length;f+=1)a=de(a,s[f]);return n=new Vn({props:a}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),o=!0},p(f,u){const c=u&0?He(l,[l[0],l[1],{minzoom:dr},l[3],l[4]]):{};u&32&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _=u&0?He(s,[s[0],s[1],{minzoom:dr},s[3],s[4]]):{};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),o=!1},d(f){f&&k(t),I(e,f),I(n,f)}}}function Sp(r){let e,t,n,o;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[kp]},$$scope:{ctx:r}}}),n=new vp({}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(l,i){P(e,l,i),$(l,t,i),P(n,l,i),o=!0},p(l,[i]){const s={};i&1&&(s.data=l[0]),i&32&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){o||(b(e.$$.fragment,l),b(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&k(t),I(e,l),I(n,l)}}}let dr=13;function Lp(r,e,t){let n,o,l;Z(r,tt,f=>t(1,o=f)),Z(r,Nt,f=>t(2,l=f));let{$$slots:i={},$$scope:s}=e;function a(f){ze.call(this,r,f)}return r.$$set=f=>{"$$scope"in f&&t(5,s=f.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=l>0?o.renderModalFilters():Yt())},[n,o,l,i,a,s]}class hn extends le{constructor(e){super(),ie(this,e,Lp,Sp,oe,{})}}function Cp(r){let e,t;const n=[$e("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Vn({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}class zr extends le{constructor(e){super(),ie(this,e,null,Cp,oe,{})}}function Mp(r){let e;const t=r[3].default,n=Be(t,r,r[4],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16)&&Re(n,t,o,o[4],e?Ue(t,o[4],l,null):De(o[4]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Tp(r){let e,t;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[Mp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Ap(r,e,t){let n,o;Z(r,tt,a=>t(2,o=a));let{$$slots:l={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&t(1,s=a.input),"$$scope"in a&&t(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||o.renderNeighbourhood()),r.$$.dirty&1&&Qi("neighbourhoodGj",n)},[n,s,o,l,i]}class ir extends le{constructor(e){super(),ie(this,e,Ap,Tp,oe,{input:1})}}function Fp(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Pp(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Ip(r){let e;return{c(){e=B("Editing")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Ep(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p;return l=new Ce({props:{$$slots:{default:[Fp]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new Ce({props:{$$slots:{default:[Pp]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new Ce({props:{$$slots:{default:[Ip]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),F(c.$$.fragment),_=T(),d=h("li"),d.textContent="Debug mode",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(g,w){$(g,e,w),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),P(c,u,null),m(n,_),m(n,d),p=!0},p(g,w){const S={};w&4096&&(S.$$scope={dirty:w,ctx:g}),l.$set(S);const y={};w&4096&&(y.$$scope={dirty:w,ctx:g}),a.$set(y);const v={};w&4096&&(v.$$scope={dirty:w,ctx:g}),c.$set(v)},i(g){p||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),p=!0)},o(g){C(l.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),p=!1},d(g){g&&k(e),I(l),I(a),I(c)}}}function ti(r){let e,t,n;return{c(){e=h("button"),e.textContent="Ⓧ",j(e,"class","close-btn svelte-khnvno")},m(o,l){$(o,e,l),t||(n=x(e,"click",r[6]),t=!0)},p:Y,d(o){o&&k(e),t=!1,n()}}}function jp(r){let e;return{c(){e=h("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){$(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&k(e)}}}function Np(r){let e,t,n,o,l,i,s;e=new er({props:{properties:r[0].feature.properties}});function a(u){r[7](u)}let f={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(f.idx=r[0].movementIdx),l=new Er({props:f}),Te.push(()=>We(l,"idx",a)),{c(){F(e.$$.fragment),t=T(),n=h("h5"),n.textContent="Turn restrictions:",o=T(),F(l.$$.fragment)},m(u,c){P(e,u,c),$(u,t,c),$(u,n,c),$(u,o,c),P(l,u,c),s=!0},p(u,c){const _={};c&1&&(_.properties=u[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=u[0].movements.features),!i&&c&1&&(i=!0,d.idx=u[0].movementIdx,qe(()=>i=!1)),l.$set(d)},i(u){s||(b(e.$$.fragment,u),b(l.$$.fragment,u),s=!0)},o(u){C(e.$$.fragment,u),C(l.$$.fragment,u),s=!1},d(u){u&&(k(t),k(n),k(o)),I(e,u),I(l,u)}}}function zp(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p;t=new gn({}),t.$on("click",r[5]);let g=r[0]&&ti(r);const w=[Np,jp],S=[];function y(v,L){return v[0]?0:1}return _=y(r),d=S[_]=w[_](r),{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("h4"),o.textContent="Roads",l=T(),i=h("p"),i.textContent="Click a road to visit its OSM object.",s=T(),a=h("div"),f=h("h4"),f.textContent="Intersections",u=T(),g&&g.c(),c=T(),d.c(),V(a,"display","flex"),V(a,"align-items","start"),V(a,"justify-content","space-between"),j(e,"slot","sidebar")},m(v,L){$(v,e,L),P(t,e,null),m(e,n),m(e,o),m(e,l),m(e,i),m(e,s),m(e,a),m(a,f),m(a,u),g&&g.m(a,null),m(e,c),S[_].m(e,null),p=!0},p(v,L){v[0]?g?g.p(v,L):(g=ti(v),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let A=_;_=y(v),_===A?S[_].p(v,L):(ye(),C(S[A],1,1,()=>{S[A]=null}),ve(),d=S[_],d?d.p(v,L):(d=S[_]=w[_](v),d.c()),b(d,1),d.m(e,null))},i(v){p||(b(t.$$.fragment,v),b(d),p=!0)},o(v){C(t.$$.fragment,v),C(d),p=!1},d(v){v&&k(e),I(t),g&&g.d(),S[_].d()}}}function Op(r){let e,t;return e=new er({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Bp(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Op,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Rp(r){let e,t;return e=new er({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Dp(r){let e,t,n;return t=new ht({props:{openOn:"hover",$$slots:{default:[Rp,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","line-popup")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p(o,l){const i={};l&6144&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function Up(r){let e,t,n,o,l,i,s,a,f,u;e=new Nr({}),n=new jr({}),l=new zr({});const c=[$e("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[Bp]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return s=new ln({props:_}),f=new lr({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[Dp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment),i=T(),F(s.$$.fragment),a=T(),F(f.$$.fragment)},m(d,p){P(e,d,p),$(d,t,p),P(n,d,p),$(d,o,p),P(l,d,p),$(d,i,p),P(s,d,p),$(d,a,p),P(f,d,p),u=!0},p(d,p){const g={};p&4096&&(g.$$scope={dirty:p,ctx:d}),s.$set(g);const w={};p&4096&&(w.$$scope={dirty:p,ctx:d}),f.$set(w)},i(d){u||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),b(s.$$.fragment,d),b(f.$$.fragment,d),u=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),C(s.$$.fragment,d),C(f.$$.fragment,d),u=!1},d(d){d&&(k(t),k(o),k(i),k(a)),I(e,d),I(n,d),I(l,d),I(s,d),I(f,d)}}}function Hp(r){let e,t;return e=new er({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Gp(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Hp,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Wp(r){let e,t;return e=new er({props:{properties:r[11]}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function qp(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Wp,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Jp(r){var l,i,s;let e,t;const n=[$e("debug-intersections"),{paint:{"circle-radius":oo(30),"circle-color":wn.mapFeature.hover.backgroundColor,"circle-stroke-color":wn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ot(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(l=r[0])==null?void 0:l.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,ot(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[qp]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)o=de(o,n[a]);return e=new ln({props:o}),e.$on("click",r[3]),{c(){F(e.$$.fragment)},m(a,f){P(e,a,f),t=!0},p(a,f){var c,_,d;const u=f&1?He(n,[n[0],{paint:{"circle-radius":oo(30),"circle-color":wn.mapFeature.hover.backgroundColor,"circle-stroke-color":wn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ot(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,ot(0,.5)]}},n[2],n[3]]):{};f&4096&&(u.$$scope={dirty:f,ctx:a}),e.$set(u)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){I(e,a)}}}function ni(r){let e,t;return e=new Ve({props:{data:r[0].movements,generateId:!0,$$slots:{default:[Yp]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0].movements),o&4097&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Yp(r){let e,t,n,o;const l=[$e("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<l.length;f+=1)i=de(i,l[f]);e=new nt({props:i});const s=[$e("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=de(a,s[f]);return n=new At({props:a}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),o=!0},p(f,u){const c={};e.$set(c);const _=u&1?He(s,[s[0],{filter:["==",["id"],f[0].movementIdx]},s[2]]):{};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),o=!1},d(f){f&&k(t),I(e,f),I(n,f)}}}function Zp(r){let e,t,n,o,l,i,s,a;t=new ir({props:{$$slots:{default:[Up]},$$scope:{ctx:r}}}),o=new hn({props:{$$slots:{default:[Gp]},$$scope:{ctx:r}}}),i=new Ve({props:{data:ct(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[Jp]},$$scope:{ctx:r}}});let f=r[0]&&ni(r);return{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),l=T(),F(i.$$.fragment),s=T(),f&&f.c(),j(e,"slot","map")},m(u,c){$(u,e,c),P(t,e,null),m(e,n),P(o,e,null),m(e,l),P(i,e,null),m(e,s),f&&f.m(e,null),a=!0},p(u,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:u}),t.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:u}),o.$set(d);const p={};c&2&&(p.data=ct(u[1]).getAllIntersections()),c&4097&&(p.$$scope={dirty:c,ctx:u}),i.$set(p),u[0]?f?(f.p(u,c),c&1&&b(f,1)):(f=ni(u),f.c(),b(f,1),f.m(e,null)):f&&(ye(),C(f,1,1,()=>{f=null}),ve())},i(u){a||(b(t.$$.fragment,u),b(o.$$.fragment,u),b(i.$$.fragment,u),b(f),a=!0)},o(u){C(t.$$.fragment,u),C(o.$$.fragment,u),C(i.$$.fragment,u),C(f),a=!1},d(u){u&&k(e),I(t),I(o),I(i),f&&f.d()}}}function Kp(r){let e,t;return e=new Ft({props:{$$slots:{map:[Zp],sidebar:[zp],top:[Ep]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Xp(r,e,t){let n,o;Z(r,tt,p=>t(1,n=p)),Z(r,ue,p=>t(2,o=p));let l=null;function i(p){let g=p.detail.features[0],w=n.getMovements(g.properties.intersection_id);t(0,l={feature:g,movements:w,movementIdx:0})}const s=(p,g)=>window.open(ct(p.properties).way,"_blank"),a=()=>te(ue,o={mode:"neighbourhood"},o),f=()=>t(0,l=null);function u(p){r.$$.not_equal(l.movementIdx,p)&&(l.movementIdx=p,t(0,l))}return[l,n,o,i,s,a,f,u,()=>te(ue,o={mode:"title",firstLoad:!1},o),()=>te(ue,o={mode:"pick-neighbourhood"},o),()=>te(ue,o={mode:"neighbourhood"},o)]}class Vp extends le{constructor(e){super(),ie(this,e,Xp,Kp,oe,{})}}var jt=63710088e-1,Cs={centimeters:jt*100,centimetres:jt*100,degrees:360/(2*Math.PI),feet:jt*3.28084,inches:jt*39.37,kilometers:jt/1e3,kilometres:jt/1e3,meters:jt,metres:jt,miles:jt/1609.344,millimeters:jt*1e3,millimetres:jt*1e3,nauticalmiles:jt/1852,radians:1,yards:jt*1.0936};function Qp(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function po(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ri(r[0])||!ri(r[1]))throw new Error("coordinates must contain numbers");return Qp({type:"Point",coordinates:r},e,t)}function xp(r,e="kilometers"){const t=Cs[e];if(!t)throw new Error(e+" units is invalid");return r*t}function em(r,e="kilometers"){const t=Cs[e];if(!t)throw new Error(e+" units is invalid");return r/t}function mo(r){return r%(2*Math.PI)*180/Math.PI}function qt(r){return r%360*Math.PI/180}function ri(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Qn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tm(r){return r.type==="Feature"?r.geometry:r}function Ms(r,e,t={}){if(t.final===!0)return nm(r,e);const n=Qn(r),o=Qn(e),l=qt(n[0]),i=qt(o[0]),s=qt(n[1]),a=qt(o[1]),f=Math.sin(i-l)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return mo(Math.atan2(f,u))}function nm(r,e){let t=Ms(e,r);return t=(t+180)%360,t}function rm(r,e,t,n={}){const o=Qn(r),l=qt(o[0]),i=qt(o[1]),s=qt(t),a=em(e,n.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=mo(u),_=mo(f);return po([c,_],n.properties)}function om(r,e,t={}){var n=Qn(r),o=Qn(e),l=qt(o[1]-n[1]),i=qt(o[0]-n[0]),s=qt(n[1]),a=qt(o[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return xp(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function lm(r,e,t={}){const o=tm(r).coordinates;let l=0;for(let i=0;i<o.length&&!(e>=l&&i===o.length-1);i++)if(l>=e){const s=e-l;if(s){const a=Ms(o[i],o[i-1])-180;return rm(o[i],s,a,t)}else return po(o[i])}else l+=om(o[i],o[i+1],t);return po(o[o.length-1])}var im=lm;function sm(r){let e,t;const n=[$e("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new ln({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function am(r){let e,t;return e=new Ve({props:{data:r[0],$$slots:{default:[sm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}let fm=50,um=100,cm=.01;function dm(r,e,t){let{paths:n}=e,o=a(),l=f(),i=c(),s=setInterval(_,um);Tt(()=>clearInterval(s));function a(){return n.features.map(d=>1/d.properties.directness).reduce((d,p)=>d+p,0)}function f(){return n.features.length==0?[]:Array.from({length:fm},u)}function u(){let d=Math.random()*o,p=0;for(let[g,w]of n.features.entries())if(p+=1/w.properties.directness,d<p)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${o}`)}function c(){return{type:"FeatureCollection",features:l.map(({idx:d,distance:p})=>im(n.features[d],p,{units:"kilometers"}))}}function _(){for(let[d,p]of l.entries())p.distance+=cm,p.distance>=n.features[p.idx].properties.length_meters/1e3&&(l[d]=u());t(0,i=c())}return r.$$set=d=>{"paths"in d&&t(1,n=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(o=a(),l=f())},[i,n]}class _m extends le{constructor(e){super(),ie(this,e,dm,am,oe,{paths:1})}}class pm{constructor(e){pt(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function mm(r){let e,t,n,o,l;return{c(){e=h("div"),e.textContent="+",t=T(),n=h("img"),l=B(`
    Add diagonal filter`),V(e,"font-size","200%"),V(e,"margin-top","-12px"),j(e,"class","icon"),xe(n.src,o="/ltn//filters/diagonal_filter_icon.png")||j(n,"src",o),j(n,"alt","Add diagonal filter"),V(n,"transform","rotate(135deg)"),j(n,"class","svelte-j2s60j")},m(i,s){$(i,e,s),$(i,t,s),$(i,n,s),$(i,l,s)},p:Y,d(i){i&&(k(e),k(t),k(n),k(l))}}}function gm(r){let e;function t(l,i){return l[0].hasRotatedFilter?bm:hm}let n=t(r),o=n(r);return{c(){o.c(),e=Je()},m(l,i){o.m(l,i),$(l,e,i)},p(l,i){n!==(n=t(l))&&(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&k(e),o.d(l)}}}function hm(r){let e,t,n,o,l;return{c(){e=h("div"),e.textContent="↻",t=T(),n=h("img"),l=B(`
      Rotate diagonal filter`),V(e,"font-size","200%"),V(e,"padding-bottom","4px"),j(e,"class","icon"),xe(n.src,o="/ltn//filters/diagonal_filter_icon.png")||j(n,"src",o),j(n,"alt","Rotate diagonal filter"),V(n,"transform","rotate(45deg)"),j(n,"class","svelte-j2s60j")},m(i,s){$(i,e,s),$(i,t,s),$(i,n,s),$(i,l,s)},d(i){i&&(k(e),k(t),k(n),k(l))}}}function bm(r){let e,t,n,o,l;return{c(){e=h("div"),e.textContent="❌",t=T(),n=h("img"),l=B(`
      Delete diagonal filter`),j(e,"class","icon"),xe(n.src,o="/ltn//filters/diagonal_filter_icon.png")||j(n,"src",o),j(n,"alt","Remove diagonal filter"),V(n,"transform","rotate(45deg)"),j(n,"class","svelte-j2s60j")},m(i,s){$(i,e,s),$(i,t,s),$(i,n,s),$(i,l,s)},d(i){i&&(k(e),k(t),k(n),k(l))}}}function wm(r){let e;function t(l,i){return l[0].filter?gm:mm}let n=t(r),o=n(r);return{c(){e=h("div"),o.c(),V(e,"display","flex"),V(e,"align-items","center")},m(l,i){$(l,e,i),o.m(e,null)},p(l,[i]){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e,null)))},i:Y,o:Y,d(l){l&&k(e),o.d()}}}function ym(r,e,t){let{intersection:n}=e;return r.$$set=o=>{"intersection"in o&&t(0,n=o.intersection)},[n]}class vm extends le{constructor(e){super(),ie(this,e,ym,wm,oe,{intersection:0})}}function $m(r){let e,t;return e=new vm({props:{intersection:r[2](r[6])}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&64&&(l.intersection=n[2](n[6])),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function km(r){let e,t;return e=new Su({props:{openOn:"hover",$$slots:{default:[$m,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Sm(r){let e,t;const n=[$e("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":oo(30),"circle-color":wn.mapFeature.hover.backgroundColor,"circle-opacity":ot(0,.5),"circle-stroke-color":wn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ot(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[km]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new ln({props:o}),e.$on("click",r[4]),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,[i]){const s=i&2?He(n,[n[0],n[1],n[2],{interactive:l[1]},n[4],n[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Lm(r,e,t){let{neighbourhood:n=wo("neighbourhoodGj")}=e,{onClickIntersection:o=f=>{}}=e,{interactive:l=!1}=e;function i(f){let u=n.features[f];return new pm(u)}function s(f){return i(f[0].id)}const a=f=>o(s(f.detail.features));return r.$$set=f=>{"neighbourhood"in f&&t(3,n=f.neighbourhood),"onClickIntersection"in f&&t(0,o=f.onClickIntersection),"interactive"in f&&t(1,l=f.interactive)},[o,l,s,n,a]}class Cm extends le{constructor(e){super(),ie(this,e,Lm,Sm,oe,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function oi(r,e,t){const n=r.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function li(r){let e,t,n,o,l,i,s=r[8]+"",a,f,u,c,_;function d(){return r[3](r[7])}return{c(){e=h("button"),t=h("img"),o=T(),l=h("br"),i=T(),a=B(s),f=T(),xe(t.src,n=`/ltn//filters/${r[7]}_icon.gif`)||j(t,"src",n),j(t,"width","80"),j(t,"alt",r[8]),j(e,"class","outline"),V(e,"width","100%"),e.disabled=u=r[0]==r[7]},m(p,g){$(p,e,g),m(e,t),m(e,o),m(e,l),m(e,i),m(e,a),m(e,f),c||(_=x(e,"click",d),c=!0)},p(p,g){r=p,g&1&&u!==(u=r[0]==r[7])&&(e.disabled=u)},d(p){p&&k(e),c=!1,_()}}}function Mm(r){let e,t,n,o,l,i,s,a,f,u,c,_,d=r[1][2]+"",p,g,w,S,y,v,L=Me(r[2]),A=[];for(let M=0;M<L.length;M+=1)A[M]=li(oi(r,L,M));function E(){return r[4](r[6])}return{c(){e=h("h3"),e.textContent="Choose a modal filter to place on streets",t=T(),n=h("table"),o=h("tr"),l=h("td");for(let M=0;M<A.length;M+=1)A[M].c();i=T(),s=h("td"),a=h("img"),c=T(),_=h("p"),p=B(d),g=T(),w=h("center"),S=h("button"),S.textContent="Confirm",xe(a.src,f=`/ltn//filters/${r[0]}.gif`)||j(a,"src",f),j(a,"height","300"),j(a,"alt",u=r[1][1])},m(M,N){$(M,e,N),$(M,t,N),$(M,n,N),m(n,o),m(o,l);for(let z=0;z<A.length;z+=1)A[z]&&A[z].m(l,null);m(o,i),m(o,s),m(s,a),m(s,c),m(s,_),m(_,p),$(M,g,N),$(M,w,N),m(w,S),y||(v=x(S,"click",E),y=!0)},p(M,N){if(r=M,N&5){L=Me(r[2]);let z;for(z=0;z<L.length;z+=1){const D=oi(r,L,z);A[z]?A[z].p(D,N):(A[z]=li(D),A[z].c(),A[z].m(l,null))}for(;z<A.length;z+=1)A[z].d(1);A.length=L.length}N&1&&!xe(a.src,f=`/ltn//filters/${r[0]}.gif`)&&j(a,"src",f),N&2&&u!==(u=r[1][1])&&j(a,"alt",u),N&2&&d!==(d=r[1][2]+"")&&ne(p,d)},d(M){M&&(k(e),k(t),k(n),k(g),k(w)),ut(A,M),y=!1,v()}}}function Tm(r){let e,t;return e=new Tr({props:{$$slots:{default:[Mm,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&4163&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Am(r,e,t){let n,o;Z(r,xr,f=>t(0,o=f));let l=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const i=f=>te(xr,o=f,o),s=f=>ct(f).close();function a(f){ze.call(this,r,f)}return r.$$.update=()=>{r.$$.dirty&1&&t(1,n=l.find(f=>f[0]==o))},[o,n,l,i,s,a]}class Fm extends le{constructor(e){super(),ie(this,e,Am,Tm,oe,{})}}function ii(r){let e,t;return e=new Ve({props:{data:r[0],$$slots:{default:[Pm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0]),o&64&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Pm(r){let e,t;const n=[$e("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Im(r){let e,t,n=r[0]&&ii(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=ii(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function Em(r,e,t){let{map:n}=e,o=null;const l=pn();n.on("dragstart",i),n.on("mousemove",s),n.on("mouseup",a),Tt(()=>{n.dragPan.enable(),n.off("dragstart",i),n.off("mousemove",s),n.off("mouseup",a)});function i(){n.dragPan.disable(),t(0,o={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(f){o&&(o.geometry.coordinates.push(f.lngLat.toArray()),t(0,o))}function a(){o&&(l("done",o),t(0,o=null))}return r.$$set=f=>{"map"in f&&t(1,n=f.map)},[o,n]}class jm extends le{constructor(e){super(),ie(this,e,Em,Im,oe,{map:1})}}function Nm(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function zm(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Om(r){let e;return{c(){e=h("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Bm(r){let e;return{c(){e=B("View shortcuts")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Rm(r){let e;return{c(){e=B("Route")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Dm(r){let e;return{c(){e=B("Impact routing to one destination")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Um(r){let e;return{c(){e=B("Change this boundary")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Hm(r){let e;return{c(){e=B("Debug")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Gm(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w,S,y,v,L,A,E,M,N,z,D,O,R,H,q;return l=new Ce({props:{$$slots:{default:[Nm]},$$scope:{ctx:r}}}),l.$on("click",r[31]),a=new Ce({props:{$$slots:{default:[zm]},$$scope:{ctx:r}}}),a.$on("click",r[32]),_=new Ir({props:{$$slots:{default:[Om]},$$scope:{ctx:r}}}),S=new Ce({props:{$$slots:{default:[Bm]},$$scope:{ctx:r}}}),S.$on("click",r[33]),L=new Ce({props:{$$slots:{default:[Rm]},$$scope:{ctx:r}}}),L.$on("click",r[34]),M=new Ce({props:{$$slots:{default:[Dm]},$$scope:{ctx:r}}}),M.$on("click",r[35]),D=new Ce({props:{$$slots:{default:[Um]},$$scope:{ctx:r}}}),D.$on("click",r[36]),H=new Ce({props:{$$slots:{default:[Hm]},$$scope:{ctx:r}}}),H.$on("click",r[37]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),c=B(`Editing
          `),F(_.$$.fragment),d=T(),p=h("nav"),g=h("ul"),w=h("li"),F(S.$$.fragment),y=T(),v=h("li"),F(L.$$.fragment),A=T(),E=h("li"),F(M.$$.fragment),N=T(),z=h("li"),F(D.$$.fragment),O=T(),R=h("li"),F(H.$$.fragment),j(t,"aria-label","breadcrumb"),j(e,"slot","top"),V(e,"display","flex"),V(e,"justify-content","space-between")},m(X,se){$(X,e,se),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),m(u,c),P(_,u,null),m(e,d),m(e,p),m(p,g),m(g,w),P(S,w,null),m(g,y),m(g,v),P(L,v,null),m(g,A),m(g,E),P(M,E,null),m(g,N),m(g,z),P(D,z,null),m(g,O),m(g,R),P(H,R,null),q=!0},p(X,se){const ce={};se[1]&1024&&(ce.$$scope={dirty:se,ctx:X}),l.$set(ce);const U={};se[1]&1024&&(U.$$scope={dirty:se,ctx:X}),a.$set(U);const be={};se[1]&1024&&(be.$$scope={dirty:se,ctx:X}),_.$set(be);const ge={};se[1]&1024&&(ge.$$scope={dirty:se,ctx:X}),S.$set(ge);const ae={};se[1]&1024&&(ae.$$scope={dirty:se,ctx:X}),L.$set(ae);const we={};se[1]&1024&&(we.$$scope={dirty:se,ctx:X}),M.$set(we);const fe={};se[1]&1024&&(fe.$$scope={dirty:se,ctx:X}),D.$set(fe);const Pe={};se[1]&1024&&(Pe.$$scope={dirty:se,ctx:X}),H.$set(Pe)},i(X){q||(b(l.$$.fragment,X),b(a.$$.fragment,X),b(_.$$.fragment,X),b(S.$$.fragment,X),b(L.$$.fragment,X),b(M.$$.fragment,X),b(D.$$.fragment,X),b(H.$$.fragment,X),q=!0)},o(X){C(l.$$.fragment,X),C(a.$$.fragment,X),C(_.$$.fragment,X),C(S.$$.fragment,X),C(L.$$.fragment,X),C(M.$$.fragment,X),C(D.$$.fragment,X),C(H.$$.fragment,X),q=!1},d(X){X&&k(e),I(l),I(a),I(_),I(S),I(L),I(M),I(D),I(H)}}}function si(r){let e;return{c(){e=h("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function ai(r){let e,t;return e=new mn({props:{colorScale:ys,limits:vs}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Wm(r){let e,t,n;return{c(){e=B("Undo ("),t=B(r[4]),n=B(")")},m(o,l){$(o,e,l),$(o,t,l),$(o,n,l)},p(o,l){l[0]&16&&ne(t,o[4])},d(o){o&&(k(e),k(t),k(n))}}}function qm(r){let e;return{c(){e=B("Undo")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Jm(r){let e,t,n;return{c(){e=B("Redo ("),t=B(r[5]),n=B(")")},m(o,l){$(o,e,l),$(o,t,l),$(o,n,l)},p(o,l){l[0]&32&&ne(t,o[5])},d(o){o&&(k(e),k(t),k(n))}}}function Ym(r){let e;return{c(){e=B("Redo")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function fi(r){let e,t;return e=new Fm({}),e.$on("close",r[30]),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Zm(r){let e,t,n,o,l=ct(r[6]).properties.name+"",i,s,a=ct(r[6]).properties.area_km2.toFixed(1)+"",f,u,c,_,d,p,g,w,S,y,v,L,A,E,M,N,z,D,O,R,H,q,X,se,ce,U,be,ge,ae,we,fe,Pe,Xe,Ae,re,Ke,Ne,ke,K,pe,Q,me,he,Se,W,dt,Ge,Ye,kt,bt=r[8]>0&&si(),et=r[12]=="speeds"&&ai();function en(Ie,it){return Ie[4]==0?qm:Wm}let tn=en(r),Lt=tn(r);function ar(Ie,it){return Ie[5]==0?Ym:Jm}let Pt=ar(r),It=Pt(r),lt=r[3]&&fi(r);return{c(){e=h("div"),t=h("p"),n=B("Editing neighbourhood "),o=h("u"),i=B(l),s=B(`
      , with an area of `),f=B(a),u=B(" km²"),c=T(),bt&&bt.c(),_=T(),d=h("div"),p=h("button"),g=h("img"),S=B(`
        Add a modal filter`),v=T(),L=h("button"),A=B("Add many modal filters along line"),M=T(),N=h("button"),z=B("Reverse directions"),O=T(),R=h("button"),R.textContent="Change modal filter type",H=T(),q=h("label"),X=h("input"),se=B(`
      Animate shortcuts`),ce=T(),U=h("label"),be=h("input"),ge=B(`
      Include perimeter roads`),ae=T(),we=h("div"),fe=h("label"),Pe=B(`Draw roads:
        `),Xe=h("select"),Ae=h("option"),Ae.textContent="Worst shortcuts",re=h("option"),re.textContent="Cell",Ke=h("option"),Ke.textContent="Edits (either filter or direction)",Ne=h("option"),Ne.textContent="Speed limit",ke=T(),et&&et.c(),K=T(),pe=h("div"),Q=h("button"),Lt.c(),he=T(),Se=h("button"),It.c(),dt=T(),lt&&lt.c(),xe(g.src,w=`/ltn//filters/${r[9]}_icon.gif`)||j(g,"src",w),j(g,"width","30"),j(g,"alt","Add a modal filter"),p.disabled=y=r[0]=="filter",j(p,"data-tooltip","hotkey 1"),L.disabled=E=r[0]=="freehand-filters",j(L,"data-tooltip","hotkey 2"),N.disabled=D=r[0]=="oneway",j(N,"data-tooltip","hotkey 3"),V(d,"display","flex"),V(d,"justify-content","space-between"),j(X,"type","checkbox"),j(be,"type","checkbox"),Ae.__value="shortcuts",Oe(Ae,Ae.__value),re.__value="cells",Oe(re,re.__value),Ke.__value="edits",Oe(Ke,Ke.__value),Ne.__value="speeds",Oe(Ne,Ne.__value),r[12]===void 0&&fn(()=>r[29].call(Xe)),V(we,"border","1px solid black"),V(we,"padding","4px"),Q.disabled=me=r[4]==0,j(Q,"data-tooltip","Ctrl+Z"),Se.disabled=W=r[5]==0,j(Se,"data-tooltip","Ctrl+Y"),V(pe,"display","flex"),V(pe,"justify-content","space-between"),j(e,"slot","sidebar")},m(Ie,it){$(Ie,e,it),m(e,t),m(t,n),m(t,o),m(o,i),m(t,s),m(t,f),m(t,u),m(e,c),bt&&bt.m(e,null),m(e,_),m(e,d),m(d,p),m(p,g),m(p,S),m(d,v),m(d,L),m(L,A),m(d,M),m(d,N),m(N,z),m(e,O),m(e,R),m(e,H),m(e,q),m(q,X),X.checked=r[11],m(q,se),m(e,ce),m(e,U),m(U,be),be.checked=r[10],m(U,ge),m(e,ae),m(e,we),m(we,fe),m(fe,Pe),m(fe,Xe),m(Xe,Ae),m(Xe,re),m(Xe,Ke),m(Xe,Ne),vt(Xe,r[12],!0),m(we,ke),et&&et.m(we,null),m(e,K),m(e,pe),m(pe,Q),Lt.m(Q,null),m(pe,he),m(pe,Se),It.m(Se,null),m(e,dt),lt&&lt.m(e,null),Ge=!0,Ye||(kt=[x(p,"click",r[23]),x(L,"click",r[24]),x(N,"click",r[25]),x(R,"click",r[26]),x(X,"change",r[27]),x(be,"change",r[28]),x(be,"change",r[14]),x(Xe,"change",r[29]),x(Q,"click",r[19]),x(Se,"click",r[20])],Ye=!0)},p(Ie,it){(!Ge||it[0]&64)&&l!==(l=ct(Ie[6]).properties.name+"")&&ne(i,l),(!Ge||it[0]&64)&&a!==(a=ct(Ie[6]).properties.area_km2.toFixed(1)+"")&&ne(f,a),Ie[8]>0?bt||(bt=si(),bt.c(),bt.m(e,_)):bt&&(bt.d(1),bt=null),(!Ge||it[0]&512&&!xe(g.src,w=`/ltn//filters/${Ie[9]}_icon.gif`))&&j(g,"src",w),(!Ge||it[0]&1&&y!==(y=Ie[0]=="filter"))&&(p.disabled=y),(!Ge||it[0]&1&&E!==(E=Ie[0]=="freehand-filters"))&&(L.disabled=E),(!Ge||it[0]&1&&D!==(D=Ie[0]=="oneway"))&&(N.disabled=D),it[0]&2048&&(X.checked=Ie[11]),it[0]&1024&&(be.checked=Ie[10]),it[0]&4096&&vt(Xe,Ie[12]),Ie[12]=="speeds"?et?it[0]&4096&&b(et,1):(et=ai(),et.c(),b(et,1),et.m(we,null)):et&&(ye(),C(et,1,1,()=>{et=null}),ve()),tn===(tn=en(Ie))&&Lt?Lt.p(Ie,it):(Lt.d(1),Lt=tn(Ie),Lt&&(Lt.c(),Lt.m(Q,null))),(!Ge||it[0]&16&&me!==(me=Ie[4]==0))&&(Q.disabled=me),Pt===(Pt=ar(Ie))&&It?It.p(Ie,it):(It.d(1),It=Pt(Ie),It&&(It.c(),It.m(Se,null))),(!Ge||it[0]&32&&W!==(W=Ie[5]==0))&&(Se.disabled=W),Ie[3]?lt?(lt.p(Ie,it),it[0]&8&&b(lt,1)):(lt=fi(Ie),lt.c(),b(lt,1),lt.m(e,null)):lt&&(ye(),C(lt,1,1,()=>{lt=null}),ve())},i(Ie){Ge||(b(et),b(lt),Ge=!0)},o(Ie){C(et),C(lt),Ge=!1},d(Ie){Ie&&k(e),bt&&bt.d(),et&&et.d(),Lt.d(),It.d(),lt&&lt.d(),Ye=!1,ft(kt)}}}function Km(r){let e;return{c(){e=h("p"),e.textContent="Click to change direction"},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Xm(r){let e,t,n,o;return{c(){e=h("div"),t=h("img"),o=B(`
                Click to add modal filter`),xe(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||j(t,"src",n),j(t,"width","20"),j(t,"alt","Add modal filter")},m(l,i){$(l,e,i),m(e,t),m(e,o)},p(l,i){i[0]&512&&!xe(t.src,n=`/ltn//filters/${l[9]}_icon.gif`)&&j(t,"src",n)},d(l){l&&k(e)}}}function Vm(r){let e,t=r[40].shortcuts+"",n,o,l=(r[40].name??"unnamed road")+"",i,s,a=Math.round(r[40].speed_mph)+"",f,u,c,_;function d(w,S){return w[0]=="filter"?Xm:Km}let p=d(r),g=p(r);return{c(){e=h("p"),n=B(t),o=B(" shortcuts through "),i=B(l),s=B(`
              (`),f=B(a),u=B(" mph)"),c=T(),g.c(),_=Je()},m(w,S){$(w,e,S),m(e,n),m(e,o),m(e,i),m(e,s),m(e,f),m(e,u),$(w,c,S),g.m(w,S),$(w,_,S)},p(w,S){S[1]&512&&t!==(t=w[40].shortcuts+"")&&ne(n,t),S[1]&512&&l!==(l=(w[40].name??"unnamed road")+"")&&ne(i,l),S[1]&512&&a!==(a=Math.round(w[40].speed_mph)+"")&&ne(f,a),p===(p=d(w))&&g?g.p(w,S):(g.d(1),g=p(w),g&&(g.c(),g.m(_.parentNode,_)))},d(w){w&&(k(e),k(c),k(_)),g.d(w)}}}function Qm(r){let e,t,n;return t=new ht({props:{openOn:"hover",$$slots:{default:[Vm,({props:o})=>({40:o}),({props:o})=>[0,o?512:0]]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","line-popup")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p(o,l){const i={};l[0]&513|l[1]&1536&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function xm(r){let e,t,n,o,l,i,s,a,f,u;return e=new Nr({}),n=new jr({}),l=new zr({}),s=new lr({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[Qm]},$$scope:{ctx:r}}}),f=new Cm({props:{interactive:r[0]=="filter",neighbourhood:r[1],onClickIntersection:r[17]}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment),i=T(),F(s.$$.fragment),a=T(),F(f.$$.fragment)},m(c,_){P(e,c,_),$(c,t,_),P(n,c,_),$(c,o,_),P(l,c,_),$(c,i,_),P(s,c,_),$(c,a,_),P(f,c,_),u=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0]=="filter"||c[0]=="oneway"),_[0]&513|_[1]&1024&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const p={};_[0]&1&&(p.interactive=c[0]=="filter"),_[0]&2&&(p.neighbourhood=c[1]),f.$set(p)},i(c){u||(b(e.$$.fragment,c),b(n.$$.fragment,c),b(l.$$.fragment,c),b(s.$$.fragment,c),b(f.$$.fragment,c),u=!0)},o(c){C(e.$$.fragment,c),C(n.$$.fragment,c),C(l.$$.fragment,c),C(s.$$.fragment,c),C(f.$$.fragment,c),u=!1},d(c){c&&(k(t),k(o),k(i),k(a)),I(e,c),I(n,c),I(l,c),I(s,c),I(f,c)}}}function ui(r){let e,t;return e=new _m({props:{paths:r[7]}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o[0]&128&&(l.paths=n[7]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function eg(r){let e;return{c(){e=B("Click to delete")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function tg(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[eg]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o[1]&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function ci(r){let e,t;return e=new jm({props:{map:ct(r[2])}}),e.$on("done",r[21]),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o[0]&4&&(l.map=ct(n[2])),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function ng(r){let e,t,n,o,l,i,s;t=new ir({props:{input:r[1],$$slots:{default:[xm]},$$scope:{ctx:r}}});let a=r[11]&&ui(r);l=new hn({props:{$$slots:{default:[tg]},$$scope:{ctx:r}}}),l.$on("click",r[16]);let f=r[0]=="freehand-filters"&&ci(r);return{c(){e=h("div"),F(t.$$.fragment),n=T(),a&&a.c(),o=T(),F(l.$$.fragment),i=T(),f&&f.c(),j(e,"slot","map")},m(u,c){$(u,e,c),P(t,e,null),m(e,n),a&&a.m(e,null),m(e,o),P(l,e,null),m(e,i),f&&f.m(e,null),s=!0},p(u,c){const _={};c[0]&2&&(_.input=u[1]),c[0]&515|c[1]&1024&&(_.$$scope={dirty:c,ctx:u}),t.$set(_),u[11]?a?(a.p(u,c),c[0]&2048&&b(a,1)):(a=ui(u),a.c(),b(a,1),a.m(e,o)):a&&(ye(),C(a,1,1,()=>{a=null}),ve());const d={};c[1]&1024&&(d.$$scope={dirty:c,ctx:u}),l.$set(d),u[0]=="freehand-filters"?f?(f.p(u,c),c[0]&1&&b(f,1)):(f=ci(u),f.c(),b(f,1),f.m(e,null)):f&&(ye(),C(f,1,1,()=>{f=null}),ve())},i(u){s||(b(t.$$.fragment,u),b(a),b(l.$$.fragment,u),b(f),s=!0)},o(u){C(t.$$.fragment,u),C(a),C(l.$$.fragment,u),C(f),s=!1},d(u){u&&k(e),I(t),a&&a.d(),I(l),f&&f.d()}}}function rg(r){let e,t,n,o;return e=new Ft({props:{$$slots:{map:[ng],sidebar:[Zm],top:[Gm]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0,n||(o=x(window,"keydown",r[18]),n=!0)},p(l,i){const s={};i[0]&16383|i[1]&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l),n=!1,o()}}}function og(r,e,t){let n,o,l,i,s,a,f,u,c;Z(r,Nt,re=>t(22,o=re)),Z(r,xr,re=>t(9,l=re)),Z(r,tt,re=>t(38,i=re)),Z(r,Jn,re=>t(10,s=re)),Z(r,xt,re=>t(2,a=re)),Z(r,jo,re=>t(11,f=re)),Z(r,$r,re=>t(12,u=re)),Z(r,ue,re=>t(13,c=re));let _="filter",d=!1,p=0,g=0,w,S,y=i.getAllShortcuts();Tt(()=>{a.doubleClickZoom.enable()});function v(re){t(1,S=i.renderNeighbourhood()),t(6,w=S.features.find(Ke=>Ke.properties.kind=="boundary")),t(4,p=S.undo_length),t(5,g=S.redo_length),t(7,y=i.getAllShortcuts()),Mn()}function L(){i.setCurrentNeighbourhood(w.properties.name,s),te(Nt,o++,o)}function A(re,Ke){_=="filter"?(i.addModalFilter(Ke,l),te(Nt,o++,o)):_=="oneway"&&(i.toggleTravelFlow(re.properties.road),te(Nt,o++,o))}function E(re){let Ke=re.detail.features[0];i.deleteModalFilter(Ke.properties.road),te(Nt,o++,o)}function M(re){if(_!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${_}`);return}re.hasRotatedFilter?(i.deleteDiagonalFilter(re),te(Nt,o++,o)):re.filter?(i.rotateDiagonalFilter(re),te(Nt,o++,o)):(i.addDiagonalFilter(re),te(Nt,o++,o))}function N(re){re.target.tagName!="INPUT"&&(re.ctrlKey&&re.key=="z"&&z(),re.ctrlKey&&re.key=="y"&&D(),re.key=="1"&&t(0,_="filter"),re.key=="2"&&t(0,_="freehand-filters"),re.key=="3"&&t(0,_="oneway"))}function z(){i.undo(),te(Nt,o++,o)}function D(){i.redo(),te(Nt,o++,o)}function O(re){let Ke=re.detail;Ke&&(i.addManyModalFilters(Ke,l),te(Nt,o++,o)),t(0,_="filter")}const R=()=>t(0,_="filter"),H=()=>t(0,_="freehand-filters"),q=()=>t(0,_="oneway"),X=()=>t(3,d=!0);function se(){f=this.checked,jo.set(f)}function ce(){s=this.checked,Jn.set(s)}function U(){u=un(this),$r.set(u)}const be=()=>t(3,d=!1),ge=()=>te(ue,c={mode:"title",firstLoad:!1},c),ae=()=>te(ue,c={mode:"pick-neighbourhood"},c),we=()=>te(ue,c={mode:"view-shortcuts"},c),fe=()=>te(ue,c={mode:"route",prevMode:"neighbourhood"},c),Pe=()=>te(ue,c={mode:"impact-one-destination"},c),Xe=()=>te(ue,c={mode:"set-boundary",name:ct(w).properties.name,existing:w},c),Ae=()=>te(ue,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(_=="oneway"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&4194304&&v(),r.$$.dirty[0]&2&&t(8,n=S.features.filter(re=>re.properties.kind=="cell"&&re.properties.cell_color=="disconnected").length)},[_,S,a,d,p,g,w,y,n,l,s,f,u,c,L,A,E,M,N,z,D,O,o,R,H,q,X,se,ce,U,be,ge,ae,we,fe,Pe,Xe,Ae]}class lg extends le{constructor(e){super(),ie(this,e,og,rg,oe,{},null,[-1,-1])}}function ig(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function sg(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function ag(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[ig]},$$scope:{ctx:r}}}),l.$on("click",r[7]),a=new Ce({props:{$$slots:{default:[sg]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),u.textContent="Predict impact",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(_,d){$(_,e,d),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),c=!0},p(_,d){const p={};d&1024&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),I(l),I(a)}}}function fg(r){let e;return{c(){e=B("Pick a different road")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function ug(r){let e,t,n,o,l,i,s,a;t=new Ce({props:{$$slots:{default:[fg]},$$scope:{ctx:r}}}),t.$on("click",r[5]);function f(c){r[6](c)}let u={list:r[2]};return r[0]!==void 0&&(u.idx=r[0]),o=new Er({props:u}),Te.push(()=>We(o,"idx",f)),{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),i=T(),s=h("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,j(e,"slot","sidebar")},m(c,_){$(c,e,_),P(t,e,null),m(e,n),P(o,e,null),m(e,i),m(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),t.$set(d);const p={};!l&&_&1&&(l=!0,p.idx=c[0],qe(()=>l=!1)),o.$set(p)},i(c){a||(b(t.$$.fragment,c),b(o.$$.fragment,c),a=!0)},o(c){C(t.$$.fragment,c),C(o.$$.fragment,c),a=!1},d(c){c&&k(e),I(t),I(o)}}}function cg(r){let e,t;const n=[$e("predict-impact"),{paint:{"line-width":Gt(["get","kind"],{focus:8},5),"line-color":Gt(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Gt(["get","kind"],{focus:1},.5)}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function dg(r){let e;return{c(){e=B("A")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function _g(r){let e;return{c(){e=B("B")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function pg(r){let e,t,n,o,l,i,s,a,f;return t=new Ve({props:{data:r[3](r[0]),$$slots:{default:[cg]},$$scope:{ctx:r}}}),o=new $n({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[dg]},$$scope:{ctx:r}}}),i=new $n({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[_g]},$$scope:{ctx:r}}}),a=new hn({}),{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),l=T(),F(i.$$.fragment),s=T(),F(a.$$.fragment),j(e,"slot","map")},m(u,c){$(u,e,c),P(t,e,null),m(e,n),P(o,e,null),m(e,l),P(i,e,null),m(e,s),P(a,e,null),f=!0},p(u,c){const _={};c&1&&(_.data=u[3](u[0])),c&1024&&(_.$$scope={dirty:c,ctx:u}),t.$set(_);const d={};c&1&&(d.lngLat=u[2][u[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:u}),o.$set(d);const p={};c&1&&(p.lngLat=u[2][u[0]][0].geometry.coordinates[u[2][u[0]][0].geometry.coordinates.length-1]),c&1024&&(p.$$scope={dirty:c,ctx:u}),i.$set(p)},i(u){f||(b(t.$$.fragment,u),b(o.$$.fragment,u),b(i.$$.fragment,u),b(a.$$.fragment,u),f=!0)},o(u){C(t.$$.fragment,u),C(o.$$.fragment,u),C(i.$$.fragment,u),C(a.$$.fragment,u),f=!1},d(u){u&&k(e),I(t),I(o),I(i),I(a)}}}function mg(r){let e,t;return e=new Ft({props:{$$slots:{map:[pg],sidebar:[ug],top:[ag]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function gg(r,e,t){let n,o;Z(r,tt,d=>t(9,n=d)),Z(r,ue,d=>t(1,o=d));let{road:l}=e;l.properties.kind="focus";let i=n.getImpactsOnRoad(l.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],l]}}const f=()=>te(ue,o={mode:"predict-impact"},o);function u(d){s=d,t(0,s)}const c=()=>te(ue,o={mode:"title",firstLoad:!1},o),_=()=>te(ue,o={mode:"pick-neighbourhood"},o);return r.$$set=d=>{"road"in d&&t(4,l=d.road)},[s,o,i,a,l,f,u,c,_]}class hg extends le{constructor(e){super(),ie(this,e,gg,mg,oe,{road:4})}}function bg(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function wg(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function yg(r){let e;return{c(){e=B("Editing")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function vg(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p;return l=new Ce({props:{$$slots:{default:[bg]},$$scope:{ctx:r}}}),l.$on("click",r[12]),a=new Ce({props:{$$slots:{default:[wg]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new Ce({props:{$$slots:{default:[yg]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),F(c.$$.fragment),_=T(),d=h("li"),d.textContent="Impact routing to one destination",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(g,w){$(g,e,w),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),P(c,u,null),m(n,_),m(n,d),p=!0},p(g,w){const S={};w&262144&&(S.$$scope={dirty:w,ctx:g}),l.$set(S);const y={};w&262144&&(y.$$scope={dirty:w,ctx:g}),a.$set(y);const v={};w&262144&&(v.$$scope={dirty:w,ctx:g}),c.$set(v)},i(g){p||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),p=!0)},o(g){C(l.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),p=!1},d(g){g&&k(e),I(l),I(a),I(c)}}}function $g(r){let e,t,n,o,l,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",f,u;return t=new gn({}),t.$on("click",r[5]),{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,l=T(),i=h("p"),s=B("Highest ratio is "),f=B(a),j(e,"slot","sidebar")},m(c,_){$(c,e,_),P(t,e,null),m(e,n),m(e,o),m(e,l),m(e,i),m(i,s),m(i,f),u=!0},p(c,_){(!u||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&ne(f,a)},i(c){u||(b(t.$$.fragment,c),u=!0)},o(c){C(t.$$.fragment,c),u=!1},d(c){c&&k(e),I(t)}}}function kg(r){let e,t;const n=[$e("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new At({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Sg(r){let e,t=dn(r[17].distance_before)+"",n,o,l=_n(r[17].time_before)+"",i,s,a,f,u=dn(r[17].distance_after)+"",c,_,d=_n(r[17].time_after)+"",p,g,w,S,y,v=(r[17].time_after/r[17].time_before).toFixed(1)+"",L;return{c(){e=h("p"),n=B(t),o=B(", "),i=B(l),s=B(" before"),a=T(),f=h("p"),c=B(u),_=B(", "),p=B(d),g=B(" after"),w=T(),S=h("p"),y=B("Time ratio: "),L=B(v)},m(A,E){$(A,e,E),m(e,n),m(e,o),m(e,i),m(e,s),$(A,a,E),$(A,f,E),m(f,c),m(f,_),m(f,p),m(f,g),$(A,w,E),$(A,S,E),m(S,y),m(S,L)},p(A,E){E&131072&&t!==(t=dn(A[17].distance_before)+"")&&ne(n,t),E&131072&&l!==(l=_n(A[17].time_before)+"")&&ne(i,l),E&131072&&u!==(u=dn(A[17].distance_after)+"")&&ne(c,u),E&131072&&d!==(d=_n(A[17].time_after)+"")&&ne(p,d),E&131072&&v!==(v=(A[17].time_after/A[17].time_before).toFixed(1)+"")&&ne(L,v)},d(A){A&&(k(e),k(a),k(f),k(w),k(S))}}}function Lg(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Sg,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&393216&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Cg(r){let e,t,n;const o=[$e("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function l(s){r[9](s)}let i={$$slots:{default:[Lg]},$$scope:{ctx:r}};for(let s=0;s<o.length;s+=1)i=de(i,o[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new nt({props:i}),Te.push(()=>We(e,"hovered",l)),e.$on("click",r[10]),{c(){F(e.$$.fragment)},m(s,a){P(e,s,a),n=!0},p(s,a){const f=a&8?He(o,[o[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},o[2]]):{};a&262144&&(f.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,f.hovered=s[0],qe(()=>t=!1)),e.$set(f)},i(s){n||(b(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){I(e,s)}}}function Mg(r){let e,t;const n=[$e("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Gt(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function Tg(r){let e;return{c(){e=B("X")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Ag(r){let e,t,n,o,l,i,s,a,f,u,c,_;t=new ir({props:{$$slots:{default:[kg]},$$scope:{ctx:r}}}),o=new Ve({props:{data:r[3],generateId:!0,$$slots:{default:[Cg]},$$scope:{ctx:r}}}),i=new Ve({props:{data:r[2],$$slots:{default:[Mg]},$$scope:{ctx:r}}}),a=new hn({});function d(g){r[11](g)}let p={draggable:!0,$$slots:{default:[Tg]},$$scope:{ctx:r}};return r[1]!==void 0&&(p.lngLat=r[1]),u=new $n({props:p}),Te.push(()=>We(u,"lngLat",d)),{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),l=T(),F(i.$$.fragment),s=T(),F(a.$$.fragment),f=T(),F(u.$$.fragment),j(e,"slot","map")},m(g,w){$(g,e,w),P(t,e,null),m(e,n),P(o,e,null),m(e,l),P(i,e,null),m(e,s),P(a,e,null),m(e,f),P(u,e,null),_=!0},p(g,w){const S={};w&262144&&(S.$$scope={dirty:w,ctx:g}),t.$set(S);const y={};w&8&&(y.data=g[3]),w&262153&&(y.$$scope={dirty:w,ctx:g}),o.$set(y);const v={};w&4&&(v.data=g[2]),w&262144&&(v.$$scope={dirty:w,ctx:g}),i.$set(v);const L={};w&262144&&(L.$$scope={dirty:w,ctx:g}),!c&&w&2&&(c=!0,L.lngLat=g[1],qe(()=>c=!1)),u.$set(L)},i(g){_||(b(t.$$.fragment,g),b(o.$$.fragment,g),b(i.$$.fragment,g),b(a.$$.fragment,g),b(u.$$.fragment,g),_=!0)},o(g){C(t.$$.fragment,g),C(o.$$.fragment,g),C(i.$$.fragment,g),C(a.$$.fragment,g),C(u.$$.fragment,g),_=!1},d(g){g&&k(e),I(t),I(o),I(i),I(a),I(u)}}}function Fg(r){let e,t,n,o;return e=new hs({}),e.$on("contextmenu",r[7]),n=new Ft({props:{$$slots:{map:[Ag],sidebar:[$g],top:[vg]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(l,i){P(e,l,i),$(l,t,i),P(n,l,i),o=!0},p(l,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:l}),n.$set(s)},i(l){o||(b(e.$$.fragment,l),b(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&k(t),I(e,l),I(n,l)}}}function Pg(r,e,t){let n,o,l,i,s,a,f;Z(r,pr,L=>t(1,l=L)),Z(r,ue,L=>t(4,i=L)),Z(r,Yn,L=>t(14,s=L)),Z(r,Zn,L=>t(15,a=L)),Z(r,tt,L=>t(8,f=L));function u(){te(ue,i={mode:"neighbourhood"},i)}let c=null;function _(L){return L?f.compareRoute(new eo.LngLat(L.properties.pt1_x,L.properties.pt1_y),l,1):Yt()}function d(L){te(Zn,a=new eo.LngLat(L.properties.pt1_x,L.properties.pt1_y),a),te(Yn,s=l,s),te(ue,i={mode:"route",prevMode:"impact-one-destination"},i)}function p(L){te(pr,l=L.detail.lngLat,l)}function g(L){c=L,t(0,c)}const w=L=>d(L.detail.features[0]);function S(L){l=L,pr.set(l)}const y=()=>te(ue,i={mode:"title",firstLoad:!1},i),v=()=>te(ue,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&t(3,n=f.impactToOneDestination(l)),r.$$.dirty&1&&t(2,o=_(c))},[c,l,o,n,i,u,d,p,f,g,w,S,y,v]}class Ig extends le{constructor(e){super(),ie(this,e,Pg,Fg,oe,{})}}function di(r,e,t){const n=r.slice();return n[32]=e[t].properties.name,n[33]=e[t].properties.area_km2,n[34]=e[t].properties.simd,n}function Eg(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function jg(r){let e;return{c(){e=h("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function Ng(r){let e;return{c(){e=B("Route")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function zg(r){let e;return{c(){e=B("Predict impact")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Og(r){let e;return{c(){e=B("Debug intersections")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Bg(r){let e;return{c(){e=B("Debug demand")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Rg(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w,S,y,v,L,A,E,M,N;return l=new Ce({props:{$$slots:{default:[Eg]},$$scope:{ctx:r}}}),l.$on("click",r[25]),f=new Ir({props:{$$slots:{default:[jg]},$$scope:{ctx:r}}}),p=new Ce({props:{$$slots:{default:[Ng]},$$scope:{ctx:r}}}),p.$on("click",r[26]),S=new Ce({props:{$$slots:{default:[zg]},$$scope:{ctx:r}}}),S.$on("click",r[27]),L=new Ce({props:{$$slots:{default:[Og]},$$scope:{ctx:r}}}),L.$on("click",r[28]),M=new Ce({props:{$$slots:{default:[Bg]},$$scope:{ctx:r}}}),M.$on("click",r[29]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),a=B(`Pick neighbourhood
          `),F(f.$$.fragment),u=T(),c=h("nav"),_=h("ul"),d=h("li"),F(p.$$.fragment),g=T(),w=h("li"),F(S.$$.fragment),y=T(),v=h("li"),F(L.$$.fragment),A=T(),E=h("li"),F(M.$$.fragment),j(t,"aria-label","breadcrumb"),j(e,"slot","top"),V(e,"display","flex"),V(e,"justify-content","space-between")},m(z,D){$(z,e,D),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),m(s,a),P(f,s,null),m(e,u),m(e,c),m(c,_),m(_,d),P(p,d,null),m(_,g),m(_,w),P(S,w,null),m(_,y),m(_,v),P(L,v,null),m(_,A),m(_,E),P(M,E,null),N=!0},p(z,D){const O={};D[1]&64&&(O.$$scope={dirty:D,ctx:z}),l.$set(O);const R={};D[1]&64&&(R.$$scope={dirty:D,ctx:z}),f.$set(R);const H={};D[1]&64&&(H.$$scope={dirty:D,ctx:z}),p.$set(H);const q={};D[1]&64&&(q.$$scope={dirty:D,ctx:z}),S.$set(q);const X={};D[1]&64&&(X.$$scope={dirty:D,ctx:z}),L.$set(X);const se={};D[1]&64&&(se.$$scope={dirty:D,ctx:z}),M.$set(se)},i(z){N||(b(l.$$.fragment,z),b(f.$$.fragment,z),b(p.$$.fragment,z),b(S.$$.fragment,z),b(L.$$.fragment,z),b(M.$$.fragment,z),N=!0)},o(z){C(l.$$.fragment,z),C(f.$$.fragment,z),C(p.$$.fragment,z),C(S.$$.fragment,z),C(L.$$.fragment,z),C(M.$$.fragment,z),N=!1},d(z){z&&k(e),I(l),I(f),I(p),I(S),I(L),I(M)}}}function Dg(r){let e=r[32]+"",t;return{c(){t=B(e)},m(n,o){$(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[32]+"")&&ne(t,e)},d(n){n&&k(t)}}}function Ug(r){let e,t,n,o=r[34].toFixed(1)+"",l;return{c(){e=h("span"),t=h("b"),t.textContent="SIMD (percentile):",n=T(),l=B(o)},m(i,s){$(i,e,s),m(e,t),m(e,n),m(e,l)},p(i,s){s[0]&1&&o!==(o=i[34].toFixed(1)+"")&&ne(l,o)},d(i){i&&k(e)}}}function Hg(r){let e,t,n,o=r[33].toFixed(1)+"",l,i;return{c(){e=h("span"),t=h("b"),t.textContent="Area:",n=T(),l=B(o),i=B(" km²")},m(s,a){$(s,e,a),m(e,t),m(e,n),m(e,l),m(e,i)},p(s,a){a[0]&1&&o!==(o=s[33].toFixed(1)+"")&&ne(l,o)},d(s){s&&k(e)}}}function _i(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g;function w(){return r[18](r[32])}o=new Ce({props:{$$slots:{default:[Dg]},$$scope:{ctx:r}}}),o.$on("click",w),a=new Co({props:{color:"black"}});function S(){return r[19](r[32])}c=new gs({props:{color:"white"}});function y(){return r[20](r[32])}function v(M,N){if(M[1]=="area")return Hg;if(M[1]=="simd")return Ug}let L=v(r),A=L&&L(r);function E(){return r[21](r[32])}return{c(){var M;e=h("li"),t=h("span"),n=h("span"),F(o.$$.fragment),l=T(),i=h("span"),s=h("button"),F(a.$$.fragment),f=T(),u=h("button"),F(c.$$.fragment),_=T(),A&&A.c(),j(n,"class","neighbourhood-name svelte-v2avug"),j(s,"class","outline icon-btn"),j(s,"aria-label","Rename neighbourhood"),j(u,"class","icon-btn destructive"),j(u,"aria-label","Delete neighbourhood"),V(i,"display","flex"),V(i,"gap","16px"),V(t,"display","flex"),V(t,"justify-content","space-between"),j(e,"class","svelte-v2avug"),mt(e,"highlighted",((M=r[3])==null?void 0:M.properties.name)==r[32])},m(M,N){$(M,e,N),m(e,t),m(t,n),P(o,n,null),m(t,l),m(t,i),m(i,s),P(a,s,null),m(i,f),m(i,u),P(c,u,null),m(e,_),A&&A.m(e,null),d=!0,p||(g=[x(s,"click",S),x(u,"click",y),x(e,"mouseenter",E),x(e,"mouseleave",r[22])],p=!0)},p(M,N){var D;r=M;const z={};N[0]&1|N[1]&64&&(z.$$scope={dirty:N,ctx:r}),o.$set(z),L===(L=v(r))&&A?A.p(r,N):(A&&A.d(1),A=L&&L(r),A&&(A.c(),A.m(e,null))),(!d||N[0]&9)&&mt(e,"highlighted",((D=r[3])==null?void 0:D.properties.name)==r[32])},i(M){d||(b(o.$$.fragment,M),b(a.$$.fragment,M),b(c.$$.fragment,M),d=!0)},o(M){C(o.$$.fragment,M),C(a.$$.fragment,M),C(c.$$.fragment,M),d=!1},d(M){M&&k(e),I(o),I(a),I(c),A&&A.d(),p=!1,ft(g)}}}function Gg(r){let e,t,n;return e=new Co({}),{c(){F(e.$$.fragment),t=B(`
              Draw a new boundary`)},m(o,l){P(e,o,l),$(o,t,l),n=!0},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){o&&k(t),I(e,o)}}}function Wg(r){let e,t,n;return e=new Zf({}),{c(){F(e.$$.fragment),t=B(`
              Use a generated boundary`)},m(o,l){P(e,o,l),$(o,t,l),n=!0},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){o&&k(t),I(e,o)}}}function pi(r){let e,t,n,o,l,i,s,a,f;function u(_){r[24](_)}let c={};return r[1]!==void 0&&(c.selectedPrioritization=r[1]),l=new Ls({props:c}),Te.push(()=>We(l,"selectedPrioritization",u)),{c(){e=h("h3"),e.textContent="Prioritization",t=T(),n=h("p"),n.textContent="Compare metrics across your neighbourhoods.",o=T(),F(l.$$.fragment),s=T(),a=h("hr")},m(_,d){$(_,e,d),$(_,t,d),$(_,n,d),$(_,o,d),P(l,_,d),$(_,s,d),$(_,a,d),f=!0},p(_,d){const p={};!i&&d[0]&2&&(i=!0,p.selectedPrioritization=_[1],qe(()=>i=!1)),l.$set(p)},i(_){f||(b(l.$$.fragment,_),f=!0)},o(_){C(l.$$.fragment,_),f=!1},d(_){_&&(k(e),k(t),k(n),k(o),k(s),k(a)),I(l,_)}}}function qg(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g=r[5].startsWith("ltn_cnt/"),w,S,y,v,L,A,E=r[4].modalFilters+"",M,N,z,D,O=r[4].deletedModalFilters+"",R,H,q,X,se=r[4].travelFlows+"",ce,U,be,ge,ae,we,fe,Pe,Xe,Ae=Me(r[0].features),re=[];for(let ke=0;ke<Ae.length;ke+=1)re[ke]=_i(di(r,Ae,ke));const Ke=ke=>C(re[ke],1,1,()=>{re[ke]=null});u=new Ce({props:{$$slots:{default:[Gg]},$$scope:{ctx:r}}}),u.$on("click",r[10]),d=new Ce({props:{$$slots:{default:[Wg]},$$scope:{ctx:r}}}),d.$on("click",r[23]);let Ne=g&&pi(r);return{c(){e=h("div"),t=h("h3"),t.textContent="Neighbourhoods",n=T(),o=h("ul");for(let ke=0;ke<re.length;ke+=1)re[ke].c();l=T(),i=h("li"),s=B(`Add a new neighbourhood:
        `),a=h("ul"),f=h("li"),F(u.$$.fragment),c=T(),_=h("li"),F(d.$$.fragment),p=T(),Ne&&Ne.c(),w=T(),S=h("p"),y=B("Current project: "),v=B(r[5]),L=T(),A=h("p"),M=B(E),N=B(" new modal filter(s) added"),z=T(),D=h("p"),R=B(O),H=B(`
      existing modal filter(s) removed`),q=T(),X=h("p"),ce=B(se),U=B(" road segment direction(s) changed"),be=T(),ge=h("button"),ge.textContent="Export project to GeoJSON",ae=T(),we=h("button"),we.textContent="Debug route-snapper",V(t,"padding","4px 8px"),V(t,"margin-bottom","0"),V(f,"list-style","none"),V(_,"list-style","none"),V(a,"margin-bottom","0"),V(a,"padding","0"),j(i,"class","svelte-v2avug"),j(o,"class","neighbourhood-list svelte-v2avug"),j(we,"class","secondary"),j(e,"slot","sidebar")},m(ke,K){$(ke,e,K),m(e,t),m(e,n),m(e,o);for(let pe=0;pe<re.length;pe+=1)re[pe]&&re[pe].m(o,null);m(o,l),m(o,i),m(i,s),m(i,a),m(a,f),P(u,f,null),m(a,c),m(a,_),P(d,_,null),m(e,p),Ne&&Ne.m(e,null),m(e,w),m(e,S),m(S,y),m(S,v),m(e,L),m(e,A),m(A,M),m(A,N),m(e,z),m(e,D),m(D,R),m(D,H),m(e,q),m(e,X),m(X,ce),m(X,U),m(e,be),m(e,ge),m(e,ae),m(e,we),fe=!0,Pe||(Xe=[x(ge,"click",r[11]),x(we,"click",r[12])],Pe=!0)},p(ke,K){if(K[0]&911){Ae=Me(ke[0].features);let me;for(me=0;me<Ae.length;me+=1){const he=di(ke,Ae,me);re[me]?(re[me].p(he,K),b(re[me],1)):(re[me]=_i(he),re[me].c(),b(re[me],1),re[me].m(o,l))}for(ye(),me=Ae.length;me<re.length;me+=1)Ke(me);ve()}const pe={};K[1]&64&&(pe.$$scope={dirty:K,ctx:ke}),u.$set(pe);const Q={};K[1]&64&&(Q.$$scope={dirty:K,ctx:ke}),d.$set(Q),K[0]&32&&(g=ke[5].startsWith("ltn_cnt/")),g?Ne?(Ne.p(ke,K),K[0]&32&&b(Ne,1)):(Ne=pi(ke),Ne.c(),b(Ne,1),Ne.m(e,w)):Ne&&(ye(),C(Ne,1,1,()=>{Ne=null}),ve()),(!fe||K[0]&32)&&ne(v,ke[5]),(!fe||K[0]&16)&&E!==(E=ke[4].modalFilters+"")&&ne(M,E),(!fe||K[0]&16)&&O!==(O=ke[4].deletedModalFilters+"")&&ne(R,O),(!fe||K[0]&16)&&se!==(se=ke[4].travelFlows+"")&&ne(ce,se)},i(ke){if(!fe){for(let K=0;K<Ae.length;K+=1)b(re[K]);b(u.$$.fragment,ke),b(d.$$.fragment,ke),b(Ne),fe=!0}},o(ke){re=re.filter(Boolean);for(let K=0;K<re.length;K+=1)C(re[K]);C(u.$$.fragment,ke),C(d.$$.fragment,ke),C(Ne),fe=!1},d(ke){ke&&k(e),ut(re,ke),I(u),I(d),Ne&&Ne.d(),Pe=!1,ft(Xe)}}}function Jg(r){let e,t,n=(r[31].number_stats19_collisions/r[31].area_km2).toFixed(1)+"",o;return{c(){e=h("b"),e.textContent=`Density of pedestrian and cyclist collisions (collisions per
              square meter):`,t=T(),o=B(n)},m(l,i){$(l,e,i),$(l,t,i),$(l,o,i)},p(l,i){i[1]&1&&n!==(n=(l[31].number_stats19_collisions/l[31].area_km2).toFixed(1)+"")&&ne(o,n)},d(l){l&&(k(e),k(t),k(o))}}}function Yg(r){let e,t,n=r[31].simd.toFixed(1)+"",o;return{c(){e=h("b"),e.textContent="Fake SIMD:",t=T(),o=B(n)},m(l,i){$(l,e,i),$(l,t,i),$(l,o,i)},p(l,i){i[1]&1&&n!==(n=l[31].simd.toFixed(1)+"")&&ne(o,n)},d(l){l&&(k(e),k(t),k(o))}}}function Zg(r){let e,t,n=r[31].area_km2.toFixed(1)+"",o,l;return{c(){e=h("b"),e.textContent="Area:",t=T(),o=B(n),l=B(" km²")},m(i,s){$(i,e,s),$(i,t,s),$(i,o,s),$(i,l,s)},p(i,s){s[1]&1&&n!==(n=i[31].area_km2.toFixed(1)+"")&&ne(o,n)},d(i){i&&(k(e),k(t),k(o),k(l))}}}function Kg(r){let e,t=r[31].name+"",n,o,l;function i(f,u){if(f[1]=="none"||f[1]=="area")return Zg;if(f[1]=="simd")return Yg;if(f[1]=="stats19")return Jg}let s=i(r),a=s&&s(r);return{c(){e=h("h2"),n=B(t),o=T(),a&&a.c(),l=Je()},m(f,u){$(f,e,u),m(e,n),$(f,o,u),a&&a.m(f,u),$(f,l,u)},p(f,u){u[1]&1&&t!==(t=f[31].name+"")&&ne(n,t),s===(s=i(f))&&a?a.p(f,u):(a&&a.d(1),a=s&&s(f),a&&(a.c(),a.m(l.parentNode,l)))},d(f){f&&(k(e),k(o),k(l)),a&&a.d(f)}}}function Xg(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Kg,({props:n})=>({31:n}),({props:n})=>[0,n?1:0]]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o[0]&2|o[1]&65&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Vg(r){let e,t,n,o,l;e=new mu({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const i=[$e("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function s(f){r[16](f)}let a={$$slots:{default:[Xg]},$$scope:{ctx:r}};for(let f=0;f<i.length;f+=1)a=de(a,i[f]);return r[3]!==void 0&&(a.hovered=r[3]),n=new At({props:a}),Te.push(()=>We(n,"hovered",s)),n.$on("click",r[17]),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),l=!0},p(f,u){const c={};u[0]&4&&(c.data=f[2]?[{name:f[2],highlight:"yes"}]:[]),e.$set(c);const _=u[0]&24578?He(i,[i[0],i[1],{paint:{"fill-color":f[13](f[1]),"fill-opacity":f[14](f[1])}},i[3],i[4]]):{};u[0]&2|u[1]&64&&(_.$$scope={dirty:u,ctx:f}),!o&&u[0]&8&&(o=!0,_.hovered=f[3],qe(()=>o=!1)),n.$set(_)},i(f){l||(b(e.$$.fragment,f),b(n.$$.fragment,f),l=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),l=!1},d(f){f&&k(t),I(e,f),I(n,f)}}}function Qg(r){let e,t,n,o,l;return t=new Ve({props:{data:r[0],promoteId:"name",$$slots:{default:[Vg]},$$scope:{ctx:r}}}),o=new hn({}),{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),j(e,"slot","map")},m(i,s){$(i,e,s),P(t,e,null),m(e,n),P(o,e,null),l=!0},p(i,s){const a={};s[0]&1&&(a.data=i[0]),s[0]&14|s[1]&64&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&k(e),I(t),I(o)}}}function xg(r){let e,t;return e=new Ft({props:{$$slots:{map:[Qg],sidebar:[qg],top:[Rg]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o[0]&127|o[1]&64&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function e1(r){let e=0,t=0,n=0;for(let o of r.features)o.properties.kind=="modal_filter"?e++:o.properties.kind=="deleted_existing_modal_filter"?t++:o.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function t1(r,e,t){let n,o,l,i,s,a;Z(r,tt,U=>t(15,l=U)),Z(r,Zt,U=>t(5,i=U)),Z(r,ue,U=>t(6,s=U)),Z(r,Jn,U=>t(30,a=U));let f="none",u=null,c=null;function _(U){l.setCurrentNeighbourhood(U,a),te(ue,s={mode:"neighbourhood"},s)}function d(U){window.confirm(`Really delete neighbourhood ${U}? You can't undo this.`)&&(l.deleteNeighbourhoodBoundary(U),Mn(),t(0,n=l.getAllNeighbourhoods()))}function p(U){let be=_o(l,`Rename neighbourhood ${U} to what?`,U);be&&(l.renameNeighbourhoodBoundary(U,be),Mn(),t(0,n=l.getAllNeighbourhoods()))}function g(){let U=_o(l,"What do you want to name the neighbourhood?","");U&&te(ue,s={mode:"set-boundary",name:U,existing:null},s)}function w(){kr(i+".geojson",JSON.stringify(l.toSavefile()))}function S(){kr("debug_route_snapper.geojson",l.toRouteSnapperGj())}function y(U){let be={none:"black",simd:St(["get","simd"],or,on),area:St(["get","area_km2"],Mo,on),stats19:St(["/",["get","number_stats19_collisions"],["get","area_km2"]],To,Ao)}[U];return["case",["==",["feature-state","highlight"],"yes"],"yellow",be]}function v(U){return{none:ot(.3,.5),simd:ot(.7,.9),area:ot(.7,.9),stats19:ot(.7,.9)}[U]}function L(U){c=U,t(3,c)}const A=U=>_(ct(U.detail.features[0].properties).name),E=U=>_(U),M=U=>p(U),N=U=>d(U),z=U=>t(2,u=U),D=()=>t(2,u=null),O=()=>te(ue,s={mode:"auto-boundaries"},s);function R(U){f=U,t(1,f)}const H=()=>te(ue,s={mode:"title",firstLoad:!1},s),q=()=>te(ue,s={mode:"route",prevMode:"pick-neighbourhood"},s),X=()=>te(ue,s={mode:"predict-impact"},s),se=()=>te(ue,s={mode:"debug-intersections"},s),ce=()=>te(ue,s={mode:"debug-demand"},s);return r.$$.update=()=>{r.$$.dirty[0]&32768&&t(0,n=l.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,o=e1(n))},[n,f,u,c,o,i,s,_,d,p,g,w,S,y,v,l,L,A,E,M,N,z,D,O,R,H,q,X,se,ce]}class n1 extends le{constructor(e){super(),ie(this,e,t1,xg,oe,{},null,[-1,-1])}}function r1(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function o1(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function l1(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Ce({props:{$$slots:{default:[r1]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[o1]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),u.textContent="Predict impact",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(_,d){$(_,e,d),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),c=!0},p(_,d){const p={};d&1024&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&k(e),I(l),I(a)}}}function i1(r){let e,t,n,o,l,i,s,a,f;return t=new gn({}),t.$on("click",r[5]),{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,l=T(),i=h("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=T(),a=h("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,j(e,"slot","sidebar")},m(u,c){$(u,e,c),P(t,e,null),m(e,n),m(e,o),m(e,l),m(e,i),m(e,s),m(e,a),f=!0},p:Y,i(u){f||(b(t.$$.fragment,u),f=!0)},o(u){C(t.$$.fragment,u),f=!1},d(u){u&&k(e),I(t)}}}function s1(r){let e,t=r[9].before.toLocaleString()+"",n,o,l=r[9].after.toLocaleString()+"",i,s,a,f,u=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=h("p"),n=B(t),o=B(" before, "),i=B(l),s=B(`
            after`),a=T(),f=h("p"),c=B(u),_=B("%")},m(d,p){$(d,e,p),m(e,n),m(e,o),m(e,i),m(e,s),$(d,a,p),$(d,f,p),m(f,c),m(f,_)},p(d,p){p&512&&t!==(t=d[9].before.toLocaleString()+"")&&ne(n,t),p&512&&l!==(l=d[9].after.toLocaleString()+"")&&ne(i,l),p&512&&u!==(u=Math.round(100*d[9].after/d[9].before)+"")&&ne(c,u)},d(d){d&&(k(e),k(a),k(f))}}}function a1(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[s1,({props:n})=>({9:n}),({props:n})=>n?512:0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&1536&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function f1(r){let e,t;const n=[$e("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,mi,r[2].max_count,gi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[a1]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),e.$on("click",r[4]),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s=i&6?He(n,[n[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,mi,l[2].max_count,gi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,l[1][0],50,l[1][1],100,l[1][2],150,l[1][3],200,l[1][4]]]}},n[2],n[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function u1(r){let e,t,n,o,l;return t=new Ve({props:{data:r[2],generateId:!0,$$slots:{default:[f1]},$$scope:{ctx:r}}}),o=new hn({}),{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),j(e,"slot","map")},m(i,s){$(i,e,s),P(t,e,null),m(e,n),P(o,e,null),l=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&k(e),I(t),I(o)}}}function c1(r){let e,t;return e=new Ft({props:{$$slots:{map:[u1],sidebar:[i1],top:[l1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&1025&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}let mi=3,gi=10;function d1(r,e,t){let n,o;Z(r,ue,_=>t(0,n=_)),Z(r,tt,_=>t(8,o=_));let l=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=o.predictImpact();function s(_){te(ue,n={mode:"impact-detail",road:_},n)}return[n,l,i,s,_=>s(_.detail.features[0]),()=>te(ue,n={mode:"pick-neighbourhood"},n),()=>te(ue,n={mode:"title",firstLoad:!1},n),()=>te(ue,n={mode:"pick-neighbourhood"},n)]}class _1 extends le{constructor(e){super(),ie(this,e,d1,c1,oe,{})}}function p1(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function m1(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function hi(r){let e,t,n;return t=new Ce({props:{$$slots:{default:[g1]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=h("li"),F(t.$$.fragment)},m(o,l){$(o,e,l),P(t,e,null),n=!0},p(o,l){const i={};l&16384&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function g1(r){let e;return{c(){e=B("Editing")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function h1(r){let e,t,n,o,l,i,s,a,f,u,c,_;l=new Ce({props:{$$slots:{default:[p1]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Ce({props:{$$slots:{default:[m1]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&hi(r);return{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),d&&d.c(),u=T(),c=h("li"),c.textContent="Routing",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(p,g){$(p,e,g),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),d&&d.m(n,null),m(n,u),m(n,c),_=!0},p(p,g){const w={};g&16384&&(w.$$scope={dirty:g,ctx:p}),l.$set(w);const S={};g&16384&&(S.$$scope={dirty:g,ctx:p}),a.$set(S),p[0]=="neighbourhood"?d?(d.p(p,g),g&1&&b(d,1)):(d=hi(p),d.c(),b(d,1),d.m(n,u)):d&&(ye(),C(d,1,1,()=>{d=null}),ve())},i(p){_||(b(l.$$.fragment,p),b(a.$$.fragment,p),b(d),_=!0)},o(p){C(l.$$.fragment,p),C(a.$$.fragment,p),C(d),_=!1},d(p){p&&k(e),I(l),I(a),d&&d.d()}}}function bi(r){let e,t,n,o=dn(r[4].features[0].properties.distance)+"",l,i,s=_n(r[4].features[0].properties.time)+"",a,f,u,c,_,d=dn(r[4].features[1].properties.distance)+"",p,g,w=_n(r[4].features[1].properties.time)+"",S;return{c(){e=h("p"),t=h("span"),t.textContent="Route before",n=B(`
        : `),l=B(o),i=B(", "),a=B(s),f=T(),u=h("p"),c=h("span"),c.textContent="Route after",_=B(`
        : `),p=B(d),g=B(", "),S=B(w),V(t,"color","red"),V(c,"color","blue")},m(y,v){$(y,e,v),m(e,t),m(e,n),m(e,l),m(e,i),m(e,a),$(y,f,v),$(y,u,v),m(u,c),m(u,_),m(u,p),m(u,g),m(u,S)},p(y,v){v&16&&o!==(o=dn(y[4].features[0].properties.distance)+"")&&ne(l,o),v&16&&s!==(s=_n(y[4].features[0].properties.time)+"")&&ne(a,s),v&16&&d!==(d=dn(y[4].features[1].properties.distance)+"")&&ne(p,d),v&16&&w!==(w=_n(y[4].features[1].properties.time)+"")&&ne(S,w)},d(y){y&&(k(e),k(f),k(u))}}}function b1(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w;t=new gn({}),t.$on("click",r[6]);let S=r[4].features.length==2&&bi(r);return{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent="Drag markers for a route",l=T(),S&&S.c(),i=T(),s=h("label"),a=B("Slow-down factor for main roads: "),f=B(r[1]),u=T(),c=h("input"),_=T(),d=h("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,j(c,"type","range"),j(c,"min","1.0"),j(c,"max","5.0"),j(c,"step","0.1"),j(e,"slot","sidebar")},m(y,v){$(y,e,v),P(t,e,null),m(e,n),m(e,o),m(e,l),S&&S.m(e,null),m(e,i),m(e,s),m(s,a),m(s,f),m(s,u),m(s,c),Oe(c,r[1]),m(e,_),m(e,d),p=!0,g||(w=[x(c,"change",r[10]),x(c,"input",r[10])],g=!0)},p(y,v){y[4].features.length==2?S?S.p(y,v):(S=bi(y),S.c(),S.m(e,i)):S&&(S.d(1),S=null),(!p||v&2)&&ne(f,y[1]),v&2&&Oe(c,y[1])},i(y){p||(b(t.$$.fragment,y),p=!0)},o(y){C(t.$$.fragment,y),p=!1},d(y){y&&k(e),I(t),S&&S.d(),g=!1,ft(w)}}}function wi(r){let e,t;return e=new ir({props:{$$slots:{default:[w1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function w1(r){let e,t,n,o,l,i,s,a;return e=new Nr({}),n=new jr({}),l=new zr({}),s=new lr({props:{interactive:!1}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment),i=T(),F(s.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),$(f,o,u),P(l,f,u),$(f,i,u),P(s,f,u),a=!0},p:Y,i(f){a||(b(e.$$.fragment,f),b(n.$$.fragment,f),b(l.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),C(l.$$.fragment,f),C(s.$$.fragment,f),a=!1},d(f){f&&(k(t),k(o),k(i)),I(e,f),I(n,f),I(l,f),I(s,f)}}}function y1(r){let e,t;const n=[$e("compare-route"),{paint:{"line-width":10,"line-color":Gt(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function v1(r){let e;return{c(){e=B("A")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function $1(r){let e;return{c(){e=B("B")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function k1(r){let e,t,n,o,l,i,s,a,f,u,c,_,d=r[0]=="neighbourhood"&&wi(r);n=new hn({}),l=new Ve({props:{data:r[4],$$slots:{default:[y1]},$$scope:{ctx:r}}});function p(y){r[8](y)}let g={draggable:!0,$$slots:{default:[v1]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new $n({props:g}),Te.push(()=>We(s,"lngLat",p));function w(y){r[9](y)}let S={draggable:!0,$$slots:{default:[$1]},$$scope:{ctx:r}};return r[2]!==void 0&&(S.lngLat=r[2]),u=new $n({props:S}),Te.push(()=>We(u,"lngLat",w)),{c(){e=h("div"),d&&d.c(),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment),i=T(),F(s.$$.fragment),f=T(),F(u.$$.fragment),j(e,"slot","map")},m(y,v){$(y,e,v),d&&d.m(e,null),m(e,t),P(n,e,null),m(e,o),P(l,e,null),m(e,i),P(s,e,null),m(e,f),P(u,e,null),_=!0},p(y,v){y[0]=="neighbourhood"?d?v&1&&b(d,1):(d=wi(y),d.c(),b(d,1),d.m(e,t)):d&&(ye(),C(d,1,1,()=>{d=null}),ve());const L={};v&16&&(L.data=y[4]),v&16384&&(L.$$scope={dirty:v,ctx:y}),l.$set(L);const A={};v&16384&&(A.$$scope={dirty:v,ctx:y}),!a&&v&8&&(a=!0,A.lngLat=y[3],qe(()=>a=!1)),s.$set(A);const E={};v&16384&&(E.$$scope={dirty:v,ctx:y}),!c&&v&4&&(c=!0,E.lngLat=y[2],qe(()=>c=!1)),u.$set(E)},i(y){_||(b(d),b(n.$$.fragment,y),b(l.$$.fragment,y),b(s.$$.fragment,y),b(u.$$.fragment,y),_=!0)},o(y){C(d),C(n.$$.fragment,y),C(l.$$.fragment,y),C(s.$$.fragment,y),C(u.$$.fragment,y),_=!1},d(y){y&&k(e),d&&d.d(),I(n),I(l),I(s),I(u)}}}function S1(r){let e,t;return e=new Ft({props:{$$slots:{map:[k1],sidebar:[b1],top:[h1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&16447&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function L1(r,e,t){let n,o,l,i,s,a;Z(r,ue,S=>t(5,o=S)),Z(r,No,S=>t(1,l=S)),Z(r,Yn,S=>t(2,i=S)),Z(r,Zn,S=>t(3,s=S)),Z(r,tt,S=>t(7,a=S));let{prevMode:f}=e;function u(){te(ue,o={mode:f},o)}function c(S){s=S,Zn.set(s)}function _(S){i=S,Yn.set(i)}function d(){l=yn(this.value),No.set(l)}const p=()=>te(ue,o={mode:"title",firstLoad:!1},o),g=()=>te(ue,o={mode:"pick-neighbourhood"},o),w=()=>te(ue,o={mode:"neighbourhood"},o);return r.$$set=S=>{"prevMode"in S&&t(0,f=S.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&t(4,n=a.compareRoute(s,i,l))},[f,l,i,s,n,o,u,a,c,_,d,p,g,w]}class C1 extends le{constructor(e){super(),ie(this,e,L1,S1,oe,{prevMode:0})}}let An=Mt(null);const zt=Mt([]);function Ts(r){if(r.length<3)return JSON.parse(Wt(An).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(Wt(An).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:M1}=Xi,T1=r=>({}),yi=r=>({}),A1=r=>({}),vi=r=>({});function $i(r,e,t){const n=r.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function ki(r,e,t){const n=r.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function F1(r){let e,t;const n=r[24]["extra-top"],o=Be(n,r,r[38],yi);return{c(){e=h("div"),o&&o.c(),j(e,"slot","top")},m(l,i){$(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i[1]&128)&&Re(o,n,l,l[38],t?Ue(n,l[38],i,T1):De(l[38]),yi)},i(l){t||(b(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&k(e),o&&o.d(l)}}}function P1(r){let e,t,n,o,l;return{c(){e=h("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=T(),n=h("p"),n.textContent="Keyboard shortcuts:",o=T(),l=h("ul"),l.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){$(i,e,s),$(i,t,s),$(i,n,s),$(i,o,s),$(i,l,s)},p:Y,d(i){i&&(k(e),k(t),k(n),k(o),k(l))}}}function I1(r){let e,t=r[8].length+"",n,o;return{c(){e=B("Undo ("),n=B(t),o=B(")")},m(l,i){$(l,e,i),$(l,n,i),$(l,o,i)},p(l,i){i[0]&256&&t!==(t=l[8].length+"")&&ne(n,t)},d(l){l&&(k(e),k(n),k(o))}}}function E1(r){let e;return{c(){e=B("Undo")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function j1(r){let e;return{c(){e=h("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function N1(r){let e,t,n,o,l,i,s,a,f,u,c,_,d;return c=Vi(r[36][0]),{c(){e=h("fieldset"),t=h("label"),n=h("input"),o=B(`
          Snap to roads`),l=T(),i=h("label"),s=h("input"),a=B(`
          Draw anywhere`),f=T(),u=h("p"),u.textContent="Click to add at least 3 points",j(n,"type","radio"),n.__value="snap",Oe(n,n.__value),j(s,"type","radio"),s.__value="free",Oe(s,s.__value),c.p(n,s)},m(p,g){$(p,e,g),m(e,t),m(t,n),n.checked=n.__value===r[7],m(t,o),m(e,l),m(e,i),m(i,s),s.checked=s.__value===r[7],m(i,a),$(p,f,g),$(p,u,g),_||(d=[x(n,"change",r[35]),x(s,"change",r[37])],_=!0)},p(p,g){g[0]&128&&(n.checked=n.__value===p[7]),g[0]&128&&(s.checked=s.__value===p[7])},d(p){p&&(k(e),k(f),k(u)),c.r(),_=!1,ft(d)}}}function z1(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p,g,w,S;const y=r[24]["extra-sidebar"],v=Be(y,r,r[38],vi);u=new Ir({props:{$$slots:{default:[P1]},$$scope:{ctx:r}}});function L(D,O){return D[8].length==0?E1:I1}let A=L(r),E=A(r);function M(D,O){return D[5].length<3?N1:j1}let N=M(r),z=N(r);return{c(){e=h("div"),v&&v.c(),t=T(),n=h("div"),o=h("button"),l=B("Finish"),s=T(),a=h("button"),a.textContent="Cancel",f=T(),F(u.$$.fragment),c=T(),_=h("button"),E.c(),p=T(),z.c(),o.disabled=i=r[5].length<3,j(a,"class","secondary"),V(n,"display","flex"),j(_,"class","secondary"),_.disabled=d=r[8].length==0,j(e,"slot","sidebar")},m(D,O){$(D,e,O),v&&v.m(e,null),m(e,t),m(e,n),m(n,o),m(o,l),m(n,s),m(n,a),m(n,f),P(u,n,null),m(e,c),m(e,_),E.m(_,null),m(e,p),z.m(e,null),g=!0,w||(S=[x(o,"click",function(){Xr(r[0])&&r[0].apply(this,arguments)}),x(a,"click",function(){Xr(r[1])&&r[1].apply(this,arguments)}),x(_,"click",r[11])],w=!0)},p(D,O){r=D,v&&v.p&&(!g||O[1]&128)&&Re(v,y,r,r[38],g?Ue(y,r[38],O,A1):De(r[38]),vi),(!g||O[0]&32&&i!==(i=r[5].length<3))&&(o.disabled=i);const R={};O[1]&128&&(R.$$scope={dirty:O,ctx:r}),u.$set(R),A===(A=L(r))&&E?E.p(r,O):(E.d(1),E=A(r),E&&(E.c(),E.m(_,null))),(!g||O[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),N===(N=M(r))&&z?z.p(r,O):(z.d(1),z=N(r),z&&(z.c(),z.m(e,null)))},i(D){g||(b(v,D),b(u.$$.fragment,D),g=!0)},o(D){C(v,D),C(u.$$.fragment,D),g=!1},d(D){D&&k(e),v&&v.d(D),I(u),E.d(),z.d(),w=!1,ft(S)}}}function O1(r){let e;return{c(){e=h("span"),j(e,"class","dot svelte-1cj4rwq"),mt(e,"snapped-node",r[47].snapped),mt(e,"free-node",!r[47].snapped),mt(e,"hide",r[4])},m(t,n){$(t,e,n)},p(t,n){n[0]&512&&mt(e,"snapped-node",t[47].snapped),n[0]&512&&mt(e,"free-node",!t[47].snapped),n[0]&16&&mt(e,"hide",t[4])},d(t){t&&k(e)}}}function Si(r){let e,t,n;function o(f){r[25](f,r[47])}function l(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[O1]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new Pr({props:a}),Te.push(()=>We(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){F(e.$$.fragment)},m(f,u){P(e,f,u),n=!0},p(f,u){r=f;const c={};u[0]&528|u[1]&128&&(c.$$scope={dirty:u,ctx:r}),!t&&u[0]&512&&(t=!0,c.lngLat=r[47].point,qe(()=>t=!1)),e.$set(c)},i(f){n||(b(e.$$.fragment,f),n=!0)},o(f){C(e.$$.fragment,f),n=!1},d(f){I(e,f)}}}function B1(r){let e;return{c(){e=h("span"),e.textContent=`${r[46]+1}`,j(e,"class","dot svelte-1cj4rwq"),mt(e,"snapped",r[44].snapped)},m(t,n){$(t,e,n)},p(t,n){n[0]&32&&mt(e,"snapped",t[44].snapped)},d(t){t&&k(e)}}}function Li(r){let e,t,n;function o(a){r[29](a,r[44])}function l(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[B1]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new Pr({props:s}),Te.push(()=>We(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){F(e.$$.fragment)},m(a,f){P(e,a,f),n=!0},p(a,f){r=a;const u={};f[0]&32|f[1]&128&&(u.$$scope={dirty:f,ctx:r}),!t&&f[0]&32&&(t=!0,u.lngLat=r[44].point,qe(()=>t=!1)),e.$set(u)},i(a){n||(b(e.$$.fragment,a),n=!0)},o(a){C(e.$$.fragment,a),n=!1},d(a){I(e,a)}}}function R1(r){let e,t,n,o;const l=[$e("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let f=0;f<l.length;f+=1)i=de(i,l[f]);e=new nt({props:i});const s=[$e("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let f=0;f<s.length;f+=1)a=de(a,s[f]);return n=new At({props:a}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),o=!0},p(f,u){const c={};e.$set(c);const _={};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),o=!1},d(f){f&&k(t),I(e,f),I(n,f)}}}function D1(r){let e,t;return e=new nt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function U1(r){let e,t,n,o,l,i,s,a,f;t=new hs({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let u=Me(r[9]),c=[];for(let w=0;w<u.length;w+=1)c[w]=Si(ki(r,u,w));const _=w=>C(c[w],1,1,()=>{c[w]=null});let d=Me(r[5]),p=[];for(let w=0;w<d.length;w+=1)p[w]=Li($i(r,d,w));const g=w=>C(p[w],1,1,()=>{p[w]=null});return i=new Ve({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[R1]},$$scope:{ctx:r}}}),a=new Ve({props:{data:r[10],$$slots:{default:[D1]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),n=T();for(let w=0;w<c.length;w+=1)c[w].c();o=T();for(let w=0;w<p.length;w+=1)p[w].c();l=T(),F(i.$$.fragment),s=T(),F(a.$$.fragment),j(e,"slot","map")},m(w,S){$(w,e,S),P(t,e,null),m(e,n);for(let y=0;y<c.length;y+=1)c[y]&&c[y].m(e,null);m(e,o);for(let y=0;y<p.length;y+=1)p[y]&&p[y].m(e,null);m(e,l),P(i,e,null),m(e,s),P(a,e,null),f=!0},p(w,S){if(S[0]&918032){u=Me(w[9]);let L;for(L=0;L<u.length;L+=1){const A=ki(w,u,L);c[L]?(c[L].p(A,S),b(c[L],1)):(c[L]=Si(A),c[L].c(),b(c[L],1),c[L].m(e,o))}for(ye(),L=u.length;L<c.length;L+=1)_(L);ve()}if(S[0]&2146348){d=Me(w[5]);let L;for(L=0;L<d.length;L+=1){const A=$i(w,d,L);p[L]?(p[L].p(A,S),b(p[L],1)):(p[L]=Li(A),p[L].c(),b(p[L],1),p[L].m(e,l))}for(ye(),L=d.length;L<p.length;L+=1)g(L);ve()}const y={};S[0]&96&&(y.data=w[16](w[6],w[5])),S[1]&128&&(y.$$scope={dirty:S,ctx:w}),i.$set(y);const v={};S[0]&1024&&(v.data=w[10]),S[1]&128&&(v.$$scope={dirty:S,ctx:w}),a.$set(v)},i(w){if(!f){b(t.$$.fragment,w);for(let S=0;S<u.length;S+=1)b(c[S]);for(let S=0;S<d.length;S+=1)b(p[S]);b(i.$$.fragment,w),b(a.$$.fragment,w),f=!0}},o(w){C(t.$$.fragment,w),c=c.filter(Boolean);for(let S=0;S<c.length;S+=1)C(c[S]);p=p.filter(Boolean);for(let S=0;S<p.length;S+=1)C(p[S]);C(i.$$.fragment,w),C(a.$$.fragment,w),f=!1},d(w){w&&k(e),I(t),ut(c,w),ut(p,w),I(i),I(a)}}}function H1(r){let e,t,n,o;return e=new Ft({props:{$$slots:{map:[U1],sidebar:[z1],top:[F1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0,n||(o=x(M1,"keydown",r[20]),n=!0)},p(l,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l),n=!1,o()}}}function G1(r,e,t){let n,o,l;Z(r,zt,K=>t(5,o=K)),Z(r,An,K=>t(6,l=K));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:f}=e,{cancel:u}=e;Tt(()=>{te(zt,o=[],o),l==null||l.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],p=null,g=!1,w=!1,S=!1;function y(K){let pe=K.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=pe}function v(){let K=_.pop();t(8,_),K&&te(zt,o=K,o)}function L(){_.length==100&&_.shift(),t(8,_=[..._,JSON.parse(JSON.stringify(o))])}function A(){t(7,c=c=="snap"?"free":"snap"),p&&t(23,p.snapped=c=="snap",p)}function E(K){o.length>=3||(L(),zt.update(pe=>(pe.push({point:K.detail.lngLat.toArray(),snapped:c=="snap"}),pe)))}function M(K){t(23,p={point:K.detail.lngLat.toArray(),snapped:c=="snap"})}function N(K){L(),zt.update(pe=>(pe[K].snapped=!pe[K].snapped,pe))}function z(K){L(),zt.update(pe=>(pe.splice(K,1),pe)),t(2,g=!1)}function D(K,pe){try{if(K)return Ts(pe)}catch{}return Yt()}function O(K,pe,Q,me){if(me||pe.length>=3)return Yt();try{if(K&&pe.length>0&&Q)return JSON.parse(K.inner.calculateRoute([pe[pe.length-1],Q]))}catch{}return Yt()}function R(K,pe,Q){if(Q)return;if(!K||pe.length<3){t(9,d=[]);return}let me=[],he=1,Se=JSON.parse(JSON.stringify(pe));Se.push(Se[0]);for(let W=0;W<Se.length-1;W++){let dt=JSON.parse(K.inner.getExtraNodes(Se[W],Se[W+1]));for(let[Ge,Ye,kt]of dt)me.push({point:[Ge,Ye],snapped:kt,insertIdx:he});he++}t(9,d=me)}function H(K){L(),zt.update(pe=>(pe.splice(K.insertIdx,0,{point:K.point,snapped:K.snapped}),pe)),t(4,S=!0)}function q(K){zt.update(pe=>(pe[K.insertIdx].point=K.point,pe))}function X(){t(4,S=!1)}function se(K){let pe=K.target.tagName,Q=pe=="INPUT"||pe=="TEXTAREA";K.key=="Enter"&&!Q||K.key=="Escape"?(K.stopPropagation(),o.length>=3?f():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):K.key=="s"&&!Q?A():K.key=="z"&&K.ctrlKey&&(K.stopPropagation(),v())}function ce(){L(),t(3,w=!0)}const U=[[]];function be(K,pe){r.$$.not_equal(pe.point,K)&&(pe.point=K,t(9,d))}const ge=K=>H(K),ae=K=>q(K),we=K=>{H(K),t(4,S=!1)};function fe(K,pe){r.$$.not_equal(pe.point,K)&&(pe.point=K,zt.set(o))}const Pe=K=>N(K),Xe=K=>z(K),Ae=()=>t(2,g=!0),re=()=>t(2,g=!1),Ke=()=>t(3,w=!1);function Ne(){c=this.__value,t(7,c)}function ke(){c=this.__value,t(7,c)}return r.$$set=K=>{"map"in K&&t(22,a=K.map),"finish"in K&&t(0,f=K.finish),"cancel"in K&&t(1,u=K.cancel),"$$scope"in K&&t(38,s=K.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&R(l,o,S),r.$$.dirty[0]&8388716&&t(10,n=O(l,o,p,g||w)),r.$$.dirty[0]&32&&y(o)},[f,u,g,w,S,o,l,c,_,d,n,v,E,M,N,z,D,H,q,X,se,ce,a,p,i,be,ge,ae,we,fe,Pe,Xe,Ae,re,Ke,Ne,U,ke,s]}class W1 extends le{constructor(e){super(),ie(this,e,G1,H1,oe,{map:22,finish:0,cancel:1},null,[-1,-1])}}function q1(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function J1(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function Y1(r){let e;return{c(){e=h("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){$(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&k(e)}}}function Z1(r){let e,t,n,o,l;return t=new Ce({props:{$$slots:{default:[K1]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=h("li"),F(t.$$.fragment),n=T(),o=h("li"),o.textContent="Changing neighbourhood boundary"},m(i,s){$(i,e,s),P(t,e,null),$(i,n,s),$(i,o,s),l=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(b(t.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),l=!1},d(i){i&&(k(e),k(n),k(o)),I(t)}}}function K1(r){let e;return{c(){e=B("Editing")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function X1(r){let e,t,n,o,l,i,s,a,f,u,c,_;l=new Ce({props:{$$slots:{default:[q1]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[J1]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[Z1,Y1],p=[];function g(w,S){return w[1]?0:1}return u=g(r),c=p[u]=d[u](r),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),c.c(),j(t,"aria-label","breadcrumb"),j(e,"slot","extra-top")},m(w,S){$(w,e,S),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),p[u].m(n,null),_=!0},p(w,S){const y={};S&4096&&(y.$$scope={dirty:S,ctx:w}),l.$set(y);const v={};S&4096&&(v.$$scope={dirty:S,ctx:w}),a.$set(v);let L=u;u=g(w),u===L?p[u].p(w,S):(ye(),C(p[L],1,1,()=>{p[L]=null}),ve(),c=p[u],c?c.p(w,S):(c=p[u]=d[u](w),c.c()),b(c,1),c.m(n,null))},i(w){_||(b(l.$$.fragment,w),b(a.$$.fragment,w),b(c),_=!0)},o(w){C(l.$$.fragment,w),C(a.$$.fragment,w),C(c),_=!1},d(w){w&&k(e),I(l),I(a),p[u].d()}}}function V1(r){let e,t,n,o;return{c(){e=h("div"),t=h("h1"),n=B("Draw your neighbourhood boundary for "),o=B(r[0]),j(e,"slot","extra-sidebar")},m(l,i){$(l,e,i),m(e,t),m(t,n),m(t,o)},p(l,i){i&1&&ne(o,l[0])},d(l){l&&k(e)}}}function Q1(r){let e,t;return e=new W1({props:{map:ct(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[V1],"extra-top":[X1]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&8&&(l.map=ct(n[3])),o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function x1(r,e,t){let n,o,l,i,s;Z(r,ue,g=>t(2,n=g)),Z(r,Jn,g=>t(9,o=g)),Z(r,tt,g=>t(10,l=g)),Z(r,zt,g=>t(11,i=g)),Z(r,xt,g=>t(3,s=g));let{name:a}=e,{existing:f}=e;f&&(f.properties.waypoints?te(zt,i=f.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):te(zt,i=f.geometry.coordinates[1].slice(1).map(g=>({point:g,snapped:!1})),i));function u(){if(i.length>=3)try{let g=Ts(i);l.setNeighbourhoodBoundary(a,g),Mn(),l.setCurrentNeighbourhood(a,o),te(ue,n={mode:"neighbourhood"},n)}catch(g){console.log("error when setting hand drawn neighborhood",g),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working."),c()}}function c(){f?te(ue,n={mode:"neighbourhood"},n):te(ue,n={mode:"pick-neighbourhood"},n)}const _=()=>te(ue,n={mode:"title",firstLoad:!1},n),d=()=>te(ue,n={mode:"pick-neighbourhood"},n),p=()=>te(ue,n={mode:"neighbourhood"},n);return r.$$set=g=>{"name"in g&&t(0,a=g.name),"existing"in g&&t(1,f=g.existing)},[a,f,n,s,u,c,_,d,p]}class eh extends le{constructor(e){super(),ie(this,e,x1,Q1,oe,{name:0,existing:1})}}const th="/ltn/assets/settings-342fb430.svg";function Ci(r){let e,t;return e=new Tr({props:{$$slots:{default:[nh]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&67&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function nh(r){let e,t,n,o,l,i,s,a,f,u,c,_,d;return n=new Iu({}),{c(){e=h("h1"),e.textContent="Settings",t=T(),F(n.$$.fragment),o=T(),l=h("label"),i=h("input"),s=B(`
      Road thickness depends on shortcuts`),a=T(),f=h("center"),u=h("button"),u.textContent="Confirm",j(i,"type","checkbox")},m(p,g){$(p,e,g),$(p,t,g),P(n,p,g),$(p,o,g),$(p,l,g),m(l,i),i.checked=r[1],m(l,s),$(p,a,g),$(p,f,g),m(f,u),c=!0,_||(d=[x(i,"change",r[3]),x(u,"click",r[4])],_=!0)},p(p,g){g&2&&(i.checked=p[1])},i(p){c||(b(n.$$.fragment,p),c=!0)},o(p){C(n.$$.fragment,p),c=!1},d(p){p&&(k(e),k(t),k(o),k(l),k(a),k(f)),I(n,p),_=!1,ft(d)}}}function rh(r){let e,t,n,o,l,i,s=r[0]&&Ci(r);return{c(){e=h("button"),e.innerHTML=`<img src="${th}" alt="Settings"/>`,t=T(),s&&s.c(),n=Je(),j(e,"class","outline")},m(a,f){$(a,e,f),$(a,t,f),s&&s.m(a,f),$(a,n,f),o=!0,l||(i=x(e,"click",r[2]),l=!0)},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&b(s,1)):(s=Ci(a),s.c(),b(s,1),s.m(n.parentNode,n)):s&&(ye(),C(s,1,1,()=>{s=null}),ve())},i(a){o||(b(s),o=!0)},o(a){C(s),o=!1},d(a){a&&(k(e),k(t),k(n)),s&&s.d(a),l=!1,i()}}}function oh(r,e,t){let n;Z(r,Qr,f=>t(1,n=f));let o=!1;const l=()=>t(0,o=!0);function i(){n=this.checked,Qr.set(n)}return[o,n,l,i,()=>t(0,o=!1),()=>t(0,o=!1)]}class lh extends le{constructor(e){super(),ie(this,e,oh,rh,oe,{})}}const ih=["==",["geometry-type"],"Polygon"],sh=["==",["geometry-type"],"LineString"],ah=["==",["geometry-type"],"Point"];function As(){return{type:"FeatureCollection",features:[]}}function Zr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Fs(r)}}}function Fs(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Ps=Mt(As()),Is=Mt(0),fh=100;class uh{constructor(e){pt(this,"map");pt(this,"active");pt(this,"eventListenersSuccess");pt(this,"eventListenersUpdated");pt(this,"eventListenersFailure");pt(this,"points");pt(this,"cursor");pt(this,"hover");pt(this,"dragFrom");pt(this,"previousStates");pt(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});pt(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Mi(this.points).forEach((n,o)=>{t.push([o+1,Tf(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});pt(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Zr(e.lngLat.toArray()),this.onClick(e),this.finish())});pt(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});pt(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});pt(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});pt(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=As();this.points.forEach((o,l)=>{let i=Zr(o);i.properties.hover=this.hover==l,i.properties.idx=l,e.features.push(i)}),e.features=e.features.concat(Mi(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Ps.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Is.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Zr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Fs),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>fh&&this.previousStates.shift()}}function Mi(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function ch(r){let e,t,n;return{c(){e=B("Undo ("),t=B(r[1]),n=B(")")},m(o,l){$(o,e,l),$(o,t,l),$(o,n,l)},p(o,l){l&2&&ne(t,o[1])},d(o){o&&(k(e),k(t),k(n))}}}function dh(r){let e;return{c(){e=B("Undo")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function _h(r){let e,t,n,o,l,i,s,a,f,u,c;function _(g,w){return g[1]==0?dh:ch}let d=_(r),p=d(r);return{c(){e=h("div"),t=h("button"),t.textContent="Finish",n=T(),o=h("button"),o.textContent="Cancel",l=T(),i=h("button"),p.c(),a=T(),f=h("ul"),f.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,V(e,"display","flex"),V(e,"justify-content","space-between")},m(g,w){$(g,e,w),m(e,t),m(e,n),m(e,o),m(e,l),m(e,i),p.m(i,null),$(g,a,w),$(g,f,w),u||(c=[x(t,"click",r[2]),x(o,"click",r[3]),x(i,"click",r[4])],u=!0)},p(g,[w]){d===(d=_(g))&&p?p.p(g,w):(p.d(1),p=d(g),p&&(p.c(),p.m(i,null))),w&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Y,o:Y,d(g){g&&(k(e),k(a),k(f)),p.d(),u=!1,ft(c)}}}function ph(r,e,t){let n;Z(r,Is,a=>t(1,n=a));let{polygonTool:o}=e;const l=()=>o.finish(),i=()=>o.cancel(),s=()=>o.undo();return r.$$set=a=>{"polygonTool"in a&&t(0,o=a.polygonTool)},[o,n,l,i,s]}class mh extends le{constructor(e){super(),ie(this,e,ph,_h,oe,{polygonTool:0})}}let gh=Date.now();function sr(r){return`${r}-${gh++}`}const Es=Symbol.for("svelte-maplibre");function hh(){return wo(Es)}function Ti(r){return{subscribe:r.subscribe}}function js({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let o=hh(),l=Mt(null),i=Ti(l),s={...o,[r]:Ti(l)};if(e&&(s.popupTarget=i),n){let a=Mt(null);s.layerEvent=a,o.layerEvent=a}return t&&(s.cluster=Mt()),Qi(Es,s),{...o,self:l}}function bh(){return js({key:"source",setCluster:!0})}function wh(r=!0){return js({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Ai(r){let e;return t=>{if(t)for(let n in t){let o=e==null?void 0:e[n],l=t[n];o!==l&&r(n,l,o)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function yh(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function vh(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Fi(r){let e=r[0],t,n,o=Pi(r);return{c(){o.c(),t=Je()},m(l,i){o.m(l,i),$(l,t,i),n=!0},p(l,i){i[0]&1&&oe(e,e=l[0])?(ye(),C(o,1,1,Y),ve(),o=Pi(l),o.c(),b(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(b(o),n=!0)},o(l){C(o),n=!1},d(l){l&&k(t),o.d(l)}}}function Pi(r){let e;const t=r[36].default,n=Be(t,r,r[35],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[1]&16)&&Re(n,t,o,o[35],e?Ue(t,o[35],l,null):De(o[35]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function $h(r){let e,t,n=r[0]&&Fi(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l[0]&1&&b(n,1)):(n=Fi(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function kh(r,e,t){let n,o,l,i,s,a,f,u,c,_,d,p,{$$slots:g={},$$scope:w}=e,{id:S=sr("layer")}=e,{source:y=void 0}=e,{sourceLayer:v=void 0}=e,{beforeId:L=void 0}=e,{beforeLayerType:A=void 0}=e,{type:E}=e,{paint:M=void 0}=e,{layout:N=void 0}=e,{filter:z=void 0}=e,{applyToClusters:D=void 0}=e,{minzoom:O=void 0}=e,{maxzoom:R=void 0}=e,{manageHoverState:H=!1}=e,{hovered:q=null}=e,{interactive:X=!0}=e,{hoverCursor:se=void 0}=e,{eventsIfTopMost:ce=!1}=e;const U=pn(),{map:be,source:ge,self:ae,minzoom:we,maxzoom:fe,eventTopMost:Pe,layerInfo:Xe}=wh();Z(r,be,Q=>t(31,c=Q)),Z(r,ge,Q=>t(32,_=Q)),Z(r,ae,Q=>t(0,u=Q)),Z(r,we,Q=>t(34,p=Q)),Z(r,fe,Q=>t(33,d=Q)),Tt(()=>{u&&c&&(Xe.delete(u),c==null||c.removeLayer(u))});let Ae;function re(Q){var W,dt;if(!X||!u||!c||ce&&Pe(Q)!==u)return;let me=Q.features??[],he=(dt=(W=me[0])==null?void 0:W.properties)==null?void 0:dt.cluster_id,Se={event:Q,map:c,clusterId:he,layer:u,source:s,features:me};U(Q.type,Se)}function Ke(Q){var W,dt;if(!X||!u||!c||ce&&Pe(Q)!==u)return;se&&(c.getCanvas().style.cursor=se);let me=Q.features??[];t(6,q=me[0]??null);let he=(dt=(W=me[0])==null?void 0:W.properties)==null?void 0:dt.cluster_id;U("mouseenter",{event:Q,map:c,clusterId:he,layer:u,source:s,features:me})}function Ne(Q){var W,dt,Ge;if(!X||!c)return;if(ce&&Pe(Q)!==u){t(6,q=null),H&&Ae!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:v,id:Ae},{hover:!1}),Ae=void 0);return}c.getCanvas().style.cursor=se;let me=Q.features??[],he=(dt=(W=me[0])==null?void 0:W.properties)==null?void 0:dt.cluster_id,Se=(Ge=me[0])==null?void 0:Ge.id;Se!==Ae&&(H&&(Ae!==void 0&&(c==null||c.setFeatureState({source:s,id:Ae,sourceLayer:v},{hover:!1})),c==null||c.setFeatureState({source:s,id:Se,sourceLayer:v},{hover:!0})),Ae=Se,t(6,q=me[0]??null)),U("mousemove",{event:Q,map:c,clusterId:he,layer:u,source:s,features:me})}function ke(Q){if(!(!X||!u||!c)){if(se&&(c.getCanvas().style.cursor=""),t(6,q=null),H&&Ae!==void 0){const me={source:s,id:Ae,sourceLayer:v};c==null||c.setFeatureState(me,{hover:!1}),Ae=void 0}U("mouseleave",{map:c,layer:u,source:s})}}let K=!0;function pe(Q){c&&(c.off("click",Q,re),c.off("dblclick",Q,re),c.off("contextmenu",Q,re),c.off("mouseenter",Q,Ke),c.off("mousemove",Q,Ne),c.off("mouseleave",Q,ke))}return Tt(()=>{c&&u&&pe(u)}),r.$$set=Q=>{"id"in Q&&t(7,S=Q.id),"source"in Q&&t(8,y=Q.source),"sourceLayer"in Q&&t(9,v=Q.sourceLayer),"beforeId"in Q&&t(10,L=Q.beforeId),"beforeLayerType"in Q&&t(11,A=Q.beforeLayerType),"type"in Q&&t(12,E=Q.type),"paint"in Q&&t(13,M=Q.paint),"layout"in Q&&t(14,N=Q.layout),"filter"in Q&&t(15,z=Q.filter),"applyToClusters"in Q&&t(16,D=Q.applyToClusters),"minzoom"in Q&&t(17,O=Q.minzoom),"maxzoom"in Q&&t(18,R=Q.maxzoom),"manageHoverState"in Q&&t(19,H=Q.manageHoverState),"hovered"in Q&&t(6,q=Q.hovered),"interactive"in Q&&t(20,X=Q.interactive),"hoverCursor"in Q&&t(21,se=Q.hoverCursor),"eventsIfTopMost"in Q&&t(22,ce=Q.eventsIfTopMost),"$$scope"in Q&&t(35,w=Q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=vh(D)),r.$$.dirty[0]&1073774592&&t(24,o=yh("all",n,z)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,l=O??p),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,i=R??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=y||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&u!==S&&s){u&&(pe(u),Xe.delete(u));let Q=L;if(!L&&A){let me=c.getStyle().layers,he=typeof A=="function"?A:W=>W.type===A,Se=me==null?void 0:me.find(he);Se&&(Q=Se.id)}te(ae,u=S,u),c.addLayer(vr({id:u,type:E,source:s,"source-layer":v,filter:o,paint:M,layout:N,minzoom:l,maxzoom:i}),Q),t(23,K=!0),c.on("click",u,re),c.on("dblclick",u,re),c.on("contextmenu",u,re),c.on("mouseenter",u,Ke),c.on("mousemove",u,Ne),c.on("mouseleave",u,ke)}r.$$.dirty[0]&1048577&&u&&Xe.set(u,{interactive:X}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,a=u?Ai((Q,me)=>c==null?void 0:c.setPaintProperty(u,Q,me)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,f=u?Ai((Q,me)=>c==null?void 0:c.setLayoutProperty(u,Q,me)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(M)),r.$$.dirty[0]&134234112&&(f==null||f(N)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&u&&(c==null||c.setLayerZoomRange(u,l,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&u&&(K?t(23,K=!1):c==null||c.setFilter(u,o))},[u,be,ge,ae,we,fe,q,S,y,v,L,A,E,M,N,z,D,O,R,H,X,se,ce,K,o,i,l,f,a,s,n,c,_,d,p,w,g]}class Fo extends le{constructor(e){super(),ie(this,e,kh,$h,oe,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function Sh(r){let e;const t=r[16].default,n=Be(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Re(n,t,o,o[24],e?Ue(t,o[24],l,null):De(o[24]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Lh(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Sh]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Fo({props:l}),Te.push(()=>We(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],qe(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){I(e,i)}}}function Ch(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=sr("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:w=void 0}=e,{manageHoverState:S=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:L=!0}=e;function A(R){y=R,t(0,y)}function E(R){ze.call(this,r,R)}function M(R){ze.call(this,r,R)}function N(R){ze.call(this,r,R)}function z(R){ze.call(this,r,R)}function D(R){ze.call(this,r,R)}function O(R){ze.call(this,r,R)}return r.$$set=R=>{"id"in R&&t(1,l=R.id),"source"in R&&t(2,i=R.source),"sourceLayer"in R&&t(3,s=R.sourceLayer),"beforeId"in R&&t(4,a=R.beforeId),"beforeLayerType"in R&&t(5,f=R.beforeLayerType),"paint"in R&&t(6,u=R.paint),"layout"in R&&t(7,c=R.layout),"filter"in R&&t(8,_=R.filter),"applyToClusters"in R&&t(9,d=R.applyToClusters),"minzoom"in R&&t(10,p=R.minzoom),"maxzoom"in R&&t(11,g=R.maxzoom),"hoverCursor"in R&&t(12,w=R.hoverCursor),"manageHoverState"in R&&t(13,S=R.manageHoverState),"hovered"in R&&t(0,y=R.hovered),"eventsIfTopMost"in R&&t(14,v=R.eventsIfTopMost),"interactive"in R&&t(15,L=R.interactive),"$$scope"in R&&t(24,o=R.$$scope)},[y,l,i,s,a,f,u,c,_,d,p,g,w,S,v,L,n,A,E,M,N,z,D,O,o]}class Mh extends le{constructor(e){super(),ie(this,e,Ch,Lh,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Th(r){let e;const t=r[15].default,n=Be(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Re(n,t,o,o[23],e?Ue(t,o[23],l,null):De(o[23]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Ah(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[Th]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Fo({props:l}),Te.push(()=>We(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],qe(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){I(e,i)}}}function Fh(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=sr("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:p=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:w=!1}=e,{hovered:S=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:v=!0}=e;function L(O){S=O,t(0,S)}function A(O){ze.call(this,r,O)}function E(O){ze.call(this,r,O)}function M(O){ze.call(this,r,O)}function N(O){ze.call(this,r,O)}function z(O){ze.call(this,r,O)}function D(O){ze.call(this,r,O)}return r.$$set=O=>{"id"in O&&t(1,l=O.id),"source"in O&&t(2,i=O.source),"sourceLayer"in O&&t(3,s=O.sourceLayer),"beforeId"in O&&t(4,a=O.beforeId),"beforeLayerType"in O&&t(5,f=O.beforeLayerType),"paint"in O&&t(6,u=O.paint),"layout"in O&&t(7,c=O.layout),"filter"in O&&t(8,_=O.filter),"minzoom"in O&&t(9,d=O.minzoom),"maxzoom"in O&&t(10,p=O.maxzoom),"hoverCursor"in O&&t(11,g=O.hoverCursor),"manageHoverState"in O&&t(12,w=O.manageHoverState),"hovered"in O&&t(0,S=O.hovered),"eventsIfTopMost"in O&&t(13,y=O.eventsIfTopMost),"interactive"in O&&t(14,v=O.interactive),"$$scope"in O&&t(23,o=O.$$scope)},[S,l,i,s,a,f,u,c,_,d,p,g,w,y,v,n,L,A,E,M,N,z,D,o]}class Ph extends le{constructor(e){super(),ie(this,e,Fh,Ah,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Ih(r,e,t,n,o){let l=!1;r.getSource(e)&&(l=!0,r.removeSource(e));const i=()=>{n(e)&&(r.addSource(e,t),o())};if(l){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function Eh(r,e,t){pa().then(()=>{let n=Wt(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Ii(r){let e=r[0],t,n,o=Ei(r);return{c(){o.c(),t=Je()},m(l,i){o.m(l,i),$(l,t,i),n=!0},p(l,i){i&1&&oe(e,e=l[0])?(ye(),C(o,1,1,Y),ve(),o=Ei(l),o.c(),b(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(b(o),n=!0)},o(l){C(o),n=!1},d(l){l&&k(t),o.d(l)}}}function Ei(r){let e;const t=r[15].default,n=Be(t,r,r[14],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16384)&&Re(n,t,o,o[14],e?Ue(t,o[14],l,null):De(o[14]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function jh(r){let e,t,n=r[0]&&Ii(r);return{c(){n&&n.c(),e=Je()},m(o,l){n&&n.m(o,l),$(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=Ii(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ye(),C(n,1,1,()=>{n=null}),ve())},i(o){t||(b(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(o)}}}function Nh(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{id:a=sr("geojson")}=e,{data:f}=e,{generateId:u=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:p=void 0}=e;const{map:g,cluster:w,self:S}=bh();Z(r,g,L=>t(13,o=L)),Z(r,w,L=>t(16,l=L)),Z(r,S,L=>t(0,n=L));let y,v=!0;return Tt(()=>{n&&y&&o&&(Eh(g,n,y),te(S,n=null,n),t(11,y=void 0))}),r.$$set=L=>{"id"in L&&t(4,a=L.id),"data"in L&&t(5,f=L.data),"generateId"in L&&t(6,u=L.generateId),"promoteId"in L&&t(7,c=L.promoteId),"filter"in L&&t(8,_=L.filter),"lineMetrics"in L&&t(9,d=L.lineMetrics),"cluster"in L&&t(10,p=L.cluster),"$$scope"in L&&t(14,s=L.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&te(w,l=p,l),r.$$.dirty&12273&&o&&n!==a&&(te(S,n=a,n),Ih(o,n,vr({type:"geojson",data:f,filter:_,lineMetrics:d,generateId:u,promoteId:c,cluster:!!p,clusterMinPoints:p==null?void 0:p.minPoints,clusterMaxZoom:p==null?void 0:p.maxZoom,clusterRadius:p==null?void 0:p.radius,clusterProperties:p==null?void 0:p.properties}),L=>o&&L===n,()=>{n&&(t(11,y=o==null?void 0:o.getSource(n)),t(12,v=!0))})),r.$$.dirty&8208&&(o==null||o.on("style.load",()=>{t(11,y=o==null?void 0:o.getSource(a))})),r.$$.dirty&6176&&y&&(v?t(12,v=!1):y.setData(f)),r.$$.dirty&3072&&(y==null||y.setClusterOptions(vr({cluster:!!p,clusterMaxZoom:p==null?void 0:p.maxZoom,clusterRadius:p==null?void 0:p.radius})))},[n,g,w,S,a,f,u,c,_,d,p,y,v,o,s,i]}class zh extends le{constructor(e){super(),ie(this,e,Nh,jh,oe,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function Oh(r){let e;const t=r[15].default,n=Be(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Re(n,t,o,o[23],e?Ue(t,o[23],l,null):De(o[23]),null)},i(o){e||(b(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Bh(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[Oh]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Fo({props:l}),Te.push(()=>We(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){F(e.$$.fragment)},m(i,s){P(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],qe(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){I(e,i)}}}function Rh(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=sr("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:p=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:w=!1}=e,{hovered:S=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:v=!0}=e;function L(O){S=O,t(0,S)}function A(O){ze.call(this,r,O)}function E(O){ze.call(this,r,O)}function M(O){ze.call(this,r,O)}function N(O){ze.call(this,r,O)}function z(O){ze.call(this,r,O)}function D(O){ze.call(this,r,O)}return r.$$set=O=>{"id"in O&&t(1,l=O.id),"source"in O&&t(2,i=O.source),"sourceLayer"in O&&t(3,s=O.sourceLayer),"beforeId"in O&&t(4,a=O.beforeId),"beforeLayerType"in O&&t(5,f=O.beforeLayerType),"paint"in O&&t(6,u=O.paint),"layout"in O&&t(7,c=O.layout),"filter"in O&&t(8,_=O.filter),"minzoom"in O&&t(9,d=O.minzoom),"maxzoom"in O&&t(10,p=O.maxzoom),"hoverCursor"in O&&t(11,g=O.hoverCursor),"manageHoverState"in O&&t(12,w=O.manageHoverState),"hovered"in O&&t(0,S=O.hovered),"eventsIfTopMost"in O&&t(13,y=O.eventsIfTopMost),"interactive"in O&&t(14,v=O.interactive),"$$scope"in O&&t(23,o=O.$$scope)},[S,l,i,s,a,f,u,c,_,d,p,g,w,y,v,n,L,A,E,M,N,z,D,o]}class Dh extends le{constructor(e){super(),ie(this,e,Rh,Bh,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Uh(r){let e,t,n,o,l,i;return e=new Ph({props:{id:"edit-polygon-fill",filter:ih,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new Dh({props:{id:"edit-polygon-lines",filter:sh,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),l=new Mh({props:{id:"edit-polygon-vertices",filter:ah,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment)},m(s,a){P(e,s,a),$(s,t,a),P(n,s,a),$(s,o,a),P(l,s,a),i=!0},p:Y,i(s){i||(b(e.$$.fragment,s),b(n.$$.fragment,s),b(l.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(n.$$.fragment,s),C(l.$$.fragment,s),i=!1},d(s){s&&(k(t),k(o)),I(e,s),I(n,s),I(l,s)}}}function Hh(r){let e,t;return e=new zh({props:{data:r[0],$$slots:{default:[Uh]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Gh(r,e,t){let n;return Z(r,Ps,o=>t(0,n=o)),[n]}class Wh extends le{constructor(e){super(),ie(this,e,Gh,Hh,oe,{})}}function qh(r){let e,t,n,o,l,i,s;return{c(){e=h("button"),e.textContent="Import current view",t=T(),n=h("i"),n.textContent="or...",o=T(),l=h("button"),l.textContent="Draw an area to import on the map",j(e,"type","button"),j(l,"type","button")},m(a,f){$(a,e,f),$(a,t,f),$(a,n,f),$(a,o,f),$(a,l,f),i||(s=[x(e,"click",r[2]),x(l,"click",r[3])],i=!0)},p:Y,i:Y,o:Y,d(a){a&&(k(e),k(t),k(n),k(o),k(l)),i=!1,ft(s)}}}function Jh(r){let e,t;return e=new mh({props:{polygonTool:r[0]}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.polygonTool=n[0]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Yh(r){let e,t,n,o,l,i,s,a,f;const u=[Jh,qh],c=[];function _(d,p){return d[0]?0:1}return e=_(r),t=c[e]=u[e](r),{c(){t.c(),n=T(),o=h("label"),l=h("input"),i=B(`Save a copy of the osm.xml
  after importing`),j(l,"type","checkbox")},m(d,p){c[e].m(d,p),$(d,n,p),$(d,o,p),m(o,l),l.checked=r[1],m(o,i),s=!0,a||(f=x(l,"change",r[5]),a=!0)},p(d,[p]){let g=e;e=_(d),e===g?c[e].p(d,p):(ye(),C(c[g],1,1,()=>{c[g]=null}),ve(),t=c[e],t?t.p(d,p):(t=c[e]=u[e](d),t.c()),b(t,1),t.m(n.parentNode,n)),p&2&&(l.checked=d[1])},i(d){s||(b(t),s=!0)},o(d){C(t),s=!1},d(d){d&&(k(n),k(o)),c[e].d(d),a=!1,f()}}}function jn(r){return[r.lng,r.lat]}function Zh(r,e,t){let{map:n}=e;const o=pn();let l=null,i=!1;async function s(_){try{o("loading","Loading from Overpass");let p=await(await fetch(Ns(_))).text();i&&kr("osm.xml",p),o("gotXml",{xml:p,boundary:_})}catch(d){o("error",d.toString())}}function a(){let _=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[jn(_.getSouthWest()),jn(_.getNorthWest()),jn(_.getNorthEast()),jn(_.getSouthEast()),jn(_.getSouthWest())]],type:"Polygon"}}}async function f(){if(n){if(n.getZoom()<13){o("error","Zoom in more to import");return}await s(a())}}function u(){n&&(t(0,l=new uh(n)),l.startNew(),l.addEventListenerSuccess(async _=>{t(0,l=null),await s(_)}),l.addEventListenerFailure(()=>{t(0,l=null)}))}function c(){i=this.checked,t(1,i)}return r.$$set=_=>{"map"in _&&t(4,n=_.map)},[l,i,f,u,n,c]}class Kh extends le{constructor(e){super(),ie(this,e,Zh,Yh,oe,{map:4})}}function Ns(r){let e='poly:"';for(let[n,o]of r.geometry.coordinates[0])e+=`${o} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class zs{constructor(e,t,n,o,l){pt(this,"inner");this.inner=new i_(e,t||new Uint8Array,n||new Uint8Array,o,l)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=Xh(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=pl(t.properties.counts_from),t.properties.sum_to=pl(t.properties.counts_to);return e}}function Xh(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function br(r){Zt.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:o,boundary:l}=await Vh(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),tt.set(new zs(new Uint8Array(t),n?new Uint8Array(n):void 0,o?new Uint8Array(o):void 0,l,e.study_area_name||void 0)),Wt(tt).loadSavefile(e),console.timeEnd("load"),Os()}catch(e){window.alert(`Couldn't open project: ${e}`),Zt.set("")}}async function Vh(r,e){if(e){let t=$t(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${t}`);let o=await(await sn(t)).arrayBuffer(),l=$t(`cnt_boundaries/${r.study_area_name}.geojson`),s=await(await sn(l)).json(),a=$t(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let f;try{f=await(await sn(a)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let u=$t(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${u}`);let c;try{c=await(await sn(u)).arrayBuffer()}catch(_){console.log(`No context data for prioritization: ${_}`)}return{osmBuffer:o,boundary:s,demandBuffer:f,contextDataBuffer:c}}else if(r.study_area_name){let t=$t(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${t}`);let o=await(await sn(t)).arrayBuffer(),l=$t(`boundaries/${r.study_area_name}.geojson`),s=await(await sn(l)).json();return{osmBuffer:o,boundary:s}}else{console.log("Grabbing from Overpass");let t=r.features.find(l=>l.properties.kind=="study_area_boundary");return{osmBuffer:await(await sn(Ns(t))).arrayBuffer(),boundary:t}}}function Os(){ue.set({mode:"pick-neighbourhood"}),An.set(new Ff(Wt(xt),Wt(tt).toRouteSnapper(),Mt(Yt()),Mt(!0),Mt(0))),Wt(xt).fitBounds(Wt(tt).getBounds(),{animate:!1}),Zn.set(Kr()),Yn.set(Kr()),pr.set(Kr());let r=new URL(window.location.href);r.searchParams.set("project",Wt(Zt)),window.history.replaceState(null,"",r.toString())}function Kr(){let r=Wt(tt).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new eo.LngLat(e,t)}function ji(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function Ni(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function Qh(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function xh(r){let e,t,n,o,l,i,s,a;return l=new Ce({props:{$$slots:{default:[Qh]},$$scope:{ctx:r}}}),l.$on("click",r[13]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),s.textContent="New project",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(f,u){$(f,e,u),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),a=!0},p(f,u){const c={};u&16777216&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){a||(b(l.$$.fragment,f),a=!0)},o(f){C(l.$$.fragment,f),a=!1},d(f){f&&k(e),I(l)}}}function zi(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p;e=new es({props:{loading:r[4]}});let g=Me(r[3]),w=[];for(let S=0;S<g.length;S+=1)w[S]=Bi(ji(r,g,S));return c=new Kh({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){F(e.$$.fragment),t=T(),n=h("label"),o=B(`Load a built-in area:
        `),l=h("select"),i=h("option");for(let S=0;S<w.length;S+=1)w[S].c();s=T(),a=h("i"),a.textContent="or...",f=T(),u=h("div"),F(c.$$.fragment),i.__value="",Oe(i,i.__value),r[2]===void 0&&fn(()=>r[9].call(l))},m(S,y){P(e,S,y),$(S,t,y),$(S,n,y),m(n,o),m(n,l),m(l,i);for(let v=0;v<w.length;v+=1)w[v]&&w[v].m(l,null);vt(l,r[2],!0),$(S,s,y),$(S,a,y),$(S,f,y),$(S,u,y),P(c,u,null),_=!0,d||(p=[x(l,"change",r[9]),x(l,"change",r[10])],d=!0)},p(S,y){const v={};if(y&16&&(v.loading=S[4]),e.$set(v),y&8){g=Me(S[3]);let A;for(A=0;A<g.length;A+=1){const E=ji(S,g,A);w[A]?w[A].p(E,y):(w[A]=Bi(E),w[A].c(),w[A].m(l,null))}for(;A<w.length;A+=1)w[A].d(1);w.length=g.length}y&12&&vt(l,S[2]);const L={};y&32&&(L.map=S[5]),c.$set(L)},i(S){_||(b(e.$$.fragment,S),b(c.$$.fragment,S),_=!0)},o(S){C(e.$$.fragment,S),C(c.$$.fragment,S),_=!1},d(S){S&&(k(t),k(n),k(s),k(a),k(f),k(u)),I(e,S),ut(w,S),I(c),d=!1,ft(p)}}}function Oi(r){let e,t=r[21]+"",n,o;return{c(){e=h("option"),n=B(t),e.__value=o=r[20],Oe(e,e.__value)},m(l,i){$(l,e,i),m(e,n)},p(l,i){i&8&&t!==(t=l[21]+"")&&ne(n,t),i&8&&o!==(o=l[20])&&(e.__value=o,Oe(e,e.__value))},d(l){l&&k(e)}}}function Bi(r){let e,t,n=Me(r[17]),o=[];for(let l=0;l<n.length;l+=1)o[l]=Oi(Ni(r,n,l));return{c(){e=h("optgroup");for(let l=0;l<o.length;l+=1)o[l].c();j(e,"label",t=r[16])},m(l,i){$(l,e,i);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(l,i){if(i&8){n=Me(l[17]);let s;for(s=0;s<n.length;s+=1){const a=Ni(l,n,s);o[s]?o[s].p(a,i):(o[s]=Oi(a),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}i&8&&t!==(t=l[16])&&j(e,"label",t)},d(l){l&&k(e),ut(o,l)}}}function e0(r){let e,t,n,o,l,i,s,a,f,u=r[1]&&zi(r);return{c(){e=h("div"),t=h("div"),n=h("label"),o=B(`Project name:
        `),l=h("input"),i=T(),u&&u.c(),j(l,"type","text"),j(e,"slot","sidebar")},m(c,_){$(c,e,_),m(e,t),m(t,n),m(n,o),m(n,l),Oe(l,r[1]),m(e,i),u&&u.m(e,null),s=!0,a||(f=x(l,"input",r[8]),a=!0)},p(c,_){_&2&&l.value!==c[1]&&Oe(l,c[1]),c[1]?u?(u.p(c,_),_&2&&b(u,1)):(u=zi(c),u.c(),b(u,1),u.m(e,null)):u&&(ye(),C(u,1,1,()=>{u=null}),ve())},i(c){s||(b(u),s=!0)},o(c){C(u),s=!1},d(c){c&&k(e),u&&u.d(),a=!1,f()}}}function t0(r){let e,t,n;return t=new Wh({}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","map")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p:Y,i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function n0(r){let e,t;return e=new Ft({props:{$$slots:{map:[t0],sidebar:[e0],top:[xh]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&16777342&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function r0(r,e,t){let n,o,l,i;Z(r,Zt,v=>t(14,n=v)),Z(r,tt,v=>t(15,o=v)),Z(r,xt,v=>t(5,l=v)),Z(r,ue,v=>t(6,i=v));let s="",a="",f=[],u="";Mr(async()=>{let v=await sn($t("severance_pbfs/areas.json"));t(3,f=await v.json())});function c(v){t(4,u="Loading OSM");try{te(tt,o=new zs(new TextEncoder().encode(v.detail.xml),void 0,void 0,v.detail.boundary,void 0),o),te(Zt,n=`ltn_${s}`,n),Os(),Mn()}catch(L){window.alert(`Couldn't import from Overpass: ${L}`)}t(4,u="")}async function _(){if(a=="")return;let v=`ltn_${s}`;window.localStorage.setItem(v,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:a})),t(4,u=`Loading pre-clipped OSM area ${a}`),await br(v),t(4,u="")}function d(){s=this.value,t(1,s)}function p(){a=un(this),t(2,a),t(3,f)}return[_,s,a,f,u,l,i,c,d,p,()=>_(),v=>t(4,u=v.detail),v=>window.alert(v.detail),()=>te(ue,i={mode:"title",firstLoad:!1},i)]}class o0 extends le{constructor(e){super(),ie(this,e,r0,n0,oe,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Ri(r,e,t){const n=r.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function Di(r,e,t){const n=r.slice();return n[23]=e[t],n}function l0(r){let e;return{c(){e=h("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',j(e,"slot","top")},m(t,n){$(t,e,n)},p:Y,d(t){t&&k(e)}}}function i0(r){let e;return{c(){e=h("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){$(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&k(e)}}}function s0(r){let e,t,n,o,l,i,s,a,f,u,c,_,d;t=new Ce({props:{$$slots:{default:[a0]},$$scope:{ctx:r}}}),t.$on("click",r[11]);let p=Me(r[2]),g=[];for(let S=0;S<p.length;S+=1)g[S]=Hi(Ri(r,p,S));const w=S=>C(g[S],1,1,()=>{g[S]=null});return{c(){e=h("div"),F(t.$$.fragment),n=T(),o=h("p"),o.textContent="Load a saved project:",l=T(),i=h("ul");for(let S=0;S<g.length;S+=1)g[S].c();s=T(),a=h("label"),f=B(`Load a project from a file
        `),u=h("input"),j(u,"type","file")},m(S,y){$(S,e,y),P(t,e,null),$(S,n,y),$(S,o,y),$(S,l,y),$(S,i,y);for(let v=0;v<g.length;v+=1)g[v]&&g[v].m(i,null);$(S,s,y),$(S,a,y),m(a,f),m(a,u),r[15](u),c=!0,_||(d=x(u,"change",r[6]),_=!0)},p(S,y){const v={};if(y&67108864&&(v.$$scope={dirty:y,ctx:S}),t.$set(v),y&900){p=Me(S[2]);let L;for(L=0;L<p.length;L+=1){const A=Ri(S,p,L);g[L]?(g[L].p(A,y),b(g[L],1)):(g[L]=Hi(A),g[L].c(),b(g[L],1),g[L].m(i,null))}for(ye(),L=p.length;L<g.length;L+=1)w(L);ve()}},i(S){if(!c){b(t.$$.fragment,S);for(let y=0;y<p.length;y+=1)b(g[y]);c=!0}},o(S){C(t.$$.fragment,S),g=g.filter(Boolean);for(let y=0;y<g.length;y+=1)C(g[y]);c=!1},d(S){S&&(k(e),k(n),k(o),k(l),k(i),k(s),k(a)),I(t),ut(g,S),r[15](null),_=!1,d()}}}function a0(r){let e;return{c(){e=B("New project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function f0(r){let e=r[23].slice(4)+"",t;return{c(){t=B(e)},m(n,o){$(n,t,o)},p(n,o){o&4&&e!==(e=n[23].slice(4)+"")&&ne(t,e)},d(n){n&&k(t)}}}function Ui(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p;function g(){return r[12](r[23])}n=new Ce({props:{$$slots:{default:[f0]},$$scope:{ctx:r}}}),n.$on("click",g),s=new Co({props:{color:"black"}});function w(){return r[13](r[23])}u=new gs({props:{color:"white"}});function S(){return r[14](r[23])}return{c(){e=h("li"),t=h("span"),F(n.$$.fragment),o=T(),l=h("span"),i=h("button"),F(s.$$.fragment),a=T(),f=h("button"),F(u.$$.fragment),c=T(),j(i,"class","outline icon-btn"),j(i,"aria-label","Rename project"),j(f,"class","icon-btn destructive"),j(f,"aria-label","Delete project"),V(l,"display","flex"),V(l,"gap","16px"),V(t,"display","flex"),V(t,"justify-content","space-between")},m(y,v){$(y,e,v),m(e,t),P(n,t,null),m(t,o),m(t,l),m(l,i),P(s,i,null),m(l,a),m(l,f),P(u,f,null),m(e,c),_=!0,d||(p=[x(i,"click",w),x(f,"click",S)],d=!0)},p(y,v){r=y;const L={};v&67108868&&(L.$$scope={dirty:v,ctx:r}),n.$set(L)},i(y){_||(b(n.$$.fragment,y),b(s.$$.fragment,y),b(u.$$.fragment,y),_=!0)},o(y){C(n.$$.fragment,y),C(s.$$.fragment,y),C(u.$$.fragment,y),_=!1},d(y){y&&k(e),I(n),I(s),I(u),d=!1,ft(p)}}}function Hi(r){let e,t=(r[19]??"custom area")+"",n,o,l,i,s=Me(r[20]),a=[];for(let u=0;u<s.length;u+=1)a[u]=Ui(Di(r,s,u));const f=u=>C(a[u],1,1,()=>{a[u]=null});return{c(){e=h("u"),n=B(t),o=T();for(let u=0;u<a.length;u+=1)a[u].c();l=Je()},m(u,c){$(u,e,c),m(e,n),$(u,o,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(u,c);$(u,l,c),i=!0},p(u,c){if((!i||c&4)&&t!==(t=(u[19]??"custom area")+"")&&ne(n,t),c&900){s=Me(u[20]);let _;for(_=0;_<s.length;_+=1){const d=Di(u,s,_);a[_]?(a[_].p(d,c),b(a[_],1)):(a[_]=Ui(d),a[_].c(),b(a[_],1),a[_].m(l.parentNode,l))}for(ye(),_=s.length;_<a.length;_+=1)f(_);ve()}},i(u){if(!i){for(let c=0;c<s.length;c+=1)b(a[c]);i=!0}},o(u){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)C(a[c]);i=!1},d(u){u&&(k(e),k(o),k(l)),ut(a,u)}}}function u0(r){let e,t,n,o;const l=[s0,i0],i=[];function s(a,f){return a[4]&&a[0]?0:1}return t=s(r),n=i[t]=l[t](r),{c(){e=h("div"),n.c(),j(e,"slot","sidebar")},m(a,f){$(a,e,f),i[t].m(e,null),o=!0},p(a,f){let u=t;t=s(a),t===u?i[t].p(a,f):(ye(),C(i[u],1,1,()=>{i[u]=null}),ve(),n=i[t],n?n.p(a,f):(n=i[t]=l[t](a),n.c()),b(n,1),n.m(e,null))},i(a){o||(b(n),o=!0)},o(a){C(n),o=!1},d(a){a&&k(e),i[t].d()}}}function c0(r){let e,t,n,o;return e=new es({props:{loading:r[1]}}),n=new Ft({props:{$$slots:{sidebar:[u0],top:[l0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment)},m(l,i){P(e,l,i),$(l,t,i),P(n,l,i),o=!0},p(l,[i]){const s={};i&2&&(s.loading=l[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:l}),n.$set(a)},i(l){o||(b(e.$$.fragment,l),b(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&k(t),I(e,l),I(n,l)}}}function _r(){let r=new Map,e=[];for(let n=0;n<window.localStorage.length;n++){let o=window.localStorage.key(n);if(o.startsWith("ltn_")){let l="";try{l=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch{}l&&l.length>0?(r.has(l)||r.set(l,[]),r.get(l).push(o)):e.push(o)}}let t=[...r.entries()];return t.sort((n,o)=>n[0].localeCompare(o[0])),t.push(["custom",e]),t}function d0(r,e,t){let n,o,l,i,s;Z(r,Zt,E=>t(16,n=E)),Z(r,An,E=>t(17,o=E)),Z(r,tt,E=>t(18,l=E)),Z(r,xt,E=>t(4,i=E)),Z(r,ue,E=>t(5,s=E));let{wasmReady:a}=e,{firstLoad:f}=e,u="";if(te(tt,l=null,l),te(An,o=null,o),te(Zt,n="",n),f){let M=new URLSearchParams(window.location.search).get("project");M&&(u=`Loading project ${M}`,br(M))}else{let E=new URL(window.location.href);E.searchParams.delete("project"),window.history.replaceState(null,"",E.toString())}let c=_r(),_;async function d(E){let M="ltn_"+_.files[0].name;t(1,u=`Loading from file ${M}`),window.localStorage.setItem(M,await _.files[0].text()),t(2,c=_r()),await br(M),t(1,u="")}function p(E){window.confirm(`Really delete project ${E}? You can't undo this.`)&&(window.localStorage.removeItem(E),t(2,c=_r()))}function g(E){let M=window.prompt(`Rename project ${E} to what?`,E);if(M){M.startsWith("ltn_")||(M=`ltn_${M}`);let N=window.localStorage.getItem(E);window.localStorage.setItem(M,N),window.localStorage.removeItem(E),t(2,c=_r())}}async function w(E){t(1,u=`Loading project ${E}`),await br(E),t(1,u="")}const S=()=>te(ue,s={mode:"new-project"},s),y=E=>w(E),v=E=>g(E),L=E=>p(E);function A(E){Te[E?"unshift":"push"](()=>{_=E,t(3,_)})}return r.$$set=E=>{"wasmReady"in E&&t(0,a=E.wasmReady),"firstLoad"in E&&t(10,f=E.firstLoad)},[a,u,c,_,i,s,d,p,g,w,f,S,y,v,L,A]}class _0 extends le{constructor(e){super(),ie(this,e,d0,c0,oe,{wasmReady:0,firstLoad:10})}}function p0(r){let e;return{c(){e=B("Choose project")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function m0(r){let e;return{c(){e=B("Pick neighbourhood")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function g0(r){let e;return{c(){e=B("Editing")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function h0(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,p;return l=new Ce({props:{$$slots:{default:[p0]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ce({props:{$$slots:{default:[m0]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new Ce({props:{$$slots:{default:[g0]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),F(l.$$.fragment),i=T(),s=h("li"),F(a.$$.fragment),f=T(),u=h("li"),F(c.$$.fragment),_=T(),d=h("li"),d.textContent="Viewing shortcuts",j(t,"aria-label","breadcrumb"),j(e,"slot","top")},m(g,w){$(g,e,w),m(e,t),m(t,n),m(n,o),P(l,o,null),m(n,i),m(n,s),P(a,s,null),m(n,f),m(n,u),P(c,u,null),m(n,_),m(n,d),p=!0},p(g,w){const S={};w&1024&&(S.$$scope={dirty:w,ctx:g}),l.$set(S);const y={};w&1024&&(y.$$scope={dirty:w,ctx:g}),a.$set(y);const v={};w&1024&&(v.$$scope={dirty:w,ctx:g}),c.$set(v)},i(g){p||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),p=!0)},o(g){C(l.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),p=!1},d(g){g&&k(e),I(l),I(a),I(c)}}}function b0(r){let e,t,n,o,l,i,s,a,f,u,c=ct(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,p,g,w,S;function y(L){r[5](L)}let v={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(v.idx=r[0].shortcutIndex),l=new Er({props:v}),Te.push(()=>We(l,"idx",y)),{c(){e=h("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=T(),n=h("button"),n.textContent="Pick a different road",o=T(),F(l.$$.fragment),s=T(),a=h("p"),f=B("This shortcut is "),u=h("b"),_=B(c),d=B("x"),p=B(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(L,A){$(L,e,A),$(L,t,A),$(L,n,A),$(L,o,A),P(l,L,A),$(L,s,A),$(L,a,A),m(a,f),m(a,u),m(u,_),m(u,d),m(a,p),g=!0,w||(S=x(n,"click",r[4]),w=!0)},p(L,A){const E={};A&1&&(E.list=L[0].gj.features),!i&&A&1&&(i=!0,E.idx=L[0].shortcutIndex,qe(()=>i=!1)),l.$set(E),(!g||A&1)&&c!==(c=ct(L[0].gj.features[L[0].shortcutIndex].properties).directness.toFixed(1)+"")&&ne(_,c)},i(L){g||(b(l.$$.fragment,L),g=!0)},o(L){C(l.$$.fragment,L),g=!1},d(L){L&&(k(e),k(t),k(n),k(o),k(s),k(a)),I(l,L),w=!1,S()}}}function w0(r){let e;return{c(){e=h("p"),e.textContent="Click a road to see shortcuts"},m(t,n){$(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&k(e)}}}function y0(r){let e,t,n,o,l,i;t=new gn({}),t.$on("click",r[3]);const s=[w0,b0],a=[];function f(u,c){return u[0].state=="neutral"?0:u[0].state=="chose-road"?1:-1}return~(o=f(r))&&(l=a[o]=s[o](r)),{c(){e=h("div"),F(t.$$.fragment),n=T(),l&&l.c(),j(e,"slot","sidebar")},m(u,c){$(u,e,c),P(t,e,null),m(e,n),~o&&a[o].m(e,null),i=!0},p(u,c){let _=o;o=f(u),o===_?~o&&a[o].p(u,c):(l&&(ye(),C(a[_],1,1,()=>{a[_]=null}),ve()),~o?(l=a[o],l?l.p(u,c):(l=a[o]=s[o](u),l.c()),b(l,1),l.m(e,null)):l=null)},i(u){i||(b(t.$$.fragment,u),b(l),i=!0)},o(u){C(t.$$.fragment,u),C(l),i=!1},d(u){u&&k(e),I(t),~o&&a[o].d()}}}function v0(r){let e,t;return e=new lr({props:{interactive:!1}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function $0(r){let e,t;return e=new lr({props:{onClickLine:r[2],$$slots:{"line-popup":[S0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function k0(r){let e,t=r[9].shortcuts+"",n,o,l=(r[9].name??"unnamed road")+"",i;return{c(){e=h("p"),n=B(t),o=B(" shortcuts through "),i=B(l)},m(s,a){$(s,e,a),m(e,n),m(e,o),m(e,i)},p(s,a){a&512&&t!==(t=s[9].shortcuts+"")&&ne(n,t),a&512&&l!==(l=(s[9].name??"unnamed road")+"")&&ne(i,l)},d(s){s&&k(e)}}}function S0(r){let e,t,n;return t=new ht({props:{openOn:"hover",$$slots:{default:[k0,({props:o})=>({9:o}),({props:o})=>o?512:0]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","line-popup")},m(o,l){$(o,e,l),P(t,e,null),n=!0},p(o,l){const i={};l&1536&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),I(t)}}}function L0(r){let e,t,n,o,l,i,s,a,f,u;e=new Nr({}),n=new jr({}),l=new zr({});const c=[$0,v0],_=[];function d(p,g){return p[0].state=="neutral"?0:p[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment),i=T(),a&&a.c(),f=Je()},m(p,g){P(e,p,g),$(p,t,g),P(n,p,g),$(p,o,g),P(l,p,g),$(p,i,g),~s&&_[s].m(p,g),$(p,f,g),u=!0},p(p,g){let w=s;s=d(p),s===w?~s&&_[s].p(p,g):(a&&(ye(),C(_[w],1,1,()=>{_[w]=null}),ve()),~s?(a=_[s],a?a.p(p,g):(a=_[s]=c[s](p),a.c()),b(a,1),a.m(f.parentNode,f)):a=null)},i(p){u||(b(e.$$.fragment,p),b(n.$$.fragment,p),b(l.$$.fragment,p),b(a),u=!0)},o(p){C(e.$$.fragment,p),C(n.$$.fragment,p),C(l.$$.fragment,p),C(a),u=!1},d(p){p&&(k(t),k(o),k(i),k(f)),I(e,p),I(n,p),I(l,p),~s&&_[s].d(p)}}}function Gi(r){let e,t,n,o,l,i,s,a;return e=new Ve({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[C0]},$$scope:{ctx:r}}}),n=new Ve({props:{data:r[0].roadGj,$$slots:{default:[M0]},$$scope:{ctx:r}}}),l=new $n({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[T0]},$$scope:{ctx:r}}}),s=new $n({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[A0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment),i=T(),F(s.$$.fragment)},m(f,u){P(e,f,u),$(f,t,u),P(n,f,u),$(f,o,u),P(l,f,u),$(f,i,u),P(s,f,u),a=!0},p(f,u){const c={};u&1&&(c.data=f[0].gj.features[f[0].shortcutIndex]),u&1024&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};u&1&&(_.data=f[0].roadGj),u&1024&&(_.$$scope={dirty:u,ctx:f}),n.$set(_);const d={};u&1&&(d.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[0]),u&1024&&(d.$$scope={dirty:u,ctx:f}),l.$set(d);const p={};u&1&&(p.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[f[0].gj.features[f[0].shortcutIndex].geometry.coordinates.length-1]),u&1024&&(p.$$scope={dirty:u,ctx:f}),s.$set(p)},i(f){a||(b(e.$$.fragment,f),b(n.$$.fragment,f),b(l.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),C(l.$$.fragment,f),C(s.$$.fragment,f),a=!1},d(f){f&&(k(t),k(o),k(i)),I(e,f),I(n,f),I(l,f),I(s,f)}}}function C0(r){let e,t;const n=[$e("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function M0(r){let e,t;const n=[$e("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new nt({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function T0(r){let e;return{c(){e=B("A")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function A0(r){let e;return{c(){e=B("B")},m(t,n){$(t,e,n)},d(t){t&&k(e)}}}function F0(r){let e,t,n,o,l,i;t=new ir({props:{$$slots:{default:[L0]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&Gi(r);return l=new hn({}),{c(){e=h("div"),F(t.$$.fragment),n=T(),s&&s.c(),o=T(),F(l.$$.fragment),j(e,"slot","map")},m(a,f){$(a,e,f),P(t,e,null),m(e,n),s&&s.m(e,null),m(e,o),P(l,e,null),i=!0},p(a,f){const u={};f&1025&&(u.$$scope={dirty:f,ctx:a}),t.$set(u),a[0].state=="chose-road"?s?(s.p(a,f),f&1&&b(s,1)):(s=Gi(a),s.c(),b(s,1),s.m(e,o)):s&&(ye(),C(s,1,1,()=>{s=null}),ve())},i(a){i||(b(t.$$.fragment,a),b(s),b(l.$$.fragment,a),i=!0)},o(a){C(t.$$.fragment,a),C(s),C(l.$$.fragment,a),i=!1},d(a){a&&k(e),I(t),s&&s.d(),I(l)}}}function P0(r){let e,t;return e=new Ft({props:{$$slots:{map:[F0],sidebar:[y0],top:[h0]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function I0(r,e,t){let n,o;Z(r,ue,_=>t(1,n=_)),Z(r,tt,_=>t(8,o=_));let l={state:"neutral"};function i(_,d){let p=o.getShortcutsCrossingRoad(_.properties.id);if(p.features.length==0){window.alert("No shortcuts here");return}t(0,l={state:"chose-road",roadGj:_,gj:p,shortcutIndex:0})}function s(){te(ue,n={mode:"neighbourhood"},n)}const a=()=>t(0,l={state:"neutral"});function f(_){r.$$.not_equal(l.shortcutIndex,_)&&(l.shortcutIndex=_,t(0,l))}return[l,n,i,s,a,f,()=>te(ue,n={mode:"title",firstLoad:!1},n),()=>te(ue,n={mode:"pick-neighbourhood"},n)]}class E0 extends le{constructor(e){super(),ie(this,e,I0,P0,oe,{})}}function j0(r){let e,t,n,o,l,i,s,a,f;return o=new lh({}),{c(){e=h("div"),t=h("button"),t.innerHTML=`<img src="${wa}" style="height: 6vh;" alt="A/B Street logo"/>`,n=T(),F(o.$$.fragment),l=T(),i=h("span"),j(t,"class","outline"),V(i,"width","100%"),j(e,"slot","top"),j(e,"class","pico"),V(e,"display","flex")},m(u,c){$(u,e,c),m(e,t),m(e,n),P(o,e,null),m(e,l),m(e,i),r[20](i),s=!0,a||(f=x(t,"click",r[19]),a=!0)},p:Y,i(u){s||(b(o.$$.fragment,u),s=!0)},o(u){C(o.$$.fragment,u),s=!1},d(u){u&&k(e),I(o),r[20](null),a=!1,f()}}}function Wi(r){let e,t,n,o,l,i;return n=new ec({props:{map:ct(r[6]),maptilerBasemap:r[7]}}),{c(){e=h("button"),e.textContent="Zoom to fit study area",t=T(),F(n.$$.fragment),j(e,"class","secondary")},m(s,a){$(s,e,a),$(s,t,a),P(n,s,a),o=!0,l||(i=x(e,"click",r[11]),l=!0)},p(s,a){const f={};a&64&&(f.map=ct(s[6])),a&128&&(f.maptilerBasemap=s[7]),n.$set(f)},i(s){o||(b(n.$$.fragment,s),o=!0)},o(s){C(n.$$.fragment,s),o=!1},d(s){s&&(k(e),k(t)),I(n,s),l=!1,i()}}}function N0(r){let e,t,n,o,l,i,s=r[5]&&Wi(r);return{c(){e=h("div"),t=h("div"),n=T(),o=h("hr"),l=T(),s&&s.c(),j(e,"class","pico"),j(e,"slot","left")},m(a,f){$(a,e,f),m(e,t),r[18](t),m(e,n),m(e,o),m(e,l),s&&s.m(e,null),i=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&b(s,1)):(s=Wi(a),s.c(),b(s,1),s.m(e,null)):s&&(ye(),C(s,1,1,()=>{s=null}),ve())},i(a){i||(b(s),i=!0)},o(a){C(s),i=!1},d(a){a&&k(e),r[18](null),s&&s.d()}}}function qi(r){let e,t;return e=new e_({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function z0(r){let e,t;return e=new o0({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function O0(r){let e,t;return e=new _0({props:{wasmReady:r[4],firstLoad:r[9].firstLoad}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&16&&(l.wasmReady=n[4]),o&512&&(l.firstLoad=n[9].firstLoad),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Ji(r){let e,t,n,o,l,i;e=new Ve({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[B0]},$$scope:{ctx:r}}});const s=[X0,K0,Z0,Y0,J0,q0,W0,G0,H0,U0,D0,R0],a=[];function f(u,c){return u[9].mode=="pick-neighbourhood"?0:u[9].mode=="set-boundary"?1:u[9].mode=="auto-boundaries"?2:u[9].mode=="neighbourhood"?3:u[9].mode=="view-shortcuts"?4:u[9].mode=="impact-one-destination"?5:u[9].mode=="route"?6:u[9].mode=="predict-impact"?7:u[9].mode=="impact-detail"?8:u[9].mode=="debug-neighbourhood"?9:u[9].mode=="debug-intersections"?10:u[9].mode=="debug-demand"?11:-1}return~(n=f(r))&&(o=a[n]=s[n](r)),{c(){F(e.$$.fragment),t=T(),o&&o.c(),l=Je()},m(u,c){P(e,u,c),$(u,t,c),~n&&a[n].m(u,c),$(u,l,c),i=!0},p(u,c){const _={};c&32&&(_.data=u[5].getInvertedBoundary()),c&4194304&&(_.$$scope={dirty:c,ctx:u}),e.$set(_);let d=n;n=f(u),n===d?~n&&a[n].p(u,c):(o&&(ye(),C(a[d],1,1,()=>{a[d]=null}),ve()),~n?(o=a[n],o?o.p(u,c):(o=a[n]=s[n](u),o.c()),b(o,1),o.m(l.parentNode,l)):o=null)},i(u){i||(b(e.$$.fragment,u),b(o),i=!0)},o(u){C(e.$$.fragment,u),C(o),i=!1},d(u){u&&(k(t),k(l)),I(e,u),~n&&a[n].d(u)}}}function B0(r){let e,t;const n=[$e("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new At({props:o}),{c(){F(e.$$.fragment)},m(l,i){P(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){I(e,l)}}}function R0(r){let e,t;return e=new x_({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function D0(r){let e,t;return e=new fp({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function U0(r){let e,t;return e=new Vp({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function H0(r){let e,t;return e=new hg({props:{road:r[9].road}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.road=n[9].road),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function G0(r){let e,t;return e=new _1({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function W0(r){let e,t;return e=new C1({props:{prevMode:r[9].prevMode}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.prevMode=n[9].prevMode),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function q0(r){let e,t;return e=new Ig({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function J0(r){let e,t;return e=new E0({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Y0(r){let e,t;return e=new lg({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function Z0(r){let e,t;return e=new H_({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function K0(r){let e,t;return e=new eh({props:{name:r[9].name,existing:r[9].existing}}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.name=n[9].name),o&512&&(l.existing=n[9].existing),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function X0(r){let e,t;return e=new n1({}),{c(){F(e.$$.fragment)},m(n,o){P(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){I(e,n)}}}function V0(r){let e,t,n,o,l,i,s=r[8].startsWith("ltn_cnt/"),a,f,u,c,_,d,p,g,w;e=new ga({}),n=new ha({}),l=new Hc({props:{map:r[0],apiKey:to,country:void 0}});let S=s&&qi();const y=[O0,z0],v=[];function L(E,M){return E[9].mode=="title"?0:E[9].mode=="new-project"?1:-1}~(c=L(r))&&(_=v[c]=y[c](r));let A=r[5]&&Ji(r);return g=new zu({}),{c(){F(e.$$.fragment),t=T(),F(n.$$.fragment),o=T(),F(l.$$.fragment),i=T(),S&&S.c(),a=T(),f=h("div"),u=T(),_&&_.c(),d=T(),A&&A.c(),p=T(),F(g.$$.fragment)},m(E,M){P(e,E,M),$(E,t,M),P(n,E,M),$(E,o,M),P(l,E,M),$(E,i,M),S&&S.m(E,M),$(E,a,M),$(E,f,M),r[15](f),$(E,u,M),~c&&v[c].m(E,M),$(E,d,M),A&&A.m(E,M),$(E,p,M),P(g,E,M),w=!0},p(E,M){const N={};M&1&&(N.map=E[0]),l.$set(N),M&256&&(s=E[8].startsWith("ltn_cnt/")),s?S?M&256&&b(S,1):(S=qi(),S.c(),b(S,1),S.m(a.parentNode,a)):S&&(ye(),C(S,1,1,()=>{S=null}),ve());let z=c;c=L(E),c===z?~c&&v[c].p(E,M):(_&&(ye(),C(v[z],1,1,()=>{v[z]=null}),ve()),~c?(_=v[c],_?_.p(E,M):(_=v[c]=y[c](E),_.c()),b(_,1),_.m(d.parentNode,d)):_=null),E[5]?A?(A.p(E,M),M&32&&b(A,1)):(A=Ji(E),A.c(),b(A,1),A.m(p.parentNode,p)):A&&(ye(),C(A,1,1,()=>{A=null}),ve())},i(E){w||(b(e.$$.fragment,E),b(n.$$.fragment,E),b(l.$$.fragment,E),b(S),b(_),b(A),b(g.$$.fragment,E),w=!0)},o(E){C(e.$$.fragment,E),C(n.$$.fragment,E),C(l.$$.fragment,E),C(S),C(_),C(A),C(g.$$.fragment,E),w=!1},d(E){E&&(k(t),k(o),k(i),k(a),k(f),k(u),k(d),k(p)),I(e,E),I(n,E),I(l,E),S&&S.d(E),r[15](null),~c&&v[c].d(E),A&&A.d(E),I(g,E)}}}function Q0(r){let e,t,n,o;function l(s){r[16](s)}let i={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${to}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:ba},{id:"national_rail",url:xi}],$$slots:{default:[V0]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.map=r[0]),t=new ma({props:i}),Te.push(()=>We(t,"map",l)),t.$on("error",r[17]),{c(){e=h("div"),F(t.$$.fragment),j(e,"slot","main"),V(e,"position","relative"),V(e,"width","100%"),V(e,"height","100%")},m(s,a){$(s,e,a),P(t,e,null),o=!0},p(s,a){const f={};a&128&&(f.style=`https://api.maptiler.com/maps/${s[7]}/style.json?key=${to}`),a&4195129&&(f.$$scope={dirty:a,ctx:s}),!n&&a&1&&(n=!0,f.map=s[0],qe(()=>n=!1)),t.$set(f)},i(s){o||(b(t.$$.fragment,s),o=!0)},o(s){C(t.$$.fragment,s),o=!1},d(s){s&&k(e),I(t)}}}function x0(r){let e,t,n,o,l;return t=new jf({}),o=new m_({props:{$$slots:{main:[Q0],left:[N0],top:[j0]},$$scope:{ctx:r}}}),{c(){e=h("div"),F(t.$$.fragment),n=T(),F(o.$$.fragment),j(e,"class","pico")},m(i,s){$(i,e,s),P(t,e,null),$(i,n,s),P(o,i,s),l=!0},p(i,[s]){const a={};s&4196351&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&(k(e),k(n)),I(t),I(o,i)}}}function eb(r,e,t){let n,o,l,i,s,a,f,u,c,_;Z(r,co,z=>t(12,n=z)),Z(r,uo,z=>t(13,o=z)),Z(r,fo,z=>t(14,l=z)),Z(r,tt,z=>t(5,i=z)),Z(r,xt,z=>t(6,s=z)),Z(r,zo,z=>t(21,a=z)),Z(r,Vr,z=>t(7,f=z)),Z(r,Zt,z=>t(8,u=z)),Z(r,ue,z=>t(9,c=z)),Z(r,wr,z=>t(10,_=z));let d=!1;Mr(async()=>{await Ss(),await ns(),t(4,d=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(te(zo,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let p=null;function g(){s.fitBounds(i.getBounds(),{animate:!1})}let w,S,y;function v(z){Te[z?"unshift":"push"](()=>{y=z,t(3,y),t(12,n)})}function L(z){p=z,t(0,p)}const A=z=>{console.log(z.detail.error)};function E(z){Te[z?"unshift":"push"](()=>{S=z,t(2,S),t(13,o)})}const M=()=>te(wr,_=!0,_);function N(z){Te[z?"unshift":"push"](()=>{w=z,t(1,w),t(14,l)})}return r.$$.update=()=>{r.$$.dirty&1&&p&&xt.set(p),r.$$.dirty&16386&&w&&l&&(t(1,w.innerHTML="",w),w.appendChild(l)),r.$$.dirty&8196&&S&&o&&(t(2,S.innerHTML="",S),S.appendChild(o)),r.$$.dirty&4104&&y&&n&&(t(3,y.innerHTML="",y),y.appendChild(n))},[p,w,S,y,d,i,s,f,u,c,_,g,n,o,l,v,L,A,E,M,N]}class tb extends le{constructor(e){super(),ie(this,e,eb,x0,oe,{})}}new tb({target:document.getElementById("app")});
